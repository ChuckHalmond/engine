var main;(()=>{"use strict";var t={d:(r,e)=>{for(var a in e)t.o(e,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:e[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{t.r(r),t.d(r,{main:()=>Jt});const e=class{constructor(t){this._defaultCtor=t.defaultCtor,this._onDefaultOverride=t.onDefaultOverride,this._constructors=new Map}get defaultCtor(){return this._defaultCtor}overrideDefaultCtor(t){this._defaultCtor=t,this._onDefaultOverride(t)}forceQualifier(t){this._forcedQualifier=t}unforceQualifier(){delete this._forcedQualifier}getConstructor(t){const r=this._forcedQualifier||t;if(void 0===r)return this._defaultCtor;const e=this._constructors.get(r);if(void 0===e)throw new Error(`No constructor for qualifier ${r}`);return e}inject(t){const r=this.getConstructor(null==t?void 0:t.qualifier);return(null==t?void 0:t.args)?new r(...Array.from(t.args)):new r}register(t,r){this._constructors.has(r)||this._constructors.set(r,t)}};class a extends Error{constructor(){super(...arguments),this.name="MathError"}}class n{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1]]);else if("object"==typeof t[0]){const r=t[0];if(r.length<2)throw new a("Array must be of length 2 at least.");r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array([0,0])}get values(){return[this.array[0],this.array[1]]}set values(t){this.array[0]=t[0],this.array[1]=t[1]}get x(){return this.array[0]}set x(t){this.array[0]=t}get y(){return this.array[1]}set y(t){this.array[1]=t}setValues(t,r){const e=this.array;return e[0]=t,e[1]=r,this}equals(t){const r=t.array,e=this.array;return r[0]===e[0]&&r[1]===e[1]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],this}clone(){return new n(this.values)}setUnit(){const t=this.array;return t[0]=1,t[1]=1,this}setZeros(){const t=this.array;return t[0]=0,t[1]=0,this}add(t){const r=t.array,e=this.array;return e[0]=e[0]+r[0],e[1]=e[1]+r[1],this}addScalar(t){const r=this.array;return r[0]=r[0]+t,r[1]=r[1]+t,this}sub(t){const r=t.array,e=this.array;return e[0]=e[0]-r[0],e[1]=e[1]-r[1],this}lerp(t,r){const e=t.array,a=this.array;return a[0]=r*(e[0]-a[0]),a[1]=r*(e[1]-a[1]),this}clamp(t,r){const e=this.array,a=t.array,n=r.array;return e[0]=Math.min(n[0],Math.min(e[0],a[0])),e[1]=Math.min(n[1],Math.min(e[1],a[1])),this}multScalar(t){const r=this.array;return r[0]=r[0]*t,r[1]=r[1]*t,this}cross(t){const r=this.array,e=t.array;return r[0]*e[1]-r[1]*e[0]}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]}length(){const t=this.array;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}lengthSquared(){const t=this.array;return t[0]*t[0]+t[1]*t[1]}dist(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(a*a+n*n)}distSquared(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1];return a*a+n*n}normalize(){const t=this.array,r=t[0]*t[0]+t[1]*t[1],e=Math.sqrt(r);return e>Number.EPSILON?(t[0]=t[0]/e,t[1]=t[1]/e):(t[0]=0,t[1]=0),this}negate(){const t=this.array;return t[0]=-t[0],t[1]=-t[1],this}mult(t){if(t instanceof s){const r=t.array;return this.array[0]=this.array[0]*r[0],this.array[1]=this.array[1]*r[1],this}{const r=this.x,e=this.y,a=t.array;return this.x=r*a[0]+e*a[2],this.y=r*a[1]+e*a[3],this}}addScaled(t,r){const e=t.array,a=this.array;return a[0]=a[0]+e[0]*r,a[1]=a[1]+e[1]*r,this}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1]}readFromArray(t,r=0){const e=this.array;return e[0]=t[r],e[1]=t[r+1],this}copyAndSub(t,r){const e=this.array,a=t.array,n=r.array;return e[0]=a[0]-n[0],e[1]=a[1]-n[1],this}}var s=n;new e({defaultCtor:n,onDefaultOverride:t=>{s=t}});class i{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1],t[2]]);else if("object"==typeof t[0]){const r=t[0];if(r.length<3)throw new a("Array must be of length 3 at least.");r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array([0,0,0])}toString(){return`Vector3([${Array.from(this.array).join(", ")}])`}static angle(t,r){const e=new l;return Math.acos(e.copy(t).dot(r)/(Math.sqrt(e.copy(t).dot(t))*Math.sqrt(e.copy(r).dot(r))))}get values(){return[this.array[0],this.array[1],this.array[2]]}set values(t){this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2]}get x(){return this.array[0]}set x(t){this.array[0]=t}get y(){return this.array[1]}set y(t){this.array[1]=t}get z(){return this.array[2]}set z(t){this.array[2]=t}setValues(t,r,e){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this}copy(t){const r=t.array;return this.array[0]=r[0],this.array[1]=r[1],this.array[2]=r[2],this}clone(){return new i(this.values)}equals(t){return t.array[0]===this.array[0]&&t.array[1]===this.array[1]&&t.array[2]===this.array[2]}setZeros(){return this.array[0]=0,this.array[1]=0,this.array[2]=0,this}setUnit(){return this.array[0]=1,this.array[1]=1,this.array[2]=1,this}add(t){return this.array[0]=this.array[0]+t.array[0],this.array[1]=this.array[1]+t.array[1],this.array[2]=this.array[2]+t.array[2],this}addScalar(t){return this.array[0]=this.array[0]+t,this.array[1]=this.array[1]+t,this.array[2]=this.array[2]+t,this}sub(t){return this.array[0]=this.array[0]-t.array[0],this.array[1]=this.array[1]-t.array[1],this.array[2]=this.array[2]-t.array[2],this}lerp(t,r,e){return this.array[0]=(1-e)*t.x+e*(r.x-t.x),this.array[1]=(1-e)*t.y+e*(r.y-t.y),this.array[2]=(1-e)*t.z+e*(r.z-t.z),this}max(t){return this.array[0]=Math.max(this.array[0],t.array[0]),this.array[1]=Math.max(this.array[1],t.array[1]),this.array[2]=Math.max(this.array[2],t.array[2]),this}min(t){return this.array[0]=Math.min(this.array[0],t.array[0]),this.array[1]=Math.min(this.array[1],t.array[1]),this.array[2]=Math.min(this.array[2],t.array[2]),this}clamp(t,r){return this.array[0]=Math.min(r.array[0],Math.max(this.array[0],t.array[0])),this.array[1]=Math.min(r.array[1],Math.max(this.array[1],t.array[1])),this.array[2]=Math.min(r.array[2],Math.max(this.array[2],t.array[2])),this}scale(t){return this.array[0]=this.array[0]*t,this.array[1]=this.array[1]*t,this.array[2]=this.array[2]*t,this}cross(t){const r=this.array[1]*t.array[2]-this.array[2]*t.array[1],e=this.array[2]*t.array[0]-this.array[0]*t.array[2],a=this.array[0]*t.array[1]-this.array[1]*t.array[0];return this.array[0]=r,this.array[1]=e,this.array[2]=a,this}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}length(){const t=this.array;return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}lengthSquared(){const t=this.array;return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}distance(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];return Math.hypot(a,n,s)}distanceSquared(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];return a*a+n*n+s*s}normalize(){const{array:t}=this,r=this.length();return r>Number.EPSILON?(t[0]/=r,t[1]/=r,t[2]/=r):(t[0]=0,t[1]=0,t[2]=0),this}negate(){const{array:t}=this;return t[0]*=-1,t[1]*=-1,t[2]*=-1,this}mult(t){const{array:r}=this;if(t instanceof l){const e=t.array;return r[0]=r[0]*e[0],r[1]=r[1]*e[1],r[2]=r[2]*e[2],this}{const[r,e,a]=this,n=t.array;return this.x=r*n[0]+e*n[3]+a*n[6],this.y=r*n[1]+e*n[4]+a*n[7],this.z=r*n[2]+e*n[5]+a*n[8],this}}toSpherical(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2],i=Math.hypot(a,n,s),o=Math.acos(n/i),l=Math.atan2(s,a);return r[0]=i,r[1]=o,r[2]=l,this}toCartesian(t){const r=this.array,e=t.array,a=r[0],n=r[1],s=r[2],i=a*Math.sin(n)*Math.cos(s)+e[0],o=a*Math.cos(n)+e[1],l=a*Math.sin(n)*Math.sin(s)+e[2];return r[0]=i,r[1]=o,r[2]=l,this}static mult(t,r){const e=t.array,a=r.array;return new i([e[0]*a[0]+e[1]*a[1]+e[2]*a[2],e[3]*a[0]+e[4]*a[1]+e[5]*a[2],e[6]*a[0]+e[7]*a[1]+e[8]*a[2]])}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2]}readFromArray(t,r=0){return this.array[0]=t[r],this.array[1]=t[r+1],this.array[2]=t[r+2],this}addScaled(t,r){return this.array[0]=this.array[0]+t.array[0]*r,this.array[1]=this.array[1]+t.array[1]*r,this.array[2]=this.array[2]+t.array[2]*r,this}copyAndSub(t,r){const e=t.array,a=r.array;return this.array[0]=e[0]-a[0],this.array[1]=e[1]-a[1],this.array[2]=e[2]-a[2],this}copyAndCross(t,r){const e=t.array,a=r.array,n=e[1]*a[2]-e[2]*a[1],s=e[2]*a[0]-e[0]*a[2],i=e[0]*a[1]-e[1]*a[0];return this.array[0]=n,this.array[1]=s,this.array[2]=i,this}[Symbol.iterator](){const{array:t}=this,{length:r}=t;let e=0;return{next:()=>e<r?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}var o,l=i;new e({defaultCtor:i,onDefaultOverride:t=>{l=t}});class c{constructor(){}}c.origin=new l([0,0,0]),c.right=new l([1,0,0]),c.left=new l([-1,0,0]),c.up=new l([0,1,0]),c.down=new l([0,-1,0]),c.forward=new l([0,0,1]),c.backward=new l([0,0,-1]),function(t){t.A="a",t.B="b",t.C="c",t.D="d",t.E="e",t.F="f",t.G="g",t.H="h",t.I="i",t.J="j",t.K="k",t.L="l",t.M="m",t.O="o",t.P="p",t.Q="q",t.R="r",t.S="s",t.T="t",t.U="u",t.V="v",t.W="w",t.X="x",t.Y="y",t.Z="z",t.ENTER="Enter",t.BACKSPACE="Backspace",t.ARROW_DOWN="ArrowDown",t.ARROW_LEFT="ArrowLeft",t.ARROW_RIGHT="ArrowRight",t.ARROW_UP="ArrowUp",t.SHIFT="Shift"}(o||(o={}));const u=Object.keys(o).length;var h,E;!function(t){t.Alt="Alt",t.Control="Control",t.Shift="Shift"}(h||(h={})),function(t){t[t.LEFT=0]="LEFT",t[t.WHEEL=1]="WHEEL",t[t.RIGHT=2]="RIGHT",t[t.FORWARD=3]="FORWARD",t[t.BACK=4]="BACK"}(E||(E={}));const y=Object.keys(E).length,f=Object.freeze(Object.values(E).reduce(((t,r,e)=>Object.assign(t,{[r]:e})),{})),A=Object.freeze(Object.values(o).reduce(((t,r,e)=>Object.assign(t,{[r]:e})),{}));var T,_=new class{constructor(){this.keyFlags=new Array(3*u).fill(!1),this.mouseFlags=new Array(3*y).fill(!1),this.pointerPosition=new s,this.wheelDelta=0,this.canvas=null,this.canvasRectangle=null}initialize(t){this.canvas=t,this.canvasRectangle=t.getBoundingClientRect(),t.addEventListener("pointerdown",this),t.addEventListener("pointerup",this),t.addEventListener("contextmenu",this),t.addEventListener("pointermove",this),t.addEventListener("wheel",this),t.addEventListener("keydown",this),t.addEventListener("keyup",this),t.addEventListener("focusout",this)}getCanvasRect(){const t=this.canvasRectangle;if(null===t)throw new Error("Input manager not initialized.");return t}clear(){this.keyFlags.fill(!1,0,2*u),this.mouseFlags.fill(!1,0,2*y),this.wheelDelta=0}handleEvent(t){let r=-1;switch(t.type){case"pointerdown":r=f[t.button],this.mouseFlags[1*y+r]=!0,this.mouseFlags[2*y+r]=!0;break;case"pointerup":r=f[t.button],this.mouseFlags[0*y+r]=!0,this.mouseFlags[2*y+r]=!1;break;case"pointermove":const e=this.getCanvasRect();this.pointerPosition.setValues(t.clientX-e.left,t.clientY-e.top);break;case"wheel":this.wheelDelta=t.deltaY/100;break;case"keydown":r=A[t.key],this.keyFlags[1*u+r]=!0,this.keyFlags[2*u+r]=!0;break;case"keyup":r=A[t.key],this.keyFlags[0*u+r]=!0,this.keyFlags[2*u+r]=!1;break;case"focusout":this.keyFlags.fill(!1),this.mouseFlags.fill(!1),this.wheelDelta=0,this.pointerPosition.setZeros()}}getKey(t){return this.keyFlags[2*u+A[t]]}getKeyUp(t){return this.keyFlags[0*u+A[t]]}getKeyDown(t){return this.keyFlags[1*u+A[t]]}getMouseButton(t){return this.mouseFlags[2*y+f[t]]}getPointerPosition(){return this.pointerPosition.clone()}getPointerScreenPosition(){const t=this.pointerPosition.array,r=this.getCanvasRect(),e=t[0]/r.width*2-1,a=t[1]/r.height*2-1;return new s([e,a])}getWheelDelta(){return this.wheelDelta}getMouseButtonDown(t){return this.mouseFlags[1*y+f[t]]}getMouseButtonUp(t){return this.mouseFlags[0*y+f[t]]}};const d=new l,m=new l,R=new l;T=new WeakMap;var g;!function(t){t[t.NO_AUTO_EXTEND=0]="NO_AUTO_EXTEND",t[t.AUTO_EXTEND_ONE=1]="AUTO_EXTEND_ONE",t[t.AUTO_EXTEND_POW2=2]="AUTO_EXTEND_POW2"}(g||(g={}));var N=class extends class{constructor(t,r){this.ctor=t,this.autoExtendPolicy=r||g.AUTO_EXTEND_ONE,this.autoExtendTicks=0}autoExtend(){switch(this.autoExtendPolicy){case g.AUTO_EXTEND_ONE:this.extend(1);break;case g.AUTO_EXTEND_POW2:this.extend(Math.pow(2,this.autoExtendTicks))}this.autoExtendTicks++}acquire(t){throw new Error("Not implemented")}release(...t){throw new Error("Not implemented")}extend(t){throw new Error("Not implemented")}clear(){throw new Error("Not implemented")}}{constructor(t,r){super(t,null==r?void 0:r.policy),this.objects=new Array((null==r?void 0:r.size)||0).fill(0).map((()=>new this.ctor(null==r?void 0:r.args))),this.top=0}acquire(t){const r=this.top,e=r+t;if(this.autoExtendPolicy)for(;this.objects.length<e;)this.autoExtend();return this.top=e,this.objects.slice(r,e)}release(t){const r=this.top;t>r&&console.warn("Releasing under zero."),this.top=Math.max(r-t,0)}extend(t){this.objects.push(...Array(t).fill(0).map((()=>new this.ctor)))}clear(){this.objects=[],this.top=0,this.autoExtendTicks=0}};Math.PI,Math.PI;const I=new ArrayBuffer(Float32Array.BYTES_PER_ELEMENT),p=new Float32Array(I),M=new Uint32Array(I);class S{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]);else if("object"==typeof t[0]){const r=t[0];this.checkArray(r),r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array([0,0,0,0,0,0,0,0,0])}get row1(){return[this.array[0],this.array[3],this.array[6]]}set row1(t){this.array[0]=t[0],this.array[3]=t[1],this.array[6]=t[2]}get row2(){return[this.array[1],this.array[4],this.array[7]]}set row2(t){this.array[1]=t[0],this.array[4]=t[1],this.array[7]=t[2]}get row3(){return[this.array[2],this.array[5],this.array[8]]}set row3(t){this.array[2]=t[0],this.array[5]=t[1],this.array[8]=t[2]}get col1(){return[this.array[0],this.array[1],this.array[2]]}set col1(t){this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2]}get col2(){return[this.array[3],this.array[4],this.array[5]]}set col2(t){this.array[3]=t[0],this.array[4]=t[1],this.array[5]=t[2]}get col3(){return[this.array[6],this.array[7],this.array[8]]}set col3(t){this.array[6]=t[0],this.array[7]=t[1],this.array[8]=t[2]}get m11(){return this.array[0]}set m11(t){this.array[0]=t}get m12(){return this.array[3]}set m12(t){this.array[3]=t}get m13(){return this.array[6]}set m13(t){this.array[6]=t}get m21(){return this.array[1]}set m21(t){this.array[1]=t}get m22(){return this.array[4]}set m22(t){this.array[4]=t}get m23(){return this.array[7]}set m23(t){this.array[7]=t}get m31(){return this.array[2]}set m31(t){this.array[2]=t}get m32(){return this.array[5]}set m32(t){this.array[5]=t}get m33(){return this.array[8]}set m33(t){this.array[8]=t}checkArray(t){if(t.length<9)throw new a("Array must be of length 9 at least.")}getValues(){return[this.array[0],this.array[1],this.array[2],this.array[3],this.array[4],this.array[5],this.array[6],this.array[7],this.array[8]]}setValues(t,r,e,a,n,s,i,o,l){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this.array[3]=a,this.array[4]=n,this.array[5]=s,this.array[6]=i,this.array[7]=o,this.array[8]=l,this}equals(t){const r=t.array;return this.array[0]===r[0]&&this.array[1]===r[1]&&this.array[2]===r[2]&&this.array[3]===r[3]&&this.array[4]===r[4]&&this.array[5]===r[5]&&this.array[6]===r[6]&&this.array[7]===r[7]&&this.array[8]===r[8]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],this}clone(){return new S(this.array[0],this.array[1],this.array[2],this.array[3],this.array[4],this.array[5],this.array[6],this.array[7],this.array[8])}setIdentity(){const t=this.array;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}setZeros(){const t=this.array;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,this}det(){const t=this.array;return t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6])}trace(){const t=this.array;return t[0]+t[4]+t[8]}negate(){const t=this.array;return t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],t[3]=-t[3],t[4]=-t[4],t[5]=-t[5],t[6]=-t[6],t[7]=-t[7],t[8]=-t[8],this}transpose(){const t=this.array;let r;return r=t[1],t[1]=t[3],t[3]=r,r=t[2],t[2]=t[6],t[6]=r,r=t[5],t[5]=t[7],t[7]=r,this}invert(){const t=this.array,r=t[4]*t[8]-t[5]*t[7],e=t[1]*t[8]-t[2]*t[7],n=t[1]*t[5]-t[2]*t[4],s=t[3]*t[8]-t[5]*t[6],i=t[0]*t[8]-t[2]*t[6],o=t[0]*t[5]-t[2]*t[3],l=t[3]*t[7]-t[4]*t[6],c=t[0]*t[7]-t[1]*t[6],u=t[0]*t[4]-t[1]*t[3],h=1/(t[0]*r-t[3]*e+t[6]*n);if(0==h)throw new a("Matrix is not invertible.");return t[0]=h*r,t[1]=-h*e,t[2]=h*n,t[3]=-h*s,t[4]=h*i,t[5]=-h*o,t[6]=h*l,t[7]=-h*c,t[8]=h*u,this}add(t){const r=this.array,e=t.array;return r[0]=r[0]+e[0],r[1]=r[1]+e[1],r[2]=r[2]+e[2],r[3]=r[3]+e[3],r[4]=r[4]+e[4],r[5]=r[5]+e[5],r[6]=r[6]+e[6],r[7]=r[7]+e[7],r[8]=r[8]+e[8],this}sub(t){const r=this.array,e=t.array;return r[0]=r[0]-e[0],r[1]=r[1]-e[1],r[2]=r[2]-e[2],r[3]=r[3]-e[3],r[4]=r[4]-e[4],r[5]=r[5]-e[5],r[6]=r[6]-e[6],r[7]=r[7]-e[7],r[8]=r[8]-e[8],this}mult(t){const r=this.array,e=t.array,a=r[0],n=r[1],s=r[2],i=r[3],o=r[4],l=r[5],c=r[6],u=r[7],h=r[8],E=e[0],y=e[1],f=e[2],A=e[3],T=e[4],_=e[5],d=e[6],m=e[7],R=e[8];return r[0]=E*a+y*i+f*c,r[1]=E*n+y*o+f*u,r[2]=E*s+y*l+f*h,r[3]=A*a+T*i+_*c,r[4]=A*n+T*o+_*u,r[5]=A*s+T*l+_*h,r[6]=d*a+m*i+R*c,r[7]=d*n+m*o+R*u,r[8]=d*s+m*l+R*h,this}multScalar(t){const r=this.array;return r[0]=r[0]*t,r[1]=r[1]*t,r[2]=r[2]*t,r[3]=r[3]*t,r[4]=r[4]*t,r[5]=r[5]*t,r[6]=r[6]*t,r[7]=r[7]*t,r[8]=r[8]*t,this}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3],t[r+4]=e[4],t[r+5]=e[5],t[r+6]=e[6],t[r+7]=e[7],t[r+8]=e[8]}readFromArray(t,r=0){const e=this.array;e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],e[4]=t[r+4],e[5]=t[r+5],e[6]=t[r+6],e[7]=t[r+7],e[8]=t[r+8]}static rotationX(t){return(new S).setRotationX(t)}setRotationX(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=1,this.array[1]=0,this.array[2]=0,this.array[3]=0,this.array[4]=r,this.array[5]=e,this.array[6]=0,this.array[7]=-e,this.array[8]=r,this}static rotationY(t){return(new S).setRotationY(t)}setRotationY(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=r,this.array[1]=0,this.array[2]=-e,this.array[3]=0,this.array[4]=1,this.array[5]=0,this.array[6]=e,this.array[7]=0,this.array[8]=r,this}static rotationZ(t){return(new S).setRotationZ(t)}setRotationZ(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=r,this.array[1]=e,this.array[2]=0,this.array[3]=-e,this.array[4]=r,this.array[5]=0,this.array[6]=0,this.array[7]=0,this.array[8]=1,this}solve(t){const r=this.array,e=r[0],a=r[3],n=r[6],s=r[1],i=r[4],o=r[7],l=r[2],c=r[5],u=r[8];let h,E,y,f;h=i*u-o*c,E=o*l-s*u,y=s*c-i*l,f=e*h+a*E+n*y,0!=f&&(f=1/f);const A=f*(t.x*h+t.y*E+t.z*y);h=-(c*t.z-u*t.y),E=-(u*t.x-l*t.z),y=-(l*t.y-c*t.x);const T=f*(e*h+a*E+n*y);return h=-(t.y*o-t.z*i),E=-(t.z*s-t.x*o),y=-(t.x*i-t.y*s),[A,T,f*(e*h+a*E+n*y)]}solve2(t){const r=this.array,e=r[0],a=r[1],n=r[3],s=r[4],i=t.x-r[4],o=t.y-r[7];let l=e*s-a*n;return 0!=l&&(l=1/l),[l*(s*i-a*o),l*(e*o-n*i)]}}var C=S;new e({defaultCtor:S,onDefaultOverride:t=>{C=t}});class O{constructor(...t){"number"==typeof t[0]?this._array=[t[0],t[1],t[2],t[3]]:"object"==typeof t[0]?(this._checkArray(t[0]),this._array=t[0]):this._array=[0,0,0,0]}get array(){return this._array}get x(){return this._array[0]}set x(t){this._array[0]=t}get y(){return this._array[1]}set y(t){this._array[1]=t}set z(t){this._array[2]=t}get z(){return this._array[2]}set w(t){this._array[3]=t}get w(){return this._array[3]}get pitch(){const t=this.array,r=t[0],e=t[1],a=t[2],n=2*(t[3]*e-a*r);return Math.abs(n)>=1?Math.sign(n)*(Math.PI/2):Math.asin(n)}get yaw(){const t=this.array,r=t[0],e=t[1],a=t[2],n=2*(t[3]*a+r*e),s=1-2*(e*e+a*a);return Math.atan2(n,s)}get roll(){const t=this.array,r=t[0],e=t[1],a=t[2],n=2*(t[3]*r+e*a),s=1-2*(r*r+e*e);return Math.atan2(n,s)}getValues(){return[this._array[0],this._array[1],this._array[2],this._array[3]]}setValues(t,r,e,a){return this._array[0]=t,this._array[1]=r,this._array[2]=e,this._array[3]=a,this}_checkArray(t){if(t.length<4)throw new a("Array must be of length 4 at least.")}static fromArray(t){return new O(t)}static fromAxisAngle(t,r){return(new O).setAxisAngle(t,r)}static fromVector(t){return new O(t.x,t.y,t.z,1)}static fromEuler(t,r,e){return(new O).setEuler(t,r,e)}copy(t){const r=this._array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],this}clone(){return new O(this.x,this.y,this.z,this.w)}equals(t){const r=this.array,e=t.array;return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}getAxis(t){const r=this.array,e=t.array,a=1-r[3]*r[3];if(a<Number.EPSILON)return t.setZeros();const n=function(t){const r=.5*t;p[0]=t,M[0]=1597463007-(M[0]>>1);let e=p[0];return e*=1.5-r*e*e,e}(a);return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,t}getMatrix3(t){const r=this.array,e=2/this.lengthSquared(),a=r[0],n=r[1],s=r[2],i=r[3],o=a*e,l=n*e,c=s*e,u=i*o,h=i*l,E=i*c,y=a*o,f=a*l,A=a*c,T=n*l,_=n*c,d=s*c;return t.setValues(1-(T+d),f+E,A-h,f-E,1-(y+d),_+u,A+h,_-u,1-(y+T))}getMatrix4(t){const r=this.array,e=2/this.lengthSquared(),a=r[0],n=r[1],s=r[2],i=r[3],o=a*e,l=n*e,c=s*e,u=i*o,h=i*l,E=i*c,y=a*o,f=a*l,A=a*c,T=n*l,_=n*c,d=s*c;return t.setValues(1-(T+d),f+E,A-h,0,f-E,1-(y+d),_+u,0,A+h,_-u,1-(y+T),0,0,0,0,1)}rotate(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2],i=r[0],o=r[1],l=r[2],c=r[3],u=c*a+0*-i+-o*s+l*n,h=c*n+0*-o+-l*a+i*s,E=c*s+0*-l+-i*n+o*a,y=i*a+0*c+o*n+l*s;return e[0]=y*l+E*c+u*o-h*i,e[1]=y*o+h*c+E*i-u*l,e[2]=y*i+u*c+h*l-E*o,t}toVector(){return new l([this.x,this.y,this.z])}setEuler(t,r,e){const a=Math.cos(.5*r),n=Math.sin(.5*r),s=Math.cos(.5*t),i=Math.sin(.5*t),o=Math.cos(.5*e),l=Math.sin(.5*e),c=this.array;return c[0]=l*s*a-o*i*n,c[1]=o*i*a+l*s*n,c[2]=o*s*n-l*i*a,c[3]=o*s*a+l*i*n,this}setAxisAngle(t,r=0){const e=t.length();if(0===e)return this;const a=Math.sin(.5*r)/e,n=t.array,s=this.array;return s[0]=n[0]*a,s[1]=n[1]*a,s[2]=n[2]*a,s[3]=Math.cos(.5*r),this}setMatrix(t){const r=t.array;let e=0,a=0,n=0,s=0,i=0,o=0,l=0,c=0,u=0;t instanceof C?(e=r[0],a=r[3],n=r[6],s=r[1],i=r[4],o=r[7],l=r[2],c=r[5],u=r[8]):(e=r[0],a=r[4],n=r[8],s=r[1],i=r[5],o=r[9],l=r[2],c=r[6],u=r[10]);const h=e+i+u,E=this.array;if(h>0){const t=2*Math.sqrt(h+1);E[3]=.25*t,E[0]=(c-o)/t,E[1]=(n-l)/t,E[2]=(s-a)/t}else if(e>i&&e>u){const t=2*Math.sqrt(1+e-i-u);E[3]=(c-o)/t,E[0]=.25*t,E[1]=(a+s)/t,E[2]=(n+l)/t}else if(i>u){const t=2*Math.sqrt(1+i-e-u);E[3]=(n-l)/t,E[0]=(a+s)/t,E[1]=.25*t,E[2]=(o+c)/t}else{const t=2*Math.sqrt(1+u-e-i);E[3]=(s-a)/t,E[0]=(n+l)/t,E[1]=(o+c)/t,E[2]=.25*t}return this}lookAt(t,r){const e=r.clone().sub(t).normalize(),a=c.forward.clone().cross(e),n=c.forward.dot(e);return new w(a.x,a.y,a.z,n+1).normalize()}static fromMatrix(t){return(new O).setMatrix(t)}setVectors(t,r){const e=t.dot(r),a=t.cross(r).array,n=this.array;n[0]=a[0],n[1]=a[1],n[2]=a[2];const s=t.length(),i=t.length();return n[3]=Math.sqrt(s*s*i*i)+e,this.normalize()}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}lengthSquared(){const t=this.array;return t[0]**2+t[1]**2+t[2]**2+t[3]**2}length(){const t=this.array;return Math.hypot(t[0],t[1],t[2],t[3])}angleTo(t){return 2*Math.acos(Math.abs(Math.max(-1,Math.min(1,this.dot(t)))))}rotateTowards(t){const r=this.angleTo(t);if(0===r)return this;const e=Math.min(1,r);return this.slerp(this,t,e),this}invert(){return this.conjugate()}conjugate(){const t=this.array;return t[0]*=-1,t[1]*=-1,t[2]*=-1,this}normalize(){const t=this.array;let r=this.length();return 0===r?(t[0]=0,t[1]=0,t[2]=0,t[3]=1):(r=1/r,t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r),this}add(t){const r=this.array,e=t.array;return r[0]+=e[0],r[1]+=e[1],r[2]+=e[2],r[3]+=e[3],this}sub(t){const r=this.array,e=t.array;return r[0]-=e[0],r[1]-=e[1],r[2]-=e[2],r[3]-=e[3],this}mult(t){const r=this.array,e=t.array,a=r[0],n=r[1],s=r[2],i=r[3],o=e[0],l=e[1],c=e[2],u=e[3];return r[0]=a*u+i*o+n*c-s*l,r[1]=n*u+i*l+s*o-a*c,r[2]=s*u+i*c+a*l-n*o,r[3]=i*u-a*o-n*l-s*c,this}scale(t){const r=this.array;return r[0]*=t,r[1]*=t,r[2]*=t,r[3]*=t,this}static slerp(t,r,e,a){if(a instanceof w||(a=new w),0===e)return a.copy(t);if(1===e)return a.copy(r);const n=a.array,s=t.array,i=r.array,o=s[3]*i[3]+s[0]*i[0]+s[1]*i[1]+s[2]*i[2];if(Math.abs(o)>=1)return n[3]=s[3],n[0]=s[0],n[1]=s[1],n[2]=s[2],a;const l=Math.acos(o),c=Math.sqrt(1-o*o);if(Math.abs(c-Math.trunc(c))<Number.EPSILON)return n[3]=.5*s[3]+.5*i[3],n[0]=.5*s[0]+.5*i[0],n[1]=.5*s[1]+.5*i[1],n[2]=.5*s[2]+.5*i[2],a;const u=Math.sin((1-e)*l)/c,h=Math.sin(e*l)/c;return n[3]=s[3]*u+i[3]*h,n[0]=s[0]*u+i[0]*h,n[1]=s[1]*u+i[1]*h,n[2]=s[2]*u+i[2]*h,a}slerp(t,r,e){return w.slerp(t,r,e,this)}copyIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3]}readFromArray(t,r=0){const e=this.array;e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3]}}var w=O;new N(O),new e({defaultCtor:O,onDefaultOverride:t=>{w=t}});class P{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]);else if("object"==typeof t[0]){const r=t[0];this.checkArray(r),r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array(16)}static fromValues(t,r,e,a,n,s,i,o,l,c,u,h,E,y,f,A){return new P(t,r,e,a,n,s,i,o,l,c,u,h,E,y,f,A)}static fromArray(t){if(t.length<16)throw new Error("Matrix4 needs an array of size 16 at least.");return new P(t)}getValues(){const t=this.array;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}setValues(t,r,e,a,n,s,i,o,l,c,u,h,E,y,f,A){const T=this.array;return T[0]=t,T[1]=r,T[2]=e,T[3]=a,T[4]=n,T[5]=s,T[6]=i,T[7]=o,T[8]=l,T[9]=c,T[10]=u,T[11]=h,T[12]=E,T[13]=y,T[14]=f,T[15]=A,this}get m11(){return this.array[0]}set m11(t){this.array[0]=t}get m12(){return this.array[4]}set m12(t){this.array[4]=t}get m13(){return this.array[8]}set m13(t){this.array[8]=t}get m14(){return this.array[12]}set m14(t){this.array[12]=t}get m21(){return this.array[1]}set m21(t){this.array[1]=t}get m22(){return this.array[5]}set m22(t){this.array[5]=t}get m23(){return this.array[9]}set m23(t){this.array[9]=t}get m24(){return this.array[13]}set m24(t){this.array[13]=t}get m31(){return this.array[2]}set m31(t){this.array[2]=t}get m32(){return this.array[6]}set m32(t){this.array[6]=t}get m33(){return this.array[10]}set m33(t){this.array[10]=t}get m34(){return this.array[14]}set m34(t){this.array[14]=t}get m41(){return this.array[3]}set m41(t){this.array[3]=t}get m42(){return this.array[7]}set m42(t){this.array[7]=t}get m43(){return this.array[11]}set m43(t){this.array[11]=t}get m44(){return this.array[15]}set m44(t){this.array[15]=t}checkArray(t){if(t.length<16)throw new a("Array must be of length 16 at least.")}getRotation(){const t=this.array,r=t[0],e=t[4],a=t[8],n=t[1],s=t[5],i=t[9],o=t[2],l=t[6],c=t[10],u=r+s+c;let h=0,E=0,y=0,f=0;if(u>0){const t=2*Math.sqrt(u+1);f=.25*t,h=(l-i)/t,E=(a-o)/t,y=(n-e)/t}else if(r>s&&r>c){const t=2*Math.sqrt(1+r-s-c);f=(l-i)/t,h=.25*t,E=(e+n)/t,y=(a+o)/t}else if(s>c){const t=2*Math.sqrt(1+s-r-c);f=(a-o)/t,h=(e+n)/t,E=.25*t,y=(i+l)/t}else{const t=2*Math.sqrt(1+c-r-s);f=(n-e)/t,h=(a+o)/t,E=(i+l)/t,y=.25*t}return new w(h,E,y,f)}setTRS(t,r,e){const a=this.array,n=r.array,s=t.array,i=e.array,o=n[0],l=n[1],c=n[2],u=n[3],h=o+o,E=l+l,y=c+c,f=o*h,A=o*E,T=o*y,_=l*E,d=l*y,m=c*y,R=u*h,g=u*E,N=u*y,I=i[0],p=i[1],M=i[2];return a[0]=(1-(_+m))*I,a[1]=(A+N)*I,a[2]=(T-g)*I,a[3]=0,a[4]=(A-N)*p,a[5]=(1-(f+m))*p,a[6]=(d+R)*p,a[7]=0,a[8]=(T+g)*M,a[9]=(d-R)*M,a[10]=(1-(f+_))*M,a[11]=0,a[12]=s[0],a[13]=s[1],a[14]=s[2],a[15]=1,this}setRotation(t){const r=this.array,e=t.array,a=2/t.lengthSquared(),n=e[0],s=e[1],i=e[2],o=e[3],l=n*a,c=s*a,u=i*a,h=o*l,E=o*c,y=o*u,f=n*l,A=n*c,T=n*u,_=s*c,d=s*u,m=i*u,R=1-(_+m),g=A+y,N=T-E,I=A-y,p=1-(f+m),M=d+h,S=T+E,C=d-h,O=1-(f+_);return r[0]=R,r[1]=g,r[2]=N,r[4]=I,r[5]=p,r[6]=M,r[8]=S,r[9]=C,r[10]=O,this}equals(t){const r=this.array,e=t.array;return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}clone(){const t=this.array;return new P(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}static identity(){return new P(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setIdentity(){const t=this.array;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}static zeros(){return new P(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}setZeros(){const t=this.array;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=0,this}det(){const t=this.array,r=t[0]*t[5]-t[1]*t[4],e=t[0]*t[6]-t[2]*t[4],a=t[0]*t[7]-t[3]*t[4],n=t[1]*t[6]-t[2]*t[5],s=t[1]*t[7]-t[3]*t[5],i=t[2]*t[7]-t[3]*t[6],o=t[8]*n-t[9]*e+t[10]*r,l=t[8]*s-t[9]*a+t[11]*r,c=t[8]*i-t[10]*a+t[11]*e;return-(t[9]*i-t[10]*s+t[11]*n)*t[12]+c*t[13]-l*t[14]+o*t[15]}trace(){const t=this.array;return t[0]+t[5]+t[10]+t[15]}static negate(t,r){const e=t.array,a=r.array;return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=-e[3],a[4]=-e[4],a[5]=-e[5],a[6]=-e[6],a[7]=-e[7],a[8]=-e[8],a[9]=-e[9],a[10]=-e[10],a[11]=-e[11],a[12]=-e[12],a[13]=-e[13],a[14]=-e[14],a[15]=-e[15],r}negate(){return P.negate(this,this)}static transpose(t,r){const e=t.array,a=r.array,n=e[0],s=e[1],i=e[2],o=e[3],l=e[4],c=e[5],u=e[6],h=e[7],E=e[8],y=e[9],f=e[10],A=e[11],T=e[12],_=e[13],d=e[14],m=e[15];return a[0]=n,a[1]=l,a[2]=E,a[3]=T,a[4]=s,a[5]=c,a[6]=y,a[7]=_,a[8]=i,a[9]=u,a[10]=f,a[11]=d,a[12]=o,a[13]=h,a[14]=A,a[15]=m,r}transpose(){return P.transpose(this,this)}static invert(t,r){const e=t.array,n=r.array,s=e[0],i=e[1],o=e[2],l=e[3],c=e[4],u=e[5],h=e[6],E=e[7],y=e[8],f=e[9],A=e[10],T=e[11],_=e[12],d=e[13],m=e[14],R=e[15],g=s*u-i*c,N=s*h-o*c,I=s*E-l*c,p=i*h-o*u,M=i*E-l*u,S=o*E-l*h,C=y*d-f*_,O=y*m-A*_,w=y*R-T*_,P=f*m-A*d,v=f*R-T*d,L=A*R-T*m,U=g*L-N*v+I*P+p*w-M*O+S*C;if(0==U)throw new a("Matrix is not invertible.");const B=1/U;return n[0]=(u*L-h*v+E*P)*B,n[1]=(-i*L+o*v-l*P)*B,n[2]=(d*S-m*M+R*p)*B,n[3]=(-f*S+A*M-T*p)*B,n[4]=(-c*L+h*w-E*O)*B,n[5]=(s*L-o*w+l*O)*B,n[6]=(-_*S+m*I-R*N)*B,n[7]=(y*S-A*I+T*N)*B,n[8]=(c*v-u*w+E*C)*B,n[9]=(-s*v+i*w-l*C)*B,n[10]=(_*M-d*I+R*g)*B,n[11]=(-y*M+f*I-T*g)*B,n[12]=(-c*P+u*O-h*C)*B,n[13]=(s*P-i*O+o*C)*B,n[14]=(-_*p+d*N-m*g)*B,n[15]=(y*p-f*N+A*g)*B,r}invert(){return P.invert(this,this)}static add(t,r,e){const a=t.array,n=r.array,s=e.array;return s[0]=a[0]+n[0],s[1]=a[1]+n[1],s[2]=a[2]+n[2],s[3]=a[3]+n[3],s[4]=a[4]+n[4],s[5]=a[5]+n[5],s[6]=a[6]+n[6],s[7]=a[7]+n[7],s[8]=a[8]+n[8],s[9]=a[9]+n[9],s[10]=a[10]+n[10],s[11]=a[11]+n[11],s[12]=a[12]+n[12],s[13]=a[13]+n[13],s[14]=a[14]+n[14],s[15]=a[15]+n[15],e}add(t){return P.add(this,t,this)}static sub(t,r,e){const a=t.array,n=r.array,s=e.array;return s[0]=a[0]-n[0],s[1]=a[1]-n[1],s[2]=a[2]-n[2],s[3]=a[3]-n[3],s[4]=a[4]-n[4],s[5]=a[5]-n[5],s[6]=a[6]-n[6],s[7]=a[7]-n[7],s[8]=a[8]-n[8],s[9]=a[9]-n[9],s[10]=a[10]-n[10],s[11]=a[11]-n[11],s[12]=a[12]-n[12],s[13]=a[13]-n[13],s[14]=a[14]-n[14],s[15]=a[15]-n[15],e}sub(t){return P.sub(this,t,this)}static mult(t,r,e){const a=t.array,n=r.array,s=e.array,i=a[0],o=a[1],l=a[2],c=a[3],u=a[4],h=a[5],E=a[6],y=a[7],f=a[8],A=a[9],T=a[10],_=a[11],d=a[12],m=a[13],R=a[14],g=a[15],N=n[0],I=n[1],p=n[2],M=n[3],S=n[4],C=n[5],O=n[6],w=n[7],P=n[8],v=n[9],L=n[10],U=n[11],B=n[12],b=n[13],F=n[14],x=n[15];return s[0]=i*N+u*I+f*p+d*M,s[1]=o*N+h*I+A*p+m*M,s[2]=l*N+E*I+T*p+R*M,s[3]=c*N+y*I+_*p+g*M,s[4]=i*S+u*C+f*O+d*w,s[5]=o*S+h*C+A*O+m*w,s[6]=l*S+E*C+T*O+R*w,s[7]=c*S+y*C+_*O+g*w,s[8]=i*P+u*v+f*L+d*U,s[9]=o*P+h*v+A*L+m*U,s[10]=l*P+E*v+T*L+R*U,s[11]=c*P+y*v+_*L+g*U,s[12]=i*B+u*b+f*F+d*x,s[13]=o*B+h*b+A*F+m*x,s[14]=l*B+E*b+T*F+R*x,s[15]=c*B+y*b+_*F+g*x,e}mult(t){return P.mult(this,t,this)}getMaxScaleOnAxis(){const t=this.array,r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],a=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(r,e,a))}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3],t[r+4]=e[4],t[r+5]=e[5],t[r+6]=e[6],t[r+7]=e[7],t[r+8]=e[8],t[r+9]=e[9],t[r+10]=e[10],t[r+11]=e[11],t[r+12]=e[12],t[r+13]=e[13],t[r+14]=e[14],t[r+15]=e[15]}readFromArray(t,r=0){const e=this.array;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],e[4]=t[r+4],e[5]=t[r+5],e[6]=t[r+6],e[7]=t[r+7],e[8]=t[r+8],e[9]=t[r+9],e[10]=t[r+10],e[11]=t[r+11],e[12]=t[r+12],e[13]=t[r+13],e[14]=t[r+14],e[15]=t[r+15],this}solve(t){const r=this.array,e=r[0],a=r[1],n=r[2],s=r[3],i=r[4],o=r[5],l=r[6],c=r[7],u=r[8],h=r[9],E=r[10],y=r[11],f=r[12],A=r[13],T=r[14],_=r[15],d=e*o-a*i,m=e*l-n*i,R=e*c-s*i,g=a*l-n*o,N=a*c-s*o,I=n*c-s*l,p=u*A-h*f,M=u*T-E*f,S=u*_-y*f,C=h*T-E*A,O=h*_-y*A,w=E*_-y*T,P=t.x,v=t.y,L=t.z,U=t.w;let B=d*w-m*O+R*C+g*S-N*M+I*p;return 0!=B&&(B=1/B),[B*((o*w-l*O+c*C)*P-(i*w-l*S+c*M)*v+(i*O-o*S+c*p)*L-(i*C-o*M+l*p)*U),B*-((a*w-n*O+s*C)*P-(e*w-n*S+s*M)*v+(e*O-a*S+s*p)*L-(e*C-a*M+n*p)*U),B*((A*I-T*N+_*g)*P-(f*I-T*R+_*m)*v+(f*N-A*R+_*d)*L-(f*g-A*m+T*d)*U),B*-((h*I-E*N+y*g)*P-(u*I-E*R+y*m)*v+(u*N-h*R+y*d)*L-(u*g-h*m+E*d)*U)]}solve2(t){const r=this.array,e=r[0],a=r[1],n=r[4],s=r[5],i=t.x-r[8],o=t.y-r[9];let l=e*s-a*n;return 0!=l&&(l=1/l),[l*(s*i-a*o),l*(e*o-n*i)]}solve3(t){const r=this.array,e=r[0],a=r[1],n=r[2],s=r[4],i=r[5],o=r[6],l=r[8],c=r[9],u=r[10],h=t.x-r[12],E=t.y-r[13],y=t.z-r[14];let f=i*u-o*c,A=o*l-s*u,T=s*c-i*l,_=e*f+a*A+n*T;0!=_&&(_=1/_);const d=_*(h*f+E*A+y*T);f=-(c*y-u*E),A=-(u*h-l*y),T=-(l*E-c*h);const m=_*(e*f+a*A+n*T);return f=-(E*o-y*i),A=-(y*s-h*o),T=-(h*i-E*s),[d,m,_*(e*f+a*A+n*T)]}static translation(t){return(new P).setTranslation(t)}setTranslation(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2];return r[12]=a,r[13]=n,r[14]=s,this}translate(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2],i=r[0]*a+r[4]*n+r[8]*s+1*r[12],o=r[1]*a+r[5]*n+r[9]*s+1*r[13],l=r[2]*a+r[6]*n+r[10]*s+1*r[14],c=r[3]*a+r[7]*n+r[11]*s+1*r[15];return r[12]=i,r[13]=o,r[14]=l,r[15]=c,this}static rotationX(t){return(new P).setRotationX(t)}setRotationX(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e,r[6]=a,r[7]=0,r[8]=0,r[9]=-a,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateX(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),n=r[4]*e+r[8]*a,s=r[5]*e+r[9]*a,i=r[6]*e+r[10]*a,o=r[7]*e+r[11]*a,l=r[4]*-a+r[8]*e,c=r[5]*-a+r[9]*e,u=r[6]*-a+r[10]*e,h=r[7]*-a+r[11]*e;return r[4]=n,r[5]=s,r[6]=i,r[7]=o,r[8]=l,r[9]=c,r[10]=u,r[11]=h,this}static rotationY(t){return(new P).setRotationY(t)}setRotationY(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=e,r[1]=0,r[2]=-a,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=a,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateY(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),n=r[0]*e+r[8]*-a,s=r[1]*e+r[9]*-a,i=r[2]*e+r[10]*-a,o=r[3]*e+r[11]*-a,l=r[0]*a+r[8]*e,c=r[1]*a+r[9]*e,u=r[2]*a+r[10]*e,h=r[3]*a+r[11]*e;return r[0]=n,r[1]=s,r[2]=i,r[3]=o,r[8]=l,r[9]=c,r[10]=u,r[11]=h,this}static rotationZ(t){return(new P).setRotationZ(t)}setRotationZ(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=e,r[1]=a,r[2]=0,r[3]=0,r[4]=-a,r[5]=e,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateZ(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),n=r[0]*e+r[4]*a,s=r[1]*e+r[5]*a,i=r[2]*e+r[6]*a,o=r[3]*e+r[7]*a,l=r[0]*-a+r[4]*e,c=r[1]*-a+r[5]*e,u=r[2]*-a+r[6]*e,h=r[3]*-a+r[7]*e;return r[0]=n,r[1]=s,r[2]=i,r[3]=o,r[4]=l,r[5]=c,r[6]=u,r[7]=h,this}static rotation(t){return(new P).rotation(t)}rotation(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[4]=e[3],r[5]=e[4],r[6]=e[5],r[8]=e[6],r[9]=e[7],r[10]=e[8],this}rotate(t,r){const e=this.array,a=t.array,n=t.length(),s=a[0]/n,i=a[1]/n,o=a[2]/n,l=Math.cos(r),c=Math.sin(r),u=1-l,h=s*s*u+l,E=s*i*u-o*c,y=s*o*u+i*c,f=i*s*u+o*c,A=i*i*u+l,T=i*o*u-s*c,_=o*s*u-i*c,d=o*i*u+s*c,m=o*o*u+l,R=e[0]*h+e[4]*f+e[8]*_,g=e[1]*h+e[5]*f+e[9]*_,N=e[2]*h+e[6]*f+e[10]*_,I=e[3]*h+e[7]*f+e[11]*_,p=e[0]*E+e[4]*A+e[8]*d,M=e[1]*E+e[5]*A+e[9]*d,S=e[2]*E+e[6]*A+e[10]*d,C=e[3]*E+e[7]*A+e[11]*d,O=e[0]*y+e[4]*T+e[8]*m,w=e[1]*y+e[5]*T+e[9]*m,P=e[2]*y+e[6]*T+e[10]*m,v=e[3]*y+e[7]*T+e[11]*m;return e[0]=R,e[1]=g,e[2]=N,e[3]=I,e[4]=p,e[5]=M,e[6]=S,e[7]=C,e[8]=O,e[9]=w,e[10]=P,e[11]=v,this}static scaling(t){return(new P).setScaling(t)}setScaling(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2];return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=s,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}scale(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2];return r[0]*=a,r[1]*=a,r[2]*=a,r[3]*=a,r[4]*=n,r[5]*=n,r[6]*=n,r[7]*=n,r[8]*=s,r[9]*=s,r[10]*=s,r[11]*=s,r[12]*=1,r[13]*=1,r[14]*=1,r[15]*=1,this}static lookAt(t,r,e,a){const n=t.array,s=e.array,i=r.array,o=a.array,l=n[0],c=n[1],u=n[2],h=s[0],E=s[1],y=s[2];let f,A,T,_,d,m,R,g,N,I;return R=l-i[0],g=c-i[1],N=u-i[2],I=Math.hypot(R,g,N),I>0&&(I=1/Math.hypot(R,g,N),R*=I,g*=I,N*=I),f=E*N-y*g,A=y*R-h*N,T=h*g-E*R,I=Math.hypot(f,A,T),I>0&&(I=1/I,f*=I,A*=I,T*=I),_=g*T-N*A,d=N*f-R*T,m=R*A-g*f,I=Math.hypot(_,d,m),I>0&&(I=1/I,_*=I,d*=I,m*=I),o[0]=f,o[1]=A,o[2]=T,o[3]=0,o[4]=_,o[5]=d,o[6]=m,o[7]=0,o[8]=R,o[9]=g,o[10]=N,o[11]=0,o[12]=l,o[13]=c,o[14]=u,o[15]=1,a}lookAt(t,r,e){return P.lookAt(t,r,e,this)}transformPoint(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2],i=a*r[3]+n*r[7]+s*r[11]+r[15];return t.setValues((a*r[0]+n*r[4]+s*r[8]+r[12])/i,(a*r[1]+n*r[5]+s*r[9]+r[13])/i,(a*r[2]+n*r[6]+s*r[10]+r[14])/i),t}transformPoint4(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2],i=e[3],o=a*r[3]+n*r[7]+s*r[11]+i*r[15];return t.setValues((a*r[0]+n*r[4]+s*r[8]+r[12])/o,(a*r[1]+n*r[5]+s*r[9]+r[13])/o,(a*r[2]+n*r[6]+s*r[10]+r[14])/o,(a*r[3]+n*r[7]+s*r[11]+r[15])/o),t}transformDirection(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2];return t.setValues(a*r[0]+n*r[4]+s*r[8],a*r[1]+n*r[5]+s*r[9],a*r[2]+n*r[6]+s*r[10]),t}transformNormal(t){const r=t.array,e=this.invert().array,a=r[0],n=r[1],s=r[2];return t.setValues(a*e[0]+n*e[4]+s*e[8],a*e[1]+n*e[5]+s*e[9],a*e[2]+n*e[6]+s*e[10]),this.invert(),t}static perspective(t,r,e,a){return(new P).setPerspective(t,r,e,a)}setPerspective(t,r,e,a){const n=this.array,s=Math.tan(.5*Math.PI-.5*t),i=s/r,o=1/(e-a);return n[0]=i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(e+a)*o,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*e*a*o,n[15]=0,this}static orthographic(t,r,e,a,n,s){return(new P).setOrthographic(t,r,e,a,n,s)}setOrthographic(t,r,e,a,n,s){const i=this.array;return i[0]=2/(r-t),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(a-e),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(n-s),i[11]=0,i[12]=(r+t)/(t-r),i[13]=(a+e)/(e-a),i[14]=(s+n)/(n-s),i[15]=1,this}static frustum(t,r,e,a,n,s){return(new P).setFrustum(t,r,e,a,n,s)}setFrustum(t,r,e,a,n,s){const i=this.array,o=1/(r-t),l=1/(a-e),c=1/(n-s);return i[0]=2*n*o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*n*l,i[6]=0,i[7]=0,i[8]=(r+t)*o,i[9]=(a+e)*l,i[10]=(s+n)*c,i[11]=-1,i[12]=0,i[13]=0,i[14]=s*n*2*c,i[15]=0,this}}var v=P;new e({defaultCtor:P,onDefaultOverride:t=>{v=t}});const L=new class extends N{constructor(t,r){super(t,r),this._buffer=new Float32Array(0),this._bufferViews=Array((null==r?void 0:r.size)||0).fill(0).map((()=>this._buffer.subarray())),this._extensions=[]}}(l),U=new class{constructor(){this._count=0}newUUID(){return(++this._count).toString(16)}},B=new v,b=class{constructor(t,r){this.uuid=U.newUUID(),this.owner=t||null,this.isStatic=null!=r&&r,this.array=new Float32Array(16),this.localArray=new Float32Array(16),this.matrix=new v(this.array).setIdentity(),this.localMatrix=new v(this.localArray).setIdentity(),this.hasChanged=!1}getMatrix(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],t}setMatrix(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}getLocalMatrix(t){const r=this.localArray,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],t}setLocalMatrix(t){const r=this.localArray,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}getRight(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],t}getLeft(t){const r=this.array,e=t.array;return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],t}getUp(t){const r=this.array,e=t.array;return e[0]=r[4],e[1]=r[5],e[2]=r[6],t}getDown(t){const r=this.array,e=t.array;return e[0]=-r[4],e[1]=-r[5],e[2]=-r[6],t}getForward(t){const r=this.array,e=t.array;return e[0]=r[8],e[1]=r[9],e[2]=r[10],t}getBackward(t){const r=this.array,e=t.array;return e[0]=-r[8],e[1]=-r[9],e[2]=-r[10],t}getTranslation(t){const r=this.array,e=t.array;return e[0]=r[12],e[1]=r[13],e[2]=r[14],t}setTranslation(t){const r=this.array,e=t.array;return r[12]=e[0],r[13]=e[1],r[14]=e[2],this}translate(t){const r=this.array,e=t.array;return r[12]+=e[0],r[13]+=e[1],r[14]+=e[2],this}getScaling(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[5],e[2]=r[10],t}setScaling(t){const r=this.array,e=t.array;return r[0]=e[0],r[5]=e[1],r[10]=e[2],this}scale(t){const r=this.array,e=t.array;return r[0]*=e[0],r[5]*=e[1],r[10]*=e[2],this}getRotation(t){return t.setMatrix(this.matrix),t}setRotation(t){return this.matrix.setRotation(t),this}rotate(t){return this.matrix.mult(t.getMatrix4(B)),this}transformPoint(t){return t}transformDirection(t){return t}transformVector(t){return t}lookAt(t,r){const e=this.getTranslation(L.acquire(1)[0]);return this.matrix.lookAt(e,t,r),L.release(1),this}};class F{constructor(t,r){this.normal=null!=t?t:new l,this.constant=null!=r?r:0}static fromNormalAndConstant(t,r){return(new F).setFromNormalAndConstant(t,r)}static fromNormalAndCoplanarPoint(t,r){return(new F).setFromNormalAndCoplanarPoint(t,r)}static fromCoplanarPoints(t,r,e){return(new F).setFromCoplanarPoints(t,r,e)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}set(t,r,e,a){return this.normal.setValues(t,r,e),this.constant=a,this}setFromNormalAndConstant(t,r){return this.normal.copy(t),this.constant=r,this}setFromNormalAndCoplanarPoint(t,r){return this.normal.copy(t),this.constant=-r.dot(this.normal),this}setFromCoplanarPoints(t,r,e){const a=e.clone(),[n]=L.acquire(1);return n.copy(t),a.sub(r).cross(n.sub(r)).normalize(),this.setFromNormalAndCoplanarPoint(a,t),L.release(1),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}normalized(){const t=1/this.normal.length();return this.normal.scale(t),this.constant*=t,this}static intersection(t,r,e,a){const{normal:n,constant:s}=t,{normal:i,constant:o}=r,{normal:l,constant:c}=e;a.copy(i).cross(l);const u=-n.dot(a),[h,E,y]=a.scale(s).array;a.copy(l).cross(n);const[f,A,T]=a.scale(o).array;a.copy(n).cross(i);const[_,d,m]=a.scale(c).array;return a.setValues((h+f+_)/u,(E+A+d)/u,(y+T+m)/u),a}}var x=F;new e({defaultCtor:F,onDefaultOverride:t=>{x=t}});const D=new l;class G{constructor(){this.nearPlane=new x,this.farPlane=new x,this.topPlane=new x,this.bottomPlane=new x,this.leftPlane=new x,this.rightPlane=new x,this.extents=new Array(8).fill(0).map((t=>new l))}set(t,r,e,a,n,s){const{nearPlane:i,farPlane:o,bottomPlane:l,topPlane:c,leftPlane:u,rightPlane:h}=this;return i.copy(t),o.copy(r),c.copy(e),l.copy(a),u.copy(n),h.copy(s),this}copy(t){const{nearPlane:r,farPlane:e,bottomPlane:a,topPlane:n,leftPlane:s,rightPlane:i}=t;return this.set(r,e,n,a,s,i),this}clone(){return(new G).copy(this)}setFromMatrix(t){const{nearPlane:r,farPlane:e,bottomPlane:a,topPlane:n,leftPlane:s,rightPlane:i,extents:o}=this,[l,c,u,h,E,y,f,A,T,_,d,m,R,g,N,I]=t.array;return i.set(h-l,A-E,m-T,I-R).normalized(),s.set(h+l,A+E,m+T,I+R).normalized(),a.set(h+c,A+y,m+_,I+g).normalized(),n.set(h-c,A-y,m-_,I-g).normalized(),e.set(h-u,A-f,m-d,I-N).normalized(),r.set(h+u,A+f,m+d,I+N).normalized(),x.intersection(s,a,r,o[0]),x.intersection(s,n,r,o[1]),x.intersection(i,a,r,o[2]),x.intersection(i,n,r,o[3]),x.intersection(s,a,e,o[4]),x.intersection(s,n,e,o[5]),x.intersection(i,a,e,o[6]),x.intersection(i,n,e,o[7]),this}intersectsSphere(t){const{nearPlane:r,farPlane:e,bottomPlane:a,topPlane:n,leftPlane:s,rightPlane:i}=this,{center:o,radius:l}=t;return o.dot(r.normal)+r.constant+l<=0||o.dot(e.normal)+e.constant+l<=0||o.dot(a.normal)+a.constant+l<=0||o.dot(n.normal)+n.constant+l<=0||o.dot(s.normal)+s.constant+l<=0||o.dot(i.normal)+i.constant+l<=0}intersectsBox(t){const{max:r,min:e}=t,{nearPlane:a,farPlane:n,bottomPlane:s,topPlane:i,leftPlane:o,rightPlane:l}=this;return a.distanceToPoint(D.setValues(a.normal.x>0?r.x:e.x,a.normal.y>0?r.y:e.y,a.normal.z>0?r.z:e.z))>=0&&n.distanceToPoint(D.setValues(n.normal.x>0?r.x:e.x,n.normal.y>0?r.y:e.y,n.normal.z>0?r.z:e.z))>=0&&s.distanceToPoint(D.setValues(s.normal.x>0?r.x:e.x,s.normal.y>0?r.y:e.y,s.normal.z>0?r.z:e.z))>=0&&i.distanceToPoint(D.setValues(i.normal.x>0?r.x:e.x,i.normal.y>0?r.y:e.y,i.normal.z>0?r.z:e.z))>=0&&o.distanceToPoint(D.setValues(o.normal.x>0?r.x:e.x,o.normal.y>0?r.y:e.y,o.normal.z>0?r.z:e.z))>=0&&l.distanceToPoint(D.setValues(l.normal.x>0?r.x:e.x,l.normal.y>0?r.y:e.y,l.normal.z>0?r.z:e.z))>=0}getEdges(t){const{extents:r}=this,e=r[0],a=r[1],n=r[2],s=r[3],i=r[4],o=r[5],l=r[6],c=r[7];return t[0].copy(o).sub(a),t[1].copy(c).sub(s),t[2].copy(i).sub(e),t[3].copy(l).sub(n),t[4].copy(c).sub(o),t[5].copy(s).sub(n),t}getExtents(t){const{extents:r}=this;return t[0].copy(r[0]),t[1].copy(r[1]),t[2].copy(r[2]),t[3].copy(r[3]),t[4].copy(r[4]),t[5].copy(r[5]),t[6].copy(r[6]),t[7].copy(r[7]),t}containsPoint(t){const{nearPlane:r,farPlane:e,bottomPlane:a,topPlane:n,leftPlane:s,rightPlane:i}=this;return r.distanceToPoint(t)>=0&&e.distanceToPoint(t)>=0&&a.distanceToPoint(t)>=0&&n.distanceToPoint(t)>=0&&s.distanceToPoint(t)>=0&&i.distanceToPoint(t)>=0}}var V,H,k,X,Y,z,W=G;!function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(V||(V={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(H||(H={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(k||(k={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(X||(X={})),function(t){t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4"}(Y||(Y={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT"}(z||(z={}));class j{static getDataTypeNumComponents(t){switch(t){case Y.VEC2:return 2;case Y.VEC3:return 3;case Y.VEC4:return 4}}static getComponentTypeArrayConstructor(t){switch(t){case X.FLOAT:return Float32Array;case X.BYTE:case X.UNSIGNED_BYTE:return Uint8Array;case X.SHORT:return Int16Array;case X.UNSIGNED_SHORT:return Uint16Array;case X.INT:return Int32Array;case X.UNSIGNED_INT:return Uint32Array}}static getArrayComponentType(t){return t instanceof Float32Array?X.FLOAT:t instanceof Int32Array?X.INT:t instanceof Uint32Array?X.UNSIGNED_INT:t instanceof Int16Array?X.SHORT:t instanceof Uint16Array?X.UNSIGNED_SHORT:t instanceof Int8Array?X.BYTE:X.UNSIGNED_BYTE}static createVertexElementArrayBuffer(t,r){const e=t.createBuffer();if(null===e)return null;const a=V.STATIC_READ,n=t.ELEMENT_ARRAY_BUFFER,{byteLength:s}=r,i=this.getElementArrayBufferType(r);return t.bindBuffer(n,e),t.bufferData(n,r,a),{internalBuffer:e,target:n,usage:a,byteLength:s,indexType:i}}static createVertexArrayBuffer(t,r,e,a,n){const{internalProgram:s}=r,i=V.STATIC_READ;n=null!=n&&n,a=null!=a?a:i;const o=e?Object.entries(e):null,l=null!==o?o.reduce(((t,[r,e])=>{var a,n,s;return t+(null!==(s=null!==(n=null===(a=e.array)||void 0===a?void 0:a.byteLength)&&void 0!==n?n:e.byteLength)&&void 0!==s?s:0)}),0):0,c=t.createBuffer();if(null===c)return null;const u=t.ARRAY_BUFFER;t.bindBuffer(u,c);const h=new ArrayBuffer(l);let E=0;const y={};if(null!==o){o.forEach((([t,r])=>{const{array:e,componentType:a,byteLength:n}=r;if(!(e||a&&n))throw new Error("Every attribute requires either an array or a componentType and a byteLength")})),E=n?o.reduce(((t,[r,e])=>{const{constant:a}=e;if(!a){const{array:r,type:a,componentType:n}=e,{BYTES_PER_ELEMENT:s}=null!=r?r:this.getComponentTypeArrayConstructor(n);return t+s*this.getDataTypeNumComponents(a)}return t}),0):0;const r=n?Math.trunc(l/E):0;let e,a=0;o.forEach((([i,o])=>{const{array:l,type:c}=o;let{constant:u=!1,divisor:f,normalize:A,componentType:T}=o;T=l?this.getArrayComponentType(l):T;const _=t.getAttribLocation(s,i);if(-1===_)return void console.warn(`Attribute ${i} could not be located.`);const d=this.getDataTypeNumComponents(c);if(f=null!=f?f:0,A=null!=A&&A,t.vertexAttribPointer(_,d,T,A,E,a),f>0&&t.vertexAttribDivisor(_,f),u){if(!l)throw new Error("constant flag requires an array parameter");switch(e=l,d){case 1:t.vertexAttrib1fv(_,e);break;case 2:t.vertexAttrib2fv(_,e);break;case 3:t.vertexAttrib3fv(_,e);break;case 4:t.vertexAttrib4fv(_,e)}}else{if(!u){const{array:t,type:s}=o,l=this.getDataTypeNumComponents(s);let c=0,_=0;if(n)if(t){({BYTES_PER_ELEMENT:_,byteLength:c}=t);const e=new(this.getComponentTypeArrayConstructor(this.getArrayComponentType(t)))(h,a),n=E/_;for(let a=0;a<r;a++){let r=a*l;e.set(t.slice(r,r+l),a*n)}}else({BYTES_PER_ELEMENT:_}=this.getComponentTypeArrayConstructor(T)),c=o.byteLength;else t?(({BYTES_PER_ELEMENT:_,byteLength:c}=t),new(j.getComponentTypeArrayConstructor(j.getArrayComponentType(t)))(h,a).set(t)):(({BYTES_PER_ELEMENT:_}=this.getComponentTypeArrayConstructor(T)),c=o.byteLength);y[i]={constantValue:e,numComponents:l,divisor:f,componentType:T,constant:u,byteOffset:a,bytesPerElement:_,type:s,normalize:A},a+=n?_*l:c}t.enableVertexAttribArray(_)}}))}return t.bufferData(u,h,a),{internalBuffer:c,target:u,usage:a,byteLength:l,interleaved:n,byteStride:E,vertexAttributes:y}}static setVertexArrayValues(t,r,e){const{attributes:a,elementsCount:n}=e;Object.keys(a).forEach((e=>{const{verticesBuffers:n}=r,s=n.find((t=>e in t.vertexAttributes));if(s){const{internalBuffer:r,target:n,byteStride:i,interleaved:o,vertexAttributes:l}=s;t.getParameter(t.ARRAY_BUFFER_BINDING)!==r&&t.bindBuffer(n,r);const c=a[e],{byteOffset:u,numComponents:h}=l[e];let{array:E,srcOffset:y,srcLength:f}=c;const{length:A}=E;let T=u;if(o){(y||f)&&(E=E.slice(null!=y?y:0,f));const r=o?Math.trunc(A/h):0;let e=0;for(let a=0;a<r;a++)t.bufferSubData(n,T,E,e,h),e+=h,T+=i}else y=null!=y?y:0,f=null!=f?f:A,t.bufferSubData(n,0,E,y,f)}}))}static setVertexArrayBufferData(t,r,e,a,n,s){const{internalBuffer:i,target:o}=r;t.bindBuffer(o,i),a=null!=a?a:0,n=null!=n?n:0,t.bufferSubData(o,a,e,n,s)}static createVertexArray(t,r,e){const{vertexAttributes:a,vertexBuffers:n,elementIndices:s,elementBuffer:i}=e,o=t.createVertexArray();if(null===o)return null;t.bindVertexArray(o);const l=a?Object.entries(a):[],{internalProgram:c}=r,u=[];if(n)n.forEach(((e,a)=>{const n=Object.fromEntries(l.filter((([t,r])=>r.buffer==a)));let s=null;if(void 0!==e){if("internalBuffer"in e){const{target:r,internalBuffer:a}=e;s=e,t.bindBuffer(r,a);const{byteStride:n,vertexAttributes:i}=s;Object.entries(i).forEach((([r,e])=>{const{numComponents:a,componentType:s,normalize:i,byteOffset:o,divisor:l,constant:u,constantValue:h}=e,E=t.getAttribLocation(c,r);if(E>-1)if(t.vertexAttribPointer(E,a,s,i,n,o),l>0&&t.vertexAttribDivisor(E,l),u&&h)switch(a){case 1:t.vertexAttrib1fv(E,h);break;case 2:t.vertexAttrib2fv(E,h);break;case 3:t.vertexAttrib3fv(E,h);break;case 4:t.vertexAttrib4fv(E,h)}else t.enableVertexAttribArray(E)}))}else if(n){const{usage:a,interleaved:i}=e;s=this.createVertexArrayBuffer(t,r,n,a,i)}}else n&&(s=this.createVertexArrayBuffer(t,r,n));if(null===s)return null;u.push(s)}));else if(a){let e=null;if(e=this.createVertexArrayBuffer(t,r,a),null===e)return null;u.push(e)}let h;if(void 0!==i)if("internalBuffer"in i){const{target:r,internalBuffer:e}=i;h=i,t.bindBuffer(r,e)}else s&&(h=this.createVertexElementArrayBuffer(t,s));else s&&(h=this.createVertexElementArrayBuffer(t,s));return null===h?null:{verticesBuffers:u,elementBuffer:h,program:r,internalVertexArray:o}}static deleteVertexArray(t,r){const{internalVertexArray:e}=r;t.isVertexArray(e)&&t.deleteVertexArray(e)}static getElementArrayBufferType(t){return t instanceof Uint8Array?z.UNSIGNED_BYTE:t instanceof Uint16Array?z.UNSIGNED_SHORT:z.UNSIGNED_INT}}var q,K=class{constructor(t={},r,e){if(t){const a=Object.entries(t),n=a.reduce(((t,[r,e])=>t+e.array.byteLength),0),s=new ArrayBuffer(n),i=e?a.reduce(((t,[r,e])=>{const{array:a,type:n}=e;return t+a.BYTES_PER_ELEMENT*j.getDataTypeNumComponents(n)}),0):0,o=Math.trunc(n/i);this.attributes={},this.indices=r,this.interleaved=null!=e&&e,this.stride=i,this.buffer=s;let l=0;e?Object.entries(t).forEach((([t,r])=>{const{array:e,type:a,constant:n,normalize:c}=r,u=j.getArrayComponentType(e),h=j.getDataTypeNumComponents(a),E=j.getComponentTypeArrayConstructor(j.getArrayComponentType(e)),{byteLength:y,BYTES_PER_ELEMENT:f}=e,A=new E(s,l),T=i/f;for(let t=0;t<o;t++){let r=t*h;A.set(e.slice(r,r+h),t*T)}this.attributes[t]={type:a,byteOffset:l,byteLength:y,componentType:u,constant:n,normalize:c},l+=h*f})):Object.entries(t).forEach((([t,r])=>{const{array:e,type:a}=r,{byteLength:n}=e,i=j.getArrayComponentType(e);new(j.getComponentTypeArrayConstructor(j.getArrayComponentType(e)))(s,l).set(e),this.attributes[t]={byteOffset:l,byteLength:n,type:a,componentType:i},l+=n}))}else this.attributes={},this.indices=void 0,this.interleaved=!1,this.stride=0,this.buffer=new ArrayBuffer(0)}toBlob(){var t;const{attributes:r,buffer:e,stride:a,interleaved:n,indices:s}=this,i=new Uint8Array(e),{length:o}=i,l=Uint8Array.from(null!=s?s:[]),c=null!==(t=null==s?void 0:s.length)&&void 0!==t?t:0,u=(new TextEncoder).encode(JSON.stringify({attributes:r,stride:a,interleaved:n})),{length:h}=u,E=new Uint8Array(4+h+c+o),{buffer:y}=E,f=new Uint16Array(y,0,2),A=f.length*(Uint16Array.BYTES_PER_ELEMENT/Uint8Array.BYTES_PER_ELEMENT);return f[0]=h,f[1]=c,E.set(u,A),E.set(l,A+h),E.set(i,A+h+c),new Blob([E],{type:"application/octet-stream"})}static async fromBlob(t){const r=await t.arrayBuffer(),e=new Uint16Array(r,0,2),{byteLength:a}=e,n=e[0],s=e[1],i=new Uint8Array(r,a,n),o=s<Math.pow(2,8)?Uint8Array:s<Math.pow(2,16)?Uint16Array:Uint32Array,l=new o(r.slice(a+n*Uint8Array.BYTES_PER_ELEMENT,s*o.BYTES_PER_ELEMENT)),c=r.slice(a+(s+n)*Uint8Array.BYTES_PER_ELEMENT),u=JSON.parse((new TextDecoder).decode(i)),{attributes:h,interleaved:E,stride:y}=u,f=new K;return f.buffer=c,f.attributes=h,f.interleaved=E,f.stride=y,f.indices=l,f}getAttribute(t){const{attributes:r}=this,e=r[t];if(e){const{buffer:t,interleaved:r,stride:a}=this,{type:n,byteOffset:s,byteLength:i,componentType:o}=e,l=j.getComponentTypeArrayConstructor(o),c=i/l.BYTES_PER_ELEMENT,u=j.getDataTypeNumComponents(n),{byteLength:h}=t,{BYTES_PER_ELEMENT:E}=l,y=new l(c);if(r){const r=new l(t,s),e=a,n=Math.trunc(h/e),i=e/E;for(let t=0;t<n;t++){let e=i*t;y.set(r.slice(e,e+u),u*t)}}else{const r=new l(t,s,c);y.set(r)}return{array:y,type:n}}return null}};!function(t){t[t.VERTICES=0]="VERTICES",t[t.UVS=1]="UVS",t[t.NORMALS=2]="NORMALS",t[t.TANGENTS=3]="TANGENTS"}(q||(q={}));class Z{constructor(t,r){this.center=t,this.radius=r}transform(t){const{center:r}=this;t.transformPoint(r)}containsPoint(t){const{center:r,radius:e}=this;return r.distance(t)<e}hitsSphere(t){const{center:r,radius:e}=this,{center:a,radius:n}=t;return r.distance(a)<e+n}hitsBox(t){const{center:r,radius:e}=this,{x:a,y:n,z:s}=r,{min:i,max:o}=t,{x:l,y:c,z:u}=i,{x:h,y:E,z:y}=o,f=Math.max(l,Math.min(a,h)),A=Math.max(c,Math.min(n,E)),T=Math.max(u,Math.min(s,y));return Math.sqrt((f-a)*(f-a)+(A-n)*(A-n)+(T-s)*(T-s))<e}}const Q=new Array(8).fill(0).map((t=>new l));var $,J,tt,rt,et,at,nt=class{constructor(t,r){this.min=t,this.max=r}static fromBoxes(...t){const r=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;let a=r,n=r,s=r,i=e,o=e,c=e;return t.forEach((t=>{const{min:r,max:e}=t,{x:l,y:u,z:h}=r,{x:E,y,z:f}=e;l<a?a=l:E>i&&(i=E),u<n?n=u:y>o&&(o=y),h<s?s=h:f>c&&(c=f)})),new nt(new l(a,n,s),new l(i,o,c))}hits(t){const{min:r,max:e}=this,{x:a,y:n,z:s}=r,{x:i,y:o,z:l}=e,{min:c,max:u}=t,{x:h,y:E,z:y}=c,{x:f,y:A,z:T}=u;return a<=f&&i>=h&&n<=A&&o>=E&&s<=T&&l>=y}transform(t){const{min:r,max:e}=this;let{x:a,y:n,z:s}=r,{x:i,y:o,z:l}=e;Q[0].setValues(a,n,s),Q[1].setValues(a,n,l),Q[2].setValues(a,o,s),Q[3].setValues(i,n,s),Q[4].setValues(a,o,l),Q[5].setValues(i,n,l),Q[6].setValues(i,o,s),Q[7].setValues(i,o,l);const{POSITIVE_INFINITY:c,NEGATIVE_INFINITY:u}=Number;return a=n=s=c,i=o=l=u,Q.forEach((r=>{t.transformPoint(r);const[e,c,u]=r;e<a?a=e:e>i&&(i=e),c<n?n=c:c>o&&(o=c),u<s?s=u:u>l&&(l=u)})),r.setValues(a,n,s),e.setValues(i,o,l),this}getEdges(t){const{min:r,max:e}=this,{x:a,y:n,z:s}=r,{x:i,y:o,z:l}=e;return t[0].setValues(i-a,0,0),t[1].setValues(0,o-n,0),t[2].setValues(0,0,l-s),t}getExtents(t){const{min:r,max:e}=this,{x:a,y:n,z:s}=r,{x:i,y:o,z:l}=e;return t[0].setValues(a,n,s),t[1].setValues(a,n,l),t[2].setValues(a,o,s),t[3].setValues(i,n,s),t[4].setValues(a,o,l),t[5].setValues(i,n,l),t[6].setValues(i,o,s),t[7].setValues(i,o,l),t}transformed(t){const{min:r,max:e}=this,{x:a,y:n,z:s}=r,{x:i,y:o,z:c}=e;return new nt(new l(a,n,s),new l(i,o,c)).transform(t)}},st=class{constructor(){this.halfEdges=[],this.vertices=[],this.faces=[]}clone(){return Object.assign(Object.create(this.constructor.prototype),structuredClone(this))}addTriangleFace(t,r,e,a){this.addFace([t,r,e],a)}addQuadFace(t,r,e,a,n){this.addFace([t,r,e,a],n)}addVertex(t){const{vertices:r}=this,e={position:t,halfEdgeID:null};return r.push(e)-1}addFace(t,r){var e;const{halfEdges:a,vertices:n,faces:s}=this,{length:i}=t;if(i<2)return void console.error("At least 2 vertices are required to create a face.");const o={halfEdgeID:null,...r},l=s.length;let c=null,u=null,h=null,E=null,y=null,f=null;for(let r=0;r<i;r++){c=t[r],u=r<i-1?t[r+1]:t[0];const s=Array.from(this.vertexFacesIterator(c)).find((t=>null!==t&&Array.from(this.faceHalfEdgesIterator(t)).find((t=>{var r;const{targetID:e,prevID:n}=a[t];return e===u&&(null===(r=a[null!=n?n:-1])||void 0===r?void 0:r.targetID)===c}))));if(s)continue;E={targetID:u,twinID:null,nextID:null,prevID:null,faceID:l},y=a.length,null===f?(o.halfEdge=y,h=y):(E.prevID=f,a[f].nextID=y);const A=n[c];null===A.halfEdgeID&&(A.halfEdgeID=y);const T=null!==(e=a.find((t=>{var r;const{targetID:e,prevID:n}=t;return e===c&&(null===(r=a[null!=n?n:-1])||void 0===r?void 0:r.targetID)===u})))&&void 0!==e?e:null;null!==T&&(E.twinID=a.indexOf(T),T.twinID=y),f=y,a.push(E)}null!==E&&null!==h&&(a[h].prevID=y,E.nextID=h),s.push(o)}linesArray(){const{faces:t,vertices:r}=this;return new Float32Array(t.flatMap(((t,e)=>{const a=Array.from(this.faceVerticesIterator(e));if(4===a.length){const[t,e,n,s]=a.map((t=>r[t].position));return[...t,...e,...e,...n,...n,...s,...s,...t]}{const[t,e,n]=a.map((t=>r[t].position));return[...t,...e,...e,...n,...n,...t]}})))}verticesArray(){const{faces:t,vertices:r}=this;return new Float32Array(t.flatMap(((t,e)=>Array.from(this.faceVerticesIterator(e)).flatMap((t=>Array.from(r[t].position))))))}tangentsArray(){const{faces:t,vertices:r}=this;return new Float32Array(t.flatMap(((t,e)=>{const a=Array.from(this.faceVerticesIterator(e)),n=t.uv,[s,i,o]=a.map((t=>r[t].position)),[l,c,u]=n,h=i.map(((t,r)=>s[r]-t)),E=i.map(((t,r)=>o[r]-t)),y=c.map(((t,r)=>l[r]-t)),f=c.map(((t,r)=>u[r]-t)),A=1/(y[0]*f[1]-y[1]*f[0]),T=h.map(((t,r)=>-(t*f[1]-E[r]*y[1])*A)),_=Math.hypot(...T);return t.tangent=T.map((t=>t/_)),a.flatMap((()=>Array.from(t.tangent)))})))}normalsArray(){const{faces:t,vertices:r}=this;return new Float32Array(t.flatMap(((t,e)=>{const a=Array.from(this.faceVerticesIterator(e)),[n,s,i]=a.map((t=>r[t].position)),o=s.map(((t,r)=>n[r]-t)),l=s.map(((t,r)=>i[r]-t)),c=o.map(((t,r)=>{const e=(r+1)%3,a=(r-1+3)%3;return-(o[e]*l[a]-o[a]*l[e])})),u=Math.hypot(...c);return t.normal=c.map((t=>t/u)),a.flatMap((()=>Array.from(t.normal)))})))}uvsArray(){const{faces:t}=this;return new Float32Array(t.flatMap((t=>t.uv.flat(1))))}trianglesIndicesArray(){const{faces:t}=this,r=t.reduce(((t,r,e)=>t+Array.from(this.faceVerticesIterator(e)).length),0);return new(r<Math.pow(2,8)?Uint8Array:r<Math.pow(2,16)?Uint16Array:Uint32Array)(t.reduce((([t,r],e,a)=>4===Array.from(this.faceVerticesIterator(a)).length?[t.concat([r,r+1,r+2,r+1,r+3,r+2]),r+4]:[t.concat([r,r+1,r+2]),r+3]),[[],0])[0])}linesIndicesArray(){const{faces:t}=this,r=t.reduce(((t,r,e)=>t+2*Array.from(this.faceVerticesIterator(e)).length),0);return new(r<Math.pow(2,8)?Uint8Array:r<Math.pow(2,16)?Uint16Array:Uint32Array)(t.reduce((([t,r],e,a)=>4===Array.from(this.faceVerticesIterator(a)).length?[t.concat([r,r+1,r+1,r+3,r+3,r+2,r+2,r]),r+4]:[t.concat([r,r+1,r+1,r+2,r+2,r]),r+3]),[[],0])[0])}boundingBox(){const t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;let e=t,a=t,n=t,s=r,i=r,o=r;const{vertices:c}=this;c.length>0&&c.forEach((t=>{const[r,l,c]=t.position;r<e?e=r:r>s&&(s=r),l<a?a=l:l>i&&(i=l),c<n?n=c:c>o&&(o=c)}));const u=new l([e,a,n]),h=new l([s,i,o]);return new nt(u,h)}boundingSphere(){const t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;let e=t,a=t,n=t,s=r,i=r,o=r;const{vertices:c}=this;c.length>0&&c.forEach((t=>{const[r,l,c]=t.position;r<e?e=r:r>s&&(s=r),l<a?a=l:l>i&&(i=l),c<n?n=c:c>o&&(o=c)}));const u=new l([e,a,n]),h=new l([s,i,o]);return new Z(new l,Math.max(u.length(),h.length()))}faceHalfEdgesIterator(t){return new it(this,t)}faceVerticesIterator(t){return new ot(this,t)}vertexFacesIterator(t){return new lt(this,t)}};class it{constructor(t,r){this.geometry=t,this.faceID=r,this.halfEdgeID=null}reset(){this.halfEdgeID=null}current(){return this.halfEdgeID}next(){var t,r,e,a;const{halfEdgeID:n,faceID:s,geometry:i}=this,{faces:o,halfEdges:l}=i,c=o[s];if(null!==c)if(null===n){const a=null!==(t=c.halfEdgeID)&&void 0!==t?t:null,n=null!==(e=null===(r=o[null!=a?a:-1])||void 0===r?void 0:r.nextID)&&void 0!==e?e:null;if(this.halfEdgeID=n,null!==a)return{value:a,done:null===n}}else if(n!==c.halfEdge){const t=null!==(a=l[n].nextID)&&void 0!==a?a:null;if(this.halfEdgeID=t,null!==n)return{value:n,done:null===t}}return{value:void 0,done:!0}}[Symbol.iterator](){return this.halfEdgeID=null,this}}class ot{constructor(t,r){this.geometry=t,this.faceID=r,this.halfEdgeID=null}reset(){this.halfEdgeID=null}current(){var t,r,e,a;const{halfEdgeID:n,geometry:s}=this,{halfEdges:i}=s;return null!==(a=null===(e=i[null!==(r=null===(t=i[null!=n?n:-1])||void 0===t?void 0:t.prevID)&&void 0!==r?r:-1])||void 0===e?void 0:e.targetID)&&void 0!==a?a:null}next(){var t,r,e,a,n,s;const{halfEdgeID:i,geometry:o,faceID:l}=this,{faces:c,halfEdges:u}=o,h=c[null!=l?l:-1];if(null!==h){const{halfEdge:o}=h;if(null===i){const a=null!==(r=u[null!==(t=u[null!=o?o:-1].prevID)&&void 0!==t?t:-1].targetID)&&void 0!==r?r:null,n=null!==(e=u[null!=o?o:-1].nextID)&&void 0!==e?e:null;if(this.halfEdgeID=n,null!==a)return{value:a,done:null===n}}else if(i!==h.halfEdge){const t=null!==(n=u[null!==(a=u[i].prevID)&&void 0!==a?a:-1].targetID)&&void 0!==n?n:null,r=null!==(s=u[i].nextID)&&void 0!==s?s:null;if(this.halfEdgeID=r,null!==t)return{value:t,done:null===r}}}return{value:void 0,done:!0}}[Symbol.iterator](){return this.halfEdgeID=null,this}}class lt{constructor(t,r){this.geometry=t,this.vertexID=r,this.halfEdgeID=null}reset(){this.halfEdgeID=null}current(){var t;const{geometry:r,halfEdgeID:e}=this,{halfEdges:a}=r;return null!==(t=a[null!=e?e:-1].faceID)&&void 0!==t?t:null}next(){var t,r,e,a,n,s,i,o,l,c;const{halfEdgeID:u,vertexID:h,geometry:E}=this,{halfEdges:y,vertices:f}=E,A=f[null!=h?h:-1];if(A){const{halfEdgeID:h}=A;if(null===u){const i=null!==(r=null===(t=y[null!=h?h:-1])||void 0===t?void 0:t.faceID)&&void 0!==r?r:null,o=null!==(s=null===(n=y[null!==(a=null===(e=y[null!=h?h:-1])||void 0===e?void 0:e.prevID)&&void 0!==a?a:-1])||void 0===n?void 0:n.twinID)&&void 0!==s?s:null;if(this.halfEdgeID=o,null!==i)return{value:i,done:null===o}}else if(u!==A.halfEdgeID){const t=null!==(o=null===(i=y[u])||void 0===i?void 0:i.faceID)&&void 0!==o?o:null,r=null!==(c=y[null!==(l=y[u].prevID)&&void 0!==l?l:-1].twinID)&&void 0!==c?c:null;if(this.halfEdgeID=r,null!==t)return{value:t,done:null===r}}}return{value:void 0,done:!0}}[Symbol.iterator](){return this.halfEdgeID=null,this}}class ct extends class{toBuilder(){throw new Error("No builder defined.")}}{constructor(t){super();const{width:r,height:e,depth:a,widthSegments:n,heightSegments:s,depthSegments:i}=null!=t?t:{};this.width=null!=r?r:1,this.height=null!=e?e:1,this.depth=null!=a?a:1,this.widthSegments=null!=n?n:1,this.heightSegments=null!=s?s:1,this.depthSegments=null!=i?i:1}toBuilder(){const t=new st,{width:r,height:e,depth:a}=this;let{widthSegments:n,heightSegments:s,depthSegments:i}=this;n=Math.floor(n),s=Math.floor(s),i=Math.floor(i);const o=[],l=[],c=[];let u=0;[[2,1,0,-1,-1,a,e,r,i,s],[2,1,0,1,-1,a,e,-r,i,s],[0,2,1,1,1,r,a,e,n,i],[0,2,1,1,-1,r,a,-e,n,i],[0,1,2,1,-1,r,e,a,n,s],[0,1,2,-1,-1,r,e,-a,n,s]].forEach((([t,r,e,a,n,s,i,h,E,y])=>{const f=s/E,A=i/y,T=s/2,_=i/2,d=h/2,m=E+1,R=y+1;let g=0;for(let s=0;s<R;s++){const i=s*A-_;for(let o=0;o<m;o++){const u=o*f-T,h=new Array(3);h[t]=u*a,h[r]=i*n,h[e]=d,l.push(...h),c.push(o/E,1-s/y),g++}}for(let t=0;t<y;t++)for(let r=0;r<E;r++){const e=u+r+m*t,a=u+r+m*(t+1),n=u+(r+1)+m*(t+1),s=u+(r+1)+m*t;o.push(e,a,s,n)}u+=g}));const{length:h}=o,E=[],y=[];for(let r=0;r<h;r+=4){const e=3*o[r],a=3*o[r+1],n=3*o[r+2],s=3*o[r+3],i=2*o[r],u=2*o[r+1],h=2*o[r+2],f=2*o[r+3];let A=E[e],T=E[a],_=E[n],d=E[s];void 0===A&&(A=t.addVertex([l[e],l[e+1],l[e+2]]),E[e]=A),void 0===T&&(T=t.addVertex([l[a],l[a+1],l[a+2]]),E[a]=T),void 0===_&&(_=t.addVertex([l[n],l[n+1],l[n+2]]),E[n]=_),void 0===d&&(d=t.addVertex([l[s],l[s+1],l[s+2]]),E[s]=d);let m=y[i],R=y[u],g=y[h],N=y[f];void 0===m&&(m=[c[i],c[i+1]],y[i]=m),void 0===R&&(R=[c[u],c[u+1]],y[u]=R),void 0===g&&(g=[c[h],c[h+1]],y[h]=g),void 0===N&&(N=[c[f],c[f+1]],y[f]=N),t.addQuadFace(A,T,_,d,{uv:[m,R,g,N]})}return t}}!function(t){t[t.VERTICES=0]="VERTICES",t[t.UVS=1]="UVS",t[t.NORMALS=2]="NORMALS",t[t.TANGENTS=3]="TANGENTS"}($||($={}));class ut extends class{toBuilder(){throw new Error("No builder defined.")}}{constructor(t){var r,e,a,n;super(),this.width=null!==(r=null==t?void 0:t.width)&&void 0!==r?r:1,this.height=null!==(e=null==t?void 0:t.height)&&void 0!==e?e:1,this.widthSegments=null!==(a=null==t?void 0:t.widthSegments)&&void 0!==a?a:1,this.heightSegments=null!==(n=null==t?void 0:t.heightSegments)&&void 0!==n?n:1}toBuilder(){const t=new st,{heightSegments:r,widthSegments:e,width:a,height:n}=this,s=a/2,i=n/2,o=Math.floor(e),l=Math.floor(r),c=o+1,u=l+1,h=a/o,E=n/l,y=[],f=[],A=[];for(let t=0;t<u;t++){const r=t*E-i;for(let e=0;e<c;e++){const a=e*h-s;f.push(a,-r,0),A.push(e/o),A.push(1-t/l)}}for(let t=0;t<l;t++)for(let r=0;r<o;r++){const e=r+c*t,a=r+c*(t+1),n=r+1+c*(t+1),s=r+1+c*t;y.push(e,a,s),y.push(a,n,s)}const{length:T}=y,_=[],d=[];for(let r=0;r<T;r+=3){const e=3*y[r],a=3*y[r+1],n=3*y[r+2],s=2*y[r],i=2*y[r+1],o=2*y[r+2];let l=_[e],c=_[a],u=_[n];null==l&&(l=t.addVertex([f[e],f[e+1],f[e+2]]),_[e]=l),null==c&&(c=t.addVertex([f[a],f[a+1],f[a+2]]),_[a]=c),null==u&&(u=t.addVertex([f[n],f[n+1],f[n+2]]),_[n]=u);let h=d[s],E=d[i],T=d[o];null==h&&(h=[A[s],A[s+1]],d[s]=h),null==E&&(E=[A[i],A[i+1]],d[i]=E),null==T&&(T=[A[o],A[o+1]],d[o]=T),t.addTriangleFace(l,c,u,{uv:[h,E,T]})}return t}}!function(t){t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED"}(J||(J={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(tt||(tt={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT"}(rt||(rt={})),function(t){t[t.R8=33321]="R8",t[t.R8UI=33330]="R8UI",t[t.R8I=33329]="R8I",t[t.R16UI=33332]="R16UI",t[t.R16I=33331]="R16I",t[t.R32UI=33334]="R32UI",t[t.R32I=33333]="R32I",t[t.RG8=33323]="RG8",t[t.RG8UI=33336]="RG8UI",t[t.RG8I=33335]="RG8I",t[t.RG16UI=33338]="RG16UI",t[t.RG16I=33337]="RG16I",t[t.RG32UI=33340]="RG32UI",t[t.RG32I=33339]="RG32I",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGBA4=32854]="RGBA4",t[t.RGB565=36194]="RGB565",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8"}(et||(et={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(at||(at={}));class ht{static createFramebuffer(t){const r=t.createFramebuffer();return null===r?null:{internalFramebuffer:r}}static createRenderbuffer(t,r){const e=t.createRenderbuffer();if(null===e)return null;t.bindRenderbuffer(t.RENDERBUFFER,e);const{samples:a,internalFormat:n,width:s,height:i}=r;return void 0!==a?t.renderbufferStorageMultisample(t.RENDERBUFFER,a,n,s,i):t.renderbufferStorage(t.RENDERBUFFER,n,s,i),t.bindRenderbuffer(t.RENDERBUFFER,null),{...r,internalRenderbuffer:e}}static attachTexture(t,r,...e){const{internalFramebuffer:a}=r;t.getParameter(t.FRAMEBUFFER_BINDING)!==a&&t.bindFramebuffer(t.FRAMEBUFFER,a);const n=e.map((e=>{const{attachment:a,textureTarget:n,texture:s}=e,{internalTexture:i}=s;return t.framebufferTexture2D(t.FRAMEBUFFER,a,n,i,0),{...e,...r}})),s=t.checkFramebufferStatus(t.FRAMEBUFFER);return s!==J.FRAMEBUFFER_COMPLETE&&console.warn(`Incomplete framebuffer status: ${J[s]}`),this.unbindFramebuffer(t),n}static drawBuffers(t,r,e){const{internalFramebuffer:a}=r;t.getParameter(t.FRAMEBUFFER_BINDING)!==a&&t.bindFramebuffer(t.FRAMEBUFFER,a),t.drawBuffers(e);const n=t.checkFramebufferStatus(t.FRAMEBUFFER);n!==J.FRAMEBUFFER_COMPLETE&&console.warn(`Incomplete framebuffer status: ${J[n]}`),this.unbindFramebuffer(t)}static attachRenderbuffer(t,r,...e){const{internalFramebuffer:a}=r;t.getParameter(t.FRAMEBUFFER_BINDING)!==a&&t.bindFramebuffer(t.FRAMEBUFFER,a);const n=e.map((e=>(t.framebufferRenderbuffer(t.FRAMEBUFFER,e.attachment,t.RENDERBUFFER,e.renderbuffer.internalRenderbuffer),{...e,...r}))),s=t.checkFramebufferStatus(t.FRAMEBUFFER);return s!==J.FRAMEBUFFER_COMPLETE&&console.warn(`Incomplete framebuffer status: ${J[s]}`),this.unbindFramebuffer(t),n}static blit(t,r,e,a,n,s,i){var o,l;if(t.getParameter(t.READ_FRAMEBUFFER_BINDING)!==r){const e=null!==(o=null==r?void 0:r.internalFramebuffer)&&void 0!==o?o:null;t.bindFramebuffer(t.READ_FRAMEBUFFER,e)}if(t.getParameter(t.DRAW_FRAMEBUFFER_BINDING)!==e){const r=null!==(l=null==e?void 0:e.internalFramebuffer)&&void 0!==l?l:null;t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}t.blitFramebuffer(a[0],a[1],a[2],a[3],n[0],n[1],n[2],n[3],s,i),this.unbindFramebuffer(t)}static readPixels(t,r,e,a,n,s,i,o){t.readPixels(r,e,a,n,s,i,o)}static bindFramebuffer(t,r){const{internalFramebuffer:e}=r;t.bindFramebuffer(t.FRAMEBUFFER,e)}static unbindFramebuffer(t){t.bindFramebuffer(t.FRAMEBUFFER,null)}static deleteFramebuffer(t,r){const{internalFramebuffer:e}=r;t.isFramebuffer(e)&&t.deleteFramebuffer(e)}static deleteRenderbuffer(t,r){const{internalRenderbuffer:e}=r;t.isRenderbuffer(e)&&t.deleteRenderbuffer(e)}}var Et,yt,ft,At,Tt,_t,dt,mt,Rt,gt,Nt,It,pt,Mt,St,Ct=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)};!function(t){t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ft||(ft={})),function(t){t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.R8=33321]="R8",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8=33323]="RG8",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8=32849]="RGB8",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGB565=36194]="RGB565",t[t.RGBA8=32856]="RGBA8",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.R16F=33325]="R16F",t[t.RGB16F=34843]="RGB16F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB8I=36239]="RGB8I",t[t.RGB8UI=36221]="RGB8UI",t[t.RGB16I=36233]="RGB16I",t[t.RGB16UI=36215]="RGB16UI",t[t.RGB32I=36227]="RGB32I",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI"}(At||(At={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV"}(Tt||(Tt={})),function(t){t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE"}(_t||(_t={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(dt||(dt={})),function(t){t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST"}(mt||(mt={})),function(t){t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Rt||(Rt={})),function(t){t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.NONE=0]="NONE"}(gt||(gt={})),function(t){t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Nt||(Nt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(It||(It={}));class Ot{static getTexturesUnitsEntries(){return Ct(this,Et,"f",yt).entries()}static createTexture(t,r,e){const a=t.createTexture();if(null===a)return null;let n=Ct(this,Et,"f",yt).get(r);null==n&&(n=Math.max(-1,...Ct(this,Et,"f",yt).values())+1,Ct(this,Et,"f",yt).set(r,n));const{pixels:s,target:i,subimages:o,width:l,height:c,format:u,internalFormat:h,type:E}=e;let{lod:y,border:f,depth:A,mipmap:T}=e;switch(y=null!=y?y:0,f=null!=f?f:0,A=null!=A?A:0,T=null==T||T,t.getParameter(t.ACTIVE_TEXTURE)!==n&&(t.activeTexture(t.TEXTURE0+n),t.bindTexture(i,a)),i){case dt.TEXTURE_2D:t.texImage2D(i,y,h,l,c,f,u,E,s),o&&o.forEach((r=>{const{xoffset:e,yoffset:a,width:n,height:s,pixels:o}=r;t.texSubImage2D(i,y,e,a,n,s,u,E,o)}));break;case dt.TEXTURE_CUBE_MAP:if(null===s)t.texImage2D(i,y,h,l,c,f,u,E,null);else if("xPos"in s){const{xPos:r,xNeg:e,yPos:a,yNeg:n,zPos:i,zNeg:o}=s;t.texImage2D(dt.TEXTURE_CUBE_MAP_POSITIVE_X,y,h,l,c,f,u,E,r),t.texImage2D(dt.TEXTURE_CUBE_MAP_NEGATIVE_X,y,h,l,c,f,u,E,e),t.texImage2D(dt.TEXTURE_CUBE_MAP_POSITIVE_Y,y,h,l,c,f,u,E,a),t.texImage2D(dt.TEXTURE_CUBE_MAP_NEGATIVE_Y,y,h,l,c,f,u,E,n),t.texImage2D(dt.TEXTURE_CUBE_MAP_POSITIVE_Z,y,h,l,c,f,u,E,i),t.texImage2D(dt.TEXTURE_CUBE_MAP_NEGATIVE_Z,y,h,l,c,f,u,E,o)}break;case dt.TEXTURE_2D_ARRAY:t.texImage3D(i,y,h,l,c,A,f,u,E,s),o&&o.forEach(((r,e)=>{const{xoffset:a,yoffset:n,zoffset:s,width:o,height:l,depth:c,pixels:h}=r;t.texSubImage3D(i,y,a,n,s,o,l,c,u,E,h)}))}T&&t.generateMipmap(i);const{min:_,mag:d,wrapS:m,wrapT:R,wrapR:g,baseMipmapLevel:N,maxMipmapLevel:I,compareFunction:p,compareMode:M,minLod:S,maxLod:C}=e;return void 0!==_&&t.texParameteri(i,_t.TEXTURE_MIN_FILTER,_),void 0!==d&&t.texParameteri(i,_t.TEXTURE_MAG_FILTER,d),void 0!==m&&t.texParameteri(i,_t.TEXTURE_WRAP_S,m),void 0!==R&&t.texParameteri(i,_t.TEXTURE_WRAP_T,R),void 0!==g&&t.texParameteri(i,_t.TEXTURE_WRAP_R,g),void 0!==N&&t.texParameteri(i,_t.TEXTURE_BASE_LEVEL,N),void 0!==I&&t.texParameteri(i,_t.TEXTURE_MAX_LEVEL,I),void 0!==p&&t.texParameteri(i,_t.TEXTURE_COMPARE_FUNC,p),void 0!==M&&t.texParameteri(i,_t.TEXTURE_COMPARE_MODE,M),void 0!==S&&t.texParameterf(i,_t.TEXTURE_MIN_LOD,S),void 0!==C&&t.texParameterf(i,_t.TEXTURE_MAX_LOD,C),{unit:n,internalTexture:a,name:r,properties:{pixels:s,target:i,subimages:o,lod:y,width:l,height:c,format:u,internalFormat:h,type:E,min:_,mag:d,wrapS:m,wrapT:R,wrapR:g,baseMipmapLevel:N,maxMipmapLevel:I,compareFunction:p,compareMode:M,minLod:S,maxLod:C}}}static setUnpackAlignment(t,r){t.pixelStorei(t.UNPACK_ALIGNMENT,r)}static deleteTexture(t,r){const{internalTexture:e,name:a}=r;t.isTexture(e)&&(t.deleteTexture(e),Ct(this,Et,"f",yt).delete(a))}}Et=Ot,yt={value:new Map},function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(pt||(pt={}));class wt{static createShader(t,r,e){const a=t.createShader(r);if(null===a)return null;if(t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS))return{type:r,internalShader:a,source:e};const n=t.getShaderInfoLog(a);return null!==n&&console.warn(n),t.deleteShader(a),null}static createProgram(t,r){const{vertexSource:e,fragmentSource:a}=r,n=this.createShader(t,pt.VERTEX_SHADER,e);if(null===n)return null;const s=this.createShader(t,pt.FRAGMENT_SHADER,a);if(null===s)return null;const i=t.createProgram();if(null===i)return null;const o={internalProgram:i,vertexShader:n,fragmentShader:s};if(t.attachShader(i,n.internalShader),t.attachShader(i,s.internalShader),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return o;const l=t.getProgramInfoLog(i);if(null!==l){const r=t.getShaderInfoLog(n.internalShader),e=t.getShaderInfoLog(s.internalShader);console.warn(l),console.warn(r),console.warn(e)}return this.deleteProgram(t,o),null}static recompileProgram(t,r,e){const{internalProgram:a,vertexShader:n,fragmentShader:s}=r;let{vertexSource:i,fragmentSource:o}=e;if("string"==typeof i){const{internalShader:r}=n;t.shaderSource(r,i),t.compileShader(r),n.source=i}if("string"==typeof o){const{internalShader:r}=s;t.shaderSource(r,o),t.compileShader(r),s.source=o}if(t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS))return r;const l=t.getProgramInfoLog(a);if(null!==l){const r=t.getShaderInfoLog(n.internalShader),e=t.getShaderInfoLog(s.internalShader);console.warn(l),console.warn(r),console.warn(e)}return r}static deleteProgram(t,r){const{vertexShader:e,fragmentShader:a,internalProgram:n}=r;t.deleteShader(e.internalShader),t.deleteShader(a.internalShader),t.deleteProgram(n)}static useProgram(t,r){const{internalProgram:e}=r;t.getParameter(t.CURRENT_PROGRAM)!==e&&t.useProgram(e)}}!function(t){t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW"}(Mt||(Mt={})),function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"}(St||(St={}));class Pt{static asArrayBufferView(t){return"object"==typeof t?"buffer"in t?t:"unit"in t?Float32Array.of(t.unit):Float32Array.from(t):Float32Array.of(t)}static getUniformSetter(t,r,e,a){const{value:n,srcOffset:s,srcLength:i}=r;let{transpose:o=!1}=r;switch(a){case Mt.FLOAT:if("number"==typeof n)return{type:a,set:r=>{t.uniform1f(e,r)}};break;case Mt.UNSIGNED_INT:if("number"==typeof n)return{type:a,set:r=>{t.uniform1ui(e,r)}};break;case Mt.BOOL:case Mt.INT:if("number"==typeof n)return{type:a,set:r=>{t.uniform1i(e,r)}};break;case Mt.INT_SAMPLER_2D:case Mt.INT_SAMPLER_2D_ARRAY:case Mt.INT_SAMPLER_3D:case Mt.INT_SAMPLER_CUBE:case Mt.SAMPLER_2D:case Mt.SAMPLER_3D:case Mt.SAMPLER_CUBE:case Mt.SAMPLER_2D_SHADOW:case Mt.SAMPLER_2D_ARRAY:case Mt.SAMPLER_2D_ARRAY_SHADOW:case Mt.SAMPLER_CUBE_SHADOW:case Mt.UNSIGNED_INT_SAMPLER_2D:case Mt.UNSIGNED_INT_SAMPLER_3D:case Mt.UNSIGNED_INT_SAMPLER_CUBE:case Mt.UNSIGNED_INT_SAMPLER_2D_ARRAY:if("object"==typeof n&&"unit"in n)return{type:a,set:r=>{const{unit:a}=r;t.uniform1i(e,a)}};break;case Mt.FLOAT_VEC2:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform2fv(e,r,s,i)}};break;case Mt.BOOL_VEC2:case Mt.INT_VEC2:if(n instanceof Int32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform2iv(e,r)}};break;case Mt.UNSIGNED_INT_VEC2:if(n instanceof Uint32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform2uiv(e,r,s,i)}};break;case Mt.FLOAT_VEC3:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform3fv(e,r,s,i)}};break;case Mt.BOOL_VEC3:case Mt.INT_VEC3:if(n instanceof Int32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform3iv(e,r,s,i)}};break;case Mt.UNSIGNED_INT_VEC3:if(n instanceof Uint32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform3uiv(e,r,s,i)}};break;case Mt.FLOAT_VEC4:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform4fv(e,r,s,i)}};break;case Mt.BOOL_VEC4:case Mt.INT_VEC4:if(n instanceof Int32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform4iv(e,r,s,i)}};break;case Mt.UNSIGNED_INT_VEC4:if(n instanceof Uint32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform4uiv(e,r,s,i)}};break;case Mt.FLOAT_MAT2:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix2fv(e,o,r,s,i)}};break;case Mt.FLOAT_MAT3:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix3fv(e,o,r,s,i)}};break;case Mt.FLOAT_MAT4:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix4fv(e,o,r)}};break;case Mt.FLOAT_MAT2x3:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix2x3fv(e,o,r,s,i)}};break;case Mt.FLOAT_MAT2x4:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix2x4fv(e,o,r,s,i)}};break;case Mt.FLOAT_MAT3x2:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix3x2fv(e,o,r,s,i)}};break;case Mt.FLOAT_MAT3x4:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix3x4fv(e,o,r,s,i)}};break;case Mt.FLOAT_MAT4x2:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix4x2fv(e,o,r,s,i)}};break;case Mt.FLOAT_MAT4x3:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix4x3fv(e,o,r,s,i)}}}return null}static getUniformsListSetter(t,r,e){const{internalProgram:a}=r,n=Object.keys(e);let s=t.getUniformIndices(a,n);if(null===s)return console.error("No uniform indices found."),null;const i=t.getProgramParameter(a,t.ACTIVE_UNIFORMS),o=Array.from(s).filter(((t,r)=>{const e=t>=0&&t<i;return e||console.warn(`Uniform ${n[r]} could not be located.`),e})),l={};return o.map((r=>t.getActiveUniform(a,r))).forEach((({name:r,type:n})=>{const s=e[r],i=t.getUniformLocation(a,r);if(null===i)return console.warn(`Uniform ${r} could not be located.`),null;const o=this.getUniformSetter(t,s,i,n);o&&(l[r]=o)})),{setters:l,program:r}}static setUniformsListValues(t,r,e){const{program:a,setters:n}=r;wt.useProgram(t,a),Object.entries(e).forEach((([t,r])=>{if(t in n){const e=n[t],{value:a}=r;e.set(a)}else console.error(`Uniform ${t} does not match any of the given setters.`)}))}}var vt,Lt;class Ut{static getBindingPointsEntries(){return function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)}(this,vt,"f",Lt).entries()}static createUniformBlock(t,r,e){const{internalProgram:a}=r,n=t.getUniformBlockIndex(a,e);if(n===t.INVALID_INDEX)return console.error(`Block '${e}' does not identify a valid uniform block.`),null;const s=t.getActiveUniformBlockParameter(a,n,t.UNIFORM_BLOCK_DATA_SIZE),i={},o=t.getActiveUniformBlockParameter(a,n,t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES);return t.getActiveUniforms(a,o,t.UNIFORM_OFFSET).forEach(((r,e)=>{const n=o[e],s=t.getActiveUniform(a,n);if(null!==s){const{name:t}=s;i[t]={byteOffset:r}}})),{name:e,blockIndex:n,blockSize:s,layout:i,program:r}}static createUniformBuffer(t,r,e,a){const n=t.createBuffer();if(null===n)return null;const s=t.UNIFORM_BUFFER;t.bindBuffer(s,n),a=null!=a?a:V.STATIC_READ;const i=(e=null!=e&&e)?this.lastBindingPoint++:void 0;return t.bufferData(s,r,a),{internalBuffer:n,byteLength:r,bindingPoint:i,target:s,usage:a}}static createRangedUniformBuffers(t,r,e,a){const n=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT),s=r.reduce(((t,r)=>t+Math.max(Math.ceil(r.blockSize/n),1)*n),0),i=this.createUniformBuffer(t,s,!1,a);if(null===i)return null;e=null!=e&&e;let o=0;return r.map((t=>{const{blockSize:r}=t,a=e?this.lastBindingPoint++:void 0,s={...i,bindingPoint:a,rangeOffset:o,rangeSize:r};return o+=Math.max(Math.ceil(r/n),1)*n,s}))}static setUniformBufferValues(t,r,e,a){const{internalBuffer:n,target:s}=e;t.getParameter(t.UNIFORM_BUFFER_BINDING)!==n&&t.bindBuffer(s,n);const{layout:i,name:o}=r,{rangeOffset:l}=e;Object.entries(a).forEach((([r,e])=>{const{value:a}=e;r in i||console.warn(`${r} does not exist in block ${o}.`);const{byteOffset:n}=i[r];t.bufferSubData(s,n+(null!=l?l:0),Pt.asArrayBufferView(a))}))}static setUniformBufferData(t,r,e,a,n,s){const{internalBuffer:i,target:o}=r;let{rangeOffset:l}=r;t.bindBuffer(o,i);const c=(null!=l?l:0)+(null!=a?a:0);e instanceof ArrayBuffer?t.bufferSubData(o,c,e):(n=null!=n?n:0,t.bufferSubData(o,c,e,n,s))}static bindUniformBuffer(t,r,e){const{internalBuffer:a,target:n}=e;let{rangeOffset:s,rangeSize:i}=e;const{bindingPoint:o}=e,{program:l,blockIndex:c}=r,{internalProgram:u}=l;void 0!==o&&(r.buffer=e,t.uniformBlockBinding(u,c,o),void 0!==o&&(void 0!==s&&void 0!==i?t.bindBufferRange(n,o,a,s,i):t.bindBufferBase(n,o,a)))}}vt=Ut,Lt={value:new Map},Ut.lastBindingPoint=0;var Bt,bt,Ft,xt,Dt,Gt,Vt,Ht,kt,Xt,Yt,zt,Wt,jt=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)};class qt{static createTextures(t,r){const e={};return Object.entries(r).forEach((([r,a])=>{const n=Ot.createTexture(t,r,a);null!==n&&(e[r]=n)})),e}static createPacket(t,r){var e;const{program:a,vertexArray:n,uniforms:s,uniformBlocks:i,uniformBuffers:o}=r,{drawCommand:l}=r;let c=null;if(c="internalProgram"in a?a:wt.createProgram(t,a),null===c)return null;let u,h=null;if(h=j.createVertexArray(t,c,n),null===h)return null;if(void 0!==s){if(u=Pt.getUniformsListSetter(t,c,s),null===u)return null;Pt.setUniformsListValues(t,u,s)}let E={};const y=i?Object.entries(i):[],f=(null!==(e=null==o?void 0:o.length)&&void 0!==e?e:0)-1;return y.forEach((([t,r])=>{const{buffer:e}=r;void 0!==e&&e>f&&console.error(`Uniform buffer with index ${e} does not exist.`)})),o&&o.forEach(((r,e)=>{const a=y.filter((([t,r])=>r.buffer===e)),n=a.map((([r,e])=>Ut.createUniformBlock(t,c,r))),{length:s}=n;if("internalBuffer"in r)n.forEach((e=>{const{name:a}=e;Ut.bindUniformBuffer(t,e,r),E[a]=e}));else if(s>0){const{usage:e,data:i}=r;if(s>1){const r=Ut.createRangedUniformBuffers(t,n,!0,e);i&&Ut.setUniformBufferData(t,r[0],i),n.forEach(((e,n)=>{const{name:s}=e,i=r[n];Ut.bindUniformBuffer(t,e,i);const{uniforms:o}=a[n][1];o&&Ut.setUniformBufferValues(t,e,i,o),E[s]=e}))}else{const r=n[0],{blockSize:s,name:o}=r,l=Ut.createUniformBuffer(t,s,!0,e);if(null===l)return null;i&&Ut.setUniformBufferData(t,l,i),Ut.bindUniformBuffer(t,r,l);const{uniforms:c}=a[0][1];c&&Ut.setUniformBufferValues(t,r,l,c),E[o]=r}}})),y.filter((([t,r])=>void 0===r.buffer)).forEach((([r,e])=>{const{uniforms:a}=e,n=Ut.createUniformBlock(t,c,r);if(null===n)return null;const{blockSize:s}=n,i=Ut.createUniformBuffer(t,s,!0);if(null===i)return null;Ut.bindUniformBuffer(t,n,i),void 0!==a&&Ut.setUniformBufferValues(t,n,i,a),E[r]=n})),{program:c,vertexArray:h,uniforms:u,uniformBlocks:E,drawCommand:l}}static setPacketValues(t,r,e){const{vertexArray:a,uniforms:n,uniformBlocks:s}=e,{vertexArray:i,uniforms:o,uniformBlocks:l}=r;void 0!==a&&j.setVertexArrayValues(t,i,a),void 0!==o&&void 0!==n&&Pt.setUniformsListValues(t,o,n),void 0!==l&&void 0!==s&&(s?Object.entries(s):[]).forEach((([r,e])=>{const{uniforms:a}=e,n=l[r],{buffer:s}=n;s&&Ut.setUniformBufferValues(t,n,s,a)}))}static enableMultidrawExtension(t){!function(t,r,e,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof r?t!==r||!n:!r.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===a?n.call(t,e):n?n.value=e:r.set(t,e)}(this,Bt,t.getExtension("WEBGL_multi_draw"),"f",bt)}static drawPacket(t,r,e=r.drawCommand){const{vertexArray:a}=r,{program:n,internalVertexArray:s,elementBuffer:i}=a,{mode:o,elementsCount:l,instanceCount:c,multiDraw:u}=e;if(wt.useProgram(t,n),t.getParameter(t.VERTEX_ARRAY_BINDING)!==s&&t.bindVertexArray(s),i){const{indexType:r}=i;if(void 0!==c&&void 0!==l)t.drawElementsInstanced(o,l,r,0,c);else if(u){const t=jt(this,Bt,"f",bt),{countsList:e,countsOffset:a,offsetsList:n,offsetsOffset:s,drawCount:i,instanceCountsList:l,instanceCountsOffset:c}=u;void 0!==l&&void 0!==c?t.multiDrawElementsInstancedWEBGL(o,e,a,r,n,s,l,c,i):t.multiDrawElementsWEBGL(o,e,a,r,n,s,i)}else void 0!==l&&t.drawElements(o,l,r,0)}else if(void 0!==c&&void 0!==l)t.drawArraysInstanced(o,0,l,c);else if(u){const t=jt(this,Bt,"f",bt),{countsList:r,countsOffset:e,firstsList:a,firstsOffset:n,drawCount:s,instanceCountsList:i,instanceCountsOffset:l}=u;void 0!==i&&void 0!==l?t.multiDrawArraysInstancedWEBGL(o,a,n,r,e,i,l,s):t.multiDrawArraysWEBGL(o,a,n,r,e,s)}else void 0!==l&&t.drawArrays(o,0,l)}}Bt=qt,bt={value:null},function(t){t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Ft||(Ft={})),function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"}(xt||(xt={})),function(t){t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Dt||(Dt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Gt||(Gt={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Vt||(Vt={})),function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX"}(Ht||(Ht={})),function(t){t[t.BLEND=3042]="BLEND",t[t.CULL_FACE=2884]="CULL_FACE",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD"}(kt||(kt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Xt||(Xt={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(Yt||(Yt={})),function(t){t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT"}(zt||(zt={})),function(t){t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST"}(Wt||(Wt={}));class Kt{static hint(t,r,e){t.hint(r,e)}static frontFace(t,r){t.frontFace(r)}static scissor(t,r,e,a,n){t.scissor(r,e,a,n)}static viewport(t,r,e,a,n){t.viewport(r,e,a,n)}static clearColor(t,r){t.clearColor(r[0],r[1],r[2],r[3])}static depthFunction(t,r){t.depthFunc(r)}static blendEquation(t,r){t.blendEquation(r)}static blendFunction(t,r,e){t.blendFunc(r,e)}static blendFunctionSeparate(t,r,e,a,n){t.blendFuncSeparate(r,e,a,n)}static stencilFunction(t,r,e,a,n){t.stencilFuncSeparate(n,r,e,a)}static stencilOperations(t,r,e,a,n){t.stencilOpSeparate(n,r,e,a)}static stencilMask(t,r,e){t.stencilMaskSeparate(e,r)}static colorMask(t,r,e,a,n){t.colorMask(r,e,a,n)}static depthMask(t,r){t.depthMask(r)}static enable(t,r){t.enable(r)}static disable(t,r){t.disable(r)}static clear(t,r){t.clear(r)}static getViewport(t){return t.getParameter(t.VIEWPORT)}static getMaxSamples(t){return t.getParameter(t.MAX_SAMPLES)}static drawBuffers(t,r){t.drawBuffers(r)}static clearBuffers(t,r,e,a,n){a instanceof Float32Array?t.clearBufferfv(r,e,a,n):a instanceof Int32Array?t.clearBufferiv(r,e,a,n):a instanceof Uint32Array&&t.clearBufferuiv(r,e,a,n)}}class Zt{constructor(t,r,e,a){this.array=void 0!==a?new Float32Array([null!=t?t:0,null!=r?r:0,null!=e?e:0,a]):new Float32Array([null!=t?t:0,null!=r?r:0,null!=e?e:0])}static rgb(t,r,e){return new Qt(t,r,e)}static rgba(t,r,e,a){if(t instanceof Qt){const{r:e,g:a,b:n}=t;return new Qt(e,a,n,void 0!==r?r:1)}return new Qt(t,r,e,a)}static array(...t){const r=new Array(4*t.length);let e,a=0;for(const n of t)e=n.array,r[a+0]=e[0],r[a+1]=e[1],r[a+2]=e[2],a+=3;return r}get length(){return 3}get r(){return this.array[0]}set r(t){this.array[0]=t}get g(){return this.array[1]}set g(t){this.array[1]=t}get b(){return this.array[2]}set b(t){this.array[2]=t}get a(){return this.array[3]}set a(t){this.array[3]=t}get 0(){return this.array[0]}set 0(t){this.array[0]=t}get 1(){return this.array[1]}set 1(t){this.array[1]=t}get 2(){return this.array[2]}set 2(t){this.array[2]=t}get 3(){return this.array[3]}set 3(t){this.array[3]=t}setValues(t,r,e){const{array:a}=this;return a[0]=t,a[1]=r,a[2]=e,this}getValues(){const{array:t}=this;return[t[0],t[1],t[2]]}copy(t){const{array:r}=this,{r:e,g:a,b:n}=t;return r[0]=e,r[1]=a,r[2]=n,this}clone(){return(new Zt).copy(this)}static lerp(t,r,e){return t.lerp(r,e)}lerp(t,r){const{array:e}=this,{r:a,g:n,b:s}=t;return e[0]=r*(a-e[0]),e[1]=r*(n-e[1]),e[2]=r*(s-e[2]),this}normalize(){const{array:t}=this;return t[0]/=255,t[1]/=255,t[2]/=255,this}[Symbol.iterator](){const{array:t}=this,{length:r}=t;let e=0;return{next:()=>e<r?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}Zt.BLACK=new Zt(0,0,0),Zt.RED=new Zt(1,0,0),Zt.YELLOW=new Zt(1,1,0),Zt.GREEN=new Zt(0,1,0),Zt.BLUE=new Zt(0,0,1),Zt.WHITE=new Zt(1,1,1);const Qt=Zt;async function $t(){const t=document.createElement("template");t.innerHTML='\n\x3c!--<link rel="stylesheet" href="./css/main.css"/>--\x3e\n  <div class="flex-auto flex-cols">\n    <main class="flex-rows flex-auto">\n        <section class="centered padded">\n          <div id="ui" class="flex-cols">\n            <button id="playpause">Pause</button>\n            <div class="flex-none">\n              FPS: <span id="canvas-fps">-.-</span>\n            </div>\n          </div>\n          <div id="widgets"></div>\n          <canvas id="canvas" tabindex="0" oncontextmenu="return false;"></canvas>\n          \x3c!--<style>\n            circle:hover {\n              fill: rgb(255, 0, 0);\n            }\n          </style>\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">\n            <circle cx="10" cy="10" r="4"/>\n          </svg>\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="200" height="200" id="save" fill="none">\n            <g>\n              <rect x="0" y="0" width="100" height="100" fill="red"></rect>\n              <text text-anchor="middle" alignment-baseline="middle" x="50" y="50" font-family="Verdana" fill="blue">Hello,World!</text>\n            </g>\n          </svg>--\x3e\n        </section>\n    </main>\n  </div>',document.body.insertBefore(t.content,document.body.firstChild);try{!async function(){let t,r=0,e=!1;const a=document.getElementById("playpause");null!==a&&(a.onclick=()=>{e=!e,a.textContent=e?"Play":"Pause",e||requestAnimationFrame(t)});const n=document.getElementById("canvas-fps");if(!n)return;const i=document.getElementById("canvas");if(!i)return;i.width=900,i.height=600,i.style.width="900px",i.style.height="600px";const u=i.getContext("webgl2");if(!u)return;Ot.setUnpackAlignment(u,1);const h=await fetch("assets/engine/shaders/common/phong.vert.glsl").then((t=>t.text())),y=await fetch("assets/engine/shaders/common/phong.frag.glsl").then((t=>t.text())),f=wt.createProgram(u,{vertexSource:h,fragmentSource:y});if(null===f)return;const A=await fetch("assets/engine/shaders/common/skybox.vert").then((t=>t.text())),g=await fetch("assets/engine/shaders/common/skybox.frag").then((t=>t.text())),N=wt.createProgram(u,{vertexSource:A,fragmentSource:g});if(null===N)return;const I=await fetch("assets/engine/shaders/common/texture.vert").then((t=>t.text())),p=await fetch("assets/engine/shaders/common/texture.frag").then((t=>t.text())),M=wt.createProgram(u,{vertexSource:I,fragmentSource:p});if(null===M)return;const S=await fetch("assets/engine/shaders/common/basic.vert.glsl").then((t=>t.text())),C=await fetch("assets/engine/shaders/common/basic.frag.glsl").then((t=>t.text())),O=wt.createProgram(u,{vertexSource:S,fragmentSource:C});if(null===O)return;const P=await fetch("assets/engine/shaders/common/depth.vert.glsl").then((t=>t.text())),L=await fetch("assets/engine/shaders/common/depth.frag.glsl").then((t=>t.text())),B=wt.createProgram(u,{vertexSource:P,fragmentSource:L});if(null===B)return;const F=await fetch("assets/engine/shaders/common/lines.vert.glsl").then((t=>t.text())),x=await fetch("assets/engine/shaders/common/lines.frag.glsl").then((t=>t.text())),D=wt.createProgram(u,{vertexSource:F,fragmentSource:x});if(null===D)return;async function G(t){return fetch(t).then((r=>{if(r.ok)return new Promise((r=>{const e=new Image;e.onload=()=>{r(e)},e.src=t}));throw new Error(`Image '${t}' not found.`)}))}const H=await G("assets/engine/img/NormalMap.png"),z=await G("assets/engine/img/brickwall.jpg"),q=await G("assets/engine/img/NormalMap_0.png"),Z=await G("assets/engine/img/Normal_Map_1024.png"),Q=await G("assets/engine/img/DisplacementMap.png"),$=await G("assets/engine/img/skybox_x_pos.png"),J=await G("assets/engine/img/skybox_x_neg.png"),at=await G("assets/engine/img/skybox_y_pos.png"),nt=await G("assets/engine/img/skybox_y_neg.png"),st=await G("assets/engine/img/skybox_z_pos.png"),it=await G("assets/engine/img/skybox_z_neg.png"),ot=await G("assets/engine/img/colors.png"),lt=function(t){const r=document.createElement("canvas"),{width:e,height:a}=t,n=e+2,s=a+2;r.width=n,r.height=s;const i=r.getContext("2d");return i.drawImage(t,0,0,n,s),i.drawImage(t,1,1,e,a),{width:e,height:a,paddedWidth:n,paddedHeight:s,data:i.getImageData(0,0,n,s)}},Et=lt(z),yt=lt(H),_t=lt(Z),gt=lt(ot),It=qt.createTextures(u,{albedoMap:{pixels:null,width:8,height:8,depth:2,target:dt.TEXTURE_2D_ARRAY,type:Tt.UNSIGNED_BYTE,format:ft.LUMINANCE,internalFormat:At.LUMINANCE,min:Rt.NEAREST,mag:mt.NEAREST,subimages:[{pixels:new Uint8Array([255,204,255,204,255,204,255,204,204,255,204,255,204,255,204,255,255,204,255,204,255,204,255,204,204,255,204,255,204,255,204,255,255,204,255,204,255,204,255,204,204,255,204,255,204,255,204,255,255,204,255,204,255,204,255,204,204,255,204,255,204,255,204,255]),xoffset:0,yoffset:0,zoffset:0,width:8,height:8,depth:1},{pixels:new Uint8Array([204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204]),xoffset:0,yoffset:0,zoffset:1,width:8,height:8,depth:1}]},albedoMaps:{pixels:null,width:Et.paddedWidth,height:Et.paddedHeight,depth:4,target:dt.TEXTURE_2D_ARRAY,type:Tt.UNSIGNED_BYTE,format:ft.RGB,internalFormat:At.RGB,subimages:[{pixels:Et.data,xoffset:0,yoffset:0,zoffset:0,width:Et.paddedWidth,height:Et.paddedHeight,depth:1},{pixels:yt.data,xoffset:0,yoffset:0,zoffset:1,width:yt.paddedWidth,height:yt.paddedHeight,depth:1},{pixels:_t.data,xoffset:0,yoffset:0,zoffset:2,width:_t.paddedWidth,height:_t.paddedHeight,depth:1},{pixels:gt.data,xoffset:0,yoffset:0,zoffset:3,width:gt.paddedWidth,height:gt.paddedHeight,depth:1}],min:Rt.LINEAR,mag:mt.LINEAR},normalMap:{pixels:q,width:q.width,height:q.height,target:dt.TEXTURE_2D,type:Tt.UNSIGNED_BYTE,format:ft.RGB,internalFormat:At.RGB,min:Rt.LINEAR_MIPMAP_LINEAR,mag:mt.LINEAR},displacementMap:{pixels:Q,width:Q.width,height:Q.height,target:dt.TEXTURE_2D,type:Tt.UNSIGNED_BYTE,format:ft.RGBA,internalFormat:At.RGBA},skybox:{pixels:{xPos:$,xNeg:J,yPos:at,yNeg:nt,zPos:st,zNeg:it},width:$.width,height:$.height,target:dt.TEXTURE_CUBE_MAP,type:Tt.UNSIGNED_BYTE,format:ft.RGBA,internalFormat:At.RGBA},fbColorTex:{width:i.width,height:i.height,pixels:null,target:dt.TEXTURE_2D,type:Tt.UNSIGNED_BYTE,format:ft.RGBA,internalFormat:At.RGBA,mag:mt.LINEAR,min:Rt.LINEAR,wrapS:Nt.CLAMP_TO_EDGE,wrapT:Nt.CLAMP_TO_EDGE,wrapR:Nt.CLAMP_TO_EDGE},depthTex:{width:i.width,height:i.height,pixels:null,target:dt.TEXTURE_2D,type:Tt.UNSIGNED_INT,format:ft.DEPTH_COMPONENT,internalFormat:At.DEPTH_COMPONENT24,wrapS:Nt.CLAMP_TO_EDGE,wrapT:Nt.CLAMP_TO_EDGE,wrapR:Nt.CLAMP_TO_EDGE,mag:mt.NEAREST,min:Rt.NEAREST}}),{albedoMap:pt,albedoMaps:Mt,normalMap:St,displacementMap:Ct,skybox:Pt,fbColorTex:vt,depthTex:Lt}=It,Bt=[Mt],bt=u.getExtension("EXT_texture_filter_anisotropic");if(bt){console.log("Extension EXT_texture_filter_anisotropic activated.");const t=u.getParameter(bt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);Bt.forEach((r=>{const{properties:e,internalTexture:a}=r,{target:n}=e;u.bindTexture(n,a),u.texParameterf(n,bt.TEXTURE_MAX_ANISOTROPY_EXT,t)}))}const Ft=new ct({height:4,width:4,depth:4,heightSegments:32,widthSegments:32,depthSegments:32}),Dt=new ut({height:2,width:2}).toBuilder(),Ht=new b;Ht.setScaling(new l([1,1,1]));const Xt=1/3*Math.PI,Yt=u.canvas.width/u.canvas.height,zt=new class extends class extends class{constructor(){this.transform=new b(this)}}{constructor(t){super(),this.uuid=U.newUUID(),this.projection=t||new v,this.frustum=(new W).setFromMatrix(this.viewProjection)}getFront(t){return this.transform.getBackward(t)}get view(){return this.transform.matrix.clone().invert()}get viewProjection(){return this.projection.clone().mult(this.view)}isViewing(t){return!0}updateFrustum(){this.frustum.setFromMatrix(this.viewProjection)}}{constructor(t,r,e,a){super(v.perspective(t,r,e,a))}setValues(t,r,e,a){return this.projection.setPerspective(t,r,e,a),this.updateFrustum(),this}}(Xt,Yt,.1,100);zt.transform.setTranslation(new l([0,8,8])),zt.transform.lookAt(new l([0,0,0]),c.up);const Wt=new b;Wt.setTranslation(new l([0,2,2])),Wt.setScaling(new l([.2,.2,.2])),zt.transform.setTranslation(Wt.getTranslation(new l).scale(2)),zt.transform.lookAt(new l([0,0,0]),c.up);const jt=zt.projection.clone().mult(v.identity().setRotation(zt.view.getRotation())).invert(),Zt=Ft.toBuilder(),$t=Zt.verticesArray(),Jt=Zt.trianglesIndicesArray(),tr=Zt.normalsArray(),rr=Zt.uvsArray(),er=Zt.tangentsArray(),ar=Zt.verticesArray(),nr=new K({a_position:{array:$t,type:Y.VEC3},a_tangent:{array:er,type:Y.VEC3},a_normal:{array:tr,type:Y.VEC3},a_uv:{array:rr,type:Y.VEC2}},Jt,!1),sr=nr.getAttribute("a_position"),ir=(nr.indices,nr.getAttribute("a_normal")),or=nr.getAttribute("a_uv"),lr=nr.getAttribute("a_tangent"),cr=nr.getAttribute("a_normal"),ur={program:f,vertexArray:{vertexBuffers:[{interleaved:!1},{usage:V.DYNAMIC_READ}],vertexAttributes:{a_position:{buffer:0,type:Y.VEC3,componentType:X.FLOAT,byteLength:ir.array.byteLength},a_tangent:{buffer:0,type:Y.VEC3,componentType:X.FLOAT,byteLength:lr.array.byteLength},a_normal:{...ir,buffer:0},a_uv:{...or,buffer:0},a_color:{buffer:1,type:Y.VEC3,componentType:X.FLOAT,byteLength:cr.array.byteLength}},elementIndices:nr.indices},uniformBuffers:[{usage:V.DYNAMIC_READ},{usage:V.DYNAMIC_READ}],uniformBlocks:{subTexture:{uniforms:{u_xOffset:{value:1/Et.paddedWidth},u_yOffset:{value:1/Et.paddedHeight},u_zOffset:{value:1},u_xScaling:{value:yt.width/Et.paddedWidth},u_yScaling:{value:yt.height/Et.paddedHeight}}},viewBlock:{buffer:0},modelBlock:{buffer:0},lightsBlock:{buffer:0},phongBlock:{buffer:1}},uniforms:{u_albedoMap:{value:pt},u_normalMap:{value:St},u_displacementMap:{value:Ct},u_albedoMaps:{value:Mt}},drawCommand:{mode:k.TRIANGLES,elementsCount:nr.indices.length}},hr={program:f,uniformBlocks:{viewBlock:{uniforms:{u_view:{value:zt.view.array},u_projection:{value:zt.projection.array}}},modelBlock:{uniforms:{"models[0].u_model":{value:Ht.matrix.array},"models[0].u_modelView":{value:zt.view.mult(Ht.matrix).array},"models[0].u_normal":{value:zt.view.mult(Ht.matrix).invert().transpose().array}}},lightsBlock:{uniforms:{"lights[0].u_lightWorldPos":{value:Array.from(Wt.getTranslation(new l))},"lights[0].u_lightDirection":{value:Array.from(Wt.getBackward(new l))},"lights[0].u_cutOff":{value:2/360*Math.PI},"lights[0].u_lightColor":{value:Array.from(Qt.RED)}}},phongBlock:{uniforms:{"phong.u_ambientColor":{value:[.1,.1,.1]},"phong.u_diffuseColor":{value:[.8,0,0]},"phong.u_specularColor":{value:[1,1,1]},"phong.u_ambientFactor":{value:8e-4},"phong.u_diffuseFactor":{value:1},"phong.u_specularFactor":{value:1},"phong.u_shininess":{value:36},"phong.u_constant":{value:1},"phong.u_linear":{value:.09},"phong.u_quadratic":{value:.032}}}}};let Er=qt.createPacket(u,ur);j.setVertexArrayBufferData(u,Er.vertexArray.verticesBuffers[1],cr.array),j.setVertexArrayBufferData(u,Er.vertexArray.verticesBuffers[0],new Uint8Array(nr.buffer)),j.setVertexArrayValues(u,Er.vertexArray,{attributes:{a_position:{array:sr.array}}}),Ut.setUniformBufferData(u,Er.uniformBlocks.phongBlock.buffer,Qt.lerp(Qt.WHITE,Qt.GREEN,.5).array,Er.uniformBlocks.phongBlock.layout["phong.u_ambientColor"].byteOffset);const yr={program:D,vertexArray:{vertexAttributes:{a_position:{array:ar,type:Y.VEC3}}},uniformBuffers:[Er.uniformBlocks.modelBlock.buffer,Er.uniformBlocks.viewBlock.buffer],uniformBlocks:{modelBlock:{buffer:0},viewBlock:{buffer:1}},uniforms:{u_color:{value:new Float32Array([1,0,0])}},drawCommand:{mode:k.LINES,elementsCount:ar.length/2}},fr={program:O,vertexArray:{vertexBuffers:[Er.vertexArray.verticesBuffers[0]],elementBuffer:Er.vertexArray.elementBuffer},uniformBuffers:[Er.uniformBlocks.viewBlock.buffer],uniformBlocks:{basicModelBlock:{uniforms:{u_model:{value:Wt.matrix.array},u_color:{value:[1,1,0]}}},viewBlock:{buffer:0}},drawCommand:{mode:k.TRIANGLES,elementsCount:Er.drawCommand.elementsCount}},Ar=Dt.trianglesIndicesArray(),Tr=Dt.verticesArray(),_r=Dt.uvsArray(),dr=(new v).setIdentity(),mr={program:N,vertexArray:{vertexAttributes:{a_position:{array:Tr,type:Y.VEC3}},elementIndices:Ar},uniforms:{u_world:{value:dr.array},u_viewDirectionProjectionInverse:{value:jt.array},u_skybox:{value:Pt}},drawCommand:{mode:k.TRIANGLES,elementsCount:Ar.length}},Rr={program:B,vertexArray:{vertexAttributes:{a_position:{array:Tr,type:Y.VEC3},a_uv:{array:_r,type:Y.VEC2}},elementIndices:Ar},uniforms:{u_depthWorld:{value:dr.array},u_depthTex:{value:Lt}},drawCommand:{mode:k.TRIANGLES,elementsCount:Ar.length}},gr={program:M,vertexArray:{vertexAttributes:{a_position:{array:Tr,type:Y.VEC3},a_uv:{array:_r,type:Y.VEC2}},elementIndices:Ar},uniforms:{u_world:{value:dr.array},u_tex:{value:vt}},drawCommand:{mode:k.TRIANGLES,elementsCount:Ar.length}},Nr=(qt.createPacket(u,yr),qt.createPacket(u,fr),qt.createPacket(u,mr)),Ir=qt.createPacket(u,Rr),pr=qt.createPacket(u,gr),Mr=ht.createFramebuffer(u),Sr=Kt.getMaxSamples(u);ht.attachRenderbuffer(u,Mr,{renderbuffer:ht.createRenderbuffer(u,{internalFormat:et.DEPTH_COMPONENT24,width:i.width,height:i.height,samples:Sr}),attachment:rt.DEPTH_ATTACHMENT},{renderbuffer:ht.createRenderbuffer(u,{internalFormat:et.RGBA8,width:i.width,height:i.height,samples:Sr}),attachment:rt.COLOR_ATTACHMENT0});const Cr=ht.createFramebuffer(u);ht.attachTexture(u,Cr,{textureTarget:tt.TEXTURE_2D,texture:vt,attachment:rt.COLOR_ATTACHMENT0},{textureTarget:tt.TEXTURE_2D,texture:Lt,attachment:rt.DEPTH_ATTACHMENT}),Kt.viewport(u,0,0,u.canvas.width,u.canvas.height),Kt.enable(u,kt.DEPTH_TEST),Kt.enable(u,kt.CULL_FACE),Kt.enable(u,kt.BLEND),Kt.blendFunction(u,Vt.SRC_ALPHA,Vt.ONE_MINUS_SRC_ALPHA);let Or=0,wr=0,Pr=0,vr=1;Ht.getRotation(new w),Ht.getTranslation(new l),new l([2,-2,-2]),w.fromAxisAngle(c.down,Math.PI/3),_.initialize(i),ht.unbindFramebuffer(u);const Lr=new class{constructor(t,r){var e,a;T.set(this,void 0),this.camera=t,this.rotationSpeed=null!==(e=null==r?void 0:r.rotationSpeed)&&void 0!==e?e:50,this.translationSpeed=null!==(a=null==r?void 0:r.translationSpeed)&&void 0!==a?a:8,function(t,r,e,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof r?t!==r||!n:!r.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===a?n.call(t,e):n?n.value=e:r.set(t,e)}(this,T,new s,"f")}update(t){const{camera:r,rotationSpeed:e,translationSpeed:a}=this,n=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)}(this,T,"f"),{transform:s}=r,i=s.getTranslation(d),l=s.getBackward(m),{array:u}=l,{origin:h,up:y,down:f}=c;let A=s.getUp(R).dot(y);if(_.getKey(o.Z)||_.getKey(o.ARROW_UP)){const r=s.getBackward(R).scale(a*t);s.translate(r)}if(_.getKey(o.Q)||_.getKey(o.ARROW_LEFT)){const r=s.getLeft(R).scale(a*t);s.translate(r)}if(_.getKey(o.S)||_.getKey(o.ARROW_DOWN)){const r=s.getForward(R).scale(a*t);s.translate(r)}if(_.getKey(o.D)||_.getKey(o.ARROW_RIGHT)){const r=s.getRight(R).scale(a*t);s.translate(r)}if(_.getMouseButtonDown(E.RIGHT)&&n.copy(_.getPointerScreenPosition()),_.getMouseButton(E.RIGHT)){const r=_.getPointerScreenPosition();if(!r.equals(n)){const a=(n.x-r.x)*e*t,o=(n.y-r.y)*e*t;if(i.copy(s.getTranslation(R)),0!==a||0!==o){A=Math.sign(s.getUp(R).dot(y)),l.toSpherical(h);const t=u[1],r=u[2],e=t+A*-o;e<=0||e>=Math.PI?(u[2]=(r-a+Math.PI)%(2*Math.PI),u[1]=e<0?-e:Math.PI-(e-Math.PI),A*=-1):(u[2]=(r-a)%(2*Math.PI),u[1]=t+A*-o),l.toCartesian(h),s.lookAt(i.add(l),A>0?y:f)}n.copy(r)}}}}(zt);qt.setPacketValues(u,Er,hr),Kt.clearColor(u,Qt.BLACK.normalize()),t=function(a){if(e)return;wr=(a*=.001)-Or,Or=a,r=1/wr,n.textContent=r.toFixed(1),Lr.update(wr),Wt.setMatrix(zt.transform.matrix),Ht.rotate(w.fromAxisAngle(c.down,Math.PI/128)),Pr+=wr*vr*.5,(Pr>1||Pr<0)&&(vr*=-1),Kt.clear(u,xt.COLOR_BUFFER_BIT|xt.DEPTH_BUFFER_BIT),jt.copy(zt.projection).mult((new v).setIdentity().setRotation(zt.view.getRotation())).invert(),Kt.viewport(u,0,0,i.width,i.height),ht.bindFramebuffer(u,Mr),Kt.clear(u,xt.COLOR_BUFFER_BIT|xt.DEPTH_BUFFER_BIT),Kt.depthFunction(u,Gt.LEQUAL),qt.drawPacket(u,Nr),Kt.depthFunction(u,Gt.LESS),qt.setPacketValues(u,Er,{uniformBlocks:{modelBlock:{uniforms:{"models[0].u_model":{value:Ht.matrix.array},"models[0].u_modelView":{value:zt.view.mult(Ht.matrix).array},"models[0].u_normal":{value:zt.view.mult(Ht.matrix).invert().transpose().array}}},viewBlock:{uniforms:{u_view:{value:zt.view.array},u_projection:{value:zt.projection.array}}},lightsBlock:{uniforms:{"lights[0].u_lightWorldPos":{value:Array.from(Wt.getTranslation(new l))},"lights[0].u_lightDirection":{value:Array.from(Wt.getBackward(new l))}}}}}),qt.drawPacket(u,Er),qt.setPacketValues(u,Nr,{uniforms:{u_viewDirectionProjectionInverse:{value:jt.array}}}),ht.blit(u,Mr,Cr,[0,0,i.width,i.height],[0,0,i.width,i.height],xt.COLOR_BUFFER_BIT,mt.LINEAR),ht.blit(u,Mr,Cr,[0,0,i.width,i.height],[0,0,i.width,i.height],xt.DEPTH_BUFFER_BIT,mt.NEAREST),ht.unbindFramebuffer(u),qt.drawPacket(u,pr);const s=i.width/4,o=i.height/4;Kt.viewport(u,0,i.height-o,s,o),Kt.depthFunction(u,Gt.ALWAYS),qt.drawPacket(u,Ir),_.clear(),requestAnimationFrame(t)},requestAnimationFrame(t)}()}catch(t){console.trace(t)}}async function Jt(){$t()}})(),main=r})();
//# sourceMappingURL=main.js.map