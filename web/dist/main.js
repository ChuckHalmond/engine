var main;(()=>{"use strict";var t={d:(r,e)=>{for(var a in e)t.o(e,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:e[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{t.r(r),t.d(r,{main:()=>tr});const e=class{constructor(t){this._defaultCtor=t.defaultCtor,this._onDefaultOverride=t.onDefaultOverride,this._constructors=new Map}get defaultCtor(){return this._defaultCtor}overrideDefaultCtor(t){this._defaultCtor=t,this._onDefaultOverride(t)}forceQualifier(t){this._forcedQualifier=t}unforceQualifier(){delete this._forcedQualifier}getConstructor(t){const r=this._forcedQualifier||t;if(void 0===r)return this._defaultCtor;const e=this._constructors.get(r);if(void 0===e)throw new Error(`No constructor for qualifier ${r}`);return e}inject(t){const r=this.getConstructor(null==t?void 0:t.qualifier);return(null==t?void 0:t.args)?new r(...Array.from(t.args)):new r}register(t,r){this._constructors.has(r)||this._constructors.set(r,t)}};class a{constructor(t){this.array=t?new Float32Array([t[0],t[1]]):new Float32Array([0,0])}get values(){return[this.array[0],this.array[1]]}set values(t){this.array[0]=t[0],this.array[1]=t[1]}get x(){return this.array[0]}set x(t){this.array[0]=t}get y(){return this.array[1]}set y(t){this.array[1]=t}setValues(t){const r=this.array;return r[0]=t[0],r[1]=t[1],this}equals(t){const r=t.array,e=this.array;return r[0]===e[0]&&r[1]===e[1]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],this}clone(){return new a(this.values)}setUnit(){const t=this.array;return t[0]=1,t[1]=1,this}setZeros(){const t=this.array;return t[0]=0,t[1]=0,this}add(t){const r=t.array,e=this.array;return e[0]=e[0]+r[0],e[1]=e[1]+r[1],this}addScalar(t){const r=this.array;return r[0]=r[0]+t,r[1]=r[1]+t,this}sub(t){const r=t.array,e=this.array;return e[0]=e[0]-r[0],e[1]=e[1]-r[1],this}lerp(t,r){const e=t.array,a=this.array;return a[0]=r*(e[0]-a[0]),a[1]=r*(e[1]-a[1]),this}clamp(t,r){const e=this.array,a=t.array,n=r.array;return e[0]=Math.min(n[0],Math.min(e[0],a[0])),e[1]=Math.min(n[1],Math.min(e[1],a[1])),this}multScalar(t){const r=this.array;return r[0]=r[0]*t,r[1]=r[1]*t,this}cross(t){const r=this.array,e=t.array;return r[0]*e[1]-r[1]*e[0]}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]}length(){const t=this.array;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}lengthSquared(){const t=this.array;return t[0]*t[0]+t[1]*t[1]}dist(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(a*a+n*n)}distSquared(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1];return a*a+n*n}normalize(){const t=this.array,r=t[0]*t[0]+t[1]*t[1],e=Math.sqrt(r);return e>Number.EPSILON?(t[0]=t[0]/e,t[1]=t[1]/e):(t[0]=0,t[1]=0),this}negate(){const t=this.array;return t[0]=-t[0],t[1]=-t[1],this}mult(t){if(t instanceof n){const r=t.array;return this.array[0]=this.array[0]*r[0],this.array[1]=this.array[1]*r[1],this}{const r=this.x,e=this.y,a=t.array;return this.x=r*a[0]+e*a[2],this.y=r*a[1]+e*a[3],this}}addScaled(t,r){const e=t.array,a=this.array;return a[0]=a[0]+e[0]*r,a[1]=a[1]+e[1]*r,this}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1]}readFromArray(t,r=0){const e=this.array;return e[0]=t[r],e[1]=t[r+1],this}copyAndSub(t,r){const e=this.array,a=t.array,n=r.array;return e[0]=a[0]-n[0],e[1]=a[1]-n[1],this}}var n=a;new e({defaultCtor:a,onDefaultOverride:t=>{n=t}});class s{constructor(t){this.array=t?new Float32Array([t[0],t[1],t[2]]):new Float32Array([0,0,0])}toString(){return`Vector3([${Array.from(this.array).join(", ")}])`}static angle(t,r){const e=new o;return Math.acos(e.copy(t).dot(r)/(Math.sqrt(e.copy(t).dot(t))*Math.sqrt(e.copy(r).dot(r))))}get values(){return[this.array[0],this.array[1],this.array[2]]}set values(t){this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2]}get x(){return this.array[0]}set x(t){this.array[0]=t}get y(){return this.array[1]}set y(t){this.array[1]=t}get z(){return this.array[2]}set z(t){this.array[2]=t}setValues(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this}copy(t){const r=t.array;return this.array[0]=r[0],this.array[1]=r[1],this.array[2]=r[2],this}clone(){return new s(this.values)}equals(t){return t.array[0]===this.array[0]&&t.array[1]===this.array[1]&&t.array[2]===this.array[2]}setZeros(){return this.array[0]=0,this.array[1]=0,this.array[2]=0,this}setUnit(){return this.array[0]=1,this.array[1]=1,this.array[2]=1,this}add(t){return this.array[0]=this.array[0]+t.array[0],this.array[1]=this.array[1]+t.array[1],this.array[2]=this.array[2]+t.array[2],this}addScalar(t){return this.array[0]=this.array[0]+t,this.array[1]=this.array[1]+t,this.array[2]=this.array[2]+t,this}sub(t){return this.array[0]=this.array[0]-t.array[0],this.array[1]=this.array[1]-t.array[1],this.array[2]=this.array[2]-t.array[2],this}lerp(t,r,e){return this.array[0]=(1-e)*t.x+e*(r.x-t.x),this.array[1]=(1-e)*t.y+e*(r.y-t.y),this.array[2]=(1-e)*t.z+e*(r.z-t.z),this}max(t){return this.array[0]=Math.max(this.array[0],t.array[0]),this.array[1]=Math.max(this.array[1],t.array[1]),this.array[2]=Math.max(this.array[2],t.array[2]),this}min(t){return this.array[0]=Math.min(this.array[0],t.array[0]),this.array[1]=Math.min(this.array[1],t.array[1]),this.array[2]=Math.min(this.array[2],t.array[2]),this}clamp(t,r){return this.array[0]=Math.min(r.array[0],Math.max(this.array[0],t.array[0])),this.array[1]=Math.min(r.array[1],Math.max(this.array[1],t.array[1])),this.array[2]=Math.min(r.array[2],Math.max(this.array[2],t.array[2])),this}scale(t){return this.array[0]=this.array[0]*t,this.array[1]=this.array[1]*t,this.array[2]=this.array[2]*t,this}cross(t){const r=this.array[1]*t.array[2]-this.array[2]*t.array[1],e=this.array[2]*t.array[0]-this.array[0]*t.array[2],a=this.array[0]*t.array[1]-this.array[1]*t.array[0];return this.array[0]=r,this.array[1]=e,this.array[2]=a,this}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}length(){const t=this.array;return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}lengthSquared(){const t=this.array;return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}distance(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];return Math.hypot(a,n,s)}distanceSquared(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];return a*a+n*n+s*s}normalize(){const t=this.length();return t>Number.EPSILON?(this.array[0]/=t,this.array[1]/=t,this.array[2]/=t):(this.array[0]=0,this.array[1]=0,this.array[2]=0),this}negate(){return this.array[0]*=-1,this.array[1]*=-1,this.array[2]*=-1,this}mult(t){if(t instanceof o){const r=t.array;return this.array[0]=this.array[0]*r[0],this.array[1]=this.array[1]*r[1],this.array[2]=this.array[2]*r[2],this}{const r=this.x,e=this.y,a=this.z,n=t.array;return this.x=r*n[0]+e*n[3]+a*n[6],this.y=r*n[1]+e*n[4]+a*n[7],this.z=r*n[2]+e*n[5]+a*n[8],this}}toSpherical(t){const r=this.array,e=t.array,a=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2],i=Math.hypot(a,n,s),o=Math.acos(n/i),l=Math.atan2(s,a);return r[0]=i,r[1]=o,r[2]=l,this}toCartesian(t){const r=this.array,e=t.array,a=r[0],n=r[1],s=r[2],i=a*Math.sin(n)*Math.cos(s)+e[0],o=a*Math.cos(n)+e[1],l=a*Math.sin(n)*Math.sin(s)+e[2];return r[0]=i,r[1]=o,r[2]=l,this}static mult(t,r){const e=t.array,a=r.array;return new s([e[0]*a[0]+e[1]*a[1]+e[2]*a[2],e[3]*a[0]+e[4]*a[1]+e[5]*a[2],e[6]*a[0]+e[7]*a[1]+e[8]*a[2]])}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2]}readFromArray(t,r=0){return this.array[0]=t[r],this.array[1]=t[r+1],this.array[2]=t[r+2],this}addScaled(t,r){return this.array[0]=this.array[0]+t.array[0]*r,this.array[1]=this.array[1]+t.array[1]*r,this.array[2]=this.array[2]+t.array[2]*r,this}copyAndSub(t,r){const e=t.array,a=r.array;return this.array[0]=e[0]-a[0],this.array[1]=e[1]-a[1],this.array[2]=e[2]-a[2],this}copyAndCross(t,r){const e=t.array,a=r.array,n=e[1]*a[2]-e[2]*a[1],s=e[2]*a[0]-e[0]*a[2],i=e[0]*a[1]-e[1]*a[0];return this.array[0]=n,this.array[1]=s,this.array[2]=i,this}[Symbol.iterator](){const t=this.array;let r=0;return{next:()=>r<t.length?{value:t[r++],done:!1}:{value:void 0,done:!0}}}}var i,o=s;new e({defaultCtor:s,onDefaultOverride:t=>{o=t}});class l{constructor(){}}l.origin=new o([0,0,0]),l.right=new o([1,0,0]),l.left=new o([-1,0,0]),l.up=new o([0,1,0]),l.down=new o([0,-1,0]),l.forward=new o([0,0,1]),l.backward=new o([0,0,-1]),function(t){t.A="a",t.B="b",t.C="c",t.D="d",t.E="e",t.F="f",t.G="g",t.H="h",t.I="i",t.J="j",t.K="k",t.L="l",t.M="m",t.O="o",t.P="p",t.Q="q",t.R="r",t.S="s",t.T="t",t.U="u",t.V="v",t.W="w",t.X="x",t.Y="y",t.Z="z",t.ENTER="Enter",t.BACKSPACE="Backspace",t.ARROW_DOWN="ArrowDown",t.ARROW_LEFT="ArrowLeft",t.ARROW_RIGHT="ArrowRight",t.ARROW_UP="ArrowUp",t.SHIFT="Shift"}(i||(i={}));const u=Object.keys(i).length;var c,h;!function(t){t.Alt="Alt",t.Control="Control",t.Shift="Shift"}(c||(c={})),function(t){t[t.LEFT=0]="LEFT",t[t.WHEEL=1]="WHEEL",t[t.RIGHT=2]="RIGHT",t[t.FORWARD=3]="FORWARD",t[t.BACK=4]="BACK"}(h||(h={}));const E=Object.keys(h).length,_=Object.freeze(Object.values(h).reduce(((t,r,e)=>Object.assign(t,{[r]:e})),{})),y=Object.freeze(Object.values(i).reduce(((t,r,e)=>Object.assign(t,{[r]:e})),{}));var A,T=new class{constructor(){this.keyFlags=new Array(3*u).fill(!1),this.mouseFlags=new Array(3*E).fill(!1),this.pointerPosition=new n,this.wheelDelta=0,this.canvas=null,this.canvasRectangle=null}initialize(t){this.canvas=t,this.canvasRectangle=t.getBoundingClientRect(),t.addEventListener("pointerdown",this),t.addEventListener("pointerup",this),t.addEventListener("contextmenu",this),t.addEventListener("pointermove",this),t.addEventListener("wheel",this),t.addEventListener("keydown",this),t.addEventListener("keyup",this),t.addEventListener("focusout",this)}getCanvasRect(){const t=this.canvasRectangle;if(null===t)throw new Error("Input manager not initialized.");return t}clear(){this.keyFlags.fill(!1,0,2*u),this.mouseFlags.fill(!1,0,2*E),this.wheelDelta=0}handleEvent(t){let r=-1;switch(t.type){case"pointerdown":r=_[t.button],this.mouseFlags[1*E+r]=!0,this.mouseFlags[2*E+r]=!0;break;case"pointerup":r=_[t.button],this.mouseFlags[0*E+r]=!0,this.mouseFlags[2*E+r]=!1;break;case"pointermove":const e=this.getCanvasRect();this.pointerPosition.setValues([t.clientX-e.left,t.clientY-e.top]);break;case"wheel":this.wheelDelta=t.deltaY/100;break;case"keydown":r=y[t.key],this.keyFlags[1*u+r]=!0,this.keyFlags[2*u+r]=!0;break;case"keyup":r=y[t.key],this.keyFlags[0*u+r]=!0,this.keyFlags[2*u+r]=!1;break;case"focusout":this.keyFlags.fill(!1),this.mouseFlags.fill(!1),this.wheelDelta=0,this.pointerPosition.setZeros()}}getKey(t){return this.keyFlags[2*u+y[t]]}getKeyUp(t){return this.keyFlags[0*u+y[t]]}getKeyDown(t){return this.keyFlags[1*u+y[t]]}getMouseButton(t){return this.mouseFlags[2*E+_[t]]}getPointerPosition(){return this.pointerPosition.clone()}getPointerScreenPosition(){const t=this.pointerPosition.array,r=this.getCanvasRect(),e=t[0]/r.width*2-1,a=t[1]/r.height*2-1;return new n([e,a])}getWheelDelta(){return this.wheelDelta}getMouseButtonDown(t){return this.mouseFlags[1*E+_[t]]}getMouseButtonUp(t){return this.mouseFlags[0*E+_[t]]}};A=new WeakMap;var f;class R extends Error{constructor(){super(...arguments),this.name="MathError"}}!function(t){t[t.NO_AUTO_EXTEND=0]="NO_AUTO_EXTEND",t[t.AUTO_EXTEND_ONE=1]="AUTO_EXTEND_ONE",t[t.AUTO_EXTEND_POW2=2]="AUTO_EXTEND_POW2"}(f||(f={}));var m=class extends class{constructor(t,r){this._ctor=t,this._autoExtendPolicy=r||f.AUTO_EXTEND_ONE,this._autoExtendTicks=0}get ctor(){return this._ctor}get autoExtendPolicy(){return this._autoExtendPolicy}autoExtend(){switch(this._autoExtendPolicy){case f.AUTO_EXTEND_ONE:this.extend(1);break;case f.AUTO_EXTEND_POW2:this.extend(Math.pow(2,this._autoExtendTicks))}this._autoExtendTicks++}}{constructor(t,r){super(t,null==r?void 0:r.policy),this._objects=Array((null==r?void 0:r.size)||0).fill(0).map((()=>new this.ctor(null==r?void 0:r.args))),this._top=0}acquire(t){const r=this._top,e=r+t;if(this._autoExtendPolicy)for(;this._objects.length<e;)this.autoExtend();return this._top=e,this._objects.slice(r,e)}release(t){const r=this._top;t>r&&console.warn("Releasing under zero."),this._top=Math.max(r-t,0)}extend(t){this._objects.push(...Array(t).fill(0).map((()=>new this.ctor)))}clear(){this._objects=[],this._top=0,this._autoExtendTicks=0}};Math.PI,Math.PI;const d=new ArrayBuffer(Float32Array.BYTES_PER_ELEMENT),g=new Float32Array(d),N=new Uint32Array(d);class p{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]);else if("object"==typeof t[0]){const r=t[0];this.checkArray(r),r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array([0,0,0,0,0,0,0,0,0])}get row1(){return[this.array[0],this.array[3],this.array[6]]}set row1(t){this.array[0]=t[0],this.array[3]=t[1],this.array[6]=t[2]}get row2(){return[this.array[1],this.array[4],this.array[7]]}set row2(t){this.array[1]=t[0],this.array[4]=t[1],this.array[7]=t[2]}get row3(){return[this.array[2],this.array[5],this.array[8]]}set row3(t){this.array[2]=t[0],this.array[5]=t[1],this.array[8]=t[2]}get col1(){return[this.array[0],this.array[1],this.array[2]]}set col1(t){this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2]}get col2(){return[this.array[3],this.array[4],this.array[5]]}set col2(t){this.array[3]=t[0],this.array[4]=t[1],this.array[5]=t[2]}get col3(){return[this.array[6],this.array[7],this.array[8]]}set col3(t){this.array[6]=t[0],this.array[7]=t[1],this.array[8]=t[2]}get m11(){return this.array[0]}set m11(t){this.array[0]=t}get m12(){return this.array[3]}set m12(t){this.array[3]=t}get m13(){return this.array[6]}set m13(t){this.array[6]=t}get m21(){return this.array[1]}set m21(t){this.array[1]=t}get m22(){return this.array[4]}set m22(t){this.array[4]=t}get m23(){return this.array[7]}set m23(t){this.array[7]=t}get m31(){return this.array[2]}set m31(t){this.array[2]=t}get m32(){return this.array[5]}set m32(t){this.array[5]=t}get m33(){return this.array[8]}set m33(t){this.array[8]=t}checkArray(t){if(t.length<9)throw new R("Array must be of length 9 at least.")}getValues(){return[this.array[0],this.array[1],this.array[2],this.array[3],this.array[4],this.array[5],this.array[6],this.array[7],this.array[8]]}setValues(t,r,e,a,n,s,i,o,l){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this.array[3]=a,this.array[4]=n,this.array[5]=s,this.array[6]=i,this.array[7]=o,this.array[8]=l,this}equals(t){const r=t.array;return this.array[0]===r[0]&&this.array[1]===r[1]&&this.array[2]===r[2]&&this.array[3]===r[3]&&this.array[4]===r[4]&&this.array[5]===r[5]&&this.array[6]===r[6]&&this.array[7]===r[7]&&this.array[8]===r[8]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],this}clone(){return new p(this.array[0],this.array[1],this.array[2],this.array[3],this.array[4],this.array[5],this.array[6],this.array[7],this.array[8])}setIdentity(){const t=this.array;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}setZeros(){const t=this.array;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,this}det(){const t=this.array;return t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6])}trace(){const t=this.array;return t[0]+t[4]+t[8]}negate(){const t=this.array;return t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],t[3]=-t[3],t[4]=-t[4],t[5]=-t[5],t[6]=-t[6],t[7]=-t[7],t[8]=-t[8],this}transpose(){const t=this.array;let r;return r=t[1],t[1]=t[3],t[3]=r,r=t[2],t[2]=t[6],t[6]=r,r=t[5],t[5]=t[7],t[7]=r,this}invert(){const t=this.array,r=t[4]*t[8]-t[5]*t[7],e=t[1]*t[8]-t[2]*t[7],a=t[1]*t[5]-t[2]*t[4],n=t[3]*t[8]-t[5]*t[6],s=t[0]*t[8]-t[2]*t[6],i=t[0]*t[5]-t[2]*t[3],o=t[3]*t[7]-t[4]*t[6],l=t[0]*t[7]-t[1]*t[6],u=t[0]*t[4]-t[1]*t[3],c=1/(t[0]*r-t[3]*e+t[6]*a);if(0==c)throw new R("Matrix is not invertible.");return t[0]=c*r,t[1]=-c*e,t[2]=c*a,t[3]=-c*n,t[4]=c*s,t[5]=-c*i,t[6]=c*o,t[7]=-c*l,t[8]=c*u,this}add(t){const r=this.array,e=t.array;return r[0]=r[0]+e[0],r[1]=r[1]+e[1],r[2]=r[2]+e[2],r[3]=r[3]+e[3],r[4]=r[4]+e[4],r[5]=r[5]+e[5],r[6]=r[6]+e[6],r[7]=r[7]+e[7],r[8]=r[8]+e[8],this}sub(t){const r=this.array,e=t.array;return r[0]=r[0]-e[0],r[1]=r[1]-e[1],r[2]=r[2]-e[2],r[3]=r[3]-e[3],r[4]=r[4]-e[4],r[5]=r[5]-e[5],r[6]=r[6]-e[6],r[7]=r[7]-e[7],r[8]=r[8]-e[8],this}mult(t){const r=this.array,e=t.array,a=r[0],n=r[1],s=r[2],i=r[3],o=r[4],l=r[5],u=r[6],c=r[7],h=r[8],E=e[0],_=e[1],y=e[2],A=e[3],T=e[4],f=e[5],R=e[6],m=e[7],d=e[8];return r[0]=E*a+_*i+y*u,r[1]=E*n+_*o+y*c,r[2]=E*s+_*l+y*h,r[3]=A*a+T*i+f*u,r[4]=A*n+T*o+f*c,r[5]=A*s+T*l+f*h,r[6]=R*a+m*i+d*u,r[7]=R*n+m*o+d*c,r[8]=R*s+m*l+d*h,this}multScalar(t){const r=this.array;return r[0]=r[0]*t,r[1]=r[1]*t,r[2]=r[2]*t,r[3]=r[3]*t,r[4]=r[4]*t,r[5]=r[5]*t,r[6]=r[6]*t,r[7]=r[7]*t,r[8]=r[8]*t,this}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3],t[r+4]=e[4],t[r+5]=e[5],t[r+6]=e[6],t[r+7]=e[7],t[r+8]=e[8]}readFromArray(t,r=0){const e=this.array;e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],e[4]=t[r+4],e[5]=t[r+5],e[6]=t[r+6],e[7]=t[r+7],e[8]=t[r+8]}static rotationX(t){return(new p).setRotationX(t)}setRotationX(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=1,this.array[1]=0,this.array[2]=0,this.array[3]=0,this.array[4]=r,this.array[5]=e,this.array[6]=0,this.array[7]=-e,this.array[8]=r,this}static rotationY(t){return(new p).setRotationY(t)}setRotationY(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=r,this.array[1]=0,this.array[2]=-e,this.array[3]=0,this.array[4]=1,this.array[5]=0,this.array[6]=e,this.array[7]=0,this.array[8]=r,this}static rotationZ(t){return(new p).setRotationZ(t)}setRotationZ(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=r,this.array[1]=e,this.array[2]=0,this.array[3]=-e,this.array[4]=r,this.array[5]=0,this.array[6]=0,this.array[7]=0,this.array[8]=1,this}solve(t){const r=this.array,e=r[0],a=r[1],n=r[2],s=r[3],i=r[4],o=r[5],l=r[6],u=r[7],c=r[8],h=t.x-r[12],E=t.y-r[13],_=t.z-r[14];let y=i*c-o*u,A=o*l-s*c,T=s*u-i*l,f=e*y+a*A+n*T;0!=f&&(f=1/f);const R=f*(h*y+E*A+_*T);y=-(u*_-c*E),A=-(c*h-l*_),T=-(l*E-u*h);const m=f*(e*y+a*A+n*T);return y=-(E*o-_*i),A=-(_*s-h*o),T=-(h*i-E*s),[R,m,f*(e*y+a*A+n*T)]}solve2(t){const r=this.array,e=r[0],a=r[1],n=r[3],s=r[4],i=t.x-r[4],o=t.y-r[7];let l=e*s-a*n;return 0!=l&&(l=1/l),[l*(s*i-a*o),l*(e*o-n*i)]}}var M=p;new e({defaultCtor:p,onDefaultOverride:t=>{M=t}});class I{constructor(...t){"number"==typeof t[0]?this._array=[t[0],t[1],t[2],t[3]]:"object"==typeof t[0]?(this._checkArray(t[0]),this._array=t[0]):this._array=[0,0,0,0]}get array(){return this._array}get x(){return this._array[0]}set x(t){this._array[0]=t}get y(){return this._array[1]}set y(t){this._array[1]=t}set z(t){this._array[2]=t}get z(){return this._array[2]}set w(t){this._array[3]=t}get w(){return this._array[3]}get pitch(){const t=this.array,r=t[0],e=t[1],a=t[2],n=2*(t[3]*e-a*r);return Math.abs(n)>=1?Math.sign(n)*(Math.PI/2):Math.asin(n)}get yaw(){const t=this.array,r=t[0],e=t[1],a=t[2],n=2*(t[3]*a+r*e),s=1-2*(e*e+a*a);return Math.atan2(n,s)}get roll(){const t=this.array,r=t[0],e=t[1],a=t[2],n=2*(t[3]*r+e*a),s=1-2*(r*r+e*e);return Math.atan2(n,s)}getValues(){return[this._array[0],this._array[1],this._array[2],this._array[3]]}setValues(t,r,e,a){return this._array[0]=t,this._array[1]=r,this._array[2]=e,this._array[3]=a,this}_checkArray(t){if(t.length<4)throw new R("Array must be of length 4 at least.")}static fromArray(t){return new I(t)}static fromAxisAngle(t,r){return(new I).setAxisAngle(t,r)}static fromVector(t){return new I(t.x,t.y,t.z,1)}static fromEuler(t,r,e){return(new I).setEuler(t,r,e)}copy(t){const r=this._array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],this}clone(){return new I(this.x,this.y,this.z,this.w)}equals(t){const r=this.array,e=t.array;return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}getAxis(t){const r=this.array,e=t.array,a=1-r[3]*r[3];if(a<Number.EPSILON)return t.setZeros();const n=function(t){const r=.5*t;g[0]=t,N[0]=1597463007-(N[0]>>1);let e=g[0];return e*=1.5-r*e*e,e}(a);return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,t}getMatrix(){const t=this.array,r=2/this.lengthSquared(),e=t[0],a=t[1],n=t[2],s=t[3],i=e*r,o=a*r,l=n*r,u=s*i,c=s*o,h=s*l,E=e*i,_=e*o,y=e*l,A=a*o,T=a*l,f=n*l;return new M([1-(A+f),_+h,y-c,_-h,1-(E+f),T+u,y+c,T-u,1-(E+A)])}rotate(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2],i=r[0],o=r[1],l=r[2],u=r[3],c=u*a+0*-i+-o*s+l*n,h=u*n+0*-o+-l*a+i*s,E=u*s+0*-l+-i*n+o*a,_=i*a+0*u+o*n+l*s;return e[0]=_*l+E*u+c*o-h*i,e[1]=_*o+h*u+E*i-c*l,e[2]=_*i+c*u+h*l-E*o,t}toVector(){return new o([this.x,this.y,this.z])}setEuler(t,r,e){const a=Math.cos(.5*r),n=Math.sin(.5*r),s=Math.cos(.5*t),i=Math.sin(.5*t),o=Math.cos(.5*e),l=Math.sin(.5*e),u=this.array;return u[0]=l*s*a-o*i*n,u[1]=o*i*a+l*s*n,u[2]=o*s*n-l*i*a,u[3]=o*s*a+l*i*n,this}setAxisAngle(t,r=0){const e=t.length();if(0===e)return this;const a=Math.sin(.5*r)/e,n=t.array,s=this.array;return s[0]=n[0]*a,s[1]=n[1]*a,s[2]=n[2]*a,s[3]=Math.cos(.5*r),this}setMatrix(t){const r=t.array;let e=0,a=0,n=0,s=0,i=0,o=0,l=0,u=0,c=0;t instanceof M?(e=r[0],a=r[3],n=r[6],s=r[1],i=r[4],o=r[7],l=r[2],u=r[5],c=r[8]):(e=r[0],a=r[4],n=r[8],s=r[1],i=r[5],o=r[9],l=r[2],u=r[6],c=r[10]);const h=e+i+c,E=this.array;if(h>0){const t=2*Math.sqrt(h+1);E[3]=.25*t,E[0]=(u-o)/t,E[1]=(n-l)/t,E[2]=(s-a)/t}else if(e>i&&e>c){const t=2*Math.sqrt(1+e-i-c);E[3]=(u-o)/t,E[0]=.25*t,E[1]=(a+s)/t,E[2]=(n+l)/t}else if(i>c){const t=2*Math.sqrt(1+i-e-c);E[3]=(n-l)/t,E[0]=(a+s)/t,E[1]=.25*t,E[2]=(o+u)/t}else{const t=2*Math.sqrt(1+c-e-i);E[3]=(s-a)/t,E[0]=(n+l)/t,E[1]=(o+u)/t,E[2]=.25*t}return this}lookAt(t,r){const e=r.clone().sub(t).normalize(),a=l.forward.clone().cross(e),n=l.forward.dot(e);return new P(a.x,a.y,a.z,n+1).normalize()}static fromMatrix(t){return(new I).setMatrix(t)}setVectors(t,r){const e=t.dot(r),a=t.cross(r).array,n=this.array;n[0]=a[0],n[1]=a[1],n[2]=a[2];const s=t.length(),i=t.length();return n[3]=Math.sqrt(s*s*i*i)+e,this.normalize()}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}lengthSquared(){const t=this.array;return t[0]**2+t[1]**2+t[2]**2+t[3]**2}length(){const t=this.array;return Math.hypot(t[0],t[1],t[2],t[3])}angleTo(t){return 2*Math.acos(Math.abs(Math.max(-1,Math.min(1,this.dot(t)))))}rotateTowards(t){const r=this.angleTo(t);if(0===r)return this;const e=Math.min(1,r);return this.slerp(this,t,e),this}invert(){return this.conjugate()}conjugate(){const t=this.array;return t[0]*=-1,t[1]*=-1,t[2]*=-1,this}normalize(){const t=this.array;let r=this.length();return 0===r?(t[0]=0,t[1]=0,t[2]=0,t[3]=1):(r=1/r,t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r),this}add(t){const r=this.array,e=t.array;return r[0]+=e[0],r[1]+=e[1],r[2]+=e[2],r[3]+=e[3],this}sub(t){const r=this.array,e=t.array;return r[0]-=e[0],r[1]-=e[1],r[2]-=e[2],r[3]-=e[3],this}mult(t){const r=this.array,e=t.array,a=r[0],n=r[1],s=r[2],i=r[3],o=e[0],l=e[1],u=e[2],c=e[3];return r[0]=a*c+i*o+n*u-s*l,r[1]=n*c+i*l+s*o-a*u,r[2]=s*c+i*u+a*l-n*o,r[3]=i*c-a*o-n*l-s*u,this}scale(t){const r=this.array;return r[0]*=t,r[1]*=t,r[2]*=t,r[3]*=t,this}static slerp(t,r,e,a){if(a instanceof P||(a=new P),0===e)return a.copy(t);if(1===e)return a.copy(r);const n=a.array,s=t.array,i=r.array,o=s[3]*i[3]+s[0]*i[0]+s[1]*i[1]+s[2]*i[2];if(Math.abs(o)>=1)return n[3]=s[3],n[0]=s[0],n[1]=s[1],n[2]=s[2],a;const l=Math.acos(o),u=Math.sqrt(1-o*o);if(Math.abs(u-Math.trunc(u))<Number.EPSILON)return n[3]=.5*s[3]+.5*i[3],n[0]=.5*s[0]+.5*i[0],n[1]=.5*s[1]+.5*i[1],n[2]=.5*s[2]+.5*i[2],a;const c=Math.sin((1-e)*l)/u,h=Math.sin(e*l)/u;return n[3]=s[3]*c+i[3]*h,n[0]=s[0]*c+i[0]*h,n[1]=s[1]*c+i[1]*h,n[2]=s[2]*c+i[2]*h,a}slerp(t,r,e){return P.slerp(t,r,e,this)}copyIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3]}readFromArray(t,r=0){const e=this.array;e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3]}}var P=I;const S=new m(I);new e({defaultCtor:I,onDefaultOverride:t=>{P=t}});class v{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]);else if("object"==typeof t[0]){const r=t[0];this.checkArray(r),r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array(16)}static fromValues(t,r,e,a,n,s,i,o,l,u,c,h,E,_,y,A){return new v(t,r,e,a,n,s,i,o,l,u,c,h,E,_,y,A)}static fromArray(t){if(t.length<16)throw new Error("Matrix4 needs an array of size 16 at least.");return new v(t)}getValues(){const t=this.array;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}setValues(t,r,e,a,n,s,i,o,l,u,c,h,E,_,y,A){const T=this.array;return T[0]=t,T[1]=r,T[2]=e,T[3]=a,T[4]=n,T[5]=s,T[6]=i,T[7]=o,T[8]=l,T[9]=u,T[10]=c,T[11]=h,T[12]=E,T[13]=_,T[14]=y,T[15]=A,this}get m11(){return this.array[0]}set m11(t){this.array[0]=t}get m12(){return this.array[4]}set m12(t){this.array[4]=t}get m13(){return this.array[8]}set m13(t){this.array[8]=t}get m14(){return this.array[12]}set m14(t){this.array[12]=t}get m21(){return this.array[1]}set m21(t){this.array[1]=t}get m22(){return this.array[5]}set m22(t){this.array[5]=t}get m23(){return this.array[9]}set m23(t){this.array[9]=t}get m24(){return this.array[13]}set m24(t){this.array[13]=t}get m31(){return this.array[2]}set m31(t){this.array[2]=t}get m32(){return this.array[6]}set m32(t){this.array[6]=t}get m33(){return this.array[10]}set m33(t){this.array[10]=t}get m34(){return this.array[14]}set m34(t){this.array[14]=t}get m41(){return this.array[3]}set m41(t){this.array[3]=t}get m42(){return this.array[7]}set m42(t){this.array[7]=t}get m43(){return this.array[11]}set m43(t){this.array[11]=t}get m44(){return this.array[15]}set m44(t){this.array[15]=t}checkArray(t){if(t.length<16)throw new R("Array must be of length 16 at least.")}getRotation(){const t=this.array,r=t[0],e=t[4],a=t[8],n=t[1],s=t[5],i=t[9],o=t[2],l=t[6],u=t[10],c=r+s+u;let h=0,E=0,_=0,y=0;if(c>0){const t=2*Math.sqrt(c+1);y=.25*t,h=(l-i)/t,E=(a-o)/t,_=(n-e)/t}else if(r>s&&r>u){const t=2*Math.sqrt(1+r-s-u);y=(l-i)/t,h=.25*t,E=(e+n)/t,_=(a+o)/t}else if(s>u){const t=2*Math.sqrt(1+s-r-u);y=(a-o)/t,h=(e+n)/t,E=.25*t,_=(i+l)/t}else{const t=2*Math.sqrt(1+u-r-s);y=(n-e)/t,h=(a+o)/t,E=(i+l)/t,_=.25*t}return new P(h,E,_,y)}setTRS(t,r,e){const a=this.array,n=r.array,s=t.array,i=e.array,o=n[0],l=n[1],u=n[2],c=n[3],h=o+o,E=l+l,_=u+u,y=o*h,A=o*E,T=o*_,f=l*E,R=l*_,m=u*_,d=c*h,g=c*E,N=c*_,p=i[0],M=i[1],I=i[2];return a[0]=(1-(f+m))*p,a[1]=(A+N)*p,a[2]=(T-g)*p,a[3]=0,a[4]=(A-N)*M,a[5]=(1-(y+m))*M,a[6]=(R+d)*M,a[7]=0,a[8]=(T+g)*I,a[9]=(R-d)*I,a[10]=(1-(y+f))*I,a[11]=0,a[12]=s[0],a[13]=s[1],a[14]=s[2],a[15]=1,this}setRotation(t){const r=this.array,e=t.array,a=2/t.lengthSquared(),n=e[0],s=e[1],i=e[2],o=e[3],l=n*a,u=s*a,c=i*a,h=o*l,E=o*u,_=o*c,y=n*l,A=n*u,T=n*c,f=s*u,R=s*c,m=i*c,d=1-(f+m),g=A+_,N=T-E,p=A-_,M=1-(y+m),I=R+h,P=T+E,S=R-h,v=1-(y+f);return r[0]=d,r[1]=g,r[2]=N,r[4]=p,r[5]=M,r[6]=I,r[8]=P,r[9]=S,r[10]=v,this}equals(t){const r=this.array,e=t.array;return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}clone(){const t=this.array;return new v(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}static identity(){return new v(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setIdentity(){const t=this.array;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}static zeros(){return new v(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}setZeros(){const t=this.array;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=0,this}det(){const t=this.array,r=t[0]*t[5]-t[1]*t[4],e=t[0]*t[6]-t[2]*t[4],a=t[0]*t[7]-t[3]*t[4],n=t[1]*t[6]-t[2]*t[5],s=t[1]*t[7]-t[3]*t[5],i=t[2]*t[7]-t[3]*t[6],o=t[8]*n-t[9]*e+t[10]*r,l=t[8]*s-t[9]*a+t[11]*r,u=t[8]*i-t[10]*a+t[11]*e;return-(t[9]*i-t[10]*s+t[11]*n)*t[12]+u*t[13]-l*t[14]+o*t[15]}trace(){const t=this.array;return t[0]+t[5]+t[10]+t[15]}static negate(t,r){const e=t.array,a=r.array;return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=-e[3],a[4]=-e[4],a[5]=-e[5],a[6]=-e[6],a[7]=-e[7],a[8]=-e[8],a[9]=-e[9],a[10]=-e[10],a[11]=-e[11],a[12]=-e[12],a[13]=-e[13],a[14]=-e[14],a[15]=-e[15],r}negate(){return v.negate(this,this)}static transpose(t,r){const e=t.array,a=r.array,n=e[0],s=e[1],i=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],E=e[8],_=e[9],y=e[10],A=e[11],T=e[12],f=e[13],R=e[14],m=e[15];return a[0]=n,a[1]=l,a[2]=E,a[3]=T,a[4]=s,a[5]=u,a[6]=_,a[7]=f,a[8]=i,a[9]=c,a[10]=y,a[11]=R,a[12]=o,a[13]=h,a[14]=A,a[15]=m,r}transpose(){return v.transpose(this,this)}static invert(t,r){const e=t.array,a=r.array,n=e[0],s=e[1],i=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],E=e[8],_=e[9],y=e[10],A=e[11],T=e[12],f=e[13],m=e[14],d=e[15],g=n*u-s*l,N=n*c-i*l,p=n*h-o*l,M=s*c-i*u,I=s*h-o*u,P=i*h-o*c,S=E*f-_*T,v=E*m-y*T,C=E*d-A*T,O=_*m-y*f,U=_*d-A*f,w=y*d-A*m,F=g*w-N*U+p*O+M*C-I*v+P*S;if(0==F)throw new R("Matrix is not invertible.");const L=1/F;return a[0]=(u*w-c*U+h*O)*L,a[1]=(-s*w+i*U-o*O)*L,a[2]=(f*P-m*I+d*M)*L,a[3]=(-_*P+y*I-A*M)*L,a[4]=(-l*w+c*C-h*v)*L,a[5]=(n*w-i*C+o*v)*L,a[6]=(-T*P+m*p-d*N)*L,a[7]=(E*P-y*p+A*N)*L,a[8]=(l*U-u*C+h*S)*L,a[9]=(-n*U+s*C-o*S)*L,a[10]=(T*I-f*p+d*g)*L,a[11]=(-E*I+_*p-A*g)*L,a[12]=(-l*O+u*v-c*S)*L,a[13]=(n*O-s*v+i*S)*L,a[14]=(-T*M+f*N-m*g)*L,a[15]=(E*M-_*N+y*g)*L,r}invert(){return v.invert(this,this)}static add(t,r,e){const a=t.array,n=r.array,s=e.array;return s[0]=a[0]+n[0],s[1]=a[1]+n[1],s[2]=a[2]+n[2],s[3]=a[3]+n[3],s[4]=a[4]+n[4],s[5]=a[5]+n[5],s[6]=a[6]+n[6],s[7]=a[7]+n[7],s[8]=a[8]+n[8],s[9]=a[9]+n[9],s[10]=a[10]+n[10],s[11]=a[11]+n[11],s[12]=a[12]+n[12],s[13]=a[13]+n[13],s[14]=a[14]+n[14],s[15]=a[15]+n[15],e}add(t){return v.add(this,t,this)}static sub(t,r,e){const a=t.array,n=r.array,s=e.array;return s[0]=a[0]-n[0],s[1]=a[1]-n[1],s[2]=a[2]-n[2],s[3]=a[3]-n[3],s[4]=a[4]-n[4],s[5]=a[5]-n[5],s[6]=a[6]-n[6],s[7]=a[7]-n[7],s[8]=a[8]-n[8],s[9]=a[9]-n[9],s[10]=a[10]-n[10],s[11]=a[11]-n[11],s[12]=a[12]-n[12],s[13]=a[13]-n[13],s[14]=a[14]-n[14],s[15]=a[15]-n[15],e}sub(t){return v.sub(this,t,this)}static mult(t,r,e){const a=t.array,n=r.array,s=e.array,i=a[0],o=a[1],l=a[2],u=a[3],c=a[4],h=a[5],E=a[6],_=a[7],y=a[8],A=a[9],T=a[10],f=a[11],R=a[12],m=a[13],d=a[14],g=a[15],N=n[0],p=n[1],M=n[2],I=n[3],P=n[4],S=n[5],v=n[6],C=n[7],O=n[8],U=n[9],w=n[10],F=n[11],L=n[12],b=n[13],B=n[14],x=n[15];return s[0]=i*N+c*p+y*M+R*I,s[1]=o*N+h*p+A*M+m*I,s[2]=l*N+E*p+T*M+d*I,s[3]=u*N+_*p+f*M+g*I,s[4]=i*P+c*S+y*v+R*C,s[5]=o*P+h*S+A*v+m*C,s[6]=l*P+E*S+T*v+d*C,s[7]=u*P+_*S+f*v+g*C,s[8]=i*O+c*U+y*w+R*F,s[9]=o*O+h*U+A*w+m*F,s[10]=l*O+E*U+T*w+d*F,s[11]=u*O+_*U+f*w+g*F,s[12]=i*L+c*b+y*B+R*x,s[13]=o*L+h*b+A*B+m*x,s[14]=l*L+E*b+T*B+d*x,s[15]=u*L+_*b+f*B+g*x,e}mult(t){return v.mult(this,t,this)}getMaxScaleOnAxis(){const t=this.array,r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],a=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(r,e,a))}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3],t[r+4]=e[4],t[r+5]=e[5],t[r+6]=e[6],t[r+7]=e[7],t[r+8]=e[8],t[r+9]=e[9],t[r+10]=e[10],t[r+11]=e[11],t[r+12]=e[12],t[r+13]=e[13],t[r+14]=e[14],t[r+15]=e[15]}readFromArray(t,r=0){const e=this.array;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],e[4]=t[r+4],e[5]=t[r+5],e[6]=t[r+6],e[7]=t[r+7],e[8]=t[r+8],e[9]=t[r+9],e[10]=t[r+10],e[11]=t[r+11],e[12]=t[r+12],e[13]=t[r+13],e[14]=t[r+14],e[15]=t[r+15],this}solve(t){const r=this.array,e=r[0],a=r[1],n=r[2],s=r[3],i=r[4],o=r[5],l=r[6],u=r[7],c=r[8],h=r[9],E=r[10],_=r[11],y=r[12],A=r[13],T=r[14],f=r[15],R=e*o-a*i,m=e*l-n*i,d=e*u-s*i,g=a*l-n*o,N=a*u-s*o,p=n*u-s*l,M=c*A-h*y,I=c*T-E*y,P=c*f-_*y,S=h*T-E*A,v=h*f-_*A,C=E*f-_*T,O=t.x,U=t.y,w=t.z,F=t.w;let L=R*C-m*v+d*S+g*P-N*I+p*M;return 0!=L&&(L=1/L),[L*((o*C-l*v+u*S)*O-(i*C-l*P+u*I)*U+(i*v-o*P+u*M)*w-(i*S-o*I+l*M)*F),L*-((a*C-n*v+s*S)*O-(e*C-n*P+s*I)*U+(e*v-a*P+s*M)*w-(e*S-a*I+n*M)*F),L*((A*p-T*N+f*g)*O-(y*p-T*d+f*m)*U+(y*N-A*d+f*R)*w-(y*g-A*m+T*R)*F),L*-((h*p-E*N+_*g)*O-(c*p-E*d+_*m)*U+(c*N-h*d+_*R)*w-(c*g-h*m+E*R)*F)]}solve2(t){const r=this.array,e=r[0],a=r[1],n=r[4],s=r[5],i=t.x-r[8],o=t.y-r[9];let l=e*s-a*n;return 0!=l&&(l=1/l),[l*(s*i-a*o),l*(e*o-n*i)]}solve3(t){const r=this.array,e=r[0],a=r[1],n=r[2],s=r[4],i=r[5],o=r[6],l=r[8],u=r[9],c=r[10],h=t.x-r[12],E=t.y-r[13],_=t.z-r[14];let y=i*c-o*u,A=o*l-s*c,T=s*u-i*l,f=e*y+a*A+n*T;0!=f&&(f=1/f);const R=f*(h*y+E*A+_*T);y=-(u*_-c*E),A=-(c*h-l*_),T=-(l*E-u*h);const m=f*(e*y+a*A+n*T);return y=-(E*o-_*i),A=-(_*s-h*o),T=-(h*i-E*s),[R,m,f*(e*y+a*A+n*T)]}static translation(t){return(new v).setTranslation(t)}setTranslation(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2];return r[12]=a,r[13]=n,r[14]=s,this}translate(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2],i=r[0]*a+r[4]*n+r[8]*s+1*r[12],o=r[1]*a+r[5]*n+r[9]*s+1*r[13],l=r[2]*a+r[6]*n+r[10]*s+1*r[14],u=r[3]*a+r[7]*n+r[11]*s+1*r[15];return r[12]=i,r[13]=o,r[14]=l,r[15]=u,this}static rotationX(t){return(new v).setRotationX(t)}setRotationX(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e,r[6]=a,r[7]=0,r[8]=0,r[9]=-a,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateX(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),n=r[4]*e+r[8]*a,s=r[5]*e+r[9]*a,i=r[6]*e+r[10]*a,o=r[7]*e+r[11]*a,l=r[4]*-a+r[8]*e,u=r[5]*-a+r[9]*e,c=r[6]*-a+r[10]*e,h=r[7]*-a+r[11]*e;return r[4]=n,r[5]=s,r[6]=i,r[7]=o,r[8]=l,r[9]=u,r[10]=c,r[11]=h,this}static rotationY(t){return(new v).setRotationY(t)}setRotationY(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=e,r[1]=0,r[2]=-a,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=a,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateY(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),n=r[0]*e+r[8]*-a,s=r[1]*e+r[9]*-a,i=r[2]*e+r[10]*-a,o=r[3]*e+r[11]*-a,l=r[0]*a+r[8]*e,u=r[1]*a+r[9]*e,c=r[2]*a+r[10]*e,h=r[3]*a+r[11]*e;return r[0]=n,r[1]=s,r[2]=i,r[3]=o,r[8]=l,r[9]=u,r[10]=c,r[11]=h,this}static rotationZ(t){return(new v).setRotationZ(t)}setRotationZ(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=e,r[1]=a,r[2]=0,r[3]=0,r[4]=-a,r[5]=e,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateZ(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),n=r[0]*e+r[4]*a,s=r[1]*e+r[5]*a,i=r[2]*e+r[6]*a,o=r[3]*e+r[7]*a,l=r[0]*-a+r[4]*e,u=r[1]*-a+r[5]*e,c=r[2]*-a+r[6]*e,h=r[3]*-a+r[7]*e;return r[0]=n,r[1]=s,r[2]=i,r[3]=o,r[4]=l,r[5]=u,r[6]=c,r[7]=h,this}static rotation(t){return(new v).rotation(t)}rotation(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[4]=e[3],r[5]=e[4],r[6]=e[5],r[8]=e[6],r[9]=e[7],r[10]=e[8],this}rotate(t,r){const e=this.array,a=t.array,n=t.length(),s=a[0]/n,i=a[1]/n,o=a[2]/n,l=Math.cos(r),u=Math.sin(r),c=1-l,h=s*s*c+l,E=s*i*c-o*u,_=s*o*c+i*u,y=i*s*c+o*u,A=i*i*c+l,T=i*o*c-s*u,f=o*s*c-i*u,R=o*i*c+s*u,m=o*o*c+l,d=e[0]*h+e[4]*y+e[8]*f,g=e[1]*h+e[5]*y+e[9]*f,N=e[2]*h+e[6]*y+e[10]*f,p=e[3]*h+e[7]*y+e[11]*f,M=e[0]*E+e[4]*A+e[8]*R,I=e[1]*E+e[5]*A+e[9]*R,P=e[2]*E+e[6]*A+e[10]*R,S=e[3]*E+e[7]*A+e[11]*R,v=e[0]*_+e[4]*T+e[8]*m,C=e[1]*_+e[5]*T+e[9]*m,O=e[2]*_+e[6]*T+e[10]*m,U=e[3]*_+e[7]*T+e[11]*m;return e[0]=d,e[1]=g,e[2]=N,e[3]=p,e[4]=M,e[5]=I,e[6]=P,e[7]=S,e[8]=v,e[9]=C,e[10]=O,e[11]=U,this}static scaling(t){return(new v).setScaling(t)}setScaling(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2];return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=s,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}scale(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2];return r[0]*=a,r[1]*=a,r[2]*=a,r[3]*=a,r[4]*=n,r[5]*=n,r[6]*=n,r[7]*=n,r[8]*=s,r[9]*=s,r[10]*=s,r[11]*=s,r[12]*=1,r[13]*=1,r[14]*=1,r[15]*=1,this}static lookAt(t,r,e,a){const n=t.array,s=e.array,i=r.array,o=a.array,l=n[0],u=n[1],c=n[2],h=s[0],E=s[1],_=s[2];let y,A,T,f,R,m,d,g,N,p;return d=l-i[0],g=u-i[1],N=c-i[2],p=Math.hypot(d,g,N),p>0&&(p=1/Math.hypot(d,g,N),d*=p,g*=p,N*=p),y=E*N-_*g,A=_*d-h*N,T=h*g-E*d,p=Math.hypot(y,A,T),p>0&&(p=1/p,y*=p,A*=p,T*=p),f=g*T-N*A,R=N*y-d*T,m=d*A-g*y,p=Math.hypot(f,R,m),p>0&&(p=1/p,f*=p,R*=p,m*=p),o[0]=y,o[1]=A,o[2]=T,o[3]=0,o[4]=f,o[5]=R,o[6]=m,o[7]=0,o[8]=d,o[9]=g,o[10]=N,o[11]=0,o[12]=l,o[13]=u,o[14]=c,o[15]=1,a}lookAt(t,r,e){return v.lookAt(t,r,e,this)}transformPoint(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2],i=a*r[3]+n*r[7]+s*r[11]+r[15];return t.setValues([(a*r[0]+n*r[4]+s*r[8]+r[12])/i,(a*r[1]+n*r[5]+s*r[9]+r[13])/i,(a*r[2]+n*r[6]+s*r[10]+r[14])/i]),t}transformDirection(t){const r=this.array,e=t.array,a=e[0],n=e[1],s=e[2];return t.setValues([a*r[0]+n*r[4]+s*r[8],a*r[1]+n*r[5]+s*r[9],a*r[2]+n*r[6]+s*r[10]]),t}transformNormal(t){const r=t.array,e=this.invert().array,a=r[0],n=r[1],s=r[2];return t.setValues([a*e[0]+n*e[4]+s*e[8],a*e[1]+n*e[5]+s*e[9],a*e[2]+n*e[6]+s*e[10]]),this.invert(),t}static perspective(t,r,e,a){return(new v).setPerspective(t,r,e,a)}setPerspective(t,r,e,a){const n=this.array,s=Math.tan(.5*Math.PI-.5*t),i=s/r,o=1/(e-a);return n[0]=i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(e+a)*o,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*e*a*o,n[15]=0,this}static orthographic(t,r,e,a,n,s){return(new v).setOrthographic(t,r,e,a,n,s)}setOrthographic(t,r,e,a,n,s){const i=this.array;return i[0]=2/(r-t),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(a-e),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(n-s),i[11]=0,i[12]=(r+t)/(t-r),i[13]=(a+e)/(e-a),i[14]=(s+n)/(n-s),i[15]=1,this}static frustrum(t,r,e,a,n,s){return(new v).setFrustrum(t,r,e,a,n,s)}setFrustrum(t,r,e,a,n,s){const i=this.array,o=1/(r-t),l=1/(a-e),u=1/(n-s);return i[0]=2*n*o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*n*l,i[6]=0,i[7]=0,i[8]=(r+t)*o,i[9]=(a+e)*l,i[10]=(s+n)*u,i[11]=-1,i[12]=0,i[13]=0,i[14]=s*n*2*u,i[15]=0,this}}var C=v;new e({defaultCtor:v,onDefaultOverride:t=>{C=t}});const O=new class extends m{constructor(t,r){super(t,r),this._buffer=new Float32Array(0),this._bufferViews=Array((null==r?void 0:r.size)||0).fill(0).map((()=>this._buffer.subarray())),this._extensions=[]}}(o),U=new class{constructor(){this._count=0}newUUID(){return(++this._count).toString(16)}};class w{constructor(t){this.uuid=U.newUUID(),this.owner=t||null,this.array=new Float32Array(16),this.localArray=new Float32Array(16),this.matrix=new C(this.array).setIdentity(),this.localMatrix=new C(this.localArray).setIdentity(),this._hasChanged=!1}getMatrix(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],t}setMatrix(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}getLocalMatrix(t){const r=this.localArray,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],t}setLocalMatrix(t){const r=this.localArray,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}getRight(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],t}getLeft(t){const r=this.array,e=t.array;return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],t}getUp(t){const r=this.array,e=t.array;return e[0]=r[4],e[1]=r[5],e[2]=r[6],t}getDown(t){const r=this.array,e=t.array;return e[0]=-r[4],e[1]=-r[5],e[2]=-r[6],t}getForward(t){const r=this.array,e=t.array;return e[0]=r[8],e[1]=r[9],e[2]=r[10],t}getBackward(t){const r=this.array,e=t.array;return e[0]=-r[8],e[1]=-r[9],e[2]=-r[10],t}get hasChanged(){return this._hasChanged}getTranslation(t){const r=this.array,e=t.array;return e[0]=r[12],e[1]=r[13],e[2]=r[14],t}setTranslation(t){const r=this.array,e=t.array;return r[12]=e[0],r[13]=e[1],r[14]=e[2],this}translate(t){const r=this.array,e=t.array;return r[12]+=e[0],r[13]+=e[1],r[14]+=e[2],this}getScaling(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[5],e[2]=r[10],t}setScaling(t){const r=this.array,e=t.array;return r[0]=e[0],r[5]=e[1],r[10]=e[2],this}scale(t){const r=this.array,e=t.array;return r[0]*=e[0],r[5]*=e[1],r[10]*=e[2],this}getRotation(t){return t.setMatrix(this.matrix),t}setRotation(t){return this.matrix.setRotation(t),this}rotate(t){const r=this.getRotation(S.acquire(1)[0]);return this.matrix.setRotation(r.mult(t)),S.release(1),this}transformPoint(t){return t}transformDirection(t){return t}transformVector(t){return t}lookAt(t,r){const e=this.getTranslation(O.acquire(1)[0]);return this.matrix.lookAt(e,t,r),O.release(1),this}}const F=w;class L{constructor(t,r){this._normal=t||new o([0,0,0]),this._constant=r||0}static fromNormalAndConstant(t,r){return(new L).setFromNormalAndConstant(t,r)}static fromNormalAndCoplanarPoint(t,r){return(new L).setFromNormalAndCoplanarPoint(t,r)}static fromCoplanarPoints(t,r,e){return(new L).setFromCoplanarPoints(t,r,e)}get normal(){return this._normal}set normal(t){this._normal=t}get constant(){return this._constant}set constant(t){this._constant=t}copy(t){return this._normal=t._normal.clone(),this._constant=t._constant,this}set(t,r,e,a){return this._normal.setValues([t,r,e]),this._constant=a,this}setFromNormalAndConstant(t,r){return this._normal.copy(t),this._constant=r,this}setFromNormalAndCoplanarPoint(t,r){return this._normal.copy(t),this._constant=-r.dot(this._normal),this}setFromCoplanarPoints(t,r,e){const a=e.clone(),[n]=O.acquire(1);return n.copy(t),a.sub(r).cross(n.sub(r)).normalize(),this.setFromNormalAndCoplanarPoint(a,t),O.release(1),this}distanceToPoint(t){return this._normal.dot(t)+this._constant}normalized(){const t=1/this._normal.length();return this._normal.scale(t),this._constant*=t,this}}const b=new e({defaultCtor:L,onDefaultOverride:t=>{}});class B{constructor(){const t=b.defaultCtor;this._nearPlane=new t,this._farPlane=new t,this._topPlane=new t,this._bottomPlane=new t,this._leftPlane=new t,this._rightPlane=new t}get nearPlane(){return this._nearPlane}set nearPlane(t){this._nearPlane=t}get farPlane(){return this._farPlane}set farPlane(t){this._farPlane=t}get topPlane(){return this._topPlane}set topPlane(t){this._topPlane=t}get bottomPlane(){return this._bottomPlane}set bottomPlane(t){this._bottomPlane=t}get leftPlane(){return this._leftPlane}set leftPlane(t){this._leftPlane=t}get rightPlane(){return this._rightPlane}set rightPlane(t){this._rightPlane=t}set(t,r,e,a,n,s){return this._nearPlane.copy(t),this._farPlane.copy(r),this._topPlane.copy(e),this._bottomPlane.copy(a),this._leftPlane.copy(n),this._rightPlane.copy(s),this}copy(t){return this.set(t._nearPlane,t._farPlane,t._topPlane,t._bottomPlane,t._leftPlane,t._rightPlane),this}clone(){return(new B).copy(this)}setFromPerspectiveMatrix(t){const r=t.m11,e=t.m12,a=t.m13,n=t.m14,s=t.m21,i=t.m22,o=t.m23,l=t.m24,u=t.m31,c=t.m32,h=t.m33,E=t.m34,_=t.m41,y=t.m42,A=t.m43,T=t.m44;return this._nearPlane.set(u+_,c+y,h+A,E+T).normalized(),this._farPlane.set(-u+_,-c+y,-h+A,-E+T).normalized(),this._bottomPlane.set(s+_,i+y,o+A,l+T).normalized(),this._topPlane.set(-s+_,-i+y,-o+A,-l+T).normalized(),this._leftPlane.set(r+_,e+y,a+A,n+T).normalized(),this._rightPlane.set(-r+_,-e+y,-a+A,-n+T).normalized(),this}intersectsSphere(t){const r=t.center,e=t.radius;return r.dot(this._nearPlane.normal)+this._nearPlane.constant+e<=0||r.dot(this._farPlane.normal)+this._farPlane.constant+e<=0||r.dot(this._bottomPlane.normal)+this._bottomPlane.constant+e<=0||r.dot(this._topPlane.normal)+this._topPlane.constant+e<=0||r.dot(this._leftPlane.normal)+this._leftPlane.constant+e<=0||r.dot(this._rightPlane.normal)+this._rightPlane.constant+e<=0}intersectsBox(t){let r=!0;const e=t.max,a=t.min,[n]=O.acquire(1);return r=this._nearPlane.distanceToPoint(n.setValues([this._nearPlane.normal.x>0?e.x:a.x,this._nearPlane.normal.y>0?e.y:a.y,this._nearPlane.normal.z>0?e.z:a.z]))>=0&&this._farPlane.distanceToPoint(n.setValues([this._farPlane.normal.x>0?e.x:a.x,this._farPlane.normal.y>0?e.y:a.y,this._farPlane.normal.z>0?e.z:a.z]))>=0&&this._bottomPlane.distanceToPoint(n.setValues([this._bottomPlane.normal.x>0?e.x:a.x,this._bottomPlane.normal.y>0?e.y:a.y,this._bottomPlane.normal.z>0?e.z:a.z]))>=0&&this._topPlane.distanceToPoint(n.setValues([this._topPlane.normal.x>0?e.x:a.x,this._topPlane.normal.y>0?e.y:a.y,this._topPlane.normal.z>0?e.z:a.z]))>=0&&this._leftPlane.distanceToPoint(n.setValues([this._leftPlane.normal.x>0?e.x:a.x,this._leftPlane.normal.y>0?e.y:a.y,this._leftPlane.normal.z>0?e.z:a.z]))>=0&&this._rightPlane.distanceToPoint(n.setValues([this._rightPlane.normal.x>0?e.x:a.x,this._rightPlane.normal.y>0?e.y:a.y,this._rightPlane.normal.z>0?e.z:a.z]))>=0,O.release(1),r}containsPoint(t){return this._nearPlane.distanceToPoint(t)>=0&&this._farPlane.distanceToPoint(t)>=0&&this._bottomPlane.distanceToPoint(t)>=0&&this._topPlane.distanceToPoint(t)>=0&&this._leftPlane.distanceToPoint(t)>=0&&this._rightPlane.distanceToPoint(t)>=0}}var x,D,G,V,k,H,X,Y=B;new e({defaultCtor:B,onDefaultOverride:t=>{Y=t}});class z extends class extends class{constructor(){this.transform=new w(this)}}{constructor(t){super(),this.uuid=U.newUUID(),this._projection=t||new C,this._frustrum=(new Y).setFromPerspectiveMatrix(this._projection)}get projection(){return this._projection.clone()}get view(){return this.transform.matrix.clone().invert()}get viewProjection(){return this.projection.clone().mult(this.view)}isViewing(t){return!0}updateFrustrum(){this._frustrum.setFromPerspectiveMatrix(this._projection)}}{constructor(t,r,e,a){super(C.perspective(t,r,e,a))}setValues(t,r,e,a){return this._projection.setPerspective(t,r,e,a),this.updateFrustrum(),this}}!function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(x||(x={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(D||(D={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(G||(G={}));class W{static createShader(t,r,e){const a=t.createShader(r);if(null==a)return console.error("Could not create WebGLShader."),null;if(t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS))return{internal:a};const n=t.getShaderInfoLog(a);return null!==n&&console.warn(n),t.deleteShader(a),null}static deleteShader(t,r){const{internal:e}=r;t.isShader(e)&&t.deleteShader(e)}static createProgram(t,r){const{vertexSource:e,fragmentSource:a}=r,n=this.createShader(t,G.VERTEX_SHADER,e);if(null==n)return null;const s=this.createShader(t,G.FRAGMENT_SHADER,a);if(null==s)return null;const i=t.createProgram();if(null==i)return console.error("Could not create WebGLProgram."),null;if(t.attachShader(i,n.internal),t.attachShader(i,s.internal),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return{internal:i,vertexShader:n,fragmentShader:s};const o=t.getProgramInfoLog(i),l=t.getProgramInfoLog(i),u=t.getProgramInfoLog(i);return null!==o&&(console.warn(`Program info: ${o}`),console.warn(`VS info: ${l}`),console.warn(`FS info: ${u}`)),t.deleteProgram(i),null}static deleteProgram(t,r){const{vertexShader:e,fragmentShader:a,internal:n}=r;t.isShader(e)&&t.deleteShader(e),t.isShader(a)&&t.deleteShader(a),t.isProgram(n)&&t.deleteProgram(n)}static useProgram(t,r){const{internal:e}=r;t.getParameter(t.CURRENT_PROGRAM)!==e&&t.useProgram(e)}}!function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(V||(V={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(k||(k={})),function(t){t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4"}(H||(H={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT"}(X||(X={}));class j{static getAttributeDataTypeElementsSize(t){switch(t){case H.VEC2:return 2;case H.VEC3:return 3;case H.VEC4:return 4;default:throw new Error(`Unsupported AttributeDataType ${t}`)}}static getDataComponentTypeArrayConstructor(t){switch(t){case k.FLOAT:return Float32Array;case k.BYTE:case k.UNSIGNED_BYTE:return Uint8Array;case k.SHORT:return Int16Array;case k.UNSIGNED_SHORT:return Uint16Array;case k.INT:return Int32Array;case k.UNSIGNED_INT:return Uint32Array;default:throw new Error(`Unsupported DataComponentType ${t}`)}}static getAttributeArrayDataComponentType(t){if(t instanceof Float32Array)return k.FLOAT;if(t instanceof Int32Array)return k.INT;if(t instanceof Uint32Array)return k.UNSIGNED_INT;if(t instanceof Int16Array)return k.SHORT;if(t instanceof Uint16Array)return k.UNSIGNED_SHORT;if(t instanceof Int8Array)return k.BYTE;if(t instanceof Uint8Array)return k.UNSIGNED_BYTE;throw new Error("Unsupported VertexArrayAttributeArray")}static getDataComponentTypeBytesPerElement(t){switch(t){case k.FLOAT:case k.INT:case k.UNSIGNED_INT:return 4;case k.SHORT:case k.UNSIGNED_SHORT:return 2;case k.BYTE:case k.UNSIGNED_BYTE:return 1;default:throw new Error(`Unsupported DataComponentType ${t}`)}}static createVertexArray(t,r,e){const{attributes:a,indices:n,elementsCount:s,interleave:i}=e;let{usage:o}=e;const l=t.createVertexArray();if(null===l)return console.error("Could not create WebGLVertexArrayObject."),null;t.bindVertexArray(l);const u=t.createBuffer();if(null==u)return console.error("Could not create WebGLBuffer."),null;t.bindBuffer(t.ARRAY_BUFFER,u);const c=Object.entries(a),h=c.reduce(((t,[r,e])=>t+e.array.byteLength),0),E=new ArrayBuffer(h);o=null!=o?o:t.STATIC_DRAW;const _={internal:u,target:t.ARRAY_BUFFER,usage:o,data:E},y=i?c.reduce(((t,[r,e])=>{const{constant:a}=e;if(!a){const{array:r,type:a}=e;return t+r.BYTES_PER_ELEMENT*j.getAttributeDataTypeElementsSize(a)}return t}),0):0,A=i?Math.trunc(h/y):0;let T=0;const f={};let R,m;if(c.forEach((([e,a])=>{const{array:n,type:s}=a;let{constant:o,divisor:l,normalize:u}=a;o=null!=o&&o;const c=t.getAttribLocation(r.internal,e);if(-1==c)return void console.warn(`Attribute ${e} could not be located.`);const h=this.getAttributeArrayDataComponentType(n),_=this.getAttributeDataTypeElementsSize(s);if(l=null!=l?l:0,u=null!=u&&u,t.vertexAttribPointer(c,_,h,u,y,T),l>0&&t.vertexAttribDivisor(c,l),o)switch(_){case 1:t.vertexAttrib1fv(c,n);break;case 2:t.vertexAttrib2fv(c,n);break;case 3:t.vertexAttrib3fv(c,n);break;case 4:t.vertexAttrib4fv(c,n)}else{if(i){const{array:t,type:r}=a,e=j.getAttributeDataTypeElementsSize(r),n=j.getDataComponentTypeArrayConstructor(j.getAttributeArrayDataComponentType(t)),{BYTES_PER_ELEMENT:s}=t,i=new n(E,T),o=y/s;for(let r=0;r<A;r++){let a=r*e;i.set(t.slice(a,a+e),r*o)}T+=e*s}else{const{array:t}=a,{byteLength:r}=t;new(j.getDataComponentTypeArrayConstructor(j.getAttributeArrayDataComponentType(t)))(E,T).set(t),T+=r}t.enableVertexAttribArray(c)}f[e]={location:c,componentType:h,type:s,normalize:u,constant:o,divisor:l,byteOffset:T}})),t.bufferData(t.ARRAY_BUFFER,E,o),void 0!==n){if(m=this.getElementArrayBufferType(n),R=t.createBuffer(),null==R)return console.error("Could not create WebGLBuffer."),null;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,R),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}return{attributeSetters:f,verticesBuffer:_,indicesBuffer:R,program:r,internal:l,elementsCount:s,indexType:m}}static deleteVertexArray(t,r){const{internal:e}=r;t.isVertexArray(e)&&t.deleteVertexArray(e)}static drawVertexArray(t,r,e,a){const{program:n,internal:s,indexType:i,elementsCount:o}=r;W.useProgram(t,n),t.getParameter(t.VERTEX_ARRAY_BINDING)!==s&&t.bindVertexArray(s),void 0!==i?void 0!==a?t.drawElementsInstanced(e,o,i,0,a):t.drawElements(e,o,i,0):void 0!==a?t.drawArraysInstanced(e,0,o,a):t.drawArrays(e,0,o)}static setVertexArrayAttributeValue(t,r,e,a){const{attributeSetters:n,verticesBuffer:s}=r,i=n[e],{internal:o}=s,{array:l}=a;t.getParameter(t.ARRAY_BUFFER_BINDING)!==o&&t.bindBuffer(t.ARRAY_BUFFER,o);let{srcOffset:u,srcLength:c}=a;if(u=null!=u?u:0,void 0!==i){const{byteOffset:r}=i;t.bufferSubData(t.ARRAY_BUFFER,r,l,u,c)}else console.warn(`Attribute ${e} does not exist in the setters.`)}static setVertexArrayValues(t,r,e){const{indicesBuffer:a}=r,{attributes:n,indices:s,elementsCount:i}=e;Object.entries(n).forEach((([e,a])=>{this.setVertexArrayAttributeValue(t,r,e,a)})),Object.assign(r,{elementsCount:i}),void 0!==s&&void 0!==a&&(t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING)!==a&&t.bindBuffer(D.ELEMENT_ARRAY_BUFFER,a),t.bufferSubData(D.ELEMENT_ARRAY_BUFFER,0,s))}static unbindVertexArray(t){t.bindVertexArray(null)}static getElementArrayBufferType(t){return t instanceof Uint8Array?X.UNSIGNED_BYTE:t instanceof Uint16Array?X.UNSIGNED_SHORT:X.UNSIGNED_INT}}var q;!function(t){t[t.vertices=0]="vertices",t[t.indices=1]="indices",t[t.uvs=2]="uvs",t[t.facesNormals=3]="facesNormals",t[t.verticesNormals=4]="verticesNormals",t[t.tangents=5]="tangents",t[t.bitangents=6]="bitangents"}(q||(q={}));var Z,$,K,Q,J,tt,rt,et,at,nt,st=function(t,r,e,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof r?t!==r||!n:!r.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?n.call(t,e):n?n.value=e:r.set(t,e),e},it=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)},ot=class{constructor(){this.halfEdges=[],this.vertices=[],this.faces=[]}addTriangleFace(t,r,e,a){this.addFace([t,r,e],a)}addQuadFace(t,r,e,a,n){this.addFace([t,r,e,a],n)}addVertex(t){const{vertices:r}=this,e={position:t,halfEdge:null};return r.push(e),e}addFace(t,r){var e;const{halfEdges:a,faces:n}=this;if(t.length<2)return void console.warn("At least 2 vertices are required to create a face.");const s={halfEdge:null,...r};let i=null,o=null,l=null,u=null,c=null;for(let r=0;r<t.length;r++){i=t[r],o=r<t.length-1?t[r+1]:t[0];const n=Array.from(new ct(i)).find((t=>null!=t&&Array.from(new lt(t)).find((t=>{var r;return t.target===o&&(null===(r=t.prev)||void 0===r?void 0:r.target)===i}))));if(n)continue;u={target:o,twin:null,next:null,prev:null,face:s},null==c?(s.halfEdge=u,l=u):(u.prev=c,c.next=u),null==i.halfEdge&&(i.halfEdge=u);const h=null!==(e=a.find((t=>{var r;return t.target===i&&(null===(r=t.prev)||void 0===r?void 0:r.target)===o})))&&void 0!==e?e:null;null!==h&&(u.twin=h,h.twin=u),c=u,a.push(u)}null!==u&&null!==l&&(l.prev=u,u.next=l),n.push(s)}linesArray(){const{faces:t}=this;return new Float32Array(t.flatMap((t=>{const r=Array.from(new ut(t));if(4===r.length){const t=r[0],e=r[1],a=r[2],n=r[3];return[...t.position,...e.position,...e.position,...a.position,...a.position,...n.position,...n.position,...t.position]}{const t=r[0],e=r[1],a=r[2];return[...t.position,...e.position,...e.position,...a.position,...a.position,...t.position]}})))}verticesArray(){const{faces:t}=this;return new Float32Array(t.flatMap((t=>Array.from(new ut(t)).flatMap((t=>Array.from(t.position))))))}tangentsArray(){const{faces:t}=this;return new Float32Array(t.flatMap((t=>{const r=Array.from(new ut(t)),e=t.uv,a=r[0].position,n=r[1].position,s=r[2].position,i=e[0],o=e[1],l=e[2],u=n.map(((t,r)=>a[r]-t)),c=n.map(((t,r)=>s[r]-t)),h=o.map(((t,r)=>i[r]-t)),E=o.map(((t,r)=>l[r]-t)),_=1/(h[0]*E[1]-h[1]*E[0]),y=u.map(((t,r)=>-(t*E[1]-c[r]*h[1])*_)),A=Math.hypot(...y);return t.tangent=y.map((t=>t/A)),r.flatMap((()=>Array.from(t.tangent)))})))}verticesNormalsArray(){const{faces:t}=this;return new Float32Array(t.flatMap((t=>{const r=Array.from(new ut(t)),e=r[0].position,a=r[1].position,n=r[2].position,s=a.map(((t,r)=>e[r]-t)),i=a.map(((t,r)=>n[r]-t)),o=s.length,l=s.map(((t,r)=>{const e=(r+1)%o,a=(r-1+o)%o;return-(s[e]*i[a]-s[a]*i[e])})),u=Math.hypot(...l);return t.normal=l.map((t=>t/u)),r.flatMap((()=>Array.from(t.normal)))})))}uvsArray(){const{faces:t}=this;return new Float32Array(t.flatMap((t=>t.uv.flat(1))))}indicesArray(){const{faces:t}=this,r=t.reduce(((t,r)=>t+Array.from(new ut(r)).length),0);return new(r<Math.pow(2,8)?Uint8Array:r<Math.pow(2,16)?Uint16Array:Uint32Array)(t.reduce((([t,r],e)=>4===Array.from(new ut(e)).length?[t.concat([r,r+1,r+2,r+2,r+3,r]),r+4]:[t.concat([r,r+1,r+2]),r+3]),[[],0])[0])}};class lt{constructor(t){Z.set(this,void 0),$.set(this,void 0),st(this,Z,t,"f"),st(this,$,null,"f")}reset(){st(this,$,null,"f")}current(){return it(this,$,"f")}next(){var t,r,e,a;if(null==it(this,$,"f")){const a=null!==(t=it(this,Z,"f").halfEdge)&&void 0!==t?t:null,n=null!==(e=null===(r=it(this,Z,"f").halfEdge)||void 0===r?void 0:r.next)&&void 0!==e?e:null;if(st(this,$,n,"f"),null!==a)return{value:a,done:null==n}}else if(it(this,$,"f")!==it(this,Z,"f").halfEdge){const t=it(this,$,"f"),r=null!==(a=t.next)&&void 0!==a?a:null;if(st(this,$,r,"f"),null!==t)return{value:t,done:null==r}}return{value:void 0,done:!0}}[(Z=new WeakMap,$=new WeakMap,Symbol.iterator)](){return st(this,$,null,"f"),this}}class ut{constructor(t){K.set(this,void 0),Q.set(this,void 0),st(this,K,t,"f"),st(this,Q,null,"f")}reset(){st(this,Q,null,"f")}current(){var t,r,e;return null!==(e=null===(r=null===(t=it(this,Q,"f"))||void 0===t?void 0:t.prev)||void 0===r?void 0:r.target)&&void 0!==e?e:null}next(){var t,r,e,a,n,s,i,o;if(null==it(this,Q,"f")){const s=null!==(e=null===(r=null===(t=it(this,K,"f").halfEdge)||void 0===t?void 0:t.prev)||void 0===r?void 0:r.target)&&void 0!==e?e:null,i=null!==(n=null===(a=it(this,K,"f").halfEdge)||void 0===a?void 0:a.next)&&void 0!==n?n:null;if(st(this,Q,i,"f"),null!==s)return{value:s,done:null==i}}else if(it(this,Q,"f")!==it(this,K,"f").halfEdge){const t=null!==(i=null===(s=it(this,Q,"f").prev)||void 0===s?void 0:s.target)&&void 0!==i?i:null,r=null!==(o=it(this,Q,"f").next)&&void 0!==o?o:null;if(st(this,Q,r,"f"),null!==t)return{value:t,done:null==r}}return{value:void 0,done:!0}}[(K=new WeakMap,Q=new WeakMap,Symbol.iterator)](){return st(this,Q,null,"f"),this}}class ct{constructor(t){J.set(this,void 0),tt.set(this,void 0),st(this,tt,t,"f"),st(this,J,null,"f")}reset(){st(this,J,null,"f")}current(){var t,r;return null!==(r=null===(t=it(this,J,"f"))||void 0===t?void 0:t.face)&&void 0!==r?r:null}next(){var t,r,e,a,n,s,i,o,l;if(null==it(this,J,"f")){const s=null!==(r=null===(t=it(this,tt,"f").halfEdge)||void 0===t?void 0:t.face)&&void 0!==r?r:null,i=null!==(n=null===(a=null===(e=it(this,tt,"f").halfEdge)||void 0===e?void 0:e.prev)||void 0===a?void 0:a.twin)&&void 0!==n?n:null;if(st(this,J,i,"f"),null!==s)return{value:s,done:null==i}}else if(it(this,J,"f")!==it(this,tt,"f").halfEdge){const t=null!==(s=it(this,J,"f").face)&&void 0!==s?s:null,r=null!==(l=null===(o=null===(i=it(this,J,"f"))||void 0===i?void 0:i.prev)||void 0===o?void 0:o.twin)&&void 0!==l?l:null;if(st(this,J,r,"f"),null!==t)return{value:t,done:null==r}}return{value:void 0,done:!0}}[(J=new WeakMap,tt=new WeakMap,Symbol.iterator)](){return st(this,J,null,"f"),this}}class ht extends class{constructor(){}}{constructor(t){var r,e,a,n;super(),this.width=null!==(r=null==t?void 0:t.width)&&void 0!==r?r:1,this.height=null!==(e=null==t?void 0:t.height)&&void 0!==e?e:1,this.widthSegments=null!==(a=null==t?void 0:t.widthSegments)&&void 0!==a?a:1,this.heightSegments=null!==(n=null==t?void 0:t.heightSegments)&&void 0!==n?n:1}toBuilder(){const t=new ot,{heightSegments:r,widthSegments:e,width:a,height:n}=this,s=a/2,i=n/2,o=Math.floor(e),l=Math.floor(r),u=o+1,c=l+1,h=a/o,E=n/l,_=[],y=[],A=[];for(let t=0;t<c;t++){const r=t*E-i;for(let e=0;e<u;e++){const a=e*h-s;y.push(a,-r,0),A.push(e/o),A.push(1-t/l)}}for(let t=0;t<l;t++)for(let r=0;r<o;r++){const e=r+u*t,a=r+u*(t+1),n=r+1+u*(t+1),s=r+1+u*t;_.push(e,a,s),_.push(a,n,s)}const{length:T}=_,f=[],R=[];for(let r=0;r<T;r+=3){const e=3*_[r],a=3*_[r+1],n=3*_[r+2],s=2*_[r],i=2*_[r+1],o=2*_[r+2];let l=f[e],u=f[a],c=f[n];null==l&&(l=t.addVertex([y[e],y[e+1],y[e+2]]),f[e]=l),null==u&&(u=t.addVertex([y[a],y[a+1],y[a+2]]),f[a]=u),null==c&&(c=t.addVertex([y[n],y[n+1],y[n+2]]),f[n]=c);let h=R[s],E=R[i],T=R[o];null==h&&(h=[A[s],A[s+1]],R[s]=h),null==E&&(E=[A[i],A[i+1]],R[i]=E),null==T&&(T=[A[o],A[o+1]],R[o]=T),t.addTriangleFace(l,u,c,{uv:[h,E,T]})}return t}}!function(t){t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED"}(rt||(rt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(et||(et={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT"}(at||(at={})),function(t){t[t.R8=33321]="R8",t[t.R8UI=33330]="R8UI",t[t.R8I=33329]="R8I",t[t.R16UI=33332]="R16UI",t[t.R16I=33331]="R16I",t[t.R32UI=33334]="R32UI",t[t.R32I=33333]="R32I",t[t.RG8=33323]="RG8",t[t.RG8UI=33336]="RG8UI",t[t.RG8I=33335]="RG8I",t[t.RG16UI=33338]="RG16UI",t[t.RG16I=33337]="RG16I",t[t.RG32UI=33340]="RG32UI",t[t.RG32I=33339]="RG32I",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGBA4=32854]="RGBA4",t[t.RGB565=36194]="RGB565",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8"}(nt||(nt={}));class Et{static createFramebuffer(t){const r=t.createFramebuffer();return null===r?(console.error("Could not create WebGLFramebuffer."),null):{internal:r}}static createRenderbuffer(t,r){const e=t.createRenderbuffer();return null==e?(console.error("Could not create WebGLRenderbuffer."),null):(t.bindRenderbuffer(t.RENDERBUFFER,e),void 0!==r.samples?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.samples,r.internalFormat,r.width,r.height):t.renderbufferStorage(t.RENDERBUFFER,r.internalFormat,r.width,r.height),t.bindRenderbuffer(t.RENDERBUFFER,null),{...r,internal:e})}static attachTexture(t,r,...e){t.getParameter(t.FRAMEBUFFER_BINDING)!==r.internal&&t.bindFramebuffer(t.FRAMEBUFFER,r.internal);const a=e.map((e=>(t.framebufferTexture2D(t.FRAMEBUFFER,e.attachment,e.textureTarget,e.texture.internal,0),{...e,...r}))),n=t.checkFramebufferStatus(t.FRAMEBUFFER);return n!==rt.FRAMEBUFFER_COMPLETE&&console.warn(`Incomplete framebuffer status: ${rt[n]}`),a}static attachRenderbuffer(t,r,...e){t.getParameter(t.FRAMEBUFFER_BINDING)!==r.internal&&t.bindFramebuffer(t.FRAMEBUFFER,r.internal);const a=e.map((e=>(t.framebufferRenderbuffer(t.FRAMEBUFFER,e.attachment,t.RENDERBUFFER,e.renderbuffer.internal),{...e,...r}))),n=t.checkFramebufferStatus(t.FRAMEBUFFER);return n!==rt.FRAMEBUFFER_COMPLETE&&console.warn(`Incomplete framebuffer status: ${rt[n]}`),a}static blit(t,r,e,a,n,s,i){t.getParameter(t.READ_FRAMEBUFFER_BINDING)!==r&&t.bindFramebuffer(t.READ_FRAMEBUFFER,null!==r?r.internal:null),t.getParameter(t.DRAW_FRAMEBUFFER_BINDING)!==e&&t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null!==e?e.internal:null),t.blitFramebuffer(a[0],a[1],a[2],a[3],n[0],n[1],n[2],n[3],s,i)}static readPixels(t,r,e,a,n,s,i,o){t.readPixels(r,e,a,n,s,i,o)}static bindFramebuffer(t,r){t.bindFramebuffer(t.FRAMEBUFFER,r.internal)}static unbindFramebuffer(t){t.bindFramebuffer(t.FRAMEBUFFER,null)}static deleteFramebuffer(t,r){t.isFramebuffer(r.internal)&&t.deleteFramebuffer(r.internal)}static deleteRenderbuffer(t,r){t.isRenderbuffer(r.internal)&&t.deleteRenderbuffer(r.internal)}}var _t,yt,At,Tt,ft,Rt,mt,dt,gt,Nt,pt,Mt,It,Pt,St,vt,Ct=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)};!function(t){t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ft||(ft={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.R8=33321]="R8",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8=33323]="RG8",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8=32849]="RGB8",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGB565=36194]="RGB565",t[t.RGBA8=32856]="RGBA8",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.R16F=33325]="R16F",t[t.RGB16F=34843]="RGB16F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB8I=36239]="RGB8I",t[t.RGB8UI=36221]="RGB8UI",t[t.RGB16I=36233]="RGB16I",t[t.RGB16UI=36215]="RGB16UI",t[t.RGB32I=36227]="RGB32I",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI"}(Rt||(Rt={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV"}(mt||(mt={})),function(t){t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE"}(dt||(dt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(gt||(gt={})),function(t){t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST"}(Nt||(Nt={})),function(t){t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(pt||(pt={})),function(t){t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.NONE=0]="NONE"}(Mt||(Mt={})),function(t){t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(It||(It={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Pt||(Pt={}));class Ot{static createTexture(t,r){const e=t.createTexture();if(null===e)return console.error("Could not create WebGLTexture."),null;const a=Ct(this,_t,"m",Tt).call(this,t);return a<0?(console.error(`Could not allocate another texture unit. Max (${t.MAX_TEXTURE_IMAGE_UNITS}) was reached.`),null):{unit:a,internal:e,name:r}}static deleteTexture(t,r){const{internal:e,unit:a}=r;t.isTexture(e)&&t.deleteTexture(e),Ct(this,_t,"m",At).call(this,t,a)}static setTextureProperties(t,r,e){const{unit:a,internal:n}=r,{pixels:s,target:i,subimage:o,width:l,height:u,format:c,internalFormat:h,type:E}=e;let{lod:_}=e;if(t.getParameter(t.ACTIVE_TEXTURE)!==a&&(t.activeTexture(t.TEXTURE0+a),t.bindTexture(i,n)),_=null!=_?_:0,null==s)t.texImage2D(i,_,h,l,u,0,c,E,null);else{if("xPos"in s){const{xPos:r,xNeg:e,yPos:a,yNeg:n,zPos:i,zNeg:o}=s;t.texImage2D(gt.TEXTURE_CUBE_MAP_POSITIVE_X,_,h,l,u,0,c,E,r),t.texImage2D(gt.TEXTURE_CUBE_MAP_NEGATIVE_X,_,h,l,u,0,c,E,e),t.texImage2D(gt.TEXTURE_CUBE_MAP_POSITIVE_Y,_,h,l,u,0,c,E,a),t.texImage2D(gt.TEXTURE_CUBE_MAP_NEGATIVE_Y,_,h,l,u,0,c,E,n),t.texImage2D(gt.TEXTURE_CUBE_MAP_POSITIVE_Z,_,h,l,u,0,c,E,i),t.texImage2D(gt.TEXTURE_CUBE_MAP_NEGATIVE_Z,_,h,l,u,0,c,E,o)}else if(o){const{xoffset:r,yoffset:e,width:a,height:n}=o;t.texImage2D(i,_,h,a,n,0,c,E,s),t.texSubImage2D(i,_,r,e,a,n,c,E,s)}else t.texImage2D(i,_,h,l,u,0,c,E,s);t.generateMipmap(i)}const{min:y,mag:A,wrapS:T,wrapT:f,wrapR:R,baseMipmapLevel:m,maxMipmapLevel:d,compareFunction:g,compareMode:N,minLod:p,maxLod:M}=e;void 0!==y&&t.texParameteri(i,dt.TEXTURE_MIN_FILTER,y),void 0!==A&&t.texParameteri(i,dt.TEXTURE_MAG_FILTER,A),void 0!==T&&t.texParameteri(i,dt.TEXTURE_WRAP_S,T),void 0!==f&&t.texParameteri(i,dt.TEXTURE_WRAP_T,f),void 0!==R&&t.texParameteri(i,dt.TEXTURE_WRAP_R,R),void 0!==m&&t.texParameteri(i,dt.TEXTURE_BASE_LEVEL,m),void 0!==d&&t.texParameteri(i,dt.TEXTURE_MAX_LEVEL,d),void 0!==g&&t.texParameteri(i,dt.TEXTURE_COMPARE_FUNC,g),void 0!==N&&t.texParameteri(i,dt.TEXTURE_COMPARE_MODE,N),void 0!==p&&t.texParameterf(i,dt.TEXTURE_MIN_LOD,p),void 0!==M&&t.texParameterf(i,dt.TEXTURE_MAX_LOD,M),Object.assign(r,{properties:{pixels:s,target:i,subimage:o,lod:_,width:l,height:u,format:c,internalFormat:h,type:E,min:y,mag:A,wrapS:T,wrapT:f,wrapR:R,baseMipmapLevel:m,maxMipmapLevel:d,compareFunction:g,compareMode:N,minLod:p,maxLod:M}})}}_t=Ot,At=function(t,r){const e=Ct(this,_t,"f",yt).get(t);return void 0!==e&&e.length<0&&(e[r]=!1),null},Tt=function(t){const r=t.MAX_TEXTURE_IMAGE_UNITS;let e=Ct(this,_t,"f",yt).get(t);void 0===e&&(e=new Array(r),Ct(this,_t,"f",yt).set(t,e));for(let t=1;t<r;t++)if(!e[t])return e[t]=!0,t;return-1},yt={value:new Map},function(t){t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW"}(St||(St={})),function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"}(vt||(vt={}));class Ut{static asArrayBufferView(t){return"object"==typeof t?"buffer"in t?t:"unit"in t?Float32Array.of(t.unit):Float32Array.from(t):Float32Array.of(t)}static getUniformSetter(t,r,e,a){const n=r.value;let{props:s}=r;s=null!=s?s:{};const{srcOffset:i,srcLength:o}=s;let{transpose:l}=s;switch(l=null!=l&&l,a){case St.FLOAT:if("number"==typeof n)return{type:a,set:r=>{t.uniform1f(e,r)}};break;case St.UNSIGNED_INT:if("number"==typeof n)return{type:a,set:r=>{t.uniform1ui(e,r)}};break;case St.BOOL:case St.INT:if("number"==typeof n)return{type:a,set:r=>{t.uniform1i(e,r)}};break;case St.INT_SAMPLER_2D:case St.INT_SAMPLER_2D_ARRAY:case St.INT_SAMPLER_3D:case St.INT_SAMPLER_CUBE:case St.SAMPLER_2D:case St.SAMPLER_3D:case St.SAMPLER_CUBE:case St.SAMPLER_2D_SHADOW:case St.SAMPLER_2D_ARRAY:case St.SAMPLER_2D_ARRAY_SHADOW:case St.SAMPLER_CUBE_SHADOW:case St.UNSIGNED_INT_SAMPLER_2D:case St.UNSIGNED_INT_SAMPLER_3D:case St.UNSIGNED_INT_SAMPLER_CUBE:case St.UNSIGNED_INT_SAMPLER_2D_ARRAY:if("object"==typeof n&&"unit"in n)return{type:a,set:r=>{const{unit:a}=r;t.uniform1i(e,a)}};break;case St.FLOAT_VEC2:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform2fv(e,r,i,o)}};break;case St.BOOL_VEC2:case St.INT_VEC2:if(n instanceof Int32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform2iv(e,r)}};break;case St.UNSIGNED_INT_VEC2:if(n instanceof Uint32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform2uiv(e,r,i,o)}};break;case St.FLOAT_VEC3:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform3fv(e,r,i,o)}};break;case St.BOOL_VEC3:case St.INT_VEC3:if(n instanceof Int32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform3iv(e,r,i,o)}};break;case St.UNSIGNED_INT_VEC3:if(n instanceof Uint32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform3uiv(e,r,i,o)}};break;case St.FLOAT_VEC4:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform4fv(e,r,i,o)}};break;case St.BOOL_VEC4:case St.INT_VEC4:if(n instanceof Int32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform4iv(e,r,i,o)}};break;case St.UNSIGNED_INT_VEC4:if(n instanceof Uint32Array||Array.isArray(n))return{type:a,set:r=>{t.uniform4uiv(e,r,i,o)}};break;case St.FLOAT_MAT2:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix2fv(e,l,r,i,o)}};break;case St.FLOAT_MAT3:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix3fv(e,l,r,i,o)}};break;case St.FLOAT_MAT4:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix4fv(e,l,r)}};break;case St.FLOAT_MAT2x3:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix2x3fv(e,l,r,i,o)}};break;case St.FLOAT_MAT2x4:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix2x4fv(e,l,r,i,o)}};break;case St.FLOAT_MAT3x2:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix3x2fv(e,l,r,i,o)}};break;case St.FLOAT_MAT3x4:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix3x4fv(e,l,r,i,o)}};break;case St.FLOAT_MAT4x2:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix4x2fv(e,l,r,i,o)}};break;case St.FLOAT_MAT4x3:if(n instanceof Float32Array||Array.isArray(n))return{type:a,set:r=>{t.uniformMatrix4x3fv(e,l,r,i,o)}}}return null}static getUniformsListSetter(t,r,e){const{internal:a}=r,n=Object.keys(e);let s=t.getUniformIndices(a,n);if(null==s)return console.error("No uniform indices found."),null;const i=t.getProgramParameter(a,t.ACTIVE_UNIFORMS),o=Array.from(s).filter(((t,r)=>{const e=t>=0&&t<i;return e||console.warn(`Uniform ${n[r]} could not be located.`),e})),l={};return o.map((r=>t.getActiveUniform(a,r))).forEach((({name:r,type:n})=>{const s=e[r],i=t.getUniformLocation(a,r);if(null==i)return console.warn(`Uniform ${r} could not be located.`),null;l[r]=this.getUniformSetter(t,s,i,n)})),{setters:l,program:r}}static setUniformsListValues(t,r,e){const{program:a,setters:n}=r;W.useProgram(t,a),Object.keys(e).forEach((t=>{const r=n[t],a=e[t],{value:s}=a;r?r.set(s):console.warn(`Uniform ${t} does not match any of the given setters.`)}))}}var wt,Ft,Lt,bt,Bt,xt,Dt,Gt,Vt,kt,Ht,Xt=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)};class Yt{static createUniformBlock(t,r,e){const{internal:a}=r,n=Xt(this,wt,"m",Lt).call(this,t);if(null===n)return console.error(`Could not bind another uniform buffer object. Max (${t.MAX_UNIFORM_BUFFER_BINDINGS}) was reached.`),null;const s=t.getUniformBlockIndex(a,e);if(s===t.INVALID_INDEX)return console.error(`Block '${e}' does not identify a valid uniform block.`),null;t.uniformBlockBinding(a,s,n);const i=t.getActiveUniformBlockParameter(a,s,t.UNIFORM_BLOCK_DATA_SIZE),o={},l=t.getActiveUniformBlockParameter(a,s,t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES);return t.getActiveUniforms(a,l,t.UNIFORM_OFFSET).forEach(((r,e)=>{const n=l[e],s=t.getActiveUniform(a,n);if(null!==s){let{name:t}=s;const e=t.indexOf("[");e>-1?(t=t.substring(0,e),void 0===o[t]&&(o[t]={offset:r})):o[t]={offset:r}}})),{name:e,bindingPoint:n,blockSize:i,layout:o,program:r}}static createUniformBuffer(t,r,e){const a=t.createBuffer();if(null==a)return console.error("Could not create WebGLBuffer."),null;const n=t.UNIFORM_BUFFER;t.bindBuffer(n,a),e=null!=e?e:x.DYNAMIC_DRAW;const s=new ArrayBuffer(r);return t.bufferData(n,s,e),{internal:a,target:n,usage:e,data:s}}static createRangedUniformBuffers(t,r,e){const a=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT),n=r.reduce(((t,r)=>t+Math.max(Math.ceil(r.blockSize/a),1)*a),0);n>t.getParameter(t.MAX_UNIFORM_BLOCK_SIZE)&&console.error("Uniform block size is beyond MAX_UNIFORM_BLOCK_SIZE.");const s=this.createUniformBuffer(t,n,e);if(null==s)return null;let i={},o=0;return r.forEach((t=>{const{blockSize:r,name:e}=t;i[e]={...s,rangeOffset:o,rangeSize:r},o+=Math.max(Math.ceil(r/a),1)*a})),i}static setUniformBufferValues(t,r,e,a){const{internal:n}=e;t.getParameter(t.UNIFORM_BUFFER_BINDING)!==n&&t.bindBuffer(t.UNIFORM_BUFFER,n);const{layout:s}=r;Object.entries(a).forEach((([r,a])=>{var n;const{value:i}=a,{offset:o}=s[r];t.bufferSubData(t.UNIFORM_BUFFER,o+(null!==(n=e.rangeOffset)&&void 0!==n?n:0),Ut.asArrayBufferView(i))}))}static bindUniformBuffer(t,r,e){const{data:a,internal:n}=e,{bindingPoint:s}=r,{byteLength:i}=a;let{rangeOffset:o,rangeSize:l}=e;o?(l=null!=l?l:i-o,t.bindBufferRange(t.UNIFORM_BUFFER,s,n,o,l)):t.bindBufferBase(t.UNIFORM_BUFFER,s,n)}}wt=Yt,Lt=function(t){const r=t.MAX_UNIFORM_BUFFER_BINDINGS;let e=Xt(this,wt,"f",Ft).get(t);void 0===e&&(e=new Array(r),Xt(this,wt,"f",Ft).set(t,e));for(let t=1;t<r;t++)if(!e[t])return e[t]=!0,t;return-1},Ft={value:new Map};class zt{static createBindings(t,r){const e={},a={},{textures:n,uniformBlocks:s,program:i}=r;return void 0!==n&&n.forEach((r=>{const a=Ot.createTexture(t,r);null!==a&&(e[r]=a)})),void 0!==s&&s.forEach((r=>{const e=Yt.createUniformBlock(t,i,r);null!==e&&(a[r]=e)})),{textures:e,uniformBlocks:a}}static createPacket(t,r,e){var a,n;const{options:s,vertexArray:i,uniforms:o,uniformBlocks:l,textures:u}=e,c=(null==s?void 0:s.drawMode)||V.TRIANGLES,h=null==s?void 0:s.instanceCount;let E,_;if(void 0!==i&&(E=null!==(a=j.createVertexArray(t,r,i))&&void 0!==a?a:void 0,null==E))return null;if(void 0!==o){if(_=null!==(n=Ut.getUniformsListSetter(t,r,o))&&void 0!==n?n:void 0,null==_)return null;Ut.setUniformsListValues(t,_,o)}let y={};return void 0!==l&&l.forEach((r=>{const{block:e,buffer:a,uniforms:n}=r,{blockSize:s,name:i}=e;let o=null;if(a){const{usage:r}=a;o="internal"in a?a:Yt.createUniformBuffer(t,r,s)}else o=Yt.createUniformBuffer(t,s);if(null==o)return null;void 0!==n&&Yt.setUniformBufferValues(t,e,o,n),Yt.bindUniformBuffer(t,e,o),y[i]={block:e,buffer:o}})),void 0!==u&&u.forEach((r=>{const{properties:e,texture:a}=r;void 0!==e&&Ot.setTextureProperties(t,a,e)})),{vertexArray:E,uniformsSetter:_,uniformBlocks:y,drawMode:c,instanceCount:h}}static setPacketValues(t,r,e){const{vertexArray:a,uniforms:n,uniformBlocks:s}=e,{vertexArray:i,uniformsSetter:o}=r;a&&i&&j.setVertexArrayValues(t,i,a),n&&o&&Ut.setUniformsListValues(t,o,n),s&&s.forEach((r=>{const{block:e,buffer:a,uniforms:n}=r;Yt.setUniformBufferValues(t,e,a,n)}))}static drawPacket(t,r){const{vertexArray:e,uniformBlocks:a}=r;if(a&&Object.values(a).forEach((r=>{const{block:e,buffer:a}=r;Yt.bindUniformBuffer(t,e,a)})),e){const{drawMode:a,instanceCount:n}=r;j.drawVertexArray(t,e,a,n)}else console.error("No vertex array to draw.")}}!function(t){t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(bt||(bt={})),function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"}(Bt||(Bt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(xt||(xt={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Dt||(Dt={})),function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX"}(Gt||(Gt={})),function(t){t[t.BLEND=3042]="BLEND",t[t.CULL_FACE=2884]="CULL_FACE",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD"}(Vt||(Vt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(kt||(kt={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(Ht||(Ht={}));class Wt{static frontFace(t,r){t.frontFace(r)}static scissor(t,r,e,a,n){t.scissor(r,e,a,n)}static viewport(t,r,e,a,n){t.viewport(r,e,a,n)}static clearColor(t,r){t.clearColor(r[0],r[1],r[2],r[3])}static depthFunction(t,r){t.depthFunc(r)}static blendEquation(t,r){t.blendEquation(r)}static blendFunction(t,r,e){t.blendFunc(r,e)}static stencilFunction(t,r,e,a,n){t.stencilFuncSeparate(n,r,e,a)}static stencilOperations(t,r,e,a,n){t.stencilOpSeparate(n,r,e,a)}static stencilMask(t,r,e){t.stencilMaskSeparate(e,r)}static colorMask(t,r,e,a,n){t.colorMask(r,e,a,n)}static enable(t,r){t.enable(r)}static disable(t,r){t.disable(r)}static clear(t,r){t.clear(r)}static getViewport(t){return t.getParameter(t.VIEWPORT)}static getMaxSamples(t){return t.getParameter(t.MAX_SAMPLES)}}class jt{constructor(t){this._array=new(t||Uint8Array)(9)}static rgb(t,r,e){const a=new jt;return a.setValues([t,r,e,255]),a}static rgba(t,r,e,a){const n=new jt;return n.setValues([t,r,e,a]),n}static array(...t){const r=new Array(4*t.length);let e,a=0;for(const n of t)e=n._array,r[a+0]=e[0],r[a+1]=e[1],r[a+2]=e[2],r[a+3]=e[3],a+=4;return r}get array(){return this._array}get r(){return this._array[0]}set r(t){this._array[0]=t}get g(){return this._array[1]}set g(t){this._array[1]=t}get b(){return this._array[2]}set b(t){this._array[2]=t}get a(){return this._array[3]}set a(t){this._array[3]=t}setValues(t){const r=this._array;return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],this}getValues(){const t=this._array;return[t[0],t[1],t[2],t[3]]}copy(t){const r=this._array;return r[0]=t.r,r[1]=t.g,r[2]=t.b,r[3]=t.a,this}clone(){return(new jt).copy(this)}lerp(t,r){const e=this._array,a=t._array;return e[0]=r*(a[0]-e[0]),e[1]=r*(a[1]-e[1]),e[2]=r*(a[2]-e[2]),e[3]=r*(a[3]-e[3]),this}valuesNormalized(){return[this.r/255,this.g/255,this.b/255,this.a/255]}}jt.BLACK=jt.rgb(0,0,0),jt.RED=jt.rgb(255,0,0),jt.GREEN=jt.rgb(0,255,0),jt.BLUE=jt.rgb(0,0,255),jt.WHITE=jt.rgb(255,255,255);const qt=jt;function Zt(t,r){return[{name:`${r} X`,type:"range",value:0,min:-10,max:10,setter:function(r){"data"in this||(this.data={}),"number"==typeof this.data.lastValue&&t.translate(l.right.clone().scale(this.data.lastValue).negate()),this.data.lastValue=r,t.translate(l.right.clone().scale(r))}},{name:`${r} Y`,type:"range",value:0,min:-10,max:10,setter:function(r){"data"in this||(this.data={}),"number"==typeof this.data.lastValue&&t.translate(l.up.clone().scale(this.data.lastValue).negate()),this.data.lastValue=r,t.translate(l.up.clone().scale(r))}},{name:`${r} Z`,type:"range",value:0,min:-10,max:10,setter:function(r){"data"in this||(this.data={}),"number"==typeof this.data.lastValue&&t.translate(l.forward.clone().scale(this.data.lastValue).negate()),this.data.lastValue=r,t.translate(l.forward.clone().scale(r))}}]}function $t(t,r){return[{name:`${r} right`,type:"range",value:0,min:-10,max:10,setter:function(r){t.translate(t.getRight(new o).scale(r).clone())}},{name:`${r} up`,type:"range",value:0,min:-10,max:10,setter:function(r){t.translate(t.getUp(new o).scale(r).clone())}},{name:`${r} forward`,type:"range",value:0,min:-10,max:10,setter:function(r){t.translate(t.getForward(new o).scale(r).clone())}}]}var Kt;!function(t){t[t.vertices=0]="vertices",t[t.indices=1]="indices",t[t.uvs=2]="uvs",t[t.facesNormals=3]="facesNormals",t[t.verticesNormals=4]="verticesNormals",t[t.tangents=5]="tangents",t[t.bitangents=6]="bitangents"}(Kt||(Kt={}));class Qt extends class{constructor(){}}{constructor(t){super();const{radius:r,widthSegments:e,heightSegments:a,phiStart:n,phiLength:s,thetaStart:i,thetaLength:o}=null!=t?t:{};this.radius=null!=r?r:1,this.widthSegments=null!=e?e:32,this.heightSegments=null!=a?a:16,this.phiStart=null!=n?n:0,this.phiLength=null!=s?s:2*Math.PI,this.thetaStart=null!=i?i:0,this.thetaLength=null!=o?o:Math.PI}toBuilder(){const t=new ot,{radius:r,phiStart:e,phiLength:a,thetaStart:n,thetaLength:s}=this;let{widthSegments:i,heightSegments:o}=this;i=Math.max(3,Math.floor(i)),o=Math.max(2,Math.floor(o));const l=Math.min(n+s,Math.PI),u=[],c=[],h=[],E=[];let _=0;for(let t=0;t<=o;t++){const c=[],y=t/o;let A=0;0==t&&0==n?A=.5/i:t==o&&l==Math.PI&&(A=-.5/i);for(let t=0;t<=i;t++){const o=t/i;h.push(-r*Math.cos(e+o*a)*Math.sin(n+y*s),r*Math.cos(n+y*s),r*Math.sin(e+o*a)*Math.sin(n+y*s)),E.push(o+A,1-y),c.push(_++)}u.push(c)}for(let t=0;t<o;t++)for(let r=0;r<i;r++){const e=u[t][r+1],a=u[t][r],s=u[t+1][r],i=u[t+1][r+1];(0!==t||n>0)&&c.push(e,a,i),(t!==o-1||l<Math.PI)&&c.push(a,s,i)}const{length:y}=c,A=[],T=[];for(let r=0;r<y;r+=3){const e=3*c[r],a=3*c[r+1],n=3*c[r+2],s=2*c[r],i=2*c[r+1],o=2*c[r+2];let l=A[e],u=A[a],_=A[n];null==l&&(l=t.addVertex([h[e],h[e+1],h[e+2]]),A[e]=l),null==u&&(u=t.addVertex([h[a],h[a+1],h[a+2]]),A[a]=u),null==_&&(_=t.addVertex([h[n],h[n+1],h[n+2]]),A[n]=_);let y=T[s],f=T[i],R=T[o];null==y&&(y=[E[s],E[s+1]],T[s]=y),null==f&&(f=[E[i],E[i+1]],T[i]=f),null==R&&(R=[E[o],E[o+1]],T[o]=R),t.addTriangleFace(l,u,_,{uv:[y,f,R]})}return t}}async function Jt(){const t=document.createElement("template");t.innerHTML='\n\x3c!--<link rel="stylesheet" href="./css/main.css"/>--\x3e\n  <div class="flex-auto flex-cols">\n    <main class="flex-rows flex-auto">\n        <section class="centered padded">\n          <div id="ui" class="flex-cols">\n            <div class="flex-none">FPS: <span id="canvas-fps">-.-</span><button id="playpause">Pause</button></div>\n          </div>\n          <div id="widgets"></div>\n          <canvas id="canvas" tabindex="0" tooltip="mon-canvas" oncontextmenu="return false;"></canvas>\n          <style>\n            circle:hover {\n              fill: rgb(255, 0, 0);\n            }\n          </style>\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">\n            <circle cx="10" cy="10" r="4"/>\n          </svg>\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="200" height="200" id="save" fill="none">\n            <g>\n              <rect x="0" y="0" width="100" height="100" fill="red"></rect>\n              <text text-anchor="middle" alignment-baseline="middle" x="50" y="50" font-family="Verdana" fill="blue">Hello,World!</text>\n            </g>\n          </svg>\n        </section>\n    </main>\n  </div>',document.body.insertBefore(t.content,document.body.firstChild);let r=!1;const e=document.querySelector("svg");e.addEventListener("pointerdown",(t=>{const{target:e,pointerId:a}=t;e.setPointerCapture(a),r=!0})),e.addEventListener("pointermove",(t=>{if(r){const{currentTarget:r,clientX:e,clientY:a}=t,n=r,{right:s,left:i,width:o,bottom:l,top:u,height:c}=n.getBoundingClientRect(),{target:h,movementX:E,movementY:_}=t,y=h,[A,T,f,R]=n.getAttribute("viewBox").split(" ").map((t=>parseFloat(t))),m=(Math.min(s,Math.max(e,i))-i)/o,d=(Math.min(l,Math.max(a,u))-u)/c,g=Math.round(m*(f-A)),N=Math.round(d*(R-T));y.setAttribute("cx",`${g}`),y.setAttribute("cy",`${N}`)}})),e.addEventListener("pointerup",(t=>{const{target:e,pointerId:a}=t;e.releasePointerCapture(a),r=!1})),e.addEventListener("pointerout",(t=>{const{target:e,pointerId:a}=t;e.releasePointerCapture(a),r=!1}));try{!async function(){let t,r,e=0,a=!1;const s=document.getElementById("playpause");null!==s&&(s.onclick=()=>{a=!a,s.textContent=a?"Play":"Pause",a||r(0)});const u=document.getElementById("canvas-fps");if(!u)return;const c=document.getElementById("canvas");if(!c)return;c.width=800,c.height=600,c.style.width="800px",c.style.height="600px";const E=c.getContext("webgl2");if(!E)return;const _=await fetch("assets/engine/shaders/common/phong.vert.glsl").then((t=>t.text())),y=await fetch("assets/engine/shaders/common/phong.frag.glsl").then((t=>t.text())),f=W.createProgram(E,{vertexSource:_,fragmentSource:y}),R=await fetch("assets/engine/shaders/common/skybox.vert").then((t=>t.text())),m=await fetch("assets/engine/shaders/common/skybox.frag").then((t=>t.text())),d=W.createProgram(E,{vertexSource:R,fragmentSource:m}),g=await fetch("assets/engine/shaders/common/texture.vert").then((t=>t.text())),N=await fetch("assets/engine/shaders/common/texture.frag").then((t=>t.text())),p=W.createProgram(E,{vertexSource:g,fragmentSource:N}),I=await fetch("assets/engine/shaders/common/basic.vert.glsl").then((t=>t.text())),S=await fetch("assets/engine/shaders/common/basic.frag.glsl").then((t=>t.text())),v=W.createProgram(E,{vertexSource:I,fragmentSource:S}),O=await fetch("assets/engine/shaders/common/depth.vert.glsl").then((t=>t.text())),U=await fetch("assets/engine/shaders/common/depth.frag.glsl").then((t=>t.text())),w=W.createProgram(E,{vertexSource:O,fragmentSource:U});async function L(t){return fetch(t).then((r=>{if(r.ok)return new Promise((r=>{const e=new Image;e.onload=()=>{r(e)},e.src=t}));throw new Error(`Image '${t}' not found.`)}))}const b=await L("assets/engine/img/brickwall.jpg"),B=await L("assets/engine/img/NormalMap_0.png"),D=await L("assets/engine/img/HeightMap_0.png"),G=await L("assets/engine/img/skybox_x_pos.png"),V=await L("assets/engine/img/skybox_x_neg.png"),k=await L("assets/engine/img/skybox_y_pos.png"),X=await L("assets/engine/img/skybox_y_neg.png"),Y=await L("assets/engine/img/skybox_z_pos.png"),q=await L("assets/engine/img/skybox_z_neg.png"),Z=zt.createBindings(E,{program:f,textures:["albedoMap","normalMap","heightMap","skybox","fbColorTex","depthTex"],uniformBlocks:["worldViewBlock","lightsBlock","phongBlock"]}),$=zt.createBindings(E,{program:v,uniformBlocks:["basicBlock"]}),{worldViewBlock:K,lightsBlock:Q,phongBlock:J}=Z.uniformBlocks,tt=Yt.createRangedUniformBuffers(E,[K,Q,J],x.DYNAMIC_DRAW),{basicBlock:rt}=$.uniformBlocks,{albedoMap:st,normalMap:it,heightMap:ot,skybox:lt,fbColorTex:ut,depthTex:ct}=Z.textures,_t=E.getExtension("EXT_texture_filter_anisotropic");if(_t){console.log("Extension EXT_texture_filter_anisotropic activated.");const t=E.getParameter(_t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);[st,it].forEach((r=>{E.activeTexture(E.TEXTURE0+r.unit),E.bindTexture(E.TEXTURE_2D,r.internal),E.texParameterf(E.TEXTURE_2D,_t.TEXTURE_MAX_ANISOTROPY_EXT,t)}))}const yt=new Qt({widthSegments:64,heightSegments:64}).toBuilder(),At=new ht({height:2,width:2}).toBuilder(),Tt=new F,dt=1/3*Math.PI,Mt=E.canvas.width/E.canvas.height,Pt=new z(dt,Mt,.1,100),St=new F;St.setTranslation(new o([0,2,2])),St.setScaling(new o([.2,.2,.2])),Pt.transform.setTranslation(St.getTranslation(new o).scale(2)),Pt.transform.lookAt(new o([0,0,0]),l.up);const vt=Pt.projection.clone().mult((new C).setIdentity().setRotation(Pt.view.getRotation())).invert();var Ct,Ot;!function(t){const r=document.getElementById("widgets");r&&t.forEach((t=>{let e=null,a=null,n=document.createElement("label");switch(n.textContent=t.name,t.type){case"range":e=document.createElement("input"),e.type="range",void 0!==t.min&&(e.min=t.min.toString()),void 0!==t.max&&(e.max=t.max.toString()),e.value=t.value.toString(),a=document.createElement("output"),a.value=t.value.toString(),e.onchange=r=>{const e=r.currentTarget.value;t.setter.call(t,parseFloat(e)),a.value=e};break;case"checkbox":e=document.createElement("input"),e.type="checkbox",e.value=t.value.toString(),e.onclick=r=>{t.setter.call(t,r.currentTarget.checked)};break;case"select":e=document.createElement("select"),e.value=t.value.toString(),e.append(...t.options.map((t=>new Option(t.label,t.value)))),e.onchange=r=>{t.setter.call(t,r.currentTarget.value)};break;case"button":e=document.createElement("input"),e.value=t.name,e.type="button",e.onclick=()=>{t.trigger.call(t)}}e&&(r.append(n,e),a&&r.append(a))}))}([...(Ct=Tt,Ot="Cube",[{name:`${Ot} roll`,type:"range",value:0,min:-360,max:360,setter:function(t){const r=Ct.getRotation(new P).getMatrix();if("data"in this||(this.data={lastValue:0}),"number"==typeof this.data.lastValue){const t=M.rotationX(this.data.lastValue*(Math.PI/180));r.mult(t.transpose())}this.data.lastValue=t;const e=P.fromMatrix(r.mult(M.rotationX(t*(Math.PI/180))));Ct.setRotation(P.fromEuler(e.pitch,e.yaw,e.roll))}},{name:`${Ot} pitch`,type:"range",value:0,min:-360,max:360,setter:function(t){const r=Ct.getRotation(new P).getMatrix();if("data"in this||(this.data={lastValue:0}),"number"==typeof this.data.lastValue){const t=M.rotationY(this.data.lastValue*(Math.PI/180));r.mult(t.transpose())}this.data.lastValue=t;const e=P.fromMatrix(r.mult(M.rotationY(t*(Math.PI/180))));Ct.setRotation(P.fromEuler(e.pitch,e.yaw,e.roll))}},{name:`${Ot} yaw`,type:"range",value:0,min:-360,max:360,setter:function(t){const r=Ct.getRotation(new P).getMatrix();if("data"in this||(this.data={lastValue:0}),"number"==typeof this.data.lastValue){const t=M.rotationZ(this.data.lastValue*(Math.PI/180));r.mult(t.transpose())}this.data.lastValue=t;const e=P.fromMatrix(r.mult(M.rotationZ(t*(Math.PI/180))));Ct.setRotation(P.fromEuler(e.pitch,e.yaw,e.roll))}}]),...Zt(Tt,"Cube"),...$t(Tt,"Cube"),...$t(Pt.transform,"Camera")]);const Ut=yt.verticesArray(),wt=yt.indicesArray(),Ft=yt.verticesNormalsArray(),Lt=yt.uvsArray(),bt=yt.tangentsArray(),Dt=new class{constructor(t,r=!1,e=x.STATIC_DRAW){const a=Object.values(t),n=a.reduce(((t,r)=>t+r.array.byteLength),0),s=new ArrayBuffer(n),i=r?a.reduce(((t,r)=>{const{array:e,type:a}=r;return t+e.BYTES_PER_ELEMENT*j.getAttributeDataTypeElementsSize(a)}),0):0,o=Math.trunc(n/i);this.attributes={},this.interleaved=r,this.stride=i,this.buffer=s,this.usage=e;let l=0;r?Object.entries(t).forEach((([t,r])=>{const{array:e,type:a}=r,n=j.getAttributeArrayDataComponentType(e),u=j.getAttributeDataTypeElementsSize(a),c=j.getDataComponentTypeArrayConstructor(j.getAttributeArrayDataComponentType(e)),{BYTES_PER_ELEMENT:h}=e,{length:E}=e,_=new c(s,l),y=i/h;for(let t=0;t<o;t++){let r=t*u;_.set(e.slice(r,r+u),t*y)}this.attributes[t]={type:a,byteOffset:l,count:E,componentType:n},l+=u*h})):Object.entries(t).forEach((([t,r])=>{const{array:e,type:a}=r,{length:n}=e,{byteLength:i}=e,o=j.getAttributeArrayDataComponentType(e);new(j.getDataComponentTypeArrayConstructor(j.getAttributeArrayDataComponentType(e)))(s,l).set(e),this.attributes[t]={byteOffset:l,count:n,type:a,componentType:o},l+=i}))}getAttribute(t){const r=this.attributes[t];if(r){const{count:t,type:e,byteOffset:a,componentType:n}=r,s=j.getDataComponentTypeArrayConstructor(n),i=j.getAttributeDataTypeElementsSize(e),o=this.buffer.byteLength,l=this.interleaved,{BYTES_PER_ELEMENT:u}=s,c=new s(t);if(l){const t=new s(this.buffer,a),r=this.stride,e=Math.trunc(o/r),n=r/u;for(let r=0;r<e;r++){let e=n*r;c.set(t.slice(e,e+i),i*r)}}else{const r=new s(this.buffer,a,t);c.set(r)}return{array:c,type:e}}return null}}({a_position:{array:Ut,type:H.VEC3},a_normal:{array:Ft,type:H.VEC3},a_tangent:{array:bt,type:H.VEC3},a_uv:{array:Lt,type:H.VEC2}},!0),Gt={vertexArray:{attributes:{a_position:Dt.getAttribute("a_position"),a_normal:Dt.getAttribute("a_normal"),a_tangent:Dt.getAttribute("a_tangent"),a_uv:Dt.getAttribute("a_uv")},indices:wt,elementsCount:wt.length,interleave:!0},uniformBlocks:[{block:K,buffer:tt.worldViewBlock,uniforms:{u_model:{value:Tt.matrix.array},u_modelView:{value:Pt.view.mult(Tt.matrix).array},u_normal:{value:Pt.view.mult(Tt.matrix).invert().transpose().array},u_view:{value:Pt.view.array},u_camera:{value:Pt.transform.matrix.array},u_projection:{value:Pt.projection.array}}},{block:Q,buffer:tt.lightsBlock,uniforms:{u_lightWorldPos:{value:Array.from(St.getTranslation(new o))},u_lightColor:{value:[1,.8,.8]}}},{block:J,buffer:tt.phongBlock,uniforms:{u_ambientColor:{value:[.1,.1,.1]},u_diffuseColor:{value:[.8,0,0]},u_specularColor:{value:[1,1,1]},u_ambientFactor:{value:1},u_diffuseFactor:{value:1},u_specularFactor:{value:1},u_shininess:{value:36}}}],uniforms:{u_albedoMap:{value:st},u_normalMap:{value:it},u_heightMap:{value:ot}},textures:[{texture:st,properties:{pixels:b,width:b.width,height:b.height,target:gt.TEXTURE_2D,type:mt.UNSIGNED_BYTE,format:ft.RGBA,internalFormat:Rt.RGBA8}},{texture:it,properties:{pixels:B,width:B.width,height:B.height,target:gt.TEXTURE_2D,type:mt.UNSIGNED_BYTE,format:ft.RGB,internalFormat:Rt.RGB8,min:pt.LINEAR_MIPMAP_LINEAR,mag:Nt.LINEAR}},{texture:ot,properties:{pixels:D,width:D.width,height:D.height,target:gt.TEXTURE_2D,type:mt.UNSIGNED_BYTE,format:ft.RGBA,internalFormat:Rt.RGBA8}},{texture:lt,properties:{pixels:{xPos:G,xNeg:V,yPos:k,yNeg:X,zPos:Y,zNeg:q},width:G.width,height:G.height,target:gt.TEXTURE_CUBE_MAP,type:mt.UNSIGNED_BYTE,format:ft.RGBA,internalFormat:Rt.RGBA8}},{texture:ut,properties:{width:c.width,height:c.height,pixels:null,target:gt.TEXTURE_2D,type:mt.UNSIGNED_BYTE,format:ft.RGBA,internalFormat:Rt.RGBA8,mag:Nt.LINEAR,min:pt.LINEAR,wrapS:It.CLAMP_TO_EDGE,wrapT:It.CLAMP_TO_EDGE,wrapR:It.CLAMP_TO_EDGE}},{texture:ct,properties:{width:c.width,height:c.height,pixels:null,target:gt.TEXTURE_2D,type:mt.UNSIGNED_INT,format:ft.DEPTH_COMPONENT,internalFormat:Rt.DEPTH_COMPONENT24,wrapS:It.CLAMP_TO_EDGE,wrapT:It.CLAMP_TO_EDGE,wrapR:It.CLAMP_TO_EDGE,mag:Nt.NEAREST,min:pt.NEAREST}}]},kt={vertexArray:{attributes:{a_position:{array:Ut,type:H.VEC3}},indices:wt,elementsCount:wt.length},uniformBlocks:[{block:rt,uniforms:{u_model:{value:St.matrix.array},u_viewProjection:{value:Pt.viewProjection.array},u_color:{value:[1,1,0]}}}]},Ht=At.indicesArray(),Xt=At.verticesArray(),jt=At.uvsArray(),Kt=(new C).setIdentity(),Jt={vertexArray:{attributes:{a_position:{array:Xt,type:H.VEC3}},indices:Ht,elementsCount:Ht.length},uniforms:{u_world:{value:Kt.array},u_viewDirectionProjectionInverse:{value:vt.array},u_skybox:{value:lt}}},tr={vertexArray:{attributes:{a_position:{array:Xt,type:H.VEC3},a_uv:{array:jt,type:H.VEC2}},indices:Ht,elementsCount:Ht.length},uniforms:{u_world:{value:Kt.array},u_tex:{value:ct}}},rr={vertexArray:{attributes:{a_position:{array:Xt,type:H.VEC3},a_uv:{array:jt,type:H.VEC2}},indices:Ht,elementsCount:Ht.length},uniforms:{u_world:{value:Kt.array},u_tex:{value:ut}}},er=zt.createPacket(E,v,kt),ar=zt.createPacket(E,f,Gt),nr=zt.createPacket(E,d,Jt),sr=(zt.createPacket(E,w,tr),zt.createPacket(E,p,rr)),ir=Et.createFramebuffer(E),or=Wt.getMaxSamples(E);Et.attachRenderbuffer(E,ir,{renderbuffer:Et.createRenderbuffer(E,{internalFormat:nt.DEPTH_COMPONENT24,width:c.width,height:c.height,samples:or}),attachment:at.DEPTH_ATTACHMENT},{renderbuffer:Et.createRenderbuffer(E,{internalFormat:nt.RGBA8,width:c.width,height:c.height,samples:or}),attachment:at.COLOR_ATTACHMENT0});const lr=Et.createFramebuffer(E);Et.attachTexture(E,lr,{textureTarget:et.TEXTURE_2D,texture:ut,attachment:at.COLOR_ATTACHMENT0},{textureTarget:et.TEXTURE_2D,texture:ct,attachment:at.DEPTH_ATTACHMENT}),Wt.viewport(E,0,0,E.canvas.width,E.canvas.height),Wt.enable(E,Vt.DEPTH_TEST),Wt.enable(E,Vt.CULL_FACE);let ur=0,cr=0,hr=0,Er=Tt.getRotation(new P);Tt.getTranslation(new o);new o([2,-2,-2]);const _r=P.fromAxisAngle(l.down,Math.PI/3);T.initialize(E.canvas),Et.unbindFramebuffer(E);const yr=new class{constructor(t,r){var e,a;A.set(this,void 0),this.camera=t,this.rotationSpeed=null!==(e=null==r?void 0:r.rotationSpeed)&&void 0!==e?e:50,this.translationSpeed=null!==(a=null==r?void 0:r.translationSpeed)&&void 0!==a?a:8,function(t,r,e,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof r?t!==r||!n:!r.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===a?n.call(t,e):n?n.value=e:r.set(t,e)}(this,A,new n,"f")}update(t){const r=this.camera.transform,e=r.getTranslation(new o),a=r.getBackward(new o),n=a.array,s=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)}(this,A,"f"),u=this.rotationSpeed,c=this.translationSpeed;let E=r.getUp(new o).dot(l.up);if(T.getKey(i.Z)||T.getKey(i.ARROW_UP)){const e=r.getBackward(new o).scale(c*t);r.translate(e)}if(T.getKey(i.Q)||T.getKey(i.ARROW_LEFT)){const e=r.getLeft(new o).scale(c*t);r.translate(e)}if(T.getKey(i.S)||T.getKey(i.ARROW_DOWN)){const e=r.getForward(new o).scale(c*t);r.translate(e)}if(T.getKey(i.D)||T.getKey(i.ARROW_RIGHT)){const e=r.getRight(new o).scale(c*t);r.translate(e)}if(T.getMouseButtonDown(h.RIGHT)&&s.copy(T.getPointerScreenPosition()),T.getMouseButton(h.RIGHT)){const i=T.getPointerScreenPosition();if(!i.equals(s)){const c=(s.x-i.x)*u*t,h=(s.y-i.y)*u*t;if(e.copy(r.getTranslation(new o)),0!==c||0!==h){E=Math.sign(r.getUp(new o).dot(l.up)),a.toSpherical(l.origin);const t=n[1],s=n[2],i=t+E*-h;i<=0||i>=Math.PI?(n[2]=(s-c+Math.PI)%(2*Math.PI),n[1]=i<0?-i:Math.PI-(i-Math.PI),E*=-1):(n[2]=(s-c)%(2*Math.PI),n[1]=t+E*-h),a.toCartesian(l.origin),r.lookAt(e.add(a),E>0?l.up:l.down)}s.copy(i)}}}}(Pt);r=function(n){a||(cr=(n*=.001)-ur,ur=n,e=1/cr,u.textContent=e.toFixed(0),yr.update(cr),function(t,r,e,a,n,s){t.setRotation(t.getRotation(new P).slerp(e,n,s))}(Tt,0,Er,0,_r,hr),hr+=1*cr*.5,Wt.clearColor(E,qt.GREEN.valuesNormalized()),Wt.clear(E,Bt.COLOR_BUFFER_BIT|Bt.DEPTH_BUFFER_BIT),vt.copy(Pt.projection).mult((new C).setIdentity().setRotation(Pt.view.getRotation())).invert(),Et.bindFramebuffer(E,ir),Wt.clear(E,Bt.COLOR_BUFFER_BIT|Bt.DEPTH_BUFFER_BIT),Wt.depthFunction(E,xt.LESS),zt.setPacketValues(E,ar,{uniformBlocks:[{block:K,buffer:ar.uniformBlocks.worldViewBlock.buffer,uniforms:{u_model:{value:Tt.matrix.array},u_modelView:{value:Pt.view.mult(Tt.matrix).array},u_camera:{value:Pt.transform.matrix.array},u_view:{value:Pt.view.array},u_normal:{value:Pt.view.mult(Tt.matrix).invert().transpose().array},u_projection:{value:Pt.projection.array}}}]}),zt.drawPacket(E,ar),zt.setPacketValues(E,er,{uniformBlocks:[{block:rt,buffer:er.uniformBlocks.basicBlock.buffer,uniforms:{u_viewProjection:{value:Pt.viewProjection.array}}}]}),zt.drawPacket(E,er),zt.setPacketValues(E,nr,{uniforms:{u_viewDirectionProjectionInverse:{value:vt.array}}}),Wt.depthFunction(E,xt.LEQUAL),zt.drawPacket(E,nr),Et.blit(E,ir,lr,[0,0,c.width,c.height],[0,0,c.width,c.height],Bt.COLOR_BUFFER_BIT,Nt.LINEAR),Et.unbindFramebuffer(E),zt.drawPacket(E,sr),T.clear(),t=requestAnimationFrame(r))},r(0)}()}catch(t){console.trace(t)}}async function tr(){Jt()}})(),main=r})();
//# sourceMappingURL=main.js.map