var main;(()=>{"use strict";var t={d:(r,e)=>{for(var a in e)t.o(e,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:e[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{t.r(r),t.d(r,{main:()=>bt});const e=class{constructor(t){this._defaultCtor=t.defaultCtor,this._onDefaultOverride=t.onDefaultOverride,this._constructors=new Map}get defaultCtor(){return this._defaultCtor}overrideDefaultCtor(t){this._defaultCtor=t,this._onDefaultOverride(t)}forceQualifier(t){this._forcedQualifier=t}unforceQualifier(){delete this._forcedQualifier}getConstructor(t){const r=this._forcedQualifier||t;if(void 0===r)return this._defaultCtor;const e=this._constructors.get(r);if(void 0===e)throw new Error(`No constructor for qualifier ${r}`);return e}inject(t){const r=this.getConstructor(null==t?void 0:t.qualifier);return(null==t?void 0:t.args)?new r(...Array.from(t.args)):new r}register(t,r){this._constructors.has(r)||this._constructors.set(r,t)}};class a extends Error{constructor(){super(...arguments),this.name="MathError"}}class s{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1]]);else if("object"==typeof t[0]){const r=t[0];if(r.length<2)throw new a("Array must be of length 2 at least.");r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array([0,0])}get values(){return[this.array[0],this.array[1]]}set values(t){this.array[0]=t[0],this.array[1]=t[1]}get x(){return this.array[0]}set x(t){this.array[0]=t}get y(){return this.array[1]}set y(t){this.array[1]=t}setValues(t,r){const e=this.array;return e[0]=t,e[1]=r,this}equals(t){const r=t.array,e=this.array;return r[0]===e[0]&&r[1]===e[1]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],this}clone(){return new s(this.values)}setUnit(){const t=this.array;return t[0]=1,t[1]=1,this}setZeros(){const t=this.array;return t[0]=0,t[1]=0,this}add(t){const r=t.array,e=this.array;return e[0]=e[0]+r[0],e[1]=e[1]+r[1],this}addScalar(t){const r=this.array;return r[0]=r[0]+t,r[1]=r[1]+t,this}sub(t){const r=t.array,e=this.array;return e[0]=e[0]-r[0],e[1]=e[1]-r[1],this}lerp(t,r){const e=t.array,a=this.array;return a[0]=r*(e[0]-a[0]),a[1]=r*(e[1]-a[1]),this}clamp(t,r){const e=this.array,a=t.array,s=r.array;return e[0]=Math.min(s[0],Math.min(e[0],a[0])),e[1]=Math.min(s[1],Math.min(e[1],a[1])),this}multScalar(t){const r=this.array;return r[0]=r[0]*t,r[1]=r[1]*t,this}cross(t){const r=this.array,e=t.array;return r[0]*e[1]-r[1]*e[0]}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]}length(){const t=this.array;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}lengthSquared(){const t=this.array;return t[0]*t[0]+t[1]*t[1]}dist(t){const r=this.array,e=t.array,a=r[0]-e[0],s=r[1]-e[1];return Math.sqrt(a*a+s*s)}distSquared(t){const r=this.array,e=t.array,a=r[0]-e[0],s=r[1]-e[1];return a*a+s*s}normalize(){const t=this.array,r=t[0]*t[0]+t[1]*t[1],e=Math.sqrt(r);return e>Number.EPSILON?(t[0]=t[0]/e,t[1]=t[1]/e):(t[0]=0,t[1]=0),this}negate(){const t=this.array;return t[0]=-t[0],t[1]=-t[1],this}mult(t){if(t instanceof n){const r=t.array;return this.array[0]=this.array[0]*r[0],this.array[1]=this.array[1]*r[1],this}{const r=this.x,e=this.y,a=t.array;return this.x=r*a[0]+e*a[2],this.y=r*a[1]+e*a[3],this}}addScaled(t,r){const e=t.array,a=this.array;return a[0]=a[0]+e[0]*r,a[1]=a[1]+e[1]*r,this}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1]}readFromArray(t,r=0){const e=this.array;return e[0]=t[r],e[1]=t[r+1],this}copyAndSub(t,r){const e=this.array,a=t.array,s=r.array;return e[0]=a[0]-s[0],e[1]=a[1]-s[1],this}}var n=s;new e({defaultCtor:s,onDefaultOverride:t=>{n=t}});class i{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[2],t[1]]);else if("object"==typeof t[0]){const r=t[0];if(r.length<3)throw new a("Array must be of length 3 at least.");r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array([0,0,0])}toString(){return`Vector3([${Array.from(this.array).join(", ")}])`}static angle(t,r){const e=new h;return Math.acos(e.copy(t).dot(r)/(Math.sqrt(e.copy(t).dot(t))*Math.sqrt(e.copy(r).dot(r))))}get values(){return[this.array[0],this.array[1],this.array[2]]}set values(t){this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2]}get x(){return this.array[0]}set x(t){this.array[0]=t}get y(){return this.array[1]}set y(t){this.array[1]=t}get z(){return this.array[2]}set z(t){this.array[2]=t}setValues(t,r,e){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this}copy(t){const r=t.array;return this.array[0]=r[0],this.array[1]=r[1],this.array[2]=r[2],this}clone(){return new i(this.values)}equals(t){return t.array[0]===this.array[0]&&t.array[1]===this.array[1]&&t.array[2]===this.array[2]}setZeros(){return this.array[0]=0,this.array[1]=0,this.array[2]=0,this}setUnit(){return this.array[0]=1,this.array[1]=1,this.array[2]=1,this}add(t){return this.array[0]=this.array[0]+t.array[0],this.array[1]=this.array[1]+t.array[1],this.array[2]=this.array[2]+t.array[2],this}addScalar(t){return this.array[0]=this.array[0]+t,this.array[1]=this.array[1]+t,this.array[2]=this.array[2]+t,this}sub(t){return this.array[0]=this.array[0]-t.array[0],this.array[1]=this.array[1]-t.array[1],this.array[2]=this.array[2]-t.array[2],this}lerp(t,r,e){return this.array[0]=(1-e)*t.x+e*(r.x-t.x),this.array[1]=(1-e)*t.y+e*(r.y-t.y),this.array[2]=(1-e)*t.z+e*(r.z-t.z),this}max(t){return this.array[0]=Math.max(this.array[0],t.array[0]),this.array[1]=Math.max(this.array[1],t.array[1]),this.array[2]=Math.max(this.array[2],t.array[2]),this}min(t){return this.array[0]=Math.min(this.array[0],t.array[0]),this.array[1]=Math.min(this.array[1],t.array[1]),this.array[2]=Math.min(this.array[2],t.array[2]),this}clamp(t,r){return this.array[0]=Math.min(r.array[0],Math.max(this.array[0],t.array[0])),this.array[1]=Math.min(r.array[1],Math.max(this.array[1],t.array[1])),this.array[2]=Math.min(r.array[2],Math.max(this.array[2],t.array[2])),this}scale(t){return this.array[0]=this.array[0]*t,this.array[1]=this.array[1]*t,this.array[2]=this.array[2]*t,this}cross(t){const r=this.array[1]*t.array[2]-this.array[2]*t.array[1],e=this.array[2]*t.array[0]-this.array[0]*t.array[2],a=this.array[0]*t.array[1]-this.array[1]*t.array[0];return this.array[0]=r,this.array[1]=e,this.array[2]=a,this}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}length(){const t=this.array;return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}lengthSquared(){const t=this.array;return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}distance(t){const r=this.array,e=t.array,a=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];return Math.hypot(a,s,n)}distanceSquared(t){const r=this.array,e=t.array,a=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];return a*a+s*s+n*n}normalize(){const{array:t}=this,r=this.length();return r>Number.EPSILON?(t[0]/=r,t[1]/=r,t[2]/=r):(t[0]=0,t[1]=0,t[2]=0),this}negate(){return this.array[0]*=-1,this.array[1]*=-1,this.array[2]*=-1,this}mult(t){if(t instanceof h){const r=t.array;return this.array[0]=this.array[0]*r[0],this.array[1]=this.array[1]*r[1],this.array[2]=this.array[2]*r[2],this}{const r=this.x,e=this.y,a=this.z,s=t.array;return this.x=r*s[0]+e*s[3]+a*s[6],this.y=r*s[1]+e*s[4]+a*s[7],this.z=r*s[2]+e*s[5]+a*s[8],this}}toSpherical(t){const r=this.array,e=t.array,a=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2],i=Math.hypot(a,s,n),o=Math.acos(s/i),h=Math.atan2(n,a);return r[0]=i,r[1]=o,r[2]=h,this}toCartesian(t){const r=this.array,e=t.array,a=r[0],s=r[1],n=r[2],i=a*Math.sin(s)*Math.cos(n)+e[0],o=a*Math.cos(s)+e[1],h=a*Math.sin(s)*Math.sin(n)+e[2];return r[0]=i,r[1]=o,r[2]=h,this}static mult(t,r){const e=t.array,a=r.array;return new i([e[0]*a[0]+e[1]*a[1]+e[2]*a[2],e[3]*a[0]+e[4]*a[1]+e[5]*a[2],e[6]*a[0]+e[7]*a[1]+e[8]*a[2]])}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2]}readFromArray(t,r=0){return this.array[0]=t[r],this.array[1]=t[r+1],this.array[2]=t[r+2],this}addScaled(t,r){return this.array[0]=this.array[0]+t.array[0]*r,this.array[1]=this.array[1]+t.array[1]*r,this.array[2]=this.array[2]+t.array[2]*r,this}copyAndSub(t,r){const e=t.array,a=r.array;return this.array[0]=e[0]-a[0],this.array[1]=e[1]-a[1],this.array[2]=e[2]-a[2],this}copyAndCross(t,r){const e=t.array,a=r.array,s=e[1]*a[2]-e[2]*a[1],n=e[2]*a[0]-e[0]*a[2],i=e[0]*a[1]-e[1]*a[0];return this.array[0]=s,this.array[1]=n,this.array[2]=i,this}[Symbol.iterator](){const{array:t}=this,{length:r}=t;let e=0;return{next:()=>e<r?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}var o,h=i;new e({defaultCtor:i,onDefaultOverride:t=>{h=t}});class c{constructor(){}}c.origin=new h([0,0,0]),c.right=new h([1,0,0]),c.left=new h([-1,0,0]),c.up=new h([0,1,0]),c.down=new h([0,-1,0]),c.forward=new h([0,0,1]),c.backward=new h([0,0,-1]),function(t){t.A="a",t.B="b",t.C="c",t.D="d",t.E="e",t.F="f",t.G="g",t.H="h",t.I="i",t.J="j",t.K="k",t.L="l",t.M="m",t.O="o",t.P="p",t.Q="q",t.R="r",t.S="s",t.T="t",t.U="u",t.V="v",t.W="w",t.X="x",t.Y="y",t.Z="z",t.ENTER="Enter",t.BACKSPACE="Backspace",t.ARROW_DOWN="ArrowDown",t.ARROW_LEFT="ArrowLeft",t.ARROW_RIGHT="ArrowRight",t.ARROW_UP="ArrowUp",t.SHIFT="Shift"}(o||(o={}));const u=Object.keys(o).length;var l,y;!function(t){t.Alt="Alt",t.Control="Control",t.Shift="Shift"}(l||(l={})),function(t){t[t.LEFT=0]="LEFT",t[t.WHEEL=1]="WHEEL",t[t.RIGHT=2]="RIGHT",t[t.FORWARD=3]="FORWARD",t[t.BACK=4]="BACK"}(y||(y={}));const E=Object.keys(y).length,_=Object.freeze(Object.values(y).reduce(((t,r,e)=>Object.assign(t,{[r]:e})),{})),f=Object.freeze(Object.values(o).reduce(((t,r,e)=>Object.assign(t,{[r]:e})),{}));var A,T=new class{constructor(){this.keyFlags=new Array(3*u).fill(!1),this.mouseFlags=new Array(3*E).fill(!1),this.pointerPosition=new n,this.wheelDelta=0,this.canvas=null,this.canvasRectangle=null}initialize(t){this.canvas=t,this.canvasRectangle=t.getBoundingClientRect(),t.addEventListener("pointerdown",this),t.addEventListener("pointerup",this),t.addEventListener("contextmenu",this),t.addEventListener("pointermove",this),t.addEventListener("wheel",this),t.addEventListener("keydown",this),t.addEventListener("keyup",this),t.addEventListener("focusout",this)}getCanvasRect(){const t=this.canvasRectangle;if(null===t)throw new Error("Input manager not initialized.");return t}clear(){this.keyFlags.fill(!1,0,2*u),this.mouseFlags.fill(!1,0,2*E),this.wheelDelta=0}handleEvent(t){let r=-1;switch(t.type){case"pointerdown":r=_[t.button],this.mouseFlags[1*E+r]=!0,this.mouseFlags[2*E+r]=!0;break;case"pointerup":r=_[t.button],this.mouseFlags[0*E+r]=!0,this.mouseFlags[2*E+r]=!1;break;case"pointermove":const e=this.getCanvasRect();this.pointerPosition.setValues(t.clientX-e.left,t.clientY-e.top);break;case"wheel":this.wheelDelta=t.deltaY/100;break;case"keydown":r=f[t.key],this.keyFlags[1*u+r]=!0,this.keyFlags[2*u+r]=!0;break;case"keyup":r=f[t.key],this.keyFlags[0*u+r]=!0,this.keyFlags[2*u+r]=!1;break;case"focusout":this.keyFlags.fill(!1),this.mouseFlags.fill(!1),this.wheelDelta=0,this.pointerPosition.setZeros()}}getKey(t){return this.keyFlags[2*u+f[t]]}getKeyUp(t){return this.keyFlags[0*u+f[t]]}getKeyDown(t){return this.keyFlags[1*u+f[t]]}getMouseButton(t){return this.mouseFlags[2*E+_[t]]}getPointerPosition(){return this.pointerPosition.clone()}getPointerScreenPosition(){const t=this.pointerPosition.array,r=this.getCanvasRect(),e=t[0]/r.width*2-1,a=t[1]/r.height*2-1;return new n([e,a])}getWheelDelta(){return this.wheelDelta}getMouseButtonDown(t){return this.mouseFlags[1*E+_[t]]}getMouseButtonUp(t){return this.mouseFlags[0*E+_[t]]}};A=new WeakMap;class m{constructor(t,r,e){this.array=new Float32Array([null!=t?t:0,null!=r?r:0,null!=e?e:0])}static array(...t){const r=new Array(4*t.length);let e,a=0;for(const s of t)e=s.array,r[a+0]=e[0],r[a+1]=e[1],r[a+2]=e[2],a+=3;return r}get length(){return 3}get r(){return this.array[0]}set r(t){this.array[0]=t}get g(){return this.array[1]}set g(t){this.array[1]=t}get b(){return this.array[2]}set b(t){this.array[2]=t}get a(){return this.array[3]}set a(t){this.array[3]=t}get 0(){return this.array[0]}set 0(t){this.array[0]=t}get 1(){return this.array[1]}set 1(t){this.array[1]=t}get 2(){return this.array[2]}set 2(t){this.array[2]=t}get 3(){return this.array[3]}set 3(t){this.array[3]=t}setValues(t,r,e){const{array:a}=this;return a[0]=t,a[1]=r,a[2]=e,this}getValues(){const{array:t}=this;return[t[0],t[1],t[2]]}copy(t){const{array:r}=this,{r:e,g:a,b:s}=t;return r[0]=e,r[1]=a,r[2]=s,this}clone(){return(new m).copy(this)}static lerp(t,r,e){return t.lerp(r,e)}lerp(t,r){const{array:e}=this,{r:a,g:s,b:n}=t;return e[0]=r*(a-e[0]),e[1]=r*(s-e[1]),e[2]=r*(n-e[2]),this}normalize(){const{array:t}=this;return t[0]/=255,t[1]/=255,t[2]/=255,this}[Symbol.iterator](){const{array:t}=this,{length:r}=t;let e=0;return{next:()=>e<r?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}m.BLACK=new m(0,0,0),m.RED=new m(1,0,0),m.GREEN=new m(0,1,0),m.BLUE=new m(0,0,1),m.WHITE=new m(1,1,1);const R=m;class d{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1],t[2],t[3]]);else if("object"==typeof t[0]){const r=t[0];if(r.length<4)throw new a("Array must be of length 4 at least.");r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array([0,0,0,0])}get values(){return[this.array[0],this.array[1],this.array[2],this.array[3]]}set values(t){this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this.array[3]=t[3]}get 0(){return this.array[0]}set 0(t){this.array[0]=t}get 1(){return this.array[1]}set 1(t){this.array[1]=t}get 2(){return this.array[2]}set 2(t){this.array[2]=t}get 3(){return this.array[3]}set 3(t){this.array[3]=t}get x(){return this.array[0]}set x(t){this.array[0]=t}get y(){return this.array[1]}set y(t){this.array[1]=t}get z(){return this.array[2]}set z(t){this.array[2]=t}get w(){return this.array[3]}set w(t){this.array[3]=t}setValues(t,r,e,a){const s=this.array;return s[0]=t,s[1]=r,s[2]=e,s[3]=a,this}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],this}clone(){return new d(this.values)}equals(t){const r=this.array,e=t.array;return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}setZeros(){const t=this.array;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,this}setUnit(){const t=this.array;return t[0]=1,t[1]=1,t[2]=1,t[3]=1,this}add(t){const r=this.array,e=t.array;return r[0]=r[0]+e[0],r[1]=r[1]+e[1],r[2]=r[2]+e[2],r[3]=r[3]+e[3],this}addScalar(t){const r=this.array;return r[0]=r[0]+t,r[1]=r[1]+t,r[2]=r[2]+t,r[3]=r[3]+t,this}sub(t){const r=t.array,e=this.array;return e[0]=e[0]-r[0],e[1]=e[1]-r[1],e[2]=e[2]-r[2],e[3]=e[3]-r[3],this}lerp(t,r){const e=this.array,a=t.array;return e[0]=r*(a[0]-e[0]),e[1]=r*(a[1]-e[1]),e[2]=r*(a[2]-e[2]),e[3]=r*(a[3]-e[3]),this}clamp(t,r){const e=this.array,a=t.array,s=r.array;return e[0]=Math.min(s[0],Math.max(a[0],e[0])),e[1]=Math.min(s[1],Math.max(a[0],e[1])),e[2]=Math.min(s[2],Math.max(a[0],e[2])),e[3]=Math.min(s[3],Math.max(a[0],e[3])),this}multScalar(t){const r=this.array;return r[0]=r[0]*t,r[1]=r[1]*t,r[2]=r[2]*t,r[3]=r[3]*t,this}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}length(){const t=this.array;return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])}lengthSquared(){const t=this.array;return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]}dist(t){const r=this.array,e=t.array,a=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2],i=r[3]-e[3];return Math.sqrt(a*a+s*s+n*n+i*i)}distSquared(t){const r=this.array,e=t.array,a=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2],i=r[3]-e[3];return a*a+s*s+n*n+i*i}normalize(){const t=this.array,r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3],e=Math.sqrt(r);return e>Number.EPSILON?(t[0]=t[0]/e,t[1]=t[1]/e,t[2]=t[2]/e,t[3]=t[3]/e):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),this}negate(){const t=this.array;return t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],t[3]=-t[3],this}mult(t){const r=this.array,e=t.array;return r[0]=r[0]*e[0],r[1]=r[1]*e[1],r[2]=r[2]*e[2],r[3]=r[3]*e[3],this}static mult(t,r){const e=t.array,a=r.array;return new d([e[0]*a[0]+e[1]*a[1]+e[2]*a[2]+e[3]*a[3],e[4]*a[0]+e[5]*a[1]+e[6]*a[2]+e[7]*a[3],e[8]*a[0]+e[9]*a[1]+e[10]*a[2]+e[11]*a[3],e[12]*a[0]+e[13]*a[1]+e[14]*a[2]+e[15]*a[3]])}addScaled(t,r){const e=t.array,a=this.array;return a[0]=a[0]+e[0]*r,a[1]=a[1]+e[1]*r,a[2]=a[2]+e[2]*r,a[3]=a[3]+e[3]*r,this}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3]}readFromArray(t,r=0){const e=this.array;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],this}}var N=d;new e({defaultCtor:d,onDefaultOverride:t=>{N=t}});var g,S,I,P,M,p,L=class{constructor(t){var r;const e=R.RED;void 0!==t&&(this.color=null!==(r=t.color)&&void 0!==r?r:e),this.color=e}};!function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(g||(g={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(S||(S={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(I||(I={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(P||(P={})),function(t){t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4"}(M||(M={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT"}(p||(p={}));class w{static getDataTypeNumComponents(t){switch(t){case M.VEC2:return 2;case M.VEC3:return 3;case M.VEC4:return 4}}static getComponentTypeArrayConstructor(t){switch(t){case P.FLOAT:return Float32Array;case P.BYTE:case P.UNSIGNED_BYTE:return Uint8Array;case P.SHORT:return Int16Array;case P.UNSIGNED_SHORT:return Uint16Array;case P.INT:return Int32Array;case P.UNSIGNED_INT:return Uint32Array}}static getArrayComponentType(t){return t instanceof Float32Array?P.FLOAT:t instanceof Int32Array?P.INT:t instanceof Uint32Array?P.UNSIGNED_INT:t instanceof Int16Array?P.SHORT:t instanceof Uint16Array?P.UNSIGNED_SHORT:t instanceof Int8Array?P.BYTE:P.UNSIGNED_BYTE}static createVertexElementArrayBuffer(t,r){const e=t.createBuffer();if(null===e)return null;const a=g.STATIC_READ,s=t.ELEMENT_ARRAY_BUFFER,{byteLength:n}=r,i=this.getElementArrayBufferType(r);return t.bindBuffer(s,e),t.bufferData(s,r,a),{internalBuffer:e,target:s,usage:a,byteLength:n,indexType:i}}static createVertexArrayBuffer(t,r,e,a,s){const{internalProgram:n}=r,i=g.STATIC_READ;s=null!=s&&s,a=null!=a?a:i;const o=e?Object.entries(e):null,h=null!==o?o.reduce(((t,[r,e])=>{var a,s,n;return t+(null!==(n=null!==(s=null===(a=e.array)||void 0===a?void 0:a.byteLength)&&void 0!==s?s:e.byteLength)&&void 0!==n?n:0)}),0):0,c=t.createBuffer();if(null===c)return null;const u=t.ARRAY_BUFFER;t.bindBuffer(u,c);const l=new ArrayBuffer(h);let y=0;const E={};if(null!==o){o.forEach((([t,r])=>{const{array:e,componentType:a,byteLength:s}=r;if(!(e||a&&s))throw new Error("Every attribute requires either an array or a componentType and a byteLength")})),y=s?o.reduce(((t,[r,e])=>{const{constant:a}=e;if(!a){const{array:r,type:a,componentType:s}=e,{BYTES_PER_ELEMENT:n}=null!=r?r:this.getComponentTypeArrayConstructor(s);return t+n*this.getDataTypeNumComponents(a)}return t}),0):0;const r=s?Math.trunc(h/y):0;let e,a=0;o.forEach((([i,o])=>{const{array:h,type:c}=o;let{constant:u,divisor:_,normalize:f,componentType:A}=o;u=null!=u&&u,A=h?this.getArrayComponentType(h):A;const T=t.getAttribLocation(n,i);if(-1===T)return void console.warn(`Attribute ${i} could not be located.`);const m=this.getDataTypeNumComponents(c);if(_=null!=_?_:0,f=null!=f&&f,t.vertexAttribPointer(T,m,A,f,y,a),_>0&&t.vertexAttribDivisor(T,_),u){if(!h)throw new Error("constant flag requires an array parameter");switch(e=h,m){case 1:t.vertexAttrib1fv(T,e);break;case 2:t.vertexAttrib2fv(T,e);break;case 3:t.vertexAttrib3fv(T,e);break;case 4:t.vertexAttrib4fv(T,e)}}else{if(!u){const{array:t,type:n}=o,h=this.getDataTypeNumComponents(n);let c=0,T=0;if(s)if(t){({BYTES_PER_ELEMENT:T,byteLength:c}=t);const e=new(this.getComponentTypeArrayConstructor(this.getArrayComponentType(t)))(l,a),s=y/T;for(let a=0;a<r;a++){let r=a*h;e.set(t.slice(r,r+h),a*s)}}else({BYTES_PER_ELEMENT:T}=this.getComponentTypeArrayConstructor(A)),c=o.byteLength;else t?(({BYTES_PER_ELEMENT:T,byteLength:c}=t),new(w.getComponentTypeArrayConstructor(w.getArrayComponentType(t)))(l,a).set(t)):(({BYTES_PER_ELEMENT:T}=this.getComponentTypeArrayConstructor(A)),c=o.byteLength);E[i]={constantValue:e,numComponents:h,divisor:_,componentType:A,constant:u,byteOffset:a,bytesPerElement:T,type:n,normalize:f},a+=s?T*h:c}t.enableVertexAttribArray(T)}}))}return t.bufferData(u,l,a),{internalBuffer:c,target:u,usage:a,byteLength:h,interleaved:s,byteStride:y,vertexAttributes:E}}static setVertexArrayValues(t,r,e){const{attributes:a,elementsCount:s}=e;Object.keys(a).forEach((e=>{const{verticesBuffers:s}=r,n=s.find((t=>e in t.vertexAttributes));if(n){const{internalBuffer:r,target:s,byteStride:i,interleaved:o,vertexAttributes:h}=n;t.getParameter(t.ARRAY_BUFFER_BINDING)!==r&&t.bindBuffer(s,r);const c=a[e],{byteOffset:u,numComponents:l}=h[e];let{array:y,srcOffset:E,srcLength:_}=c;const{length:f}=y;let A=u;if(o){(E||_)&&(y=y.slice(null!=E?E:0,_));const r=o?Math.trunc(f/l):0;let e=0;for(let a=0;a<r;a++)t.bufferSubData(s,A,y,e,l),e+=l,A+=i}else E=null!=E?E:0,_=null!=_?_:f,t.bufferSubData(s,0,y,E,_)}}))}static setVertexArrayBufferData(t,r,e,a,s,n){const{internalBuffer:i,target:o}=r;t.bindBuffer(o,i),a=null!=a?a:0,s=null!=s?s:0,t.bufferSubData(o,a,e,s,n)}static createVertexArray(t,r,e){const{vertexAttributes:a,vertexBuffers:s,elementIndices:n,elementBuffer:i}=e,o=t.createVertexArray();if(null===o)return null;t.bindVertexArray(o);const h=a?Object.entries(a):[],{internalProgram:c}=r,u=[];if(s)s.forEach(((e,a)=>{const s=Object.fromEntries(h.filter((([t,r])=>r.buffer==a)));let n=null;if(void 0!==e){if("internalBuffer"in e){const{target:r,internalBuffer:a}=e;n=e,t.bindBuffer(r,a);const{byteStride:s,vertexAttributes:i}=n;Object.entries(i).forEach((([r,e])=>{const{numComponents:a,componentType:n,normalize:i,byteOffset:o,divisor:h,constant:u,constantValue:l}=e,y=t.getAttribLocation(c,r);if(y>-1)if(t.vertexAttribPointer(y,a,n,i,s,o),h>0&&t.vertexAttribDivisor(y,h),u&&l)switch(a){case 1:t.vertexAttrib1fv(y,l);break;case 2:t.vertexAttrib2fv(y,l);break;case 3:t.vertexAttrib3fv(y,l);break;case 4:t.vertexAttrib4fv(y,l)}else t.enableVertexAttribArray(y)}))}else if(s){const{usage:a,interleaved:i}=e;n=this.createVertexArrayBuffer(t,r,s,a,i)}}else s&&(n=this.createVertexArrayBuffer(t,r,s));if(null===n)return null;u.push(n)}));else if(a){let e=null;if(e=this.createVertexArrayBuffer(t,r,a),null===e)return null;u.push(e)}let l;if(void 0!==i)if("internalBuffer"in i){const{target:r,internalBuffer:e}=i;l=i,t.bindBuffer(r,e)}else n&&(l=this.createVertexElementArrayBuffer(t,n));else n&&(l=this.createVertexElementArrayBuffer(t,n));return null===l?null:{verticesBuffers:u,elementBuffer:l,program:r,internalVertexArray:o}}static deleteVertexArray(t,r){const{internalVertexArray:e}=r;t.isVertexArray(e)&&t.deleteVertexArray(e)}static getElementArrayBufferType(t){return t instanceof Uint8Array?p.UNSIGNED_BYTE:t instanceof Uint16Array?p.UNSIGNED_SHORT:p.UNSIGNED_INT}}var U,O=class{constructor(t={},r,e){if(t){const a=Object.values(t),s=a.reduce(((t,r)=>t+r.array.byteLength),0),n=new ArrayBuffer(s),i=e?a.reduce(((t,r)=>{const{array:e,type:a}=r;return t+e.BYTES_PER_ELEMENT*w.getDataTypeNumComponents(a)}),0):0,o=Math.trunc(s/i);this.attributes={},this.indices=r,this.interleaved=null!=e&&e,this.stride=i,this.buffer=n;let h=0;e?Object.entries(t).forEach((([t,r])=>{const{array:e,type:a,constant:s,normalize:c}=r,u=w.getArrayComponentType(e),l=w.getDataTypeNumComponents(a),y=w.getComponentTypeArrayConstructor(w.getArrayComponentType(e)),{byteLength:E,BYTES_PER_ELEMENT:_}=e,f=new y(n,h),A=i/_;for(let t=0;t<o;t++){let r=t*l;f.set(e.slice(r,r+l),t*A)}this.attributes[t]={type:a,byteOffset:h,byteLength:E,componentType:u,constant:s,normalize:c},h+=l*_})):Object.entries(t).forEach((([t,r])=>{const{array:e,type:a}=r,{byteLength:s}=e,i=w.getArrayComponentType(e);new(w.getComponentTypeArrayConstructor(w.getArrayComponentType(e)))(n,h).set(e),this.attributes[t]={byteOffset:h,byteLength:s,type:a,componentType:i},h+=s}))}else this.attributes={},this.indices=void 0,this.interleaved=!1,this.stride=0,this.buffer=new ArrayBuffer(0)}toBlob(){var t;const{attributes:r,buffer:e,stride:a,interleaved:s,indices:n}=this,i=new Uint8Array(e),{length:o}=i,h=Uint8Array.from(null!=n?n:[]),c=null!==(t=null==n?void 0:n.length)&&void 0!==t?t:0,u=(new TextEncoder).encode(JSON.stringify({attributes:r,stride:a,interleaved:s})),{length:l}=u,y=new Uint8Array(4+l+c+o),{buffer:E}=y,_=new Uint16Array(E,0,2),f=_.length*(Uint16Array.BYTES_PER_ELEMENT/Uint8Array.BYTES_PER_ELEMENT);return _[0]=l,_[1]=c,y.set(u,f),y.set(h,f+l),y.set(i,f+l+c),new Blob([y],{type:"application/octet-stream"})}static async fromBlob(t){const r=await t.arrayBuffer(),e=new Uint16Array(r,0,2),{byteLength:a}=e,s=e[0],n=e[1],i=new Uint8Array(r,a,s),o=n<Math.pow(2,8)?Uint8Array:n<Math.pow(2,16)?Uint16Array:Uint32Array,h=new o(r.slice(a+s*Uint8Array.BYTES_PER_ELEMENT,n*o.BYTES_PER_ELEMENT)),c=r.slice(a+(n+s)*Uint8Array.BYTES_PER_ELEMENT),u=JSON.parse((new TextDecoder).decode(i)),{attributes:l,interleaved:y,stride:E}=u,_=new O;return _.buffer=c,_.attributes=l,_.interleaved=y,_.stride=E,_.indices=h,_}getAttribute(t){const{attributes:r}=this,e=r[t];if(e){const{buffer:t,interleaved:r,stride:a}=this,{type:s,byteOffset:n,byteLength:i,componentType:o}=e,h=w.getComponentTypeArrayConstructor(o),c=i/h.BYTES_PER_ELEMENT,u=w.getDataTypeNumComponents(s),{byteLength:l}=t,{BYTES_PER_ELEMENT:y}=h,E=new h(c);if(r){const r=new h(t,n),e=a,s=Math.trunc(l/e),i=e/y;for(let t=0;t<s;t++){let e=i*t;E.set(r.slice(e,e+u),u*t)}}else{const r=new h(t,n,c);E.set(r)}return{array:E,type:s}}return null}};!function(t){t[t.NO_AUTO_EXTEND=0]="NO_AUTO_EXTEND",t[t.AUTO_EXTEND_ONE=1]="AUTO_EXTEND_ONE",t[t.AUTO_EXTEND_POW2=2]="AUTO_EXTEND_POW2"}(U||(U={}));var C=class extends class{constructor(t,r){this.ctor=t,this.autoExtendPolicy=r||U.AUTO_EXTEND_ONE,this.autoExtendTicks=0}autoExtend(){switch(this.autoExtendPolicy){case U.AUTO_EXTEND_ONE:this.extend(1);break;case U.AUTO_EXTEND_POW2:this.extend(Math.pow(2,this.autoExtendTicks))}this.autoExtendTicks++}acquire(t){throw new Error("Not implemented")}release(...t){throw new Error("Not implemented")}extend(t){throw new Error("Not implemented")}clear(){throw new Error("Not implemented")}}{constructor(t,r){super(t,null==r?void 0:r.policy),this.objects=new Array((null==r?void 0:r.size)||0).fill(0).map((()=>new this.ctor(null==r?void 0:r.args))),this.top=0}acquire(t){const r=this.top,e=r+t;if(this.autoExtendPolicy)for(;this.objects.length<e;)this.autoExtend();return this.top=e,this.objects.slice(r,e)}release(t){const r=this.top;t>r&&console.warn("Releasing under zero."),this.top=Math.max(r-t,0)}extend(t){this.objects.push(...Array(t).fill(0).map((()=>new this.ctor)))}clear(){this.objects=[],this.top=0,this.autoExtendTicks=0}};Math.PI,Math.PI;const B=new ArrayBuffer(Float32Array.BYTES_PER_ELEMENT),b=new Float32Array(B),D=new Uint32Array(B);class v{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]);else if("object"==typeof t[0]){const r=t[0];this.checkArray(r),r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array([0,0,0,0,0,0,0,0,0])}get row1(){return[this.array[0],this.array[3],this.array[6]]}set row1(t){this.array[0]=t[0],this.array[3]=t[1],this.array[6]=t[2]}get row2(){return[this.array[1],this.array[4],this.array[7]]}set row2(t){this.array[1]=t[0],this.array[4]=t[1],this.array[7]=t[2]}get row3(){return[this.array[2],this.array[5],this.array[8]]}set row3(t){this.array[2]=t[0],this.array[5]=t[1],this.array[8]=t[2]}get col1(){return[this.array[0],this.array[1],this.array[2]]}set col1(t){this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2]}get col2(){return[this.array[3],this.array[4],this.array[5]]}set col2(t){this.array[3]=t[0],this.array[4]=t[1],this.array[5]=t[2]}get col3(){return[this.array[6],this.array[7],this.array[8]]}set col3(t){this.array[6]=t[0],this.array[7]=t[1],this.array[8]=t[2]}get m11(){return this.array[0]}set m11(t){this.array[0]=t}get m12(){return this.array[3]}set m12(t){this.array[3]=t}get m13(){return this.array[6]}set m13(t){this.array[6]=t}get m21(){return this.array[1]}set m21(t){this.array[1]=t}get m22(){return this.array[4]}set m22(t){this.array[4]=t}get m23(){return this.array[7]}set m23(t){this.array[7]=t}get m31(){return this.array[2]}set m31(t){this.array[2]=t}get m32(){return this.array[5]}set m32(t){this.array[5]=t}get m33(){return this.array[8]}set m33(t){this.array[8]=t}checkArray(t){if(t.length<9)throw new a("Array must be of length 9 at least.")}getValues(){return[this.array[0],this.array[1],this.array[2],this.array[3],this.array[4],this.array[5],this.array[6],this.array[7],this.array[8]]}setValues(t,r,e,a,s,n,i,o,h){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this.array[3]=a,this.array[4]=s,this.array[5]=n,this.array[6]=i,this.array[7]=o,this.array[8]=h,this}equals(t){const r=t.array;return this.array[0]===r[0]&&this.array[1]===r[1]&&this.array[2]===r[2]&&this.array[3]===r[3]&&this.array[4]===r[4]&&this.array[5]===r[5]&&this.array[6]===r[6]&&this.array[7]===r[7]&&this.array[8]===r[8]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],this}clone(){return new v(this.array[0],this.array[1],this.array[2],this.array[3],this.array[4],this.array[5],this.array[6],this.array[7],this.array[8])}setIdentity(){const t=this.array;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}setZeros(){const t=this.array;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,this}det(){const t=this.array;return t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6])}trace(){const t=this.array;return t[0]+t[4]+t[8]}negate(){const t=this.array;return t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],t[3]=-t[3],t[4]=-t[4],t[5]=-t[5],t[6]=-t[6],t[7]=-t[7],t[8]=-t[8],this}transpose(){const t=this.array;let r;return r=t[1],t[1]=t[3],t[3]=r,r=t[2],t[2]=t[6],t[6]=r,r=t[5],t[5]=t[7],t[7]=r,this}invert(){const t=this.array,r=t[4]*t[8]-t[5]*t[7],e=t[1]*t[8]-t[2]*t[7],s=t[1]*t[5]-t[2]*t[4],n=t[3]*t[8]-t[5]*t[6],i=t[0]*t[8]-t[2]*t[6],o=t[0]*t[5]-t[2]*t[3],h=t[3]*t[7]-t[4]*t[6],c=t[0]*t[7]-t[1]*t[6],u=t[0]*t[4]-t[1]*t[3],l=1/(t[0]*r-t[3]*e+t[6]*s);if(0==l)throw new a("Matrix is not invertible.");return t[0]=l*r,t[1]=-l*e,t[2]=l*s,t[3]=-l*n,t[4]=l*i,t[5]=-l*o,t[6]=l*h,t[7]=-l*c,t[8]=l*u,this}add(t){const r=this.array,e=t.array;return r[0]=r[0]+e[0],r[1]=r[1]+e[1],r[2]=r[2]+e[2],r[3]=r[3]+e[3],r[4]=r[4]+e[4],r[5]=r[5]+e[5],r[6]=r[6]+e[6],r[7]=r[7]+e[7],r[8]=r[8]+e[8],this}sub(t){const r=this.array,e=t.array;return r[0]=r[0]-e[0],r[1]=r[1]-e[1],r[2]=r[2]-e[2],r[3]=r[3]-e[3],r[4]=r[4]-e[4],r[5]=r[5]-e[5],r[6]=r[6]-e[6],r[7]=r[7]-e[7],r[8]=r[8]-e[8],this}mult(t){const r=this.array,e=t.array,a=r[0],s=r[1],n=r[2],i=r[3],o=r[4],h=r[5],c=r[6],u=r[7],l=r[8],y=e[0],E=e[1],_=e[2],f=e[3],A=e[4],T=e[5],m=e[6],R=e[7],d=e[8];return r[0]=y*a+E*i+_*c,r[1]=y*s+E*o+_*u,r[2]=y*n+E*h+_*l,r[3]=f*a+A*i+T*c,r[4]=f*s+A*o+T*u,r[5]=f*n+A*h+T*l,r[6]=m*a+R*i+d*c,r[7]=m*s+R*o+d*u,r[8]=m*n+R*h+d*l,this}multScalar(t){const r=this.array;return r[0]=r[0]*t,r[1]=r[1]*t,r[2]=r[2]*t,r[3]=r[3]*t,r[4]=r[4]*t,r[5]=r[5]*t,r[6]=r[6]*t,r[7]=r[7]*t,r[8]=r[8]*t,this}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3],t[r+4]=e[4],t[r+5]=e[5],t[r+6]=e[6],t[r+7]=e[7],t[r+8]=e[8]}readFromArray(t,r=0){const e=this.array;e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],e[4]=t[r+4],e[5]=t[r+5],e[6]=t[r+6],e[7]=t[r+7],e[8]=t[r+8]}static rotationX(t){return(new v).setRotationX(t)}setRotationX(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=1,this.array[1]=0,this.array[2]=0,this.array[3]=0,this.array[4]=r,this.array[5]=e,this.array[6]=0,this.array[7]=-e,this.array[8]=r,this}static rotationY(t){return(new v).setRotationY(t)}setRotationY(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=r,this.array[1]=0,this.array[2]=-e,this.array[3]=0,this.array[4]=1,this.array[5]=0,this.array[6]=e,this.array[7]=0,this.array[8]=r,this}static rotationZ(t){return(new v).setRotationZ(t)}setRotationZ(t){const r=Math.cos(t),e=Math.sin(t);return this.array[0]=r,this.array[1]=e,this.array[2]=0,this.array[3]=-e,this.array[4]=r,this.array[5]=0,this.array[6]=0,this.array[7]=0,this.array[8]=1,this}solve(t){const r=this.array,e=r[0],a=r[1],s=r[2],n=r[3],i=r[4],o=r[5],h=r[6],c=r[7],u=r[8],l=t.x,y=t.y,E=t.z;let _=i*u-o*c,f=o*h-n*u,A=n*c-i*h,T=e*_+a*f+s*A;0!=T&&(T=1/T);const m=T*(l*_+y*f+E*A);_=-(c*E-u*y),f=-(u*l-h*E),A=-(h*y-c*l);const R=T*(e*_+a*f+s*A);return _=-(y*o-E*i),f=-(E*n-l*o),A=-(l*i-y*n),[m,R,T*(e*_+a*f+s*A)]}solve2(t){const r=this.array,e=r[0],a=r[1],s=r[3],n=r[4],i=t.x-r[4],o=t.y-r[7];let h=e*n-a*s;return 0!=h&&(h=1/h),[h*(n*i-a*o),h*(e*o-s*i)]}}var F=v;new e({defaultCtor:v,onDefaultOverride:t=>{F=t}});class x{constructor(...t){"number"==typeof t[0]?this._array=[t[0],t[1],t[2],t[3]]:"object"==typeof t[0]?(this._checkArray(t[0]),this._array=t[0]):this._array=[0,0,0,0]}get array(){return this._array}get x(){return this._array[0]}set x(t){this._array[0]=t}get y(){return this._array[1]}set y(t){this._array[1]=t}set z(t){this._array[2]=t}get z(){return this._array[2]}set w(t){this._array[3]=t}get w(){return this._array[3]}get pitch(){const t=this.array,r=t[0],e=t[1],a=t[2],s=2*(t[3]*e-a*r);return Math.abs(s)>=1?Math.sign(s)*(Math.PI/2):Math.asin(s)}get yaw(){const t=this.array,r=t[0],e=t[1],a=t[2],s=2*(t[3]*a+r*e),n=1-2*(e*e+a*a);return Math.atan2(s,n)}get roll(){const t=this.array,r=t[0],e=t[1],a=t[2],s=2*(t[3]*r+e*a),n=1-2*(r*r+e*e);return Math.atan2(s,n)}getValues(){return[this._array[0],this._array[1],this._array[2],this._array[3]]}setValues(t,r,e,a){return this._array[0]=t,this._array[1]=r,this._array[2]=e,this._array[3]=a,this}_checkArray(t){if(t.length<4)throw new a("Array must be of length 4 at least.")}static fromArray(t){return new x(t)}static fromAxisAngle(t,r){return(new x).setAxisAngle(t,r)}static fromVector(t){return new x(t.x,t.y,t.z,1)}static fromEuler(t,r,e){return(new x).setEuler(t,r,e)}copy(t){const r=this._array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],this}clone(){return new x(this.x,this.y,this.z,this.w)}equals(t){const r=this.array,e=t.array;return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}getAxis(t){const r=this.array,e=t.array,a=1-r[3]*r[3];if(a<Number.EPSILON)return t.setZeros();const s=function(t){const r=.5*t;b[0]=t,D[0]=1597463007-(D[0]>>1);let e=b[0];return e*=1.5-r*e*e,e}(a);return e[0]=r[0]*s,e[1]=r[1]*s,e[2]=r[2]*s,t}getMatrix3(t){const r=this.array,e=2/this.lengthSquared(),a=r[0],s=r[1],n=r[2],i=r[3],o=a*e,h=s*e,c=n*e,u=i*o,l=i*h,y=i*c,E=a*o,_=a*h,f=a*c,A=s*h,T=s*c,m=n*c;return t.setValues(1-(A+m),_+y,f-l,_-y,1-(E+m),T+u,f+l,T-u,1-(E+A))}getMatrix4(t){const r=this.array,e=2/this.lengthSquared(),a=r[0],s=r[1],n=r[2],i=r[3],o=a*e,h=s*e,c=n*e,u=i*o,l=i*h,y=i*c,E=a*o,_=a*h,f=a*c,A=s*h,T=s*c,m=n*c;return t.setValues(1-(A+m),_+y,f-l,0,_-y,1-(E+m),T+u,0,f+l,T-u,1-(E+A),0,0,0,0,1)}rotate(t){const r=this.array,e=t.array,a=e[0],s=e[1],n=e[2],i=r[0],o=r[1],h=r[2],c=r[3],u=c*a+0*-i+-o*n+h*s,l=c*s+0*-o+-h*a+i*n,y=c*n+0*-h+-i*s+o*a,E=i*a+0*c+o*s+h*n;return e[0]=E*h+y*c+u*o-l*i,e[1]=E*o+l*c+y*i-u*h,e[2]=E*i+u*c+l*h-y*o,t}toVector(){return new h([this.x,this.y,this.z])}setEuler(t,r,e){const a=Math.cos(.5*r),s=Math.sin(.5*r),n=Math.cos(.5*t),i=Math.sin(.5*t),o=Math.cos(.5*e),h=Math.sin(.5*e),c=this.array;return c[0]=h*n*a-o*i*s,c[1]=o*i*a+h*n*s,c[2]=o*n*s-h*i*a,c[3]=o*n*a+h*i*s,this}setAxisAngle(t,r=0){const e=t.length();if(0===e)return this;const a=Math.sin(.5*r)/e,s=t.array,n=this.array;return n[0]=s[0]*a,n[1]=s[1]*a,n[2]=s[2]*a,n[3]=Math.cos(.5*r),this}setMatrix(t){const r=t.array;let e=0,a=0,s=0,n=0,i=0,o=0,h=0,c=0,u=0;t instanceof F?(e=r[0],a=r[3],s=r[6],n=r[1],i=r[4],o=r[7],h=r[2],c=r[5],u=r[8]):(e=r[0],a=r[4],s=r[8],n=r[1],i=r[5],o=r[9],h=r[2],c=r[6],u=r[10]);const l=e+i+u,y=this.array;if(l>0){const t=2*Math.sqrt(l+1);y[3]=.25*t,y[0]=(c-o)/t,y[1]=(s-h)/t,y[2]=(n-a)/t}else if(e>i&&e>u){const t=2*Math.sqrt(1+e-i-u);y[3]=(c-o)/t,y[0]=.25*t,y[1]=(a+n)/t,y[2]=(s+h)/t}else if(i>u){const t=2*Math.sqrt(1+i-e-u);y[3]=(s-h)/t,y[0]=(a+n)/t,y[1]=.25*t,y[2]=(o+c)/t}else{const t=2*Math.sqrt(1+u-e-i);y[3]=(n-a)/t,y[0]=(s+h)/t,y[1]=(o+c)/t,y[2]=.25*t}return this}lookAt(t,r){const e=r.clone().sub(t).normalize(),a=c.forward.clone().cross(e),s=c.forward.dot(e);return new G(a.x,a.y,a.z,s+1).normalize()}static fromMatrix(t){return(new x).setMatrix(t)}setVectors(t,r){const e=t.dot(r),a=t.cross(r).array,s=this.array;s[0]=a[0],s[1]=a[1],s[2]=a[2];const n=t.length(),i=t.length();return s[3]=Math.sqrt(n*n*i*i)+e,this.normalize()}dot(t){const r=this.array,e=t.array;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}lengthSquared(){const t=this.array;return t[0]**2+t[1]**2+t[2]**2+t[3]**2}length(){const t=this.array;return Math.hypot(t[0],t[1],t[2],t[3])}angleTo(t){return 2*Math.acos(Math.abs(Math.max(-1,Math.min(1,this.dot(t)))))}rotateTowards(t){const r=this.angleTo(t);if(0===r)return this;const e=Math.min(1,r);return this.slerp(this,t,e),this}invert(){return this.conjugate()}conjugate(){const t=this.array;return t[0]*=-1,t[1]*=-1,t[2]*=-1,this}normalize(){const t=this.array;let r=this.length();return 0===r?(t[0]=0,t[1]=0,t[2]=0,t[3]=1):(r=1/r,t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r),this}add(t){const r=this.array,e=t.array;return r[0]+=e[0],r[1]+=e[1],r[2]+=e[2],r[3]+=e[3],this}sub(t){const r=this.array,e=t.array;return r[0]-=e[0],r[1]-=e[1],r[2]-=e[2],r[3]-=e[3],this}mult(t){const r=this.array,e=t.array,a=r[0],s=r[1],n=r[2],i=r[3],o=e[0],h=e[1],c=e[2],u=e[3];return r[0]=a*u+i*o+s*c-n*h,r[1]=s*u+i*h+n*o-a*c,r[2]=n*u+i*c+a*h-s*o,r[3]=i*u-a*o-s*h-n*c,this}scale(t){const r=this.array;return r[0]*=t,r[1]*=t,r[2]*=t,r[3]*=t,this}static slerp(t,r,e,a){if(a instanceof G||(a=new G),0===e)return a.copy(t);if(1===e)return a.copy(r);const s=a.array,n=t.array,i=r.array,o=n[3]*i[3]+n[0]*i[0]+n[1]*i[1]+n[2]*i[2];if(Math.abs(o)>=1)return s[3]=n[3],s[0]=n[0],s[1]=n[1],s[2]=n[2],a;const h=Math.acos(o),c=Math.sqrt(1-o*o);if(Math.abs(c-Math.trunc(c))<Number.EPSILON)return s[3]=.5*n[3]+.5*i[3],s[0]=.5*n[0]+.5*i[0],s[1]=.5*n[1]+.5*i[1],s[2]=.5*n[2]+.5*i[2],a;const u=Math.sin((1-e)*h)/c,l=Math.sin(e*h)/c;return s[3]=n[3]*u+i[3]*l,s[0]=n[0]*u+i[0]*l,s[1]=n[1]*u+i[1]*l,s[2]=n[2]*u+i[2]*l,a}slerp(t,r,e){return G.slerp(t,r,e,this)}copyIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3]}readFromArray(t,r=0){const e=this.array;e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3]}}var G=x;new C(x),new e({defaultCtor:x,onDefaultOverride:t=>{G=t}});class V{constructor(...t){if("number"==typeof t[0])this.array=new Float32Array([t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]);else if("object"==typeof t[0]){const r=t[0];this.checkArray(r),r instanceof Float32Array?this.array=r:this.array=new Float32Array(r)}else this.array=new Float32Array(16)}static fromValues(t,r,e,a,s,n,i,o,h,c,u,l,y,E,_,f){return new V(t,r,e,a,s,n,i,o,h,c,u,l,y,E,_,f)}static fromArray(t){if(t.length<16)throw new Error("Matrix4 needs an array of size 16 at least.");return new V(t)}getValues(){const t=this.array;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}setValues(t,r,e,a,s,n,i,o,h,c,u,l,y,E,_,f){const A=this.array;return A[0]=t,A[1]=r,A[2]=e,A[3]=a,A[4]=s,A[5]=n,A[6]=i,A[7]=o,A[8]=h,A[9]=c,A[10]=u,A[11]=l,A[12]=y,A[13]=E,A[14]=_,A[15]=f,this}get m11(){return this.array[0]}set m11(t){this.array[0]=t}get m12(){return this.array[4]}set m12(t){this.array[4]=t}get m13(){return this.array[8]}set m13(t){this.array[8]=t}get m14(){return this.array[12]}set m14(t){this.array[12]=t}get m21(){return this.array[1]}set m21(t){this.array[1]=t}get m22(){return this.array[5]}set m22(t){this.array[5]=t}get m23(){return this.array[9]}set m23(t){this.array[9]=t}get m24(){return this.array[13]}set m24(t){this.array[13]=t}get m31(){return this.array[2]}set m31(t){this.array[2]=t}get m32(){return this.array[6]}set m32(t){this.array[6]=t}get m33(){return this.array[10]}set m33(t){this.array[10]=t}get m34(){return this.array[14]}set m34(t){this.array[14]=t}get m41(){return this.array[3]}set m41(t){this.array[3]=t}get m42(){return this.array[7]}set m42(t){this.array[7]=t}get m43(){return this.array[11]}set m43(t){this.array[11]=t}get m44(){return this.array[15]}set m44(t){this.array[15]=t}checkArray(t){if(t.length<16)throw new a("Array must be of length 16 at least.")}getRotation(){const t=this.array,r=t[0],e=t[4],a=t[8],s=t[1],n=t[5],i=t[9],o=t[2],h=t[6],c=t[10],u=r+n+c;let l=0,y=0,E=0,_=0;if(u>0){const t=2*Math.sqrt(u+1);_=.25*t,l=(h-i)/t,y=(a-o)/t,E=(s-e)/t}else if(r>n&&r>c){const t=2*Math.sqrt(1+r-n-c);_=(h-i)/t,l=.25*t,y=(e+s)/t,E=(a+o)/t}else if(n>c){const t=2*Math.sqrt(1+n-r-c);_=(a-o)/t,l=(e+s)/t,y=.25*t,E=(i+h)/t}else{const t=2*Math.sqrt(1+c-r-n);_=(s-e)/t,l=(a+o)/t,y=(i+h)/t,E=.25*t}return new G(l,y,E,_)}setTRS(t,r,e){const a=this.array,s=r.array,n=t.array,i=e.array,o=s[0],h=s[1],c=s[2],u=s[3],l=o+o,y=h+h,E=c+c,_=o*l,f=o*y,A=o*E,T=h*y,m=h*E,R=c*E,d=u*l,N=u*y,g=u*E,S=i[0],I=i[1],P=i[2];return a[0]=(1-(T+R))*S,a[1]=(f+g)*S,a[2]=(A-N)*S,a[3]=0,a[4]=(f-g)*I,a[5]=(1-(_+R))*I,a[6]=(m+d)*I,a[7]=0,a[8]=(A+N)*P,a[9]=(m-d)*P,a[10]=(1-(_+T))*P,a[11]=0,a[12]=n[0],a[13]=n[1],a[14]=n[2],a[15]=1,this}setRotation(t){const r=this.array,e=t.array,a=2/t.lengthSquared(),s=e[0],n=e[1],i=e[2],o=e[3],h=s*a,c=n*a,u=i*a,l=o*h,y=o*c,E=o*u,_=s*h,f=s*c,A=s*u,T=n*c,m=n*u,R=i*u,d=1-(T+R),N=f+E,g=A-y,S=f-E,I=1-(_+R),P=m+l,M=A+y,p=m-l,L=1-(_+T);return r[0]=d,r[1]=N,r[2]=g,r[4]=S,r[5]=I,r[6]=P,r[8]=M,r[9]=p,r[10]=L,this}equals(t){const r=this.array,e=t.array;return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}copy(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}clone(){const t=this.array;return new V(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}static identity(){return new V(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setIdentity(){const t=this.array;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}static zeros(){return new V(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}setZeros(){const t=this.array;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=0,this}det(){const t=this.array,r=t[0]*t[5]-t[1]*t[4],e=t[0]*t[6]-t[2]*t[4],a=t[0]*t[7]-t[3]*t[4],s=t[1]*t[6]-t[2]*t[5],n=t[1]*t[7]-t[3]*t[5],i=t[2]*t[7]-t[3]*t[6],o=t[8]*s-t[9]*e+t[10]*r,h=t[8]*n-t[9]*a+t[11]*r,c=t[8]*i-t[10]*a+t[11]*e;return-(t[9]*i-t[10]*n+t[11]*s)*t[12]+c*t[13]-h*t[14]+o*t[15]}trace(){const t=this.array;return t[0]+t[5]+t[10]+t[15]}static negate(t,r){const e=t.array,a=r.array;return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=-e[3],a[4]=-e[4],a[5]=-e[5],a[6]=-e[6],a[7]=-e[7],a[8]=-e[8],a[9]=-e[9],a[10]=-e[10],a[11]=-e[11],a[12]=-e[12],a[13]=-e[13],a[14]=-e[14],a[15]=-e[15],r}negate(){return V.negate(this,this)}static transpose(t,r){const e=t.array,a=r.array,s=e[0],n=e[1],i=e[2],o=e[3],h=e[4],c=e[5],u=e[6],l=e[7],y=e[8],E=e[9],_=e[10],f=e[11],A=e[12],T=e[13],m=e[14],R=e[15];return a[0]=s,a[1]=h,a[2]=y,a[3]=A,a[4]=n,a[5]=c,a[6]=E,a[7]=T,a[8]=i,a[9]=u,a[10]=_,a[11]=m,a[12]=o,a[13]=l,a[14]=f,a[15]=R,r}transpose(){return V.transpose(this,this)}static invert(t,r){const e=t.array,s=r.array,n=e[0],i=e[1],o=e[2],h=e[3],c=e[4],u=e[5],l=e[6],y=e[7],E=e[8],_=e[9],f=e[10],A=e[11],T=e[12],m=e[13],R=e[14],d=e[15],N=n*u-i*c,g=n*l-o*c,S=n*y-h*c,I=i*l-o*u,P=i*y-h*u,M=o*y-h*l,p=E*m-_*T,L=E*R-f*T,w=E*d-A*T,U=_*R-f*m,O=_*d-A*m,C=f*d-A*R,B=N*C-g*O+S*U+I*w-P*L+M*p;if(0==B)throw new a("Matrix is not invertible.");const b=1/B;return s[0]=(u*C-l*O+y*U)*b,s[1]=(-i*C+o*O-h*U)*b,s[2]=(m*M-R*P+d*I)*b,s[3]=(-_*M+f*P-A*I)*b,s[4]=(-c*C+l*w-y*L)*b,s[5]=(n*C-o*w+h*L)*b,s[6]=(-T*M+R*S-d*g)*b,s[7]=(E*M-f*S+A*g)*b,s[8]=(c*O-u*w+y*p)*b,s[9]=(-n*O+i*w-h*p)*b,s[10]=(T*P-m*S+d*N)*b,s[11]=(-E*P+_*S-A*N)*b,s[12]=(-c*U+u*L-l*p)*b,s[13]=(n*U-i*L+o*p)*b,s[14]=(-T*I+m*g-R*N)*b,s[15]=(E*I-_*g+f*N)*b,r}invert(){return V.invert(this,this)}static add(t,r,e){const a=t.array,s=r.array,n=e.array;return n[0]=a[0]+s[0],n[1]=a[1]+s[1],n[2]=a[2]+s[2],n[3]=a[3]+s[3],n[4]=a[4]+s[4],n[5]=a[5]+s[5],n[6]=a[6]+s[6],n[7]=a[7]+s[7],n[8]=a[8]+s[8],n[9]=a[9]+s[9],n[10]=a[10]+s[10],n[11]=a[11]+s[11],n[12]=a[12]+s[12],n[13]=a[13]+s[13],n[14]=a[14]+s[14],n[15]=a[15]+s[15],e}add(t){return V.add(this,t,this)}static sub(t,r,e){const a=t.array,s=r.array,n=e.array;return n[0]=a[0]-s[0],n[1]=a[1]-s[1],n[2]=a[2]-s[2],n[3]=a[3]-s[3],n[4]=a[4]-s[4],n[5]=a[5]-s[5],n[6]=a[6]-s[6],n[7]=a[7]-s[7],n[8]=a[8]-s[8],n[9]=a[9]-s[9],n[10]=a[10]-s[10],n[11]=a[11]-s[11],n[12]=a[12]-s[12],n[13]=a[13]-s[13],n[14]=a[14]-s[14],n[15]=a[15]-s[15],e}sub(t){return V.sub(this,t,this)}static mult(t,r,e){const a=t.array,s=r.array,n=e.array,i=a[0],o=a[1],h=a[2],c=a[3],u=a[4],l=a[5],y=a[6],E=a[7],_=a[8],f=a[9],A=a[10],T=a[11],m=a[12],R=a[13],d=a[14],N=a[15],g=s[0],S=s[1],I=s[2],P=s[3],M=s[4],p=s[5],L=s[6],w=s[7],U=s[8],O=s[9],C=s[10],B=s[11],b=s[12],D=s[13],v=s[14],F=s[15];return n[0]=i*g+u*S+_*I+m*P,n[1]=o*g+l*S+f*I+R*P,n[2]=h*g+y*S+A*I+d*P,n[3]=c*g+E*S+T*I+N*P,n[4]=i*M+u*p+_*L+m*w,n[5]=o*M+l*p+f*L+R*w,n[6]=h*M+y*p+A*L+d*w,n[7]=c*M+E*p+T*L+N*w,n[8]=i*U+u*O+_*C+m*B,n[9]=o*U+l*O+f*C+R*B,n[10]=h*U+y*O+A*C+d*B,n[11]=c*U+E*O+T*C+N*B,n[12]=i*b+u*D+_*v+m*F,n[13]=o*b+l*D+f*v+R*F,n[14]=h*b+y*D+A*v+d*F,n[15]=c*b+E*D+T*v+N*F,e}mult(t){return V.mult(this,t,this)}getMaxScaleOnAxis(){const t=this.array,r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],a=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(r,e,a))}writeIntoArray(t,r=0){const e=this.array;t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3],t[r+4]=e[4],t[r+5]=e[5],t[r+6]=e[6],t[r+7]=e[7],t[r+8]=e[8],t[r+9]=e[9],t[r+10]=e[10],t[r+11]=e[11],t[r+12]=e[12],t[r+13]=e[13],t[r+14]=e[14],t[r+15]=e[15]}readFromArray(t,r=0){const e=this.array;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],e[4]=t[r+4],e[5]=t[r+5],e[6]=t[r+6],e[7]=t[r+7],e[8]=t[r+8],e[9]=t[r+9],e[10]=t[r+10],e[11]=t[r+11],e[12]=t[r+12],e[13]=t[r+13],e[14]=t[r+14],e[15]=t[r+15],this}solve(t){const r=this.array,e=r[0],a=r[1],s=r[2],n=r[3],i=r[4],o=r[5],h=r[6],c=r[7],u=r[8],l=r[9],y=r[10],E=r[11],_=r[12],f=r[13],A=r[14],T=r[15],m=e*o-a*i,R=e*h-s*i,d=e*c-n*i,N=a*h-s*o,g=a*c-n*o,S=s*c-n*h,I=u*f-l*_,P=u*A-y*_,M=u*T-E*_,p=l*A-y*f,L=l*T-E*f,w=y*T-E*A,U=t.x,O=t.y,C=t.z,B=t.w;let b=m*w-R*L+d*p+N*M-g*P+S*I;return 0!=b&&(b=1/b),[b*((o*w-h*L+c*p)*U-(i*w-h*M+c*P)*O+(i*L-o*M+c*I)*C-(i*p-o*P+h*I)*B),b*-((a*w-s*L+n*p)*U-(e*w-s*M+n*P)*O+(e*L-a*M+n*I)*C-(e*p-a*P+s*I)*B),b*((f*S-A*g+T*N)*U-(_*S-A*d+T*R)*O+(_*g-f*d+T*m)*C-(_*N-f*R+A*m)*B),b*-((l*S-y*g+E*N)*U-(u*S-y*d+E*R)*O+(u*g-l*d+E*m)*C-(u*N-l*R+y*m)*B)]}solve2(t){const r=this.array,e=r[0],a=r[1],s=r[4],n=r[5],i=t.x-r[8],o=t.y-r[9];let h=e*n-a*s;return 0!=h&&(h=1/h),[h*(n*i-a*o),h*(e*o-s*i)]}solve3(t){const r=this.array,e=r[0],a=r[1],s=r[2],n=r[4],i=r[5],o=r[6],h=r[8],c=r[9],u=r[10],l=t.x-r[12],y=t.y-r[13],E=t.z-r[14];let _=i*u-o*c,f=o*h-n*u,A=n*c-i*h,T=e*_+a*f+s*A;0!=T&&(T=1/T);const m=T*(l*_+y*f+E*A);_=-(c*E-u*y),f=-(u*l-h*E),A=-(h*y-c*l);const R=T*(e*_+a*f+s*A);return _=-(y*o-E*i),f=-(E*n-l*o),A=-(l*i-y*n),[m,R,T*(e*_+a*f+s*A)]}static translation(t){return(new V).setTranslation(t)}setTranslation(t){const r=this.array,e=t.array,a=e[0],s=e[1],n=e[2];return r[12]=a,r[13]=s,r[14]=n,this}translate(t){const r=this.array,e=t.array,a=e[0],s=e[1],n=e[2],i=r[0]*a+r[4]*s+r[8]*n+1*r[12],o=r[1]*a+r[5]*s+r[9]*n+1*r[13],h=r[2]*a+r[6]*s+r[10]*n+1*r[14],c=r[3]*a+r[7]*s+r[11]*n+1*r[15];return r[12]=i,r[13]=o,r[14]=h,r[15]=c,this}static rotationX(t){return(new V).setRotationX(t)}setRotationX(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e,r[6]=a,r[7]=0,r[8]=0,r[9]=-a,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateX(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),s=r[4]*e+r[8]*a,n=r[5]*e+r[9]*a,i=r[6]*e+r[10]*a,o=r[7]*e+r[11]*a,h=r[4]*-a+r[8]*e,c=r[5]*-a+r[9]*e,u=r[6]*-a+r[10]*e,l=r[7]*-a+r[11]*e;return r[4]=s,r[5]=n,r[6]=i,r[7]=o,r[8]=h,r[9]=c,r[10]=u,r[11]=l,this}static rotationY(t){return(new V).setRotationY(t)}setRotationY(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=e,r[1]=0,r[2]=-a,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=a,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateY(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),s=r[0]*e+r[8]*-a,n=r[1]*e+r[9]*-a,i=r[2]*e+r[10]*-a,o=r[3]*e+r[11]*-a,h=r[0]*a+r[8]*e,c=r[1]*a+r[9]*e,u=r[2]*a+r[10]*e,l=r[3]*a+r[11]*e;return r[0]=s,r[1]=n,r[2]=i,r[3]=o,r[8]=h,r[9]=c,r[10]=u,r[11]=l,this}static rotationZ(t){return(new V).setRotationZ(t)}setRotationZ(t){const r=this.array,e=Math.cos(t),a=Math.sin(t);return r[0]=e,r[1]=a,r[2]=0,r[3]=0,r[4]=-a,r[5]=e,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}rotateZ(t){const r=this.array,e=Math.cos(t),a=Math.sin(t),s=r[0]*e+r[4]*a,n=r[1]*e+r[5]*a,i=r[2]*e+r[6]*a,o=r[3]*e+r[7]*a,h=r[0]*-a+r[4]*e,c=r[1]*-a+r[5]*e,u=r[2]*-a+r[6]*e,l=r[3]*-a+r[7]*e;return r[0]=s,r[1]=n,r[2]=i,r[3]=o,r[4]=h,r[5]=c,r[6]=u,r[7]=l,this}static rotation(t){return(new V).rotation(t)}rotation(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[4]=e[3],r[5]=e[4],r[6]=e[5],r[8]=e[6],r[9]=e[7],r[10]=e[8],this}rotate(t,r){const e=this.array,a=t.array,s=t.length(),n=a[0]/s,i=a[1]/s,o=a[2]/s,h=Math.cos(r),c=Math.sin(r),u=1-h,l=n*n*u+h,y=n*i*u-o*c,E=n*o*u+i*c,_=i*n*u+o*c,f=i*i*u+h,A=i*o*u-n*c,T=o*n*u-i*c,m=o*i*u+n*c,R=o*o*u+h,d=e[0]*l+e[4]*_+e[8]*T,N=e[1]*l+e[5]*_+e[9]*T,g=e[2]*l+e[6]*_+e[10]*T,S=e[3]*l+e[7]*_+e[11]*T,I=e[0]*y+e[4]*f+e[8]*m,P=e[1]*y+e[5]*f+e[9]*m,M=e[2]*y+e[6]*f+e[10]*m,p=e[3]*y+e[7]*f+e[11]*m,L=e[0]*E+e[4]*A+e[8]*R,w=e[1]*E+e[5]*A+e[9]*R,U=e[2]*E+e[6]*A+e[10]*R,O=e[3]*E+e[7]*A+e[11]*R;return e[0]=d,e[1]=N,e[2]=g,e[3]=S,e[4]=I,e[5]=P,e[6]=M,e[7]=p,e[8]=L,e[9]=w,e[10]=U,e[11]=O,this}static scaling(t){return(new V).setScaling(t)}setScaling(t){const r=this.array,e=t.array,a=e[0],s=e[1],n=e[2];return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}scale(t){const r=this.array,e=t.array,a=e[0],s=e[1],n=e[2];return r[0]*=a,r[1]*=a,r[2]*=a,r[3]*=a,r[4]*=s,r[5]*=s,r[6]*=s,r[7]*=s,r[8]*=n,r[9]*=n,r[10]*=n,r[11]*=n,r[12]*=1,r[13]*=1,r[14]*=1,r[15]*=1,this}static lookAt(t,r,e,a){const s=t.array,n=e.array,i=r.array,o=a.array,h=s[0],c=s[1],u=s[2],l=n[0],y=n[1],E=n[2];let _,f,A,T,m,R,d,N,g,S;return d=h-i[0],N=c-i[1],g=u-i[2],S=Math.hypot(d,N,g),S>0&&(S=1/Math.hypot(d,N,g),d*=S,N*=S,g*=S),_=y*g-E*N,f=E*d-l*g,A=l*N-y*d,S=Math.hypot(_,f,A),S>0&&(S=1/S,_*=S,f*=S,A*=S),T=N*A-g*f,m=g*_-d*A,R=d*f-N*_,S=Math.hypot(T,m,R),S>0&&(S=1/S,T*=S,m*=S,R*=S),o[0]=_,o[1]=f,o[2]=A,o[3]=0,o[4]=T,o[5]=m,o[6]=R,o[7]=0,o[8]=d,o[9]=N,o[10]=g,o[11]=0,o[12]=h,o[13]=c,o[14]=u,o[15]=1,a}lookAt(t,r,e){return V.lookAt(t,r,e,this)}transformPoint(t){const r=this.array,e=t.array,a=e[0],s=e[1],n=e[2],i=a*r[3]+s*r[7]+n*r[11]+r[15];return t.setValues((a*r[0]+s*r[4]+n*r[8]+r[12])/i,(a*r[1]+s*r[5]+n*r[9]+r[13])/i,(a*r[2]+s*r[6]+n*r[10]+r[14])/i),t}transformPoint4(t){const r=this.array,e=t.array,a=e[0],s=e[1],n=e[2],i=e[3],o=a*r[3]+s*r[7]+n*r[11]+i*r[15];return t.setValues((a*r[0]+s*r[4]+n*r[8]+r[12])/o,(a*r[1]+s*r[5]+n*r[9]+r[13])/o,(a*r[2]+s*r[6]+n*r[10]+r[14])/o,(a*r[3]+s*r[7]+n*r[11]+r[15])/o),t}transformDirection(t){const r=this.array,e=t.array,a=e[0],s=e[1],n=e[2];return t.setValues(a*r[0]+s*r[4]+n*r[8],a*r[1]+s*r[5]+n*r[9],a*r[2]+s*r[6]+n*r[10]),t}transformNormal(t){const r=t.array,e=this.invert().array,a=r[0],s=r[1],n=r[2];return t.setValues(a*e[0]+s*e[4]+n*e[8],a*e[1]+s*e[5]+n*e[9],a*e[2]+s*e[6]+n*e[10]),this.invert(),t}static perspective(t,r,e,a){return(new V).setPerspective(t,r,e,a)}setPerspective(t,r,e,a){const s=this.array,n=Math.tan(.5*Math.PI-.5*t),i=n/r,o=1/(e-a);return s[0]=i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=(e+a)*o,s[11]=-1,s[12]=0,s[13]=0,s[14]=2*e*a*o,s[15]=0,this}static orthographic(t,r,e,a,s,n){return(new V).setOrthographic(t,r,e,a,s,n)}setOrthographic(t,r,e,a,s,n){const i=this.array;return i[0]=2/(r-t),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(a-e),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(s-n),i[11]=0,i[12]=(r+t)/(t-r),i[13]=(a+e)/(e-a),i[14]=(n+s)/(s-n),i[15]=1,this}static frustrum(t,r,e,a,s,n){return(new V).setFrustrum(t,r,e,a,s,n)}setFrustrum(t,r,e,a,s,n){const i=this.array,o=1/(r-t),h=1/(a-e),c=1/(s-n);return i[0]=2*s*o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*s*h,i[6]=0,i[7]=0,i[8]=(r+t)*o,i[9]=(a+e)*h,i[10]=(n+s)*c,i[11]=-1,i[12]=0,i[13]=0,i[14]=n*s*2*c,i[15]=0,this}}var k=V;new e({defaultCtor:V,onDefaultOverride:t=>{k=t}});const H=new class{constructor(){this._count=0}newUUID(){return(++this._count).toString(16)}},X=new class extends C{constructor(t,r){super(t,r),this._buffer=new Float32Array(0),this._bufferViews=Array((null==r?void 0:r.size)||0).fill(0).map((()=>this._buffer.subarray())),this._extensions=[]}}(h);class Y{constructor(t,r){this._normal=t||new h([0,0,0]),this._constant=r||0}static fromNormalAndConstant(t,r){return(new Y).setFromNormalAndConstant(t,r)}static fromNormalAndCoplanarPoint(t,r){return(new Y).setFromNormalAndCoplanarPoint(t,r)}static fromCoplanarPoints(t,r,e){return(new Y).setFromCoplanarPoints(t,r,e)}get normal(){return this._normal}set normal(t){this._normal=t}get constant(){return this._constant}set constant(t){this._constant=t}copy(t){return this._normal=t._normal.clone(),this._constant=t._constant,this}set(t,r,e,a){return this._normal.setValues(t,r,e),this._constant=a,this}setFromNormalAndConstant(t,r){return this._normal.copy(t),this._constant=r,this}setFromNormalAndCoplanarPoint(t,r){return this._normal.copy(t),this._constant=-r.dot(this._normal),this}setFromCoplanarPoints(t,r,e){const a=e.clone(),[s]=X.acquire(1);return s.copy(t),a.sub(r).cross(s.sub(r)).normalize(),this.setFromNormalAndCoplanarPoint(a,t),X.release(1),this}distanceToPoint(t){return this._normal.dot(t)+this._constant}normalized(){const t=1/this._normal.length();return this._normal.scale(t),this._constant*=t,this}}var z=Y;new e({defaultCtor:Y,onDefaultOverride:t=>{z=t}});class W{constructor(){this.nearPlane=new z,this.farPlane=new z,this.topPlane=new z,this.bottomPlane=new z,this.leftPlane=new z,this.rightPlane=new z}set(t,r,e,a,s,n){return this.nearPlane.copy(t),this.farPlane.copy(r),this.topPlane.copy(e),this.bottomPlane.copy(a),this.leftPlane.copy(s),this.rightPlane.copy(n),this}copy(t){return this.set(t.nearPlane,t.farPlane,t.topPlane,t.bottomPlane,t.leftPlane,t.rightPlane),this}clone(){return(new W).copy(this)}setFromPerspectiveMatrix(t){const r=t.m11,e=t.m12,a=t.m13,s=t.m14,n=t.m21,i=t.m22,o=t.m23,h=t.m24,c=t.m31,u=t.m32,l=t.m33,y=t.m34,E=t.m41,_=t.m42,f=t.m43,A=t.m44;return this.nearPlane.set(c+E,u+_,l+f,y+A).normalized(),this.farPlane.set(-c+E,-u+_,-l+f,-y+A).normalized(),this.bottomPlane.set(n+E,i+_,o+f,h+A).normalized(),this.topPlane.set(-n+E,-i+_,-o+f,-h+A).normalized(),this.leftPlane.set(r+E,e+_,a+f,s+A).normalized(),this.rightPlane.set(-r+E,-e+_,-a+f,-s+A).normalized(),this}intersectsSphere(t){const r=t.center,e=t.radius;return r.dot(this.nearPlane.normal)+this.nearPlane.constant+e<=0||r.dot(this.farPlane.normal)+this.farPlane.constant+e<=0||r.dot(this.bottomPlane.normal)+this.bottomPlane.constant+e<=0||r.dot(this.topPlane.normal)+this.topPlane.constant+e<=0||r.dot(this.leftPlane.normal)+this.leftPlane.constant+e<=0||r.dot(this.rightPlane.normal)+this.rightPlane.constant+e<=0}intersectsBox(t){let r=!0;const e=t.max,a=t.min,[s]=X.acquire(1);return r=this.nearPlane.distanceToPoint(s.setValues(this.nearPlane.normal.x>0?e.x:a.x,this.nearPlane.normal.y>0?e.y:a.y,this.nearPlane.normal.z>0?e.z:a.z))>=0&&this.farPlane.distanceToPoint(s.setValues(this.farPlane.normal.x>0?e.x:a.x,this.farPlane.normal.y>0?e.y:a.y,this.farPlane.normal.z>0?e.z:a.z))>=0&&this.bottomPlane.distanceToPoint(s.setValues(this.bottomPlane.normal.x>0?e.x:a.x,this.bottomPlane.normal.y>0?e.y:a.y,this.bottomPlane.normal.z>0?e.z:a.z))>=0&&this.topPlane.distanceToPoint(s.setValues(this.topPlane.normal.x>0?e.x:a.x,this.topPlane.normal.y>0?e.y:a.y,this.topPlane.normal.z>0?e.z:a.z))>=0&&this.leftPlane.distanceToPoint(s.setValues(this.leftPlane.normal.x>0?e.x:a.x,this.leftPlane.normal.y>0?e.y:a.y,this.leftPlane.normal.z>0?e.z:a.z))>=0&&this.rightPlane.distanceToPoint(s.setValues(this.rightPlane.normal.x>0?e.x:a.x,this.rightPlane.normal.y>0?e.y:a.y,this.rightPlane.normal.z>0?e.z:a.z))>=0,X.release(1),r}containsPoint(t){return this.nearPlane.distanceToPoint(t)>=0&&this.farPlane.distanceToPoint(t)>=0&&this.bottomPlane.distanceToPoint(t)>=0&&this.topPlane.distanceToPoint(t)>=0&&this.leftPlane.distanceToPoint(t)>=0&&this.rightPlane.distanceToPoint(t)>=0}}var j=W;new e({defaultCtor:W,onDefaultOverride:t=>{j=t}});const q=new k;class K extends class extends class{constructor(){this.transform=new class{constructor(t,r){this.uuid=H.newUUID(),this.owner=t||null,this.isStatic=null!=r&&r,this.array=new Float32Array(16),this.localArray=new Float32Array(16),this.matrix=new k(this.array).setIdentity(),this.localMatrix=new k(this.localArray).setIdentity(),this.hasChanged=!1}getMatrix(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],t}setMatrix(t){const r=this.array,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}getLocalMatrix(t){const r=this.localArray,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],t}setLocalMatrix(t){const r=this.localArray,e=t.array;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],this}getRight(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[1],e[2]=r[2],t}getLeft(t){const r=this.array,e=t.array;return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],t}getUp(t){const r=this.array,e=t.array;return e[0]=r[4],e[1]=r[5],e[2]=r[6],t}getDown(t){const r=this.array,e=t.array;return e[0]=-r[4],e[1]=-r[5],e[2]=-r[6],t}getForward(t){const r=this.array,e=t.array;return e[0]=r[8],e[1]=r[9],e[2]=r[10],t}getBackward(t){const r=this.array,e=t.array;return e[0]=-r[8],e[1]=-r[9],e[2]=-r[10],t}getTranslation(t){const r=this.array,e=t.array;return e[0]=r[12],e[1]=r[13],e[2]=r[14],t}setTranslation(t){const r=this.array,e=t.array;return r[12]=e[0],r[13]=e[1],r[14]=e[2],this}translate(t){const r=this.array,e=t.array;return r[12]+=e[0],r[13]+=e[1],r[14]+=e[2],this}getScaling(t){const r=this.array,e=t.array;return e[0]=r[0],e[1]=r[5],e[2]=r[10],t}setScaling(t){const r=this.array,e=t.array;return r[0]=e[0],r[5]=e[1],r[10]=e[2],this}scale(t){const r=this.array,e=t.array;return r[0]*=e[0],r[5]*=e[1],r[10]*=e[2],this}getRotation(t){return t.setMatrix(this.matrix),t}setRotation(t){return this.matrix.setRotation(t),this}rotate(t){return this.matrix.mult(t.getMatrix4(q)),this}transformPoint(t){return t}transformDirection(t){return t}transformVector(t){return t}lookAt(t,r){const e=this.getTranslation(X.acquire(1)[0]);return this.matrix.lookAt(e,t,r),X.release(1),this}}(this)}}{constructor(t){super(),this.uuid=H.newUUID(),this.projection=t||new k,this.frustrum=(new j).setFromPerspectiveMatrix(this.projection)}getFront(t){return this.transform.getBackward(t)}get view(){return this.transform.matrix.clone().invert()}get viewProjection(){return this.projection.clone().mult(this.view)}isViewing(t){return!0}updateFrustrum(){this.frustrum.setFromPerspectiveMatrix(this.projection)}}{constructor(t,r,e,a){super(k.perspective(t,r,e,a))}setValues(t,r,e,a){return this.projection.setPerspective(t,r,e,a),this.updateFrustrum(),this}}var Z,Q,$,J,tt,rt,et,at,st,nt,it,ot,ht,ct,ut,lt=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)};!function(t){t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}($||($={})),function(t){t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.R8=33321]="R8",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8=33323]="RG8",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8=32849]="RGB8",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGB565=36194]="RGB565",t[t.RGBA8=32856]="RGBA8",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.R16F=33325]="R16F",t[t.RGB16F=34843]="RGB16F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB8I=36239]="RGB8I",t[t.RGB8UI=36221]="RGB8UI",t[t.RGB16I=36233]="RGB16I",t[t.RGB16UI=36215]="RGB16UI",t[t.RGB32I=36227]="RGB32I",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGBA16I=36232]="RGBA16I",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGBA32UI=36208]="RGBA32UI"}(J||(J={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV"}(tt||(tt={})),function(t){t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE"}(rt||(rt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(et||(et={})),function(t){t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST"}(at||(at={})),function(t){t[t.LINEAR=9729]="LINEAR",t[t.NEAREST=9728]="NEAREST",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(st||(st={})),function(t){t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.NONE=0]="NONE"}(nt||(nt={})),function(t){t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(it||(it={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(ot||(ot={}));class yt{static getTexturesUnitsEntries(){return lt(this,Z,"f",Q).entries()}static createTexture(t,r,e){const a=t.createTexture();if(null===a)return null;let s=lt(this,Z,"f",Q).get(r);null==s&&(s=Math.max(-1,...lt(this,Z,"f",Q).values())+1,lt(this,Z,"f",Q).set(r,s));const{pixels:n,target:i,subimages:o,width:h,height:c,format:u,internalFormat:l,type:y}=e;let{lod:E,border:_,depth:f,mipmap:A}=e;switch(E=null!=E?E:0,_=null!=_?_:0,f=null!=f?f:0,A=null==A||A,t.getParameter(t.ACTIVE_TEXTURE)!==s&&(t.activeTexture(t.TEXTURE0+s),t.bindTexture(i,a)),i){case et.TEXTURE_2D:t.texImage2D(i,E,l,h,c,_,u,y,n),o&&o.forEach((r=>{const{xoffset:e,yoffset:a,width:s,height:n,pixels:o}=r;t.texSubImage2D(i,E,e,a,s,n,u,y,o)}));break;case et.TEXTURE_CUBE_MAP:if(null===n)t.texImage2D(i,E,l,h,c,_,u,y,null);else if("xPos"in n){const{xPos:r,xNeg:e,yPos:a,yNeg:s,zPos:i,zNeg:o}=n;t.texImage2D(et.TEXTURE_CUBE_MAP_POSITIVE_X,E,l,h,c,_,u,y,r),t.texImage2D(et.TEXTURE_CUBE_MAP_NEGATIVE_X,E,l,h,c,_,u,y,e),t.texImage2D(et.TEXTURE_CUBE_MAP_POSITIVE_Y,E,l,h,c,_,u,y,a),t.texImage2D(et.TEXTURE_CUBE_MAP_NEGATIVE_Y,E,l,h,c,_,u,y,s),t.texImage2D(et.TEXTURE_CUBE_MAP_POSITIVE_Z,E,l,h,c,_,u,y,i),t.texImage2D(et.TEXTURE_CUBE_MAP_NEGATIVE_Z,E,l,h,c,_,u,y,o)}break;case et.TEXTURE_2D_ARRAY:t.texImage3D(i,E,l,h,c,f,_,u,y,n),o&&o.forEach(((r,e)=>{const{xoffset:a,yoffset:s,zoffset:n,width:o,height:h,depth:c,pixels:l}=r;t.texSubImage3D(i,E,a,s,n,o,h,c,u,y,l)}))}A&&t.generateMipmap(i);const{min:T,mag:m,wrapS:R,wrapT:d,wrapR:N,baseMipmapLevel:g,maxMipmapLevel:S,compareFunction:I,compareMode:P,minLod:M,maxLod:p}=e;return void 0!==T&&t.texParameteri(i,rt.TEXTURE_MIN_FILTER,T),void 0!==m&&t.texParameteri(i,rt.TEXTURE_MAG_FILTER,m),void 0!==R&&t.texParameteri(i,rt.TEXTURE_WRAP_S,R),void 0!==d&&t.texParameteri(i,rt.TEXTURE_WRAP_T,d),void 0!==N&&t.texParameteri(i,rt.TEXTURE_WRAP_R,N),void 0!==g&&t.texParameteri(i,rt.TEXTURE_BASE_LEVEL,g),void 0!==S&&t.texParameteri(i,rt.TEXTURE_MAX_LEVEL,S),void 0!==I&&t.texParameteri(i,rt.TEXTURE_COMPARE_FUNC,I),void 0!==P&&t.texParameteri(i,rt.TEXTURE_COMPARE_MODE,P),void 0!==M&&t.texParameterf(i,rt.TEXTURE_MIN_LOD,M),void 0!==p&&t.texParameterf(i,rt.TEXTURE_MAX_LOD,p),{unit:s,internalTexture:a,name:r,properties:{pixels:n,target:i,subimages:o,lod:E,width:h,height:c,format:u,internalFormat:l,type:y,min:T,mag:m,wrapS:R,wrapT:d,wrapR:N,baseMipmapLevel:g,maxMipmapLevel:S,compareFunction:I,compareMode:P,minLod:M,maxLod:p}}}static setUnpackAlignment(t,r){t.pixelStorei(t.UNPACK_ALIGNMENT,r)}static deleteTexture(t,r){const{internalTexture:e,name:a}=r;t.isTexture(e)&&(t.deleteTexture(e),lt(this,Z,"f",Q).delete(a))}}Z=yt,Q={value:new Map},function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(ht||(ht={}));class Et{static createShader(t,r,e){const a=t.createShader(r);if(null===a)return null;if(t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS))return{type:r,internalShader:a,source:e};const s=t.getShaderInfoLog(a);return null!==s&&console.warn(s),t.deleteShader(a),null}static createProgram(t,r){const{vertexSource:e,fragmentSource:a}=r,s=this.createShader(t,ht.VERTEX_SHADER,e);if(null===s)return null;const n=this.createShader(t,ht.FRAGMENT_SHADER,a);if(null===n)return null;const i=t.createProgram();if(null===i)return null;const o={internalProgram:i,vertexShader:s,fragmentShader:n};if(t.attachShader(i,s.internalShader),t.attachShader(i,n.internalShader),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return o;const h=t.getProgramInfoLog(i);if(null!==h){const r=t.getShaderInfoLog(s.internalShader),e=t.getShaderInfoLog(n.internalShader);console.warn(h),console.warn(r),console.warn(e)}return this.deleteProgram(t,o),null}static recompileProgram(t,r,e){const{internalProgram:a,vertexShader:s,fragmentShader:n}=r;let{vertexSource:i,fragmentSource:o}=e;if("string"==typeof i){const{internalShader:r}=s;t.shaderSource(r,i),t.compileShader(r),s.source=i}if("string"==typeof o){const{internalShader:r}=n;t.shaderSource(r,o),t.compileShader(r),n.source=o}if(t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS))return r;const h=t.getProgramInfoLog(a);if(null!==h){const r=t.getShaderInfoLog(s.internalShader),e=t.getShaderInfoLog(n.internalShader);console.warn(h),console.warn(r),console.warn(e)}return r}static deleteProgram(t,r){const{vertexShader:e,fragmentShader:a,internalProgram:s}=r;t.deleteShader(e.internalShader),t.deleteShader(a.internalShader),t.deleteProgram(s)}static useProgram(t,r){const{internalProgram:e}=r;t.getParameter(t.CURRENT_PROGRAM)!==e&&t.useProgram(e)}}!function(t){t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW"}(ct||(ct={})),function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"}(ut||(ut={}));class _t{static asArrayBufferView(t){return"object"==typeof t?"buffer"in t?t:"unit"in t?Float32Array.of(t.unit):Float32Array.from(t):Float32Array.of(t)}static getUniformSetter(t,r,e,a){const{value:s,srcOffset:n,srcLength:i}=r;let{transpose:o}=r;switch(o=null!=o&&o,a){case ct.FLOAT:if("number"==typeof s)return{type:a,set:r=>{t.uniform1f(e,r)}};break;case ct.UNSIGNED_INT:if("number"==typeof s)return{type:a,set:r=>{t.uniform1ui(e,r)}};break;case ct.BOOL:case ct.INT:if("number"==typeof s)return{type:a,set:r=>{t.uniform1i(e,r)}};break;case ct.INT_SAMPLER_2D:case ct.INT_SAMPLER_2D_ARRAY:case ct.INT_SAMPLER_3D:case ct.INT_SAMPLER_CUBE:case ct.SAMPLER_2D:case ct.SAMPLER_3D:case ct.SAMPLER_CUBE:case ct.SAMPLER_2D_SHADOW:case ct.SAMPLER_2D_ARRAY:case ct.SAMPLER_2D_ARRAY_SHADOW:case ct.SAMPLER_CUBE_SHADOW:case ct.UNSIGNED_INT_SAMPLER_2D:case ct.UNSIGNED_INT_SAMPLER_3D:case ct.UNSIGNED_INT_SAMPLER_CUBE:case ct.UNSIGNED_INT_SAMPLER_2D_ARRAY:if("object"==typeof s&&"unit"in s)return{type:a,set:r=>{const{unit:a}=r;t.uniform1i(e,a)}};break;case ct.FLOAT_VEC2:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform2fv(e,r,n,i)}};break;case ct.BOOL_VEC2:case ct.INT_VEC2:if(s instanceof Int32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform2iv(e,r)}};break;case ct.UNSIGNED_INT_VEC2:if(s instanceof Uint32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform2uiv(e,r,n,i)}};break;case ct.FLOAT_VEC3:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform3fv(e,r,n,i)}};break;case ct.BOOL_VEC3:case ct.INT_VEC3:if(s instanceof Int32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform3iv(e,r,n,i)}};break;case ct.UNSIGNED_INT_VEC3:if(s instanceof Uint32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform3uiv(e,r,n,i)}};break;case ct.FLOAT_VEC4:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform4fv(e,r,n,i)}};break;case ct.BOOL_VEC4:case ct.INT_VEC4:if(s instanceof Int32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform4iv(e,r,n,i)}};break;case ct.UNSIGNED_INT_VEC4:if(s instanceof Uint32Array||Array.isArray(s))return{type:a,set:r=>{t.uniform4uiv(e,r,n,i)}};break;case ct.FLOAT_MAT2:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix2fv(e,o,r,n,i)}};break;case ct.FLOAT_MAT3:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix3fv(e,o,r,n,i)}};break;case ct.FLOAT_MAT4:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix4fv(e,o,r)}};break;case ct.FLOAT_MAT2x3:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix2x3fv(e,o,r,n,i)}};break;case ct.FLOAT_MAT2x4:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix2x4fv(e,o,r,n,i)}};break;case ct.FLOAT_MAT3x2:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix3x2fv(e,o,r,n,i)}};break;case ct.FLOAT_MAT3x4:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix3x4fv(e,o,r,n,i)}};break;case ct.FLOAT_MAT4x2:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix4x2fv(e,o,r,n,i)}};break;case ct.FLOAT_MAT4x3:if(s instanceof Float32Array||Array.isArray(s))return{type:a,set:r=>{t.uniformMatrix4x3fv(e,o,r,n,i)}}}return null}static getUniformsListSetter(t,r,e){const{internalProgram:a}=r,s=Object.keys(e);let n=t.getUniformIndices(a,s);if(null===n)return console.error("No uniform indices found."),null;const i=t.getProgramParameter(a,t.ACTIVE_UNIFORMS),o=Array.from(n).filter(((t,r)=>{const e=t>=0&&t<i;return e||console.warn(`Uniform ${s[r]} could not be located.`),e})),h={};return o.map((r=>t.getActiveUniform(a,r))).forEach((({name:r,type:s})=>{const n=e[r],i=t.getUniformLocation(a,r);if(null===i)return console.warn(`Uniform ${r} could not be located.`),null;const o=this.getUniformSetter(t,n,i,s);o&&(h[r]=o)})),{setters:h,program:r}}static setUniformsListValues(t,r,e){const{program:a,setters:s}=r;Et.useProgram(t,a),Object.entries(e).forEach((([t,r])=>{if(t in s){const e=s[t],{value:a}=r;e.set(a)}else console.error(`Uniform ${t} does not match any of the given setters.`)}))}}var ft,At;class Tt{static getBindingPointsEntries(){return function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)}(this,ft,"f",At).entries()}static createUniformBlock(t,r,e){const{internalProgram:a}=r,s=t.getUniformBlockIndex(a,e);if(s===t.INVALID_INDEX)return console.error(`Block '${e}' does not identify a valid uniform block.`),null;const n=t.getActiveUniformBlockParameter(a,s,t.UNIFORM_BLOCK_DATA_SIZE),i={},o=t.getActiveUniformBlockParameter(a,s,t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES);return t.getActiveUniforms(a,o,t.UNIFORM_OFFSET).forEach(((r,e)=>{const s=o[e],n=t.getActiveUniform(a,s);if(null!==n){const{name:t}=n;i[t]={byteOffset:r}}})),{name:e,blockIndex:s,blockSize:n,layout:i,program:r}}static createUniformBuffer(t,r,e,a){const s=t.createBuffer();if(null===s)return null;const n=t.UNIFORM_BUFFER;t.bindBuffer(n,s),a=null!=a?a:g.STATIC_READ;const i=(e=null!=e&&e)?this.lastBindingPoint++:void 0;return t.bufferData(n,r,a),{internalBuffer:s,byteLength:r,bindingPoint:i,target:n,usage:a}}static createRangedUniformBuffers(t,r,e,a){const s=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT),n=r.reduce(((t,r)=>t+Math.max(Math.ceil(r.blockSize/s),1)*s),0),i=this.createUniformBuffer(t,n,!1,a);if(null===i)return null;e=null!=e&&e;let o=0;return r.map((t=>{const{blockSize:r}=t,a=e?this.lastBindingPoint++:void 0,n={...i,bindingPoint:a,rangeOffset:o,rangeSize:r};return o+=Math.max(Math.ceil(r/s),1)*s,n}))}static setUniformBufferValues(t,r,e,a){const{internalBuffer:s,target:n}=e;t.getParameter(t.UNIFORM_BUFFER_BINDING)!==s&&t.bindBuffer(n,s);const{layout:i,name:o}=r,{rangeOffset:h}=e;Object.entries(a).forEach((([r,e])=>{const{value:a}=e;r in i||console.warn(`${r} does not exist in block ${o}.`);const{byteOffset:s}=i[r];t.bufferSubData(n,s+(null!=h?h:0),_t.asArrayBufferView(a))}))}static setUniformBufferData(t,r,e,a,s,n){const{internalBuffer:i,target:o}=r;let{rangeOffset:h}=r;t.bindBuffer(o,i);const c=(null!=h?h:0)+(null!=a?a:0);e instanceof ArrayBuffer?t.bufferSubData(o,c,e):(s=null!=s?s:0,t.bufferSubData(o,c,e,s,n))}static bindUniformBuffer(t,r,e){const{internalBuffer:a,target:s}=e;let{rangeOffset:n,rangeSize:i}=e;const{bindingPoint:o}=e,{program:h,blockIndex:c}=r,{internalProgram:u}=h;void 0!==o&&(r.buffer=e,t.uniformBlockBinding(u,c,o),void 0!==o&&(void 0!==n&&void 0!==i?t.bindBufferRange(s,o,a,n,i):t.bindBufferBase(s,o,a)))}}ft=Tt,At={value:new Map},Tt.lastBindingPoint=0;var mt,Rt,dt,Nt,gt,St,It,Pt,Mt,pt,Lt,wt,Ut,Ot=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)};class Ct{static createTextures(t,r){const e={};return Object.entries(r).forEach((([r,a])=>{const s=yt.createTexture(t,r,a);null!==s&&(e[r]=s)})),e}static createPacket(t,r){var e;const{program:a,vertexArray:s,uniforms:n,uniformBlocks:i,uniformBuffers:o}=r,{drawCommand:h}=r;let c,u=null;if(u=w.createVertexArray(t,a,s),null===u)return null;if(void 0!==n){if(c=_t.getUniformsListSetter(t,a,n),null===c)return null;_t.setUniformsListValues(t,c,n)}let l={};const y=i?Object.entries(i):[],E=(null!==(e=null==o?void 0:o.length)&&void 0!==e?e:0)-1;return y.forEach((([t,r])=>{const{buffer:e}=r;void 0!==e&&e>E&&console.error(`Uniform buffer with index ${e} does not exist.`)})),o&&o.forEach(((r,e)=>{const s=y.filter((([t,r])=>r.buffer===e)),n=s.map((([r,e])=>Tt.createUniformBlock(t,a,r))),{length:i}=n;if("internalBuffer"in r)n.forEach((e=>{const{name:a}=e;Tt.bindUniformBuffer(t,e,r),l[a]=e}));else if(i>0){const{usage:e,data:a}=r;if(i>1){const r=Tt.createRangedUniformBuffers(t,n,!0,e);a&&Tt.setUniformBufferData(t,r[0],a),n.forEach(((e,a)=>{const{name:n}=e,i=r[a];Tt.bindUniformBuffer(t,e,i);const{uniforms:o}=s[a][1];o&&Tt.setUniformBufferValues(t,e,i,o),l[n]=e}))}else{const r=n[0],{blockSize:i,name:o}=r,h=Tt.createUniformBuffer(t,i,!0,e);if(null===h)return null;a&&Tt.setUniformBufferData(t,h,a),Tt.bindUniformBuffer(t,r,h);const{uniforms:c}=s[0][1];c&&Tt.setUniformBufferValues(t,r,h,c),l[o]=r}}})),y.filter((([t,r])=>void 0===r.buffer)).forEach((([r,e])=>{const{uniforms:s}=e,n=Tt.createUniformBlock(t,a,r);if(null===n)return null;const{blockSize:i}=n,o=Tt.createUniformBuffer(t,i,!0);if(null===o)return null;Tt.bindUniformBuffer(t,n,o),void 0!==s&&Tt.setUniformBufferValues(t,n,o,s),l[r]=n})),{program:a,vertexArray:u,uniforms:c,uniformBlocks:l,drawCommand:h}}static setPacketValues(t,r,e){const{vertexArray:a,uniforms:s,uniformBlocks:n}=e,{vertexArray:i,uniforms:o,uniformBlocks:h}=r;void 0!==a&&w.setVertexArrayValues(t,i,a),void 0!==o&&void 0!==s&&_t.setUniformsListValues(t,o,s),void 0!==h&&void 0!==n&&(n?Object.entries(n):[]).forEach((([r,e])=>{const{uniforms:a}=e,s=h[r],{buffer:n}=s;n&&Tt.setUniformBufferValues(t,s,n,a)}))}static enableMultidrawExtension(t){!function(t,r,e,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof r?t!==r||!s:!r.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===a?s.call(t,e):s?s.value=e:r.set(t,e)}(this,mt,t.getExtension("WEBGL_multi_draw"),"f",Rt)}static drawPacket(t,r,e=r.drawCommand){const{vertexArray:a}=r,{program:s,internalVertexArray:n,elementBuffer:i}=a,{mode:o,elementsCount:h,instanceCount:c,multiDraw:u}=e;if(Et.useProgram(t,s),t.getParameter(t.VERTEX_ARRAY_BINDING)!==n&&t.bindVertexArray(n),i){const{indexType:r}=i;if(void 0!==c&&void 0!==h)t.drawElementsInstanced(o,h,r,0,c);else if(u){const t=Ot(this,mt,"f",Rt),{countsList:e,countsOffset:a,offsetsList:s,offsetsOffset:n,drawCount:i,instanceCountsList:h,instanceCountsOffset:c}=u;void 0!==h&&void 0!==c?t.multiDrawElementsInstancedWEBGL(o,e,a,r,s,n,h,c,i):t.multiDrawElementsWEBGL(o,e,a,r,s,n,i)}else void 0!==h&&t.drawElements(o,h,r,0)}else if(void 0!==c&&void 0!==h)t.drawArraysInstanced(o,0,h,c);else if(u){const t=Ot(this,mt,"f",Rt),{countsList:r,countsOffset:e,firstsList:a,firstsOffset:s,drawCount:n,instanceCountsList:i,instanceCountsOffset:h}=u;void 0!==i&&void 0!==h?t.multiDrawArraysInstancedWEBGL(o,a,s,r,e,i,h,n):t.multiDrawArraysWEBGL(o,a,s,r,e,n)}else void 0!==h&&t.drawArrays(o,0,h)}}mt=Ct,Rt={value:null},function(t){t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(dt||(dt={})),function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"}(Nt||(Nt={})),function(t){t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(gt||(gt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(St||(St={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(It||(It={})),function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX"}(Pt||(Pt={})),function(t){t[t.BLEND=3042]="BLEND",t[t.CULL_FACE=2884]="CULL_FACE",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD"}(Mt||(Mt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(pt||(pt={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(Lt||(Lt={})),function(t){t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT"}(wt||(wt={})),function(t){t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST"}(Ut||(Ut={}));class Bt{static hint(t,r,e){t.hint(r,e)}static frontFace(t,r){t.frontFace(r)}static scissor(t,r,e,a,s){t.scissor(r,e,a,s)}static viewport(t,r,e,a,s){t.viewport(r,e,a,s)}static clearColor(t,r){t.clearColor(r[0],r[1],r[2],r[3])}static depthFunction(t,r){t.depthFunc(r)}static blendEquation(t,r){t.blendEquation(r)}static blendFunction(t,r,e){t.blendFunc(r,e)}static blendFunctionSeparate(t,r,e,a,s){t.blendFuncSeparate(r,e,a,s)}static stencilFunction(t,r,e,a,s){t.stencilFuncSeparate(s,r,e,a)}static stencilOperations(t,r,e,a,s){t.stencilOpSeparate(s,r,e,a)}static stencilMask(t,r,e){t.stencilMaskSeparate(e,r)}static colorMask(t,r,e,a,s){t.colorMask(r,e,a,s)}static depthMask(t,r){t.depthMask(r)}static enable(t,r){t.enable(r)}static disable(t,r){t.disable(r)}static clear(t,r){t.clear(r)}static getViewport(t){return t.getParameter(t.VIEWPORT)}static getMaxSamples(t){return t.getParameter(t.MAX_SAMPLES)}static drawBuffers(t,r){t.drawBuffers(r)}static clearBuffers(t,r,e,a,s){a instanceof Float32Array?t.clearBufferfv(r,e,a,s):a instanceof Int32Array?t.clearBufferiv(r,e,a,s):a instanceof Uint32Array&&t.clearBufferuiv(r,e,a,s)}}async function bt(){!async function(){const t=document.createElement("canvas");t.style.display="block",t.tabIndex=0,t.oncontextmenu=()=>!1,t.width=1e3,t.height=800;const r=t.getContext("webgl2");if(null==r)return;Ct.enableMultidrawExtension(r);const e=document.createElement("button");e.textContent="Pause";let a=!1;null!==e&&(e.onclick=()=>{a=!a,e.textContent=a?"Play":"Pause",a||requestAnimationFrame(C)}),document.body.append(e,t);const s=await fetch("assets/engine/shaders/common/multi/lines.vert").then((t=>t.text())),i=await fetch("assets/engine/shaders/common/multi/lines.frag").then((t=>t.text())),u=Et.createProgram(r,{vertexSource:s,fragmentSource:i});if(null===u)return;const l=1/3*Math.PI,E=t.width/t.height,_=new K(l,E,.1,1e3);_.transform.setTranslation(new h([0,10,0])),_.transform.lookAt(new h(0,-1,0),c.up);const f=new class{constructor(t,r){var e,a;A.set(this,void 0),this.camera=t,this.rotationSpeed=null!==(e=null==r?void 0:r.rotationSpeed)&&void 0!==e?e:50,this.translationSpeed=null!==(a=null==r?void 0:r.translationSpeed)&&void 0!==a?a:8,function(t,r,e,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof r?t!==r||!s:!r.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===a?s.call(t,e):s?s.value=e:r.set(t,e)}(this,A,new n,"f")}update(t){const{camera:r,rotationSpeed:e,translationSpeed:a}=this,{transform:s}=r,n=function(t,r,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!a:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:r.get(t)}(this,A,"f"),i=s.getTranslation(new h),u=s.getBackward(new h),{array:l}=u,{origin:E,up:_,down:f}=c;let m=s.getUp(new h).dot(_);if(T.getKey(o.Z)||T.getKey(o.ARROW_UP)){const r=s.getBackward(new h).scale(a*t);s.translate(r)}if(T.getKey(o.Q)||T.getKey(o.ARROW_LEFT)){const r=s.getLeft(new h).scale(a*t);s.translate(r)}if(T.getKey(o.S)||T.getKey(o.ARROW_DOWN)){const r=s.getForward(new h).scale(a*t);s.translate(r)}if(T.getKey(o.D)||T.getKey(o.ARROW_RIGHT)){const r=s.getRight(new h).scale(a*t);s.translate(r)}if(T.getMouseButtonDown(y.RIGHT)&&n.copy(T.getPointerScreenPosition()),T.getMouseButton(y.RIGHT)){const r=T.getPointerScreenPosition();if(!r.equals(n)){const a=(n.x-r.x)*e*t,o=(n.y-r.y)*e*t;if(i.copy(s.getTranslation(new h)),0!==a||0!==o){m=Math.sign(s.getUp(new h).dot(_)),u.toSpherical(E);const t=l[1],r=l[2],e=t+m*-o;e<=0||e>=Math.PI?(l[2]=(r-a+Math.PI)%(2*Math.PI),l[1]=e<0?-e:Math.PI-(e-Math.PI),m*=-1):(l[2]=(r-a)%(2*Math.PI),l[1]=t+m*-o),u.toCartesian(E),s.lookAt(i.add(u),m>0?_:f)}n.copy(r)}}}}(_),m=new class extends class{constructor(t){this.geometry=t.geometry,this.material=t.material}}{constructor(t){const{viewProjection:r}=t,e=r.invert(),a=[new N(-1,-1,0,1),new N(-1,1,0,1),new N(1,1,0,1),new N(1,-1,0,1),new N(-1,-1,1,1),new N(-1,1,1,1),new N(1,1,1,1),new N(1,-1,1,1)];a.forEach((t=>{e.transformPoint4(t),console.log(t.w),t.multScalar(1/t.w)}));const[s,n,i,o,c,u,l,y]=a.map((t=>{const[r,e,a]=t.array;return new h(r,e,a)})),E=[...s,...n,...n,...i,...i,...o,...o,...s,...s,...c,...n,...u,...o,...y,...i,...l,...c,...u,...u,...l,...l,...y,...y,...c],_=R.RED,f=R.GREEN,A=R.BLUE,T=[..._,..._,..._,..._,..._,..._,..._,..._,...A,...A,...A,...A,...A,...A,...A,...A,...f,...f,...f,...f,...f,...f,...f,...f];super({geometry:new O({a_position:{array:new Float32Array(E),type:M.VEC3},a_color:{array:new Float32Array(T),type:M.VEC3}}),material:new L}),this.camera=t}}(new K(l,E,.1,250)),d=(new k).setIdentity(),S=m.geometry.getAttribute("a_position"),P=m.geometry.getAttribute("a_color"),p=Ct.createPacket(r,{program:u,vertexArray:{vertexAttributes:{a_position:S,a_color:P}},uniformBuffers:[{usage:g.STATIC_READ}],uniformBlocks:{basicModelBlock:{buffer:0,uniforms:{"instances[0].u_model":{value:d.array},"instances[0].u_color":{value:[1,0,0]}}},viewBlock:{uniforms:{u_view:{value:_.view.array},u_projection:{value:_.projection.array}}}},drawCommand:{mode:I.LINES,elementsCount:S.array.length}});if(null===p)return;console.log(p),Bt.viewport(r,0,0,t.width,t.height),Bt.enable(r,Mt.CULL_FACE),Bt.enable(r,Mt.DEPTH_TEST),Bt.clearColor(r,R.BLACK),T.initialize(t);let w,U=0;const C=t=>{a||(w=(t*=.001)-U,U=t,Bt.clear(r,Nt.COLOR_BUFFER_BIT|Nt.DEPTH_BUFFER_BIT),f.update(w),Ct.setPacketValues(r,p,{uniformBlocks:{viewBlock:{uniforms:{u_view:{value:_.view.array},u_projection:{value:_.projection.array}}}}}),Ct.drawPacket(r,p),T.clear(),requestAnimationFrame(C))};requestAnimationFrame(C)}()}})(),main=r})();
//# sourceMappingURL=main.js.map