{"version":3,"file":"main.js","mappings":"4BACA,IAAIA,EAAsB,CCA1BA,EAAwB,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXF,EAAoBI,EAAEF,EAAYC,KAASH,EAAoBI,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,GCNDH,EAAoBS,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAOC,MAAQ,IAAIC,SAAS,cAAb,EAChB,CAAE,MAAOC,GACR,GAAsB,iBAAXC,OAAqB,OAAOA,MACxC,CACA,CAPuB,GCAxBd,EAAoBI,EAAI,CAACW,EAAKC,IAAUX,OAAOY,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFhB,EAAoBoB,EAAKnB,IACH,oBAAXoB,QAA0BA,OAAOC,aAC1CjB,OAAOC,eAAeL,EAASoB,OAAOC,YAAa,CAAEC,MAAO,WAE7DlB,OAAOC,eAAeL,EAAS,aAAc,CAAEsB,OAAO,GAAO,E,MCL9D,IAAIC,EACAxB,EAAoBS,EAAEgB,gBAAeD,EAAYxB,EAAoBS,EAAEiB,SAAW,IACtF,IAAIC,EAAW3B,EAAoBS,EAAEkB,SACrC,IAAKH,GAAaG,IACbA,EAASC,gBACZJ,EAAYG,EAASC,cAAcC,MAC/BL,GAAW,CACf,IAAIM,EAAUH,EAASI,qBAAqB,UACzCD,EAAQE,SAAQR,EAAYM,EAAQA,EAAQE,OAAS,GAAGH,IAC5D,CAID,IAAKL,EAAW,MAAM,IAAIS,MAAM,yDAChCT,EAAYA,EAAUU,QAAQ,OAAQ,IAAIA,QAAQ,QAAS,IAAIA,QAAQ,YAAa,KACpFlC,EAAoBmC,EAAIX,C,gDC8DxB,MAAMY,EAzDN,MACYC,iBACAC,cACAC,aACAC,mBAER,eAAIC,GACA,OAAO9B,KAAK4B,YAChB,CAEA,mBAAAG,CAAoBC,GAChBhC,KAAK4B,aAAeI,EACpBhC,KAAK6B,mBAAmBG,EAC5B,CAEA,WAAAA,CAAYC,GACRjC,KAAK4B,aAAeK,EAAKH,YACzB9B,KAAK6B,mBAAqBI,EAAKC,kBAC/BlC,KAAK2B,cAAgB,IAAIQ,GAC7B,CAEA,cAAAC,CAAeC,GACXrC,KAAK0B,iBAAmBW,CAC5B,CAEA,gBAAAC,UACWtC,KAAK0B,gBAChB,CAEA,cAAAa,CAAeF,GACX,MAAMG,EAAiBxC,KAAK0B,kBAAoBW,EAChD,QAA8B,IAAnBG,EACP,OAAOxC,KAAK4B,aAEhB,MAAMI,EAAchC,KAAK2B,cAAc9B,IAAI2C,GAC3C,QAA2B,IAAhBR,EACP,MAAM,IAAIV,MAAM,gCAAgCkB,KAEpD,OAAOR,CACX,CAEA,MAAAS,CAAOR,GACH,MAAMD,EAAchC,KAAKuC,eAAeN,GAAMI,WAC9C,OAAIJ,GAAMA,KAEC,IAAID,KADQU,MAAMC,KAAKV,EAAKA,OAGhC,IAAID,CACf,CAEA,QAAAY,CAASZ,EAAgBK,GAChBrC,KAAK2B,cAAckB,IAAIR,IACxBrC,KAAK2B,cAAcmB,IAAIT,EAAWL,EAE1C,GC1EG,MAAMe,UAAkBzB,MAC3B0B,KAAO,YCiDX,MAAMC,EACIC,MAOT,WAAAlB,IACKC,GAEJ,GAAuB,iBAAZA,EAAK,GACfjC,KAAKkD,MAAQ,IAAIC,aAAa,CAAClB,EAAK,GAAIA,EAAK,UAEzC,GAAuB,iBAAZA,EAAK,GAAiB,CACrC,MAAMiB,EAAQjB,EAAK,GACnB,GAAIiB,EAAM7B,OAAS,EAClB,MAAM,IAAI0B,EAAU,uCAEjBG,aAAiBC,aACpBnD,KAAKkD,MAAQA,EAGblD,KAAKkD,MAAQ,IAAIC,aAAaD,E,MAI/BlD,KAAKkD,MAAQ,IAAIC,aAAa,CAAC,EAAG,GAEpC,CAEA,UAAIC,GACH,MAAO,CACNpD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GAEb,CAEA,UAAIE,CAAOA,GACVpD,KAAKkD,MAAM,GAAKE,EAAO,GACvBpD,KAAKkD,MAAM,GAAKE,EAAO,EACxB,CAEA,KAAIC,GACH,OAAOrD,KAAKkD,MAAM,EACnB,CAEA,KAAIG,CAAEA,GACLrD,KAAKkD,MAAM,GAAKG,CACjB,CAEA,KAAIC,GACH,OAAOtD,KAAKkD,MAAM,EACnB,CAEA,KAAII,CAAEA,GACLtD,KAAKkD,MAAM,GAAKI,CACjB,CAEA,SAAAC,CAAUF,EAAWC,GACpB,MAAM7D,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAK4D,EACP5D,EAAE,GAAK6D,EAEAtD,IACR,CAEA,MAAAwD,CAAOC,GACN,MAAMC,EAAID,EAAIP,MACRzD,EAAIO,KAAKkD,MAEf,OAAOQ,EAAE,KAAOjE,EAAE,IACdiE,EAAE,KAAOjE,EAAE,EAChB,CAEA,IAAAkE,CAAKF,GACJ,MAAMhE,EAAIO,KAAKkD,MACTQ,EAAID,EAAIP,MAKd,OAHAzD,EAAE,GAAKiE,EAAE,GACTjE,EAAE,GAAKiE,EAAE,GAEF1D,IACR,CAEA,KAAA4D,GACC,OAAO,IAAIX,EAAYjD,KAAKoD,OAC7B,CAEA,OAAAS,GACC,MAAMpE,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAK,EACPA,EAAE,GAAK,EAEAO,IACR,CAEA,QAAA8D,GACC,MAAMrE,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAK,EACPA,EAAE,GAAK,EAEAO,IACR,CAEA,GAAA+D,CAAIN,GACH,MAAMC,EAAID,EAAIP,MACRzD,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAKA,EAAE,GAAKiE,EAAE,GAChBjE,EAAE,GAAKA,EAAE,GAAKiE,EAAE,GAET1D,IACR,CAEA,SAAAgE,CAAUC,GACT,MAAMxE,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EAEPjE,IACR,CAEA,GAAAkE,CAAIT,GACH,MAAMC,EAAID,EAAIP,MACRzD,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAKA,EAAE,GAAKiE,EAAE,GAChBjE,EAAE,GAAKA,EAAE,GAAKiE,EAAE,GAET1D,IACR,CAEA,IAAAmE,CAAKV,EAAkBW,GACtB,MAAMV,EAAID,EAAIP,MACRzD,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAK2E,GAAKV,EAAE,GAAKjE,EAAE,IACrBA,EAAE,GAAK2E,GAAKV,EAAE,GAAKjE,EAAE,IAEdO,IACR,CAEA,KAAAqE,CAAMC,EAAkBC,GACvB,MAAM9E,EAAIO,KAAKkD,MACTsB,EAAIF,EAAIpB,MACRpD,EAAIyE,EAAIrB,MAKd,OAHAzD,EAAE,GAAKgF,KAAKH,IAAIxE,EAAE,GAAI2E,KAAKH,IAAI7E,EAAE,GAAI+E,EAAE,KACvC/E,EAAE,GAAKgF,KAAKH,IAAIxE,EAAE,GAAI2E,KAAKH,IAAI7E,EAAE,GAAI+E,EAAE,KAEhCxE,IACR,CAEA,UAAA0E,CAAWT,GACV,MAAMxE,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EAEPjE,IACR,CAEA,KAAA2E,CAAMlB,GACL,MAAMmB,EAAI5E,KAAKkD,MACT2B,EAAIpB,EAAIP,MAEd,OAAO0B,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,EAC/B,CAEA,GAAAC,CAAIrB,GACH,MAAMmB,EAAI5E,KAAKkD,MACT2B,EAAIpB,EAAIP,MAEd,OAAQ0B,EAAE,GAAKC,EAAE,GAAOD,EAAE,GAAKC,EAAE,EAClC,CAEA,MAAAxD,GACC,MAAMqC,EAAI1D,KAAKkD,MAEf,OAAOuB,KAAKM,KAAKrB,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GACzC,CAEA,aAAAsB,GACC,MAAMtB,EAAI1D,KAAKkD,MAEf,OAAOQ,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,EAC/B,CAEA,IAAAuB,CAAKxB,GACJ,MAAMmB,EAAI5E,KAAKkD,MACT2B,EAAIpB,EAAIP,MAERgC,EAAKN,EAAE,GAAKC,EAAE,GACdM,EAAKP,EAAE,GAAKC,EAAE,GAEpB,OAAOJ,KAAKM,KAAKG,EAAKA,EAAKC,EAAKA,EACjC,CAEA,WAAAC,CAAY3B,GACX,MAAMmB,EAAI5E,KAAKkD,MACT2B,EAAIpB,EAAIP,MAERgC,EAAKN,EAAE,GAAKC,EAAE,GACdM,EAAKP,EAAE,GAAKC,EAAE,GAEpB,OAAOK,EAAKA,EAAKC,EAAKA,CACvB,CAEA,SAAAE,GACC,MAAM5F,EAAIO,KAAKkD,MAEToC,EAAQ7F,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAC/B8F,EAAMd,KAAKM,KAAKO,GAUtB,OATIC,EAAMC,OAAOC,SAChBhG,EAAE,GAAKA,EAAE,GAAK8F,EACd9F,EAAE,GAAKA,EAAE,GAAK8F,IAGd9F,EAAE,GAAK,EACPA,EAAE,GAAK,GAGDO,IACR,CAEA,MAAA0F,GACC,MAAMjG,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GAEHO,IACR,CAIA,IAAA2F,CAAKC,GACJ,GAAIA,aAAgBC,EAAS,CAC5B,MAAMnC,EAAIkC,EAAK1C,MAKf,OAHAlD,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKQ,EAAE,GAClC1D,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKQ,EAAE,GAE3B1D,I,CAEH,CACJ,MAAMqD,EAAIrD,KAAKqD,EACTC,EAAItD,KAAKsD,EAETwC,EAAIF,EAAK1C,MAKf,OAHAlD,KAAKqD,EAAIA,EAAIyC,EAAE,GAAKxC,EAAIwC,EAAE,GAC1B9F,KAAKsD,EAAID,EAAIyC,EAAE,GAAKxC,EAAIwC,EAAE,GAEnB9F,I,CAET,CAEA,SAAA+F,CAAUtC,EAAkBQ,GAC3B,MAAMP,EAAID,EAAIP,MACRzD,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAKA,EAAE,GAAKiE,EAAE,GAAKO,EACrBxE,EAAE,GAAKA,EAAE,GAAKiE,EAAE,GAAKO,EAEdjE,IACR,CAEA,cAAAgG,CAAeC,EAAgCC,EAAiB,GAC/D,MAAMxC,EAAI1D,KAAKkD,MAEf+C,EAAIC,GAAcxC,EAAE,GACpBuC,EAAIC,EAAS,GAAKxC,EAAE,EAClB,CAEA,aAAAyC,CAAcC,EAAwBF,EAAiB,GACzD,MAAMzG,EAAIO,KAAKkD,MAKf,OAHAzD,EAAE,GAAK2G,EAAIF,GACXzG,EAAE,GAAK2G,EAAIF,EAAS,GAEblG,IACL,CAEH,UAAAqG,CAAWC,EAAmBC,GAC7B,MAAM9G,EAAIO,KAAKkD,MACT0B,EAAI0B,EAAKpD,MACT2B,EAAI0B,EAAKrD,MAKf,OAHAzD,EAAE,GAAKmF,EAAE,GAAKC,EAAE,GAChBpF,EAAE,GAAKmF,EAAE,GAAKC,EAAE,GAET7E,IACR,EAGD,IAAI6F,EAA8B5C,EACoB,IAAIxB,EAAS,CAClEK,YAAamB,EACbf,kBACEsE,IACAX,EAAUW,CAAI,ICrSjB,MAAMC,EACIvD,MAOT,WAAAlB,IACKC,GAEJ,GAAuB,iBAAZA,EAAK,GACfjC,KAAKkD,MAAQ,IAAIC,aAAa,CAAClB,EAAK,GAAIA,EAAK,GAAIA,EAAK,UAElD,GAAuB,iBAAZA,EAAK,GAAiB,CACrC,MAAMiB,EAAQjB,EAAK,GACnB,GAAIiB,EAAM7B,OAAS,EAClB,MAAM,IAAI0B,EAAU,uCAEjBG,aAAiBC,aACpBnD,KAAKkD,MAAQA,EAGblD,KAAKkD,MAAQ,IAAIC,aAAaD,E,MAI/BlD,KAAKkD,MAAQ,IAAIC,aAAa,CAAC,EAAG,EAAG,GAEvC,CAEA,QAAAuD,GACC,MAAO,YAAYhE,MAAMC,KAAK3C,KAAKkD,OAAOyD,KAAK,SAChD,CAEA,YAAOC,CAAMC,EAAkBC,GAC9B,MAAMC,EAAO,IAAIC,EACjB,OAAOvC,KAAKwC,KAAKF,EAAKpD,KAAKkD,GAAS/B,IAAIgC,IAAYrC,KAAKM,KAAKgC,EAAKpD,KAAKkD,GAAS/B,IAAI+B,IAAYpC,KAAKM,KAAKgC,EAAKpD,KAAKmD,GAAShC,IAAIgC,KACnI,CAEA,UAAI1D,GACH,MAAO,CACNpD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GAEb,CAEA,UAAIE,CAAOA,GACVpD,KAAKkD,MAAM,GAAKE,EAAO,GACvBpD,KAAKkD,MAAM,GAAKE,EAAO,GACvBpD,KAAKkD,MAAM,GAAKE,EAAO,EACxB,CAEA,KAAIC,GACH,OAAOrD,KAAKkD,MAAM,EACnB,CAEA,KAAIG,CAAEA,GACLrD,KAAKkD,MAAM,GAAKG,CACjB,CAEA,KAAIC,GACH,OAAOtD,KAAKkD,MAAM,EACnB,CAEA,KAAII,CAAEA,GACLtD,KAAKkD,MAAM,GAAKI,CACjB,CAEA,KAAI4D,GACH,OAAOlH,KAAKkD,MAAM,EACnB,CAEA,KAAIgE,CAAEA,GACLlH,KAAKkD,MAAM,GAAKgE,CACjB,CAEA,SAAA3D,CAAUF,EAAWC,EAAW4D,GAK/B,OAJAlH,KAAKkD,MAAM,GAAKG,EAChBrD,KAAKkD,MAAM,GAAKI,EAChBtD,KAAKkD,MAAM,GAAKgE,EAETlH,IACR,CAEA,IAAA2D,CAAKF,GACJ,MAAMC,EAAID,EAAIP,MAMd,OAJAlD,KAAKkD,MAAM,GAAKQ,EAAE,GAClB1D,KAAKkD,MAAM,GAAKQ,EAAE,GAClB1D,KAAKkD,MAAM,GAAKQ,EAAE,GAEX1D,IACR,CAEA,KAAA4D,GACC,OAAO,IAAI6C,EAAYzG,KAAKoD,OAC7B,CAEA,MAAAI,CAAO2D,GACN,OAAOA,EAAOjE,MAAM,KAAOlD,KAAKkD,MAAM,IAClCiE,EAAOjE,MAAM,KAAOlD,KAAKkD,MAAM,IAC/BiE,EAAOjE,MAAM,KAAOlD,KAAKkD,MAAM,EACpC,CAEA,QAAAY,GAIC,OAHA9D,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EACTlD,IACR,CAEA,OAAA6D,GAIC,OAHA7D,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EACTlD,IACR,CAEA,GAAA+D,CAAIoD,GAIH,OAHAnH,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAC7ClD,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAC7ClD,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GACtClD,IACR,CAEA,SAAAgE,CAAUC,GAIT,OAHAjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKe,EAChCjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKe,EAChCjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKe,EACzBjE,IACR,CAEA,GAAAkE,CAAIiD,GAIH,OAHAnH,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAC7ClD,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAC7ClD,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GACtClD,IACR,CAEA,IAAAmE,CAAKxB,EAAeyE,EAAahD,GAIhC,OAHApE,KAAKkD,MAAM,IAAM,EAAIkB,GAAKzB,EAAKU,EAAIe,GAAKgD,EAAG/D,EAAIV,EAAKU,GACpDrD,KAAKkD,MAAM,IAAM,EAAIkB,GAAKzB,EAAKW,EAAIc,GAAKgD,EAAG9D,EAAIX,EAAKW,GACpDtD,KAAKkD,MAAM,IAAM,EAAIkB,GAAKzB,EAAKuE,EAAI9C,GAAKgD,EAAGF,EAAIvE,EAAKuE,GAC7ClH,IACR,CAEA,GAAAuE,CAAIuC,GAIH,OAHA9G,KAAKkD,MAAM,GAAKuB,KAAKF,IAAIvE,KAAKkD,MAAM,GAAI4D,EAAQ5D,MAAM,IACtDlD,KAAKkD,MAAM,GAAKuB,KAAKF,IAAIvE,KAAKkD,MAAM,GAAI4D,EAAQ5D,MAAM,IACtDlD,KAAKkD,MAAM,GAAKuB,KAAKF,IAAIvE,KAAKkD,MAAM,GAAI4D,EAAQ5D,MAAM,IAC/ClD,IACR,CAEA,GAAAsE,CAAIwC,GAIH,OAHA9G,KAAKkD,MAAM,GAAKuB,KAAKH,IAAItE,KAAKkD,MAAM,GAAI4D,EAAQ5D,MAAM,IACtDlD,KAAKkD,MAAM,GAAKuB,KAAKH,IAAItE,KAAKkD,MAAM,GAAI4D,EAAQ5D,MAAM,IACtDlD,KAAKkD,MAAM,GAAKuB,KAAKH,IAAItE,KAAKkD,MAAM,GAAI4D,EAAQ5D,MAAM,IAC/ClD,IACR,CAEA,KAAAqE,CAAMC,EAAcC,GAInB,OAHAvE,KAAKkD,MAAM,GAAKuB,KAAKH,IAAIC,EAAIrB,MAAM,GAAIuB,KAAKF,IAAIvE,KAAKkD,MAAM,GAAIoB,EAAIpB,MAAM,KACzElD,KAAKkD,MAAM,GAAKuB,KAAKH,IAAIC,EAAIrB,MAAM,GAAIuB,KAAKF,IAAIvE,KAAKkD,MAAM,GAAIoB,EAAIpB,MAAM,KACzElD,KAAKkD,MAAM,GAAKuB,KAAKH,IAAIC,EAAIrB,MAAM,GAAIuB,KAAKF,IAAIvE,KAAKkD,MAAM,GAAIoB,EAAIpB,MAAM,KAClElD,IACR,CAEA,KAAAqH,CAAMpD,GAIL,OAHAjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKe,EAChCjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKe,EAChCjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKe,EACzBjE,IACR,CAEA,KAAA2E,CAAMwC,GACL,MAAMG,EAAKtH,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GACpEqE,EAAKvH,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GACpEsE,EAAKxH,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAI1E,OAHAlD,KAAKkD,MAAM,GAAKoE,EAChBtH,KAAKkD,MAAM,GAAKqE,EAChBvH,KAAKkD,MAAM,GAAKsE,EACTxH,IACR,CAEA,GAAA8E,CAAIrB,GACH,MAAMmB,EAAI5E,KAAKkD,MACT2B,EAAIpB,EAAIP,MAEd,OAAO0B,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,EAC7C,CAEA,MAAAxD,GACC,MAAMuD,EAAI5E,KAAKkD,MAEf,OAAOuB,KAAKM,KAAKH,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GACvD,CAEA,aAAAI,GACC,MAAMJ,EAAI5E,KAAKkD,MAEf,OAAO0B,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,EAC7C,CAEA,QAAA6C,CAAShE,GACR,MAAMmB,EAAI5E,KAAKkD,MACT2B,EAAIpB,EAAIP,MAERgC,EAAKN,EAAE,GAAKC,EAAE,GACdM,EAAKP,EAAE,GAAKC,EAAE,GACd6C,EAAK9C,EAAE,GAAKC,EAAE,GAEpB,OAAOJ,KAAKkD,MAAMzC,EAAIC,EAAIuC,EAC3B,CAEA,eAAAE,CAAgBnE,GACf,MAAMmB,EAAI5E,KAAKkD,MACT2B,EAAIpB,EAAIP,MAERgC,EAAKN,EAAE,GAAKC,EAAE,GACdM,EAAKP,EAAE,GAAKC,EAAE,GACd6C,EAAK9C,EAAE,GAAKC,EAAE,GAEpB,OAAOK,EAAKA,EAAKC,EAAKA,EAAKuC,EAAKA,CACjC,CAEA,SAAArC,GACC,MAAM,MAACnC,GAASlD,KACVqB,EAASrB,KAAKqB,SAYpB,OAXIA,EAASmE,OAAOC,SACnBvC,EAAM,IAAM7B,EACZ6B,EAAM,IAAM7B,EACZ6B,EAAM,IAAM7B,IAGZ6B,EAAM,GAAK,EACXA,EAAM,GAAK,EACXA,EAAM,GAAK,GAGLlD,IACR,CAEA,MAAA0F,GACC,MAAM,MAACxC,GAASlD,KAIhB,OAHAkD,EAAM,KAAO,EACbA,EAAM,KAAO,EACbA,EAAM,KAAO,EACNlD,IACR,CAIA,IAAA2F,CAAKC,GACJ,MAAM,MAAC1C,GAASlD,KAChB,GAAI4F,aAAgBoB,EAAS,CAC5B,MAAMtD,EAAIkC,EAAK1C,MAMf,OAJAA,EAAM,GAAKA,EAAM,GAAKQ,EAAE,GACxBR,EAAM,GAAKA,EAAM,GAAKQ,EAAE,GACxBR,EAAM,GAAKA,EAAM,GAAKQ,EAAE,GAEjB1D,I,CAEH,CACJ,MAAOqD,EAAGC,EAAG4D,GAAKlH,KAEZ8F,EAAIF,EAAK1C,MAMf,OAJAlD,KAAKqD,EAAIA,EAAIyC,EAAE,GAAKxC,EAAIwC,EAAE,GAAKoB,EAAIpB,EAAE,GACrC9F,KAAKsD,EAAID,EAAIyC,EAAE,GAAKxC,EAAIwC,EAAE,GAAKoB,EAAIpB,EAAE,GACrC9F,KAAKkH,EAAI7D,EAAIyC,EAAE,GAAKxC,EAAIwC,EAAE,GAAKoB,EAAIpB,EAAE,GAE9B9F,I,CAET,CAEA,WAAA6H,CAAYC,GACL,MAAMC,EAAY/H,KAAKkD,MACjB8E,EAAcF,EAAO5E,MAErBG,EAAI0E,EAAU,GAAKC,EAAY,GAC/B1E,EAAIyE,EAAU,GAAKC,EAAY,GAC/Bd,EAAIa,EAAU,GAAKC,EAAY,GAE/BC,EAAMxD,KAAKkD,MAAMtE,EAAGC,EAAG4D,GACvBgB,EAAQzD,KAAKwC,KAAK3D,EAAI2E,GACtBE,EAAM1D,KAAK2D,MAAMlB,EAAG7D,GAKhC,OAJM0E,EAAU,GAAKE,EACfF,EAAU,GAAKG,EACfH,EAAU,GAAKI,EAEdnI,IACL,CAEA,WAAAqI,CAAYP,GACR,MAAMC,EAAY/H,KAAKkD,MACjB8E,EAAcF,EAAO5E,MAErB+E,EAAMF,EAAU,GAChBG,EAAQH,EAAU,GAClBI,EAAMJ,EAAU,GAEhB1E,EAAI4E,EAAMxD,KAAK6D,IAAIJ,GAASzD,KAAK8D,IAAIJ,GAAOH,EAAY,GACxD1E,EAAI2E,EAAMxD,KAAK8D,IAAIL,GAASF,EAAY,GACxCd,EAAIe,EAAMxD,KAAK6D,IAAIJ,GAASzD,KAAK6D,IAAIH,GAAOH,EAAY,GAKpE,OAJMD,EAAU,GAAK1E,EACf0E,EAAU,GAAKzE,EACfyE,EAAU,GAAKb,EAEdlH,IACL,CAEH,WAAO2F,CAAK6C,EAAc/E,GACzB,MAAMqC,EAAI0C,EAAItF,MACRQ,EAAID,EAAIP,MAEd,OAAO,IAAIuD,EAAY,CACtBX,EAAE,GAAKpC,EAAE,GAAKoC,EAAE,GAAKpC,EAAE,GAAKoC,EAAE,GAAKpC,EAAE,GACrCoC,EAAE,GAAKpC,EAAE,GAAKoC,EAAE,GAAKpC,EAAE,GAAKoC,EAAE,GAAKpC,EAAE,GACrCoC,EAAE,GAAKpC,EAAE,GAAKoC,EAAE,GAAKpC,EAAE,GAAKoC,EAAE,GAAKpC,EAAE,IAEvC,CAEA,cAAAsC,CAAeC,EAAgCC,EAAiB,GAC/D,MAAMxC,EAAI1D,KAAKkD,MAEf+C,EAAIC,GAAcxC,EAAE,GACpBuC,EAAIC,EAAS,GAAKxC,EAAE,GACpBuC,EAAIC,EAAS,GAAKxC,EAAE,EAClB,CAEA,aAAAyC,CAAcC,EAAwBF,EAAiB,GAKzD,OAJAlG,KAAKkD,MAAM,GAAKkD,EAAIF,GACpBlG,KAAKkD,MAAM,GAAKkD,EAAIF,EAAS,GAC7BlG,KAAKkD,MAAM,GAAKkD,EAAIF,EAAS,GAEtBlG,IACL,CAEH,SAAA+F,CAAUoB,EAAiBlD,GAK1B,OAJAjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAAKe,EAClDjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAAKe,EAClDjE,KAAKkD,MAAM,GAAKlD,KAAKkD,MAAM,GAAKiE,EAAOjE,MAAM,GAAKe,EAE3CjE,IACR,CAEA,UAAAqG,CAAWC,EAAeC,GACzB,MAAM3B,EAAI0B,EAAKpD,MACT2B,EAAI0B,EAAKrD,MAMf,OAJAlD,KAAKkD,MAAM,GAAK0B,EAAE,GAAKC,EAAE,GACzB7E,KAAKkD,MAAM,GAAK0B,EAAE,GAAKC,EAAE,GACzB7E,KAAKkD,MAAM,GAAK0B,EAAE,GAAKC,EAAE,GAElB7E,IACR,CAEA,YAAAyI,CAAanC,EAAeC,GAC3B,MAAM3B,EAAI0B,EAAKpD,MACT2B,EAAI0B,EAAKrD,MAEToE,EAAK1C,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,GAC5B0C,EAAK3C,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,GAC5B2C,EAAK5C,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,GAMlC,OAJA7E,KAAKkD,MAAM,GAAKoE,EAChBtH,KAAKkD,MAAM,GAAKqE,EAChBvH,KAAKkD,MAAM,GAAKsE,EAETxH,IACR,CAEA,CAACU,OAAOgI,YACP,MAAM,MAACxF,GAASlD,MACV,OAACqB,GAAU6B,EACjB,IAAIyF,EAAI,EACR,MAAO,CACNC,KAAI,IACCD,EAAItH,EACA,CACNT,MAAOsC,EAAMyF,KAAME,MAAM,GAGpB,CACNjI,WAAOkI,EAAWD,MAAM,GAI5B,EAGD,ICjcKE,EDicD/B,EAA8BP,EAEoB,IAAIhF,EAAS,CAClEK,YAAa2E,EACbvE,kBACEsE,IACAQ,EAAUR,CAAI,IE7cV,MAAMwC,EAET,cAAwB,CAExBC,cAAuC,IAAIjC,EAAQ,CAAE,EAAI,EAAI,IAC7DiC,aAAuC,IAAIjC,EAAQ,CAAE,EAAI,EAAI,IAC7DiC,YAAuC,IAAIjC,EAAQ,EAAE,EAAI,EAAI,IAC7DiC,UAAuC,IAAIjC,EAAQ,CAAE,EAAI,EAAI,IAC7DiC,YAAuC,IAAIjC,EAAQ,CAAE,GAAI,EAAI,IAC7DiC,eAAuC,IAAIjC,EAAQ,CAAE,EAAI,EAAI,IAC7DiC,gBAAuC,IAAIjC,EAAQ,CAAE,EAAI,GAAI,KDJjE,SAAK+B,GACD,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,gBACA,wBACA,yBACA,yBACA,2BACA,qBACA,eACH,CAjCD,CAAKA,IAAAA,EAAG,KAmCR,MAAMG,EAAaxJ,OAAOyJ,KAAKJ,GAAK1H,OAEpC,IAAK+H,EAeAC,GAfL,SAAKD,GACD,YACA,oBACA,eACH,CAJD,CAAKA,IAAAA,EAAW,KAehB,SAAKC,GACD,mBACA,qBACA,qBACA,yBACA,kBACH,CAND,CAAKA,IAAAA,EAAW,KAQhB,MAAMC,EAAsB5J,OAAOyJ,KAAKE,GAAahI,OAE/CkI,EAAwB7J,OAAO8J,OACjC9J,OAAO0D,OAAOiG,GAAaI,QACvB,CAACC,EAAKC,EAAQC,IAAUlK,OAAOmK,OAAOH,EAAK,CAAC,CAACC,GAASC,KAAS,CAAC,IAIlEE,EAAepK,OAAO8J,OACxB9J,OAAO0D,OAAO2F,GAAKU,QACf,CAACC,EAAKlK,EAAKoK,IAAUlK,OAAOmK,OAAOH,EAAK,CAAC,CAAClK,GAAMoK,KAAS,CAAC,IA6NlE,IAAIG,EAAe,IAtInB,MACqBC,SAAW,IAAItH,MAAe,EAAIwG,GAAYe,MAAK,GACnDC,WAAa,IAAIxH,MAAe,EAAI4G,GAAqBW,MAAK,GAC9DE,gBAAkB,IAAItE,EAC/BuE,WAAa,EACbC,OAAmC,KACnCC,gBAAkC,KAE1C,UAAAC,CAAWF,GACPrK,KAAKqK,OAASA,EACdrK,KAAKsK,gBAAkBD,EAAOG,wBAC9BH,EAAOI,iBAAiB,cAAezK,MACvCqK,EAAOI,iBAAiB,YAAazK,MACrCqK,EAAOI,iBAAiB,cAAezK,MACvCqK,EAAOI,iBAAiB,cAAezK,MACvCqK,EAAOI,iBAAiB,QAASzK,MACjCqK,EAAOI,iBAAiB,UAAWzK,MACnCqK,EAAOI,iBAAiB,QAASzK,MACjCqK,EAAOI,iBAAiB,WAAYzK,KACxC,CAEA,aAAA0K,GACI,MAAMC,EAAO3K,KAAKsK,gBAClB,GAAa,OAATK,EACA,MAAM,IAAIrJ,MAAM,kCAEpB,OAAOqJ,CACX,CAEA,KAAAC,GACI5K,KAAKgK,SAASC,MAAK,EAAO,EA/GP,EA+G+Bf,GAClDlJ,KAAKkK,WAAWD,MAAK,EAAO,EAhHT,EAgHiCX,GACpDtJ,KAAKoK,WAAa,CACtB,CAEA,WAAAS,CAAYC,GACR,IAAIC,GAAc,EAClB,OAAQD,EAAME,MACV,IAAK,cACDD,EAAaxB,EAAuBuB,EAAqBnB,QACzD3J,KAAKkK,WA1HI,EA0H0BZ,EAAsByB,IAAc,EACvE/K,KAAKkK,WA1HM,EA0H0BZ,EAAsByB,IAAc,EACzE,MACJ,IAAK,YACDA,EAAaxB,EAAuBuB,EAAqBnB,QACzD3J,KAAKkK,WAhIE,EAgI0BZ,EAAsByB,IAAc,EACrE/K,KAAKkK,WA/HM,EA+H0BZ,EAAsByB,IAAc,EACzE,MACJ,IAAK,cACD,MAAME,EAAajL,KAAK0K,gBACxB1K,KAAKmK,gBAAgB5G,UACfuH,EAAqBI,QAAUD,EAAWE,KAC1CL,EAAqBM,QAAUH,EAAWI,KAEhD,MACJ,IAAK,QACDrL,KAAKoK,WAAcU,EAAqBQ,OAAS,IACjD,MACJ,IAAK,UACDP,EAAajB,EAAcgB,EAAwBtL,KACnDQ,KAAKgK,SA9II,EA8IwBd,EAAa6B,IAAc,EAC5D/K,KAAKgK,SA9IM,EA8IwBd,EAAa6B,IAAc,EAC9D,MACJ,IAAK,QACDA,EAAajB,EAAcgB,EAAwBtL,KACnDQ,KAAKgK,SApJE,EAoJwBd,EAAa6B,IAAc,EAC1D/K,KAAKgK,SAnJM,EAmJwBd,EAAa6B,IAAc,EAC9D,MACJ,IAAK,WACD/K,KAAKgK,SAASC,MAAK,GACnBjK,KAAKkK,WAAWD,MAAK,GACrBjK,KAAKoK,WAAa,EAClBpK,KAAKmK,gBAAgBrG,WAGjC,CAkBA,MAAAyH,CAAO/L,GACH,OAAOQ,KAAKgK,SA/KO,EA+KuBd,EAAaY,EAAatK,GACxE,CAEA,QAAAgM,CAAShM,GACL,OAAOQ,KAAKgK,SArLG,EAqLuBd,EAAaY,EAAatK,GACpE,CAEA,UAAAiM,CAAWjM,GACP,OAAOQ,KAAKgK,SAxLK,EAwLuBd,EAAaY,EAAatK,GACtE,CAEA,cAAAkM,CAAe/B,GACX,OAAO3J,KAAKkK,WA3LO,EA2LyBZ,EAAsBC,EAAsBI,GAC5F,CAEA,kBAAAgC,GACI,OAAO3L,KAAKmK,gBAAgBvG,OAChC,CAEA,wBAAAgI,GACI,MAAMC,EAAe7L,KAAKmK,gBAAgBjH,MACpC+H,EAAajL,KAAK0K,gBAClBrH,EAAKwI,EAAa,GAAKZ,EAAWa,MAAS,EAAI,EAC/CxI,EAAKuI,EAAa,GAAKZ,EAAWc,OAAU,EAAI,EACtD,OAAO,IAAIlG,EAAQ,CAACxC,EAAGC,GAC3B,CAEA,aAAA0I,GACI,OAAOhM,KAAKoK,UAChB,CAEA,kBAAA6B,CAAmBtC,GACf,OAAO3J,KAAKkK,WAhNK,EAgNyBZ,EAAsBC,EAAsBI,GAC1F,CAEA,gBAAAuC,CAAiBvC,GACb,OAAO3J,KAAKkK,WArNG,EAqNyBZ,EAAsBC,EAAsBI,GACxF,GEhSJ,MAAMwC,EAAc,IAAInF,EAClBoF,EAAc,IAAIpF,EAClBqF,EAAc,IAAIrF,EAyFxB,IC/FKsF,ED+FDC,EA3EJ,MACIC,OACAC,cACAC,iBAEA,GAEA,WAAA1K,CAAYwK,EAAgBG,GACxB3M,KAAKwM,OAASA,EACdxM,KAAKyM,cAAgBE,GAAQF,eAAiB,GAC9CzM,KAAK0M,iBAAmBC,GAAQD,kBAAoB,EACpD1M,MAAK,EAAuB,IAAI6F,CACpC,CAEA,MAAA+G,CAAOC,GACH,MAAM,OAACL,EAAM,cAAEC,EAAa,iBAAEC,GAAoB1M,KAC5C8M,EAAsB9M,MAAK,GAC1B+M,UAAWC,GAAmBR,EAC/BS,EAAiBD,EAAgBE,eAAef,GAChDgB,EAAgBH,EAAgBI,YAAYhB,IAC3ClJ,MAAOmK,GAAsBF,GAC9B,OAACG,EAAM,GAAEC,EAAE,KAAEC,GAAQxE,EAC3B,IAAIyE,EAAeT,EAAgBU,MAAMrB,GAAavH,IAAIyI,GAE1D,GAAIxD,EAAMwB,OAAOxC,EAAI4E,IAAM5D,EAAMwB,OAAOxC,EAAI6E,UAAW,CACnD,MAAMC,EAAUb,EAAgBI,YAAYf,GAAahF,MAAMqF,EAAmBG,GAClFG,EAAgBc,UAAUD,E,CAE9B,GAAI9D,EAAMwB,OAAOxC,EAAIgF,IAAMhE,EAAMwB,OAAOxC,EAAIiF,YAAa,CACrD,MAAM7C,EAAO6B,EAAgBiB,QAAQ5B,GAAahF,MAAMqF,EAAmBG,GAC3EG,EAAgBc,UAAU3C,E,CAE9B,GAAIpB,EAAMwB,OAAOxC,EAAImF,IAAMnE,EAAMwB,OAAOxC,EAAIoF,YAAa,CACrD,MAAMC,EAAWpB,EAAgBqB,WAAWhC,GAAahF,MAAMqF,EAAmBG,GAClFG,EAAgBc,UAAUM,E,CAE9B,GAAIrE,EAAMwB,OAAOxC,EAAIuF,IAAMvE,EAAMwB,OAAOxC,EAAIwF,aAAc,CACtD,MAAMC,EAAQxB,EAAgByB,SAASpC,GAAahF,MAAMqF,EAAmBG,GAC7EG,EAAgBc,UAAUU,E,CAO9B,GAJIzE,EAAMkC,mBAAmB5C,EAAYqF,QACrC5B,EAAoBnJ,KAAKoG,EAAM6B,4BAG/B7B,EAAM2B,eAAerC,EAAYqF,OAAQ,CACzC,MAAMC,EAAqB5E,EAAM6B,2BACjC,IAAK+C,EAAmBnL,OAAOsJ,GAAsB,CACjD,MAAM5H,GAAM4H,EAAoBzJ,EAAIsL,EAAmBtL,GAAKoJ,EAAgBI,EACtE1H,GAAM2H,EAAoBxJ,EAAIqL,EAAmBrL,GAAKmJ,EAAgBI,EAE5E,GADAI,EAAetJ,KAAKqJ,EAAgBE,eAAeb,IACxC,IAAPnH,GAAmB,IAAPC,EAAU,CACtBsI,EAAehJ,KAAKmK,KAAK5B,EAAgBU,MAAMrB,GAAavH,IAAIyI,IAChEJ,EAActF,YAAYyF,GAC1B,MAAMpF,EAAQmF,EAAmB,GAC3BlF,EAAMkF,EAAmB,GACzBwB,EAAW3G,EAAQuF,GAAgBtI,EACrC0J,GAAY,GAAKA,GAAYpK,KAAKqK,IAClCzB,EAAmB,IAAMlF,EAAMjD,EAAKT,KAAKqK,KAAO,EAAIrK,KAAKqK,IACzDzB,EAAmB,GAAKwB,EAAW,GAAKA,EAAWpK,KAAKqK,IAAMD,EAAWpK,KAAKqK,IAC9ErB,IAAiB,IAGjBJ,EAAmB,IAAMlF,EAAMjD,IAAO,EAAIT,KAAKqK,IAC/CzB,EAAmB,GAAKnF,EAAQuF,GAAgBtI,GAEpDgI,EAAc9E,YAAYiF,GAC1BN,EAAgB+B,OAAO9B,EAAelJ,IAAIoJ,GAAiBM,EAAe,EAAKF,EAAKC,E,CAExFV,EAAoBnJ,KAAKgL,E,EAGrC,IC5FJ,SAAKrC,GACD,uCACA,yCACA,0CACH,CAJD,CAAKA,IAAAA,EAAoB,KAqBzB,MAAM0C,EACOxI,KACTyI,iBACAC,gBAEA,WAAAlN,CAAYA,EAA6BmN,GACrCnP,KAAKwG,KAAOxE,EACZhC,KAAKiP,iBAAmBE,GAAU7C,EAAqB8C,gBACvDpP,KAAKkP,gBAAkB,CAC3B,CAEA,UAAAG,GACI,OAAQrP,KAAKiP,kBACT,KAAK3C,EAAqB8C,gBACtBpP,KAAKsP,OAAO,GACZ,MACJ,KAAKhD,EAAqBiD,iBACtBvP,KAAKsP,OAAO7K,KAAK+K,IAAI,EAAGxP,KAAKkP,kBAGrClP,KAAKkP,iBACT,CAEA,OAAAO,CAAQC,GACJ,MAAM,IAAIpO,MAAM,kBACpB,CAEA,OAAAqO,IAAW1N,GACP,MAAM,IAAIX,MAAM,kBACpB,CAEA,MAAAgO,CAAOI,GACH,MAAM,IAAIpO,MAAM,kBACpB,CAEA,KAAAsJ,GACI,MAAM,IAAItJ,MAAM,kBACpB,ECFJ,IAAIsO,EA/CJ,cAAuDZ,EACnDa,QACAxE,IAEA,WAAArJ,CAAYA,EAA6B8N,GACrCC,MAAM/N,EAAa8N,GAASX,QAC5BnP,KAAK6P,QAAU,IAAInN,MAAMoN,GAASE,MAAQ,GAAG/F,KAAK,GAAGP,KAAI,IAC9C,IAAI1J,KAAKwG,KAAKsJ,GAAS7N,QAElCjC,KAAKqL,IAAM,CACf,CAEA,OAAAoE,CAAQC,GACJ,MAAMrE,EAAMrL,KAAKqL,IACX4E,EAAS5E,EAAMqE,EAErB,GAAI1P,KAAKiP,iBACL,KAAOjP,KAAK6P,QAAQxO,OAAS4O,GACzBjQ,KAAKqP,aAKb,OAFArP,KAAKqL,IAAM4E,EAEJjQ,KAAK6P,QAAQK,MAAM7E,EAAK4E,EACnC,CAEA,OAAAN,CAAQD,GACJ,MAAMrE,EAAMrL,KAAKqL,IACbqE,EAAQrE,GACR8E,QAAQC,KAAK,yBAEjBpQ,KAAKqL,IAAM5G,KAAKF,IAAI8G,EAAMqE,EAAO,EACrC,CAEA,MAAAJ,CAAOI,GACH1P,KAAK6P,QAAQQ,QAAQ3N,MAAMgN,GAAOzF,KAAK,GAAGP,KAAI,IACnC,IAAI1J,KAAKwG,OAExB,CAEA,KAAAoE,GACI5K,KAAK6P,QAAU,GACf7P,KAAKqL,IAAM,EACXrL,KAAKkP,gBAAkB,CAC3B,GCtCYzK,KAAKqK,GACCrK,KAAKqK,GAD3B,MAWMwB,EAAS,IAAIC,YAAYpN,aAAaqN,mBACtCC,EAAa,IAAItN,aAAamN,GAC9BI,EAAW,IAAIC,YAAYL,GC6CjC,MAAMM,EACK1N,MASV,WAAAlB,IACMC,GAEL,GAAuB,iBAAZA,EAAK,GACfjC,KAAKkD,MAAQ,IAAIC,aAAa,CACzBlB,EAAK,GAAIA,EAAK,GAAIA,EAAK,GACvBA,EAAK,GAAIA,EAAK,GAAIA,EAAK,GACvBA,EAAK,GAAIA,EAAK,GAAIA,EAAK,UAGxB,GAAuB,iBAAZA,EAAK,GAAiB,CAClC,MAAMiB,EAAQjB,EAAK,GACnBjC,KAAK6Q,WAAW3N,GACZA,aAAiBC,aACnBnD,KAAKkD,MAAQA,EAGblD,KAAKkD,MAAQ,IAAIC,aAAaD,E,MAInClD,KAAKkD,MAAQ,IAAIC,aAAa,CACzB,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAGZ,CAEA,QAAI2N,GACJ,MAAO,CACH9Q,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GAEhB,CAEA,QAAI4N,CAAKC,GACN/Q,KAAKkD,MAAM,GAAK6N,EAAI,GACpB/Q,KAAKkD,MAAM,GAAK6N,EAAI,GACpB/Q,KAAKkD,MAAM,GAAK6N,EAAI,EACtB,CAEA,QAAIC,GACJ,MAAO,CACHhR,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GAEhB,CAEA,QAAI8N,CAAKD,GACN/Q,KAAKkD,MAAM,GAAK6N,EAAI,GACpB/Q,KAAKkD,MAAM,GAAK6N,EAAI,GACpB/Q,KAAKkD,MAAM,GAAK6N,EAAI,EACtB,CAEA,QAAIE,GACJ,MAAO,CACHjR,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GAEhB,CAEA,QAAI+N,CAAKF,GACN/Q,KAAKkD,MAAM,GAAK6N,EAAI,GACpB/Q,KAAKkD,MAAM,GAAK6N,EAAI,GACpB/Q,KAAKkD,MAAM,GAAK6N,EAAI,EACtB,CAEA,QAAIG,GACJ,MAAO,CACHlR,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GAEhB,CAEA,QAAIgO,CAAKC,GACNnR,KAAKkD,MAAM,GAAKiO,EAAI,GACpBnR,KAAKkD,MAAM,GAAKiO,EAAI,GACpBnR,KAAKkD,MAAM,GAAKiO,EAAI,EACtB,CAEA,QAAIC,GACJ,MAAO,CACHpR,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GAEhB,CAEA,QAAIkO,CAAKD,GACNnR,KAAKkD,MAAM,GAAKiO,EAAI,GACpBnR,KAAKkD,MAAM,GAAKiO,EAAI,GACpBnR,KAAKkD,MAAM,GAAKiO,EAAI,EACtB,CAEA,QAAIE,GACJ,MAAO,CACHrR,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GACXlD,KAAKkD,MAAM,GAEhB,CAEA,QAAImO,CAAKF,GACNnR,KAAKkD,MAAM,GAAKiO,EAAI,GACpBnR,KAAKkD,MAAM,GAAKiO,EAAI,GACpBnR,KAAKkD,MAAM,GAAKiO,EAAI,EACtB,CAEA,OAAIG,GACJ,OAAOtR,KAAKkD,MAAM,EACnB,CAEA,OAAIoO,CAAIC,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIC,GACJ,OAAOxR,KAAKkD,MAAM,EACnB,CAEA,OAAIsO,CAAID,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIE,GACJ,OAAOzR,KAAKkD,MAAM,EACnB,CAEA,OAAIuO,CAAIF,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIG,GACJ,OAAO1R,KAAKkD,MAAM,EACnB,CAEA,OAAIwO,CAAIH,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAII,GACJ,OAAO3R,KAAKkD,MAAM,EACnB,CAEA,OAAIyO,CAAIJ,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIK,GACJ,OAAO5R,KAAKkD,MAAM,EACnB,CAEA,OAAI0O,CAAIL,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIM,GACJ,OAAO7R,KAAKkD,MAAM,EACnB,CAEC,OAAI2O,CAAIN,GACRvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIO,GACJ,OAAO9R,KAAKkD,MAAM,EACnB,CAEA,OAAI4O,CAAIP,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIQ,GACJ,OAAO/R,KAAKkD,MAAM,EACnB,CAEC,OAAI6O,CAAIR,GACRvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEQ,UAAAV,CAAW3N,GACnB,GAAIA,EAAM7B,OAAS,EAClB,MAAM,IAAI0B,EAAU,sCAEtB,CAEC,SAAAiP,GACA,MAAO,CACHhS,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GACzClD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GACzClD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GAE9C,CAEA,SAAAK,CACG+N,EAAaI,EAAaG,EAC1BL,EAAaG,EAAaG,EAC1BL,EAAaG,EAAaG,GAY1B,OAVA/R,KAAKkD,MAAM,GAAKoO,EAChBtR,KAAKkD,MAAM,GAAKwO,EAChB1R,KAAKkD,MAAM,GAAK2O,EAChB7R,KAAKkD,MAAM,GAAKsO,EAChBxR,KAAKkD,MAAM,GAAKyO,EAChB3R,KAAKkD,MAAM,GAAK4O,EAChB9R,KAAKkD,MAAM,GAAKuO,EAChBzR,KAAKkD,MAAM,GAAK0O,EAChB5R,KAAKkD,MAAM,GAAK6O,EAET/R,IACT,CAED,MAAAwD,CAAOyO,GACJ,MAAMxS,EAAIwS,EAAM/O,MAChB,OAAOlD,KAAKkD,MAAM,KAAOzD,EAAE,IACtBO,KAAKkD,MAAM,KAAOzD,EAAE,IACpBO,KAAKkD,MAAM,KAAOzD,EAAE,IACpBO,KAAKkD,MAAM,KAAOzD,EAAE,IACpBO,KAAKkD,MAAM,KAAOzD,EAAE,IACpBO,KAAKkD,MAAM,KAAOzD,EAAE,IACpBO,KAAKkD,MAAM,KAAOzD,EAAE,IACpBO,KAAKkD,MAAM,KAAOzD,EAAE,IACpBO,KAAKkD,MAAM,KAAOzD,EAAE,EAC3B,CAEA,IAAAkE,CAAK6E,GACH,MAAM/I,EAAIO,KAAKkD,MACT4C,EAAI0C,EAAItF,MAYd,OAVAzD,EAAE,GAAKqG,EAAE,GACTrG,EAAE,GAAKqG,EAAE,GACTrG,EAAE,GAAKqG,EAAE,GACTrG,EAAE,GAAKqG,EAAE,GACTrG,EAAE,GAAKqG,EAAE,GACTrG,EAAE,GAAKqG,EAAE,GACTrG,EAAE,GAAKqG,EAAE,GACTrG,EAAE,GAAKqG,EAAE,GACTrG,EAAE,GAAKqG,EAAE,GAEF9F,IACT,CAEA,KAAA4D,GACE,OAAO,IAAIgN,EACT5Q,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GACzClD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GACzClD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GAAIlD,KAAKkD,MAAM,GAE7C,CAEA,WAAAgP,GACE,MAAMzS,EAAIO,KAAKkD,MAYf,OAVAzD,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EAEAO,IACT,CAEA,QAAA8D,GACE,MAAMrE,EAAIO,KAAKkD,MAYf,OAVAzD,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EAEAO,IACT,CAEA,GAAAmS,GACE,MAAM1S,EAAIO,KAAKkD,MAMf,OAJUzD,EAAE,IAAOA,EAAE,GAAKA,EAAE,GAAOA,EAAE,GAAKA,EAAE,IAClCA,EAAE,IAAOA,EAAE,GAAKA,EAAE,GAAOA,EAAE,GAAKA,EAAE,IAClCA,EAAE,IAAOA,EAAE,GAAKA,EAAE,GAAOA,EAAE,GAAKA,EAAE,GAG9C,CAEA,KAAA2S,GACE,MAAM3S,EAAIO,KAAKkD,MAEf,OAAOzD,EAAE,GAAKA,EAAE,GAAKA,EAAE,EACzB,CAEA,MAAAiG,GACE,MAAMjG,EAAIO,KAAKkD,MAYf,OAVAzD,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GAEHO,IACT,CAEA,SAAAqS,GACE,MAAM5S,EAAIO,KAAKkD,MAEf,IAAIkB,EAcJ,OAZAA,EAAI3E,EAAE,GACNA,EAAE,GAAKA,EAAE,GACTA,EAAE,GAAK2E,EAEPA,EAAI3E,EAAE,GACNA,EAAE,GAAKA,EAAE,GACTA,EAAE,GAAK2E,EAEPA,EAAI3E,EAAE,GACNA,EAAE,GAAKA,EAAE,GACTA,EAAE,GAAK2E,EAEApE,IACT,CAEA,MAAAsS,GACE,MAAM7S,EAAIO,KAAKkD,MAETqP,EAAM9S,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GACrD+S,EAAM/S,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GACrDgT,EAAMhT,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAErDiT,EAAMjT,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GACrDkT,EAAMlT,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GACrDmT,EAAMnT,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAErDoT,EAAMpT,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GACrDqT,EAAMrT,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GACrDsT,EAAMtT,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAAaA,EAAE,GAErDuT,EAAI,GAAOvT,EAAE,GAAa8S,EAAM9S,EAAE,GAAa+S,EAAM/S,EAAE,GAAagT,GAE1E,GAAS,GAALO,EACF,MAAM,IAAIjQ,EAAU,6BAetB,OAZAtD,EAAE,GAAKuT,EAAIT,EACX9S,EAAE,IAAMuT,EAAIR,EACZ/S,EAAE,GAAKuT,EAAIP,EAEXhT,EAAE,IAAMuT,EAAIN,EACZjT,EAAE,GAAKuT,EAAIL,EACXlT,EAAE,IAAMuT,EAAIJ,EAEZnT,EAAE,GAAKuT,EAAIH,EACXpT,EAAE,IAAMuT,EAAIF,EACZrT,EAAE,GAAKuT,EAAID,EAEJ/S,IACT,CAEA,GAAA+D,CAAIyE,GACF,MAAM/I,EAAIO,KAAKkD,MACT4C,EAAI0C,EAAItF,MAYd,OAVAzD,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAET9F,IACT,CAEA,GAAAkE,CAAIsE,GACF,MAAM/I,EAAIO,KAAKkD,MACT4C,EAAI0C,EAAItF,MAYd,OAVAzD,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAChBrG,EAAE,GAAKA,EAAE,GAAKqG,EAAE,GAET9F,IACT,CAEA,IAAA2F,CAAK6C,GACH,MAAM/I,EAAIO,KAAKkD,MACT4C,EAAI0C,EAAItF,MAER+P,EAAMxT,EAAE,GACRyT,EAAMzT,EAAE,GACR0T,EAAM1T,EAAE,GACR2T,EAAM3T,EAAE,GACR4T,EAAM5T,EAAE,GACR6T,EAAM7T,EAAE,GACR8T,EAAM9T,EAAE,GACR+T,EAAM/T,EAAE,GACRgU,EAAMhU,EAAE,GACRiU,EAAM5N,EAAE,GACR6N,EAAM7N,EAAE,GACR8N,EAAM9N,EAAE,GACR+N,EAAM/N,EAAE,GACRgO,EAAMhO,EAAE,GACRiO,EAAMjO,EAAE,GACRkO,EAAMlO,EAAE,GACRmO,EAAMnO,EAAE,GACRoO,EAAMpO,EAAE,GAYd,OAVArG,EAAE,GAAKiU,EAAMT,EAAMU,EAAMP,EAAMQ,EAAML,EACrC9T,EAAE,GAAKiU,EAAMR,EAAMS,EAAMN,EAAMO,EAAMJ,EACrC/T,EAAE,GAAKiU,EAAMP,EAAMQ,EAAML,EAAMM,EAAMH,EACrChU,EAAE,GAAKoU,EAAMZ,EAAMa,EAAMV,EAAMW,EAAMR,EACrC9T,EAAE,GAAKoU,EAAMX,EAAMY,EAAMT,EAAMU,EAAMP,EACrC/T,EAAE,GAAKoU,EAAMV,EAAMW,EAAMR,EAAMS,EAAMN,EACrChU,EAAE,GAAKuU,EAAMf,EAAMgB,EAAMb,EAAMc,EAAMX,EACrC9T,EAAE,GAAKuU,EAAMd,EAAMe,EAAMZ,EAAMa,EAAMV,EACrC/T,EAAE,GAAKuU,EAAMb,EAAMc,EAAMX,EAAMY,EAAMT,EAE9BzT,IACT,CAEA,UAAA0E,CAAWT,GACT,MAAMxE,EAAIO,KAAKkD,MAYf,OAVAzD,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EACdxE,EAAE,GAAKA,EAAE,GAAKwE,EAEPjE,IACT,CAEA,cAAAgG,CAAeC,EAAgCC,EAAiB,GAChE,MAAMJ,EAAI9F,KAAKkD,MAEf+C,EAAIC,GAAeJ,EAAG,GACtBG,EAAIC,EAAU,GAAKJ,EAAG,GACpBG,EAAIC,EAAU,GAAKJ,EAAG,GACtBG,EAAIC,EAAU,GAAKJ,EAAG,GACxBG,EAAIC,EAAU,GAAKJ,EAAG,GACpBG,EAAIC,EAAU,GAAKJ,EAAG,GACtBG,EAAIC,EAAU,GAAKJ,EAAG,GACxBG,EAAIC,EAAU,GAAKJ,EAAG,GACpBG,EAAIC,EAAU,GAAKJ,EAAG,EACxB,CAEA,aAAAK,CAAcC,EAAwBF,EAAiB,GACvD,MAAMzG,EAAIO,KAAKkD,MAEfzD,EAAG,GAAK2G,EAAIF,GACZzG,EAAG,GAAK2G,EAAIF,EAAU,GACpBzG,EAAG,GAAK2G,EAAIF,EAAU,GACtBzG,EAAG,GAAK2G,EAAIF,EAAU,GACtBzG,EAAG,GAAK2G,EAAIF,EAAU,GACtBzG,EAAG,GAAK2G,EAAIF,EAAU,GACtBzG,EAAG,GAAK2G,EAAIF,EAAU,GACxBzG,EAAG,GAAK2G,EAAIF,EAAU,GACpBzG,EAAG,GAAK2G,EAAIF,EAAU,EACxB,CAEA,gBAAOiO,CAAUvN,GACf,OAAO,IAAIgK,GAAcwD,aAAaxN,EACxC,CAEA,YAAAwN,CAAaxN,GACX,MAAMyN,EAAW5P,KAAK8D,IAAI3B,GACpB0N,EAAW7P,KAAK6D,IAAI1B,GAY1B,OAVA5G,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAKmR,EAChBrU,KAAKkD,MAAM,GAAKoR,EAChBtU,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,IAAMoR,EACjBtU,KAAKkD,MAAM,GAAKmR,EAETrU,IACT,CAEA,gBAAOuU,CAAU3N,GACf,OAAO,IAAIgK,GAAc4D,aAAa5N,EACxC,CAEA,YAAA4N,CAAa5N,GACX,MAAMyN,EAAW5P,KAAK8D,IAAI3B,GACpB0N,EAAW7P,KAAK6D,IAAI1B,GAY1B,OAVA5G,KAAKkD,MAAM,GAAKmR,EAChBrU,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,IAAMoR,EACjBtU,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAKoR,EAChBtU,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAKmR,EAETrU,IACT,CAEA,gBAAOyU,CAAU7N,GACf,OAAO,IAAIgK,GAAc8D,aAAa9N,EACxC,CAEA,YAAA8N,CAAa9N,GACX,MAAMyN,EAAW5P,KAAK8D,IAAI3B,GACpB0N,EAAW7P,KAAK6D,IAAI1B,GAY1B,OAVA5G,KAAKkD,MAAM,GAAKmR,EAChBrU,KAAKkD,MAAM,GAAKoR,EAChBtU,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,IAAMoR,EACjBtU,KAAKkD,MAAM,GAAKmR,EAChBrU,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAChBlD,KAAKkD,MAAM,GAAK,EAETlD,IACT,CAEA,KAAA2U,CAAM9P,GACJ,MAAMD,EAAK5E,KAAKkD,MAEV0R,EAAMhQ,EAAE,GACRiQ,EAAMjQ,EAAE,GACRkQ,EAAMlQ,EAAE,GACRmQ,EAAMnQ,EAAE,GACRoQ,EAAMpQ,EAAE,GACRqQ,EAAMrQ,EAAE,GACRsQ,EAAMtQ,EAAE,GACRuQ,EAAMvQ,EAAE,GACRwQ,EAAMxQ,EAAE,GACd,IAAIyQ,EAAIC,EAAIC,EACRpD,EAGJkD,EAAKL,EAAMI,EAAMH,EAAME,EACvBG,EAAKL,EAAMC,EAAMH,EAAMK,EACvBG,EAAKR,EAAMI,EAAMH,EAAME,EAGvB/C,EAAMyC,EAAMS,EAAKR,EAAMS,EAAKR,EAAMS,EACvB,GAAPpD,IACFA,EAAM,EAAMA,GAId,MAAMqD,EAAKrD,GAAOtN,EAAExB,EAAIgS,EAAKxQ,EAAEvB,EAAIgS,EAAKzQ,EAAEqC,EAAIqO,GAG9CF,IAAOF,EAAMtQ,EAAEqC,EAAIkO,EAAMvQ,EAAEvB,GAC3BgS,IAAOF,EAAMvQ,EAAExB,EAAI6R,EAAMrQ,EAAEqC,GAC3BqO,IAAOL,EAAMrQ,EAAEvB,EAAI6R,EAAMtQ,EAAExB,GAE3B,MAAMoS,EAAKtD,GAAOyC,EAAMS,EAAKR,EAAMS,EAAKR,EAAMS,GAQ9C,OALAF,IAAOxQ,EAAEvB,EAAI2R,EAAMpQ,EAAEqC,EAAI8N,GACzBM,IAAOzQ,EAAEqC,EAAI6N,EAAMlQ,EAAExB,EAAI4R,GACzBM,IAAO1Q,EAAExB,EAAI2R,EAAMnQ,EAAEvB,EAAIyR,GAGlB,CAACS,EAAIC,EADDtD,GAAOyC,EAAMS,EAAKR,EAAMS,EAAKR,EAAMS,GA2ChD,CAEA,MAAAG,CAAOnP,GACL,MAAM3B,EAAI5E,KAAKkD,MAET+P,EAAMrO,EAAE,GACRsO,EAAMtO,EAAE,GACRwO,EAAMxO,EAAE,GACRyO,EAAMzO,EAAE,GACR+Q,EAAKpP,EAAKlD,EAAIuB,EAAE,GAChBgR,EAAKrP,EAAKjD,EAAIsB,EAAE,GAEtB,IAAIuN,EAAMc,EAAMI,EAAMH,EAAME,EAS5B,OAPW,GAAPjB,IACFA,EAAM,EAAMA,GAMP,CAHGA,GAAOkB,EAAMsC,EAAKzC,EAAM0C,GACxBzD,GAAOc,EAAM2C,EAAKxC,EAAMuC,GAKpC,EAGF,IAAIE,EAA8BjF,EACoB,IAAInP,EAAS,CAClEK,YAAa8O,EACb1O,kBACEsE,IACAqP,EAAUrP,CAAI,IC9pBjB,MAAMsP,EACGC,OAER,SAAI7S,GACH,OAAOlD,KAAK+V,MACb,CAKA,WAAA/T,IAAeC,GACS,iBAAZA,EAAK,GACfjC,KAAK+V,OAAS,CACb9T,EAAK,GAAIA,EAAK,GAAIA,EAAK,GAAIA,EAAK,IAGN,iBAAZA,EAAK,IACpBjC,KAAKgW,YAAY/T,EAAK,IACtBjC,KAAK+V,OAAS9T,EAAK,IAGnBjC,KAAK+V,OAAS,CAAC,EAAG,EAAG,EAAG,EAE1B,CAEA,KAAI1S,GACG,OAAOrD,KAAK+V,OAAO,EACvB,CAEA,KAAI1S,CAAEA,GACRrD,KAAK+V,OAAO,GAAK1S,CACf,CAEA,KAAIC,GACA,OAAOtD,KAAK+V,OAAO,EACvB,CAEA,KAAIzS,CAAEA,GACRtD,KAAK+V,OAAO,GAAKzS,CACf,CAEA,KAAI4D,CAAEA,GACRlH,KAAK+V,OAAO,GAAK7O,CAClB,CAEG,KAAIA,GACN,OAAOlH,KAAK+V,OAAO,EACjB,CAEA,KAAIE,CAAEA,GACRjW,KAAK+V,OAAO,GAAKE,CAClB,CAEG,KAAIA,GACN,OAAOjW,KAAK+V,OAAO,EACpB,CAEA,SAAIG,GACH,MAAMhT,EAAQlD,KAAKkD,MACbG,EAAIH,EAAM,GACVI,EAAIJ,EAAM,GACVgE,EAAIhE,EAAM,GAEViT,EAAW,GADPjT,EAAM,GACUI,EAAI4D,EAAI7D,GAClC,OAAIoB,KAAK2R,IAAID,IAAa,EACT1R,KAAKmK,KAAKuH,IAAa1R,KAAKqK,GAAK,GAGjCrK,KAAK4R,KAAKF,EAE5B,CAEA,OAAIG,GACH,MAAMpT,EAAQlD,KAAKkD,MACbG,EAAIH,EAAM,GACVI,EAAIJ,EAAM,GACVgE,EAAIhE,EAAM,GAEVqT,EAAiB,GADbrT,EAAM,GACgBgE,EAAI7D,EAAIC,GAClCkT,EAAiB,EAAI,GAAKlT,EAAIA,EAAI4D,EAAIA,GAC5C,OAAOzC,KAAK2D,MAAMmO,EAAgBC,EACnC,CAEA,QAAIC,GACH,MAAMvT,EAAQlD,KAAKkD,MACbG,EAAIH,EAAM,GACVI,EAAIJ,EAAM,GACVgE,EAAIhE,EAAM,GAEVwT,EAAkB,GADdxT,EAAM,GACiBG,EAAIC,EAAI4D,GACnCyP,EAAkB,EAAI,GAAKtT,EAAIA,EAAIC,EAAIA,GAC7C,OAAOmB,KAAK2D,MAAMsO,EAAiBC,EACpC,CAEA,SAAA3E,GACC,MAAO,CACNhS,KAAK+V,OAAO,GACZ/V,KAAK+V,OAAO,GACZ/V,KAAK+V,OAAO,GACZ/V,KAAK+V,OAAO,GAEd,CAEA,SAAAxS,CAAUF,EAAWC,EAAW4D,EAAW+O,GAM1C,OALAjW,KAAK+V,OAAO,GAAK1S,EACjBrD,KAAK+V,OAAO,GAAKzS,EACjBtD,KAAK+V,OAAO,GAAK7O,EACjBlH,KAAK+V,OAAO,GAAKE,EAEVjW,IACR,CAEQ,WAAAgW,CAAY9S,GACnB,GAAIA,EAAM7B,OAAS,EAClB,MAAM,IAAI0B,EAAU,sCAEtB,CAQA,gBAAO6T,CAAU1T,GAChB,OAAO,IAAI4S,EAAe5S,EAC3B,CAEA,oBAAO2T,CAAcC,EAAelQ,GACnC,OAAO,IAAIkP,GAAiBiB,aAAaD,EAAMlQ,EAChD,CAEA,iBAAOoQ,CAAW7P,GACjB,OAAO,IAAI2O,EAAe3O,EAAO9D,EAAG8D,EAAO7D,EAAG6D,EAAOD,EAAG,EACzD,CAEA,gBAAO+P,CAAUX,EAAaJ,EAAeO,GAC5C,OAAO,IAAIX,GAAiBoB,SAASZ,EAAKJ,EAAOO,EAClD,CAEA,IAAA9S,CAAKwT,GACJ,MAAM1X,EAAIO,KAAK+V,OACTqB,EAAID,EAAKjU,MAOf,OALAzD,EAAE,GAAK2X,EAAE,GACT3X,EAAE,GAAK2X,EAAE,GACT3X,EAAE,GAAK2X,EAAE,GACT3X,EAAE,GAAK2X,EAAE,GAEFpX,IACR,CAEA,KAAA4D,GACC,OAAO,IAAIkS,EAAe9V,KAAKqD,EAAGrD,KAAKsD,EAAGtD,KAAKkH,EAAGlH,KAAKiW,EACxD,CAEA,MAAAzS,CAAO2T,GACN,MAAMpP,EAAY/H,KAAKkD,MACjBmU,EAAYF,EAAKjU,MAEvB,OAAQ6E,EAAU,KAAOsP,EAAU,IAC9BtP,EAAU,KAAOsP,EAAU,IAC3BtP,EAAU,KAAOsP,EAAU,IAC3BtP,EAAU,KAAOsP,EAAU,EACjC,CAEA,OAAAC,CAAQrR,GACP,MAAM8B,EAAY/H,KAAKkD,MACjBqU,EAAWtR,EAAI/C,MAEfsU,EAAM,EAAKzP,EAAU,GAAKA,EAAU,GAE1C,GAAIyP,EAAMhS,OAAOC,QACf,OAAOQ,EAAInC,WAGb,MAAMuD,EFnOM,SAAShE,GACtB,MAAMoU,EAAY,GAAJpU,EAEdoN,EAAW,GAAKpN,EAChBqN,EAAS,GAAK,YAAaA,EAAS,IAAM,GAE1C,IAAIpN,EAAImN,EAAW,GAGnB,OAFAnN,GAAS,IAAOmU,EAAQnU,EAAIA,EAErBA,CACR,CEyNgBoU,CAAMF,GAMpB,OAJAD,EAAS,GAAKxP,EAAU,GAAKV,EAC7BkQ,EAAS,GAAKxP,EAAU,GAAKV,EAC7BkQ,EAAS,GAAKxP,EAAU,GAAKV,EAEtBpB,CACR,CAEA,UAAA0R,CAAWC,GACV,MAAM7P,EAAY/H,KAAKkD,MAEjB2U,EAAI,EADgB7X,KAAKgF,gBAGzB3B,EAAI0E,EAAU,GACdzE,EAAIyE,EAAU,GACdb,EAAIa,EAAU,GACdkO,EAAIlO,EAAU,GAEd+P,EAAKzU,EAAIwU,EACTE,EAAKzU,EAAIuU,EACTG,EAAK9Q,EAAI2Q,EAETI,EAAKhC,EAAI6B,EACTI,EAAKjC,EAAI8B,EACTI,EAAKlC,EAAI+B,EAETI,EAAK/U,EAAIyU,EACTO,EAAKhV,EAAI0U,EACTO,EAAKjV,EAAI2U,EAETO,EAAKjV,EAAIyU,EACTS,EAAKlV,EAAI0U,EACTS,EAAKvR,EAAI8Q,EAEf,OAAOJ,EAAOrU,UACb,GAAKgV,EAAKE,GAAKJ,EAAKF,EAAKG,EAAKJ,EAC9BG,EAAKF,EAAK,GAAKC,EAAKK,GAAKD,EAAKP,EAC9BK,EAAKJ,EAAKM,EAAKP,EAAK,GAAKG,EAAKG,GAEhC,CAEA,UAAAG,CAAWd,GACV,MAAM7P,EAAY/H,KAAKkD,MAEjB2U,EAAI,EADgB7X,KAAKgF,gBAGzB3B,EAAI0E,EAAU,GACdzE,EAAIyE,EAAU,GACdb,EAAIa,EAAU,GACdkO,EAAIlO,EAAU,GAEd+P,EAAKzU,EAAIwU,EACTE,EAAKzU,EAAIuU,EACTG,EAAK9Q,EAAI2Q,EAETI,EAAKhC,EAAI6B,EACTI,EAAKjC,EAAI8B,EACTI,EAAKlC,EAAI+B,EAETI,EAAK/U,EAAIyU,EACTO,EAAKhV,EAAI0U,EACTO,EAAKjV,EAAI2U,EAETO,EAAKjV,EAAIyU,EACTS,EAAKlV,EAAI0U,EACTS,EAAKvR,EAAI8Q,EAEf,OAAOJ,EAAOrU,UACb,GAAKgV,EAAKE,GAAKJ,EAAKF,EAAKG,EAAKJ,EAAM,EACpCG,EAAKF,EAAK,GAAKC,EAAKK,GAAKD,EAAKP,EAAM,EACpCK,EAAKJ,EAAKM,EAAKP,EAAK,GAAKG,EAAKG,GAAM,EACpC,EAAO,EAAO,EAAO,EAEvB,CAEA,MAAAI,CAAOxR,GACN,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAErB2V,EAAKD,EAAY,GACjBE,EAAKF,EAAY,GACjBG,EAAKH,EAAY,GAEjBI,EAAKjR,EAAU,GACfkR,EAAKlR,EAAU,GACfmR,EAAKnR,EAAU,GACfoR,EAAKpR,EAAU,GAEfqR,EAAKD,EAAKN,EAAW,GAALG,GAAUC,EAAKF,EAAKG,EAAKJ,EACzCO,EAAKF,EAAKL,EAAW,GAALG,GAAUC,EAAKL,EAAKG,EAAKD,EACzCO,EAAKH,EAAKJ,EAAW,GAALG,GAAUF,EAAKF,EAAKG,EAAKJ,EACzCU,EAAKP,EAAKH,EAAU,EAALM,EAASF,EAAKH,EAAKI,EAAKH,EAM7C,OAJAH,EAAY,GAAKW,EAAKL,EAAKI,EAAKH,EAAKC,EAAKH,EAAKI,EAAKL,EACpDJ,EAAY,GAAKW,EAAKN,EAAKI,EAAKF,EAAKG,EAAKN,EAAKI,EAAKF,EACpDN,EAAY,GAAKW,EAAKP,EAAKI,EAAKD,EAAKE,EAAKH,EAAKI,EAAKL,EAE7C9R,CACR,CAEA,QAAAqS,GACC,OAAO,IAAIxS,EAAQ,CAClBhH,KAAKqD,EAAGrD,KAAKsD,EAAGtD,KAAKkH,GAEvB,CAEA,QAAAgQ,CAAShB,EAAeI,EAAaG,GACpC,MAAMgD,EAAShV,KAAK8D,IAAU,GAAN+N,GAClBoD,EAASjV,KAAK6D,IAAU,GAANgO,GAClBqD,EAAWlV,KAAK8D,IAAY,GAAR2N,GACpBC,EAAW1R,KAAK6D,IAAY,GAAR4N,GACpB0D,EAAUnV,KAAK8D,IAAW,GAAPkO,GACnBoD,EAAUpV,KAAK6D,IAAW,GAAPmO,GACnB1O,EAAY/H,KAAKkD,MAOvB,OALM6E,EAAU,GAAK8R,EAAUF,EAAWF,EAASG,EAAUzD,EAAWuD,EAClE3R,EAAU,GAAK6R,EAAUzD,EAAWsD,EAASI,EAAUF,EAAWD,EAClE3R,EAAU,GAAK6R,EAAUD,EAAWD,EAASG,EAAU1D,EAAWsD,EACxE1R,EAAU,GAAK6R,EAAUD,EAAWF,EAASI,EAAU1D,EAAWuD,EAE3D1Z,IACR,CAEA,YAAA+W,CAAaD,EAAelQ,EAAgB,GAC3C,MAAMkT,EAAahD,EAAKzV,SACxB,GAAmB,IAAfyY,EACF,OAAO9Z,KAET,MAAM+Z,EAAUtV,KAAK6D,IAAY,GAAR1B,GAAekT,EAClCE,EAAYlD,EAAK5T,MACjB6E,EAAY/H,KAAKkD,MAMvB,OALA6E,EAAU,GAAKiS,EAAU,GAAKD,EAC9BhS,EAAU,GAAKiS,EAAU,GAAKD,EAC9BhS,EAAU,GAAKiS,EAAU,GAAKD,EAC9BhS,EAAU,GAAKtD,KAAK8D,IAAY,GAAR3B,GAEjB5G,IACR,CAIA,SAAAia,CAAUrC,GACT,MAAMsC,EAActC,EAAO1U,MAC3B,IAAIoO,EAAM,EAAGE,EAAM,EAAGC,EAAM,EAC3BC,EAAM,EAAGC,EAAM,EAAGC,EAAM,EACxBC,EAAM,EAAGC,EAAM,EAAGC,EAAM,EAErB6F,aAAkB/B,GACrBvE,EAAM4I,EAAY,GAAI1I,EAAM0I,EAAY,GAAIzI,EAAMyI,EAAY,GAC9DxI,EAAMwI,EAAY,GAAIvI,EAAMuI,EAAY,GAAItI,EAAMsI,EAAY,GAC9DrI,EAAMqI,EAAY,GAAIpI,EAAMoI,EAAY,GAAInI,EAAMmI,EAAY,KAG9D5I,EAAM4I,EAAY,GAAI1I,EAAM0I,EAAY,GAAIzI,EAAMyI,EAAa,GAC/DxI,EAAMwI,EAAY,GAAIvI,EAAMuI,EAAY,GAAItI,EAAMsI,EAAa,GAC/DrI,EAAMqI,EAAY,GAAIpI,EAAMoI,EAAY,GAAInI,EAAMmI,EAAY,KAG/D,MAAM9H,EAAQd,EAAMK,EAAMI,EACpBhK,EAAY/H,KAAKkD,MAEvB,GAAIkP,EAAQ,EAAG,CACd,MAAMyF,EAA2B,EAAvBpT,KAAKM,KAAKqN,EAAQ,GAC5BrK,EAAU,GAAK,IAAO8P,EACtB9P,EAAU,IAAM+J,EAAMF,GAAOiG,EAC7B9P,EAAU,IAAM0J,EAAMI,GAAOgG,EAC7B9P,EAAU,IAAM2J,EAAMF,GAAOqG,C,MAEzB,GAAIvG,EAAMK,GAAOL,EAAMS,EAAK,CAChC,MAAM8F,EAAI,EAAIpT,KAAKM,KAAK,EAAIuM,EAAMK,EAAMI,GACxChK,EAAU,IAAM+J,EAAMF,GAAOiG,EAC7B9P,EAAU,GAAK,IAAO8P,EACtB9P,EAAU,IAAMyJ,EAAME,GAAOmG,EAC7B9P,EAAU,IAAM0J,EAAMI,GAAOgG,C,MAEzB,GAAIlG,EAAMI,EAAK,CACnB,MAAM8F,EAAI,EAAIpT,KAAKM,KAAK,EAAI4M,EAAML,EAAMS,GACxChK,EAAU,IAAM0J,EAAMI,GAAOgG,EAC7B9P,EAAU,IAAMyJ,EAAME,GAAOmG,EAC7B9P,EAAU,GAAK,IAAO8P,EACtB9P,EAAU,IAAM6J,EAAME,GAAO+F,C,KAEzB,CACJ,MAAMA,EAAI,EAAIpT,KAAKM,KAAK,EAAIgN,EAAMT,EAAMK,GACxC5J,EAAU,IAAM2J,EAAMF,GAAOqG,EAC7B9P,EAAU,IAAM0J,EAAMI,GAAOgG,EAC7B9P,EAAU,IAAM6J,EAAME,GAAO+F,EAC7B9P,EAAU,GAAK,IAAO8P,C,CAGvB,OAAO7X,IACR,CAEA,MAAA+O,CAAOoL,EAAiBC,GACvB,MAAMvM,EAAUuM,EAAKxW,QAAQM,IAAIiW,GAAQ9U,YAEnCyR,EAAO9N,EAAM6E,QAAQjK,QAAQe,MAAMkJ,GACnC/I,EAAMkE,EAAM6E,QAAQ/I,IAAI+I,GAE9B,OAAO,IAAIwM,EAAWvD,EAAKzT,EAAGyT,EAAKxT,EAAGwT,EAAK5P,EAAGpC,EAAM,GAAGO,WACxD,CAEA,iBAAOiV,CAAW1C,GACjB,OAAO,IAAI9B,GAAiBmE,UAAUrC,EACvC,CAEA,UAAA2C,CAAW5X,EAAeyE,GACzB,MAAMtC,EAAMnC,EAAKmC,IAAIsC,GAEfoT,EADQ7X,EAAKgC,MAAMyC,GACAlE,MACnB6E,EAAY/H,KAAKkD,MAEvB6E,EAAU,GAAKyS,EAAW,GAC1BzS,EAAU,GAAKyS,EAAW,GAC1BzS,EAAU,GAAKyS,EAAW,GAE1B,MAAMC,EAAa9X,EAAKtB,SAClBqZ,EAAW/X,EAAKtB,SAItB,OAFA0G,EAAU,GAAKtD,KAAKM,KAAK0V,EAAaA,EAAaC,EAAWA,GAAY5V,EAEnE9E,KAAKqF,WACb,CAEA,GAAAP,CAAIqS,GACH,MAAMpP,EAAY/H,KAAKkD,MACjBmU,EAAYF,EAAKjU,MACvB,OAAO6E,EAAU,GAAKsP,EAAU,GAAKtP,EAAU,GAAKsP,EAAU,GAAKtP,EAAU,GAAKsP,EAAU,GAAKtP,EAAU,GAAKsP,EAAU,EAC3H,CAEA,aAAArS,GACC,MAAM+C,EAAY/H,KAAKkD,MACvB,OAAO6E,EAAU,IAAM,EAAIA,EAAU,IAAM,EAAIA,EAAU,IAAM,EAAIA,EAAU,IAAM,CACpF,CAEA,MAAA1G,GACC,MAAM0G,EAAY/H,KAAKkD,MACvB,OAAOuB,KAAKkD,MAAMI,EAAU,GAAIA,EAAU,GAAIA,EAAU,GAAIA,EAAU,GACvE,CAEA,OAAA4S,CAAQC,GACP,OAAO,EAAInW,KAAKwC,KAAKxC,KAAK2R,IAAI3R,KAAKF,KAAK,EAAGE,KAAKH,IAAI,EAAGtE,KAAK8E,IAAI8V,MACjE,CAEA,aAAAC,CAAcD,GACb,MAAMhU,EAAQ5G,KAAK2a,QAAQC,GAE3B,GAAc,IAAVhU,EACH,OAAO5G,KAGR,MAAMoE,EAAIK,KAAKH,IAAI,EAAGsC,GAGtB,OAFA5G,KAAK8a,MAAM9a,KAAM4a,EAAUxW,GAEpBpE,IACR,CAEA,MAAAsS,GACC,OAAOtS,KAAK+a,WACb,CAEA,SAAAA,GACC,MAAMhT,EAAY/H,KAAKkD,MAMvB,OAJA6E,EAAU,KAAO,EACjBA,EAAU,KAAO,EACjBA,EAAU,KAAO,EAEV/H,IACR,CAEA,SAAAqF,GACC,MAAM0C,EAAY/H,KAAKkD,MACvB,IAAI7B,EAASrB,KAAKqB,SAgBlB,OAde,IAAXA,GACH0G,EAAU,GAAK,EACfA,EAAU,GAAK,EACfA,EAAU,GAAK,EACfA,EAAU,GAAK,IAGf1G,EAAS,EAAIA,EACb0G,EAAU,IAAM1G,EAChB0G,EAAU,IAAM1G,EAChB0G,EAAU,IAAM1G,EAChB0G,EAAU,IAAM1G,GAGVrB,IACR,CAEA,GAAA+D,CAAIoT,GACH,MAAMpP,EAAY/H,KAAKkD,MACjBmU,EAAYF,EAAKjU,MAMvB,OALA6E,EAAU,IAAMsP,EAAU,GAC1BtP,EAAU,IAAMsP,EAAU,GAC1BtP,EAAU,IAAMsP,EAAU,GAC1BtP,EAAU,IAAMsP,EAAU,GAEnBrX,IACR,CAEA,GAAAkE,CAAIiT,GACH,MAAMpP,EAAY/H,KAAKkD,MACjBmU,EAAYF,EAAKjU,MAMvB,OALA6E,EAAU,IAAMsP,EAAU,GAC1BtP,EAAU,IAAMsP,EAAU,GAC1BtP,EAAU,IAAMsP,EAAU,GAC1BtP,EAAU,IAAMsP,EAAU,GAEnBrX,IACR,CAEA,IAAA2F,CAAKwR,GACJ,MAAMpP,EAAY/H,KAAKkD,MACjBmU,EAAYF,EAAKjU,MAEjB8X,EAAKjT,EAAU,GAAIkT,EAAKlT,EAAU,GAAImT,EAAKnT,EAAU,GAAIoT,EAAKpT,EAAU,GACxE4N,EAAK0B,EAAU,GAAIzB,EAAKyB,EAAU,GAAI+D,EAAK/D,EAAU,GAAIgE,EAAKhE,EAAU,GAO9E,OALAtP,EAAU,GAAKiT,EAAKK,EAAKF,EAAKxF,EAAKsF,EAAKG,EAAKF,EAAKtF,EAClD7N,EAAU,GAAKkT,EAAKI,EAAKF,EAAKvF,EAAKsF,EAAKvF,EAAKqF,EAAKI,EAClDrT,EAAU,GAAKmT,EAAKG,EAAKF,EAAKC,EAAKJ,EAAKpF,EAAKqF,EAAKtF,EAClD5N,EAAU,GAAKoT,EAAKE,EAAKL,EAAKrF,EAAKsF,EAAKrF,EAAKsF,EAAKE,EAE3Cpb,IACR,CAEA,KAAAqH,CAAMiU,GACL,MAAMvT,EAAY/H,KAAKkD,MAMvB,OALA6E,EAAU,IAAMuT,EAChBvT,EAAU,IAAMuT,EAChBvT,EAAU,IAAMuT,EAChBvT,EAAU,IAAMuT,EAETtb,IACR,CAIA,YAAO8a,CAAMnY,EAAkByE,EAAgBhD,EAAW6B,GAIzD,GAHMA,aAAeoU,IACpBpU,EAAM,IAAIoU,GAED,IAANjW,EAAS,OAAO6B,EAAItC,KAAKhB,GAC7B,GAAU,IAANyB,EAAS,OAAO6B,EAAItC,KAAKyD,GAE7B,MAAMmQ,EAAWtR,EAAI/C,MACf0T,EAAYjU,EAAKO,MACjBqY,EAAUnU,EAAGlE,MAEbsY,EAAe5E,EAAU,GAAK2E,EAAQ,GAAK3E,EAAU,GAAK2E,EAAQ,GAAK3E,EAAU,GAAK2E,EAAQ,GAAK3E,EAAU,GAAK2E,EAAQ,GAEhI,GAAI9W,KAAK2R,IAAIoF,IAAiB,EAK7B,OAJAjE,EAAS,GAAKX,EAAU,GACxBW,EAAS,GAAKX,EAAU,GACxBW,EAAS,GAAKX,EAAU,GACxBW,EAAS,GAAKX,EAAU,GACjB3Q,EAGR,MAAMwV,EAAYhX,KAAKwC,KAAKuU,GACtBE,EAAejX,KAAKM,KAAK,EAAIyW,EAAeA,GAElD,GAAI/W,KAAK2R,IAAIsF,EAAejX,KAAKkX,MAAMD,IAAiBlW,OAAOC,QAK9D,OAJA8R,EAAS,GAAqB,GAAfX,EAAU,GAAwB,GAAb2E,EAAQ,GAC5ChE,EAAS,GAAqB,GAAfX,EAAU,GAAwB,GAAb2E,EAAQ,GAC5ChE,EAAS,GAAqB,GAAfX,EAAU,GAAwB,GAAb2E,EAAQ,GAC5ChE,EAAS,GAAqB,GAAfX,EAAU,GAAwB,GAAb2E,EAAQ,GACrCtV,EAGR,MAAM2V,EAASnX,KAAK6D,KAAK,EAAIlE,GAAKqX,GAAaC,EACzCG,EAASpX,KAAK6D,IAAIlE,EAAIqX,GAAaC,EAMzC,OALAnE,EAAS,GAAMX,EAAU,GAAKgF,EAASL,EAAQ,GAAKM,EACpDtE,EAAS,GAAMX,EAAU,GAAKgF,EAASL,EAAQ,GAAKM,EACpDtE,EAAS,GAAMX,EAAU,GAAKgF,EAASL,EAAQ,GAAKM,EACpDtE,EAAS,GAAMX,EAAU,GAAKgF,EAASL,EAAQ,GAAKM,EAE7C5V,CACR,CAKA,KAAA6U,CAAMnY,EAAkByE,EAAgBhD,GACvC,OAAOiW,EAAWS,MAAMnY,EAAMyE,EAAIhD,EAAGpE,KACtC,CAEA,aAAA8b,CAAc5Y,EAAkCgD,EAAiB,GAChE,MAAM6B,EAAY/H,KAAKkD,MAEvBA,EAAMgD,GAAc6B,EAAU,GAC9B7E,EAAMgD,EAAS,GAAK6B,EAAU,GAC9B7E,EAAMgD,EAAS,GAAK6B,EAAU,GAC9B7E,EAAMgD,EAAS,GAAK6B,EAAU,EAC5B,CAEA,aAAA5B,CAAcjD,EAA0BgD,EAAiB,GAC3D,MAAM6B,EAAY/H,KAAKkD,MAEvB6E,EAAU,GAAK7E,EAAMgD,GACrB6B,EAAU,GAAK7E,EAAMgD,EAAS,GAC9B6B,EAAU,GAAK7E,EAAMgD,EAAS,GAC9B6B,EAAU,GAAK7E,EAAMgD,EAAS,EAC5B,EAGJ,IAAImU,EAAoCvE,EACM,IAAIlG,EAAUkG,GACA,IAAIrU,EAAS,CACxEK,YAAagU,EACb5T,kBACEsE,IACA6T,EAAa7T,CAAI,IC9gBpB,MAAMuV,EACK7Y,MAUV,WAAAlB,IACMC,GAEL,GAAuB,iBAAZA,EAAK,GACfjC,KAAKkD,MAAQ,IAAIC,aAAa,CACzBlB,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GACpCA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GACpCA,EAAM,GAAIA,EAAM,GAAIA,EAAK,IAAKA,EAAK,IACnCA,EAAK,IAAKA,EAAK,IAAKA,EAAK,IAAKA,EAAK,WAGpC,GAAuB,iBAAZA,EAAK,GAAiB,CAClC,MAAMiB,EAAQjB,EAAK,GACnBjC,KAAK6Q,WAAW3N,GACZA,aAAiBC,aACnBnD,KAAKkD,MAAQA,EAGblD,KAAKkD,MAAQ,IAAIC,aAAaD,E,MAInClD,KAAKkD,MAAQ,IAAIC,aAAa,GAE/B,CAEA,iBAAO6Y,CACL1K,EAAaI,EAAaG,EAAaoK,EACvCzK,EAAaG,EAAaG,EAAaoK,EACvCzK,EAAaG,EAAaG,EAAaoK,EACvCC,EAAaC,EAAaC,EAAaC,GAEvC,OAAO,IAAIR,EACTzK,EAAKI,EAAKG,EAAKoK,EACfzK,EAAKG,EAAKG,EAAKoK,EACfzK,EAAKG,EAAKG,EAAKoK,EACfC,EAAKC,EAAKC,EAAKC,EAEnB,CAEA,gBAAO3F,CAAU1T,GACf,GAAIA,EAAM7B,OAAS,GACjB,MAAM,IAAIC,MAAM,+CAElB,OAAO,IAAIya,EAAY7Y,EACzB,CAEA,SAAA8O,GACE,MAAMjK,EAAY/H,KAAKkD,MACzB,MAAO,CACH6E,EAAW,GAAIA,EAAW,GAAIA,EAAW,GAAIA,EAAW,GACxDA,EAAW,GAAIA,EAAW,GAAIA,EAAW,GAAIA,EAAW,GACxDA,EAAW,GAAIA,EAAW,GAAIA,EAAU,IAAKA,EAAU,IACvDA,EAAU,IAAKA,EAAU,IAAKA,EAAU,IAAKA,EAAU,IAE5D,CAEA,SAAAxE,CACG+N,EAAaI,EAAaG,EAAaoK,EACvCzK,EAAaG,EAAaG,EAAaoK,EACvCzK,EAAaG,EAAaG,EAAaoK,EACvCC,EAAaC,EAAaC,EAAaC,GAEvC,MAAMxU,EAAY/H,KAAKkD,MAkBvB,OAjBA6E,EAAW,GAAKuJ,EAChBvJ,EAAW,GAAK2J,EAChB3J,EAAW,GAAK8J,EAChB9J,EAAW,GAAKkU,EAChBlU,EAAW,GAAKyJ,EAChBzJ,EAAW,GAAK4J,EAChB5J,EAAW,GAAK+J,EAChB/J,EAAW,GAAKmU,EAChBnU,EAAW,GAAK0J,EAChB1J,EAAW,GAAK6J,EAChB7J,EAAU,IAAMgK,EAChBhK,EAAU,IAAMoU,EAChBpU,EAAU,IAAMqU,EAChBrU,EAAU,IAAMsU,EAChBtU,EAAU,IAAMuU,EAChBvU,EAAU,IAAMwU,EAETvc,IACT,CAEA,OAAIsR,GACJ,OAAOtR,KAAKkD,MAAM,EACnB,CAEA,OAAIoO,CAAIC,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIC,GACJ,OAAOxR,KAAKkD,MAAM,EACnB,CAEA,OAAIsO,CAAID,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIE,GACJ,OAAOzR,KAAKkD,MAAM,EACnB,CAEA,OAAIuO,CAAIF,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAI6K,GACJ,OAAOpc,KAAKkD,MAAM,GACnB,CAEA,OAAIkZ,CAAI7K,GACPvR,KAAKkD,MAAM,IAAMqO,CACjB,CAEA,OAAIG,GACJ,OAAO1R,KAAKkD,MAAM,EACnB,CAEA,OAAIwO,CAAIH,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAII,GACJ,OAAO3R,KAAKkD,MAAM,EACnB,CAEA,OAAIyO,CAAIJ,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIK,GACJ,OAAO5R,KAAKkD,MAAM,EACnB,CAEA,OAAI0O,CAAIL,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAI8K,GACJ,OAAOrc,KAAKkD,MAAM,GACnB,CAEA,OAAImZ,CAAI9K,GACPvR,KAAKkD,MAAM,IAAMqO,CACjB,CAEA,OAAIM,GACJ,OAAO7R,KAAKkD,MAAM,EACnB,CAEC,OAAI2O,CAAIN,GACRvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIO,GACJ,OAAO9R,KAAKkD,MAAM,EACnB,CAEA,OAAI4O,CAAIP,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAIQ,GACJ,OAAO/R,KAAKkD,MAAM,GACnB,CAEC,OAAI6O,CAAIR,GACRvR,KAAKkD,MAAM,IAAMqO,CACjB,CAEA,OAAI+K,GACJ,OAAOtc,KAAKkD,MAAM,GACnB,CAEA,OAAIoZ,CAAIA,GACPtc,KAAKkD,MAAM,IAAMoZ,CACjB,CAEA,OAAIL,GACJ,OAAOjc,KAAKkD,MAAM,EACnB,CAEA,OAAI+Y,CAAI1K,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAI2K,GACJ,OAAOlc,KAAKkD,MAAM,EACnB,CAEA,OAAIgZ,CAAI3K,GACPvR,KAAKkD,MAAM,GAAKqO,CAChB,CAEA,OAAI4K,GACJ,OAAOnc,KAAKkD,MAAM,GACnB,CAEA,OAAIiZ,CAAI5K,GACPvR,KAAKkD,MAAM,IAAMqO,CACjB,CAEA,OAAIgL,GACJ,OAAOvc,KAAKkD,MAAM,GACnB,CAEA,OAAIqZ,CAAIA,GACPvc,KAAKkD,MAAM,IAAMqZ,CACjB,CAEQ,UAAA1L,CAAW3N,GACnB,GAAIA,EAAM7B,OAAS,GAClB,MAAM,IAAI0B,EAAU,uCAEtB,CAQC,WAAAyZ,GACE,MAAMzU,EAAY/H,KAAKkD,MACjBoO,EAAMvJ,EAAU,GAAIyJ,EAAMzJ,EAAU,GAAI0J,EAAM1J,EAAW,GACzD2J,EAAM3J,EAAU,GAAI4J,EAAM5J,EAAU,GAAI6J,EAAM7J,EAAW,GACzD8J,EAAM9J,EAAU,GAAI+J,EAAM/J,EAAU,GAAIgK,EAAMhK,EAAU,IACxDqK,EAAQd,EAAMK,EAAMI,EAE1B,IAAI1O,EAAI,EACJC,EAAI,EACJ4D,EAAI,EACJ+O,EAAI,EAER,GAAI7D,EAAQ,EAAG,CACb,MAAMyF,EAA2B,EAAvBpT,KAAKM,KAAKqN,EAAQ,GAC5B6D,EAAI,IAAO4B,EACXxU,GAAKyO,EAAMF,GAAOiG,EAClBvU,GAAKmO,EAAMI,GAAOgG,EAClB3Q,GAAKwK,EAAMF,GAAOqG,C,MAEf,GAAIvG,EAAMK,GAAOL,EAAMS,EAAK,CAC/B,MAAM8F,EAAI,EAAIpT,KAAKM,KAAK,EAAIuM,EAAMK,EAAMI,GACxCkE,GAAKnE,EAAMF,GAAOiG,EAClBxU,EAAI,IAAOwU,EACXvU,GAAKkO,EAAME,GAAOmG,EAClB3Q,GAAKuK,EAAMI,GAAOgG,C,MAEf,GAAIlG,EAAMI,EAAK,CAClB,MAAM8F,EAAI,EAAIpT,KAAKM,KAAK,EAAI4M,EAAML,EAAMS,GACxCkE,GAAKxE,EAAMI,GAAOgG,EAClBxU,GAAKmO,EAAME,GAAOmG,EAClBvU,EAAI,IAAOuU,EACX3Q,GAAK0K,EAAME,GAAO+F,C,KAEf,CACH,MAAMA,EAAI,EAAIpT,KAAKM,KAAK,EAAIgN,EAAMT,EAAMK,GACxCsE,GAAKvE,EAAMF,GAAOqG,EAClBxU,GAAKoO,EAAMI,GAAOgG,EAClBvU,GAAKsO,EAAME,GAAO+F,EAClB3Q,EAAI,IAAO2Q,C,CAGb,OAAO,IAAIwC,EAAWhX,EAAGC,EAAG4D,EAAG+O,EACjC,CAEA,MAAAwG,CAAOC,EAAsB9B,EAAsB+B,GACjD,MAAM5U,EAAY/H,KAAKkD,MACjB0Z,EAAgBhC,EAAS1X,MACzB2Z,EAAmBH,EAAYxZ,MAC/B4Z,EAAeH,EAAQzZ,MAEvBG,EAAIuZ,EAAc,GAClBtZ,EAAIsZ,EAAc,GAClB1V,EAAI0V,EAAc,GAClB3G,EAAI2G,EAAc,GAElBG,EAAK1Z,EAAIA,EACT2Z,EAAK1Z,EAAIA,EACT2Z,EAAK/V,EAAIA,EAETkR,EAAK/U,EAAI0Z,EACT1E,EAAKhV,EAAI2Z,EACT1E,EAAKjV,EAAI4Z,EACT1E,EAAKjV,EAAI0Z,EACTxE,EAAKlV,EAAI2Z,EACTxE,EAAKvR,EAAI+V,EACThF,EAAKhC,EAAI8G,EACT7E,EAAKjC,EAAI+G,EACT7E,EAAKlC,EAAIgH,EACTC,EAAKJ,EAAa,GAClBK,EAAKL,EAAa,GAClBM,EAAKN,EAAa,GAmBxB,OAjBA/U,EAAU,IAAM,GAAKwQ,EAAKE,IAAOyE,EACjCnV,EAAU,IAAMsQ,EAAKF,GAAM+E,EAC3BnV,EAAU,IAAMuQ,EAAKJ,GAAMgF,EAC3BnV,EAAU,GAAK,EACfA,EAAU,IAAMsQ,EAAKF,GAAMgF,EAC3BpV,EAAU,IAAM,GAAKqQ,EAAKK,IAAO0E,EACjCpV,EAAU,IAAMyQ,EAAKP,GAAMkF,EAC3BpV,EAAU,GAAK,EACfA,EAAU,IAAMuQ,EAAKJ,GAAMkF,EAC3BrV,EAAU,IAAMyQ,EAAKP,GAAMmF,EAC3BrV,EAAU,KAAO,GAAKqQ,EAAKG,IAAO6E,EAClCrV,EAAU,IAAM,EAChBA,EAAU,IAAM8U,EAAiB,GACjC9U,EAAU,IAAM8U,EAAiB,GACjC9U,EAAU,IAAM8U,EAAiB,GACjC9U,EAAU,IAAM,EAET/H,IACT,CAEA,WAAAqd,CAAYC,GACV,MAAMvV,EAAY/H,KAAKkD,MACjBqa,EAAkBD,EAAWpa,MAE/B2U,EAAI,EADsByF,EAAWtY,gBAGrC3B,EAAIka,EAAgB,GACpBja,EAAIia,EAAgB,GACpBrW,EAAIqW,EAAgB,GACpBtH,EAAIsH,EAAgB,GAEpBzF,EAAKzU,EAAIwU,EACTE,EAAKzU,EAAIuU,EACTG,EAAK9Q,EAAI2Q,EAETI,EAAKhC,EAAI6B,EACTI,EAAKjC,EAAI8B,EACTI,EAAKlC,EAAI+B,EAETI,EAAK/U,EAAIyU,EACTO,EAAKhV,EAAI0U,EACTO,EAAKjV,EAAI2U,EAETO,EAAKjV,EAAIyU,EACTS,EAAKlV,EAAI0U,EACTS,EAAKvR,EAAI8Q,EAEP1G,EAAM,GAAKiH,EAAKE,GAChB/G,EAAM2G,EAAKF,EACXtG,EAAMyG,EAAKJ,EACX1G,EAAM6G,EAAKF,EACXxG,EAAM,GAAKyG,EAAKK,GAChB3G,EAAM0G,EAAKP,EACXxG,EAAM6G,EAAKJ,EACXtG,EAAM4G,EAAKP,EACXlG,EAAM,GAAKqG,EAAKG,GAYtB,OAVAxQ,EAAW,GAAKuJ,EAChBvJ,EAAW,GAAK2J,EAChB3J,EAAW,GAAK8J,EAChB9J,EAAW,GAAKyJ,EAChBzJ,EAAW,GAAK4J,EAChB5J,EAAW,GAAK+J,EAChB/J,EAAW,GAAK0J,EAChB1J,EAAW,GAAK6J,EAChB7J,EAAU,IAAMgK,EAET/R,IACT,CAEA,MAAAwD,CAAOgF,GACL,MAAMT,EAAY/H,KAAKkD,MACjBsa,EAAWhV,EAAItF,MACrB,OAAO6E,EAAW,KAAOyV,EAAU,IAC9BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAW,KAAOyV,EAAU,IAC5BzV,EAAU,MAAQyV,EAAS,KAC3BzV,EAAU,MAAQyV,EAAS,KAC3BzV,EAAU,MAAQyV,EAAS,KAC3BzV,EAAU,MAAQyV,EAAS,KAC3BzV,EAAU,MAAQyV,EAAS,KAC3BzV,EAAU,MAAQyV,EAAS,GAClC,CAEA,IAAA7Z,CAAK6E,GACH,MAAMT,EAAY/H,KAAKkD,MACjBsa,EAAWhV,EAAItF,MAmBrB,OAjBA6E,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAW,GAAKyV,EAAU,GAC1BzV,EAAU,IAAMyV,EAAS,IACzBzV,EAAU,IAAMyV,EAAS,IACzBzV,EAAU,IAAMyV,EAAS,IACzBzV,EAAU,IAAMyV,EAAS,IACzBzV,EAAU,IAAMyV,EAAS,IACzBzV,EAAU,IAAMyV,EAAS,IAElBxd,IACT,CAEA,KAAA4D,GACE,MAAMmE,EAAY/H,KAAKkD,MACvB,OAAO,IAAI6Y,EACThU,EAAW,GAAIA,EAAW,GAAIA,EAAW,GAAIA,EAAW,GACxDA,EAAW,GAAIA,EAAW,GAAIA,EAAW,GAAIA,EAAW,GACxDA,EAAW,GAAIA,EAAW,GAAIA,EAAU,IAAKA,EAAU,IACvDA,EAAU,IAAKA,EAAU,IAAKA,EAAU,IAAKA,EAAU,IAE3D,CAEA,eAAO0V,GACL,OAAO,IAAI1B,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EAEb,CAEA,WAAA7J,GACE,MAAMnK,EAAY/H,KAAKkD,MAkBvB,OAjBA6E,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAET/H,IACT,CAEA,YAAO0d,GACL,OAAO,IAAI3B,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EAEb,CAEA,QAAAjY,GACE,MAAMiE,EAAY/H,KAAKkD,MAkBvB,OAjBA6E,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAET/H,IACT,CAEA,GAAAmS,GACE,MAAMpK,EAAY/H,KAAKkD,MACjBya,EAAa5V,EAAU,GAAKA,EAAU,GAAKA,EAAU,GAAKA,EAAU,GACpE6V,EAAa7V,EAAU,GAAKA,EAAU,GAAKA,EAAU,GAAKA,EAAU,GACpE8V,EAAa9V,EAAU,GAAKA,EAAU,GAAKA,EAAU,GAAKA,EAAU,GACpE+V,EAAa/V,EAAU,GAAKA,EAAU,GAAKA,EAAU,GAAKA,EAAU,GACpEgW,EAAahW,EAAU,GAAKA,EAAU,GAAKA,EAAU,GAAKA,EAAU,GACpEiW,EAAajW,EAAU,GAAKA,EAAU,GAAKA,EAAU,GAAKA,EAAU,GACpEkW,EAAelW,EAAU,GAAK+V,EAAa/V,EAAW,GAAK6V,EAAa7V,EAAU,IAAM4V,EACxFO,EAAenW,EAAU,GAAKgW,EAAahW,EAAW,GAAK8V,EAAa9V,EAAU,IAAM4V,EACxFQ,EAAepW,EAAU,GAAKiW,EAAajW,EAAU,IAAM8V,EAAa9V,EAAU,IAAM6V,EAG9F,QAFqB7V,EAAU,GAAKiW,EAAajW,EAAU,IAAMgW,EAAahW,EAAU,IAAM+V,GAEvE/V,EAAU,IAAMoW,EAAepW,EAAU,IAC5DmW,EAAenW,EAAU,IAAMkW,EAAelW,EAAU,GAC9D,CAEA,KAAAqK,GACE,MAAMrK,EAAY/H,KAAKkD,MACvB,OAAO6E,EAAU,GAAKA,EAAU,GAAKA,EAAU,IAAMA,EAAU,GACjE,CAEA,aAAOrC,CAAO0Y,EAAYnY,GACxB,MAAMrB,EAAIwZ,EAAElb,MACNzD,EAAIwG,EAAI/C,MAmBd,OAjBAzD,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAG,IAAMmF,EAAG,GACZnF,EAAE,KAAOmF,EAAE,IACXnF,EAAE,KAAOmF,EAAE,IACXnF,EAAE,KAAOmF,EAAE,IACXnF,EAAE,KAAOmF,EAAE,IACXnF,EAAE,KAAOmF,EAAE,IACXnF,EAAE,KAAOmF,EAAE,IAEJqB,CACT,CAEA,MAAAP,GACE,OAAOqW,EAAYrW,OAAO1F,KAAMA,KAClC,CAEA,gBAAOqS,CAAU+L,EAAYnY,GAC3B,MAAMrB,EAAIwZ,EAAElb,MACNzD,EAAIwG,EAAI/C,MAER+P,EAAMrO,EAAG,GACTwO,EAAMxO,EAAG,GACT2O,EAAM3O,EAAG,GACTyZ,EAAMzZ,EAAG,GACTsO,EAAMtO,EAAG,GACTyO,EAAMzO,EAAG,GACT4O,EAAM5O,EAAG,GACT0Z,EAAM1Z,EAAG,GACTuO,EAAMvO,EAAG,GACT0O,EAAM1O,EAAG,GACT6O,EAAM7O,EAAE,IACR2Z,EAAM3Z,EAAE,IACR4Z,EAAM5Z,EAAE,IACR6Z,EAAM7Z,EAAE,IACR8Z,EAAM9Z,EAAE,IACR+Z,EAAM/Z,EAAE,IAmBd,OAjBAnF,EAAG,GAAKwT,EACRxT,EAAG,GAAKyT,EACRzT,EAAG,GAAK0T,EACR1T,EAAG,GAAK+e,EACR/e,EAAG,GAAK2T,EACR3T,EAAG,GAAK4T,EACR5T,EAAG,GAAK6T,EACR7T,EAAG,GAAKgf,EACRhf,EAAG,GAAK8T,EACR9T,EAAG,GAAK+T,EACR/T,EAAE,IAAMgU,EACRhU,EAAE,IAAMif,EACRjf,EAAE,IAAM4e,EACR5e,EAAE,IAAM6e,EACR7e,EAAE,IAAM8e,EACR9e,EAAE,IAAMkf,EAED1Y,CACT,CAEA,SAAAoM,GACE,OAAO0J,EAAY1J,UAAUrS,KAAMA,KACrC,CAEA,aAAOsS,CAAO8L,EAAYnY,GACxB,MAAMrB,EAAIwZ,EAAElb,MACNzD,EAAIwG,EAAI/C,MAER0b,EAAMha,EAAG,GACTia,EAAMja,EAAG,GACTka,EAAMla,EAAG,GACTma,EAAMna,EAAG,GACToa,EAAMpa,EAAG,GACTqa,EAAMra,EAAG,GACTsa,EAAMta,EAAG,GACTua,EAAMva,EAAG,GACTwa,EAAMxa,EAAG,GACTya,EAAMza,EAAG,GACT0a,EAAM1a,EAAE,IACR2a,EAAM3a,EAAE,IACR4a,EAAM5a,EAAE,IACR6a,EAAM7a,EAAE,IACR8a,EAAM9a,EAAE,IACR+a,EAAM/a,EAAE,IAERgb,EAAMhB,EAAMK,EAAMJ,EAAMG,EACxBa,EAAMjB,EAAMM,EAAMJ,EAAME,EACxBc,EAAMlB,EAAMO,EAAMJ,EAAMC,EACxBe,EAAMlB,EAAMK,EAAMJ,EAAMG,EACxBe,EAAMnB,EAAMM,EAAMJ,EAAME,EACxBgB,EAAMnB,EAAMK,EAAMJ,EAAMG,EACxBgB,EAAMd,EAAMK,EAAMJ,EAAMG,EACxBW,EAAMf,EAAMM,EAAMJ,EAAME,EACxBY,EAAMhB,EAAMO,EAAMJ,EAAMC,EACxBa,EAAMhB,EAAMK,EAAMJ,EAAMG,EACxBa,EAAMjB,EAAMM,EAAMJ,EAAME,EACxBlN,EAAM+M,EAAMK,EAAMJ,EAAMG,EAExB1M,EAAK4M,EAAMrN,EAAMsN,EAAMS,EAAMR,EAAMO,EAAMN,EAAMK,EAAMJ,EAAMG,EAAMF,EAAMC,EAE7E,GAAS,GAALlN,EACF,MAAM,IAAIjQ,EAAU,6BAGtB,MAAMwd,EAAS,EAAIvN,EAmBnB,OAjBAvT,EAAG,IAAMwf,EAAM1M,EAAM2M,EAAMoB,EAAMnB,EAAMkB,GAAOE,EAC9C9gB,EAAG,KAAOof,EAAMtM,EAAMuM,EAAMwB,EAAMvB,EAAMsB,GAAOE,EAC/C9gB,EAAG,IAAMggB,EAAMQ,EAAMP,EAAMM,EAAML,EAAMI,GAAOQ,EAC9C9gB,EAAG,KAAO4f,EAAMY,EAAMX,EAAMU,EAAMT,EAAMQ,GAAOQ,EAC/C9gB,EAAG,KAAOuf,EAAMzM,EAAM2M,EAAMkB,EAAMjB,EAAMgB,GAAOI,EAC/C9gB,EAAG,IAAMmf,EAAMrM,EAAMuM,EAAMsB,EAAMrB,EAAMoB,GAAOI,EAC9C9gB,EAAG,KAAO+f,EAAMS,EAAMP,EAAMI,EAAMH,EAAME,GAAOU,EAC/C9gB,EAAG,IAAM2f,EAAMa,EAAMX,EAAMQ,EAAMP,EAAMM,GAAOU,EAC9C9gB,EAAG,IAAMuf,EAAMsB,EAAMrB,EAAMmB,EAAMjB,EAAMe,GAAOK,EAC9C9gB,EAAG,KAAOmf,EAAM0B,EAAMzB,EAAMuB,EAAMrB,EAAMmB,GAAOK,EAC/C9gB,EAAE,KAAO+f,EAAMQ,EAAMP,EAAMK,EAAMH,EAAMC,GAAOW,EAC9C9gB,EAAE,MAAQ2f,EAAMY,EAAMX,EAAMS,EAAMP,EAAMK,GAAOW,EAC/C9gB,EAAE,MAAQuf,EAAMqB,EAAMpB,EAAMkB,EAAMjB,EAAMgB,GAAOK,EAC/C9gB,EAAE,KAAOmf,EAAMyB,EAAMxB,EAAMsB,EAAMrB,EAAMoB,GAAOK,EAC9C9gB,EAAE,MAAQ+f,EAAMO,EAAMN,EAAMI,EAAMH,EAAME,GAAOW,EAC/C9gB,EAAE,KAAO2f,EAAMW,EAAMV,EAAMQ,EAAMP,EAAMM,GAAOW,EAEvCta,CACT,CAEA,MAAAqM,GACE,OAAOyJ,EAAYzJ,OAAOtS,KAAMA,KAClC,CAEA,UAAO+D,CAAIqa,EAAYoC,EAAYva,GACjC,MAAMrB,EAAIwZ,EAAElb,MACN2B,EAAI2b,EAAEtd,MACNzD,EAAIwG,EAAI/C,MAmBd,OAjBAzD,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAEXoB,CACT,CAEA,GAAAlC,CAAI6T,GACF,OAAOmE,EAAYhY,IAAI/D,KAAM4X,EAAQ5X,KACvC,CAEA,UAAOkE,CAAIka,EAAYoC,EAAYva,GACjC,MAAMrB,EAAIwZ,EAAElb,MACN2B,EAAI2b,EAAEtd,MACNzD,EAAIwG,EAAI/C,MAmBd,OAjBAzD,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAG,GAAKmF,EAAG,GAAKC,EAAG,GACnBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAClBpF,EAAE,IAAMmF,EAAE,IAAMC,EAAE,IAEXoB,CACT,CAEA,GAAA/B,CAAI0T,GACF,OAAOmE,EAAY7X,IAAIlE,KAAM4X,EAAQ5X,KACvC,CAEA,WAAO2F,CAAKyY,EAAYoC,EAAYva,GAClC,MAAMrB,EAAIwZ,EAAElb,MACN2B,EAAI2b,EAAEtd,MACNzD,EAAIwG,EAAI/C,MAER+P,EAAMrO,EAAG,GACTwO,EAAMxO,EAAG,GACT2O,EAAM3O,EAAG,GACTyZ,EAAMzZ,EAAG,GACTsO,EAAMtO,EAAG,GACTyO,EAAMzO,EAAG,GACT4O,EAAM5O,EAAG,GACT0Z,EAAM1Z,EAAG,GACTuO,EAAMvO,EAAG,GACT0O,EAAM1O,EAAG,GACT6O,EAAM7O,EAAE,IACR2Z,EAAM3Z,EAAE,IACR4Z,EAAM5Z,EAAE,IACR6Z,EAAM7Z,EAAE,IACR8Z,EAAM9Z,EAAE,IACR+Z,EAAM/Z,EAAE,IAER8O,EAAM7O,EAAG,GACTgP,EAAMhP,EAAG,GACTmP,EAAMnP,EAAG,GACT4b,EAAM5b,EAAG,GACT8O,EAAM9O,EAAG,GACTiP,EAAMjP,EAAG,GACToP,EAAMpP,EAAG,GACT6b,EAAM7b,EAAG,GACT+O,EAAM/O,EAAG,GACTkP,EAAMlP,EAAG,GACTqP,EAAMrP,EAAE,IACR8b,EAAM9b,EAAE,IACR+b,EAAM/b,EAAE,IACRgc,EAAMhc,EAAE,IACRic,EAAMjc,EAAE,IACRkc,EAAMlc,EAAE,IAmBd,OAjBApF,EAAG,GAAKwT,EAAMS,EAAMR,EAAMW,EAAMV,EAAMa,EAAMwK,EAAMiC,EAClDhhB,EAAG,GAAK2T,EAAMM,EAAML,EAAMQ,EAAMP,EAAMU,EAAMyK,EAAMgC,EAClDhhB,EAAG,GAAK8T,EAAMG,EAAMF,EAAMK,EAAMJ,EAAMO,EAAM0K,EAAM+B,EAClDhhB,EAAG,GAAK4e,EAAM3K,EAAM4K,EAAMzK,EAAM0K,EAAMvK,EAAM2K,EAAM8B,EAClDhhB,EAAG,GAAKwT,EAAMU,EAAMT,EAAMY,EAAMX,EAAMc,EAAMuK,EAAMkC,EAClDjhB,EAAG,GAAK2T,EAAMO,EAAMN,EAAMS,EAAMR,EAAMW,EAAMwK,EAAMiC,EAClDjhB,EAAG,GAAK8T,EAAMI,EAAMH,EAAMM,EAAML,EAAMQ,EAAMyK,EAAMgC,EAClDjhB,EAAG,GAAK4e,EAAM1K,EAAM2K,EAAMxK,EAAMyK,EAAMtK,EAAM0K,EAAM+B,EAClDjhB,EAAG,GAAKwT,EAAMW,EAAMV,EAAMa,EAAMZ,EAAMe,EAAMsK,EAAMmC,EAClDlhB,EAAG,GAAK2T,EAAMQ,EAAMP,EAAMU,EAAMT,EAAMY,EAAMuK,EAAMkC,EAClDlhB,EAAE,IAAM8T,EAAMK,EAAMJ,EAAMO,EAAMN,EAAMS,EAAMwK,EAAMiC,EAClDlhB,EAAE,IAAM4e,EAAMzK,EAAM0K,EAAMvK,EAAMwK,EAAMrK,EAAMyK,EAAMgC,EAClDlhB,EAAE,IAAMwT,EAAM2N,EAAM1N,EAAM2N,EAAM1N,EAAM2N,EAAMtC,EAAMuC,EAClDthB,EAAE,IAAM2T,EAAMwN,EAAMvN,EAAMwN,EAAMvN,EAAMwN,EAAMrC,EAAMsC,EAClDthB,EAAE,IAAM8T,EAAMqN,EAAMpN,EAAMqN,EAAMpN,EAAMqN,EAAMpC,EAAMqC,EAClDthB,EAAE,IAAM4e,EAAMuC,EAAMtC,EAAMuC,EAAMtC,EAAMuC,EAAMnC,EAAMoC,EAE3C9a,CACT,CAEA,IAAAN,CAAKiS,GACH,OAAOmE,EAAYpW,KAAK3F,KAAM4X,EAAQ5X,KACxC,CAED,iBAAAghB,GACG,MAAMjZ,EAAY/H,KAAKkD,MACjB+d,EAAWlZ,EAAW,GAAKA,EAAW,GAAKA,EAAW,GAAKA,EAAW,GAAKA,EAAW,GAAKA,EAAW,GACtGmZ,EAAWnZ,EAAW,GAAKA,EAAW,GAAKA,EAAW,GAAKA,EAAW,GAAKA,EAAW,GAAKA,EAAW,GACtGoZ,EAAWpZ,EAAW,GAAKA,EAAW,GAAKA,EAAW,GAAKA,EAAW,GAAKA,EAAU,IAAMA,EAAU,IAE3G,OAAOtD,KAAKM,KAAKN,KAAKF,IAAI0c,EAAUC,EAAUC,GAChD,CAEA,cAAAnb,CAAe9C,EAAkCgD,EAAiB,GAChE,MAAM6B,EAAY/H,KAAKkD,MACzBA,EAAMgD,GAAe6B,EAAW,GAChC7E,EAAMgD,EAAU,GAAK6B,EAAW,GAC9B7E,EAAMgD,EAAU,GAAK6B,EAAW,GAChC7E,EAAMgD,EAAU,GAAK6B,EAAW,GAClC7E,EAAMgD,EAAU,GAAK6B,EAAW,GAC9B7E,EAAMgD,EAAU,GAAK6B,EAAW,GAChC7E,EAAMgD,EAAU,GAAK6B,EAAW,GAClC7E,EAAMgD,EAAU,GAAK6B,EAAW,GAC9B7E,EAAMgD,EAAU,GAAK6B,EAAW,GAChC7E,EAAMgD,EAAU,GAAK6B,EAAW,GAClC7E,EAAMgD,EAAS,IAAM6B,EAAU,IAC7B7E,EAAMgD,EAAS,IAAM6B,EAAU,IAC/B7E,EAAMgD,EAAS,IAAM6B,EAAU,IACjC7E,EAAMgD,EAAS,IAAM6B,EAAU,IAC7B7E,EAAMgD,EAAS,IAAM6B,EAAU,IAC/B7E,EAAMgD,EAAS,IAAM6B,EAAU,GACjC,CAEA,aAAA5B,CAAcjD,EAA0BgD,EAAiB,GACvD,MAAM6B,EAAY/H,KAAKkD,MAkBvB,OAjBA6E,EAAW,GAAK7E,EAAMgD,GACtB6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAW,GAAK7E,EAAMgD,EAAU,GAChC6B,EAAU,IAAM7E,EAAMgD,EAAS,IAC/B6B,EAAU,IAAM7E,EAAMgD,EAAS,IAC/B6B,EAAU,IAAM7E,EAAMgD,EAAS,IAC/B6B,EAAU,IAAM7E,EAAMgD,EAAS,IAC/B6B,EAAU,IAAM7E,EAAMgD,EAAS,IAC/B6B,EAAU,IAAM7E,EAAMgD,EAAS,IAExBlG,IACT,CAEA,KAAA2U,CAAMpO,GACJ,MAAM3B,EAAI5E,KAAKkD,MAET+P,EAAMrO,EAAG,GACTsO,EAAMtO,EAAG,GACTuO,EAAMvO,EAAG,GACT4Z,EAAM5Z,EAAG,GACTwO,EAAMxO,EAAG,GACTyO,EAAMzO,EAAG,GACT0O,EAAM1O,EAAG,GACT6Z,EAAM7Z,EAAG,GACT2O,EAAM3O,EAAG,GACT4O,EAAM5O,EAAG,GACT6O,EAAM7O,EAAE,IACR8Z,EAAM9Z,EAAE,IACRyZ,EAAMzZ,EAAE,IACR0Z,EAAM1Z,EAAE,IACR2Z,EAAM3Z,EAAE,IACR+Z,EAAM/Z,EAAE,IACRwc,EAAMnO,EAAMI,EAAMH,EAAME,EACxBiO,EAAMpO,EAAMK,EAAMH,EAAMC,EACxBkO,EAAMrO,EAAMwL,EAAMD,EAAMpL,EACxBmO,EAAMrO,EAAMI,EAAMH,EAAME,EACxBmO,EAAMtO,EAAMuL,EAAMD,EAAMnL,EACxBoO,EAAMtO,EAAMsL,EAAMD,EAAMlL,EACxBoO,EAAMnO,EAAM+K,EAAM9K,EAAM6K,EACxBsD,EAAMpO,EAAMgL,EAAM9K,EAAM4K,EACxBuD,EAAMrO,EAAMoL,EAAMD,EAAML,EACxBwD,EAAMrO,EAAM+K,EAAM9K,EAAM6K,EACxBwD,EAAMtO,EAAMmL,EAAMD,EAAMJ,EACxB5K,EAAMD,EAAMkL,EAAMD,EAAMH,EAExBwD,EAAKxb,EAAKlD,EACV2e,EAAKzb,EAAKjD,EACV2e,EAAK1b,EAAKW,EACVgb,EAAK3b,EAAK0P,EAEhB,IAAI9D,EAAMiP,EAAM1N,EAAM2N,EAAMS,EAAMR,EAAMO,EAAMN,EAAMK,EAAMJ,EAAMG,EAAMF,EAAMC,EA2B5E,OAzBW,GAAPvP,IACFA,EAAM,EAAIA,GAwBL,CArBGA,IACNkB,EAAMK,EAAMJ,EAAMwO,EAAMrD,EAAMoD,GAAOE,GACtC3O,EAAMM,EAAMJ,EAAMsO,EAAMnD,EAAMkD,GAAOK,GACrC5O,EAAM0O,EAAMzO,EAAMuO,EAAMnD,EAAMiD,GAAOO,GACrC7O,EAAMyO,EAAMxO,EAAMsO,EAAMrO,EAAMoO,GAAOQ,GAC9B/P,KACLe,EAAMQ,EAAMP,EAAM2O,EAAMtD,EAAMqD,GAAOE,GACvC9O,EAAMS,EAAMP,EAAMyO,EAAMpD,EAAMmD,GAAOK,GACrC/O,EAAM6O,EAAM5O,EAAM0O,EAAMpD,EAAMkD,GAAOO,GACrChP,EAAM4O,EAAM3O,EAAMyO,EAAMxO,EAAMuO,GAAOQ,GAC9B/P,IACNmM,EAAMmD,EAAMlD,EAAMiD,EAAM7C,EAAM4C,GAAOQ,GACtC1D,EAAMoD,EAAMlD,EAAM+C,EAAM3C,EAAM0C,GAAOW,GACrC3D,EAAMmD,EAAMlD,EAAMgD,EAAM3C,EAAMyC,GAAOa,GACrC5D,EAAMkD,EAAMjD,EAAM+C,EAAM9C,EAAM6C,GAAOc,GAC9B/P,KACLqB,EAAMiO,EAAMhO,EAAM+N,EAAM9C,EAAM6C,GAAOQ,GACvCxO,EAAMkO,EAAMhO,EAAM6N,EAAM5C,EAAM2C,GAAOW,GACrCzO,EAAMiO,EAAMhO,EAAM8N,EAAM5C,EAAM0C,GAAOa,GACrC1O,EAAMgO,EAAM/N,EAAM6N,EAAM5N,EAAM2N,GAAOc,GAK1C,CAEA,MAAAxM,CAAOnP,GACL,MAAM3B,EAAI5E,KAAKkD,MAET+P,EAAMrO,EAAE,GACRsO,EAAMtO,EAAE,GACRwO,EAAMxO,EAAE,GACRyO,EAAMzO,EAAE,GACR+Q,EAAKpP,EAAKlD,EAAIuB,EAAE,GAChBgR,EAAKrP,EAAKjD,EAAIsB,EAAE,GAEtB,IAAIuN,EAAMc,EAAMI,EAAMH,EAAME,EAS5B,OAPW,GAAPjB,IACFA,EAAM,EAAMA,GAMP,CAHGA,GAAOkB,EAAMsC,EAAKzC,EAAM0C,GACxBzD,GAAOc,EAAM2C,EAAKxC,EAAMuC,GAKpC,CAEA,MAAAwM,CAAO5b,GACL,MAAM3B,EAAI5E,KAAKkD,MAET+P,EAAMrO,EAAG,GACTsO,EAAMtO,EAAG,GACTuO,EAAMvO,EAAG,GACTwO,EAAMxO,EAAG,GACTyO,EAAMzO,EAAG,GACT0O,EAAM1O,EAAG,GACT2O,EAAM3O,EAAG,GACT4O,EAAM5O,EAAG,GACT6O,EAAM7O,EAAE,IACR+Q,EAAKpP,EAAKlD,EAAIuB,EAAE,IAChBgR,EAAKrP,EAAKjD,EAAIsB,EAAE,IAChBwW,EAAK7U,EAAKW,EAAItC,EAAE,IAEtB,IAAIyQ,EAAKhC,EAAMI,EAAMH,EAAME,EACvB8B,EAAKhC,EAAMC,EAAMH,EAAMK,EACvB8B,EAAKnC,EAAMI,EAAMH,EAAME,EAEvBpB,EAAMc,EAAMoC,EAAKnC,EAAMoC,EAAKnC,EAAMoC,EAC3B,GAAPpD,IACFA,EAAM,EAAMA,GAGd,MAAM9O,EAAI8O,GAAOwD,EAAKN,EAAKO,EAAKN,EAAK8F,EAAK7F,GAE1CF,IAAO7B,EAAM4H,EAAK3H,EAAMmC,GACxBN,IAAO7B,EAAMkC,EAAKpC,EAAM6H,GACxB7F,IAAOhC,EAAMqC,EAAKpC,EAAMmC,GAExB,MAAMrS,EAAI6O,GAAOc,EAAMoC,EAAKnC,EAAMoC,EAAKnC,EAAMoC,GAQ7C,OANAF,IAAOO,EAAKtC,EAAM8H,EAAK/H,GACvBiC,IAAO8F,EAAKhI,EAAMuC,EAAKrC,GACvBiC,IAAOI,EAAKtC,EAAMuC,EAAKxC,GAIhB,CACL/P,EAAGC,EAHK6O,GAAOc,EAAMoC,EAAKnC,EAAMoC,EAAKnC,EAAMoC,GAK/C,CAEA,kBAAOmH,CAAYvV,GACjB,OAAO,IAAI4U,GAAcqG,eAAejb,EAC1C,CAEA,cAAAib,CAAe3e,GACb,MAAMsE,EAAY/H,KAAKkD,MACjBmf,EAAW5e,EAAIP,MAEfG,EAAIgf,EAAS,GACb/e,EAAI+e,EAAS,GACbnb,EAAImb,EAAS,GAmBnB,OALAta,EAAU,IAAM1E,EAChB0E,EAAU,IAAMzE,EAChByE,EAAU,IAAMb,EAGTlH,IACT,CAEA,SAAA8N,CAAU3G,GACR,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAErBkW,EAAKR,EAAY,GACjBS,EAAKT,EAAY,GACjBU,EAAKV,EAAY,GAGjBrR,EAAKQ,EAAU,GAAKqR,EAAKrR,EAAU,GAAKsR,EAAKtR,EAAW,GAAKuR,EAFxD,EAE6DvR,EAAU,IAC5EP,EAAKO,EAAU,GAAKqR,EAAKrR,EAAU,GAAKsR,EAAKtR,EAAW,GAAKuR,EAHxD,EAG6DvR,EAAU,IAC5Eua,EAAKva,EAAU,GAAKqR,EAAKrR,EAAU,GAAKsR,EAAKtR,EAAU,IAAMuR,EAJxD,EAI6DvR,EAAU,IAC5Ewa,EAAKxa,EAAU,GAAKqR,EAAKrR,EAAU,GAAKsR,EAAKtR,EAAU,IAAMuR,EALxD,EAK6DvR,EAAU,IAOlF,OALAA,EAAU,IAAMR,EAChBQ,EAAU,IAAMP,EAChBO,EAAU,IAAMua,EAChBva,EAAU,IAAMwa,EAETviB,IACT,CAEA,gBAAOmU,CAAUvN,GACf,OAAO,IAAImV,GAAc3H,aAAaxN,EACxC,CAEA,YAAAwN,CAAaxN,GACX,MAAMmB,EAAY/H,KAAKkD,MACjBmR,EAAW5P,KAAK8D,IAAI3B,GACpB0N,EAAW7P,KAAK6D,IAAI1B,GAmB1B,OAjBAmB,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAKsM,EAChBtM,EAAW,GAAKuM,EAChBvM,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,IAAMuM,EACjBvM,EAAU,IAAMsM,EAChBtM,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAET/H,IACT,CAEA,OAAAwiB,CAAQ5b,GACN,MAAMmB,EAAY/H,KAAKkD,MACjBmR,EAAW5P,KAAK8D,IAAI3B,GACpB0N,EAAW7P,KAAK6D,IAAI1B,GAEpBW,EAAKQ,EAAU,GAAMsM,EAAWtM,EAAW,GAAKuM,EAChD9M,EAAKO,EAAU,GAAMsM,EAAWtM,EAAW,GAAKuM,EAChDgO,EAAKva,EAAU,GAAMsM,EAAWtM,EAAU,IAAMuM,EAChDiO,EAAKxa,EAAU,GAAMsM,EAAWtM,EAAU,IAAMuM,EAChDmO,EAAK1a,EAAU,IAAMuM,EAAWvM,EAAW,GAAKsM,EAChDqO,EAAK3a,EAAU,IAAMuM,EAAWvM,EAAW,GAAKsM,EAChDsO,EAAK5a,EAAU,IAAMuM,EAAWvM,EAAU,IAAMsM,EAChDuO,EAAK7a,EAAU,IAAMuM,EAAWvM,EAAU,IAAMsM,EAWtD,OATAtM,EAAW,GAAKR,EAChBQ,EAAW,GAAKP,EAChBO,EAAW,GAAKua,EAChBva,EAAW,GAAKwa,EAChBxa,EAAW,GAAK0a,EAChB1a,EAAW,GAAK2a,EAChB3a,EAAU,IAAM4a,EAChB5a,EAAU,IAAM6a,EAET5iB,IACT,CAEA,gBAAOuU,CAAU3N,GACf,OAAO,IAAImV,GAAcvH,aAAa5N,EACxC,CAEA,YAAA4N,CAAa5N,GACX,MAAMmB,EAAY/H,KAAKkD,MACjBmR,EAAW5P,KAAK8D,IAAI3B,GACpB0N,EAAW7P,KAAK6D,IAAI1B,GAmB1B,OAjBAmB,EAAW,GAAKsM,EAChBtM,EAAW,GAAK,EAChBA,EAAW,IAAMuM,EACjBvM,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAKuM,EAChBvM,EAAW,GAAK,EAChBA,EAAU,IAAMsM,EAChBtM,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAET/H,IACT,CAEA,OAAA6iB,CAAQjc,GACN,MAAMmB,EAAY/H,KAAKkD,MACjBmR,EAAW5P,KAAK8D,IAAI3B,GACpB0N,EAAW7P,KAAK6D,IAAI1B,GAEpBW,EAAKQ,EAAW,GAAKsM,EAAWtM,EAAW,IAAMuM,EACjD9M,EAAKO,EAAW,GAAKsM,EAAWtM,EAAW,IAAMuM,EACjDgO,EAAKva,EAAW,GAAKsM,EAAWtM,EAAU,KAAOuM,EACjDiO,EAAKxa,EAAW,GAAKsM,EAAWtM,EAAU,KAAOuM,EACjDmO,EAAK1a,EAAW,GAAKuM,EAAWvM,EAAW,GAAMsM,EACjDqO,EAAK3a,EAAW,GAAKuM,EAAWvM,EAAW,GAAMsM,EACjDsO,EAAK5a,EAAW,GAAKuM,EAAWvM,EAAU,IAAOsM,EACjDuO,EAAK7a,EAAW,GAAKuM,EAAWvM,EAAU,IAAOsM,EAWvD,OATAtM,EAAW,GAAKR,EAChBQ,EAAW,GAAKP,EAChBO,EAAW,GAAKua,EAChBva,EAAW,GAAKwa,EAChBxa,EAAW,GAAK0a,EAChB1a,EAAW,GAAK2a,EAChB3a,EAAU,IAAM4a,EAChB5a,EAAU,IAAM6a,EAET5iB,IACT,CAEA,gBAAOyU,CAAU7N,GACf,OAAO,IAAImV,GAAcrH,aAAa9N,EACxC,CAEA,YAAA8N,CAAa9N,GACX,MAAMmB,EAAY/H,KAAKkD,MACjBmR,EAAW5P,KAAK8D,IAAI3B,GACpBkc,EAAYre,KAAK6D,IAAI1B,GAmB3B,OAjBAmB,EAAW,GAAKsM,EAChBtM,EAAW,GAAK+a,EAChB/a,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,IAAM+a,EACjB/a,EAAW,GAAKsM,EAChBtM,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAET/H,IACT,CAEA,OAAA+iB,CAAQnc,GACN,MAAMmB,EAAY/H,KAAKkD,MACjBmR,EAAW5P,KAAK8D,IAAI3B,GACpB0N,EAAW7P,KAAK6D,IAAI1B,GAEpBW,EAAKQ,EAAU,GAAMsM,EAAWtM,EAAU,GAAKuM,EAC/C9M,EAAKO,EAAU,GAAMsM,EAAWtM,EAAU,GAAKuM,EAC/CgO,EAAKva,EAAU,GAAMsM,EAAWtM,EAAU,GAAKuM,EAC/CiO,EAAKxa,EAAU,GAAMsM,EAAWtM,EAAU,GAAKuM,EAC/CmO,EAAK1a,EAAU,IAAMuM,EAAWvM,EAAU,GAAKsM,EAC/CqO,EAAK3a,EAAU,IAAMuM,EAAWvM,EAAU,GAAKsM,EAC/CsO,EAAK5a,EAAU,IAAMuM,EAAWvM,EAAU,GAAKsM,EAC/CuO,EAAK7a,EAAU,IAAMuM,EAAWvM,EAAU,GAAKsM,EAWrD,OATAtM,EAAU,GAAKR,EACfQ,EAAU,GAAKP,EACfO,EAAU,GAAKua,EACfva,EAAU,GAAKwa,EACfxa,EAAU,GAAK0a,EACf1a,EAAU,GAAK2a,EACf3a,EAAU,GAAK4a,EACf5a,EAAU,GAAK6a,EAER5iB,IACT,CAEA,eAAO4a,CAAShD,GACd,OAAO,IAAImE,GAAcnB,SAAShD,EACpC,CAEA,QAAAgD,CAAShD,GACP,MAAM7P,EAAY/H,KAAKkD,MACjBsa,EAAW5F,EAAO1U,MAYxB,OAVA6E,EAAW,GAAKyV,EAAS,GACzBzV,EAAW,GAAKyV,EAAS,GACzBzV,EAAW,GAAKyV,EAAS,GACzBzV,EAAW,GAAKyV,EAAS,GACzBzV,EAAW,GAAKyV,EAAS,GACzBzV,EAAW,GAAKyV,EAAS,GACzBzV,EAAW,GAAKyV,EAAS,GACzBzV,EAAW,GAAKyV,EAAS,GACzBzV,EAAU,IAAMyV,EAAS,GAElBxd,IACT,CAEA,MAAA2Y,CAAO7B,EAAelQ,GACpB,MAAMmB,EAAY/H,KAAKkD,MACjB8W,EAAYlD,EAAK5T,MACjB4W,EAAahD,EAAKzV,SAClBgC,EAAI2W,EAAU,GAAKF,EACnBxW,EAAI0W,EAAU,GAAKF,EACnB5S,EAAI8S,EAAU,GAAKF,EACnBkJ,EAAIve,KAAK8D,IAAI3B,GACbiR,EAAIpT,KAAK6D,IAAI1B,GACbqc,EAAI,EAAMD,EACV1R,EAAMjO,EAAIA,EAAI4f,EAAID,EAClBxR,EAAMnO,EAAIC,EAAI2f,EAAI/b,EAAI2Q,EACtBpG,EAAMpO,EAAI6D,EAAI+b,EAAI3f,EAAIuU,EACtBnG,EAAMpO,EAAID,EAAI4f,EAAI/b,EAAI2Q,EACtBlG,EAAMrO,EAAIA,EAAI2f,EAAID,EAClBpR,EAAMtO,EAAI4D,EAAI+b,EAAI5f,EAAIwU,EACtBhG,EAAM3K,EAAI7D,EAAI4f,EAAI3f,EAAIuU,EACtB/F,EAAM5K,EAAI5D,EAAI2f,EAAI5f,EAAIwU,EACtB9F,EAAM7K,EAAIA,EAAI+b,EAAID,EAClBzb,EAAMQ,EAAU,GAAKuJ,EAAMvJ,EAAU,GAAK2J,EAAM3J,EAAU,GAAK8J,EAC/DrK,EAAMO,EAAU,GAAKuJ,EAAMvJ,EAAU,GAAK2J,EAAM3J,EAAU,GAAK8J,EAC/DyQ,EAAMva,EAAU,GAAKuJ,EAAMvJ,EAAU,GAAK2J,EAAM3J,EAAU,IAAM8J,EAChE0Q,EAAMxa,EAAU,GAAKuJ,EAAMvJ,EAAU,GAAK2J,EAAM3J,EAAU,IAAM8J,EAChE4Q,EAAM1a,EAAU,GAAKyJ,EAAMzJ,EAAU,GAAK4J,EAAM5J,EAAU,GAAK+J,EAC/D4Q,EAAM3a,EAAU,GAAKyJ,EAAMzJ,EAAU,GAAK4J,EAAM5J,EAAU,GAAK+J,EAC/D6Q,EAAM5a,EAAU,GAAKyJ,EAAMzJ,EAAU,GAAK4J,EAAM5J,EAAU,IAAM+J,EAChE8Q,EAAM7a,EAAU,GAAKyJ,EAAMzJ,EAAU,GAAK4J,EAAM5J,EAAU,IAAM+J,EAChEoR,EAAMnb,EAAU,GAAK0J,EAAM1J,EAAU,GAAK6J,EAAM7J,EAAU,GAAKgK,EAC/DuO,EAAMvY,EAAU,GAAK0J,EAAM1J,EAAU,GAAK6J,EAAM7J,EAAU,GAAKgK,EAC/DQ,EAAMxK,EAAU,GAAK0J,EAAM1J,EAAU,GAAK6J,EAAM7J,EAAU,IAAMgK,EAChES,EAAMzK,EAAU,GAAK0J,EAAM1J,EAAU,GAAK6J,EAAM7J,EAAU,IAAMgK,EActE,OAbAhK,EAAW,GAAKR,EAChBQ,EAAW,GAAKP,EAChBO,EAAW,GAAKua,EAChBva,EAAW,GAAKwa,EAChBxa,EAAW,GAAK0a,EAChB1a,EAAW,GAAK2a,EAChB3a,EAAW,GAAK4a,EAChB5a,EAAW,GAAK6a,EAChB7a,EAAW,GAAKmb,EAChBnb,EAAW,GAAKuY,EAChBvY,EAAU,IAAMwK,EAChBxK,EAAU,IAAMyK,EAETxS,IACT,CAEA,cAAO2c,CAAQlZ,GACb,OAAO,IAAIsY,GAAcoH,WAAW1f,EACtC,CAEA,UAAA0f,CAAW1f,GACT,MAAMsE,EAAY/H,KAAKkD,MACjBmf,EAAW5e,EAAIP,MACfga,EAAKmF,EAAS,GACdlF,EAAKkF,EAAS,GACdjF,EAAKiF,EAAS,GAoBpB,OAjBAta,EAAW,GAAKmV,EAChBnV,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAKoV,EAChBpV,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAU,IAAMqV,EAChBrV,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAjBC,EAmBJ/H,IACT,CAEA,KAAAqH,CAAM5D,GACJ,MAAMsE,EAAY/H,KAAKkD,MACjBmf,EAAW5e,EAAIP,MACfga,EAAKmF,EAAS,GACdlF,EAAKkF,EAAS,GACdjF,EAAKiF,EAAS,GAoBpB,OAjBAta,EAAW,IAAMmV,EACjBnV,EAAW,IAAMmV,EACjBnV,EAAW,IAAMmV,EACjBnV,EAAW,IAAMmV,EACjBnV,EAAW,IAAMoV,EACjBpV,EAAW,IAAMoV,EACjBpV,EAAW,IAAMoV,EACjBpV,EAAW,IAAMoV,EACjBpV,EAAW,IAAMqV,EACjBrV,EAAW,IAAMqV,EACjBrV,EAAU,KAAOqV,EACjBrV,EAAU,KAAOqV,EACjBrV,EAAU,KAdC,EAeXA,EAAU,KAfC,EAgBXA,EAAU,KAhBC,EAiBXA,EAAU,KAjBC,EAmBJ/H,IACT,CAEA,aAAO+O,CAAOqU,EAAcnT,EAAiB1C,EAAatH,GACxD,MAAMod,EAAWD,EAAIlgB,MACfogB,EAAU/V,EAAGrK,MACbqgB,EAActT,EAAO/M,MACrBqU,EAAWtR,EAAI/C,MACfsgB,EAAKH,EAAS,GACdI,EAAKJ,EAAS,GACdK,EAAKL,EAAS,GACdM,EAAKL,EAAQ,GACbM,EAAKN,EAAQ,GACbO,EAAKP,EAAQ,GAInB,IAAIQ,EAAIC,EAAIhH,EAAIiH,EAAIC,EAAIjH,EAAIkH,EAAIC,EAAIlH,EAAI5b,EAoDxC,OAlDA6iB,EAAKV,EALMD,EAAY,GAMvBY,EAAKV,EALMF,EAAY,GAMvBtG,EAAKyG,EALMH,EAAY,GAMvBliB,EAASoD,KAAKkD,MAAMuc,EAAIC,EAAIlH,GACxB5b,EAAS,IACXA,EAAS,EAAIoD,KAAKkD,MAAMuc,EAAIC,EAAIlH,GAChCiH,GAAM7iB,EACN8iB,GAAM9iB,EACN4b,GAAM5b,GAGRyiB,EAAKF,EAAK3G,EAAK4G,EAAKM,EACpBJ,EAAKF,EAAKK,EAAKP,EAAK1G,EACpBF,EAAK4G,EAAKQ,EAAKP,EAAKM,EACpB7iB,EAASoD,KAAKkD,MAAMmc,EAAIC,EAAIhH,GACxB1b,EAAS,IACXA,EAAS,EAAIA,EACbyiB,GAAMziB,EACN0iB,GAAM1iB,EACN0b,GAAM1b,GAGR2iB,EAAKG,EAAKpH,EAAKE,EAAK8G,EACpBE,EAAKhH,EAAK6G,EAAKI,EAAKnH,EACpBC,EAAKkH,EAAKH,EAAKI,EAAKL,EACpBziB,EAASoD,KAAKkD,MAAMqc,EAAIC,EAAIjH,GACxB3b,EAAS,IACXA,EAAS,EAAIA,EACb2iB,GAAM3iB,EACN4iB,GAAM5iB,EACN2b,GAAM3b,GAGRkW,EAAU,GAAKuM,EACfvM,EAAU,GAAKwM,EACfxM,EAAU,GAAKwF,EACfxF,EAAU,GAAK,EACfA,EAAU,GAAKyM,EACfzM,EAAU,GAAK0M,EACf1M,EAAU,GAAKyF,EACfzF,EAAU,GAAK,EACfA,EAAU,GAAK2M,EACf3M,EAAU,GAAK4M,EACf5M,EAAS,IAAM0F,EACf1F,EAAS,IAAM,EACfA,EAAS,IAAMiM,EACfjM,EAAS,IAAMkM,EACflM,EAAS,IAAMmM,EACfnM,EAAS,IAAM,EAERtR,CACT,CAEA,MAAA8I,CAAOqU,EAAcnT,EAAiB1C,GACpC,OAAOwO,EAAYhN,OAAOqU,EAAKnT,EAAQ1C,EAAIvN,KAC7C,CAEA,cAAAokB,CAAeC,GACb,MAAMtc,EAAY/H,KAAKkD,MACjBohB,EAAaD,EAAMnhB,MAEnBG,EAAIihB,EAAW,GACfhhB,EAAIghB,EAAW,GACfpd,EAAIod,EAAW,GAEftR,EAAI3P,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAU,IAAMA,EAAU,IAQ9E,OANAsc,EAAM9gB,WACHF,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAW,GAAKA,EAAU,KAAOiL,GAC3E3P,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAW,GAAKA,EAAU,KAAOiL,GAC3E3P,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAU,IAAMA,EAAU,KAAOiL,GAGvEqR,CACT,CAEA,eAAAE,CAAgBF,GACd,MAAMtc,EAAY/H,KAAKkD,MACjBohB,EAAaD,EAAMnhB,MAEnBG,EAAIihB,EAAW,GACfhhB,EAAIghB,EAAW,GACfpd,EAAIod,EAAW,GACfrO,EAAIqO,EAAW,GAEftR,EAAI3P,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAU,IAAMkO,EAAIlO,EAAU,IASlF,OAPAsc,EAAM9gB,WACHF,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAW,GAAKA,EAAU,KAAOiL,GAC3E3P,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAW,GAAKA,EAAU,KAAOiL,GAC3E3P,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAU,IAAMA,EAAU,KAAOiL,GAC3E3P,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAU,IAAMA,EAAU,KAAOiL,GAGvEqR,CACT,CAEA,kBAAAG,CAAmBC,GACjB,MAAM1c,EAAY/H,KAAKkD,MACjBwhB,EAAiBD,EAAUvhB,MAE3BG,EAAIqhB,EAAe,GACnBphB,EAAIohB,EAAe,GACnBxd,EAAIwd,EAAe,GAQzB,OANAD,EAAUlhB,UACRF,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAW,GACrD1E,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAW,GACrD1E,EAAI0E,EAAU,GAAKzE,EAAIyE,EAAU,GAAKb,EAAIa,EAAU,KAG/C0c,CACT,CAEA,eAAAE,CAAgBC,GACd,MAAMC,EAAcD,EAAO1hB,MAErB4hB,EAAe9kB,KAAKsS,SAASpP,MAE7BG,EAAIwhB,EAAY,GAChBvhB,EAAIuhB,EAAY,GAChB3d,EAAI2d,EAAY,GAUtB,OARAD,EAAOrhB,UACLF,EAAIyhB,EAAa,GAAKxhB,EAAIwhB,EAAa,GAAK5d,EAAI4d,EAAc,GAC9DzhB,EAAIyhB,EAAa,GAAKxhB,EAAIwhB,EAAa,GAAK5d,EAAI4d,EAAc,GAC9DzhB,EAAIyhB,EAAa,GAAKxhB,EAAIwhB,EAAa,GAAK5d,EAAI4d,EAAa,KAG/D9kB,KAAKsS,SAEEsS,CACT,CAEA,kBAAOG,CAAYC,EAAaC,EAAgBC,EAAeC,GAC7D,OAAO,IAAIpJ,GAAcqJ,eAAeJ,EAAKC,EAAQC,EAAOC,EAC9D,CAEA,cAAAC,CAAeJ,EAAaC,EAAgBC,EAAeC,GACzD,MAAMpd,EAAY/H,KAAKkD,MACjB4I,EAAQrH,KAAK4gB,IAAc,GAAV5gB,KAAKqK,GAAW,GAAMkW,GACvCjZ,EAASD,EAAQmZ,EACjBK,EAAW,GAAKJ,EAAQC,GAmB9B,OAjBApd,EAAW,GAAKgE,EAChBhE,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK+D,EAChB/D,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAU,KAAOmd,EAAQC,GAAQG,EACjCvd,EAAU,KAAO,EACjBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAO,EAAImd,EAAQC,EAAQG,EACrCvd,EAAU,IAAM,EAET/H,IACT,CAEA,mBAAOulB,CAAapa,EAAcqD,EAAegX,EAAgBna,EAAaoa,EAAcC,GAC1F,OAAO,IAAI3J,GAAc4J,gBAAgBxa,EAAMqD,EAAOgX,EAAQna,EAAKoa,EAAMC,EAC3E,CAEA,eAAAC,CAAgBxa,EAAcqD,EAAegX,EAAgBna,EAAaoa,EAAcC,GACtF,MAAM3d,EAAY/H,KAAKkD,MAkBvB,OAjBA6E,EAAW,GAAK,GAAKyG,EAAQrD,GAC7BpD,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,GAAKsD,EAAMma,GAC3Bzd,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAU,IAAM,GAAK0d,EAAOC,GAC5B3d,EAAU,IAAM,EAChBA,EAAU,KAAOyG,EAAQrD,IAASA,EAAOqD,GACzCzG,EAAU,KAAOsD,EAAMma,IAAWA,EAASna,GAC3CtD,EAAU,KAAO2d,EAAMD,IAASA,EAAOC,GACvC3d,EAAU,IAAM,EAET/H,IACT,CAEA,cAAO4lB,CAAQza,EAAcqD,EAAegX,EAAgBna,EAAaoa,EAAcC,GACrF,OAAO,IAAI3J,GAAc8J,WAAW1a,EAAMqD,EAAOgX,EAAQna,EAAKoa,EAAMC,EACtE,CAEA,UAAAG,CAAW1a,EAAcqD,EAAegX,EAAgBna,EAAaoa,EAAcC,GACjF,MAAM3d,EAAY/H,KAAKkD,MACjB4iB,EAAW,GAAKtX,EAAQrD,GACxB4a,EAAY,GAAK1a,EAAMma,GACvBQ,EAAW,GAAKP,EAAOC,GAmB7B,OAjBA3d,EAAW,GAAY,EAAP0d,EAAWK,EAC3B/d,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,GAAY,EAAP0d,EAAWM,EAC3Bhe,EAAW,GAAK,EAChBA,EAAW,GAAK,EAChBA,EAAW,IAAMyG,EAAQrD,GAAQ2a,EACjC/d,EAAW,IAAMsD,EAAMma,GAAUO,EACjChe,EAAU,KAAO2d,EAAMD,GAAQO,EAC/Bje,EAAU,KAAO,EACjBA,EAAU,IAAM,EAChBA,EAAU,IAAM,EAChBA,EAAU,IAAM2d,EAAMD,EAAO,EAAIO,EACjCje,EAAU,IAAM,EAET/H,IACT,EAGF,IAAIimB,EAA8BlK,EAEoB,IAAIta,EAAS,CAClEK,YAAaia,EACb7Z,kBACEsE,IACAyf,EAAUzf,CAAI,ICppDjB,MAAM0f,EAAkC,IAfxC,cAA8BtW,EAClBuW,QACAC,aACAC,YAER,WAAArkB,CAAYwE,EAA0BsJ,GAClCC,MAAMvJ,EAAMsJ,GACZ9P,KAAKmmB,QAAU,IAAIhjB,aAAa,GAChCnD,KAAKomB,aAAe1jB,MAAMoN,GAASE,MAAQ,GAAG/F,KAAK,GAAGP,KAAI,IAC/C1J,KAAKmmB,QAAQG,aAExBtmB,KAAKqmB,YAAc,EACvB,GAGwDrf,GCOtDuf,EAA+B,IAbrC,MAEYC,OAER,WAAAxkB,GACIhC,KAAKwmB,OAAS,CAClB,CAEA,OAAAC,GACI,SAAUzmB,KAAKwmB,QAAQ9f,SAAS,GACpC,GCPEggB,EAAa,IAAIT,EAgTjBU,EAxQN,MACaC,WACA1jB,MACA2jB,KACAC,MAEAlP,OACAmP,YAETC,WACSC,SAET,WAAAjlB,CAAY8kB,EAAkBG,GAC1BjnB,KAAK6mB,KAAON,EAAcE,UAC1BzmB,KAAK8mB,MAAQA,GAAS,KAEtB9mB,KAAKinB,SAAWA,IAAY,EAE5BjnB,KAAKkD,MAAQ,IAAIC,aAAa,IAC9BnD,KAAK4mB,WAAa,IAAIzjB,aAAa,IAEnCnD,KAAK4X,OAAS,IAAIqO,EAAQjmB,KAAKkD,OAAOgP,cACtClS,KAAK+mB,YAAc,IAAId,EAAQjmB,KAAK4mB,YAAY1U,cAEhDlS,KAAKgnB,YAAa,CACtB,CAEA,SAAAE,CAAUtP,GACN,MAAM7P,EAAY/H,KAAKkD,MACjBgX,EAActC,EAAO1U,MAkB3B,OAjBAgX,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAa,GAAKnS,EAAW,GAC7BmS,EAAY,IAAMnS,EAAU,IAC5BmS,EAAY,IAAMnS,EAAU,IAC5BmS,EAAY,IAAMnS,EAAU,IAC5BmS,EAAY,IAAMnS,EAAU,IAC5BmS,EAAY,IAAMnS,EAAU,IAC5BmS,EAAY,IAAMnS,EAAU,IAErB6P,CACX,CAEA,SAAAqC,CAAUrC,GACN,MAAM7P,EAAY/H,KAAKkD,MACjBgX,EAActC,EAAO1U,MAkB3B,OAjBA6E,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAW,GAAKmS,EAAa,GAC7BnS,EAAU,IAAMmS,EAAY,IAC5BnS,EAAU,IAAMmS,EAAY,IAC5BnS,EAAU,IAAMmS,EAAY,IAC5BnS,EAAU,IAAMmS,EAAY,IAC5BnS,EAAU,IAAMmS,EAAY,IAC5BnS,EAAU,IAAMmS,EAAY,IAErBla,IACX,CAEA,cAAAmnB,CAAevP,GACX,MAAMwP,EAAiBpnB,KAAK4mB,WACtB1M,EAActC,EAAO1U,MAkB3B,OAjBAgX,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAa,GAAKkN,EAAgB,GAClClN,EAAY,IAAMkN,EAAe,IACjClN,EAAY,IAAMkN,EAAe,IACjClN,EAAY,IAAMkN,EAAe,IACjClN,EAAY,IAAMkN,EAAe,IACjClN,EAAY,IAAMkN,EAAe,IACjClN,EAAY,IAAMkN,EAAe,IAE1BxP,CACX,CAEA,cAAAyP,CAAezP,GACX,MAAMwP,EAAiBpnB,KAAK4mB,WACtB1M,EAActC,EAAO1U,MAkB3B,OAjBAkkB,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAgB,GAAKlN,EAAa,GAClCkN,EAAe,IAAMlN,EAAY,IACjCkN,EAAe,IAAMlN,EAAY,IACjCkN,EAAe,IAAMlN,EAAY,IACjCkN,EAAe,IAAMlN,EAAY,IACjCkN,EAAe,IAAMlN,EAAY,IACjCkN,EAAe,IAAMlN,EAAY,IAE1Bla,IACX,CAEA,QAAAyO,CAAStH,GACL,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA0V,EAAY,GAAK7Q,EAAU,GAC3B6Q,EAAY,GAAK7Q,EAAU,GAC3B6Q,EAAY,GAAK7Q,EAAU,GACpBZ,CACX,CAEA,OAAA8G,CAAQ9G,GACJ,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA0V,EAAY,IAAM7Q,EAAU,GAC5B6Q,EAAY,IAAM7Q,EAAU,GAC5B6Q,EAAY,IAAM7Q,EAAU,GACrBZ,CACX,CAEA,KAAAuG,CAAMvG,GACF,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA0V,EAAY,GAAK7Q,EAAU,GAC3B6Q,EAAY,GAAK7Q,EAAU,GAC3B6Q,EAAY,GAAK7Q,EAAU,GACpBZ,CACX,CAEA,OAAAmgB,CAAQngB,GACJ,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA0V,EAAY,IAAM7Q,EAAU,GAC5B6Q,EAAY,IAAM7Q,EAAU,GAC5B6Q,EAAY,IAAM7Q,EAAU,GACrBZ,CACX,CAEA,UAAAkH,CAAWlH,GACP,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA0V,EAAY,GAAK7Q,EAAW,GAC5B6Q,EAAY,GAAK7Q,EAAW,GAC5B6Q,EAAY,GAAK7Q,EAAU,IACpBZ,CACX,CAEA,WAAAiG,CAAYjG,GACR,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA0V,EAAY,IAAM7Q,EAAW,GAC7B6Q,EAAY,IAAM7Q,EAAW,GAC7B6Q,EAAY,IAAM7Q,EAAU,IACrBZ,CACX,CAEA,cAAA+F,CAAe/F,GACX,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA0V,EAAY,GAAK7Q,EAAU,IAC3B6Q,EAAY,GAAK7Q,EAAU,IAC3B6Q,EAAY,GAAK7Q,EAAU,IACpBZ,CACX,CAEA,cAAAib,CAAejb,GACX,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA6E,EAAU,IAAM6Q,EAAY,GAC5B7Q,EAAU,IAAM6Q,EAAY,GAC5B7Q,EAAU,IAAM6Q,EAAY,GACrB5Y,IACX,CAEA,SAAA8N,CAAU3G,GACN,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA6E,EAAU,KAAO6Q,EAAY,GAC7B7Q,EAAU,KAAO6Q,EAAY,GAC7B7Q,EAAU,KAAO6Q,EAAY,GACtB5Y,IACX,CAEA,UAAAunB,CAAWpgB,GACP,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA0V,EAAY,GAAK7Q,EAAW,GAC5B6Q,EAAY,GAAK7Q,EAAW,GAC5B6Q,EAAY,GAAK7Q,EAAU,IACpBZ,CACX,CAEA,UAAAgc,CAAWhc,GACP,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA6E,EAAW,GAAK6Q,EAAY,GAC5B7Q,EAAW,GAAK6Q,EAAY,GAC5B7Q,EAAU,IAAM6Q,EAAY,GACrB5Y,IACX,CAEA,KAAAqH,CAAMF,GACF,MAAMY,EAAY/H,KAAKkD,MACjB0V,EAAczR,EAAOjE,MAI3B,OAHA6E,EAAW,IAAM6Q,EAAY,GAC7B7Q,EAAW,IAAM6Q,EAAY,GAC7B7Q,EAAU,KAAO6Q,EAAY,GACtB5Y,IACX,CAEA,WAAAwc,CAAY5B,GAER,OADAA,EAASX,UAAUja,KAAK4X,QACjBgD,CACX,CAEA,WAAAyC,CAAYzC,GAER,OADA5a,KAAK4X,OAAOyF,YAAYzC,GACjB5a,IACX,CAEA,MAAA2Y,CAAOiC,GAIH,OAHA5a,KAAK4X,OAAOjS,KACRiV,EAASlC,WAAWgO,IAEjB1mB,IACX,CAEA,cAAAokB,CAAeC,GACX,OAAOA,CACX,CAEA,kBAAAG,CAAmBC,GACf,OAAOA,CACX,CAEA,eAAA+C,CAAgBrgB,GACZ,OAAOA,CACX,CAEA,MAAA4H,CAAOkB,EAAiB1C,GACpB,MAAMka,EAAeznB,KAAKkN,eAAegZ,EAAYzW,QAAQ,GAAG,IAGhE,OAFAzP,KAAK4X,OAAO7I,OAAO0Y,EAAcxX,EAAQ1C,GACzC2Y,EAAYvW,QAAQ,GACb3P,IACX,GChSJ,MAAM0nB,EAEO9C,OACT+C,SAIA,WAAA3lB,CAAY4iB,EAAkB+C,GAC1B3nB,KAAK4kB,OAASA,GAAU,IAAI5d,EAC5BhH,KAAK2nB,SAAWA,GAAY,CAChC,CAEA,4BAAOC,CAAsBhD,EAAiB+C,GAC1C,OAAO,IAAID,GAAYG,yBAAyBjD,EAAQ+C,EAC5D,CAEH,iCAAOG,CAA2BlD,EAAiBP,GAClD,OAAO,IAAIqD,GAAYK,8BAA8BnD,EAAQP,EAC9D,CAEA,yBAAO2D,CAAmBpjB,EAAYC,EAAYme,GAC3C,OAAO,IAAI0E,GAAYO,sBAAsBrjB,EAAGC,EAAGme,EACvD,CAEA,IAAArf,CAAKukB,GAGD,OAFAloB,KAAK4kB,OAAOjhB,KAAKukB,EAAMtD,QACvB5kB,KAAK2nB,SAAWO,EAAMP,SACf3nB,IACX,CAEA,GAAA8C,CAAIO,EAAWC,EAAW4D,EAAWygB,GAIjC,OAHA3nB,KAAK4kB,OAAOrhB,UAAUF,EAAGC,EAAG4D,GAC5BlH,KAAK2nB,SAAWA,EAET3nB,IACX,CAEA,wBAAA6nB,CAAyBjD,EAAiB+C,GAItC,OAHA3nB,KAAK4kB,OAAOjhB,KAAKihB,GACjB5kB,KAAK2nB,SAAWA,EAET3nB,IACX,CAEH,6BAAA+nB,CAA8BnD,EAAiBP,GAIxC,OAHNrkB,KAAK4kB,OAAOjhB,KAAKihB,GACX5kB,KAAK2nB,UAAYtD,EAAMvf,IAAI9E,KAAK4kB,QAEzB5kB,IACd,CAEA,qBAAAioB,CAAsBE,EAAiBC,EAAiBC,GACjD,MAAMzD,EAASyD,EAAOzkB,SACfmD,GAAQmf,EAAYzW,QAAQ,GAKzC,OAJM1I,EAAKpD,KAAKwkB,GACVvD,EAAO1gB,IAAIkkB,GAAQzjB,MAAMoC,EAAK7C,IAAIkkB,IAAS/iB,YAC3CrF,KAAK+nB,8BAA8BnD,EAAQuD,GAC3CjC,EAAYvW,QAAQ,GACnB3P,IACL,CAEH,eAAAsoB,CAAgBjE,GACf,OAAOrkB,KAAK4kB,OAAO9f,IAAIuf,GAASrkB,KAAK2nB,QACtC,CAEG,UAAAY,GACI,MAAMC,EAAsB,EAAMxoB,KAAK4kB,OAAOvjB,SAGpD,OAFMrB,KAAK4kB,OAAOvd,MAAMmhB,GACxBxoB,KAAK2nB,UAAYa,EACVxoB,IACR,CAEG,mBAAOyoB,CAAa7jB,EAAUC,EAAUme,EAAU0F,GAC9C,MAAO9D,OAAQ+D,EAAShB,SAAUiB,GAAahkB,GACxCggB,OAAQiE,EAASlB,SAAUmB,GAAajkB,GACxC+f,OAAQmE,EAASpB,SAAUqB,GAAahG,EAC/C0F,EAAO/kB,KAAKklB,GAASlkB,MAAMokB,GAC3B,MAAME,GAAKN,EAAQ7jB,IAAI4jB,IAChBQ,EAAKC,EAAKC,GAAOV,EAAOrhB,MAAMuhB,GAAW1lB,MAChDwlB,EAAO/kB,KAAKolB,GAASpkB,MAAMgkB,GAC3B,MAAOU,EAAKC,EAAKC,GAAOb,EAAOrhB,MAAMyhB,GAAW5lB,MAChDwlB,EAAO/kB,KAAKglB,GAAShkB,MAAMkkB,GAC3B,MAAOW,EAAKC,EAAKC,GAAOhB,EAAOrhB,MAAM2hB,GAAW9lB,MAMhD,OALAwlB,EAAOnlB,WACJ2lB,EAAMG,EAAMG,GAAOP,GACnBE,EAAMG,EAAMG,GAAOR,GACnBG,EAAMG,EAAMG,GAAOT,GAEfP,CACX,EAGJ,IAAIiB,EAA0BjC,EACoB,IAAIjmB,EAAS,CAC9DK,YAAa4lB,EACbxlB,kBACEsE,IACAmjB,EAAQnjB,CAAI,IAJf,MCpHMojB,EAAa,IAAI5iB,EA8BvB,MAAM6iB,EACOC,UACAC,SACAC,SACAC,YACAC,UACAC,WACAC,QAET,WAAApoB,GACFhC,KAAK8pB,UAAY,IAAIH,EACf3pB,KAAK+pB,SAAW,IAAIJ,EACpB3pB,KAAKgqB,SAAW,IAAIL,EACpB3pB,KAAKiqB,YAAc,IAAIN,EACvB3pB,KAAKkqB,UAAY,IAAIP,EACrB3pB,KAAKmqB,WAAa,IAAIR,EACtB3pB,KAAKoqB,QAAU,IAAI1nB,MAAM,GAAGuH,KAAK,GAAGP,KAAI2gB,GAAK,IAAIrjB,GACrD,CAEA,GAAAlE,CACIgnB,EAAkBC,EAClBC,EAAiBC,EACjBC,EAAkBC,GAClB,MAAOL,UAAWQ,EAAYP,SAAUQ,EAAWN,YAAaO,EAAcR,SAAUS,EAAWP,UAAWQ,EAAYP,WAAYQ,GAAe3qB,KAO3J,OANAsqB,EAAW3mB,KAAKmmB,GAChBS,EAAU5mB,KAAKomB,GACTU,EAAU9mB,KAAKqmB,GACfQ,EAAa7mB,KAAKsmB,GAClBS,EAAW/mB,KAAKumB,GAChBS,EAAYhnB,KAAKwmB,GAChBnqB,IACR,CAEG,IAAA2D,CAAKinB,GACD,MAAM,UAACd,EAAS,SAAEC,EAAQ,YAAEE,EAAW,SAAED,EAAQ,UAAEE,EAAS,WAAEC,GAAcS,EAS5E,OARA5qB,KAAK8C,IACDgnB,EACAC,EACAC,EACAC,EACAC,EACAC,GAEGnqB,IACX,CAEH,KAAA4D,GACC,OAAO,IAAIimB,GAAclmB,KAAK3D,KAC5B,CAEH,aAAA6qB,CAAcjT,GACP,MAAM,UAACkS,EAAS,SAAEC,EAAQ,YAAEE,EAAW,SAAED,EAAQ,UAAEE,EAAS,WAAEC,EAAU,QAAEC,GAAWpqB,MAC9E8qB,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAKla,EAAKE,EAAKC,EAAK2K,EAAKqP,GAAO7T,EAAO1U,MAiB5F,OAhBMinB,EAAWrnB,IAAImoB,EAAKH,EAAIO,EAAKH,EAAI5Z,EAAMga,EAAIG,EAAMja,GAAK+W,aACtD2B,EAAUpnB,IAAImoB,EAAKH,EAAIO,EAAKH,EAAI5Z,EAAMga,EAAIG,EAAMja,GAAK+W,aACrD0B,EAAYnnB,IAAImoB,EAAKF,EAAIM,EAAKF,EAAI7Z,EAAMia,EAAIE,EAAMha,GAAK8W,aACvDyB,EAASlnB,IAAImoB,EAAKF,EAAIM,EAAKF,EAAI7Z,EAAMia,EAAIE,EAAMha,GAAK8W,aACpDwB,EAASjnB,IAAImoB,EAAKD,EAAIK,EAAKD,EAAI9Z,EAAMka,EAAKC,EAAMrP,GAAKmM,aACrDuB,EAAUhnB,IAAImoB,EAAKD,EAAIK,EAAKD,EAAI9Z,EAAMka,EAAKC,EAAMrP,GAAKmM,aAEtDoB,EAAMlB,aAAayB,EAAWD,EAAaH,EAAWM,EAAQ,IAC9DT,EAAMlB,aAAayB,EAAWF,EAAUF,EAAWM,EAAQ,IAC3DT,EAAMlB,aAAa0B,EAAYF,EAAaH,EAAWM,EAAQ,IAC/DT,EAAMlB,aAAa0B,EAAYH,EAAUF,EAAWM,EAAQ,IAC5DT,EAAMlB,aAAayB,EAAWD,EAAaF,EAAUK,EAAQ,IAC7DT,EAAMlB,aAAayB,EAAWF,EAAUD,EAAUK,EAAQ,IAC1DT,EAAMlB,aAAa0B,EAAYF,EAAaF,EAAUK,EAAQ,IAC9DT,EAAMlB,aAAa0B,EAAYH,EAAUD,EAAUK,EAAQ,IAE1DpqB,IACL,CAEH,gBAAA0rB,CAAiBC,GACV,MAAM,UAAC7B,EAAS,SAAEC,EAAQ,YAAEE,EAAW,SAAED,EAAQ,UAAEE,EAAS,WAAEC,GAAcnqB,MACtE,OAAC8H,EAAM,OAAE8jB,GAAUD,EACzB,OAAO7jB,EAAOhD,IAAIglB,EAAUlF,QAAUkF,EAAUnC,SAAWiE,GAAU,GACjE9jB,EAAOhD,IAAIilB,EAASnF,QAAUmF,EAASpC,SAAWiE,GAAU,GAC5D9jB,EAAOhD,IAAImlB,EAAYrF,QAAUqF,EAAYtC,SAAWiE,GAAU,GAClE9jB,EAAOhD,IAAIklB,EAASpF,QAAUoF,EAASrC,SAAWiE,GAAU,GAC5D9jB,EAAOhD,IAAIolB,EAAUtF,QAAUsF,EAAUvC,SAAWiE,GAAU,GAC9D9jB,EAAOhD,IAAIqlB,EAAWvF,QAAUuF,EAAWxC,SAAWiE,GAAU,CAC3E,CAEA,aAAAC,CAAcC,GACP,MAAOvnB,IAAKwnB,EAAQznB,IAAK0nB,GAAUF,GAC7B,UAAChC,EAAS,SAAEC,EAAQ,YAAEE,EAAW,SAAED,EAAQ,UAAEE,EAAS,WAAEC,GAAcnqB,KAgClF,OA9BU8pB,EAAUxB,gBAAgBsB,EAAWrmB,UACjCumB,EAAUlF,OAAOvhB,EAAI,EAAI0oB,EAAO1oB,EAAI2oB,EAAO3oB,EAC3CymB,EAAUlF,OAAOthB,EAAI,EAAIyoB,EAAOzoB,EAAI0oB,EAAO1oB,EAC3CwmB,EAAUlF,OAAO1d,EAAI,EAAI6kB,EAAO7kB,EAAI8kB,EAAO9kB,KACzC,GACN6iB,EAASzB,gBAAgBsB,EAAWrmB,UAChCwmB,EAASnF,OAAOvhB,EAAI,EAAI0oB,EAAO1oB,EAAI2oB,EAAO3oB,EAC1C0mB,EAASnF,OAAOthB,EAAI,EAAIyoB,EAAOzoB,EAAI0oB,EAAO1oB,EAC1CymB,EAASnF,OAAO1d,EAAI,EAAI6kB,EAAO7kB,EAAI8kB,EAAO9kB,KACxC,GACN+iB,EAAY3B,gBAAgBsB,EAAWrmB,UACnC0mB,EAAYrF,OAAOvhB,EAAI,EAAI0oB,EAAO1oB,EAAI2oB,EAAO3oB,EAC7C4mB,EAAYrF,OAAOthB,EAAI,EAAIyoB,EAAOzoB,EAAI0oB,EAAO1oB,EAC7C2mB,EAAYrF,OAAO1d,EAAI,EAAI6kB,EAAO7kB,EAAI8kB,EAAO9kB,KAC3C,GACN8iB,EAAS1B,gBAAgBsB,EAAWrmB,UAChCymB,EAASpF,OAAOvhB,EAAI,EAAI0oB,EAAO1oB,EAAI2oB,EAAO3oB,EAC1C2mB,EAASpF,OAAOthB,EAAI,EAAIyoB,EAAOzoB,EAAI0oB,EAAO1oB,EAC1C0mB,EAASpF,OAAO1d,EAAI,EAAI6kB,EAAO7kB,EAAI8kB,EAAO9kB,KACxC,GACNgjB,EAAU5B,gBAAgBsB,EAAWrmB,UACjC2mB,EAAUtF,OAAOvhB,EAAI,EAAI0oB,EAAO1oB,EAAI2oB,EAAO3oB,EAC3C6mB,EAAUtF,OAAOthB,EAAI,EAAIyoB,EAAOzoB,EAAI0oB,EAAO1oB,EAC3C4mB,EAAUtF,OAAO1d,EAAI,EAAI6kB,EAAO7kB,EAAI8kB,EAAO9kB,KACzC,GACNijB,EAAW7B,gBAAgBsB,EAAWrmB,UAClC4mB,EAAWvF,OAAOvhB,EAAI,EAAI0oB,EAAO1oB,EAAI2oB,EAAO3oB,EAC5C8mB,EAAWvF,OAAOthB,EAAI,EAAIyoB,EAAOzoB,EAAI0oB,EAAO1oB,EAC5C6mB,EAAWvF,OAAO1d,EAAI,EAAI6kB,EAAO7kB,EAAI8kB,EAAO9kB,KAC1C,CAEjB,CAEG,QAAA+kB,CAASC,GACL,MAAM,QAAC9B,GAAWpqB,KACZmsB,EAAiB/B,EAAQ,GACzBgC,EAAchC,EAAQ,GACtBiC,EAAkBjC,EAAQ,GAC1BkC,EAAelC,EAAQ,GACvBmC,EAAgBnC,EAAQ,GACxBoC,EAAapC,EAAQ,GACrBqC,EAAiBrC,EAAQ,GACzBsC,EAActC,EAAQ,GAO5B,OANA8B,EAAM,GAAGvoB,KAAK6oB,GAAYtoB,IAAIkoB,GAC9BF,EAAM,GAAGvoB,KAAK+oB,GAAaxoB,IAAIooB,GAC/BJ,EAAM,GAAGvoB,KAAK4oB,GAAeroB,IAAIioB,GACjCD,EAAM,GAAGvoB,KAAK8oB,GAAgBvoB,IAAImoB,GAClCH,EAAM,GAAGvoB,KAAK+oB,GAAaxoB,IAAIsoB,GAC/BN,EAAM,GAAGvoB,KAAK2oB,GAAcpoB,IAAImoB,GACzBH,CACX,CAEA,UAAAS,CAAWvC,GACP,MAAOA,QAASwC,GAAY5sB,KAS5B,OARAoqB,EAAQ,GAAGzmB,KAAKipB,EAAS,IACzBxC,EAAQ,GAAGzmB,KAAKipB,EAAS,IACzBxC,EAAQ,GAAGzmB,KAAKipB,EAAS,IACzBxC,EAAQ,GAAGzmB,KAAKipB,EAAS,IACzBxC,EAAQ,GAAGzmB,KAAKipB,EAAS,IACzBxC,EAAQ,GAAGzmB,KAAKipB,EAAS,IACzBxC,EAAQ,GAAGzmB,KAAKipB,EAAS,IACzBxC,EAAQ,GAAGzmB,KAAKipB,EAAS,IAClBxC,CACX,CAEH,aAAAyC,CAAcxI,GACP,MAAM,UAACyF,EAAS,SAAEC,EAAQ,YAAEE,EAAW,SAAED,EAAQ,UAAEE,EAAS,WAAEC,GAAcnqB,KAC5E,OAAO8pB,EAAUxB,gBAAgBjE,IAAU,GACvC0F,EAASzB,gBAAgBjE,IAAU,GACnC4F,EAAY3B,gBAAgBjE,IAAU,GACtC2F,EAAS1B,gBAAgBjE,IAAU,GACnC6F,EAAU5B,gBAAgBjE,IAAU,GACpC8F,EAAW7B,gBAAgBjE,IAAU,CAC7C,EAGJ,IAAIuG,EAA8Bf,EChMlC,MAAMiD,EACO/f,UAET,WAAA/K,GACIhC,KAAK+M,UAAY,IAAI4Z,EAAU3mB,KACnC,ECgDJ,IC5DY+sB,EAYAC,ECJAC,EAUAC,EAUAC,EAMAC,EF0BRC,EAnCJ,cAAyBP,EACZjG,KACAyG,WACA1H,QAIT,WAAA5jB,CAAYsrB,GACVvd,QACA/P,KAAK6mB,KAAON,EAAcE,UAC1BzmB,KAAKstB,WAAaA,GAAc,IAAIrH,EACpCjmB,KAAK4lB,SAAU,IAAIgF,GAAUC,cAAc7qB,KAAKutB,eAClD,CAEA,QAAAC,CAASrmB,GACP,OAAOnH,KAAK+M,UAAUK,YAAYjG,EACpC,CAEA,QAAIsmB,GACF,OAAOztB,KAAK+M,UAAU6K,OAAOhU,QAAQ0O,QACvC,CAEA,kBAAIib,GACF,OAAOvtB,KAAKstB,WAAW1pB,QAAQ+B,KAAK3F,KAAKytB,KAC3C,CAEA,SAAAC,CAAUC,GACR,OAAO,CACT,CAEA,aAAAC,GACE5tB,KAAK4lB,QAAQiF,cAAc7qB,KAAKutB,eAClC,GGvBAM,EAtBJ,cAAoCR,EAEhC,WAAArrB,CACIgjB,EACAC,EACAC,EACAC,GACApV,MAAMkW,EAAQlB,YAAYC,EAAKC,EAAQC,EAAOC,GAClD,CAEA,SAAA5hB,CACIyhB,EACAC,EACAC,EACAC,GAIA,OAFAnlB,KAAKstB,WAAWlI,eAAeJ,EAAKC,EAAQC,EAAOC,GACnDnlB,KAAK4tB,gBACE5tB,IACX,IF/BJ,SAAY+sB,GACR,qCACA,uCACA,qCACA,qCACA,uCACA,qCACA,qCACA,uCACA,oCACH,CAVD,CAAYA,IAAAA,EAAe,KAY3B,SAAYC,GACR,uCACA,uDACA,iEACA,0CACH,CALD,CAAYA,IAAAA,EAAY,KCJxB,SAAYC,GACR,uBACA,qBACA,6BACA,+BACA,6BACA,uCACA,kCACH,CARD,CAAYA,IAAAA,EAAQ,KAUpB,SAAYC,GACR,sBACA,wCACA,wBACA,0CACA,oBACA,sCACA,uBACH,CARD,CAAYA,IAAAA,EAAiB,KAU7B,SAAYC,GACR,cACA,cACA,aACH,CAJD,CAAYA,IAAAA,EAAiB,KAM7B,SAAYC,GACR,wCACA,0CACA,qCACH,CAJD,CAAYA,IAAAA,EAAoB,KAyFhC,MAAMU,EAEF,+BAAOC,CAAyB/iB,GAC5B,OAAQA,GACJ,KAAKmiB,EAAkBa,KACnB,OAAO,EACX,KAAKb,EAAkBc,KACnB,OAAO,EACX,KAAKd,EAAkBe,KACnB,OAAO,EAEnB,CAEA,uCAAOC,CAAiCnjB,GAIpC,OAAQA,GACJ,KAAKkiB,EAAkBkB,MACnB,OAAOjrB,aACX,KAAK+pB,EAAkBmB,KAEvB,KAAKnB,EAAkBoB,cACnB,OAAOC,WACX,KAAKrB,EAAkBsB,MACnB,OAAOC,WACX,KAAKvB,EAAkBwB,eACnB,OAAOC,YACX,KAAKzB,EAAkB0B,IACnB,OAAOC,WACX,KAAK3B,EAAkB4B,aACnB,OAAOne,YAEnB,CAEA,4BAAOoe,CAAsB7rB,GACzB,OAAIA,aAAiBC,aACV+pB,EAAkBkB,MAEpBlrB,aAAiB2rB,WACf3B,EAAkB0B,IAEpB1rB,aAAiByN,YACfuc,EAAkB4B,aAEpB5rB,aAAiBurB,WACfvB,EAAkBsB,MAEpBtrB,aAAiByrB,YACfzB,EAAkBwB,eAEpBxrB,aAAiB8rB,UACf9B,EAAkBmB,KAGlBnB,EAAkBoB,aAEjC,CAEA,qCAAOW,CAA+BC,EAA4BC,GAC9D,MAAMC,EAAiBF,EAAGG,eAC1B,GAAuB,OAAnBD,EACA,OAAO,KAEX,MAAME,EAAQvC,EAAgBwC,YACxBtf,EAASif,EAAGM,sBACZ,WAACC,GAAcN,EACfO,EAAY1vB,KAAK2vB,0BAA0BR,GAKjD,OAHAD,EAAGU,WAAW3f,EAAQmf,GACtBF,EAAGW,WAAW5f,EAAQkf,EAASG,GAExB,CACHF,iBACAnf,SACAqf,QACAG,aACAC,YAER,CAEA,8BAAOI,CAAwBZ,EAA4Ba,EAAkBC,EAAuDV,EAAyBW,GACzJ,MAAM,gBAACC,GAAmBH,EAEpBI,EAAgBpD,EAAgBwC,YAEtCU,EAAcA,IADc,EAE5BX,EAAQA,GAASa,EAEjB,MAAMC,EAAoBJ,EAAatwB,OAAO2wB,QAAQL,GAAc,KAC9DP,EAAoC,OAAtBW,EAA8BA,EAAkB3mB,QAChE,CAACgmB,GAAapF,EAAGiG,KAAeb,GAAca,EAAUptB,OAAOusB,YAAca,EAAUb,YAAc,IAAI,GACzG,EAEEL,EAAiBF,EAAGG,eAC1B,GAAuB,OAAnBD,EACA,OAAO,KAGX,MAAMnf,EAASif,EAAGqB,aAClBrB,EAAGU,WAAW3f,EAAQmf,GACtB,MAAMoB,EAAa,IAAIjgB,YAAYkf,GACnC,IAAIgB,EAAa,EAEjB,MAAMC,EAAoD,CAAC,EAC3D,GAA0B,OAAtBN,EAA4B,CAE5BA,EAAkBO,SAAQ,EAAEtG,EAAGiG,MAC3B,MAAM,MAACptB,EAAK,cAAE0tB,EAAa,WAAEnB,GAAca,EAC3C,KAAKptB,GAAW0tB,GAAiBnB,GAC7B,MAAM,IAAInuB,MAAM,+E,IAIxBmvB,EAAaR,EAAcG,EAAkB3mB,QACzC,CAAConB,GAASxG,EAAGiG,MACT,MAAM,SAAC3I,GAAY2I,EACnB,IAAK3I,EAAU,CACX,MAAM,MAACzkB,EAAK,KAAE8H,EAAI,cAAE4lB,GAAiBN,GAC/B,kBAAC9f,GAAqBtN,GAASlD,KAAKmuB,iCAAiCyC,GAE3E,OAAOC,EAASrgB,EADMxQ,KAAK+tB,yBAAyB/iB,E,CAGxD,OAAO6lB,CAAM,GACd,GACH,EACJ,MAAMC,EAAeb,EAAcxrB,KAAKkX,MAAM8T,EAAagB,GAAc,EACzE,IACIM,EADAC,EAAa,EAGjBZ,EAAkBO,SAAQ,EAAEM,EAAeX,MACvC,MAAM,MAACptB,EAAK,KAAE8H,GAAQslB,EACtB,IAAI,SAAC3I,GAAW,EAAK,QAAEuJ,EAAO,UAAE7rB,EAAS,cAAEurB,GAAiBN,EAC5DM,EAAgB1tB,EAAMlD,KAAK+uB,sBAAsB7rB,GAAS0tB,EAE1D,MAAM7vB,EAAWmuB,EAAGiC,kBAAkBjB,EAAiBe,GACvD,IAAkB,IAAdlwB,EAEA,YADAoP,QAAQC,KAAK,aAAa6gB,2BAI9B,MAAMG,EAAgBpxB,KAAK+tB,yBAAyB/iB,GAQpD,GAPAkmB,EAAUA,GAAW,EACrB7rB,EAAYA,IAAa,EAEzB6pB,EAAGmC,oBAAoBtwB,EAAUqwB,EAAeR,EAAevrB,EAAWorB,EAAYO,GAClFE,EAAU,GACVhC,EAAGoC,oBAAoBvwB,EAAUmwB,GAEjCvJ,EAAU,CACV,IAAKzkB,EACD,MAAM,IAAI5B,MAAM,6CAGpB,OADAyvB,EAAgB7tB,EACRkuB,GACJ,KAAK,EACDlC,EAAGqC,gBAAgBxwB,EAAUgwB,GAC7B,MACJ,KAAK,EACD7B,EAAGsC,gBAAgBzwB,EAAUgwB,GAC7B,MACJ,KAAK,EACD7B,EAAGuC,gBAAgB1wB,EAAUgwB,GAC7B,MACJ,KAAK,EACD7B,EAAGwC,gBAAgB3wB,EAAUgwB,G,KAIpC,CACD,IAAKpJ,EAAU,CACX,MAAM,MAACzkB,EAAK,KAAE8H,GAAQslB,EAChBc,EAAgBpxB,KAAK+tB,yBAAyB/iB,GACpD,IAAIykB,EAAa,EACbkC,EAAkB,EACtB,GAAI1B,EACA,GAAI/sB,EAAO,GACLsN,kBAAmBmhB,EAAiBlC,cAAcvsB,GACpD,MAGM0uB,EAAc,IAHW5xB,KAAKmuB,iCAChCnuB,KAAK+uB,sBAAsB7rB,IAEX,CAA2BstB,EAAYQ,GACrDa,EAAoBpB,EAAakB,EACvC,IAAK,IAAIhpB,EAAI,EAAGA,EAAImoB,EAAcnoB,IAAK,CACnC,IAAImpB,EAAkBnpB,EAAIyoB,EAC1BQ,EAAY9uB,IACRI,EAAMgN,MACF4hB,EACAA,EAAkBV,GAEtBzoB,EAAIkpB,E,QAKVrhB,kBAAmBmhB,GAAmB3xB,KAAKmuB,iCAAiCyC,IAC9EnB,EAAaa,EAAUb,gBAIvBvsB,KACEsN,kBAAmBmhB,EAAiBlC,cAAcvsB,GAIhC,IAHW4qB,EAA0BK,iCACrDL,EAA0BiB,sBAAsB7rB,IAEhC,CAA2BstB,EAAYQ,GAC/CluB,IAAII,OAGdsN,kBAAmBmhB,GAAmB3xB,KAAKmuB,iCAAiCyC,IAC9EnB,EAAaa,EAAUb,YAG/BiB,EAAiBO,GAAiB,CAC9BF,gBACAK,gBACAF,UACAN,gBACAjJ,WACAqJ,aACAW,kBACA3mB,OACA3F,aAEJ2rB,GAAcf,EAAc0B,EAAkBP,EAAgB3B,C,CAElEP,EAAG6C,wBAAwBhxB,E,KAKvC,OADAmuB,EAAGW,WAAW5f,EAAQugB,EAAYlB,GAC3B,CACHF,iBACAnf,SACAqf,QACAG,aACAQ,cACAQ,aACAC,mBAER,CAEA,2BAAOsB,CAAqB9C,EAA4B+C,EAA0B7uB,GAC9E,MAAM,WAAC4sB,EAAU,cAAEkC,GAAiB9uB,EAEV1D,OAAOyJ,KAAK6mB,GACpBW,SAASwB,IACvB,MAAM,gBAACC,GAAmBH,EACpBI,EAAiBD,EAAgBE,MAClCD,GAAmBF,KAAmBE,EAAe3B,mBAE1D,GAAI2B,EAAgB,CAChB,MAAM,eAACjD,EAAc,OAAEnf,EAAM,WAAEwgB,EAAU,YAAER,EAAW,iBAAES,GAAoB2B,EAC1CnD,EAAGqD,aAAarD,EAAGsD,wBACnBpD,GAC9BF,EAAGU,WAAW3f,EAAQmf,GAE1B,MAAMkB,EAAYN,EAAWmC,IACvB,WAACnB,EAAU,cAAEI,GAAiBV,EAAiByB,GACrD,IAAI,MAACjvB,EAAK,UAAEuvB,EAAS,UAAEC,GAAapC,EACpC,MAAM,OAACjvB,GAAU6B,EACjB,IAAIyvB,EAAY3B,EAChB,GAAIf,EAAa,EACTwC,GAAaC,KACbxvB,EAAQA,EAAMgN,MAAMuiB,GAAa,EAAGC,IAExC,MAAME,EAAS3C,EAAcxrB,KAAKkX,MAAMta,EAAS+vB,GAAiB,EAClE,IAAIyB,EAAc,EAClB,IAAK,IAAIlqB,EAAI,EAAGA,EAAIiqB,EAAQjqB,IACxBumB,EAAG4D,cAAc7iB,EAAQ0iB,EAAWzvB,EAAO2vB,EAAazB,GACxDyB,GAAezB,EACfuB,GAAalC,C,MAIjBgC,EAAYA,GAAa,EACzBC,EAAYA,GAAarxB,EACzB6tB,EAAG4D,cAAc7iB,EAAQ,EAAG/M,EAAOuvB,EAAWC,E,IAI9D,CAEA,+BAAOK,CAAyB7D,EAA4B8D,EAAsDC,EAAuBC,EAAwBT,EAAoBpxB,GACjL,MAAM,eAAC+tB,EAAc,OAAEnf,GAAU+iB,EACjC9D,EAAGU,WAAW3f,EAAQmf,GACtB8D,EAAgBA,GAAiB,EACjCT,EAAYA,GAAa,EACzBvD,EAAG4D,cAAc7iB,EAAQijB,EAAeD,EAAMR,EAAWpxB,EAC7D,CAEA,wBAAO8xB,CAAkBjE,EAA4Ba,EAAkBkC,GACnE,MAAM,iBAACvB,EAAgB,cAAE0C,EAAa,eAAEC,EAAgBC,cAAeC,GAAmCtB,EAEpGuB,EAAsBtE,EAAGiE,oBAC/B,GAA4B,OAAxBK,EACA,OAAO,KAEXtE,EAAGuE,gBAAgBD,GAEnB,MAAMpD,EAAoBM,EAAmBhxB,OAAO2wB,QAAQK,GAAoB,IAE1E,gBAACR,GAAmBH,EACpBqC,EAAkD,GACxD,GAAIgB,EACAA,EAAczC,SAAQ,CAAC+C,EAAU/qB,KAC7B,MAAMqnB,EAAatwB,OAAOi0B,YAAYvD,EAAkBwD,QACpD,EAAEvJ,EAAGwJ,KAAiBA,EAAYb,QAAUrqB,KAEhD,IAAIqqB,EAAmC,KACvC,QAAiBlqB,IAAb4qB,GACA,GAAI,mBAAoBA,EAAU,CAC9B,MAAM,OAACzjB,EAAM,eAAEmf,GAAkBsE,EACjCV,EAASU,EACTxE,EAAGU,WAAW3f,EAAQmf,GACtB,MAAM,WAACqB,EAAU,iBAAEC,GAAoBsC,EACvCtzB,OAAO2wB,QAAQK,GAAkBC,SAAQ,EAAEM,EAAe6C,MACtD,MAAM,cAAC1C,EAAa,cAAER,EAAa,UAAEvrB,EAAS,WAAE2rB,EAAU,QAAEE,EAAO,SAAEvJ,EAAQ,cAAEoJ,GAAiB+C,EAC1F/yB,EAAWmuB,EAAGiC,kBAAkBjB,EAAiBe,GACvD,GAAIlwB,GAAY,EAKZ,GAJAmuB,EAAGmC,oBAAoBtwB,EAAUqwB,EAAeR,EAAevrB,EAAWorB,EAAYO,GAClFE,EAAU,GACVhC,EAAGoC,oBAAoBvwB,EAAUmwB,GAEjCvJ,GAAYoJ,EACZ,OAAQK,GACJ,KAAK,EACDlC,EAAGqC,gBAAgBxwB,EAAUgwB,GAC7B,MACJ,KAAK,EACD7B,EAAGsC,gBAAgBzwB,EAAUgwB,GAC7B,MACJ,KAAK,EACD7B,EAAGuC,gBAAgB1wB,EAAUgwB,GAC7B,MACJ,KAAK,EACD7B,EAAGwC,gBAAgB3wB,EAAUgwB,QAKrC7B,EAAG6C,wBAAwBhxB,E,SAKtC,GAAIivB,EAAY,CACjB,MAAM,MAACV,EAAK,YAAEW,GAAeyD,EAC7BV,EAAShzB,KAAK8vB,wBAAwBZ,EAAIa,EAASC,EAAYV,EAAOW,E,OAGrED,IACLgD,EAAShzB,KAAK8vB,wBAAwBZ,EAAIa,EAASC,IAEvD,GAAe,OAAXgD,EACA,OAAO,KAEXZ,EAAgB/hB,KAAK2iB,EAAO,SAG/B,GAAItC,EAAkB,CACvB,IAAIsC,EAAmC,KAEvC,GADAA,EAAShzB,KAAK8vB,wBAAwBZ,EAAIa,EAASW,GACpC,OAAXsC,EACA,OAAO,KAEXZ,EAAgB/hB,KAAK2iB,E,CAGzB,IAAIM,EACJ,QAAwCxqB,IAApCyqB,EACA,GAAI,mBAAoBA,EAAiC,CACrD,MAAM,OAACtjB,EAAM,eAAEmf,GAAkBmE,EACjCD,EAAgBC,EAChBrE,EAAGU,WAAW3f,EAAQmf,E,MAEjBiE,IACLC,EAAgBtzB,KAAKivB,+BAA+BC,EAAImE,SAGvDA,IACLC,EAAgBtzB,KAAKivB,+BAA+BC,EAAImE,IAE5D,OAAsB,OAAlBC,EACO,KAGJ,CACHlB,kBACAkB,gBACAvD,UACAyD,sBAER,CAEA,wBAAOO,CAAkB7E,EAA4B+C,GACjD,MAAM,oBAACuB,GAAuBvB,EAC1B/C,EAAG8E,cAAcR,IACjBtE,EAAG6E,kBAAkBP,EAE7B,CAEA,gCAAO7D,CAA0BR,GAC7B,OAAIA,aAAmBZ,WACZnB,EAAqBkB,cAEvBa,aAAmBR,YACjBvB,EAAqBsB,eAGrBtB,EAAqB0B,YAEpC,EElTJ,IC3LKmF,ED2LDC,EAhMJ,MACIlB,OACAhD,WAQAb,QACAc,YACAY,OAQA,WAAA7uB,CACIguB,EAAsD,CAAC,EACvDb,EACAc,GAEA,GAAID,EAAY,CACZ,MAAMI,EAAoB1wB,OAAO2wB,QAAQL,GACnCmE,EAAmB/D,EAAkB3mB,QACvC,CAACgmB,GAAapF,EAAGiG,KAAeb,EAAaa,EAAUptB,MAAMusB,YAAY,GAEvEuD,EAAS,IAAIziB,YAAY4jB,GACzBtD,EAAS,EAAgBT,EAAkB3mB,QAC7C,CAAConB,GAASxG,EAAGiG,MACT,MAAM,MAACptB,EAAK,KAAE8H,GAAQslB,EACtB,OAAOO,EAAS3tB,EAAMsN,kBAAoBsd,EAA0BC,yBAAyB/iB,EAAK,GACnG,GACH,EACE8lB,EAAersB,KAAKkX,MAAMwY,EAAmBtD,GAEnD7wB,KAAKgwB,WAAa,CAAC,EACnBhwB,KAAKmvB,QAAUA,EACfnvB,KAAKiwB,YAAcA,IAAe,EAClCjwB,KAAK6wB,OAASA,EACd7wB,KAAKgzB,OAASA,EAEd,IAAIhC,EAAa,EACbf,EACAvwB,OAAO2wB,QAAQL,GAAYW,SAAQ,EAAE3tB,EAAMstB,MACvC,MAAM,MAACptB,EAAK,KAAE8H,EAAI,SAAE2c,EAAQ,UAAEtiB,GAAairB,EACrCM,EAAgB9C,EAA0BiB,sBAAsB7rB,GAChEkuB,EAAgBtD,EAA0BC,yBAAyB/iB,GACnEopB,EAAyBtG,EAA0BK,iCACrDL,EAA0BiB,sBAAsB7rB,KAE9C,WAACusB,EAAU,kBAAEjf,GAAqBtN,EAClC0uB,EAAc,IAAIwC,EAAuBpB,EAAQhC,GACjDa,EAAoBhB,EAASrgB,EACnC,IAAK,IAAI7H,EAAI,EAAGA,EAAImoB,EAAcnoB,IAAK,CACnC,IAAImpB,EAAkBnpB,EAAIyoB,EAC1BQ,EAAY9uB,IACRI,EAAMgN,MACF4hB,EACAA,EAAkBV,GAEtBzoB,EAAIkpB,E,CAGZ7xB,KAAKgwB,WAAWhtB,GAAQ,CACpBgI,OACAgmB,aACAvB,aACAmB,gBACAjJ,WACAtiB,aAEJ2rB,GAAcI,EAAgB5gB,CAAiB,IAInD9Q,OAAO2wB,QAAQL,GAAYW,SAAQ,EAAE3tB,EAAMstB,MACvC,MAAM,MAACptB,EAAK,KAAE8H,GAAQslB,GAChB,WAACb,GAAcvsB,EACf0tB,EAAgB9C,EAA0BiB,sBAAsB7rB,GAIlD,IAHW4qB,EAA0BK,iCACrDL,EAA0BiB,sBAAsB7rB,IAEhC,CAA2B8vB,EAAQhC,GAC3CluB,IAAII,GAChBlD,KAAKgwB,WAAWhtB,GAAQ,CACpBguB,aACAvB,aACAzkB,OACA4lB,iBAEJI,GAAcvB,CAAU,G,MAKhCzvB,KAAKgwB,WAAa,CAAC,EACnBhwB,KAAKmvB,aAAUrmB,EACf9I,KAAKiwB,aAAc,EACnBjwB,KAAK6wB,OAAS,EACd7wB,KAAKgzB,OAAS,IAAIziB,YAAY,EAEtC,CAEA,MAAA8jB,GACI,MAAM,WAACrE,EAAU,OAAEgD,EAAM,OAAEnC,EAAM,YAAEZ,EAAW,QAAEd,GAAWnvB,KACrD6vB,EAAa,IAAItB,WAAWyE,IAC3B3xB,OAAQizB,GAAgBzE,EACzB0E,EAAchG,WAAW5rB,KAAKwsB,GAAW,IACzCqF,EAAgBrF,GAAS9tB,QAAU,EACnCozB,GAAa,IAAIC,aAAcC,OAAOC,KAAKC,UAAU,CAAC7E,aAAYa,SAAQZ,kBACzE5uB,OAAQyzB,GAAgBL,EAEzBM,EAAe,IAAIxG,WAAW,EAAIuG,EAAeN,EAAgBF,IAChEtB,OAAQgC,GAAsBD,EAC/BE,EAAqB,IAAItG,YAAYqG,EAAoB,EAAG,GAC5DE,EAAuBD,EAAmB5zB,QAAUstB,YAAYne,kBAAoB+d,WAAW/d,mBAOrG,OANAykB,EAAmB,GAAKH,EACxBG,EAAmB,GAAKT,EACxBO,EAAajyB,IAAI2xB,EAAYS,GAC7BH,EAAajyB,IAAIyxB,EAAaW,EAAuBJ,GACrDC,EAAajyB,IAAI+sB,EAAYqF,EAAuBJ,EAAeN,GAE5D,IAAIW,KAAK,CAACJ,GAAe,CAAC/pB,KAAM,4BAC3C,CAEA,qBAAaoqB,CAASC,GAClB,MAAMC,QAAoBD,EAAKC,cACzBL,EAAqB,IAAItG,YAAY2G,EAAa,EAAG,IACpD7F,WAAY8F,GAA4BN,EACzCH,EAAeG,EAAmB,GAClCT,EAAgBS,EAAmB,GACnCR,EAAa,IAAIlG,WAAW+G,EAAaC,EAA0BT,GACnEU,EAAoBhB,EAAgB/vB,KAAK+K,IAAI,EAAG,GAAM+e,WAAciG,EAAgB/vB,KAAK+K,IAAI,EAAG,IAAOmf,YAAche,YACrHwe,EAAU,IAAIqG,EAAiBF,EAAYplB,MAAMqlB,EAA2BT,EAAevG,WAAW/d,kBAAmBgkB,EAAgBgB,EAAiBhlB,oBAC1JwiB,EAASsC,EAAYplB,MAAMqlB,GAA4Bf,EAAgBM,GAAgBvG,WAAW/d,mBAClGilB,EAAwEb,KAAKc,OAAM,IAAIC,aAAcC,OAAOnB,KAC5G,WAACzE,EAAU,YAAEC,EAAW,OAAEY,GAAU4E,EACpCI,EAAiB,IAAI3B,EAM3B,OALA2B,EAAe7C,OAASA,EACxB6C,EAAe7F,WAAaA,EAC5B6F,EAAe5F,YAAcA,EAC7B4F,EAAehF,OAASA,EACxBgF,EAAe1G,QAAUA,EAClB0G,CACX,CAEA,YAAAC,CAAa9yB,GACT,MAAM,WAACgtB,GAAchwB,KACfswB,EAAYN,EAAWhtB,GAC7B,GAAIstB,EAAW,CACX,MAAM,OAAC0C,EAAM,YAAE/C,EAAW,OAAEY,GAAU7wB,MAChC,KAACgL,EAAI,WAAEgmB,EAAU,WAAEvB,EAAU,cAAEmB,GAAiBN,EAChDyF,EAA4BjI,EAA0BK,iCAAiCyC,GAEvFvvB,EAASouB,EADSsG,EAA0BvlB,kBAE5C4gB,EAAgBtD,EAA0BC,yBAAyB/iB,IAClEykB,WAAY0E,GAAoBnB,GACjC,kBAACxiB,GAAqBulB,EACtBC,EAAiB,IAAID,EAA0B10B,GACrD,GAAI4uB,EAAa,CACb,MAAM2B,EAAc,IAAImE,EAA0B/C,EAAQhC,GACpDiF,EAAepF,EACfC,EAAersB,KAAKkX,MAAMwY,EAAmB8B,GAC7CpE,EAAoBoE,EAAezlB,EACzC,IAAK,IAAI7H,EAAI,EAAGA,EAAImoB,EAAcnoB,IAAK,CACnC,IAAIutB,EAAwBrE,EAAoBlpB,EAChDqtB,EAAelzB,IACX8uB,EAAY1hB,MACRgmB,EACAA,EAAwB9E,GAE5BA,EAAgBzoB,E,MAIvB,CACD,MAAMipB,EAAc,IAAImE,EAA0B/C,EAAQhC,EAAY3vB,GACtE20B,EAAelzB,IAAI8uB,E,CAEvB,MAAO,CACH1uB,MAAO8yB,EACPhrB,KAAMA,E,CAGd,OAAO,IACX,ICxLJ,SAAKipB,GACD,2BACA,iBACA,yBACA,0BACH,CALD,CAAKA,IAAAA,EAAkB,KAevB,MAAMkC,GAEF,SAAAC,GACI,MAAM,IAAI90B,MAAM,sBACpB,EC3DG,MAAM+0B,GACTvuB,OACA8jB,OAEA,WAAA5pB,CACI8F,EACA8jB,GAEA5rB,KAAK8H,OAASA,EACd9H,KAAK4rB,OAASA,CAClB,CAEA,SAAA7e,CAAU6K,GACN,MAAM,OAAC9P,GAAU9H,KACjB4X,EAAOwM,eAAetc,EAC1B,CAEA,aAAA+kB,CAAcxI,GACV,MAAM,OAACvc,EAAM,OAAE8jB,GAAU5rB,KACzB,OAAO8H,EAAOL,SAAS4c,GAASuH,CACpC,CAEA,UAAA0K,CAAWrkB,GACP,MAAM,OAACnK,EAAM,OAAE8jB,GAAU5rB,MAClB8H,OAAQyuB,EAAa3K,OAAQ4K,GAAevkB,EACnD,OAAOnK,EAAOL,SAAS8uB,GAAe3K,EAAS4K,CACnD,CAEA,OAAAC,CAAQxkB,GACJ,MAAM,OAACnK,EAAM,OAAE8jB,GAAU5rB,MAClBqD,EAAGqzB,EAASpzB,EAAGqzB,EAASzvB,EAAG0vB,GAAW9uB,GACvC,IAACxD,EAAG,IAAEC,GAAO0N,GACZ5O,EAAGwzB,EAAMvzB,EAAGwzB,EAAM5vB,EAAG6vB,GAAQzyB,GAC7BjB,EAAG2zB,EAAM1zB,EAAG2zB,EAAM/vB,EAAGgwB,GAAQ3yB,EAE9BlB,EAAIoB,KAAKF,IAAIsyB,EAAMpyB,KAAKH,IAAIoyB,EAASM,IACrC1zB,EAAImB,KAAKF,IAAIuyB,EAAMryB,KAAKH,IAAIqyB,EAASM,IACrC/vB,EAAIzC,KAAKF,IAAIwyB,EAAMtyB,KAAKH,IAAIsyB,EAASM,IAI3C,OADiBzyB,KAAKM,MAAM1B,EAAIqzB,IAAYrzB,EAAIqzB,IAAYpzB,EAAIqzB,IAAYrzB,EAAIqzB,IAAYzvB,EAAI0vB,IAAY1vB,EAAI0vB,IAC9FhL,CACtB,ECzCJ,MAAMuL,GAAU,IAAIz0B,MAAM,GAAGuH,KAAK,GAAGP,KAAI2gB,GAAK,IAAIrjB,IAwIlD,ICjGK,GCzCOowB,GAQAC,GAUAC,GAsBAC,GAqCAC,GChFAC,GAgBAC,GA4DAC,GAoBAC,GAcAC,GAaAC,GAKAC,GASAC,GAKAC,GAMAC,GCpJAC,GCSAC,GA8DAC,GCvEAC,GAUAC,GAMAC,GAOAC,GAWAC,GAkBAC,GAQAC,GAaAC,GAMAC,GAKAC,GAKAC,GNoDRC,GApHJ,MACa30B,IACAC,IAET,WAAAvC,CACIsC,EACAC,GAEAvE,KAAKsE,IAAMA,EACXtE,KAAKuE,IAAMA,CACf,CAEA,gBAAO20B,IAAaC,GAChB,MAAMC,EAAmB5zB,OAAO6zB,kBAC1BC,EAAmB9zB,OAAO+zB,kBAChC,IAAI1C,EAAOuC,EACPtC,EAAOsC,EACPrC,EAAOqC,EACPpC,EAAOsC,EACPrC,EAAOqC,EACPpC,EAAOoC,EAYX,OAXAH,EAAMxI,SAAS6I,IACX,MAAOl1B,IAAK0nB,EAAQznB,IAAKwnB,GAAUyN,GAC5Bn2B,EAAGo2B,EAASn2B,EAAGo2B,EAASxyB,EAAGyyB,GAAW3N,GACtC3oB,EAAGu2B,EAASt2B,EAAGu2B,EAAS3yB,EAAG4yB,GAAW/N,EACzC0N,EAAU5C,EAAMA,EAAO4C,EAClBG,EAAU5C,IAAMA,EAAO4C,GAC5BF,EAAU5C,EAAMA,EAAO4C,EAClBG,EAAU5C,IAAMA,EAAO4C,GAC5BF,EAAU5C,EAAMA,EAAO4C,EAClBG,EAAU5C,IAAMA,EAAO4C,EAAO,IAEpC,IAAIb,GACP,IAAIjyB,EAAQ6vB,EAAMC,EAAMC,GACxB,IAAI/vB,EAAQgwB,EAAMC,EAAMC,GAEhC,CAEA,IAAA6C,CAAK9nB,GACD,MAAM,IAAC3N,EAAG,IAAEC,GAAOvE,MACZqD,EAAGwzB,EAAMvzB,EAAGwzB,EAAM5vB,EAAG6vB,GAAQzyB,GAC7BjB,EAAG2zB,EAAM1zB,EAAG2zB,EAAM/vB,EAAGgwB,GAAQ3yB,GAC7BD,IAAK01B,EAAUz1B,IAAK01B,GAAYhoB,GAChC5O,EAAG62B,EAAW52B,EAAG62B,EAAWjzB,EAAGkzB,GAAaJ,GAC5C32B,EAAGg3B,EAAW/2B,EAAc4D,EAAGozB,GAAaL,EACnD,OAAQpD,GAAQwD,GAAarD,GAAQkD,GAChCpD,GAAQyD,GAAatD,GAAQkD,GAC7BpD,GAAQuD,GAAapD,GAAQkD,CACtC,CAEA,SAAArtB,CAAU6K,GACN,MAAM,IAACtT,EAAG,IAAEC,GAAOvE,KACnB,IAAKqD,EAAGwzB,EAAMvzB,EAAGwzB,EAAM5vB,EAAG6vB,GAAQzyB,GAC7BjB,EAAG2zB,EAAM1zB,EAAG2zB,EAAM/vB,EAAGgwB,GAAQ3yB,EAClC4yB,GAAQ,GAAG5zB,UAAUszB,EAAMC,EAAMC,GACjCI,GAAQ,GAAG5zB,UAAUszB,EAAMC,EAAMI,GACjCC,GAAQ,GAAG5zB,UAAUszB,EAAMI,EAAMF,GACjCI,GAAQ,GAAG5zB,UAAUyzB,EAAMF,EAAMC,GACjCI,GAAQ,GAAG5zB,UAAUszB,EAAMI,EAAMC,GACjCC,GAAQ,GAAG5zB,UAAUyzB,EAAMF,EAAMI,GACjCC,GAAQ,GAAG5zB,UAAUyzB,EAAMC,EAAMF,GACjCI,GAAQ,GAAG5zB,UAAUyzB,EAAMC,EAAMC,GACjC,MAAM,kBAACmC,EAAiB,kBAAEE,GAAqB/zB,OAe/C,OAdAqxB,EAAOC,EAAOC,EAAOsC,EACrBrC,EAAOC,EAAOC,EAAOqC,EACrBpC,GAAQxG,SAAS6J,IACb5iB,EAAOwM,eAAeoW,GACtB,MAAOn3B,EAAGC,EAAG4D,GAAKszB,EACdn3B,EAAIwzB,EAAMA,EAAOxzB,EACZA,EAAI2zB,IAAMA,EAAO3zB,GACtBC,EAAIwzB,EAAMA,EAAOxzB,EACZA,EAAI2zB,IAAMA,EAAO3zB,GACtB4D,EAAI6vB,EAAMA,EAAO7vB,EACZA,EAAIgwB,IAAMA,EAAOhwB,EAAC,IAE/B5C,EAAIf,UAAUszB,EAAMC,EAAMC,GAC1BxyB,EAAIhB,UAAUyzB,EAAMC,EAAMC,GACnBl3B,IACX,CAEA,QAAAisB,CAASC,GACL,MAAM,IAAC5nB,EAAG,IAAEC,GAAOvE,MACZqD,EAAGwzB,EAAMvzB,EAAGwzB,EAAM5vB,EAAG6vB,GAAQzyB,GAC7BjB,EAAG2zB,EAAM1zB,EAAG2zB,EAAM/vB,EAAGgwB,GAAQ3yB,EAIpC,OAHA2nB,EAAM,GAAG3oB,UAAUyzB,EAAOH,EAAM,EAAG,GACnC3K,EAAM,GAAG3oB,UAAU,EAAG0zB,EAAOH,EAAM,GACnC5K,EAAM,GAAG3oB,UAAU,EAAG,EAAG2zB,EAAOH,GACzB7K,CACX,CAEA,UAAAS,CAAWvC,GACP,MAAM,IAAC9lB,EAAG,IAAEC,GAAOvE,MACZqD,EAAGwzB,EAAMvzB,EAAGwzB,EAAM5vB,EAAG6vB,GAAQzyB,GAC7BjB,EAAG2zB,EAAM1zB,EAAG2zB,EAAM/vB,EAAGgwB,GAAQ3yB,EASpC,OARA6lB,EAAQ,GAAG7mB,UAAUszB,EAAMC,EAAMC,GACjC3M,EAAQ,GAAG7mB,UAAUszB,EAAMC,EAAMI,GACjC9M,EAAQ,GAAG7mB,UAAUszB,EAAMI,EAAMF,GACjC3M,EAAQ,GAAG7mB,UAAUyzB,EAAMF,EAAMC,GACjC3M,EAAQ,GAAG7mB,UAAUszB,EAAMI,EAAMC,GACjC9M,EAAQ,GAAG7mB,UAAUyzB,EAAMF,EAAMI,GACjC9M,EAAQ,GAAG7mB,UAAUyzB,EAAMC,EAAMF,GACjC3M,EAAQ,GAAG7mB,UAAUyzB,EAAMC,EAAMC,GAC1B9M,CACX,CAEA,WAAAqQ,CAAY7iB,GACR,MAAM,IAACtT,EAAG,IAAEC,GAAOvE,MACZqD,EAAGwzB,EAAMvzB,EAAGwzB,EAAM5vB,EAAG6vB,GAAQzyB,GAC7BjB,EAAG2zB,EAAM1zB,EAAG2zB,EAAM/vB,EAAGgwB,GAAQ3yB,EACpC,OAAO,IAAI00B,GACP,IAAIjyB,EAAQ6vB,EAAMC,EAAMC,GACxB,IAAI/vB,EAAQgwB,EAAMC,EAAMC,IAC1BnqB,UAAU6K,EAChB,GOqLA8iB,GA/RJ,MACaC,UACAC,SACAC,MAET,WAAA74B,GACIhC,KAAK26B,UAAY,GACjB36B,KAAK46B,SAAW,GAChB56B,KAAK66B,MAAQ,EACjB,CAEA,KAAAj3B,GACI,OAAOlE,OAAOmK,OAAOnK,OAAOo7B,OAAO96B,KAAKgC,YAAY1B,WAAYy6B,gBAAgB/6B,MACpF,CAEA,eAAAg7B,CAAgBC,EAAcC,EAAcC,EAAcC,GACtDp7B,KAAKq7B,QAAQ,CAACJ,EAAIC,EAAIC,GAAKC,EAC/B,CAEA,WAAAE,CAAYL,EAAcC,EAAcC,EAAcI,EAAcH,GAChEp7B,KAAKq7B,QAAQ,CAACJ,EAAIC,EAAIC,EAAII,GAAKH,EACnC,CAEA,SAAAI,CAAUC,GACN,MAAM,SAACb,GAAY56B,KACb07B,EAAiB,CACnBD,SAAUA,EACVE,WAAY,MAEhB,OAAOf,EAASvqB,KAAKqrB,GAAU,CACnC,CAEA,OAAAL,CAAQT,EAAsBQ,GAC1B,MAAOT,UAAWiB,EAAYhB,SAAUiB,EAAWhB,MAAOiB,GAAU97B,MAC7DqB,OAAQ06B,GAAqBnB,EACpC,GAAImB,EAAoB,EAEpB,YADA5rB,QAAQ6rB,MAAM,sDAGlB,MAAMC,EAAa,CACfN,WAAY,QACTP,GAEDc,EAASJ,EAAOz6B,OACtB,IAAI86B,EAA4B,KAC5BC,EAA4B,KAC5BC,EAAqC,KACrCC,EAA4B,KAC5BX,EAAgC,KAChCY,EAAwC,KAC5C,IAAK,IAAI5zB,EAAI,EAAGA,EAAIozB,EAAmBpzB,IAAK,CAcxC,GAbAwzB,EAAWvB,EAASjyB,GACpByzB,EAAYzzB,EAAIozB,EAAoB,EAAKnB,EAASjyB,EAAI,GAAKiyB,EAAS,GAC3Cl4B,MAAMC,KAAK3C,KAAKw8B,oBAAoBL,IAAW7J,MACnEmK,GACkB,OAAXA,GACG/5B,MAAMC,KAAK3C,KAAK08B,sBAAsBD,IAASnK,MACjDqK,IACG,MAAOP,SAAUQ,EAAYC,OAAQC,GAAYlB,EAAWe,GAC5D,OAAOC,IAAeR,GAAYR,EAAWkB,IAAa,IAAIV,WAAaD,CAAQ,MAM/F,SAEJG,EAAW,CACPF,SAAUA,EACVW,OAAQ,KACRC,OAAQ,KACRH,OAAQ,KACRX,OAAQA,GAEZP,EAAaC,EAAWv6B,OACG,OAAvBk7B,GACAN,EAAKK,SAAWX,EAChBU,EAAkBV,IAGlBW,EAASO,OAASN,EAClBX,EAAWW,GAAoBS,OAASrB,GAE5C,MAAMxhB,EAAS0hB,EAAUM,GACC,OAAtBhiB,EAAOwhB,aACPxhB,EAAOwhB,WAAaA,GAExB,MAAMsB,EAAerB,EAAWtJ,MAC3BqK,IACG,MAAOP,SAAUQ,EAAYC,OAAQC,GAAYH,EACjD,OAAOC,IAAeT,GAAYP,EAAWkB,IAAa,IAAIV,WAAaA,CAAQ,KAEtF,KACgB,OAAjBa,IACAX,EAASS,OAASnB,EAAWsB,QAAQD,GACrCA,EAAaF,OAASpB,GAE1BY,EAAqBZ,EACrBC,EAAWvrB,KAAKisB,E,CAEH,OAAbA,GAAyC,OAApBD,IACrBT,EAAWS,GAAiBQ,OAASlB,EACrCW,EAASU,OAASX,GAEtBP,EAAOzrB,KAAK4rB,EAChB,CAEA,UAAAkB,GACI,MAAM,MAACtC,EAAK,SAAED,GAAY56B,KAC1B,OAAO,IAAImD,aAAa03B,EAAMuC,SAAQ,CAAC/S,EAAG1hB,KACtC,MAAM00B,EAAe36B,MAAMC,KAAK3C,KAAKs9B,qBAAqB30B,IAC1D,GAA4B,IAAxB00B,EAAah8B,OAAc,CAC3B,MAAO45B,EAAIC,EAAIC,EAAII,GAAM8B,EAAa3zB,KAAI6zB,GAAY3C,EAAS2C,GAAU9B,WACzE,MAAO,IACAR,KAAOC,KACPA,KAAOC,KACPA,KAAOI,KACPA,KAAON,E,CAGb,CACD,MAAOA,EAAIC,EAAIC,GAAMkC,EAAa3zB,KAAI6zB,GAAY3C,EAAS2C,GAAU9B,WACrE,MAAO,IACAR,KAAOC,KACPA,KAAOC,KACPA,KAAOF,E,KAI1B,CAEA,aAAAuC,GACI,MAAM,MAAC3C,EAAK,SAAED,GAAY56B,KAC1B,OAAO,IAAImD,aAAa03B,EAAMuC,SAAQ,CAAC/S,EAAG1hB,IAC/BjG,MAAMC,KAAK3C,KAAKs9B,qBAAqB30B,IAAIy0B,SAAS1B,GAC9Ch5B,MAAMC,KAAKi4B,EAASc,GAAQD,cAG/C,CAEA,aAAAgC,GACI,MAAM,MAAC5C,EAAK,SAAED,GAAY56B,KAC1B,OAAO,IAAImD,aAAa03B,EAAMuC,SAAQ,CAACX,EAAQ9zB,KAC3C,MAAM00B,EAAe36B,MAAMC,KAAK3C,KAAKs9B,qBAAqB30B,IACpD+0B,EAAUjB,EAAOkB,IAChB1C,EAAIC,EAAIC,GAAMkC,EAAa3zB,KAAI6zB,GAAY3C,EAAS2C,GAAU9B,YAC9DmC,EAAKC,EAAKC,GAAOJ,EAClBK,EAAQ7C,EAAGxxB,KAAI,CAACs0B,EAAMr1B,IAAMsyB,EAAGtyB,GAAKq1B,IACpCC,EAAQ/C,EAAGxxB,KAAI,CAACs0B,EAAMr1B,IAAMwyB,EAAGxyB,GAAKq1B,IACpCE,EAAWL,EAAIn0B,KAAI,CAACy0B,EAAOx1B,IAAMi1B,EAAIj1B,GAAKw1B,IAC1CC,EAAWP,EAAIn0B,KAAI,CAACy0B,EAAOx1B,IAAMm1B,EAAIn1B,GAAKw1B,IAC1ClV,EAAI,GAAOiV,EAAS,GAAKE,EAAS,GAAKF,EAAS,GAAKE,EAAS,IAC9DC,EAAUN,EAAMr0B,KAAI,CAAC40B,EAAS31B,MAAQ21B,EAAUF,EAAS,GAAKH,EAAMt1B,GAAKu1B,EAAS,IAAMjV,IACxF5nB,EAASoD,KAAKkD,SAAS02B,GAG7B,OAFA5B,EAAO4B,QAAUA,EAAQ30B,KAAI60B,GAAaA,EAAYl9B,IAE/Cg8B,EAAaD,SAAQ,IACjB16B,MAAMC,KAAK85B,EAAO4B,UAC3B,IAEV,CAEA,YAAAG,GACI,MAAM,MAAC3D,EAAK,SAAED,GAAY56B,KAC1B,OAAO,IAAImD,aAAa03B,EAAMuC,SAAQ,CAACX,EAAQ9zB,KAC3C,MAAM00B,EAAe36B,MAAMC,KAAK3C,KAAKs9B,qBAAqB30B,KACnDsyB,EAAIC,EAAIC,GAAMkC,EAAa3zB,KAAI6zB,GAAY3C,EAAS2C,GAAU9B,WAC/DsC,EAAQ7C,EAAGxxB,KAAI,CAACs0B,EAAMr1B,IAAMsyB,EAAGtyB,GAAKq1B,IACpCC,EAAQ/C,EAAGxxB,KAAI,CAACs0B,EAAMr1B,IAAMwyB,EAAGxyB,GAAKq1B,IACpCpZ,EAASmZ,EAAMr0B,KAAI,CAAC2gB,EAAG1hB,KACzB,MAAM81B,GAAM91B,EAAI,GAAK,EACf+1B,GAAO/1B,EAAI,EAAK,GAAK,EAC3B,QAASo1B,EAAMU,GAAMR,EAAMS,GAAMX,EAAMW,GAAMT,EAAMQ,GAAI,IAErDp9B,EAASoD,KAAKkD,SAASid,GAG7B,OAFA6X,EAAO7X,OAASA,EAAOlb,KAAIi1B,GAAYA,EAAWt9B,IAE3Cg8B,EAAaD,SAAQ,IACjB16B,MAAMC,KAAK85B,EAAO7X,SAC3B,IAEV,CAEA,QAAAga,GACI,MAAM,MAAC/D,GAAS76B,KAChB,OAAO,IAAImD,aAAa03B,EAAMuC,SAASnB,GAC5BA,EAAK0B,GAAGkB,KAAK,KAE5B,CAEA,qBAAAC,GACI,MAAM,MAACjE,GAAS76B,KACV0P,EAAQmrB,EAAMpxB,QAAO,CAACs1B,EAAe1U,EAAG1hB,IACnCo2B,EAAgBr8B,MAAMC,KAAK3C,KAAKs9B,qBAAqB30B,IAAItH,QACjE,GAEH,OAAO,IADmBqO,EAAQjL,KAAK+K,IAAI,EAAG,GAAM+e,WAAc7e,EAAQjL,KAAK+K,IAAI,EAAG,IAAOmf,YAAche,aAC/EkqB,EAAMpxB,QAAO,EAAE0lB,EAASvlB,GAAQ6yB,EAAQ9zB,IAExC,IADPjG,MAAMC,KAAK3C,KAAKs9B,qBAAqB30B,IACzCtH,OACF,CAAC8tB,EAAQ6P,OAAO,CAACp1B,EAAOA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,IAAKA,EAAQ,GAE7F,CAACulB,EAAQ6P,OAAO,CAACp1B,EAAOA,EAAQ,EAAGA,EAAQ,IAAKA,EAAQ,IAChE,CAAC,GAAI,IAA0B,GACtC,CAEA,iBAAAq1B,GACI,MAAM,MAACpE,GAAS76B,KACV0P,EAAQmrB,EAAMpxB,QAAO,CAACs1B,EAAe1U,EAAG1hB,IACnCo2B,EAAkE,EAAlDr8B,MAAMC,KAAK3C,KAAKs9B,qBAAqB30B,IAAItH,QACjE,GAEH,OAAO,IADmBqO,EAAQjL,KAAK+K,IAAI,EAAG,GAAM+e,WAAc7e,EAAQjL,KAAK+K,IAAI,EAAG,IAAOmf,YAAche,aAC/EkqB,EAAMpxB,QAAO,EAAE0lB,EAASvlB,GAAQ6yB,EAAQ9zB,IAExC,IADPjG,MAAMC,KAAK3C,KAAKs9B,qBAAqB30B,IACzCtH,OACF,CAAC8tB,EAAQ6P,OAAO,CAACp1B,EAAOA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,IAASA,EAAQ,GAE/G,CAACulB,EAAQ6P,OAAO,CAACp1B,EAAOA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,IAASA,EAAQ,IAC7F,CAAC,GAAI,IAA0B,GACtC,CAEA,WAAAs1B,GACI,MAAM9F,EAAmB5zB,OAAO6zB,kBAC1BC,EAAmB9zB,OAAO+zB,kBAChC,IAAI1C,EAAOuC,EACPtC,EAAOsC,EACPrC,EAAOqC,EACPpC,EAAOsC,EACPrC,EAAOqC,EACPpC,EAAOoC,EACX,MAAM,SAACsB,GAAY56B,KACf46B,EAASv5B,OAAS,GAClBu5B,EAASjK,SAAS4M,IACd,MAAOl6B,EAAGC,EAAG4D,GAAKq2B,EAAS9B,SACvBp4B,EAAIwzB,EAAMA,EAAOxzB,EACZA,EAAI2zB,IAAMA,EAAO3zB,GACtBC,EAAIwzB,EAAMA,EAAOxzB,EACZA,EAAI2zB,IAAMA,EAAO3zB,GACtB4D,EAAI6vB,EAAMA,EAAO7vB,EACZA,EAAIgwB,IAAMA,EAAOhwB,EAAC,IAGnC,MAAM5C,EAAM,IAAI0C,EAAQ,CAAC6vB,EAAMC,EAAMC,IAC/BxyB,EAAM,IAAIyC,EAAQ,CAACgwB,EAAMC,EAAMC,IACrC,OAAO,IAAI+B,GAAY30B,EAAKC,EAChC,CAEA,cAAA46B,GACI,MAAM/F,EAAmB5zB,OAAO6zB,kBAC1BC,EAAmB9zB,OAAO+zB,kBAChC,IAAI1C,EAAOuC,EACPtC,EAAOsC,EACPrC,EAAOqC,EACPpC,EAAOsC,EACPrC,EAAOqC,EACPpC,EAAOoC,EACX,MAAM,SAACsB,GAAY56B,KACf46B,EAASv5B,OAAS,GAClBu5B,EAASjK,SAAS4M,IACd,MAAOl6B,EAAGC,EAAG4D,GAAKq2B,EAAS9B,SACvBp4B,EAAIwzB,EAAMA,EAAOxzB,EACZA,EAAI2zB,IAAMA,EAAO3zB,GACtBC,EAAIwzB,EAAMA,EAAOxzB,EACZA,EAAI2zB,IAAMA,EAAO3zB,GACtB4D,EAAI6vB,EAAMA,EAAO7vB,EACZA,EAAIgwB,IAAMA,EAAOhwB,EAAC,IAGnC,MAAM5C,EAAM,IAAI0C,EAAQ,CAAC6vB,EAAMC,EAAMC,IAC/BxyB,EAAM,IAAIyC,EAAQ,CAACgwB,EAAMC,EAAMC,IACrC,OAAO,IAAIb,GACP,IAAIrvB,EAAWvC,KAAKF,IAAID,EAAIjD,SAAUkD,EAAIlD,UAElD,CAEA,qBAAAq7B,CAAsBT,GAClB,OAAO,IAAImD,GAAsBp/B,KAAMi8B,EAC3C,CAEA,oBAAAqB,CAAqBrB,GACjB,OAAO,IAAIoD,GAAqBr/B,KAAMi8B,EAC1C,CAEA,mBAAAO,CAAoBd,GAChB,OAAO,IAAI4D,GAAoBt/B,KAAM07B,EACzC,GA8BG,MAAM0D,GACTG,SACArD,OACAP,WAEA,WAAA35B,CAAYu9B,EAA2BtD,GACnCj8B,KAAKu/B,SAAWA,EAChBv/B,KAAKk8B,OAASD,EACdj8B,KAAK27B,WAAa,IACtB,CAEA,KAAA6D,GACIx/B,KAAK27B,WAAa,IACtB,CAEA,OAAA8D,GACI,OAAOz/B,KAAK27B,UAChB,CAEA,IAAA/yB,GACI,MAAM,WAAC+yB,EAAU,OAAEO,EAAM,SAAEqD,GAAYv/B,MACjC,MAAC66B,EAAK,UAAEF,GAAa4E,EACrBtD,EAAOpB,EAAMqB,GACnB,GAAa,OAATD,EACA,GAAmB,OAAfN,EAAqB,CACrB,MAAMU,EAAkBJ,EAAKN,YAAc,KACrC+D,EAAiB7E,EAAMwB,IAAoB,IAAIW,QAAU,KAE/D,GADAh9B,KAAK27B,WAAa+D,EACM,OAApBrD,EACA,MAAO,CACHz7B,MAAOy7B,EAAiBxzB,KAAyB,OAAnB62B,E,MAIrC,GAAI/D,IAAeM,EAAKK,SAAU,CACnC,MAAMoD,EAAiB/E,EAAUgB,GAAYqB,QAAU,KAEvD,GADAh9B,KAAK27B,WAAa+D,EACC,OAAf/D,EACA,MAAO,CACH/6B,MAAO+6B,EAAY9yB,KAAyB,OAAnB62B,E,CAKzC,MAAO,CACH9+B,WAAOkI,EAAWD,MAAM,EAEhC,CAEA,CAACnI,OAAOgI,YAEJ,OADA1I,KAAK27B,WAAa,KACX37B,IACX,EAGG,MAAMq/B,GACTE,SACArD,OACAP,WAEA,WAAA35B,CAAYu9B,EAA2BtD,GACnCj8B,KAAKu/B,SAAWA,EAChBv/B,KAAKk8B,OAASD,EACdj8B,KAAK27B,WAAa,IACtB,CAEA,KAAA6D,GACIx/B,KAAK27B,WAAa,IACtB,CAEA,OAAA8D,GACI,MAAM,WAAC9D,EAAU,SAAE4D,GAAYv/B,MACzB,UAAC26B,GAAa4E,EACpB,OAAO5E,EAAUA,EAAUgB,IAAe,IAAIkB,SAAW,IAAIT,UAAY,IAC7E,CAEA,IAAAxzB,GACI,MAAM,WAAC+yB,EAAU,SAAE4D,EAAQ,OAAErD,GAAUl8B,MACjC,MAAC66B,EAAK,UAAEF,GAAa4E,EACrBtD,EAAOpB,EAAMqB,IAAW,GAC9B,GAAa,OAATD,EAAe,CACf,MAAOK,SAAUqD,GAAkB1D,EACnC,GAAmB,OAAfN,EAAqB,CACrB,MAAMiE,EAAgBjF,EAAUA,EAAUgF,IAAmB,GAAG9C,SAAW,GAAGT,UAAY,KACpFsD,EAAiB/E,EAAUgF,IAAmB,GAAG3C,QAAU,KAEjE,GADAh9B,KAAK27B,WAAa+D,EACI,OAAlBE,EACA,MAAO,CACHh/B,MAAOg/B,EAAe/2B,KAAyB,OAAnB62B,E,MAInC,GAAI/D,IAAeM,EAAKK,SAAU,CACnC,MAAMZ,EAASf,EAAUA,EAAUgB,GAAYkB,SAAW,GAAGT,UAAY,KACnEsD,EAAiB/E,EAAUgB,GAAYqB,QAAU,KAEvD,GADAh9B,KAAK27B,WAAa+D,EACH,OAAXhE,EACA,MAAO,CACH96B,MAAO86B,EAAQ7yB,KAAyB,OAAnB62B,E,EAKrC,MAAO,CACH9+B,WAAOkI,EAAWD,MAAM,EAEhC,CAEA,CAACnI,OAAOgI,YAEJ,OADA1I,KAAK27B,WAAa,KACX37B,IACX,EAGG,MAAMs/B,GACTC,SACA5D,WACAkE,SAEA,WAAA79B,CAAYu9B,EAA2B7D,GACnC17B,KAAKu/B,SAAWA,EAChBv/B,KAAK6/B,SAAWnE,EAChB17B,KAAK27B,WAAa,IACtB,CAEA,KAAA6D,GACIx/B,KAAK27B,WAAa,IACtB,CAEA,OAAA8D,GACI,MAAM,SAACF,EAAQ,WAAE5D,GAAc37B,MACzB,UAAC26B,GAAa4E,EACpB,OAAO5E,EAAUgB,IAAe,GAAGO,QAAU,IACjD,CAEA,IAAAtzB,GACI,MAAM,WAAC+yB,EAAU,SAAEkE,EAAQ,SAAEN,GAAYv/B,MACnC,UAAC26B,EAAS,SAAEC,GAAY2E,EACxB7D,EAASd,EAASiF,IAAa,GACrC,GAAInE,EAAQ,CACR,MAAOC,WAAYmE,GAAoBpE,EACvC,GAAmB,OAAfC,EAAqB,CACrB,MAAMO,EAASvB,EAAUmF,IAAqB,IAAI5D,QAAU,KACtDwD,EAAiB/E,EAAUA,EAAUmF,IAAqB,IAAIjD,SAAW,IAAIE,QAAU,KAE7F,GADA/8B,KAAK27B,WAAa+D,EACH,OAAXxD,EACA,MAAO,CACHt7B,MAAOs7B,EAAQrzB,KAAyB,OAAnB62B,E,MAI5B,GAAI/D,IAAeD,EAAOC,WAAY,CACvC,MAAMO,EAASvB,EAAUgB,IAAaO,QAAU,KAC1CwD,EAAiB/E,EAAUA,EAAUgB,GAAYkB,SAAW,GAAGE,QAAU,KAE/E,GADA/8B,KAAK27B,WAAa+D,EACH,OAAXxD,EACA,MAAO,CACHt7B,MAAOs7B,EAAQrzB,KAAyB,OAAnB62B,E,EAKrC,MAAO,CACH9+B,WAAOkI,EAAWD,MAAM,EAEhC,CAEA,CAACnI,OAAOgI,YAEJ,OADA1I,KAAK27B,WAAa,KACX37B,IACX,ECjgBG,MAAM+/B,WAAqB5J,GACjCrqB,MACAC,OACAi0B,MACAC,cACAC,eACAC,cAEA,WAAAn+B,CAAYo5B,GACXrrB,QACA,MAAM,MAACjE,EAAK,OAAEC,EAAM,MAAEi0B,EAAK,cAAEC,EAAa,eAAEC,EAAc,cAAEC,GAAiB/E,GAAc,CAAC,EAC5Fp7B,KAAK8L,MAAQA,GAAS,EACtB9L,KAAK+L,OAASA,GAAU,EACxB/L,KAAKggC,MAAQA,GAAS,EACtBhgC,KAAKigC,cAAgBA,GAAiB,EACtCjgC,KAAKkgC,eAAiBA,GAAkB,EACxClgC,KAAKmgC,cAAgBA,GAAiB,CACvC,CAEA,SAAA/J,GACC,MAAMgK,EAAU,IAAI1F,IACd,MAAC5uB,EAAK,OAAEC,EAAM,MAAEi0B,GAAShgC,KAC/B,IAAI,cAACigC,EAAa,eAAEC,EAAc,cAAEC,GAAiBngC,KACrDigC,EAAgBx7B,KAAK47B,MAAMJ,GAC3BC,EAAiBz7B,KAAK47B,MAAMH,GAC5BC,EAAgB17B,KAAK47B,MAAMF,GAE3B,MAAMhR,EAAoB,GACpByL,EAAqB,GACrB0F,EAAgB,GACtB,IAAIvB,EAAgB,EAEpB,CACC,CAAC,EAAG,EAAG,GAAI,GAAI,EAAGiB,EAAOj0B,EAAQD,EAAOq0B,EAAeD,GACvD,CAAC,EAAG,EAAG,EAAG,GAAK,EAAGF,EAAOj0B,GAASD,EAAOq0B,EAAeD,GACxD,CAAC,EAAG,EAAG,EAAG,EAAI,EAAIp0B,EAAOk0B,EAAOj0B,EAAQk0B,EAAeE,GACvD,CAAC,EAAG,EAAG,EAAG,GAAK,EAAGr0B,EAAOk0B,GAAQj0B,EAAQk0B,EAAeE,GACxD,CAAC,EAAG,EAAG,EAAG,GAAK,EAAGr0B,EAAOC,EAAQi0B,EAAOC,EAAeC,GACvD,CAAC,EAAG,EAAG,GAAI,GAAI,EAAGp0B,EAAOC,GAASi0B,EAAOC,EAAeC,IACvDvP,SAAQ,EAAE4P,EAAG78B,EAAGuS,EAAGuqB,EAAMC,EAAM30B,EAAOC,EAAQi0B,EAAOU,EAAOC,MAC7D,MAAMC,EAAe90B,EAAQ40B,EACvBG,EAAgB90B,EAAS40B,EACzBG,EAAYh1B,EAAQ,EACpBi1B,EAAah1B,EAAS,EACtBi1B,EAAYhB,EAAQ,EACpBiB,EAASP,EAAQ,EACjBQ,EAASP,EAAQ,EACvB,IAAI/2B,EAAQ,EACZ,IAAK,IAAIu3B,EAAK,EAAGA,EAAKD,EAAQC,IAAM,CACnC,MAAM79B,EAAI69B,EAAKN,EAAgBE,EAC/B,IAAK,IAAIK,EAAK,EAAGA,EAAKH,EAAQG,IAAM,CACnC,MAAM/9B,EAAI+9B,EAAKR,EAAeE,EACxBpF,EAAS,IAAIh5B,MAAM,GACzBg5B,EAAO6E,GAAKl9B,EAAIm9B,EAChB9E,EAAOh4B,GAAKJ,EAAIm9B,EAChB/E,EAAOzlB,GAAK+qB,EACZpG,EAASvqB,QACLqrB,GAEJ4E,EAAIjwB,KAAK+wB,EAAKV,EAAO,EAAKS,EAAKR,GAC/B/2B,G,EAGF,IAAK,IAAIu3B,EAAK,EAAGA,EAAKR,EAAOQ,IAC5B,IAAK,IAAIC,EAAK,EAAGA,EAAKV,EAAOU,IAAM,CAClC,MAAMx8B,EAAIm6B,EAAgBqC,EAAKH,EAASE,EAClCt8B,EAAIk6B,EAAgBqC,EAAKH,GAAUE,EAAK,GACxCne,EAAI+b,GAAiBqC,EAAK,GAAKH,GAAUE,EAAK,GAC9CnuB,EAAI+rB,GAAiBqC,EAAK,GAAKH,EAASE,EAG9ChS,EAAQ9e,KAAKzL,EAAGC,EAAGmO,EAAGgQ,E,CAGxB+b,GAAiBn1B,CAAK,IAGvB,MAAOvI,OAAQggC,GAAgBlS,EACzBqO,EAA0B,GAC1BoB,EAAuB,GAC7B,IAAK,IAAIj2B,EAAI,EAAGA,EAAI04B,EAAc14B,GAAK,EAAG,CACzC,MAAM24B,EAAM,EAAInS,EAAQxmB,GAAI44B,EAAM,EAAIpS,EAAQxmB,EAAI,GAAI64B,EAAM,EAAIrS,EAAQxmB,EAAI,GAAI84B,EAAM,EAAItS,EAAQxmB,EAAI,GAChG+4B,EAAM,EAAIvS,EAAQxmB,GAAIg5B,EAAM,EAAIxS,EAAQxmB,EAAI,GAAIi5B,EAAM,EAAIzS,EAAQxmB,EAAI,GAAIk5B,EAAM,EAAI1S,EAAQxmB,EAAI,GACtG,IAAIuyB,EAAKsC,EAAc8D,GAAMnG,EAAKqC,EAAc+D,GAAMhG,EAAKiC,EAAcgE,GAAMM,EAAKtE,EAAciE,QACvF34B,IAAPoyB,IACHA,EAAKkF,EAAQ5E,UAAU,CAACZ,EAAS0G,GAAM1G,EAAS0G,EAAM,GAAI1G,EAAS0G,EAAM,KAAM9D,EAAc8D,GAAOpG,QAE1FpyB,IAAPqyB,IACHA,EAAKiF,EAAQ5E,UAAU,CAACZ,EAAS2G,GAAM3G,EAAS2G,EAAM,GAAI3G,EAAS2G,EAAM,KAAM/D,EAAc+D,GAAOpG,QAE1FryB,IAAPyyB,IACHA,EAAK6E,EAAQ5E,UAAU,CAACZ,EAAS4G,GAAM5G,EAAS4G,EAAM,GAAI5G,EAAS4G,EAAM,KAAMhE,EAAcgE,GAAOjG,QAG1FzyB,IAAPg5B,IACHA,EAAK1B,EAAQ5E,UAAU,CAACZ,EAAS6G,GAAM7G,EAAS6G,EAAM,GAAI7G,EAAS6G,EAAM,KAAMjE,EAAciE,GAAOK,GAErG,IAAIjE,EAAMe,EAAS8C,GAAM5D,EAAMc,EAAS+C,GAAMI,EAAMnD,EAASgD,GAAMI,EAAMpD,EAASiD,QACtE/4B,IAAR+0B,IACHA,EAAM,CAACyC,EAAIoB,GAAMpB,EAAIoB,EAAM,IAAK9C,EAAS8C,GAAO7D,QAErC/0B,IAARg1B,IACHA,EAAM,CAACwC,EAAIqB,GAAMrB,EAAIqB,EAAM,IAAK/C,EAAS+C,GAAO7D,QAErCh1B,IAARi5B,IACHA,EAAM,CAACzB,EAAIsB,GAAMtB,EAAIsB,EAAM,IAAKhD,EAASgD,GAAOG,QAGrCj5B,IAARk5B,IACHA,EAAM,CAAC1B,EAAIuB,GAAMvB,EAAIuB,EAAM,IAAKjD,EAASiD,GAAOG,GAKjD5B,EAAQ9E,YAAYJ,EAAIC,EAAII,EAAIuG,EAAI,CACnCnE,GAAI,CAACE,EAAKC,EAAKiE,EAAKC,I,CAItB,OAAO5B,CACR,GP/ED,SAAKnM,GACD,2BACA,iBACA,yBACA,0BACH,CALD,CAAK,QAAkB,KAevB,MAAM,GAEF,SAAAmC,GACI,MAAM,IAAI90B,MAAM,sBACpB,EQ1DJ,MAAM2gC,WAAqB,GAC1Bn2B,MACAC,OACAk0B,cACAC,eAEA,WAAAl+B,CAAYo5B,GACXrrB,QACA/P,KAAK8L,MAAQsvB,GAAYtvB,OAAS,EAClC9L,KAAK+L,OAASqvB,GAAYrvB,QAAU,EACpC/L,KAAKigC,cAAgB7E,GAAY6E,eAAiB,EAClDjgC,KAAKkgC,eAAiB9E,GAAY8E,gBAAkB,CACrD,CAEA,SAAA9J,GACC,MAAMgK,EAAU,IAAI1F,IACd,eAACwF,EAAc,cAAED,EAAa,MAAEn0B,EAAK,OAAEC,GAAU/L,KACjD8gC,EAAYh1B,EAAQ,EACpBi1B,EAAah1B,EAAS,EAEtB20B,EAAQj8B,KAAK47B,MAAMJ,GACnBU,EAAQl8B,KAAK47B,MAAMH,GAEnBe,EAASP,EAAQ,EACjBQ,EAASP,EAAQ,EAEjBC,EAAe90B,EAAQ40B,EACvBG,EAAgB90B,EAAS40B,EACzBxR,EAAU,GACVyL,EAAW,GACX0F,EAAM,GAEZ,IAAK,IAAIa,EAAK,EAAGA,EAAKD,EAAQC,IAAM,CACnC,MAAM79B,EAAI69B,EAAKN,EAAgBE,EAC/B,IAAK,IAAIK,EAAK,EAAGA,EAAKH,EAAQG,IAAM,CACnC,MAAM/9B,EAAI+9B,EAAKR,EAAeE,EAC9BlG,EAASvqB,KAAKhN,GAAKC,EAAG,GACtBg9B,EAAIjwB,KAAK+wB,EAAKV,GACdJ,EAAIjwB,KAAK,EAAK8wB,EAAKR,E,EAGrB,IAAK,IAAIQ,EAAK,EAAGA,EAAKR,EAAOQ,IAC5B,IAAK,IAAIC,EAAK,EAAGA,EAAKV,EAAOU,IAAM,CAClC,MAAMx8B,EAAIw8B,EAAKH,EAASE,EAClBt8B,EAAIu8B,EAAKH,GAAUE,EAAK,GACxBne,EAAKoe,EAAK,EAAKH,GAAUE,EAAK,GAC9BnuB,EAAKouB,EAAK,EAAKH,EAASE,EAC9BhS,EAAQ9e,KAAKzL,EAAGC,EAAGmO,GACnBmc,EAAQ9e,KAAKxL,EAAGme,EAAGhQ,E,CAIrB,MAAO3R,OAAQggC,GAAgBlS,EACzBqO,EAA0B,GAC1BoB,EAAuB,GAC7B,IAAK,IAAIj2B,EAAI,EAAGA,EAAI04B,EAAc14B,GAAK,EAAG,CACzC,MAAM24B,EAAM,EAAInS,EAAQxmB,GAAI44B,EAAM,EAAIpS,EAAQxmB,EAAI,GAAI64B,EAAM,EAAIrS,EAAQxmB,EAAI,GACtE+4B,EAAM,EAAIvS,EAAQxmB,GAAIg5B,EAAM,EAAIxS,EAAQxmB,EAAI,GAAIi5B,EAAM,EAAIzS,EAAQxmB,EAAI,GAC5E,IAAIuyB,EAAKsC,EAAc8D,GAAMnG,EAAKqC,EAAc+D,GAAMhG,EAAKiC,EAAcgE,GAC/D14B,MAANoyB,IACHA,EAAKkF,EAAQ5E,UAAU,CAACZ,EAAS0G,GAAM1G,EAAS0G,EAAM,GAAI1G,EAAS0G,EAAM,KAAM9D,EAAc8D,GAAOpG,GAE3FpyB,MAANqyB,IACHA,EAAKiF,EAAQ5E,UAAU,CAACZ,EAAS2G,GAAM3G,EAAS2G,EAAM,GAAI3G,EAAS2G,EAAM,KAAM/D,EAAc+D,GAAOpG,GAE3FryB,MAANyyB,IACHA,EAAK6E,EAAQ5E,UAAU,CAACZ,EAAS4G,GAAM5G,EAAS4G,EAAM,GAAI5G,EAAS4G,EAAM,KAAMhE,EAAcgE,GAAOjG,GAErG,IAAIsC,EAAMe,EAAS8C,GAAM5D,EAAMc,EAAS+C,GAAMI,EAAMnD,EAASgD,GAClD94B,MAAP+0B,IACHA,EAAM,CAACyC,EAAIoB,GAAMpB,EAAIoB,EAAM,IAAK9C,EAAS8C,GAAO7D,GAEtC/0B,MAAPg1B,IACHA,EAAM,CAACwC,EAAIqB,GAAMrB,EAAIqB,EAAM,IAAK/C,EAAS+C,GAAO7D,GAEtCh1B,MAAPi5B,IACHA,EAAM,CAACzB,EAAIsB,GAAMtB,EAAIsB,EAAM,IAAKhD,EAASgD,GAAOG,GAEjD3B,EAAQpF,gBAAgBE,EAAIC,EAAII,EAAI,CACnCoC,GAAI,CAACE,EAAKC,EAAKiE,I,CAIjB,OAAO3B,CACR,GPtFD,SAAYhJ,GACR,uDACA,iFACA,iGACA,iFACA,4DACH,CAND,CAAYA,KAAAA,GAAiB,KAQ7B,SAAYC,GACR,kCACA,qEACA,qEACA,qEACA,qEACA,qEACA,oEACH,CARD,CAAYA,KAAAA,GAAwB,KAUpC,SAAYC,GACR,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,+CACA,mDACA,8DACH,CApBD,CAAYA,KAAAA,GAAqB,KAsBjC,SAAYC,GACR,mBACA,uBACA,qBACA,yBACA,uBACA,yBACA,uBACA,qBACA,yBACA,uBACA,2BACA,yBACA,2BACA,yBACA,uBACA,yBACA,uCACA,yBACA,2BACA,6BACA,+BACA,6BACA,2BACA,mCACA,+BACA,6BACA,6BACA,+BACA,iDACA,iDACA,mDACA,+CACA,iDACA,0CACH,CAnCD,CAAYA,KAAAA,GAAuB,KAqCnC,SAAYC,GACR,mBACA,sBACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,iDACA,mDACA,mDACA,mDACA,mDACA,mDACA,kDAEH,CApBD,CAAYA,KAAAA,GAAU,KAmDf,MAAM0K,GAET,wBAAOC,CAAkBjT,GACrB,MAAMkT,EAAsBlT,EAAGiT,oBAE/B,OAA4B,OAAxBC,EACO,KAGJ,CACHA,sBAER,CAEA,yBAAOC,CAAmBnT,EAA4BkM,GAClD,MAAMkH,EAAuBpT,EAAGmT,qBAChC,GAA6B,OAAzBC,EACA,OAAO,KAGXpT,EAAGqT,iBAAiBrT,EAAGsT,aAAcF,GAErC,MAAM,QAACG,EAAO,eAAEC,EAAc,MAAE52B,EAAK,OAAEC,GAAUqvB,EASjD,YARuB,IAAZqH,EACPvT,EAAGyT,+BAA+BzT,EAAGsT,aAAcC,EAASC,EAAgB52B,EAAOC,GAGnFmjB,EAAG0T,oBAAoB1T,EAAGsT,aAAcE,EAAgB52B,EAAOC,GAEnEmjB,EAAGqT,iBAAiBrT,EAAGsT,aAAc,MAE9B,IACApH,EACHkH,uBAER,CAEA,oBAAOO,CAAc3T,EAA4B4T,KAA6B1H,GAC1E,MAAM,oBAACgH,GAAuBU,EACH5T,EAAGqD,aAAarD,EAAG6T,uBACnBX,GACvBlT,EAAG8T,gBAAgB9T,EAAG+T,YAAab,GAGvC,MAAMc,EAAc9H,EAAW1xB,KAAK0xB,IAChC,MAAM,WAAC+H,EAAU,cAAEC,EAAa,QAAEC,GAAWjI,GACvC,gBAACkI,GAAmBD,EAE1B,OADAnU,EAAGqU,qBAAqBrU,EAAG+T,YAAaE,EAAYC,EAAeE,EAAiB,GAC7E,IACAlI,KACA0H,EACN,IAGCU,EAAStU,EAAGuU,uBAAuBvU,EAAG+T,aAO5C,OANIO,IAAWpM,GAAkBsM,sBAC7BvzB,QAAQC,KAAK,kCAAkCgnB,GAAkBoM,MAGrExjC,KAAK2jC,kBAAkBzU,GAEhBgU,CACX,CAEA,kBAAOU,CAAY1U,EAA4B4T,EAA0Bc,GACrE,MAAM,oBAACxB,GAAuBU,EACH5T,EAAGqD,aAAarD,EAAG6T,uBACnBX,GACvBlT,EAAG8T,gBAAgB9T,EAAG+T,YAAab,GAGvClT,EAAG0U,YAAYA,GAEf,MAAMJ,EAAStU,EAAGuU,uBAAuBvU,EAAG+T,aACxCO,IAAWpM,GAAkBsM,sBAC7BvzB,QAAQC,KAAK,kCAAkCgnB,GAAkBoM,MAGrExjC,KAAK2jC,kBAAkBzU,EAC3B,CAEA,yBAAO2U,CAAmB3U,EAA4B4T,KAA6BgB,GAC/E,MAAM,oBAAC1B,GAAuBU,EACH5T,EAAGqD,aAAarD,EAAG6T,uBACnBX,GACvBlT,EAAG8T,gBAAgB9T,EAAG+T,YAAab,GAGvC,MAAMc,EAAcY,EAAMp6B,KAAKo6B,IAC3B5U,EAAG6U,wBAAwB7U,EAAG+T,YAAaa,EAAMX,WAAYjU,EAAGsT,aAAcsB,EAAME,aAAa1B,sBAC1F,IACAwB,KACAhB,MAILU,EAAStU,EAAGuU,uBAAuBvU,EAAG+T,aAO5C,OANIO,IAAWpM,GAAkBsM,sBAC7BvzB,QAAQC,KAAK,kCAAkCgnB,GAAkBoM,MAGrExjC,KAAK2jC,kBAAkBzU,GAEhBgU,CACX,CAEA,WAAOe,CAAK/U,EAA4BgV,EAAqCC,EAAqCC,EAAyBC,EAAyBC,EAAkB1Q,GAElL,GAD+B1E,EAAGqD,aAAarD,EAAGqV,4BACnBL,EAAiB,CAC5C,MAAMM,EAA0BN,GAAiB9B,qBAAuB,KACxElT,EAAG8T,gBAAgB9T,EAAGuV,iBAAkBD,E,CAI5C,GAD+BtV,EAAGqD,aAAarD,EAAGwV,4BACnBP,EAAiB,CAC5C,MAAMQ,EAA0BR,GAAiB/B,qBAAuB,KACxElT,EAAG8T,gBAAgB9T,EAAG0V,iBAAkBD,E,CAG5CzV,EAAG2V,gBAAgBT,EAAc,GAAIA,EAAc,GAAIA,EAAc,GAAIA,EAAc,GAAIC,EAAc,GAAIA,EAAc,GAAIA,EAAc,GAAIA,EAAc,GAAIC,EAAM1Q,GAEzK5zB,KAAK2jC,kBAAkBzU,EAC3B,CAEA,iBAAO4V,CAAW5V,EAA4B7rB,EAAWC,EAAWwI,EAAeC,EAAgBg5B,EAA4B/5B,EAAwBg6B,GACnJ9V,EAAG4V,WAAWzhC,EAAGC,EAAGwI,EAAOC,EAAQg5B,EAAQ/5B,EAAMg6B,EACrD,CAEA,sBAAOhC,CAAgB9T,EAA4B4T,GAC/C,MAAM,oBAACV,GAAuBU,EAC9B5T,EAAG8T,gBAAgB9T,EAAG+T,YAAab,EACvC,CAEA,wBAAOuB,CAAkBzU,GACrBA,EAAG8T,gBAAgB9T,EAAG+T,YAAa,KACvC,CAEA,wBAAOgC,CAAkB/V,EAA4B4T,GACjD,MAAM,oBAACV,GAAuBU,EAC1B5T,EAAGgW,cAAc9C,IACjBlT,EAAG+V,kBAAkB7C,EAE7B,CAEA,yBAAO+C,CAAmBjW,EAA4B8U,GAClD,MAAM,qBAAC1B,GAAwB0B,EAC3B9U,EAAGkW,eAAe9C,IAClBpT,EAAGiW,mBAAmB7C,EAE9B,GCxRJ,SAAY7K,GACR,wBACA,oBACA,sBACA,gCACA,4CACA,4CACA,yCACA,oBACA,mBACA,qCACA,mCACA,qCACA,sCACH,CAdD,CAAYA,KAAAA,GAAkB,KAgB9B,SAAYC,GACR,wBACA,oBACA,sBACA,gCACA,4CACA,iDACA,iDACA,mDACA,+CACA,iDACA,mBACA,+BACA,qBACA,iCACA,uBACA,mCACA,2BACA,yBACA,yBACA,6BACA,qCACA,mCACA,uBACA,yBACA,uCACA,uBACA,2BACA,6BACA,uBACA,yBACA,2BACA,6BACA,2CACA,6BACA,uBACA,uBACA,yBACA,uBACA,yBACA,uBACA,yBACA,yBACA,2BACA,yBACA,2BACA,yBACA,2BACA,2BACA,6BACA,2BACA,6BACA,2BACA,6BACA,6BACA,+BACA,6BACA,8BACH,CA1DD,CAAYA,KAAAA,GAA0B,KA4DtC,SAAYC,GACR,sBACA,wCACA,wBACA,0CACA,oBACA,sCACA,wBACA,kCACA,2DACA,2DACA,uDACA,qEACA,iDACA,uEACA,+DACA,2EACA,kDACH,CAlBD,CAAYA,KAAAA,GAAgB,KAoB5B,SAAYC,GACR,mDACA,mDACA,2CACA,2CACA,mDACA,iDACA,6CACA,6CACA,2CACA,uDACA,sDACH,CAZD,CAAYA,KAAAA,GAAgB,KAc5B,SAAYC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","sources":["webpack://main/webpack/bootstrap","webpack://main/webpack/runtime/define property getters","webpack://main/webpack/runtime/global","webpack://main/webpack/runtime/hasOwnProperty shorthand","webpack://main/webpack/runtime/make namespace object","webpack://main/webpack/runtime/publicPath","webpack://main/./src/engine/libs/patterns/injectors/Injector.ts","webpack://main/./src/engine/libs/maths/MathError.ts","webpack://main/./src/engine/libs/maths/algebra/vectors/Vector2.ts","webpack://main/./src/engine/libs/maths/algebra/vectors/Vector3.ts","webpack://main/./src/engine/core/input/Input.ts","webpack://main/./src/engine/libs/maths/geometry/space/Space.ts","webpack://main/./src/engine/core/controls/FreeCameraControl.ts","webpack://main/./src/engine/libs/patterns/pools/Pool.ts","webpack://main/./src/engine/libs/patterns/pools/StackPool.ts","webpack://main/./src/engine/libs/maths/Snippets.ts","webpack://main/./src/engine/libs/maths/algebra/matrices/Matrix3.ts","webpack://main/./src/engine/libs/maths/algebra/quaternions/Quaternion.ts","webpack://main/./src/engine/libs/maths/algebra/matrices/Matrix4.ts","webpack://main/./src/engine/libs/maths/extensions/pools/Vector3Pools.ts","webpack://main/./src/engine/libs/maths/statistics/random/UUIDGenerator.ts","webpack://main/./src/engine/core/general/Transform.ts","webpack://main/./src/engine/libs/maths/geometry/primitives/Plane.ts","webpack://main/./src/engine/libs/physics/collisions/Frustum.ts","webpack://main/./src/engine/core/rendering/scenes/objects/Object3D.ts","webpack://main/./src/engine/core/rendering/scenes/cameras/Camera.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLBufferUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLVertexArrayUtilities.ts","webpack://main/./src/engine/core/rendering/scenes/cameras/PerspectiveCamera.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/GeometryBuffer.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/Geometry.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/bounding/BoundingSphere.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/bounding/BoundingBox.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/geometry.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLFramebufferUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLTextureUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLProgramUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLUniformUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLRendererUtilities.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/GeometryBuilder.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/lib/polyhedron/CubeGeometry.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/lib/QuadGeometry.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLUniformBlockUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLPacketUtilities.ts","webpack://main/./src/engine/libs/graphics/colors/Color.ts","webpack://main/./src/samples/scenes/SimpleScene.ts","webpack://main/../editor/lib/models/Model.js","webpack://main/../editor/lib/elements/Snippets.js","webpack://main/../editor/lib/elements/Element.js","webpack://main/../editor/lib/stylesheets/Theme.js","webpack://main/../editor/lib/elements/containers/menus/MenuItem.js","webpack://main/../editor/lib/elements/containers/menus/MenuItemGroup.js","webpack://main/../editor/lib/elements/containers/menus/Menu.js","webpack://main/../editor/lib/elements/containers/menus/MenuBar.js","webpack://main/../editor/lib/elements/containers/menus/MenuButton.js","webpack://main/../editor/lib/elements/containers/toolbars/ToolBarItem.js","webpack://main/../editor/lib/elements/containers/toolbars/ToolBarItemGroup.js","webpack://main/../editor/lib/elements/containers/toolbars/ToolBar.js","webpack://main/../editor/lib/elements/misc/Handle.js","webpack://main/../editor/lib/elements/misc/Import.js","webpack://main/../editor/lib/elements/misc/Loader.js","webpack://main/../editor/lib/elements/misc/Separator.js","webpack://main/../editor/lib/elements/misc/ToolTip.js","webpack://main/./main.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","export { Injector };\r\nexport { InjectorBase };\r\nexport { Inject };\r\nexport { Register };\r\n\r\ninterface InjectorConstructor {\r\n    readonly prototype: Injector;\r\n    new<C extends Constructor<any>>(args: {defaultCtor: C, onDefaultOverride: (constructor: C) => void}): Injector<C>;\r\n}\r\n\r\ninterface Injector<C extends Constructor<any> = Constructor<any>> {\r\n    readonly defaultCtor: C;\r\n    overrideDefaultCtor(constructor: C): void;\r\n    forceQualifier(qualifier: string): void;\r\n    unforceQualifier(): void;\r\n    getConstructor(qualifier?: string): C;\r\n    inject(args?: { qualifier?: string, args?: ConstructorParameters<C> }): InstanceType<C>;\r\n    register(constructor: C, qualifier: string): void; \r\n}\r\n\r\nclass InjectorBase<C extends Constructor<any> = Constructor<any>> implements Injector<C> {\r\n    private _forcedQualifier?: string;\r\n    private _constructors: Map<string, C>;\r\n    private _defaultCtor: C;\r\n    private _onDefaultOverride: (constructor: C) => void;\r\n\r\n    get defaultCtor(): C {\r\n        return this._defaultCtor;\r\n    }\r\n\r\n    overrideDefaultCtor(constructor: C): void {\r\n        this._defaultCtor = constructor;\r\n        this._onDefaultOverride(constructor);\r\n    }\r\n\r\n    constructor(args: {defaultCtor: C, onDefaultOverride: (constructor: C) => void}) {\r\n        this._defaultCtor = args.defaultCtor;\r\n        this._onDefaultOverride = args.onDefaultOverride;\r\n        this._constructors = new Map();\r\n    }\r\n\r\n    forceQualifier(qualifier: string): void {\r\n        this._forcedQualifier = qualifier;\r\n    }\r\n\r\n    unforceQualifier(): void {\r\n        delete this._forcedQualifier;\r\n    }\r\n\r\n    getConstructor(qualifier?: string): C {\r\n        const qualifierValue = this._forcedQualifier || qualifier;\r\n        if (typeof qualifierValue === 'undefined') {\r\n            return this._defaultCtor;\r\n        }\r\n        const constructor = this._constructors.get(qualifierValue);\r\n        if (typeof constructor === 'undefined') {\r\n            throw new Error(`No constructor for qualifier ${qualifierValue}`);\r\n        }\r\n        return constructor;\r\n    }\r\n\r\n    inject(args?: { qualifier?: string, args?: ConstructorParameters<C> }): InstanceType<C> {\r\n        const constructor = this.getConstructor(args?.qualifier);\r\n        if (args?.args) {\r\n            const parameters = Array.from(args.args);\r\n            return new constructor(...parameters);\r\n        }\r\n        return new constructor();\r\n    }\r\n\r\n    register(constructor: C, qualifier: string): void {\r\n        if (!this._constructors.has(qualifier)) {\r\n            this._constructors.set(qualifier, constructor);\r\n        }\r\n    }\r\n}\r\n\r\nconst Injector: InjectorConstructor = InjectorBase;\r\n\r\ntype UnwrappedInjectorConstructor<I> = I extends Injector<infer C> ? C : never;\r\n\r\ninterface RegisterDecorator {\r\n    <I extends Injector>(injector: I, qualifier?: string): <C extends UnwrappedInjectorConstructor<I>>(ctor: C) => C;\r\n}\r\n\r\nconst Register: RegisterDecorator = function<\r\n    I extends Injector\r\n>(injector: I, qualifier?: string): any {\r\n    return <C extends UnwrappedInjectorConstructor<I>>(\r\n        ctor: C\r\n    ) => {\r\n        if (typeof qualifier !== 'undefined') {\r\n            injector.register(ctor, qualifier);\r\n        }\r\n        injector.register(ctor, ctor.name);\r\n        return ctor;\r\n    }\r\n}\r\n\r\nfunction Inject<\r\n    I extends Injector,\r\n    P extends ConstructorParameters<UnwrappedInjectorConstructor<I>>,\r\n>(injector: I, options?: {qualifier?: string, args?: P}): any {\r\n    return (\r\n        target: any,\r\n        propertyKey: string\r\n    ) => {\r\n        const instance = injector.inject(options);\r\n\r\n        Object.defineProperty(target, propertyKey, {\r\n            value: instance\r\n        });\r\n    }\r\n}","export class MathError extends Error {\r\n    name = 'MathError';\r\n}","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { Matrix2 } from \"../matrices/Matrix2\";\r\n\r\nexport { Vector2Injector };\r\nexport { Vector2 };\r\nexport { Vector2Base };\r\n\r\nexport type Vector2Values = [number, ...number[]] & { length: 2 };\r\n\r\ninterface Vector2Constructor {\r\n\treadonly prototype: Vector2;\r\n\tnew(): Vector2;\r\n\tnew(a: number, y: number): Vector2;\r\n  \tnew(array: ArrayLike<number>): Vector2;\r\n}\r\n\r\ninterface Vector2 {\r\n\treadonly array: Float32Array;\r\n\tvalues: Vector2Values;\r\n\tx: number;\r\n\ty: number;\r\n\tsetValues(x: number, y: number): this;\r\n\tcopy(vec: Vector2): this;\r\n\tclone(): this;\r\n\tequals(vec: Vector2): boolean;\r\n\tsetUnit(): this;\r\n\tsetZeros(): this;\r\n\tadd(vec: Vector2): this;\r\n\taddScalar(k: number): this;\r\n\tsub(vec: Vector2): this;\r\n\tlerp(vec: Vector2, t: number): this;\r\n\tclamp(min: Vector2, max: Vector2): this;\r\n\tmultScalar(k: number): this;\r\n\tcross(vec: Vector2): number;\r\n\tdot(vec: Vector2): number;\r\n\tlength(): number;\r\n\tlengthSquared(): number;\r\n\tdist(vec: Vector2): number;\r\n\tdistSquared(vec: Vector2): number;\r\n\tnormalize(): this;\r\n\tnegate(): this;\r\n\tmult(vec: Vector2): this;\r\n\tmult(mat: Matrix2): this\r\n\taddScaled(vec: Vector2, k: number): this;\r\n\tcopyAndSub(vecA: Vector2, vecB: Vector2): this;\r\n\twriteIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n    readFromArray(arr: ArrayLike<number>, offset?: number): this;\r\n}\r\n\r\nclass Vector2Base {\r\n\treadonly array: Float32Array;\r\n\r\n\tconstructor()\r\n\tconstructor(array: ArrayLike<number>)\r\n\t  constructor(\r\n\t  x: number, y: number\r\n\t)\r\n\tconstructor(\r\n\t  ...args: any[]\r\n\t) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis.array = new Float32Array([args[0], args[1]]);\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n\t\t\tconst array = args[0];\r\n\t\t\tif (array.length < 2) {\r\n\t\t\t\tthrow new MathError(`Array must be of length 2 at least.`);\r\n\t\t\t}\r\n\t\t\tif (array instanceof Float32Array) {\r\n\t\t\t\tthis.array = array;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.array = new Float32Array(array);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.array = new Float32Array([0, 0]);\r\n\t\t}\r\n\t}\r\n\r\n\tget values(): Vector2Values {\r\n\t\treturn [\r\n\t\t\tthis.array[0],\r\n\t\t\tthis.array[1]\r\n\t\t];\r\n\t}\r\n\r\n\tset values(values: Vector2Values) {\r\n\t\tthis.array[0] = values[0];\r\n\t\tthis.array[1] = values[1];\r\n\t}\r\n\r\n\tget x() {\r\n\t\treturn this.array[0];\r\n\t}\r\n\r\n\tset x(x: number) {\r\n\t\tthis.array[0] = x;\r\n\t}\r\n\r\n\tget y() {\r\n\t\treturn this.array[1];\r\n\t}\r\n\r\n\tset y(y: number) {\r\n\t\tthis.array[1] = y;\r\n\t}\r\n\r\n\tsetValues(x: number, y: number): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = x;\r\n\t\to[1] = y;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tequals(vec: Vector2Base): boolean {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\t\t\r\n\t\treturn v[0] === o[0]\r\n\t\t\t&& v[1] === o[1];\r\n\t}\r\n\r\n\tcopy(vec: Vector2Base): this {\r\n\t\tconst o = this.array;\r\n\t\tconst v = vec.array;\r\n\r\n\t\to[0] = v[0];\r\n\t\to[1] = v[1];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone(): this {\r\n\t\treturn new Vector2Base(this.values) as this;\r\n\t}\r\n\r\n\tsetUnit(): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = 1;\r\n\t\to[1] = 1;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetZeros(): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = 0;\r\n\t\to[1] = 0;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tadd(vec: Vector2Base): this {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] + v[0];\r\n\t\to[1] = o[1] + v[1];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\taddScalar(k: number): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] + k;\r\n\t\to[1] = o[1] + k;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsub(vec: Vector2Base): this {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] - v[0];\r\n\t\to[1] = o[1] - v[1];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tlerp(vec: Vector2Base, t: number): this {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = t * (v[0] - o[0]);\r\n\t\to[1] = t * (v[1] - o[1]);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclamp(min: Vector2Base, max: Vector2Base): this {\r\n\t\tconst o = this.array;\r\n\t\tconst l = min.array;\r\n\t\tconst g = max.array;\r\n\r\n\t\to[0] = Math.min(g[0], Math.min(o[0], l[0])),\r\n\t\to[1] = Math.min(g[1], Math.min(o[1], l[1]))\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmultScalar(k: number): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] * k;\r\n\t\to[1] = o[1] * k;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcross(vec: Vector2Base): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\treturn a[0] * b[1] - a[1] * b[0];\r\n\t}\r\n\r\n\tdot(vec: Vector2Base): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\treturn (a[0] * b[0]) + (a[1] * b[1]);\r\n\t}\r\n\r\n\tlength(): number {\r\n\t\tconst v = this.array;\r\n\r\n\t\treturn Math.sqrt(v[0] * v[0] + v[1] * v[1]);\r\n\t}\r\n\r\n\tlengthSquared(): number {\r\n\t\tconst v = this.array;\r\n\r\n\t\treturn v[0] * v[0] + v[1] * v[1];\r\n\t}\r\n\r\n\tdist(vec: Vector2Base): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\tconst dx = a[0] - b[0];\r\n\t\tconst dy = a[1] - b[1];\r\n\r\n\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t}\r\n\r\n\tdistSquared(vec: Vector2Base): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\tconst dx = a[0] - b[0];\r\n\t\tconst dy = a[1] - b[1];\r\n\r\n\t\treturn dx * dx + dy * dy;\r\n\t}\r\n\r\n\tnormalize(): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\tconst lenSq = o[0] * o[0] + o[1] * o[1];\r\n\t\tconst len = Math.sqrt(lenSq);\r\n\t\tif (len > Number.EPSILON) {\r\n\t\t\to[0] = o[0] / len;\r\n\t\t\to[1] = o[1] / len;\r\n\t\t}\r\n\t\telse {\r\n\t\t\to[0] = 0;\r\n\t\t\to[1] = 0;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnegate(): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = -o[0];\r\n\t\to[1] = -o[1];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmult(mat: Matrix2): this\r\n\tmult(vec: Vector2): this\r\n\tmult(arg0: Matrix2 | Vector2): this {\r\n\t\tif (arg0 instanceof Vector2) {\r\n\t\t\tconst v = arg0.array;\r\n\r\n\t\t\tthis.array[0] = this.array[0] * v[0];\r\n\t\t\tthis.array[1] = this.array[1] * v[1];\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst x = this.x;\r\n\t\t\tconst y = this.y;\r\n\r\n\t\t\tconst m = arg0.array;\r\n\r\n\t\t\tthis.x = x * m[0] + y * m[2];\r\n\t\t\tthis.y = x * m[1] + y * m[3];\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\taddScaled(vec: Vector2Base, k: number): this {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] + v[0] * k;\r\n\t\to[1] = o[1] + v[1] * k;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\twriteIntoArray(out: WritableArrayLike<number>, offset: number = 0): void {\r\n\t\tconst v = this.array;\r\n\r\n\t\tout[offset    ] = v[0];\r\n\t\tout[offset + 1] = v[1];\r\n    }\r\n    \r\n    readFromArray(arr: ArrayLike<number>, offset: number = 0): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = arr[offset    ];\r\n\t\to[1] = arr[offset + 1];\r\n\r\n\t\treturn this;\r\n    }\r\n\r\n\tcopyAndSub(vecA: Vector2Base, vecB: Vector2Base): this {\r\n\t\tconst o = this.array;\r\n\t\tconst a = vecA.array;\r\n\t\tconst b = vecB.array;\r\n\t\r\n\t\to[0] = a[0] - b[0];\r\n\t\to[1] = a[1] - b[1];\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nvar Vector2: Vector2Constructor = Vector2Base;\r\nconst Vector2Injector: Injector<Vector2Constructor> = new Injector({\r\n\tdefaultCtor: Vector2Base,\r\n\tonDefaultOverride:\r\n\t\t(ctor: Vector2Constructor) => {\r\n\t\t\tVector2 = ctor;\r\n\t\t}\r\n});","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { Matrix3 } from \"../matrices/Matrix3\";\r\n\r\nexport { Vector3Constructor };\r\nexport { Vector3 };\r\nexport { Vector3Base };\r\nexport { Vector3Injector };\r\n\r\nexport type Vector3Values = [number, ...number[]] & { length: 3 };\r\n\r\ninterface Vector3Constructor {\r\n\treadonly prototype: Vector3;\r\n\tnew(): Vector3;\r\n\tnew(x: number, y: number, z: number): Vector3;\r\n  \tnew(array: ArrayLike<number>): Vector3;\r\n\tangle(vectorA: Vector3, vectorB: Vector3): number;\r\n}\r\n\r\ninterface Vector3 extends Iterable<number> {\r\n\treadonly array: Float32Array;\r\n\tvalues: Vector3Values;\r\n\tx: number;\r\n\ty: number;\r\n\tz: number;\r\n\ttoString(): string;\r\n\tsetValues(\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\tz: number\r\n\t): this;\r\n\tequals(vec: Vector3): boolean;\r\n\tcopy(vec: Vector3): this;\r\n\tclone(): this;\r\n\tsetUnit(): this;\r\n\tsetZeros(): this;\r\n\ttoCartesian(center: Vector3): this;\r\n\ttoSpherical(center: Vector3): this;\r\n\tadd(vec: Vector3): this;\r\n\taddScalar(k: number): this;\r\n\tsub(vec: Vector3): this;\r\n\tlerp(from: Vector3, to: Vector3, t: number): this;\r\n\tmax(vecB: Vector3): this;\r\n\tmin(vecB: Vector3): this;\r\n\tclamp(min: Vector3, max: Vector3): this;\r\n\tscale(k: number): this;\r\n\tcross(vec: Vector3): this;\r\n\tdot(vec: Vector3): number;\r\n\tlength(): number;\r\n\tlengthSquared(): number;\r\n\tdistance(vec: Vector3): number;\r\n\tdistanceSquared(vec: Vector3): number;\r\n\tnormalize(): this;\r\n\tnegate(): this;\r\n\tmult(vec: Vector3): this;\r\n\tmult(mat: Matrix3): this;\r\n\taddScaled(vec: Vector3, k: number): this;\r\n\tcopyAndSub(vecA: Vector3, vecB: Vector3): this;\r\n\tcopyAndCross(vecA: Vector3, vecB: Vector3): this;\r\n\twriteIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n    readFromArray(arr: ArrayLike<number>, offset?: number): this;\r\n}\r\n\r\nclass Vector3Base implements Vector3 {\r\n\treadonly array: Float32Array;\r\n\r\n\tconstructor()\r\n\tconstructor(array: ArrayLike<number>)\r\n\t  constructor(\r\n\t  x: number, y: number, z: number\r\n\t)\r\n\tconstructor(\r\n\t  ...args: any[]\r\n\t) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis.array = new Float32Array([args[0], args[1], args[2]]);\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n\t\t\tconst array = args[0];\r\n\t\t\tif (array.length < 3) {\r\n\t\t\t\tthrow new MathError(`Array must be of length 3 at least.`);\r\n\t\t\t}\r\n\t\t\tif (array instanceof Float32Array) {\r\n\t\t\t\tthis.array = array;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.array = new Float32Array(array);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.array = new Float32Array([0, 0, 0]);\r\n\t\t}\r\n\t}\r\n\r\n\ttoString(): string {\r\n\t\treturn `Vector3([${Array.from(this.array).join(\", \")}])`;\r\n\t}\r\n\r\n\tstatic angle(vectorA: Vector3, vectorB: Vector3): number {\r\n\t\tconst temp = new Vector3();\r\n\t\treturn Math.acos(temp.copy(vectorA).dot(vectorB) / (Math.sqrt(temp.copy(vectorA).dot(vectorA)) * Math.sqrt(temp.copy(vectorB).dot(vectorB))));\r\n\t}\r\n\r\n\tget values(): Vector3Values {\r\n\t\treturn [\r\n\t\t\tthis.array[0],\r\n\t\t\tthis.array[1],\r\n\t\t\tthis.array[2]\r\n\t\t];\r\n\t}\r\n\r\n\tset values(values: Vector3Values) {\r\n\t\tthis.array[0] = values[0];\r\n\t\tthis.array[1] = values[1];\r\n\t\tthis.array[2] = values[2];\r\n\t}\r\n\r\n\tget x() {\r\n\t\treturn this.array[0];\r\n\t}\r\n\r\n\tset x(x: number) {\r\n\t\tthis.array[0] = x;\r\n\t}\r\n\r\n\tget y() {\r\n\t\treturn this.array[1];\r\n\t}\r\n\r\n\tset y(y: number) {\r\n\t\tthis.array[1] = y;\r\n\t}\r\n\r\n\tget z() {\r\n\t\treturn this.array[2];\r\n\t}\r\n\r\n\tset z(z: number) {\r\n\t\tthis.array[2] = z;\r\n\t}\r\n\r\n\tsetValues(x: number, y: number, z: number): this {\r\n\t\tthis.array[0] = x;\r\n\t\tthis.array[1] = y;\r\n\t\tthis.array[2] = z;\r\n\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tcopy(vec: Vector3): this {\r\n\t\tconst v = vec.array;\r\n\r\n\t\tthis.array[0] = v[0];\r\n\t\tthis.array[1] = v[1];\r\n\t\tthis.array[2] = v[2];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone(): this {\r\n\t\treturn new Vector3Base(this.values) as this;\r\n\t}\r\n\r\n\tequals(vector: Vector3): boolean {\r\n\t\treturn vector.array[0] === this.array[0]\r\n\t\t\t&& vector.array[1] === this.array[1]\r\n\t\t\t&& vector.array[2] === this.array[2];\r\n\t}\r\n\r\n\tsetZeros(): this {\r\n\t\tthis.array[0] = 0;\r\n\t\tthis.array[1] = 0;\r\n\t\tthis.array[2] = 0;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetUnit(): this {\r\n\t\tthis.array[0] = 1;\r\n\t\tthis.array[1] = 1;\r\n\t\tthis.array[2] = 1;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tadd(vector: Vector3): this {\r\n\t\tthis.array[0] = this.array[0] + vector.array[0];\r\n\t\tthis.array[1] = this.array[1] + vector.array[1];\r\n\t\tthis.array[2] = this.array[2] + vector.array[2];\r\n\t\treturn this;\r\n\t}\r\n\r\n\taddScalar(k: number): this {\r\n\t\tthis.array[0] = this.array[0] + k;\r\n\t\tthis.array[1] = this.array[1] + k;\r\n\t\tthis.array[2] = this.array[2] + k;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsub(vector: Vector3): this {\r\n\t\tthis.array[0] = this.array[0] - vector.array[0];\r\n\t\tthis.array[1] = this.array[1] - vector.array[1];\r\n\t\tthis.array[2] = this.array[2] - vector.array[2];\r\n\t\treturn this;\r\n\t}\r\n\r\n\tlerp(from: Vector3, to: Vector3, t: number): this {\r\n\t\tthis.array[0] = (1 - t) * from.x + t * (to.x - from.x);\r\n\t\tthis.array[1] = (1 - t) * from.y + t * (to.y - from.y);\r\n\t\tthis.array[2] = (1 - t) * from.z + t * (to.z - from.z);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmax(vectorB: Vector3): this {\r\n\t\tthis.array[0] = Math.max(this.array[0], vectorB.array[0]);\r\n\t\tthis.array[1] = Math.max(this.array[1], vectorB.array[1]);\r\n\t\tthis.array[2] = Math.max(this.array[2], vectorB.array[2]);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmin(vectorB: Vector3): this {\r\n\t\tthis.array[0] = Math.min(this.array[0], vectorB.array[0]);\r\n\t\tthis.array[1] = Math.min(this.array[1], vectorB.array[1]);\r\n\t\tthis.array[2] = Math.min(this.array[2], vectorB.array[2]);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclamp(min: Vector3, max: Vector3): this {\r\n\t\tthis.array[0] = Math.min(max.array[0], Math.max(this.array[0], min.array[0]));\r\n\t\tthis.array[1] = Math.min(max.array[1], Math.max(this.array[1], min.array[1]));\r\n\t\tthis.array[2] = Math.min(max.array[2], Math.max(this.array[2], min.array[2]));\r\n\t\treturn this;\r\n\t}\r\n\r\n\tscale(k: number): this {\r\n\t\tthis.array[0] = this.array[0] * k;\r\n\t\tthis.array[1] = this.array[1] * k;\r\n\t\tthis.array[2] = this.array[2] * k;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcross(vector: Vector3): this {\r\n\t\tconst t0 = this.array[1] * vector.array[2] - this.array[2] * vector.array[1];\r\n\t\tconst t1 = this.array[2] * vector.array[0] - this.array[0] * vector.array[2];\r\n\t\tconst t2 = this.array[0] * vector.array[1] - this.array[1] * vector.array[0];\r\n\t\tthis.array[0] = t0;\r\n\t\tthis.array[1] = t1;\r\n\t\tthis.array[2] = t2;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdot(vec: Vector3): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\treturn a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n\t}\r\n\r\n\tlength(): number {\r\n\t\tconst a = this.array;\r\n\r\n\t\treturn Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\r\n\t}\r\n\r\n\tlengthSquared(): number {\r\n\t\tconst a = this.array;\r\n\t\t\r\n\t\treturn a[0] * a[0] + a[1] * a[1] + a[2] * a[2];\r\n\t}\r\n\r\n\tdistance(vec: Vector3): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\tconst dx = a[0] - b[0];\r\n\t\tconst dy = a[1] - b[1];\r\n\t\tconst dz = a[2] - b[2];\r\n\r\n\t\treturn Math.hypot(dx, dy, dz);\r\n\t}\r\n\r\n\tdistanceSquared(vec: Vector3): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\tconst dx = a[0] - b[0];\r\n\t\tconst dy = a[1] - b[1];\r\n\t\tconst dz = a[2] - b[2];\r\n\r\n\t\treturn dx * dx + dy * dy + dz * dz;\r\n\t}\r\n\r\n\tnormalize(): this {\r\n\t\tconst {array} = this;\r\n\t\tconst length = this.length();\r\n\t\tif (length > Number.EPSILON) {\r\n\t\t\tarray[0] /= length;\r\n\t\t\tarray[1] /= length;\r\n\t\t\tarray[2] /= length;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tarray[0] = 0;\r\n\t\t\tarray[1] = 0;\r\n\t\t\tarray[2] = 0;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnegate(): this {\r\n\t\tconst {array} = this;\r\n\t\tarray[0] *= -1;\r\n\t\tarray[1] *= -1;\r\n\t\tarray[2] *= -1;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmult(mat: Matrix3): this\r\n\tmult(vec: Vector3): this\r\n\tmult(arg0: Matrix3 | Vector3): this {\r\n\t\tconst {array} = this;\r\n\t\tif (arg0 instanceof Vector3) {\r\n\t\t\tconst v = arg0.array;\r\n\r\n\t\t\tarray[0] = array[0] * v[0];\r\n\t\t\tarray[1] = array[1] * v[1];\r\n\t\t\tarray[2] = array[2] * v[2];\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst [x, y, z] = this;\r\n\r\n\t\t\tconst m = arg0.array;\r\n\r\n\t\t\tthis.x = x * m[0] + y * m[3] + z * m[6];\r\n\t\t\tthis.y = x * m[1] + y * m[4] + z * m[7];\r\n\t\t\tthis.z = x * m[2] + y * m[5] + z * m[8];\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\ttoSpherical(center: Vector3): this {\r\n        const thisArray = this.array;\r\n        const centerArray = center.array;\r\n\r\n        const x = thisArray[0] - centerArray[0];\r\n        const y = thisArray[1] - centerArray[1];\r\n        const z = thisArray[2] - centerArray[2];\r\n\r\n        const roh = Math.hypot(x, y, z);\r\n        const theta = Math.acos(y / roh);\r\n        const phi = Math.atan2(z, x);\r\n        thisArray[0] = roh;\r\n        thisArray[1] = theta;\r\n        thisArray[2] = phi;\r\n\r\n\t\treturn this;\r\n    }\r\n\r\n    toCartesian(center: Vector3): this {\r\n        const thisArray = this.array;\r\n        const centerArray = center.array;\r\n\r\n        const roh = thisArray[0];\r\n        const theta = thisArray[1];\r\n        const phi = thisArray[2];\r\n\r\n        const x = roh * Math.sin(theta) * Math.cos(phi) + centerArray[0];\r\n        const y = roh * Math.cos(theta) + centerArray[1];\r\n        const z = roh * Math.sin(theta) * Math.sin(phi) + centerArray[2];\r\n        thisArray[0] = x;\r\n        thisArray[1] = y;\r\n        thisArray[2] = z;\r\n\r\n\t\treturn this;\r\n    }\r\n\r\n\tstatic mult(mat: Matrix3, vec: Vector3): Vector3 {\r\n\t\tconst m = mat.array;\r\n\t\tconst v = vec.array;\r\n\r\n\t\treturn new Vector3Base([\r\n\t\t\tm[0] * v[0] + m[1] * v[1] + m[2] * v[2],\r\n\t\t\tm[3] * v[0] + m[4] * v[1] + m[5] * v[2],\r\n\t\t\tm[6] * v[0] + m[7] * v[1] + m[8] * v[2]\r\n\t\t]);\r\n\t}\r\n\r\n\twriteIntoArray(out: WritableArrayLike<number>, offset: number = 0): void {\r\n\t\tconst v = this.array;\r\n\r\n\t\tout[offset    ] = v[0];\r\n\t\tout[offset + 1] = v[1];\r\n\t\tout[offset + 2] = v[2];\r\n    }\r\n    \r\n    readFromArray(arr: ArrayLike<number>, offset: number = 0): this {\r\n\t\tthis.array[0] = arr[offset    ];\r\n\t\tthis.array[1] = arr[offset + 1];\r\n\t\tthis.array[2] = arr[offset + 2];\r\n\r\n\t\treturn this;\r\n    }\r\n\r\n\taddScaled(vector: Vector3, k: number): this {\r\n\t\tthis.array[0] = this.array[0] + vector.array[0] * k;\r\n\t\tthis.array[1] = this.array[1] + vector.array[1] * k;\r\n\t\tthis.array[2] = this.array[2] + vector.array[2] * k;\r\n\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tcopyAndSub(vecA: Vector3, vecB: Vector3): this {\r\n\t\tconst a = vecA.array;\r\n\t\tconst b = vecB.array;\r\n\t\r\n\t\tthis.array[0] = a[0] - b[0];\r\n\t\tthis.array[1] = a[1] - b[1];\r\n\t\tthis.array[2] = a[2] - b[2];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcopyAndCross(vecA: Vector3, vecB: Vector3): this {\r\n\t\tconst a = vecA.array;\r\n\t\tconst b = vecB.array;\r\n\t\t\r\n\t\tconst t0 = a[1] * b[2] - a[2] * b[1];\r\n\t\tconst t1 = a[2] * b[0] - a[0] * b[2];\r\n\t\tconst t2 = a[0] * b[1] - a[1] * b[0];\r\n\r\n\t\tthis.array[0] = t0;\r\n\t\tthis.array[1] = t1;\r\n\t\tthis.array[2] = t2;\r\n\t\r\n\t\treturn this;\r\n\t}\r\n\r\n\t[Symbol.iterator] (): Iterator<number> {\r\n\t\tconst {array} = this;\r\n\t\tconst {length} = array;\r\n\t\tlet i = 0;\r\n\t\treturn {\r\n\t\t\tnext() {\r\n\t\t\t\tif (i < length) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: array[i++], done: false\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: undefined, done: true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar Vector3: Vector3Constructor = Vector3Base;\r\n\r\nconst Vector3Injector: Injector<Vector3Constructor> = new Injector({\r\n\tdefaultCtor: Vector3Base,\r\n\tonDefaultOverride:\r\n\t\t(ctor: Vector3Constructor) => {\r\n\t\t\tVector3 = ctor;\r\n\t\t}\r\n});","import { Vector2 } from \"../../libs/maths/algebra/vectors/Vector2\";\r\n\r\nexport { Key };\r\nexport { KeyModifier };\r\nexport { HotKey };\r\nexport { MouseButton };\r\nexport { Input };\r\n\r\nenum Key {\r\n    A = \"a\",\r\n    B = \"b\",\r\n    C = \"c\",\r\n    D = \"d\",\r\n    E = \"e\",\r\n    F = \"f\",\r\n    G = \"g\",\r\n    H = \"h\",\r\n    I = \"i\",\r\n    J = \"j\",\r\n    K = \"k\",\r\n    L = \"l\",\r\n    M = \"m\",\r\n    O = \"o\",\r\n    P = \"p\",\r\n    Q = \"q\",\r\n    R = \"r\",\r\n    S = \"s\",\r\n    T = \"t\",\r\n    U = \"u\",\r\n    V = \"v\",\r\n    W = \"w\",\r\n    X = \"x\",\r\n    Y = \"y\",\r\n    Z = \"z\",\r\n    ENTER = \"Enter\",\r\n    BACKSPACE = \"Backspace\",\r\n    ARROW_DOWN = \"ArrowDown\",\r\n    ARROW_LEFT = \"ArrowLeft\",\r\n    ARROW_RIGHT = \"ArrowRight\",\r\n    ARROW_UP = \"ArrowUp\",\r\n    SHIFT = \"Shift\"\r\n}\r\n\r\nconst KEYS_COUNT = Object.keys(Key).length;\r\n\r\nenum KeyModifier {\r\n    Alt = \"Alt\",\r\n    Control = \"Control\",\r\n    Shift = \"Shift\",\r\n}\r\n\r\nfunction displayKeyModifier(mode: KeyModifier): string {\r\n    switch (mode) {\r\n        case KeyModifier.Control:\r\n            return \"Ctrl\";\r\n        default:\r\n            return mode;\r\n    }\r\n}\r\n\r\nenum MouseButton {\r\n    LEFT = 0,\r\n    WHEEL = 1,\r\n    RIGHT = 2,\r\n    FORWARD = 3,\r\n    BACK = 4\r\n}\r\n\r\nconst MOUSE_BUTTONS_COUNT = Object.keys(MouseButton).length;\r\n\r\nconst MOUSE_BUTTONS_INDICES = Object.freeze(\r\n    Object.values(MouseButton).reduce(\r\n        (map, button, index) => Object.assign(map, {[button]: index}), {} as any\r\n    )\r\n);\r\n\r\nconst KEYS_INDICES = Object.freeze(\r\n    Object.values(Key).reduce(\r\n        (map, key, index) => Object.assign(map, {[key]: index}), {} as any\r\n    )\r\n);\r\n\r\nconst INPUT_EVENT_UP = 0;\r\nconst INPUT_EVENT_DOWN = 1;\r\nconst INPUT_EVENT_REPEAT = 2;\r\n\r\nconst testKeyModifier = (mod: KeyModifier, event: KeyboardEvent) => {\r\n    switch (mod) {\r\n        case \"Alt\":\r\n            return event.altKey;\r\n        case \"Control\":\r\n            return event.ctrlKey;\r\n        case \"Shift\":\r\n            return event.shiftKey;\r\n        default:\r\n            return () => true;\r\n    }\r\n}\r\n\r\nclass HotKey {\r\n\r\n    readonly key: Key;\r\n    readonly mod1?: KeyModifier;\r\n    readonly mod2?: KeyModifier;\r\n\r\n    constructor(key: Key, mod1?: KeyModifier, mod2?: KeyModifier) {\r\n        this.key = key;\r\n        this.mod1 = mod1;\r\n        this.mod2 = mod2;\r\n    }\r\n\r\n    toString(): string {\r\n        return `${this.mod1 ? `${displayKeyModifier(this.mod1)}+` : ''}${this.mod2 ? `${displayKeyModifier(this.mod2)}+` : ''}${(this.key.length === 1) ? this.key.toUpperCase() : this.key}`;\r\n    }\r\n\r\n    /*static fromString(str: string): HotKey | null {\r\n        const keys = Object.values(Key);\r\n        const keyModifiers = Object.values(KeyModifier);\r\n\r\n        let key: Key;\r\n        let mod1: KeyModifier | undefined;\r\n        let mod2: KeyModifier | undefined;\r\n\r\n        const keysStr = str.split(' + ');\r\n        if (keysStr.length >= 1) {\r\n            key = keysStr[0] as Key;\r\n            if (!keys.indexOf(key)) {\r\n                return null;\r\n            }\r\n            if (keysStr.length >= 2) {\r\n                mod1 = keysStr[1] as KeyModifier;\r\n                if (!keyModifiers.indexOf(mod1)) {\r\n                    return null;\r\n                }\r\n            }\r\n            if (keysStr.length >= 3) {\r\n                mod2 = keysStr[2] as KeyModifier;\r\n                if (!keyModifiers.indexOf(mod2)) {\r\n                    return null;\r\n                }\r\n            }\r\n            return new HotKey(key, mod1, mod2);\r\n        }\r\n        return null;\r\n    }*/\r\n\r\n    test(event: KeyboardEvent): boolean {\r\n        return ((!this.mod1 || testKeyModifier(this.mod1, event)) && (!this.mod2 || testKeyModifier(this.mod2, event)) && event.key === this.key);\r\n    }\r\n}\r\n\r\ninterface Input {\r\n    initialize(canvas: HTMLCanvasElement): void;\r\n    clear(): void;\r\n    getKey(key: Key): boolean;\r\n    getKeyUp(key: Key): boolean;\r\n    getKeyDown(key: Key): boolean;\r\n    getMouseButton(button: MouseButton): boolean;\r\n    getPointerPosition(): Vector2;\r\n    getPointerScreenPosition(): Vector2;\r\n    getWheelDelta(): number;\r\n    getMouseButtonDown(button: MouseButton): boolean;\r\n    getMouseButtonUp(button: MouseButton): boolean;\r\n}\r\n\r\nclass InputBase implements Input {\r\n    private readonly keyFlags = new Array<boolean>(3 * KEYS_COUNT).fill(false);\r\n    private readonly mouseFlags = new Array<boolean>(3 * MOUSE_BUTTONS_COUNT).fill(false);\r\n    private readonly pointerPosition = new Vector2();\r\n    private wheelDelta = 0;\r\n    private canvas: HTMLCanvasElement | null = null;\r\n    private canvasRectangle: DOMRect | null = null;\r\n\r\n    initialize(canvas: HTMLCanvasElement): void {\r\n        this.canvas = canvas;\r\n        this.canvasRectangle = canvas.getBoundingClientRect();\r\n        canvas.addEventListener(\"pointerdown\", this);\r\n        canvas.addEventListener(\"pointerup\", this);\r\n        canvas.addEventListener(\"contextmenu\", this);\r\n        canvas.addEventListener(\"pointermove\", this);\r\n        canvas.addEventListener(\"wheel\", this);\r\n        canvas.addEventListener(\"keydown\", this);\r\n        canvas.addEventListener(\"keyup\", this);\r\n        canvas.addEventListener(\"focusout\", this);\r\n    }\r\n\r\n    getCanvasRect(): DOMRect {\r\n        const rect = this.canvasRectangle;\r\n        if (rect === null) {\r\n            throw new Error(`Input manager not initialized.`);\r\n        }\r\n        return rect;\r\n    }\r\n\r\n    clear(): void {\r\n        this.keyFlags.fill(false, 0, INPUT_EVENT_REPEAT * KEYS_COUNT);\r\n        this.mouseFlags.fill(false, 0, INPUT_EVENT_REPEAT * MOUSE_BUTTONS_COUNT);\r\n        this.wheelDelta = 0;\r\n    }\r\n    \r\n    handleEvent(event: Event): void {\r\n        let eventIndex = -1;\r\n        switch (event.type) {\r\n            case \"pointerdown\":\r\n                eventIndex = MOUSE_BUTTONS_INDICES[(event as MouseEvent).button as MouseButton];\r\n                this.mouseFlags[INPUT_EVENT_DOWN * MOUSE_BUTTONS_COUNT + eventIndex] = true;\r\n                this.mouseFlags[INPUT_EVENT_REPEAT * MOUSE_BUTTONS_COUNT + eventIndex] = true;\r\n                break;\r\n            case \"pointerup\":\r\n                eventIndex = MOUSE_BUTTONS_INDICES[(event as MouseEvent).button as MouseButton];\r\n                this.mouseFlags[INPUT_EVENT_UP * MOUSE_BUTTONS_COUNT + eventIndex] = true;\r\n                this.mouseFlags[INPUT_EVENT_REPEAT * MOUSE_BUTTONS_COUNT + eventIndex] = false;\r\n                break;\r\n            case \"pointermove\":\r\n                const canvasRect = this.getCanvasRect();\r\n                this.pointerPosition.setValues(\r\n                    ((event as MouseEvent).clientX - canvasRect.left),\r\n                    ((event as MouseEvent).clientY - canvasRect.top),\r\n                );\r\n                break;\r\n            case \"wheel\":\r\n                this.wheelDelta = (event as WheelEvent).deltaY / 100;\r\n                break;\r\n            case \"keydown\":\r\n                eventIndex = KEYS_INDICES[(event as KeyboardEvent).key as Key];\r\n                this.keyFlags[INPUT_EVENT_DOWN * KEYS_COUNT + eventIndex] = true;\r\n                this.keyFlags[INPUT_EVENT_REPEAT * KEYS_COUNT + eventIndex] = true;\r\n                break;\r\n            case \"keyup\":\r\n                eventIndex = KEYS_INDICES[(event as KeyboardEvent).key as Key];\r\n                this.keyFlags[INPUT_EVENT_UP * KEYS_COUNT + eventIndex] = true;\r\n                this.keyFlags[INPUT_EVENT_REPEAT * KEYS_COUNT + eventIndex] = false;\r\n                break;\r\n            case \"focusout\":\r\n                this.keyFlags.fill(false);\r\n                this.mouseFlags.fill(false);\r\n                this.wheelDelta = 0;\r\n                this.pointerPosition.setZeros();\r\n                break;\r\n        }\r\n    }\r\n    \r\n    /*static getAxis(axisName: string) {\r\n\r\n    }\r\n\r\n    static getButton(buttonName: string) {\r\n\r\n    }\r\n\r\n    static getButtonUp(buttonName: string) {\r\n\r\n    }\r\n\r\n    static getButtonDown(buttonName: string) {\r\n\r\n    }*/\r\n\r\n    getKey(key: Key): boolean {\r\n        return this.keyFlags[INPUT_EVENT_REPEAT * KEYS_COUNT + KEYS_INDICES[key]];\r\n    }\r\n\r\n    getKeyUp(key: Key): boolean {\r\n        return this.keyFlags[INPUT_EVENT_UP * KEYS_COUNT + KEYS_INDICES[key]];\r\n    }\r\n\r\n    getKeyDown(key: Key): boolean {\r\n        return this.keyFlags[INPUT_EVENT_DOWN * KEYS_COUNT + KEYS_INDICES[key]];\r\n    }\r\n\r\n    getMouseButton(button: MouseButton): boolean {\r\n        return this.mouseFlags[INPUT_EVENT_REPEAT * MOUSE_BUTTONS_COUNT + MOUSE_BUTTONS_INDICES[button]];\r\n    }\r\n\r\n    getPointerPosition(): Vector2 {\r\n        return this.pointerPosition.clone();\r\n    }\r\n\r\n    getPointerScreenPosition(): Vector2 {\r\n        const positionAray = this.pointerPosition.array;\r\n        const canvasRect = this.getCanvasRect();\r\n        const x = (positionAray[0] / canvasRect.width) * 2 - 1;\r\n        const y = (positionAray[1] / canvasRect.height) * 2 - 1;\r\n        return new Vector2([x, y]);\r\n    }\r\n\r\n    getWheelDelta(): number {\r\n        return this.wheelDelta;\r\n    }\r\n\r\n    getMouseButtonDown(button: MouseButton): boolean {\r\n        return this.mouseFlags[INPUT_EVENT_DOWN * MOUSE_BUTTONS_COUNT + MOUSE_BUTTONS_INDICES[button]];\r\n    }\r\n\r\n    getMouseButtonUp(button: MouseButton): boolean {\r\n        return this.mouseFlags[INPUT_EVENT_UP * MOUSE_BUTTONS_COUNT + MOUSE_BUTTONS_INDICES[button]];\r\n    }\r\n}\r\n\r\nvar Input: Input = new InputBase();","import { Vector3 } from \"../../algebra/vectors/Vector3\";\r\n\r\nexport class Space {\r\n\r\n    private constructor () {};\r\n    \r\n    static readonly origin:      Vector3 = new Vector3([ 0,  0,  0]);\r\n    static readonly right:       Vector3 = new Vector3([ 1,  0,  0]);\r\n    static readonly left:        Vector3 = new Vector3([-1,  0,  0]);\r\n    static readonly up:          Vector3 = new Vector3([ 0,  1,  0]);\r\n    static readonly down:        Vector3 = new Vector3([ 0, -1,  0]);\r\n    static readonly forward:     Vector3 = new Vector3([ 0,  0,  1]);\r\n    static readonly backward:    Vector3 = new Vector3([ 0,  0, -1]);\r\n}","import { Vector2 } from \"../../libs/maths/algebra/vectors/Vector2\";\r\nimport { Vector3 } from \"../../libs/maths/algebra/vectors/Vector3\";\r\nimport { Space } from \"../../libs/maths/geometry/space/Space\";\r\nimport { Input, MouseButton, Key } from \"../input/Input\";\r\nimport { Camera } from \"../rendering/scenes/cameras/Camera\";\r\n\r\nexport { FreeCameraControl };\r\n\r\nconst tempVector1 = new Vector3();\r\nconst tempVector2 = new Vector3();\r\nconst tempVector3 = new Vector3();\r\n\r\ninterface FreeCameraControlConstructor {\r\n    readonly prototype: FreeCameraControl;\r\n    new(camera: Camera, params?: {rotationSpeed?: number, translationSpeed?: number}): FreeCameraControl;\r\n}\r\n\r\ninterface FreeCameraControl {\r\n    camera: Camera;\r\n    rotationSpeed: number;\r\n    translationSpeed: number;\r\n    update(deltaTime: number): void;\r\n}\r\n\r\nclass FreeCameraControlBase {\r\n    camera: Camera;\r\n    rotationSpeed: number;\r\n    translationSpeed: number;\r\n\r\n    #lastPointerPosition: Vector2;\r\n\r\n    constructor(camera: Camera, params?: {rotationSpeed?: number, translationSpeed?: number}) {\r\n        this.camera = camera;\r\n        this.rotationSpeed = params?.rotationSpeed ?? 50;\r\n        this.translationSpeed = params?.translationSpeed ?? 8;\r\n        this.#lastPointerPosition = new Vector2();\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        const {camera, rotationSpeed, translationSpeed} = this;\r\n        const lastPointerPosition = this.#lastPointerPosition;\r\n        const {transform: cameraTransform} = camera;\r\n        const cameraPosition = cameraTransform.getTranslation(tempVector1);\r\n        const cameraForward = cameraTransform.getBackward(tempVector2);\r\n        const {array: cameraForwardArray} = cameraForward;\r\n        const {origin, up, down} = Space;\r\n        let cameraUpSign = cameraTransform.getUp(tempVector3).dot(up);\r\n        \r\n        if (Input.getKey(Key.Z) || Input.getKey(Key.ARROW_UP)) {\r\n            const forward = cameraTransform.getBackward(tempVector3).scale(translationSpeed * deltaTime);\r\n            cameraTransform.translate(forward);\r\n        }\r\n        if (Input.getKey(Key.Q) || Input.getKey(Key.ARROW_LEFT)) {\r\n            const left = cameraTransform.getLeft(tempVector3).scale(translationSpeed * deltaTime);\r\n            cameraTransform.translate(left);\r\n        }\r\n        if (Input.getKey(Key.S) || Input.getKey(Key.ARROW_DOWN)) {\r\n            const backward = cameraTransform.getForward(tempVector3).scale(translationSpeed * deltaTime);\r\n            cameraTransform.translate(backward);\r\n        }\r\n        if (Input.getKey(Key.D) || Input.getKey(Key.ARROW_RIGHT)) {\r\n            const right = cameraTransform.getRight(tempVector3).scale(translationSpeed * deltaTime);\r\n            cameraTransform.translate(right);\r\n        }\r\n\r\n        if (Input.getMouseButtonDown(MouseButton.RIGHT)) {\r\n            lastPointerPosition.copy(Input.getPointerScreenPosition());\r\n        }\r\n        \r\n        if (Input.getMouseButton(MouseButton.RIGHT)) {\r\n            const newPointerPosition = Input.getPointerScreenPosition();\r\n            if (!newPointerPosition.equals(lastPointerPosition)) {\r\n                const dx = (lastPointerPosition.x - newPointerPosition.x) * rotationSpeed * deltaTime;\r\n                const dy = (lastPointerPosition.y - newPointerPosition.y) * rotationSpeed * deltaTime;\r\n                cameraPosition.copy(cameraTransform.getTranslation(tempVector3));\r\n                if (dx !== 0 || dy !== 0) {\r\n                    cameraUpSign = Math.sign(cameraTransform.getUp(tempVector3).dot(up));\r\n                    cameraForward.toSpherical(origin);\r\n                    const theta = cameraForwardArray[1];\r\n                    const phi = cameraForwardArray[2];\r\n                    const newTheta = theta + cameraUpSign * -dy;\r\n                    if (newTheta <= 0 || newTheta >= Math.PI) {\r\n                        cameraForwardArray[2] = (phi - dx + Math.PI) % (2 * Math.PI);\r\n                        cameraForwardArray[1] = newTheta < 0 ? -newTheta : Math.PI - (newTheta - Math.PI);\r\n                        cameraUpSign *= -1;\r\n                    }\r\n                    else {\r\n                        cameraForwardArray[2] = (phi - dx) % (2 * Math.PI);\r\n                        cameraForwardArray[1] = theta + cameraUpSign * -dy;\r\n                    }\r\n                    cameraForward.toCartesian(origin);\r\n                    cameraTransform.lookAt(cameraPosition.add(cameraForward), (cameraUpSign > 0) ? up : down);\r\n                }\r\n                lastPointerPosition.copy(newPointerPosition);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nvar FreeCameraControl: FreeCameraControlConstructor = FreeCameraControlBase;","export { PoolAutoExtendPolicy };\r\nexport { Pool };\r\nexport { PoolBase };\r\n\r\nenum PoolAutoExtendPolicy {\r\n    NO_AUTO_EXTEND = 0,\r\n    AUTO_EXTEND_ONE = 1,\r\n    AUTO_EXTEND_POW2 = 2\r\n}\r\n\r\ninterface PoolConstructor {\r\n    readonly prototype: Pool;\r\n    new<O extends object>(constructor: Constructor<O>, policy?: PoolAutoExtendPolicy): Pool<O>;\r\n}\r\n\r\ninterface Pool<O extends object = object> {\r\n    readonly ctor: Constructor<O>;\r\n    readonly autoExtendPolicy: PoolAutoExtendPolicy;\r\n    autoExtend(): void;\r\n    acquire(count: number): O[];\r\n    release(...args: any[]): void;\r\n    extend(count: number): void;\r\n    clear(): void;\r\n}\r\n\r\nclass PoolBase<O extends object = object> implements Pool<O> {\r\n    readonly ctor: Constructor<O>;\r\n    autoExtendPolicy: PoolAutoExtendPolicy;\r\n    autoExtendTicks: number;\r\n\r\n    constructor(constructor: Constructor<O>, policy?: PoolAutoExtendPolicy) {\r\n        this.ctor = constructor;\r\n        this.autoExtendPolicy = policy || PoolAutoExtendPolicy.AUTO_EXTEND_ONE;\r\n        this.autoExtendTicks = 0;\r\n    }\r\n\r\n    autoExtend(): void {\r\n        switch (this.autoExtendPolicy) {\r\n            case PoolAutoExtendPolicy.AUTO_EXTEND_ONE:\r\n                this.extend(1);\r\n                break;\r\n            case PoolAutoExtendPolicy.AUTO_EXTEND_POW2:\r\n                this.extend(Math.pow(2, this.autoExtendTicks));\r\n                break;\r\n        }\r\n        this.autoExtendTicks++;\r\n    }\r\n\r\n    acquire(count: number): O[] {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    release(...args: any[]): void {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    extend(count: number): void {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    clear(): void {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n}\r\n\r\nvar Pool: PoolConstructor = PoolBase;","import { PoolAutoExtendPolicy, PoolBase, Pool } from \"./Pool\";\r\n\r\nexport { StackPool };\r\n\r\ninterface StackPool<O extends object = object> extends Pool<O> {\r\n    release(count: number): void;\r\n}\r\n\r\ninterface StackPoolConstructor {\r\n    readonly prototype: StackPool;\r\n    new<O extends object>(constructor: Constructor<O>, options?: {args?: ConstructorParameters<Constructor<O>>, policy?: PoolAutoExtendPolicy, size?: number}): StackPool<O>;\r\n}\r\n\r\nclass StackPoolBase<O extends object = object> extends PoolBase<O> implements Pool<O> {\r\n    objects: Array<O>;\r\n    top: number;\r\n\r\n    constructor(constructor: Constructor<O>, options?: {args?: any, policy?: PoolAutoExtendPolicy, size?: number}) {\r\n        super(constructor, options?.policy);\r\n        this.objects = new Array(options?.size || 0).fill(0).map(() => {\r\n            return new this.ctor(options?.args);\r\n        });\r\n        this.top = 0;\r\n    }\r\n    \r\n    acquire(count: number): O[] {\r\n        const top = this.top;\r\n        const target = top + count;\r\n\r\n        if (this.autoExtendPolicy) {\r\n            while (this.objects.length < target) {\r\n                this.autoExtend();\r\n            }\r\n        }\r\n        this.top = target;\r\n        \r\n        return this.objects.slice(top, target);\r\n    }\r\n\r\n    release(count: number): void {\r\n        const top = this.top;\r\n        if (count > top) {\r\n            console.warn(\"Releasing under zero.\");\r\n        }\r\n        this.top = Math.max(top - count, 0);\r\n    }\r\n\r\n    extend(count: number): void {\r\n        this.objects.push(...Array(count).fill(0).map(() => {\r\n            return new this.ctor();\r\n        }));\r\n    }\r\n    \r\n    clear(): void {\r\n        this.objects = [];\r\n        this.top = 0;\r\n        this.autoExtendTicks = 0;\r\n    }\r\n}\r\n\r\nvar StackPool: StackPoolConstructor = StackPoolBase;","\r\nexport { deg2Rad };\r\nexport { rad2Deg };\r\nexport { qSqrt };\r\nexport { pow2 };\r\nexport { inRange };\r\nexport { clamp };\r\nexport { lerp };\r\nexport { smoothstep };\r\nexport { smootherstep };\r\nexport { randInt };\r\nexport { randFloat };\r\nexport { randFloatSpread };\r\nexport { degToRad };\r\nexport { radToDeg };\r\nexport { isPowerOfTwo };\r\nexport { ceilPowerOfTwo };\r\nexport { floorPowerOfTwo };\r\n\r\nconst DEG2RAD = Math.PI / 180;\r\nconst RAD2DEG = 180 / Math.PI;\r\n\r\nconst deg2Rad = function(deg: number): number {\r\n\treturn DEG2RAD * deg;\r\n}\r\n\r\nconst rad2Deg = function(rad: number): number {\r\n\treturn RAD2DEG / rad;\r\n}\r\n\r\nconst _bytes = new ArrayBuffer(Float32Array.BYTES_PER_ELEMENT);\r\nconst _floatView = new Float32Array(_bytes);\r\nconst _intView = new Uint32Array(_bytes);\r\n\r\nconst qSqrt = function(x: number) {\r\n\tconst halfx = x * 0.5;\r\n\r\n\t_floatView[0] = x;\r\n\t_intView[0] = 0x5f3759df -(_intView[0] >> 1);\r\n\r\n\tlet y = _floatView[0];\r\n\ty = y * (1.5 - (halfx * y * y));\r\n\r\n\treturn y;\r\n}\r\n\r\nconst pow2 = function(k: number): number {\r\n\treturn 1 << k;\r\n}\r\n\t\r\nconst inRange = function(x: number, min: number, max: number): boolean {\r\n\treturn (min <= x) && (x <= max);\r\n}\r\n\r\nconst clamp = function(value: number, min: number, max: number): number {\r\n\treturn Math.max(min, Math.min(max, value));\r\n}\r\n\r\nconst lerp = function(x: number, y: number, t: number): number {\r\n\treturn (1 - t) * x + t * y;\r\n}\r\n\r\nconst smoothstep = function(x: number, min: number, max: number): number {\r\n\tif (x <= min) return 0;\r\n\tif (x >= max) return 1;\r\n\r\n\tx = (x - min) / (max - min);\r\n\r\n\treturn x * x * (3 - 2 * x);\r\n}\r\n\r\nconst smootherstep = function(x: number, min: number, max: number): number {\r\n\tif (x <= min) return 0;\r\n\tif (x >= max) return 1;\r\n\r\n\tx = (x - min) / (max - min);\r\n\r\n\treturn x * x * x * ( x * ( x * 6 - 15) + 10);\r\n}\r\n\r\nconst randInt = function(low: number, high: number): number {\r\n\treturn low + Math.floor(Math.random() * (high - low + 1));\r\n}\r\n\r\nconst randFloat = function(low: number, high: number): number {\r\n\treturn low + Math.random() * (high - low);\r\n}\r\n\r\nconst randFloatSpread = function(range: number): number {\r\n\treturn range * (0.5 - Math.random());\r\n}\r\n\r\nconst degToRad = function(degrees: number): number {\r\n\treturn degrees * DEG2RAD;\r\n}\r\n\r\nconst radToDeg = function(radians: number): number {\r\n\treturn radians * RAD2DEG;\r\n}\r\nconst isPowerOfTwo = function(value: number): boolean {\r\n\treturn (value & (value - 1)) === 0 && value !== 0;\r\n}\r\n\r\nconst ceilPowerOfTwo = function(value: number): number {\r\n\treturn Math.pow(2, Math.ceil(Math.log(value) / Math.LN2));\r\n}\r\n\r\nconst floorPowerOfTwo = function(value: number): number {\r\n\treturn Math.pow(2, Math.floor(Math.log(value) / Math.LN2));\r\n}","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { Vector2, Vector2Values } from \"../vectors/Vector2\";\r\nimport { Vector3Values, Vector3 } from \"../vectors/Vector3\";\r\n\r\nexport { Matrix3Values };\r\nexport { Matrix3 };\r\nexport { Matrix3Injector };\r\nexport { Matrix3Base };\r\n\r\ntype Matrix3Values = [\r\n  number, number, number,\r\n  number, number, number,\r\n  number, number, number\r\n];\r\n\r\ninterface Matrix3Constructor {\r\n\treadonly prototype: Matrix3;\r\n\tnew(): Matrix3;\r\n\tnew(\r\n    m11: number, m21: number, m31: number,\r\n    m12: number, m22: number, m32: number,\r\n    m13: number, m23: number, m33: number\r\n  ): Matrix3;\r\n  new(array: ArrayLike<number>): Matrix3;\r\n  rotationX(angle: number): Matrix3;\r\n  rotationY(angle: number): Matrix3;\r\n  rotationZ(angle: number): Matrix3;\r\n}\r\n\r\ninterface Matrix3 {\r\n  readonly array: WritableArrayLike<number>;\r\n  setValues(\r\n    m11: number, m21: number, m31: number,\r\n    m12: number, m22: number, m32: number,\r\n    m13: number, m23: number, m33: number\r\n  ): this;\r\n  getValues(): Matrix3Values;\r\n  row1: Vector3Values;\r\n  row2: Vector3Values;\r\n  row3: Vector3Values;\r\n  col1: Vector3Values;\r\n  col2: Vector3Values;\r\n  col3: Vector3Values;\r\n  m11: number;\r\n  m12: number;\r\n  m13: number;\r\n  m21: number;\r\n  m22: number;\r\n  m23: number;\r\n  m31: number;\r\n  m32: number;\r\n  m33: number;\r\n  setRotationX(angle: number): this;\r\n  setRotationY(angle: number): this;\r\n  setRotationZ(angle: number): this;\r\n\r\n  equals(mat: Matrix3): boolean;\r\n  copy(mat: Matrix3): this;\r\n  clone(): this;\r\n  det(): number;\r\n  trace(): number;\r\n  setIdentity(): this;\r\n  setZeros(): this;\r\n  negate(): this;\r\n  transpose(): this;\r\n  invert(): this;\r\n  add(mat: Matrix3): this;\r\n  sub(mat: Matrix3): this;\r\n  mult(mat: Matrix3): this;\r\n  multScalar(k: number): this;\r\n  solve(vecB: Vector3): Vector3Values;\r\n  solve2(vecB: Vector2): Vector2Values;\r\n  writeIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n  readFromArray(arr: ArrayLike<number>, offset?: number): void;\r\n}\r\n\r\nclass Matrix3Base implements Matrix3 {\r\n  readonly array: Float32Array;\r\n\r\n\tconstructor()\r\n  constructor(array: ArrayLike<number>)\r\n\tconstructor(\r\n    m11: number, m21: number, m31: number,\r\n    m12: number, m22: number, m32: number,\r\n    m13: number, m23: number, m33: number\r\n  )\r\n\tconstructor(\r\n    ...args: any[]\r\n  ) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis.array = new Float32Array([\r\n        args[0], args[1], args[2],\r\n        args[3], args[4], args[5],\r\n        args[6], args[7], args[8]\r\n      ]);\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n      const array = args[0];\r\n      this.checkArray(array);\r\n      if (array instanceof Float32Array) {\r\n        this.array = array;\r\n      }\r\n      else {\r\n        this.array = new Float32Array(array);\r\n      }\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.array = new Float32Array([\r\n        0, 0, 0,\r\n        0, 0, 0,\r\n        0, 0, 0\r\n      ]);\r\n\t\t}\r\n  }\r\n\r\n  get row1(): Vector3Values {\r\n\t\treturn [\r\n      this.array[0],\r\n      this.array[3],\r\n      this.array[6]\r\n    ];\r\n\t}\r\n\r\n\tset row1(row: Vector3Values) {\r\n    this.array[0] = row[0];\r\n    this.array[3] = row[1];\r\n    this.array[6] = row[2];\r\n  }\r\n\r\n  get row2(): Vector3Values {\r\n\t\treturn [\r\n      this.array[1],\r\n      this.array[4],\r\n      this.array[7]\r\n    ];\r\n\t}\r\n\r\n\tset row2(row: Vector3Values) {\r\n    this.array[1] = row[0];\r\n    this.array[4] = row[1];\r\n    this.array[7] = row[2]\r\n  }\r\n\r\n  get row3(): Vector3Values {\r\n\t\treturn [\r\n      this.array[2],\r\n      this.array[5],\r\n      this.array[8]\r\n    ];\r\n\t}\r\n\r\n\tset row3(row: Vector3Values) {\r\n    this.array[2] = row[0];\r\n    this.array[5] = row[1];\r\n    this.array[8] = row[2]\r\n  }\r\n\r\n  get col1(): Vector3Values {\r\n\t\treturn [\r\n      this.array[0],\r\n      this.array[1],\r\n      this.array[2]\r\n    ];\r\n\t}\r\n\r\n\tset col1(col: Vector3Values) {\r\n    this.array[0] = col[0];\r\n    this.array[1] = col[1];\r\n    this.array[2] = col[2];\r\n  }\r\n\r\n  get col2(): Vector3Values {\r\n\t\treturn [\r\n      this.array[3],\r\n      this.array[4],\r\n      this.array[5]\r\n    ];\r\n\t}\r\n\r\n\tset col2(col: Vector3Values) {\r\n    this.array[3] = col[0];\r\n    this.array[4] = col[1];\r\n    this.array[5] = col[2]\r\n  }\r\n\r\n  get col3(): Vector3Values {\r\n\t\treturn [\r\n      this.array[6],\r\n      this.array[7],\r\n      this.array[8]\r\n    ];\r\n\t}\r\n\r\n\tset col3(col: Vector3Values) {\r\n    this.array[6] = col[0];\r\n    this.array[7] = col[1];\r\n    this.array[8] = col[2];\r\n  }\r\n\r\n  get m11() {\r\n\t\treturn this.array[0];\r\n\t}\r\n\r\n\tset m11(val: number) {\r\n\t\tthis.array[0] = val;\r\n  }\r\n  \r\n  get m12() {\r\n\t\treturn this.array[3];\r\n\t}\r\n\r\n\tset m12(val: number) {\r\n\t\tthis.array[3] = val;\r\n  }\r\n  \r\n  get m13() {\r\n\t\treturn this.array[6];\r\n\t}\r\n\r\n\tset m13(val: number) {\r\n\t\tthis.array[6] = val;\r\n  }\r\n  \r\n  get m21() {\r\n\t\treturn this.array[1];\r\n\t}\r\n\r\n\tset m21(val: number) {\r\n\t\tthis.array[1] = val;\r\n  }\r\n  \r\n  get m22() {\r\n\t\treturn this.array[4];\r\n\t}\r\n\r\n\tset m22(val: number) {\r\n\t\tthis.array[4] = val;\r\n  }\r\n  \r\n  get m23() {\r\n\t\treturn this.array[7];\r\n\t}\r\n\r\n\tset m23(val: number) {\r\n\t\tthis.array[7] = val;\r\n  }\r\n  \r\n  get m31() {\r\n\t\treturn this.array[2];\r\n\t}\r\n\r\n  set m31(val: number) {\r\n\t\tthis.array[2] = val;\r\n  }\r\n  \r\n  get m32() {\r\n\t\treturn this.array[5];\r\n\t}\r\n\r\n\tset m32(val: number) {\r\n\t\tthis.array[5] = val;\r\n  }\r\n  \r\n  get m33() {\r\n\t\treturn this.array[8];\r\n\t}\r\n\r\n  set m33(val: number) {\r\n\t\tthis.array[8] = val;\r\n  }\r\n\r\n  private checkArray(array: ArrayLike<number>): void {\r\n\t\tif (array.length < 9) {\r\n\t\t\tthrow new MathError(`Array must be of length 9 at least.`);\r\n\t\t}\r\n\t}\r\n\r\n  getValues(): Matrix3Values {\r\n\t\treturn [\r\n      this.array[0], this.array[1], this.array[2],\r\n      this.array[3], this.array[4], this.array[5],\r\n      this.array[6], this.array[7], this.array[8],\r\n    ];\r\n\t}\r\n\r\n\tsetValues(\r\n    m11: number, m21: number, m31: number,\r\n    m12: number, m22: number, m32: number,\r\n    m13: number, m23: number, m33: number\r\n  ): this {\r\n    this.array[0] = m11;\r\n    this.array[1] = m21;\r\n    this.array[2] = m31;\r\n    this.array[3] = m12;\r\n    this.array[4] = m22;\r\n    this.array[5] = m32;\r\n    this.array[6] = m13;\r\n    this.array[7] = m23;\r\n    this.array[8] = m33;\r\n\r\n    return this;\r\n  }\r\n\r\n\tequals(other: Matrix3): boolean {\r\n    const o = other.array;\r\n    return this.array[0] === o[0]\r\n      && this.array[1] === o[1]\r\n      && this.array[2] === o[2]\r\n      && this.array[3] === o[3]\r\n      && this.array[4] === o[4]\r\n      && this.array[5] === o[5]\r\n      && this.array[6] === o[6]\r\n      && this.array[7] === o[7]\r\n      && this.array[8] === o[8];\r\n  }\r\n\r\n  copy(mat: Matrix3): this {\r\n    const o = this.array;\r\n    const m = mat.array;\r\n\r\n    o[0] = m[0];\r\n    o[1] = m[1];\r\n    o[2] = m[2];\r\n    o[3] = m[3];\r\n    o[4] = m[4];\r\n    o[5] = m[5];\r\n    o[6] = m[6];\r\n    o[7] = m[7];\r\n    o[8] = m[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  clone(): this {\r\n    return new Matrix3Base(\r\n      this.array[0], this.array[1], this.array[2],\r\n      this.array[3], this.array[4], this.array[5],\r\n      this.array[6], this.array[7], this.array[8]\r\n    ) as this;\r\n  }\r\n\r\n  setIdentity(): this {\r\n    const o = this.array;\r\n\r\n    o[0] = 1;\r\n    o[1] = 0;\r\n    o[2] = 0;\r\n    o[3] = 0;\r\n    o[4] = 1;\r\n    o[5] = 0;\r\n    o[6] = 0;\r\n    o[7] = 0;\r\n    o[8] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  setZeros(): this {\r\n    const o = this.array;\r\n\r\n    o[0] = 0;\r\n    o[1] = 0;\r\n    o[2] = 0;\r\n    o[3] = 0;\r\n    o[4] = 0;\r\n    o[5] = 0;\r\n    o[6] = 0;\r\n    o[7] = 0;\r\n    o[8] = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  det(): number {\r\n    const o = this.array;\r\n\r\n    const x = o[0] * ((o[4] * o[8]) - (o[5] * o[7]));\r\n    const y = o[1] * ((o[3] * o[8]) - (o[5] * o[6]));\r\n    const z = o[2] * ((o[3] * o[7]) - (o[4] * o[6]));\r\n\r\n    return x - y + z;\r\n  }\r\n\r\n  trace(): number {\r\n    const o = this.array;\r\n    \r\n    return o[0] + o[4] + o[8];\r\n  }\r\n\r\n  negate(): this {\r\n    const o = this.array;\r\n\r\n    o[0] = -o[0];\r\n    o[1] = -o[1];\r\n    o[2] = -o[2];\r\n    o[3] = -o[3];\r\n    o[4] = -o[4];\r\n    o[5] = -o[5];\r\n    o[6] = -o[6];\r\n    o[7] = -o[7];\r\n    o[8] = -o[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  transpose(): this {\r\n    const o = this.array;\r\n\r\n    let t;\r\n\r\n    t = o[1];\r\n    o[1] = o[3];\r\n    o[3] = t;\r\n\r\n    t = o[2];\r\n    o[2] = o[6];\r\n    o[6] = t;\r\n\r\n    t = o[5];\r\n    o[5] = o[7];\r\n    o[7] = t;\r\n    \r\n    return this;\r\n  }\r\n\r\n  invert(): this {\r\n    const o = this.array;\r\n\r\n    const t11 = o[1 * 3 + 1] * o[2 * 3 + 2] - o[1 * 3 + 2] * o[2 * 3 + 1];\r\n    const t12 = o[0 * 3 + 1] * o[2 * 3 + 2] - o[0 * 3 + 2] * o[2 * 3 + 1];\r\n    const t13 = o[0 * 3 + 1] * o[1 * 3 + 2] - o[0 * 3 + 2] * o[1 * 3 + 1];\r\n\r\n    const t21 = o[1 * 3 + 0] * o[2 * 3 + 2] - o[1 * 3 + 2] * o[2 * 3 + 0];\r\n    const t22 = o[0 * 3 + 0] * o[2 * 3 + 2] - o[0 * 3 + 2] * o[2 * 3 + 0];\r\n    const t23 = o[0 * 3 + 0] * o[1 * 3 + 2] - o[0 * 3 + 2] * o[1 * 3 + 0];\r\n\r\n    const t31 = o[1 * 3 + 0] * o[2 * 3 + 1] - o[1 * 3 + 1] * o[2 * 3 + 0];\r\n    const t32 = o[0 * 3 + 0] * o[2 * 3 + 1] - o[0 * 3 + 1] * o[2 * 3 + 0];\r\n    const t33 = o[0 * 3 + 0] * o[1 * 3 + 1] - o[0 * 3 + 1] * o[1 * 3 + 0];\r\n\r\n    const d = 1.0 / (o[0 * 3 + 0] * t11 - o[1 * 3 + 0] * t12 + o[2 * 3 + 0] * t13);\r\n\r\n    if (d == 0) {\r\n      throw new MathError(`Matrix is not invertible.`);\r\n    }\r\n\r\n    o[0] = d * t11;\r\n    o[1] = -d * t12;\r\n    o[2] = d * t13;\r\n\r\n    o[3] = -d * t21;\r\n    o[4] = d * t22;\r\n    o[5] = -d * t23;\r\n\r\n    o[6] = d * t31;\r\n    o[7] = -d * t32;\r\n    o[8] = d * t33;\r\n\r\n    return this;\r\n  }\r\n\r\n  add(mat: Matrix3): this {\r\n    const o = this.array;\r\n    const m = mat.array;\r\n\r\n    o[0] = o[0] + m[0];\r\n    o[1] = o[1] + m[1];\r\n    o[2] = o[2] + m[2];\r\n    o[3] = o[3] + m[3];\r\n    o[4] = o[4] + m[4];\r\n    o[5] = o[5] + m[5];\r\n    o[6] = o[6] + m[6];\r\n    o[7] = o[7] + m[7];\r\n    o[8] = o[8] + m[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  sub(mat: Matrix3Base): this {\r\n    const o = this.array;\r\n    const m = mat.array;\r\n\r\n    o[0] = o[0] - m[0];\r\n    o[1] = o[1] - m[1];\r\n    o[2] = o[2] - m[2];\r\n    o[3] = o[3] - m[3];\r\n    o[4] = o[4] - m[4];\r\n    o[5] = o[5] - m[5];\r\n    o[6] = o[6] - m[6];\r\n    o[7] = o[7] - m[7];\r\n    o[8] = o[8] - m[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  mult(mat: Matrix3): this {\r\n    const o = this.array;\r\n    const m = mat.array;\r\n\r\n    const a11 = o[0 * 3 + 0];\r\n    const a12 = o[0 * 3 + 1];\r\n    const a13 = o[0 * 3 + 2];\r\n    const a21 = o[1 * 3 + 0];\r\n    const a22 = o[1 * 3 + 1];\r\n    const a23 = o[1 * 3 + 2];\r\n    const a31 = o[2 * 3 + 0];\r\n    const a32 = o[2 * 3 + 1];\r\n    const a33 = o[2 * 3 + 2];\r\n    const b11 = m[0 * 3 + 0];\r\n    const b12 = m[0 * 3 + 1];\r\n    const b13 = m[0 * 3 + 2];\r\n    const b21 = m[1 * 3 + 0];\r\n    const b22 = m[1 * 3 + 1];\r\n    const b23 = m[1 * 3 + 2];\r\n    const b31 = m[2 * 3 + 0];\r\n    const b32 = m[2 * 3 + 1];\r\n    const b33 = m[2 * 3 + 2];\r\n\r\n    o[0] = b11 * a11 + b12 * a21 + b13 * a31;\r\n    o[1] = b11 * a12 + b12 * a22 + b13 * a32;\r\n    o[2] = b11 * a13 + b12 * a23 + b13 * a33;\r\n    o[3] = b21 * a11 + b22 * a21 + b23 * a31;\r\n    o[4] = b21 * a12 + b22 * a22 + b23 * a32;\r\n    o[5] = b21 * a13 + b22 * a23 + b23 * a33;\r\n    o[6] = b31 * a11 + b32 * a21 + b33 * a31;\r\n    o[7] = b31 * a12 + b32 * a22 + b33 * a32;\r\n    o[8] = b31 * a13 + b32 * a23 + b33 * a33;\r\n\r\n    return this;\r\n  }\r\n\r\n  multScalar(k: number): this {\r\n    const o = this.array;\r\n\r\n    o[0] = o[0] * k;\r\n    o[1] = o[1] * k;\r\n    o[2] = o[2] * k;\r\n    o[3] = o[3] * k;\r\n    o[4] = o[4] * k;\r\n    o[5] = o[5] * k;\r\n    o[6] = o[6] * k;\r\n    o[7] = o[7] * k;\r\n    o[8] = o[8] * k;\r\n\r\n    return this;\r\n  }\r\n\r\n  writeIntoArray(out: WritableArrayLike<number>, offset: number = 0): void {\r\n\t\tconst m = this.array;\r\n\r\n\t\tout[offset     ] = m[ 0];\r\n\t\tout[offset +  1] = m[ 1];\r\n    out[offset +  2] = m[ 2];\r\n    out[offset +  3] = m[ 3];\r\n\t\tout[offset +  4] = m[ 4];\r\n    out[offset +  5] = m[ 5];\r\n    out[offset +  6] = m[ 6];\r\n\t\tout[offset +  7] = m[ 7];\r\n    out[offset +  8] = m[ 8];\r\n  }\r\n    \r\n  readFromArray(arr: ArrayLike<number>, offset: number = 0): void {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[ 0] = arr[offset     ];\r\n\t\to[ 1] = arr[offset +  1];\r\n    o[ 2] = arr[offset +  2];\r\n    o[ 3] = arr[offset +  3];\r\n    o[ 4] = arr[offset +  4];\r\n    o[ 5] = arr[offset +  5];\r\n    o[ 6] = arr[offset +  6];\r\n\t\to[ 7] = arr[offset +  7];\r\n    o[ 8] = arr[offset +  8];\r\n  }\r\n\r\n  static rotationX(angle: number): Matrix3Base {\r\n    return new Matrix3Base().setRotationX(angle);\r\n  }\r\n\r\n  setRotationX(angle: number): this {\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    this.array[0] = 1;\r\n    this.array[1] = 0;\r\n    this.array[2] = 0;\r\n    this.array[3] = 0;\r\n    this.array[4] = cosAngle;\r\n    this.array[5] = sinAngle;\r\n    this.array[6] = 0;\r\n    this.array[7] = -sinAngle;\r\n    this.array[8] = cosAngle;\r\n\r\n    return this;\r\n  }\r\n  \r\n  static rotationY(angle: number): Matrix3Base {\r\n    return new Matrix3Base().setRotationY(angle);\r\n  }\r\n\r\n  setRotationY(angle: number): this {\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n    \r\n    this.array[0] = cosAngle;\r\n    this.array[1] = 0;\r\n    this.array[2] = -sinAngle;\r\n    this.array[3] = 0;\r\n    this.array[4] = 1;\r\n    this.array[5] = 0;\r\n    this.array[6] = sinAngle;\r\n    this.array[7] = 0;\r\n    this.array[8] = cosAngle;\r\n    \r\n    return this;\r\n  }\r\n\r\n  static rotationZ(angle: number): Matrix3Base {\r\n    return new Matrix3Base().setRotationZ(angle);\r\n  }\r\n\r\n  setRotationZ(angle: number): this {\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    this.array[0] = cosAngle;\r\n    this.array[1] = sinAngle;\r\n    this.array[2] = 0;\r\n    this.array[3] = -sinAngle;\r\n    this.array[4] = cosAngle;\r\n    this.array[5] = 0;\r\n    this.array[6] = 0;\r\n    this.array[7] = 0;\r\n    this.array[8] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  solve(b: Vector3): Vector3Values {\r\n    const a  = this.array;\r\n\r\n    const A0x = a[0];\r\n    const A0y = a[3];\r\n    const A0z = a[6];\r\n    const A1x = a[1];\r\n    const A1y = a[4];\r\n    const A1z = a[7];\r\n    const A2x = a[2];\r\n    const A2y = a[5];\r\n    const A2z = a[8];\r\n    let rx, ry, rz;\r\n    let det;\r\n\r\n    // Column1 cross Column 2\r\n    rx = A1y * A2z - A1z * A2y;\r\n    ry = A1z * A2x - A1x * A2z;\r\n    rz = A1x * A2y - A1y * A2x;\r\n\r\n    // A.getColumn(0).dot(x)\r\n    det = A0x * rx + A0y * ry + A0z * rz;\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    // b dot [Column1 cross Column 2]\r\n    const x_ = det * (b.x * rx + b.y * ry + b.z * rz);\r\n\r\n    // Column2 cross b\r\n    rx = -(A2y * b.z - A2z * b.y);\r\n    ry = -(A2z * b.x - A2x * b.z);\r\n    rz = -(A2x * b.y - A2y * b.x);\r\n    // Column0 dot -[Column2 cross b (Column3)]\r\n    const y_ = det * (A0x * rx + A0y * ry + A0z * rz);\r\n\r\n    // b cross Column 1\r\n    rx = -(b.y * A1z - b.z * A1y);\r\n    ry = -(b.z * A1x - b.x * A1z);\r\n    rz = -(b.x * A1y - b.y * A1x);\r\n    // Column0 dot -[b cross Column 1]\r\n    const z_ = det * (A0x * rx + A0y * ry + A0z * rz);\r\n    return [x_, y_, z_];\r\n    /*const a = this.array;\r\n    \r\n    const a11 = a[0];\r\n    const a12 = a[1];\r\n    const a13 = a[2];\r\n    const a21 = a[3];\r\n    const a22 = a[4];\r\n    const a23 = a[5];\r\n    const a31 = a[6];\r\n    const a32 = a[7];\r\n    const a33 = a[8];\r\n    const bx = vecB.x;\r\n    const by = vecB.y;\r\n    const bz = vecB.z;\r\n\r\n    let rx = a22 * a33 - a23 * a32;\r\n    let ry = a23 * a31 - a21 * a33;\r\n    let rz = a21 * a32 - a22 * a31;\r\n  \r\n    let det = a11 * rx + a12 * ry + a13 * rz;\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    const x = det * (bx * rx + by * ry + bz * rz);\r\n\r\n    rx = -(a32 * bz - a33 * by);\r\n    ry = -(a33 * bx - a31 * bz);\r\n    rz = -(a31 * by - a32 * bx);\r\n    \r\n    const y = det * (a11 * rx + a12 * ry + a13 * rz);\r\n    \r\n    rx = -(by * a23 - bz * a22);\r\n    ry = -(bz * a21 - bx * a23);\r\n    rz = -(bx * a22 - by * a21);\r\n    \r\n    const z = det * (a11 * rx + a12 * ry + a13 * rz);\r\n    \r\n    return [\r\n      x, y, z\r\n    ];*/\r\n  }\r\n\r\n  solve2(vecB: Vector2): Vector2Values {\r\n    const a = this.array;\r\n\r\n    const a11 = a[0];\r\n    const a12 = a[1];\r\n    const a21 = a[3];\r\n    const a22 = a[4];\r\n    const bx = vecB.x - a[4];\r\n    const by = vecB.y - a[7];\r\n    \r\n    let det = a11 * a22 - a12 * a21;\r\n\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    const x = det * (a22 * bx - a12 * by)\r\n    const y = det * (a11 * by - a21 * bx);\r\n\r\n    return [\r\n      x, y\r\n    ];\r\n  }\r\n}\r\n\r\nvar Matrix3: Matrix3Constructor = Matrix3Base;\r\nconst Matrix3Injector: Injector<Matrix3Constructor> = new Injector({\r\n\tdefaultCtor: Matrix3Base,\r\n\tonDefaultOverride:\r\n\t\t(ctor: Matrix3Constructor) => {\r\n\t\t\tMatrix3 = ctor;\r\n\t\t}\r\n});","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { StackPool } from \"../../../patterns/pools/StackPool\";\r\nimport { Space } from \"../../geometry/space/Space\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { qSqrt } from \"../../Snippets\";\r\nimport { Matrix3 } from \"../matrices/Matrix3\";\r\nimport { Matrix4 } from \"../matrices/Matrix4\";\r\nimport { Vector3 } from \"../vectors/Vector3\";\r\n\r\nexport { QuaternionValues };\r\nexport { Quaternion };\r\nexport { QuaternionInjector };\r\nexport { QuaternionPool };\r\n\r\ntype QuaternionValues = [number, ...number[]] & { length: 4 };\r\n\r\ninterface QuaternionConstructor {\r\n\treadonly prototype: Quaternion;\r\n\tnew(): Quaternion;\r\n\tnew(x: number, y: number, z: number, w: number): Quaternion;\r\n\tnew(array: WritableArrayLike<number>): Quaternion;\r\n\tslerp(from: Quaternion, to: Quaternion, t: number): Quaternion\r\n\tslerp(from: Quaternion, to: Quaternion, t: number, out: Quaternion): Quaternion\r\n\tfromArray(vector: ArrayLike<number>): Quaternion;\r\n\tfromAxisAngle(axis: Vector3, angle?: number): Quaternion;\r\n\tfromEuler(pitch: number, yaw: number, roll: number): Quaternion;\r\n\tfromVector(vector: Vector3): Quaternion;\r\n\tfromMatrix(matrix: Matrix3): Quaternion;\r\n}\r\n// TODO?:\r\n// roll => pitch\r\n// pitch => yaw\r\n// yaw => roll\r\ninterface Quaternion {\r\n\treadonly array: WritableArrayLike<number>;\r\n\tx: number;\r\n\ty: number;\r\n\tz: number;\r\n\tw: number;\r\n\tpitch: number;\r\n\tyaw: number;\r\n\troll: number;\r\n\tgetValues(): QuaternionValues;\r\n\tsetValues(\r\n\t  x: number, y: number,\r\n\t  z: number, w: number\r\n\t): this;\r\n\t//setArray(array: WritableArrayLike<number>): this;\r\n\tlookAt(source: Vector3, dest: Vector3): Quaternion ;\r\n\tsetEuler(pitch: number, yaw: number, roll: number): this;\r\n\r\n\tsetMatrix(matrix: Matrix3): Quaternion;\r\n\tsetMatrix(matrix: Matrix4): Quaternion;\r\n\r\n\tsetAxisAngle(axis: Vector3, angle: number): this;\r\n\tsetVectors(from: Vector3, to: Vector3): this;\r\n\t\r\n\tcopy(quat: Quaternion): this;\r\n\tclone(): this;\r\n\tgetAxis(out: Vector3): Vector3;\r\n\r\n\tgetMatrix3(matrix: Matrix3): Matrix3;\r\n\tgetMatrix4(matrix: Matrix4): Matrix4;\r\n\r\n\trotate(vec: Vector3): Vector3;\r\n\ttoVector(): Vector3;\r\n\r\n\tangleTo(quat: Quaternion): number;\r\n\trotateTowards(quat: Quaternion): this;\r\n\tinvert(): this;\r\n\tconjugate(): this;\r\n\tdot(quat: Quaternion): number;\r\n\tlengthSquared(): number;\r\n\tlength(): number;\r\n\tnormalize(): this;\r\n\tadd(quat: Quaternion): this;\r\n\tsub(quat: Quaternion): this;\r\n\tmult(quat: Quaternion): this;\r\n\tscale(scalar: number): this;\r\n\tslerp(from: Quaternion, to: Quaternion, t: number): this;\r\n\tequals(quat: Quaternion): boolean;\r\n\tcopyIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n    readFromArray(arr: ArrayLike<number>, offset?: number): void;\r\n}\r\n\r\nclass QuaternionBase {\r\n\tprivate _array: WritableArrayLike<number>;\r\n\r\n\tget array(): WritableArrayLike<number> {\r\n\t\treturn this._array;\r\n\t}\r\n\r\n\tconstructor()\r\n\tconstructor(array: WritableArrayLike<number>)\r\n\tconstructor(x: number, y: number, z: number, w: number)\r\n\tconstructor(...args: any[]) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis._array = [\r\n\t\t\t\targs[0], args[1], args[2], args[3]\r\n\t\t\t];\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n\t\t\tthis._checkArray(args[0]);\r\n\t\t\tthis._array = args[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._array = [0, 0, 0, 0];\r\n\t\t}\r\n\t}\r\n\r\n\tget x(): number {\r\n        return this._array[0];\r\n    }\r\n\r\n    set x(x: number) {\r\n\t\tthis._array[0] = x;\r\n    }\r\n\r\n    get y(): number {\r\n        return this._array[1];\r\n    }\r\n\r\n    set y(y: number) {\r\n\t\tthis._array[1] = y;\r\n    }\r\n\r\n    set z(z: number) {\r\n\t\tthis._array[2] = z;\r\n\t}\r\n\t\r\n    get z(): number {\r\n\t\treturn this._array[2];\r\n    }\r\n\r\n    set w(w: number) {\r\n\t\tthis._array[3] = w;\r\n\t}\r\n\r\n    get w(): number {\r\n\t\treturn this._array[3];\r\n\t}\r\n\t\r\n\tget pitch(): number {\r\n\t\tconst array = this.array;\r\n\t\tconst x = array[0];\r\n\t\tconst y = array[1];\r\n\t\tconst z = array[2];\r\n\t\tconst w = array[3];\r\n\t\tconst sinPitch = 2 * (w * y - z * x);\r\n\t\tif (Math.abs(sinPitch) >= 1) {\r\n            return Math.sign(sinPitch) * (Math.PI / 2);\r\n        }\r\n\t\telse {\r\n            return Math.asin(sinPitch);\r\n        }\r\n\t}\r\n\r\n\tget yaw(): number {\r\n\t\tconst array = this.array;\r\n\t\tconst x = array[0];\r\n\t\tconst y = array[1];\r\n\t\tconst z = array[2];\r\n\t\tconst w = array[3];\r\n\t\tconst sinYawCosPitch = 2 * (w * z + x * y);\r\n\t\tconst cosYawCosPitch = 1 - 2 * (y * y + z * z);\r\n\t\treturn Math.atan2(sinYawCosPitch, cosYawCosPitch);\r\n\t}\r\n\r\n\tget roll(): number {\r\n\t\tconst array = this.array;\r\n\t\tconst x = array[0];\r\n\t\tconst y = array[1];\r\n\t\tconst z = array[2];\r\n\t\tconst w = array[3];\r\n\t\tconst sinRollCosPitch = 2 * (w * x + y * z);\r\n\t\tconst cosRollCosPitch = 1 - 2 * (x * x + y * y);\r\n\t\treturn Math.atan2(sinRollCosPitch, cosRollCosPitch);\r\n\t}\r\n\r\n\tgetValues(): QuaternionValues {\r\n\t\treturn [\r\n\t\t\tthis._array[0],\r\n\t\t\tthis._array[1],\r\n\t\t\tthis._array[2],\r\n\t\t\tthis._array[3]\r\n\t\t];\r\n\t}\r\n\r\n\tsetValues(x: number, y: number, z: number, w: number): this {\r\n\t\tthis._array[0] = x;\r\n\t\tthis._array[1] = y;\r\n\t\tthis._array[2] = z;\r\n\t\tthis._array[3] = w;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprivate _checkArray(array: WritableArrayLike<number>): void {\r\n\t\tif (array.length < 4) {\r\n\t\t\tthrow new MathError(`Array must be of length 4 at least.`);\r\n\t\t}\r\n\t}\r\n\r\n\t/*setArray(array: WritableArrayLike<number>): this {\r\n\t\tthis._checkArray(array);\r\n\t\tthis._array = array;\r\n\t\treturn this;\r\n\t}*/\r\n\r\n\tstatic fromArray(array: WritableArrayLike<number>): QuaternionBase {\r\n\t\treturn new QuaternionBase(array);\r\n\t}\r\n\r\n\tstatic fromAxisAngle(axis: Vector3, angle: number): QuaternionBase {\r\n\t\treturn new QuaternionBase().setAxisAngle(axis, angle);\r\n\t}\r\n\r\n\tstatic fromVector(vector: Vector3): QuaternionBase {\r\n\t\treturn new QuaternionBase(vector.x, vector.y, vector.z, 1);\r\n\t}\r\n\t\r\n\tstatic fromEuler(yaw: number, pitch: number, roll: number): QuaternionBase {\r\n\t\treturn new QuaternionBase().setEuler(yaw, pitch, roll);\r\n\t}\r\n\r\n\tcopy(quat: Quaternion): this {\r\n\t\tconst o = this._array;\r\n\t\tconst q = quat.array;\r\n\r\n\t\to[0] = q[0];\r\n\t\to[1] = q[1];\r\n\t\to[2] = q[2];\r\n\t\to[3] = q[3];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone(): this {\r\n\t\treturn new QuaternionBase(this.x, this.y, this.z, this.w) as this;\r\n\t}\r\n\r\n\tequals(quat: Quaternion): boolean {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\r\n\t\treturn (thisArray[0] === quatArray[0])\r\n\t\t\t&& (thisArray[1] === quatArray[1])\r\n\t\t\t&& (thisArray[2] === quatArray[2])\r\n\t\t\t&& (thisArray[3] === quatArray[3]);\r\n\t}\r\n\r\n\tgetAxis(out: Vector3): Vector3 {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst outArray = out.array;\r\n\r\n\t\tconst den = 1 - (thisArray[3] * thisArray[3]);\r\n\r\n\t\tif (den < Number.EPSILON) {\r\n\t\t  return out.setZeros();\r\n\t\t}\r\n\t  \r\n\t\tconst scale = qSqrt(den);\r\n\t\t\r\n\t\toutArray[0] = thisArray[0] * scale;\r\n\t\toutArray[1] = thisArray[1] * scale;\r\n\t\toutArray[2] = thisArray[2] * scale;\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\tgetMatrix3(matrix: Matrix3): Matrix3 {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst thisLengthSquared = this.lengthSquared();\r\n\t\tconst s = 2.0 / thisLengthSquared;\r\n\r\n\t\tconst x = thisArray[0];\r\n\t\tconst y = thisArray[1];\r\n\t\tconst z = thisArray[2];\r\n\t\tconst w = thisArray[3];\r\n\r\n\t\tconst xs = x * s;\r\n\t\tconst ys = y * s;\r\n\t\tconst zs = z * s;\r\n\t  \r\n\t\tconst wx = w * xs;\r\n\t\tconst wy = w * ys;\r\n\t\tconst wz = w * zs;\r\n\t  \r\n\t\tconst xx = x * xs;\r\n\t\tconst xy = x * ys;\r\n\t\tconst xz = x * zs;\r\n\t\t\r\n\t\tconst yy = y * ys;\r\n\t\tconst yz = y * zs;\r\n\t\tconst zz = z * zs;\r\n\r\n\t\treturn matrix.setValues(\r\n\t\t\t1 - (yy + zz),\txy + wz,\t\txz - wy,\r\n\t\t\txy - wz,\t\t1 - (xx + zz),\tyz + wx,\r\n\t\t\txz + wy,\t\tyz - wx,\t\t1 - (xx + yy)\r\n\t\t);\r\n\t}\r\n\r\n\tgetMatrix4(matrix: Matrix4): Matrix4 {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst thisLengthSquared = this.lengthSquared();\r\n\t\tconst s = 2.0 / thisLengthSquared;\r\n\r\n\t\tconst x = thisArray[0];\r\n\t\tconst y = thisArray[1];\r\n\t\tconst z = thisArray[2];\r\n\t\tconst w = thisArray[3];\r\n\r\n\t\tconst xs = x * s;\r\n\t\tconst ys = y * s;\r\n\t\tconst zs = z * s;\r\n\t  \r\n\t\tconst wx = w * xs;\r\n\t\tconst wy = w * ys;\r\n\t\tconst wz = w * zs;\r\n\t  \r\n\t\tconst xx = x * xs;\r\n\t\tconst xy = x * ys;\r\n\t\tconst xz = x * zs;\r\n\t\t\r\n\t\tconst yy = y * ys;\r\n\t\tconst yz = y * zs;\r\n\t\tconst zz = z * zs;\r\n\r\n\t\treturn matrix.setValues(\r\n\t\t\t1 - (yy + zz),\txy + wz,\t\txz - wy, \t\t0,\r\n\t\t\txy - wz,\t\t1 - (xx + zz),\tyz + wx, \t\t0,\r\n\t\t\txz + wy,\t\tyz - wx,\t\t1 - (xx + yy), \t0,\r\n\t\t\t0, \t\t\t\t0, \t\t\t\t0, \t\t\t\t1\r\n\t\t);\r\n\t}\r\n\r\n\trotate(vector: Vector3): Vector3 {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst vectorArray = vector.array;\r\n\r\n\t\tconst vx = vectorArray[0];\r\n\t\tconst vy = vectorArray[1];\r\n\t\tconst vz = vectorArray[2];\t\t\r\n\t\t\r\n\t\tconst qx = thisArray[0];\r\n\t\tconst qy = thisArray[1];\r\n\t\tconst qz = thisArray[2];\r\n\t\tconst qw = thisArray[3];\r\n\r\n\t\tconst tx = qw * vx + -qx * 0 + -qy * vz + qz * vy;\r\n\t\tconst ty = qw * vy + -qy * 0 + -qz * vx + qx * vz;\r\n\t\tconst tz = qw * vz + -qz * 0 + -qx * vy + qy * vx;\r\n\t\tconst tw = qx * vx + qw * 0 + qy * vy + qz * vz;\r\n\r\n\t\tvectorArray[0] = tw * qz + tz * qw + tx * qy - ty * qx;\r\n\t\tvectorArray[1] = tw * qy + ty * qw + tz * qx - tx * qz;\r\n\t\tvectorArray[2] = tw * qx + tx * qw + ty * qz - tz * qy;\r\n\r\n\t\treturn vector;\r\n\t}\r\n\r\n\ttoVector(): Vector3 {\r\n\t\treturn new Vector3([\r\n\t\t\tthis.x, this.y, this.z\r\n\t\t]);\r\n\t}\r\n\t\r\n\tsetEuler(pitch: number, yaw: number, roll: number): this {\r\n\t\tconst cosYaw = Math.cos(yaw * 0.5);\r\n\t\tconst sinYaw = Math.sin(yaw * 0.5);\r\n\t\tconst cosPitch = Math.cos(pitch * 0.5);\r\n\t\tconst sinPitch = Math.sin(pitch * 0.5);\r\n\t\tconst cosRoll = Math.cos(roll * 0.5);\r\n\t\tconst sinRoll = Math.sin(roll * 0.5);\r\n\t\tconst thisArray = this.array;\r\n\r\n        thisArray[0] = sinRoll * cosPitch * cosYaw - cosRoll * sinPitch * sinYaw;\r\n        thisArray[1] = cosRoll * sinPitch * cosYaw + sinRoll * cosPitch * sinYaw;\r\n        thisArray[2] = cosRoll * cosPitch * sinYaw - sinRoll * sinPitch * cosYaw;\r\n\t\tthisArray[3] = cosRoll * cosPitch * cosYaw + sinRoll * sinPitch * sinYaw;\r\n        \r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetAxisAngle(axis: Vector3, angle: number = 0): this {\r\n\t\tconst axisLength = axis.length();\r\n\t\tif (axisLength === 0) {\r\n\t\t  return this;\r\n\t\t}\r\n\t\tconst halfSin = Math.sin(angle * 0.5) / axisLength;\r\n\t\tconst axisArray = axis.array;\r\n\t\tconst thisArray = this.array;\r\n\t\tthisArray[0] = axisArray[0] * halfSin;\r\n\t\tthisArray[1] = axisArray[1] * halfSin;\r\n\t\tthisArray[2] = axisArray[2] * halfSin;\r\n\t\tthisArray[3] = Math.cos(angle * 0.5);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetMatrix(matrix: Matrix3): this\r\n\tsetMatrix(matrix: Matrix4): this\r\n\tsetMatrix(matrix: Matrix3 | Matrix4): this {\r\n\t\tconst matrixArray = matrix.array;\r\n\t\tlet m11 = 0, m12 = 0, m13 = 0,\r\n\t\t\tm21 = 0, m22 = 0, m23 = 0,\r\n\t\t\tm31 = 0, m32 = 0, m33 = 0;\r\n\r\n\t\tif (matrix instanceof Matrix3) {\r\n\t\t\tm11 = matrixArray[0], m12 = matrixArray[3], m13 = matrixArray[6],\r\n\t\t\tm21 = matrixArray[1], m22 = matrixArray[4], m23 = matrixArray[7],\r\n\t\t\tm31 = matrixArray[2], m32 = matrixArray[5], m33 = matrixArray[8];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tm11 = matrixArray[0], m12 = matrixArray[4], m13 = matrixArray[ 8],\r\n\t\t\tm21 = matrixArray[1], m22 = matrixArray[5], m23 = matrixArray[ 9],\r\n\t\t\tm31 = matrixArray[2], m32 = matrixArray[6], m33 = matrixArray[10];\r\n\t\t}\r\n\r\n\t\tconst trace = m11 + m22 + m33;\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tif (trace > 0) {\r\n\t\t\tconst s = Math.sqrt(trace + 1) * 2;\r\n\t\t\tthisArray[3] = 0.25 * s;\r\n\t\t\tthisArray[0] = (m32 - m23) / s;\r\n\t\t\tthisArray[1] = (m13 - m31) / s;\r\n\t\t\tthisArray[2] = (m21 - m12) / s;\r\n\t\t}\r\n\t\telse if (m11 > m22 && m11 > m33) {\r\n\t\t\tconst s = 2 * Math.sqrt(1 + m11 - m22 - m33);\r\n\t\t\tthisArray[3] = (m32 - m23) / s;\r\n\t\t\tthisArray[0] = 0.25 * s;\r\n\t\t\tthisArray[1] = (m12 + m21) / s;\r\n\t\t\tthisArray[2] = (m13 + m31) / s;\r\n\t\t}\r\n\t\telse if (m22 > m33) {\r\n\t\t\tconst s = 2 * Math.sqrt(1 + m22 - m11 - m33);\r\n\t\t\tthisArray[3] = (m13 - m31) / s;\r\n\t\t\tthisArray[0] = (m12 + m21) / s;\r\n\t\t\tthisArray[1] = 0.25 * s;\r\n\t\t\tthisArray[2] = (m23 + m32) / s;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst s = 2 * Math.sqrt(1 + m33 - m11 - m22);\r\n\t\t\tthisArray[3] = (m21 - m12) / s;\r\n\t\t\tthisArray[0] = (m13 + m31) / s;\r\n\t\t\tthisArray[1] = (m23 + m32) / s;\r\n\t\t\tthisArray[2] = 0.25 * s;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tlookAt(source: Vector3, dest: Vector3): Quaternion {\r\n\t\tconst forward = dest.clone().sub(source).normalize();\r\n\r\n\t\tconst axis = Space.forward.clone().cross(forward);\r\n\t\tconst dot = Space.forward.dot(forward);\r\n\r\n\t\treturn new Quaternion(axis.x, axis.y, axis.z, dot + 1).normalize();\r\n\t}\r\n\r\n\tstatic fromMatrix(matrix: Matrix3): QuaternionBase {\r\n\t\treturn new QuaternionBase().setMatrix(matrix);\r\n\t}\r\n\r\n\tsetVectors(from: Vector3, to: Vector3): this {\r\n\t\tconst dot = from.dot(to);\r\n\t\tconst cross = from.cross(to);\r\n\t\tconst crossArray = cross.array;\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tthisArray[0] = crossArray[0];\r\n\t\tthisArray[1] = crossArray[1];\r\n\t\tthisArray[2] = crossArray[2];\r\n\r\n\t\tconst fromLength = from.length();\r\n\t\tconst toLength = from.length();\r\n\r\n\t\tthisArray[3] = Math.sqrt(fromLength * fromLength * toLength * toLength) + dot;\r\n\r\n\t\treturn this.normalize();\r\n\t}\r\n\r\n\tdot(quat: Quaternion): number {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\t\treturn thisArray[0] * quatArray[0] + thisArray[1] * quatArray[1] + thisArray[2] * quatArray[2] + thisArray[3] * quatArray[3];\r\n\t}\r\n\r\n\tlengthSquared(): number {\r\n\t\tconst thisArray = this.array;\r\n\t\treturn thisArray[0] ** 2 + thisArray[1] ** 2 + thisArray[2] ** 2 + thisArray[3] ** 2;\r\n\t}\r\n\r\n\tlength(): number {\r\n\t\tconst thisArray = this.array;\r\n\t\treturn Math.hypot(thisArray[0], thisArray[1], thisArray[2], thisArray[3]);\r\n\t}\r\n\r\n\tangleTo(rotation: Quaternion): number {\r\n\t\treturn 2 * Math.acos(Math.abs(Math.max(-1, Math.min(1, this.dot(rotation)))));\r\n\t}\r\n\r\n\trotateTowards(rotation: Quaternion): this {\r\n\t\tconst angle = this.angleTo(rotation);\r\n\r\n\t\tif (angle === 0) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tconst t = Math.min(1, angle);\r\n\t\tthis.slerp(this, rotation, t);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tinvert(): this {\r\n\t\treturn this.conjugate();\r\n\t}\r\n\t\r\n\tconjugate(): this {\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tthisArray[0] *= -1;\r\n\t\tthisArray[1] *= -1;\r\n\t\tthisArray[2] *= -1;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnormalize(): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tlet length = this.length();\r\n\r\n\t\tif (length === 0) {\r\n\t\t\tthisArray[0] = 0;\r\n\t\t\tthisArray[1] = 0;\r\n\t\t\tthisArray[2] = 0;\r\n\t\t\tthisArray[3] = 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlength = 1 / length;\r\n\t\t\tthisArray[0] *= length;\r\n\t\t\tthisArray[1] *= length;\r\n\t\t\tthisArray[2] *= length;\r\n\t\t\tthisArray[3] *= length;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tadd(quat: Quaternion): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\t\tthisArray[0] += quatArray[0];\r\n\t\tthisArray[1] += quatArray[1];\r\n\t\tthisArray[2] += quatArray[2];\r\n\t\tthisArray[3] += quatArray[3];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsub(quat: Quaternion): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\t\tthisArray[0] -= quatArray[0];\r\n\t\tthisArray[1] -= quatArray[1];\r\n\t\tthisArray[2] -= quatArray[2];\r\n\t\tthisArray[3] -= quatArray[3];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmult(quat: Quaternion): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\r\n\t\tconst ax = thisArray[0], ay = thisArray[1], az = thisArray[2], aw = thisArray[3];\r\n\t\tconst bx = quatArray[0], by = quatArray[1], bz = quatArray[2], bw = quatArray[3];\r\n\r\n\t\tthisArray[0] = ax * bw + aw * bx + ay * bz - az * by;\r\n\t\tthisArray[1] = ay * bw + aw * by + az * bx - ax * bz;\r\n\t\tthisArray[2] = az * bw + aw * bz + ax * by - ay * bx;\r\n\t\tthisArray[3] = aw * bw - ax * bx - ay * by - az * bz;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\r\n\tscale(scalar: number): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tthisArray[0] *= scalar;\r\n\t\tthisArray[1] *= scalar;\r\n\t\tthisArray[2] *= scalar;\r\n\t\tthisArray[3] *= scalar;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tstatic slerp(from: Quaternion, to: Quaternion, t: number): Quaternion\r\n\tstatic slerp(from: Quaternion, to: Quaternion, t: number, out: Quaternion): Quaternion\r\n\tstatic slerp(from: Quaternion, to: Quaternion, t: number, out?: Quaternion): Quaternion {\r\n\t\tif (!(out instanceof Quaternion)) {\r\n\t\t\tout = new Quaternion();\r\n\t\t}\r\n\t\tif (t === 0) return out.copy(from);\r\n\t\tif (t === 1) return out.copy(to);\r\n\r\n\t\tconst outArray = out.array;\r\n\t\tconst fromArray = from.array;\r\n\t\tconst toArray = to.array;\r\n\r\n\t\tconst cosHalfTheta = fromArray[3] * toArray[3] + fromArray[0] * toArray[0] + fromArray[1] * toArray[1] + fromArray[2] * toArray[2];\r\n\t\t\r\n\t\tif (Math.abs(cosHalfTheta) >= 1) {\r\n\t\t\toutArray[3] = fromArray[3];\r\n\t\t\toutArray[0] = fromArray[0];\r\n\t\t\toutArray[1] = fromArray[1];\r\n\t\t\toutArray[2] = fromArray[2];\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\tconst halfTheta = Math.acos(cosHalfTheta);\r\n\t\tconst sinHalfTheta = Math.sqrt(1 - cosHalfTheta * cosHalfTheta);\r\n\t\t\r\n\t\tif (Math.abs(sinHalfTheta - Math.trunc(sinHalfTheta)) < Number.EPSILON) {\r\n\t\t\toutArray[3] = (fromArray[3] * 0.5 + toArray[3] * 0.5);\r\n\t\t\toutArray[0] = (fromArray[0] * 0.5 + toArray[0] * 0.5);\r\n\t\t\toutArray[1] = (fromArray[1] * 0.5 + toArray[1] * 0.5);\r\n\t\t\toutArray[2] = (fromArray[2] * 0.5 + toArray[2] * 0.5);\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\tconst ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta;\r\n\t\tconst ratioB = Math.sin(t * halfTheta) / sinHalfTheta; \r\n\t\toutArray[3] = (fromArray[3] * ratioA + toArray[3] * ratioB);\r\n\t\toutArray[0] = (fromArray[0] * ratioA + toArray[0] * ratioB);\r\n\t\toutArray[1] = (fromArray[1] * ratioA + toArray[1] * ratioB);\r\n\t\toutArray[2] = (fromArray[2] * ratioA + toArray[2] * ratioB);\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\t/**\r\n\t * https://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\t */\r\n\tslerp(from: Quaternion, to: Quaternion, t: number): this {\r\n\t\treturn Quaternion.slerp(from, to, t, this) as this;\r\n\t}\r\n\r\n\tcopyIntoArray(array: WritableArrayLike<number>, offset: number = 0): void {\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tarray[offset    ] = thisArray[0];\r\n\t\tarray[offset + 1] = thisArray[1];\r\n\t\tarray[offset + 2] = thisArray[2];\r\n\t\tarray[offset + 3] = thisArray[3];\r\n    }\r\n    \r\n    readFromArray(array: ArrayLike<number>, offset: number = 0): void {\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tthisArray[0] = array[offset    ];\r\n\t\tthisArray[1] = array[offset + 1];\r\n\t\tthisArray[2] = array[offset + 2];\r\n\t\tthisArray[3] = array[offset + 3];\r\n    }\r\n}\r\n\r\nvar Quaternion: QuaternionConstructor = QuaternionBase;\r\nconst QuaternionPool: StackPool<Quaternion> = new StackPool(QuaternionBase);\r\nconst QuaternionInjector: Injector<QuaternionConstructor> = new Injector({\r\n\tdefaultCtor: QuaternionBase,\r\n\tonDefaultOverride:\r\n\t\t(ctor: QuaternionConstructor) => {\r\n\t\t\tQuaternion = ctor;\r\n\t\t}\r\n});","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { Vector3Pool } from \"../../extensions/pools/Vector3Pools\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { Quaternion } from \"../quaternions/Quaternion\";\r\nimport { Vector2, Vector2Values } from \"../vectors/Vector2\";\r\nimport { Vector3, Vector3Values } from \"../vectors/Vector3\";\r\nimport { Vector4, Vector4Values } from \"../vectors/Vector4\";\r\nimport { Matrix3, Matrix3Values } from \"./Matrix3\";\r\n\r\nexport { Matrix4Values };\r\nexport { Matrix4 };\r\nexport { Matrix4Injector };\r\nexport { Matrix4Base };\r\n\r\ntype Matrix4Values = [\r\n  number, number, number, number,\r\n  number, number, number, number,\r\n  number, number, number, number,\r\n  number, number, number, number\r\n];\r\n\r\ninterface Matrix4Constructor {\r\n\treadonly prototype: Matrix4;\r\n\tnew(): Matrix4;\r\n\tnew(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): Matrix4;\r\n  new(array: ArrayLike<number>): Matrix4;\r\n\r\n  fromValues(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): Matrix4;\r\n  fromArray(array: ArrayLike<number>): Matrix4;\r\n\r\n  invert(A: Matrix4, out: Matrix4): Matrix4;\r\n  transpose(A: Matrix4, out: Matrix4): Matrix4;\r\n  add(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4;\r\n  sub(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4;\r\n  mult(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4;\r\n\r\n  identity(): Matrix4;\r\n  zeros(): Matrix4;\r\n\r\n  translation(vector: Vector3): Matrix4;\r\n  rotationX(angle: number): Matrix4;\r\n  rotationY(angle: number): Matrix4;\r\n  rotationZ(angle: number): Matrix4;\r\n  rotation(matrix: Matrix3): Matrix4;\r\n  scaling(vector: Vector3): Matrix4;\r\n  \r\n  perspective(fieldOfViewYInRadians: number, aspect: number, zNear: number, zFar: number): Matrix4;\r\n  orthographic(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4;\r\n  frustum(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4;\r\n}\r\n\r\n/**\r\n * 4x4 matrix. Values are stored in column major order.\r\n */\r\ninterface Matrix4 {\r\n  readonly array: Float32Array;\r\n  getValues(): Matrix4Values\r\n  setValues(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): this;\r\n  /*row1: Vector4Values;\r\n  row2: Vector4Values;\r\n  row3: Vector4Values;\r\n  row4: Vector4Values;\r\n  col1: Vector4Values;\r\n  col2: Vector4Values;\r\n  col3: Vector4Values;\r\n  col4: Vector4Values;*/\r\n  m11: number;\r\n  m12: number;\r\n  m13: number;\r\n  m14: number;\r\n  m21: number;\r\n  m22: number;\r\n  m23: number;\r\n  m24: number;\r\n  m31: number;\r\n  m32: number;\r\n  m33: number;\r\n  m34: number;\r\n  m41: number;\r\n  m42: number;\r\n  m43: number;\r\n  m44: number;\r\n  //setArray(array: WritableArrayLike<number>): this;\r\n  getRotation(): Quaternion;\r\n  setRotation(rotation: Quaternion): this;\r\n  setTRS(translation: Vector3, rotation: Quaternion, scaling: Vector3): this;\r\n  equals(mat: Matrix4): boolean;\r\n  copy(mat: Matrix4): this;\r\n  clone(): this;\r\n  det(): number;\r\n  trace(): number;\r\n  setIdentity(): this;\r\n  setZeros(): this;\r\n  negate(): this;\r\n  transpose(): this;\r\n  invert(): this;\r\n  add(mat: Matrix4): this;\r\n  sub(mat: Matrix4): this;\r\n  mult(mat: Matrix4): this;\r\n\r\n  getMaxScaleOnAxis(): number;\r\n  solve(vecB: Vector4): Vector4Values;\r\n  solve2(vecB: Vector2): Vector2Values;\r\n  solve3(vecB: Vector3): Vector3Values;\r\n\r\n  writeIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n  readFromArray(arr: ArrayLike<number>, offset?: number): this;\r\n\r\n  setTranslation(vector: Vector3): this;\r\n  translate(vector: Vector3): this;\r\n\r\n  setRotationX(angle: number): this;\r\n  rotateX(angle: number): this;\r\n  setRotationY(angle: number): this;\r\n  rotateY(angle: number): this;\r\n  setRotationZ(angle: number): this;\r\n  rotateZ(angle: number): this;\r\n\r\n  rotate(vector: Vector3, angle: number): this\r\n  rotation(matrix: Matrix3): this;\r\n\r\n  setScaling(vector: Vector3): this;\r\n  scale(vector: Vector3): this;\r\n\r\n  lookAt(eye: Vector3 | Vector3Values, target: Vector3, up: Vector3): this;\r\n\r\n  transformPoint(point: Vector3): Vector3;\r\n  transformPoint4(point: Vector4): Vector4;\r\n  transformDirection(direction: Vector3): Vector3;\r\n  transformNormal(normal: Vector3): Vector3;\r\n  \r\n  setFrustum(left: number, right: number, bottom: number, top: number, near: number, far: number): this;\r\n  setPerspective(fieldOfViewYInRadians: number, aspect: number, zNear: number, zFar: number): this;\r\n  setOrthographic(left: number, right: number, bottom: number, top: number, near: number, far: number): this;\r\n}\r\n\r\nclass Matrix4Base implements Matrix4 {\r\n  readonly array: Float32Array;\r\n\r\n\tconstructor()\r\n  constructor(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  )\r\n  constructor(array: ArrayLike<number>)\r\n\tconstructor(\r\n    ...args: any[]\r\n  ) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis.array = new Float32Array([\r\n        args[ 0], args[ 1], args[ 2], args[ 3],\r\n        args[ 4], args[ 5], args[ 6], args[ 7],\r\n        args[ 8], args[ 9], args[10], args[11],\r\n        args[12], args[13], args[14], args[15]\r\n      ]);\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n      const array = args[0];\r\n      this.checkArray(array);\r\n      if (array instanceof Float32Array) {\r\n        this.array = array;\r\n      }\r\n      else {\r\n        this.array = new Float32Array(array);\r\n      }\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.array = new Float32Array(16);\r\n\t\t}\r\n  }\r\n\r\n  static fromValues(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): Matrix4Base {\r\n    return new Matrix4Base(\r\n      m11, m21, m31, m41,\r\n      m12, m22, m32, m42,\r\n      m13, m23, m33, m43,\r\n      m14, m24, m34, m44\r\n    );\r\n  }\r\n\r\n  static fromArray(array: ArrayLike<number>): Matrix4Base {\r\n    if (array.length < 16) {\r\n      throw new Error(`Matrix4 needs an array of size 16 at least.`);\r\n    }\r\n    return new Matrix4Base(array);\r\n  }\r\n\r\n  getValues(): Matrix4Values {\r\n    const thisArray = this.array;\r\n\t\treturn [\r\n      thisArray[ 0], thisArray[ 1], thisArray[ 2], thisArray[ 3],\r\n      thisArray[ 4], thisArray[ 5], thisArray[ 6], thisArray[ 7],\r\n      thisArray[ 8], thisArray[ 9], thisArray[10], thisArray[11],\r\n      thisArray[12], thisArray[13], thisArray[14], thisArray[15]\r\n    ];\r\n\t}\r\n\r\n\tsetValues(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = m11;\r\n    thisArray[ 1] = m21;\r\n    thisArray[ 2] = m31;\r\n    thisArray[ 3] = m41;\r\n    thisArray[ 4] = m12;\r\n    thisArray[ 5] = m22;\r\n    thisArray[ 6] = m32;\r\n    thisArray[ 7] = m42;\r\n    thisArray[ 8] = m13;\r\n    thisArray[ 9] = m23;\r\n    thisArray[10] = m33;\r\n    thisArray[11] = m43;\r\n    thisArray[12] = m14;\r\n    thisArray[13] = m24;\r\n    thisArray[14] = m34;\r\n    thisArray[15] = m44;\r\n\r\n    return this;\r\n  }\r\n  \r\n  get m11(): number {\r\n\t\treturn this.array[0];\r\n\t}\r\n\r\n\tset m11(val: number) {\r\n\t\tthis.array[0] = val;\r\n  }\r\n  \r\n  get m12() {\r\n\t\treturn this.array[4];\r\n\t}\r\n\r\n\tset m12(val: number) {\r\n\t\tthis.array[4] = val;\r\n  }\r\n  \r\n  get m13() {\r\n\t\treturn this.array[8];\r\n\t}\r\n\r\n\tset m13(val: number) {\r\n\t\tthis.array[8] = val;\r\n  }\r\n  \r\n  get m14() {\r\n\t\treturn this.array[12];\r\n\t}\r\n\r\n\tset m14(val: number) {\r\n\t\tthis.array[12] = val;\r\n  }\r\n  \r\n  get m21() {\r\n\t\treturn this.array[1];\r\n\t}\r\n\r\n\tset m21(val: number) {\r\n\t\tthis.array[1] = val;\r\n  }\r\n  \r\n  get m22() {\r\n\t\treturn this.array[5];\r\n\t}\r\n\r\n\tset m22(val: number) {\r\n\t\tthis.array[5] = val;\r\n  }\r\n  \r\n  get m23() {\r\n\t\treturn this.array[9];\r\n\t}\r\n\r\n\tset m23(val: number) {\r\n\t\tthis.array[9] = val;\r\n  }\r\n  \r\n  get m24() {\r\n\t\treturn this.array[13];\r\n\t}\r\n\r\n\tset m24(val: number) {\r\n\t\tthis.array[13] = val;\r\n  }\r\n  \r\n  get m31() {\r\n\t\treturn this.array[2];\r\n\t}\r\n\r\n  set m31(val: number) {\r\n\t\tthis.array[2] = val;\r\n  }\r\n  \r\n  get m32() {\r\n\t\treturn this.array[6];\r\n\t}\r\n\r\n\tset m32(val: number) {\r\n\t\tthis.array[6] = val;\r\n  }\r\n  \r\n  get m33() {\r\n\t\treturn this.array[10];\r\n\t}\r\n\r\n  set m33(val: number) {\r\n\t\tthis.array[10] = val;\r\n  }\r\n  \r\n  get m34() {\r\n\t\treturn this.array[14];\r\n\t}\r\n\r\n\tset m34(m34: number) {\r\n\t\tthis.array[14] = m34;\r\n  }\r\n  \r\n  get m41() {\r\n\t\treturn this.array[3];\r\n\t}\r\n\r\n\tset m41(val: number) {\r\n\t\tthis.array[3] = val;\r\n  }\r\n  \r\n  get m42() {\r\n\t\treturn this.array[7];\r\n\t}\r\n\r\n\tset m42(val: number) {\r\n\t\tthis.array[7] = val;\r\n  }\r\n  \r\n  get m43() {\r\n\t\treturn this.array[11];\r\n\t}\r\n\r\n\tset m43(val: number) {\r\n\t\tthis.array[11] = val;\r\n  }\r\n  \r\n  get m44() {\r\n\t\treturn this.array[15];\r\n\t}\r\n\r\n\tset m44(m44: number) {\r\n\t\tthis.array[15] = m44;\r\n  }\r\n\r\n  private checkArray(array: ArrayLike<number>): void {\r\n\t\tif (array.length < 16) {\r\n\t\t\tthrow new MathError(`Array must be of length 16 at least.`);\r\n\t\t}\r\n\t}\r\n\r\n\t// setArray(array: WritableArrayLike<number>): this {\r\n\t// \tthis._checkArray(array);\r\n\t// \tthisArray = array;\r\n\t// \treturn this;\r\n\t// }\r\n\r\n  getRotation(): Quaternion {\r\n    const thisArray = this.array;\r\n    const m11 = thisArray[0], m12 = thisArray[4], m13 = thisArray[ 8],\r\n          m21 = thisArray[1], m22 = thisArray[5], m23 = thisArray[ 9],\r\n          m31 = thisArray[2], m32 = thisArray[6], m33 = thisArray[10];\r\n    const trace = m11 + m22 + m33;\r\n    \r\n    let x = 0;\r\n    let y = 0;\r\n    let z = 0;\r\n    let w = 0;\r\n\r\n    if (trace > 0) {\r\n      const s = Math.sqrt(trace + 1) * 2;\r\n      w = 0.25 * s;\r\n      x = (m32 - m23) / s;\r\n      y = (m13 - m31) / s;\r\n      z = (m21 - m12) / s;\r\n    }\r\n    else if (m11 > m22 && m11 > m33) {\r\n      const s = 2 * Math.sqrt(1 + m11 - m22 - m33);\r\n      w = (m32 - m23) / s;\r\n      x = 0.25 * s;\r\n      y = (m12 + m21) / s;\r\n      z = (m13 + m31) / s;\r\n    }\r\n    else if (m22 > m33) {\r\n      const s = 2 * Math.sqrt(1 + m22 - m11 - m33);\r\n      w = (m13 - m31) / s;\r\n      x = (m12 + m21) / s;\r\n      y = 0.25 * s;\r\n      z = (m23 + m32) / s;\r\n    }\r\n    else {\r\n      const s = 2 * Math.sqrt(1 + m33 - m11 - m22);\r\n      w = (m21 - m12) / s;\r\n      x = (m13 + m31) / s;\r\n      y = (m23 + m32) / s;\r\n      z = 0.25 * s;\r\n    }\r\n    \r\n    return new Quaternion(x, y, z, w);\r\n  }\r\n\r\n  setTRS(translation: Vector3, rotation: Quaternion, scaling: Vector3): this {\r\n    const thisArray = this.array;\r\n    const rotationArray = rotation.array;\r\n    const translationArray = translation.array;\r\n    const scalingArray = scaling.array;\r\n\r\n    const x = rotationArray[0];\r\n    const y = rotationArray[1];\r\n    const z = rotationArray[2];\r\n    const w = rotationArray[3];\r\n\r\n    const x2 = x + x;\r\n    const y2 = y + y;\r\n    const z2 = z + z;\r\n\r\n    const xx = x * x2;\r\n    const xy = x * y2;\r\n    const xz = x * z2;\r\n    const yy = y * y2;\r\n    const yz = y * z2;\r\n    const zz = z * z2;\r\n    const wx = w * x2;\r\n    const wy = w * y2;\r\n    const wz = w * z2;\r\n    const sx = scalingArray[0];\r\n    const sy = scalingArray[1];\r\n    const sz = scalingArray[2];\r\n\r\n    thisArray[0] = (1 - (yy + zz)) * sx;\r\n    thisArray[1] = (xy + wz) * sx;\r\n    thisArray[2] = (xz - wy) * sx;\r\n    thisArray[3] = 0;\r\n    thisArray[4] = (xy - wz) * sy;\r\n    thisArray[5] = (1 - (xx + zz)) * sy;\r\n    thisArray[6] = (yz + wx) * sy;\r\n    thisArray[7] = 0;\r\n    thisArray[8] = (xz + wy) * sz;\r\n    thisArray[9] = (yz - wx) * sz;\r\n    thisArray[10] = (1 - (xx + yy)) * sz;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = translationArray[0];\r\n    thisArray[13] = translationArray[1];\r\n    thisArray[14] = translationArray[2];\r\n    thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n  \r\n  setRotation(quaternion: Quaternion): this {\r\n    const thisArray = this.array;\r\n    const quaternionArray = quaternion.array;\r\n\t\tconst quaternionLengthSquared = quaternion.lengthSquared();\r\n\t\tconst s = 2.0 / quaternionLengthSquared;\r\n\r\n\t\tconst x = quaternionArray[0];\r\n\t\tconst y = quaternionArray[1];\r\n\t\tconst z = quaternionArray[2];\r\n\t\tconst w = quaternionArray[3];\r\n\r\n\t\tconst xs = x * s;\r\n\t\tconst ys = y * s;\r\n\t\tconst zs = z * s;\r\n\t  \r\n\t\tconst wx = w * xs;\r\n\t\tconst wy = w * ys;\r\n\t\tconst wz = w * zs;\r\n\t  \r\n\t\tconst xx = x * xs;\r\n\t\tconst xy = x * ys;\r\n\t\tconst xz = x * zs;\r\n\t\t\r\n\t\tconst yy = y * ys;\r\n\t\tconst yz = y * zs;\r\n\t\tconst zz = z * zs;\r\n\r\n    const m11 = 1 - (yy + zz);\r\n    const m21 = xy + wz;\r\n    const m31 = xz - wy;\r\n    const m12 = xy - wz;\r\n    const m22 = 1 - (xx + zz);\r\n    const m32 = yz + wx;\r\n    const m13 = xz + wy;\r\n    const m23 = yz - wx;\r\n    const m33 = 1 - (xx + yy);\r\n\r\n    thisArray[ 0] = m11;\r\n    thisArray[ 1] = m21;\r\n    thisArray[ 2] = m31;\r\n    thisArray[ 4] = m12;\r\n    thisArray[ 5] = m22;\r\n    thisArray[ 6] = m32;\r\n    thisArray[ 8] = m13;\r\n    thisArray[ 9] = m23;\r\n    thisArray[10] = m33;\r\n\r\n    return this;\r\n  }\r\n\r\n  equals(mat: Matrix4): boolean {\r\n    const thisArray = this.array;\r\n    const matArray = mat.array;\r\n    return thisArray[ 0] === matArray[ 0]\r\n      && thisArray[ 1] === matArray[ 1]\r\n      && thisArray[ 2] === matArray[ 2]\r\n      && thisArray[ 3] === matArray[ 3]\r\n      && thisArray[ 4] === matArray[ 4]\r\n      && thisArray[ 5] === matArray[ 5]\r\n      && thisArray[ 6] === matArray[ 6]\r\n      && thisArray[ 7] === matArray[ 7]\r\n      && thisArray[ 8] === matArray[ 8]\r\n      && thisArray[ 9] === matArray[ 9]\r\n      && thisArray[10] === matArray[10]\r\n      && thisArray[11] === matArray[11]\r\n      && thisArray[12] === matArray[12]\r\n      && thisArray[13] === matArray[13]\r\n      && thisArray[14] === matArray[14]\r\n      && thisArray[15] === matArray[15];\r\n  }\r\n\r\n  copy(mat: Matrix4): this {\r\n    const thisArray = this.array;\r\n    const matArray = mat.array;\r\n\r\n    thisArray[ 0] = matArray[ 0];\r\n    thisArray[ 1] = matArray[ 1];\r\n    thisArray[ 2] = matArray[ 2];\r\n    thisArray[ 3] = matArray[ 3];\r\n    thisArray[ 4] = matArray[ 4];\r\n    thisArray[ 5] = matArray[ 5];\r\n    thisArray[ 6] = matArray[ 6];\r\n    thisArray[ 7] = matArray[ 7];\r\n    thisArray[ 8] = matArray[ 8];\r\n    thisArray[ 9] = matArray[ 9];\r\n    thisArray[10] = matArray[10];\r\n    thisArray[11] = matArray[11];\r\n    thisArray[12] = matArray[12];\r\n    thisArray[13] = matArray[13];\r\n    thisArray[14] = matArray[14];\r\n    thisArray[15] = matArray[15];\r\n\r\n    return this;\r\n  }\r\n\r\n  clone(): this {\r\n    const thisArray = this.array;\r\n    return new Matrix4Base(\r\n      thisArray[ 0], thisArray[ 1], thisArray[ 2], thisArray[ 3],\r\n      thisArray[ 4], thisArray[ 5], thisArray[ 6], thisArray[ 7],\r\n      thisArray[ 8], thisArray[ 9], thisArray[10], thisArray[11],\r\n      thisArray[12], thisArray[13], thisArray[14], thisArray[15]\r\n    ) as this;\r\n  }\r\n\r\n  static identity(): Matrix4Base {\r\n    return new Matrix4Base(\r\n      1, 0, 0, 0,\r\n      0, 1, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n    );\r\n  }\r\n\r\n  setIdentity(): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = 1;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 1;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 1;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  static zeros(): Matrix4Base {\r\n    return new Matrix4Base(\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0\r\n    );\r\n  }\r\n\r\n  setZeros(): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = 0;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 0;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 0;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  det(): number {\r\n    const thisArray = this.array;\r\n    const det2_01_01 = thisArray[0] * thisArray[5] - thisArray[1] * thisArray[4];\r\n    const det2_01_02 = thisArray[0] * thisArray[6] - thisArray[2] * thisArray[4];\r\n    const det2_01_03 = thisArray[0] * thisArray[7] - thisArray[3] * thisArray[4];\r\n    const det2_01_12 = thisArray[1] * thisArray[6] - thisArray[2] * thisArray[5];\r\n    const det2_01_13 = thisArray[1] * thisArray[7] - thisArray[3] * thisArray[5];\r\n    const det2_01_23 = thisArray[2] * thisArray[7] - thisArray[3] * thisArray[6];\r\n    const det3_201_012 = thisArray[8] * det2_01_12 - thisArray[ 9] * det2_01_02 + thisArray[10] * det2_01_01;\r\n    const det3_201_013 = thisArray[8] * det2_01_13 - thisArray[ 9] * det2_01_03 + thisArray[11] * det2_01_01;\r\n    const det3_201_023 = thisArray[8] * det2_01_23 - thisArray[10] * det2_01_03 + thisArray[11] * det2_01_02;\r\n    const det3_201_123 = thisArray[9] * det2_01_23 - thisArray[10] * det2_01_13 + thisArray[11] * det2_01_12;\r\n\r\n    return -det3_201_123 * thisArray[12] + det3_201_023 * thisArray[13]\r\n      - det3_201_013 * thisArray[14] + det3_201_012 * thisArray[15];\r\n  }\r\n\r\n  trace(): number {\r\n    const thisArray = this.array;\r\n    return thisArray[0] + thisArray[5] + thisArray[10] + thisArray[15];\r\n  }\r\n\r\n  static negate(A: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const o = out.array;\r\n\r\n    o[ 0] = -a[ 0];\r\n    o[ 1] = -a[ 1];\r\n    o[ 2] = -a[ 2];\r\n    o[ 3] = -a[ 3];\r\n    o[ 4] = -a[ 4];\r\n    o[ 5] = -a[ 5];\r\n    o[ 6] = -a[ 6];\r\n    o[ 7] = -a[ 7];\r\n    o[ 8] = -a[ 8];\r\n    o[ 9] = -a[ 9];\r\n    o[10] = -a[10];\r\n    o[11] = -a[11];\r\n    o[12] = -a[12];\r\n    o[13] = -a[13];\r\n    o[14] = -a[14];\r\n    o[15] = -a[15];\r\n\r\n    return out;\r\n  }\r\n\r\n  negate(): this {\r\n    return Matrix4Base.negate(this, this) as this;\r\n  }\r\n\r\n  static transpose(A: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const o = out.array;\r\n\r\n    const a11 = a[ 0];\r\n    const a21 = a[ 1];\r\n    const a31 = a[ 2];\r\n    const a41 = a[ 3];\r\n    const a12 = a[ 4];\r\n    const a22 = a[ 5];\r\n    const a32 = a[ 6];\r\n    const a42 = a[ 7];\r\n    const a13 = a[ 8];\r\n    const a23 = a[ 9];\r\n    const a33 = a[10];\r\n    const a43 = a[11];\r\n    const a14 = a[12];\r\n    const a24 = a[13];\r\n    const a34 = a[14];\r\n    const a44 = a[15];\r\n\r\n    o[ 0] = a11;\r\n    o[ 1] = a12;\r\n    o[ 2] = a13;\r\n    o[ 3] = a14;\r\n    o[ 4] = a21;\r\n    o[ 5] = a22;\r\n    o[ 6] = a23;\r\n    o[ 7] = a24;\r\n    o[ 8] = a31;\r\n    o[ 9] = a32;\r\n    o[10] = a33;\r\n    o[11] = a34;\r\n    o[12] = a41;\r\n    o[13] = a42;\r\n    o[14] = a43;\r\n    o[15] = a44;\r\n    \r\n    return out;\r\n  }\r\n\r\n  transpose(): this {\r\n    return Matrix4Base.transpose(this, this) as this;\r\n  }\r\n\r\n  static invert(A: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const o = out.array;\r\n\r\n    const o00 = a[ 0];\r\n    const o01 = a[ 1];\r\n    const o02 = a[ 2];\r\n    const o03 = a[ 3];\r\n    const o10 = a[ 4];\r\n    const o11 = a[ 5];\r\n    const o12 = a[ 6];\r\n    const o13 = a[ 7];\r\n    const o20 = a[ 8];\r\n    const o21 = a[ 9];\r\n    const o22 = a[10];\r\n    const o23 = a[11];\r\n    const o30 = a[12];\r\n    const o31 = a[13];\r\n    const o32 = a[14];\r\n    const o33 = a[15];\r\n\r\n    const t00 = o00 * o11 - o01 * o10;\r\n    const t01 = o00 * o12 - o02 * o10;\r\n    const t02 = o00 * o13 - o03 * o10;\r\n    const t03 = o01 * o12 - o02 * o11;\r\n    const t04 = o01 * o13 - o03 * o11;\r\n    const t05 = o02 * o13 - o03 * o12;\r\n    const t06 = o20 * o31 - o21 * o30;\r\n    const t07 = o20 * o32 - o22 * o30;\r\n    const t08 = o20 * o33 - o23 * o30;\r\n    const t09 = o21 * o32 - o22 * o31;\r\n    const t10 = o21 * o33 - o23 * o31;\r\n    const t11 = o22 * o33 - o23 * o32;\r\n\r\n    const d = (t00 * t11 - t01 * t10 + t02 * t09 + t03 * t08 - t04 * t07 + t05 * t06);\r\n    \r\n    if (d == 0) {\r\n      throw new MathError(`Matrix is not invertible.`);\r\n    }\r\n\r\n    const invDet = 1 / d;\r\n\r\n    o[ 0] = (o11 * t11 - o12 * t10 + o13 * t09) * invDet;\r\n    o[ 1] = (-o01 * t11 + o02 * t10 - o03 * t09) * invDet;\r\n    o[ 2] = (o31 * t05 - o32 * t04 + o33 * t03) * invDet;\r\n    o[ 3] = (-o21 * t05 + o22 * t04 - o23 * t03) * invDet;\r\n    o[ 4] = (-o10 * t11 + o12 * t08 - o13 * t07) * invDet;\r\n    o[ 5] = (o00 * t11 - o02 * t08 + o03 * t07) * invDet;\r\n    o[ 6] = (-o30 * t05 + o32 * t02 - o33 * t01) * invDet;\r\n    o[ 7] = (o20 * t05 - o22 * t02 + o23 * t01) * invDet;\r\n    o[ 8] = (o10 * t10 - o11 * t08 + o13 * t06) * invDet;\r\n    o[ 9] = (-o00 * t10 + o01 * t08 - o03 * t06) * invDet;\r\n    o[10] = (o30 * t04 - o31 * t02 + o33 * t00) * invDet;\r\n    o[11] = (-o20 * t04 + o21 * t02 - o23 * t00) * invDet;\r\n    o[12] = (-o10 * t09 + o11 * t07 - o12 * t06) * invDet;\r\n    o[13] = (o00 * t09 - o01 * t07 + o02 * t06) * invDet;\r\n    o[14] = (-o30 * t03 + o31 * t01 - o32 * t00) * invDet;\r\n    o[15] = (o20 * t03 - o21 * t01 + o22 * t00) * invDet;\r\n\r\n    return out;\r\n  }\r\n\r\n  invert(): this {\r\n    return Matrix4Base.invert(this, this) as this;\r\n  }\r\n\r\n  static add(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const b = B.array;\r\n    const o = out.array;\r\n\r\n    o[ 0] = a[ 0] + b[ 0];\r\n    o[ 1] = a[ 1] + b[ 1];\r\n    o[ 2] = a[ 2] + b[ 2];\r\n    o[ 3] = a[ 3] + b[ 3];\r\n    o[ 4] = a[ 4] + b[ 4];\r\n    o[ 5] = a[ 5] + b[ 5];\r\n    o[ 6] = a[ 6] + b[ 6];\r\n    o[ 7] = a[ 7] + b[ 7];\r\n    o[ 8] = a[ 8] + b[ 8];\r\n    o[ 9] = a[ 9] + b[ 9];\r\n    o[10] = a[10] + b[10];\r\n    o[11] = a[11] + b[11];\r\n    o[12] = a[12] + b[12];\r\n    o[13] = a[13] + b[13];\r\n    o[14] = a[14] + b[14];\r\n    o[15] = a[15] + b[15];\r\n\r\n    return out;\r\n  }\r\n\r\n  add(matrix: Matrix4): this {\r\n    return Matrix4Base.add(this, matrix, this) as this;\r\n  }\r\n\r\n  static sub(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const b = B.array;\r\n    const o = out.array;\r\n\r\n    o[ 0] = a[ 0] - b[ 0];\r\n    o[ 1] = a[ 1] - b[ 1];\r\n    o[ 2] = a[ 2] - b[ 2];\r\n    o[ 3] = a[ 3] - b[ 3];\r\n    o[ 4] = a[ 4] - b[ 4];\r\n    o[ 5] = a[ 5] - b[ 5];\r\n    o[ 6] = a[ 6] - b[ 6];\r\n    o[ 7] = a[ 7] - b[ 7];\r\n    o[ 8] = a[ 8] - b[ 8];\r\n    o[ 9] = a[ 9] - b[ 9];\r\n    o[10] = a[10] - b[10];\r\n    o[11] = a[11] - b[11];\r\n    o[12] = a[12] - b[12];\r\n    o[13] = a[13] - b[13];\r\n    o[14] = a[14] - b[14];\r\n    o[15] = a[15] - b[15];\r\n\r\n    return out;\r\n  }\r\n\r\n  sub(matrix: Matrix4): this {\r\n    return Matrix4Base.sub(this, matrix, this) as this;\r\n  }\r\n\r\n  static mult(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const b = B.array;\r\n    const o = out.array;\r\n\r\n    const a11 = a[ 0];\r\n    const a21 = a[ 1];\r\n    const a31 = a[ 2];\r\n    const a41 = a[ 3];\r\n    const a12 = a[ 4];\r\n    const a22 = a[ 5];\r\n    const a32 = a[ 6];\r\n    const a42 = a[ 7];\r\n    const a13 = a[ 8];\r\n    const a23 = a[ 9];\r\n    const a33 = a[10];\r\n    const a43 = a[11];\r\n    const a14 = a[12];\r\n    const a24 = a[13];\r\n    const a34 = a[14];\r\n    const a44 = a[15];\r\n\r\n    const b11 = b[ 0];\r\n    const b21 = b[ 1];\r\n    const b31 = b[ 2];\r\n    const b41 = b[ 3];\r\n    const b12 = b[ 4];\r\n    const b22 = b[ 5];\r\n    const b32 = b[ 6];\r\n    const b42 = b[ 7];\r\n    const b13 = b[ 8];\r\n    const b23 = b[ 9];\r\n    const b33 = b[10];\r\n    const b43 = b[11];\r\n    const b14 = b[12];\r\n    const b24 = b[13];\r\n    const b34 = b[14];\r\n    const b44 = b[15];\r\n\r\n    o[ 0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n    o[ 1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n    o[ 2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n    o[ 3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n    o[ 4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n    o[ 5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n    o[ 6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n    o[ 7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n    o[ 8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n    o[ 9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n    o[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n    o[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n    o[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n    o[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n    o[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n    o[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n    return out;\r\n  }\r\n\r\n  mult(matrix: Matrix4): this {\r\n    return Matrix4Base.mult(this, matrix, this) as this;\r\n  }\r\n\r\n\tgetMaxScaleOnAxis(): number {\r\n    const thisArray = this.array;\r\n    const scaleXSq = thisArray[ 0] * thisArray[ 0] + thisArray[ 1] * thisArray[ 1] + thisArray[ 2] * thisArray[ 2];\r\n    const scaleYSq = thisArray[ 4] * thisArray[ 4] + thisArray[ 5] * thisArray[ 5] + thisArray[ 6] * thisArray[ 6];\r\n    const scaleZSq = thisArray[ 8] * thisArray[ 8] + thisArray[ 9] * thisArray[ 9] + thisArray[10] * thisArray[10];\r\n\r\n    return Math.sqrt(Math.max(scaleXSq, scaleYSq, scaleZSq));\r\n  }\r\n\r\n  writeIntoArray(array: WritableArrayLike<number>, offset: number = 0): void {\r\n    const thisArray = this.array;\r\n\t\tarray[offset     ] = thisArray[ 0];\r\n\t\tarray[offset +  1] = thisArray[ 1];\r\n    array[offset +  2] = thisArray[ 2];\r\n    array[offset +  3] = thisArray[ 3];\r\n\t\tarray[offset +  4] = thisArray[ 4];\r\n    array[offset +  5] = thisArray[ 5];\r\n    array[offset +  6] = thisArray[ 6];\r\n\t\tarray[offset +  7] = thisArray[ 7];\r\n    array[offset +  8] = thisArray[ 8];\r\n    array[offset +  9] = thisArray[ 9];\r\n\t\tarray[offset + 10] = thisArray[10];\r\n    array[offset + 11] = thisArray[11];\r\n    array[offset + 12] = thisArray[12];\r\n\t\tarray[offset + 13] = thisArray[13];\r\n    array[offset + 14] = thisArray[14];\r\n    array[offset + 15] = thisArray[15];\r\n  }\r\n    \r\n  readFromArray(array: ArrayLike<number>, offset: number = 0): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = array[offset     ];\r\n    thisArray[ 1] = array[offset +  1];\r\n    thisArray[ 2] = array[offset +  2];\r\n    thisArray[ 3] = array[offset +  3];\r\n    thisArray[ 4] = array[offset +  4];\r\n    thisArray[ 5] = array[offset +  5];\r\n    thisArray[ 6] = array[offset +  6];\r\n    thisArray[ 7] = array[offset +  7];\r\n    thisArray[ 8] = array[offset +  8];\r\n    thisArray[ 9] = array[offset +  9];\r\n    thisArray[10] = array[offset + 10];\r\n    thisArray[11] = array[offset + 11];\r\n    thisArray[12] = array[offset + 12];\r\n    thisArray[13] = array[offset + 13];\r\n    thisArray[14] = array[offset + 14];\r\n    thisArray[15] = array[offset + 15];\r\n\r\n    return this;\r\n  }\r\n\r\n  solve(vecB: Vector4): Vector4Values {\r\n    const a = this.array;\r\n\r\n    const a11 = a[ 0];\r\n    const a12 = a[ 1];\r\n    const a13 = a[ 2];\r\n    const a14 = a[ 3];\r\n    const a21 = a[ 4];\r\n    const a22 = a[ 5];\r\n    const a23 = a[ 6];\r\n    const a24 = a[ 7];\r\n    const a31 = a[ 8];\r\n    const a32 = a[ 9];\r\n    const a33 = a[10];\r\n    const a34 = a[11];\r\n    const a41 = a[12];\r\n    const a42 = a[13];\r\n    const a43 = a[14];\r\n    const a44 = a[15];\r\n    const b00 = a11 * a22 - a12 * a21;\r\n    const b01 = a11 * a23 - a13 * a21;\r\n    const b02 = a11 * a24 - a14 * a21;\r\n    const b03 = a12 * a23 - a13 * a22;\r\n    const b04 = a12 * a24 - a14 * a22;\r\n    const b05 = a13 * a24 - a14 * a23;\r\n    const b06 = a31 * a42 - a32 * a41;\r\n    const b07 = a31 * a43 - a33 * a41;\r\n    const b08 = a31 * a44 - a34 * a41;\r\n    const b09 = a32 * a43 - a33 * a42;\r\n    const b10 = a32 * a44 - a34 * a42;\r\n    const b11 = a33 * a44 - a34 * a43;\r\n\r\n    const bX = vecB.x;\r\n    const bY = vecB.y;\r\n    const bZ = vecB.z;\r\n    const bW = vecB.w;\r\n\r\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n    if (det != 0) {\r\n      det = 1 / det;\r\n    }\r\n\r\n    const x = det *\r\n      ((a22 * b11 - a23 * b10 + a24 * b09) * bX -\r\n      (a21 * b11 - a23 * b08 + a24 * b07) * bY +\r\n      (a21 * b10 - a22 * b08 + a24 * b06) * bZ -\r\n      (a21 * b09 - a22 * b07 + a23 * b06) * bW)\r\n    const y = det *\r\n      -((a12 * b11 - a13 * b10 + a14 * b09) * bX -\r\n      (a11 * b11 - a13 * b08 + a14 * b07) * bY +\r\n      (a11 * b10 - a12 * b08 + a14 * b06) * bZ -\r\n      (a11 * b09 - a12 * b07 + a13 * b06) * bW)\r\n    const z = det *\r\n      ((a42 * b05 - a43 * b04 + a44 * b03) * bX -\r\n      (a41 * b05 - a43 * b02 + a44 * b01) * bY +\r\n      (a41 * b04 - a42 * b02 + a44 * b00) * bZ -\r\n      (a41 * b03 - a42 * b01 + a43 * b00) * bW)\r\n    const w = det *\r\n      -((a32 * b05 - a33 * b04 + a34 * b03) * bX -\r\n      (a31 * b05 - a33 * b02 + a34 * b01) * bY +\r\n      (a31 * b04 - a32 * b02 + a34 * b00) * bZ -\r\n      (a31 * b03 - a32 * b01 + a33 * b00) * bW);\r\n    \r\n    return [\r\n      x, y, z, w\r\n    ];\r\n  }\r\n\r\n  solve2(vecB: Vector2): Vector2Values {\r\n    const a = this.array;\r\n\r\n    const a11 = a[0];\r\n    const a12 = a[1];\r\n    const a21 = a[4];\r\n    const a22 = a[5];\r\n    const bx = vecB.x - a[8];\r\n    const by = vecB.y - a[9];\r\n    \r\n    let det = a11 * a22 - a12 * a21;\r\n\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    const x = det * (a22 * bx - a12 * by);\r\n    const y = det * (a11 * by - a21 * bx);\r\n\r\n    return [\r\n      x, y\r\n    ];\r\n  }\r\n\r\n  solve3(vecB: Vector3): Vector3Values {\r\n    const a = this.array;\r\n\r\n    const a11 = a[ 0];\r\n    const a12 = a[ 1];\r\n    const a13 = a[ 2];\r\n    const a21 = a[ 4];\r\n    const a22 = a[ 5];\r\n    const a23 = a[ 6];\r\n    const a31 = a[ 8];\r\n    const a32 = a[ 9];\r\n    const a33 = a[10];\r\n    const bx = vecB.x - a[12];\r\n    const by = vecB.y - a[13];\r\n    const bz = vecB.z - a[14];\r\n\r\n    let rx = a22 * a33 - a23 * a32;\r\n    let ry = a23 * a31 - a21 * a33;\r\n    let rz = a21 * a32 - a22 * a31;\r\n\r\n    let det = a11 * rx + a12 * ry + a13 * rz;\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    const x = det * (bx * rx + by * ry + bz * rz);\r\n\r\n    rx = -(a32 * bz - a33 * by);\r\n    ry = -(a33 * bx - a31 * bz);\r\n    rz = -(a31 * by - a32 * bx);\r\n    \r\n    const y = det * (a11 * rx + a12 * ry + a13 * rz);\r\n    \r\n    rx = -(by * a23 - bz * a22);\r\n    ry = -(bz * a21 - bx * a23);\r\n    rz = -(bx * a22 - by * a21);\r\n    \r\n    const z = det * (a11 * rx + a12 * ry + a13 * rz);\r\n\r\n    return [\r\n      x, y, z\r\n    ];\r\n  }\r\n\r\n  static translation(vector: Vector3): Matrix4Base {\r\n    return new Matrix4Base().setTranslation(vector);\r\n  }\r\n\r\n  setTranslation(vec: Vector3): this {\r\n    const thisArray = this.array;\r\n    const vecArray = vec.array;\r\n\r\n    const x = vecArray[0];\r\n    const y = vecArray[1];\r\n    const z = vecArray[2];\r\n\r\n    /*thisArray[ 0] = 1;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 1;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 1;\r\n    thisArray[11] = 0;*/\r\n    thisArray[12] = x;\r\n    thisArray[13] = y;\r\n    thisArray[14] = z;\r\n    //thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  translate(vector: Vector3): this {\r\n    const thisArray = this.array;\r\n    const vectorArray = vector.array;\r\n\r\n    const tx = vectorArray[0];\r\n    const ty = vectorArray[1];\r\n    const tz = vectorArray[2];\r\n    const tw = 1;\r\n\r\n    const t1 = thisArray[0] * tx + thisArray[4] * ty + thisArray[ 8] * tz + thisArray[12] * tw;\r\n    const t2 = thisArray[1] * tx + thisArray[5] * ty + thisArray[ 9] * tz + thisArray[13] * tw;\r\n    const t3 = thisArray[2] * tx + thisArray[6] * ty + thisArray[10] * tz + thisArray[14] * tw;\r\n    const t4 = thisArray[3] * tx + thisArray[7] * ty + thisArray[11] * tz + thisArray[15] * tw;\r\n\r\n    thisArray[12] = t1;\r\n    thisArray[13] = t2;\r\n    thisArray[14] = t3;\r\n    thisArray[15] = t4;\r\n\r\n    return this;\r\n  }\r\n\r\n  static rotationX(angle: number): Matrix4Base {\r\n    return new Matrix4Base().setRotationX(angle);\r\n  }\r\n\r\n  setRotationX(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    thisArray[ 0] = 1;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = cosAngle;\r\n    thisArray[ 6] = sinAngle;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = -sinAngle;\r\n    thisArray[10] = cosAngle;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  rotateX(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    const t1 = thisArray[4] *  cosAngle + thisArray[ 8] * sinAngle;\r\n    const t2 = thisArray[5] *  cosAngle + thisArray[ 9] * sinAngle;\r\n    const t3 = thisArray[6] *  cosAngle + thisArray[10] * sinAngle;\r\n    const t4 = thisArray[7] *  cosAngle + thisArray[11] * sinAngle;\r\n    const t5 = thisArray[4] * -sinAngle + thisArray[ 8] * cosAngle;\r\n    const t6 = thisArray[5] * -sinAngle + thisArray[ 9] * cosAngle;\r\n    const t7 = thisArray[6] * -sinAngle + thisArray[10] * cosAngle;\r\n    const t8 = thisArray[7] * -sinAngle + thisArray[11] * cosAngle;\r\n\r\n    thisArray[ 4] = t1;\r\n    thisArray[ 5] = t2;\r\n    thisArray[ 6] = t3;\r\n    thisArray[ 7] = t4;\r\n    thisArray[ 8] = t5;\r\n    thisArray[ 9] = t6;\r\n    thisArray[10] = t7;\r\n    thisArray[11] = t8;\r\n\r\n    return this;\r\n  }\r\n\r\n  static rotationY(angle: number): Matrix4Base {\r\n    return new Matrix4Base().setRotationY(angle);\r\n  }\r\n\r\n  setRotationY(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    thisArray[ 0] = cosAngle;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = -sinAngle;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 1;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = sinAngle;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = cosAngle;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 1;\r\n    \r\n    return this;\r\n  }\r\n\r\n  rotateY(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    const t1 = thisArray[ 0] * cosAngle + thisArray[ 8] * -sinAngle;\r\n    const t2 = thisArray[ 1] * cosAngle + thisArray[ 9] * -sinAngle;\r\n    const t3 = thisArray[ 2] * cosAngle + thisArray[10] * -sinAngle;\r\n    const t4 = thisArray[ 3] * cosAngle + thisArray[11] * -sinAngle;\r\n    const t5 = thisArray[ 0] * sinAngle + thisArray[ 8] *  cosAngle;\r\n    const t6 = thisArray[ 1] * sinAngle + thisArray[ 9] *  cosAngle;\r\n    const t7 = thisArray[ 2] * sinAngle + thisArray[10] *  cosAngle;\r\n    const t8 = thisArray[ 3] * sinAngle + thisArray[11] *  cosAngle;\r\n\r\n    thisArray[ 0] = t1;\r\n    thisArray[ 1] = t2;\r\n    thisArray[ 2] = t3;\r\n    thisArray[ 3] = t4;\r\n    thisArray[ 8] = t5;\r\n    thisArray[ 9] = t6;\r\n    thisArray[10] = t7;\r\n    thisArray[11] = t8;\r\n\r\n    return this;\r\n  }\r\n\r\n  static rotationZ(angle: number): Matrix4Base {\r\n    return new Matrix4Base().setRotationZ(angle);\r\n  }\r\n\r\n  setRotationZ(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngles = Math.sin(angle);\r\n\r\n    thisArray[ 0] = cosAngle;\r\n    thisArray[ 1] = sinAngles;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = -sinAngles;\r\n    thisArray[ 5] = cosAngle;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 1;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  rotateZ(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    const t1 = thisArray[0] *  cosAngle + thisArray[4] * sinAngle;\r\n    const t2 = thisArray[1] *  cosAngle + thisArray[5] * sinAngle;\r\n    const t3 = thisArray[2] *  cosAngle + thisArray[6] * sinAngle;\r\n    const t4 = thisArray[3] *  cosAngle + thisArray[7] * sinAngle;\r\n    const t5 = thisArray[0] * -sinAngle + thisArray[4] * cosAngle;\r\n    const t6 = thisArray[1] * -sinAngle + thisArray[5] * cosAngle;\r\n    const t7 = thisArray[2] * -sinAngle + thisArray[6] * cosAngle;\r\n    const t8 = thisArray[3] * -sinAngle + thisArray[7] * cosAngle;\r\n    \r\n    thisArray[0] = t1;\r\n    thisArray[1] = t2;\r\n    thisArray[2] = t3;\r\n    thisArray[3] = t4;\r\n    thisArray[4] = t5;\r\n    thisArray[5] = t6;\r\n    thisArray[6] = t7;\r\n    thisArray[7] = t8;\r\n\r\n    return this;\r\n  }\r\n\r\n  static rotation(matrix: Matrix3): Matrix4Base {\r\n    return new Matrix4Base().rotation(matrix);\r\n  }\r\n\r\n  rotation(matrix: Matrix3): this {\r\n    const thisArray = this.array;\r\n    const matArray = matrix.array;\r\n\r\n    thisArray[ 0] = matArray[0];\r\n    thisArray[ 1] = matArray[1];\r\n    thisArray[ 2] = matArray[2];\r\n    thisArray[ 4] = matArray[3];\r\n    thisArray[ 5] = matArray[4];\r\n    thisArray[ 6] = matArray[5];\r\n    thisArray[ 8] = matArray[6];\r\n    thisArray[ 9] = matArray[7];\r\n    thisArray[10] = matArray[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  rotate(axis: Vector3, angle: number): this {\r\n    const thisArray = this.array;\r\n    const axisArray = axis.array;\r\n    const axisLength = axis.length();\r\n    const x = axisArray[0] / axisLength;\r\n    const y = axisArray[1] / axisLength;\r\n    const z = axisArray[2] / axisLength;\r\n    const c = Math.cos(angle);\r\n    const s = Math.sin(angle);\r\n    const C = 1.0 - c;\r\n    const m11 = x * x * C + c;\r\n    const m12 = x * y * C - z * s;\r\n    const m13 = x * z * C + y * s;\r\n    const m21 = y * x * C + z * s;\r\n    const m22 = y * y * C + c;\r\n    const m23 = y * z * C - x * s;\r\n    const m31 = z * x * C - y * s;\r\n    const m32 = z * y * C + x * s;\r\n    const m33 = z * z * C + c;\r\n    const t1  = thisArray[0] * m11 + thisArray[4] * m21 + thisArray[8] * m31;\r\n    const t2  = thisArray[1] * m11 + thisArray[5] * m21 + thisArray[9] * m31;\r\n    const t3  = thisArray[2] * m11 + thisArray[6] * m21 + thisArray[10] * m31;\r\n    const t4  = thisArray[3] * m11 + thisArray[7] * m21 + thisArray[11] * m31;\r\n    const t5  = thisArray[0] * m12 + thisArray[4] * m22 + thisArray[8] * m32;\r\n    const t6  = thisArray[1] * m12 + thisArray[5] * m22 + thisArray[9] * m32;\r\n    const t7  = thisArray[2] * m12 + thisArray[6] * m22 + thisArray[10] * m32;\r\n    const t8  = thisArray[3] * m12 + thisArray[7] * m22 + thisArray[11] * m32;\r\n    const t9  = thisArray[0] * m13 + thisArray[4] * m23 + thisArray[8] * m33;\r\n    const t10 = thisArray[1] * m13 + thisArray[5] * m23 + thisArray[9] * m33;\r\n    const t11 = thisArray[2] * m13 + thisArray[6] * m23 + thisArray[10] * m33;\r\n    const t12 = thisArray[3] * m13 + thisArray[7] * m23 + thisArray[11] * m33;\r\n    thisArray[ 0] = t1;\r\n    thisArray[ 1] = t2;\r\n    thisArray[ 2] = t3;\r\n    thisArray[ 3] = t4;\r\n    thisArray[ 4] = t5;\r\n    thisArray[ 5] = t6;\r\n    thisArray[ 6] = t7;\r\n    thisArray[ 7] = t8;\r\n    thisArray[ 8] = t9;\r\n    thisArray[ 9] = t10;\r\n    thisArray[10] = t11;\r\n    thisArray[11] = t12;\r\n\r\n    return this;\r\n  }\r\n\r\n  static scaling(vec: Vector3): Matrix4Base {\r\n    return new Matrix4Base().setScaling(vec);\r\n  }\r\n\r\n  setScaling(vec: Vector3): this {\r\n    const thisArray = this.array;\r\n    const vecArray = vec.array;\r\n    const sx = vecArray[0];\r\n    const sy = vecArray[1];\r\n    const sz = vecArray[2];\r\n    const sw = 1;\r\n\r\n    thisArray[ 0] = sx;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = sy;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = sz;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = sw;\r\n\r\n    return this;\r\n  }\r\n\r\n  scale(vec: Vector3): this {\r\n    const thisArray = this.array;\r\n    const vecArray = vec.array;\r\n    const sx = vecArray[0];\r\n    const sy = vecArray[1];\r\n    const sz = vecArray[2];\r\n    const sw = 1;\r\n\r\n    thisArray[ 0] *= sx;\r\n    thisArray[ 1] *= sx;\r\n    thisArray[ 2] *= sx;\r\n    thisArray[ 3] *= sx;\r\n    thisArray[ 4] *= sy;\r\n    thisArray[ 5] *= sy;\r\n    thisArray[ 6] *= sy;\r\n    thisArray[ 7] *= sy;\r\n    thisArray[ 8] *= sz;\r\n    thisArray[ 9] *= sz;\r\n    thisArray[10] *= sz;\r\n    thisArray[11] *= sz;\r\n    thisArray[12] *= sw;\r\n    thisArray[13] *= sw;\r\n    thisArray[14] *= sw;\r\n    thisArray[15] *= sw;\r\n\r\n    return this;\r\n  }\r\n\r\n  static lookAt(eye: Vector3, target: Vector3, up: Vector3, out: Matrix4): Matrix4 {\r\n    const eyeArray = eye.array;\r\n    const upArray = up.array;\r\n    const targetArray = target.array;\r\n    const outArray = out.array;\r\n    const e0 = eyeArray[0];\r\n    const e1 = eyeArray[1];\r\n    const e2 = eyeArray[2];\r\n    const u0 = upArray[0];\r\n    const u1 = upArray[1];\r\n    const u2 = upArray[2];\r\n    const t0 = targetArray[0];\r\n    const t1 = targetArray[1];\r\n    const t2 = targetArray[2];\r\n    let x0, x1, x2, y0, y1, y2, z0, z1, z2, length;\r\n\r\n    z0 = e0 - t0;\r\n    z1 = e1 - t1;\r\n    z2 = e2 - t2;\r\n    length = Math.hypot(z0, z1, z2);\r\n    if (length > 0) {\r\n      length = 1 / Math.hypot(z0, z1, z2);\r\n      z0 *= length;\r\n      z1 *= length;\r\n      z2 *= length;\r\n    }\r\n  \r\n    x0 = u1 * z2 - u2 * z1;\r\n    x1 = u2 * z0 - u0 * z2;\r\n    x2 = u0 * z1 - u1 * z0;\r\n    length = Math.hypot(x0, x1, x2);\r\n    if (length > 0) {\r\n      length = 1 / length;\r\n      x0 *= length;\r\n      x1 *= length;\r\n      x2 *= length;\r\n    }\r\n\r\n    y0 = z1 * x2 - z2 * x1;\r\n    y1 = z2 * x0 - z0 * x2;\r\n    y2 = z0 * x1 - z1 * x0;\r\n    length = Math.hypot(y0, y1, y2);\r\n    if (length > 0) {\r\n      length = 1 / length;\r\n      y0 *= length;\r\n      y1 *= length;\r\n      y2 *= length;\r\n    }\r\n  \r\n    outArray[ 0] = x0;\r\n    outArray[ 1] = x1;\r\n    outArray[ 2] = x2;\r\n    outArray[ 3] = 0;\r\n    outArray[ 4] = y0;\r\n    outArray[ 5] = y1;\r\n    outArray[ 6] = y2;\r\n    outArray[ 7] = 0;\r\n    outArray[ 8] = z0;\r\n    outArray[ 9] = z1;\r\n    outArray[10] = z2;\r\n    outArray[11] = 0;\r\n    outArray[12] = e0;\r\n    outArray[13] = e1;\r\n    outArray[14] = e2;\r\n    outArray[15] = 1;\r\n  \r\n    return out;\r\n  }\r\n\r\n  lookAt(eye: Vector3, target: Vector3, up: Vector3): this {\r\n    return Matrix4Base.lookAt(eye, target, up, this) as this;\r\n  }\r\n\r\n  transformPoint(point: Vector3): Vector3 {\r\n    const thisArray = this.array;\r\n    const pointArray = point.array;\r\n\r\n    const x = pointArray[0];\r\n    const y = pointArray[1];\r\n    const z = pointArray[2];\r\n\r\n    const d = x * thisArray[3] + y * thisArray[7] + z * thisArray[11] + thisArray[15];\r\n\r\n    point.setValues(\r\n      (x * thisArray[0] + y * thisArray[4] + z * thisArray[ 8] + thisArray[12]) / d,\r\n      (x * thisArray[1] + y * thisArray[5] + z * thisArray[ 9] + thisArray[13]) / d,\r\n      (x * thisArray[2] + y * thisArray[6] + z * thisArray[10] + thisArray[14]) / d\r\n    );\r\n\r\n    return point;\r\n  }\r\n\r\n  transformPoint4(point: Vector4): Vector4 {\r\n    const thisArray = this.array;\r\n    const pointArray = point.array;\r\n\r\n    const x = pointArray[0];\r\n    const y = pointArray[1];\r\n    const z = pointArray[2];\r\n    const w = pointArray[3];\r\n\r\n    const d = x * thisArray[3] + y * thisArray[7] + z * thisArray[11] + w * thisArray[15];\r\n\r\n    point.setValues(\r\n      (x * thisArray[0] + y * thisArray[4] + z * thisArray[ 8] + thisArray[12]) / d,\r\n      (x * thisArray[1] + y * thisArray[5] + z * thisArray[ 9] + thisArray[13]) / d,\r\n      (x * thisArray[2] + y * thisArray[6] + z * thisArray[10] + thisArray[14]) / d,\r\n      (x * thisArray[3] + y * thisArray[7] + z * thisArray[11] + thisArray[15]) / d\r\n    );\r\n\r\n    return point;\r\n  }\r\n\r\n  transformDirection(direction: Vector3): Vector3 {\r\n    const thisArray = this.array;\r\n    const directionArray = direction.array;\r\n\r\n    const x = directionArray[0];\r\n    const y = directionArray[1];\r\n    const z = directionArray[2];\r\n\r\n    direction.setValues(\r\n      x * thisArray[0] + y * thisArray[4] + z * thisArray[ 8],\r\n      x * thisArray[1] + y * thisArray[5] + z * thisArray[ 9],\r\n      x * thisArray[2] + y * thisArray[6] + z * thisArray[10]\r\n    );\r\n\r\n    return direction;\r\n  }\r\n\r\n  transformNormal(normal: Vector3): Vector3 {\r\n    const normalArray = normal.array;\r\n\r\n    const thisInvArray = this.invert().array;\r\n\r\n    const x = normalArray[0];\r\n    const y = normalArray[1];\r\n    const z = normalArray[2];\r\n\r\n    normal.setValues(\r\n      x * thisInvArray[0] + y * thisInvArray[4] + z * thisInvArray[ 8],\r\n      x * thisInvArray[1] + y * thisInvArray[5] + z * thisInvArray[ 9],\r\n      x * thisInvArray[2] + y * thisInvArray[6] + z * thisInvArray[10]\r\n    );\r\n\r\n    this.invert();\r\n\r\n    return normal;\r\n  }\r\n\r\n  static perspective(fov: number, aspect: number, zNear: number, zFar: number): Matrix4Base {\r\n    return new Matrix4Base().setPerspective(fov, aspect, zNear, zFar);\r\n  }\r\n\r\n  setPerspective(fov: number, aspect: number, zNear: number, zFar: number): this {\r\n    const thisArray = this.array;\r\n    const width = Math.tan(Math.PI * 0.5 - 0.5 * fov);\r\n    const height = width / aspect;\r\n    const rangeInv = 1 / (zNear - zFar);\r\n\r\n    thisArray[ 0] = height;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = width;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = (zNear + zFar) * rangeInv;\r\n    thisArray[11] = -1;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = (2 * zNear * zFar) * rangeInv;\r\n    thisArray[15] = 0;\r\n    \r\n    return this;\r\n  }\r\n\r\n  static orthographic(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4Base {\r\n    return new Matrix4Base().setOrthographic(left, right, bottom, top, near, far);\r\n  }\r\n\r\n  setOrthographic(left: number, right: number, bottom: number, top: number, near: number, far: number): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = 2 / (right - left);\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 2 / (top - bottom);\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 2 / (near - far);\r\n    thisArray[11] = 0;\r\n    thisArray[12] = (right + left) / (left - right);\r\n    thisArray[13] = (top + bottom) / (bottom - top);\r\n    thisArray[14] = (far + near) / (near - far);\r\n    thisArray[15] = 1;\r\n    \r\n    return this;\r\n  }\r\n\r\n  static frustum(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4Base {\r\n    return new Matrix4Base().setFrustum(left, right, bottom, top, near, far);\r\n  }\r\n\r\n  setFrustum(left: number, right: number, bottom: number, top: number, near: number, far: number): this {\r\n    const thisArray = this.array;\r\n    const invWidth = 1 / (right - left);\r\n    const invHeight = 1 / (top - bottom);\r\n    const invDepth = 1 / (near - far);\r\n\r\n    thisArray[ 0] = near * 2 * invWidth;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = near * 2 * invHeight;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = (right + left) * invWidth;\r\n    thisArray [9] = (top + bottom) * invHeight;\r\n    thisArray[10] = (far + near) * invDepth;\r\n    thisArray[11] = -1;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = far * near * 2 * invDepth;\r\n    thisArray[15] = 0;\r\n    \r\n    return this;\r\n  }\r\n}\r\n\r\nvar Matrix4: Matrix4Constructor = Matrix4Base;\r\n\r\nconst Matrix4Injector: Injector<Matrix4Constructor> = new Injector({\r\n\tdefaultCtor: Matrix4Base,\r\n\tonDefaultOverride:\r\n\t\t(ctor: Matrix4Constructor) => {\r\n\t\t\tMatrix4 = ctor;\r\n\t\t}\r\n});","import { StackPool } from \"../../../patterns/pools/StackPool\";\r\nimport { Matrix4 } from \"../../algebra/matrices/Matrix4\";\r\nimport { Vector3, Vector3Constructor } from \"../../algebra/vectors/Vector3\";\r\n\r\nexport { Vector3Pool };\r\n\r\nclass Vector3PoolBase extends StackPool<Vector3> implements StackPool<Vector3> {\r\n    private _buffer: Float32Array;\r\n    private _bufferViews: Array<WritableArrayLike<number>>;\r\n    private _extensions: Array<WritableArrayLike<number>>;\r\n\r\n    constructor(ctor: Vector3Constructor, options?: any) {\r\n        super(ctor, options);\r\n        this._buffer = new Float32Array(0);\r\n        this._bufferViews = Array(options?.size || 0).fill(0).map(() => {\r\n            return this._buffer.subarray();\r\n        });\r\n        this._extensions = [];\r\n    }\r\n}\r\n\r\nconst Vector3Pool: StackPool<Vector3> = new Vector3PoolBase(Vector3);","export { UUID };\r\nexport { Identifiable };\r\nexport { UUIDGeneratorBase };\r\nexport { UUIDGenerator };\r\n\r\ntype UUID = string;\r\n\r\ninterface Identifiable {\r\n    readonly uuid: UUID;\r\n}\r\n\r\ninterface UUIDGenerator {\r\n    newUUID(): UUID;\r\n}\r\n\r\nclass UUIDGeneratorBase {\r\n\r\n    private _count: number;\r\n\r\n    constructor() {\r\n        this._count = 0\r\n    }\r\n\r\n    newUUID(): UUID {\r\n        return (++this._count).toString(16);\r\n    }\r\n}\r\n\r\nconst UUIDGenerator: UUIDGenerator = new UUIDGeneratorBase();","import { EulerAngles } from \"../../libs/maths/algebra/angles/EulerAngles\";\r\nimport { Matrix3 } from \"../../libs/maths/algebra/matrices/Matrix3\";\r\nimport { Matrix4 } from \"../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Quaternion, QuaternionPool } from \"../../libs/maths/algebra/quaternions/Quaternion\";\r\nimport { Vector3 } from \"../../libs/maths/algebra/vectors/Vector3\";\r\nimport { Vector3Pool } from \"../../libs/maths/extensions/pools/Vector3Pools\";\r\nimport { UUID, UUIDGenerator } from \"../../libs/maths/statistics/random/UUIDGenerator\";\r\nimport { Object3D } from \"../rendering/scenes/objects/Object3D\";\r\n\r\nexport { Transform };\r\nexport { TransformBase };\r\n\r\ninterface TransformConstructor {\r\n    readonly prototype: Transform;\r\n    new(): Transform;\r\n    new(owner: Object3D): Transform;\r\n}\r\n\r\nconst tempMatrix = new Matrix4();\r\n\r\ninterface Transform {\r\n    hasChanged: boolean;\r\n\r\n    readonly localArray: Float32Array;\r\n    readonly array: Float32Array;\r\n    readonly uuid: UUID;\r\n    readonly owner: Object3D | null;\r\n\r\n    localMatrix: Matrix4;\r\n    matrix: Matrix4;\r\n\r\n    getMatrix(matrix: Matrix4): Matrix4;\r\n    setMatrix(matrix: Matrix4): this;\r\n    getLocalMatrix(matrix: Matrix4): Matrix4;\r\n    setLocalMatrix(matrix: Matrix4): this;\r\n\r\n    getRight(vector: Vector3): Vector3;\r\n    getLeft(vector: Vector3): Vector3;\r\n    getUp(vector: Vector3): Vector3;\r\n    getDown(vector: Vector3): Vector3;\r\n    getForward(vector: Vector3): Vector3;\r\n    getBackward(vector: Vector3): Vector3;\r\n\r\n    getTranslation(vector: Vector3): Vector3;\r\n    setTranslation(vector: Vector3): this;\r\n    translate(vector: Vector3): this;\r\n\r\n    getRotation(rotation: Quaternion): Quaternion;\r\n    setRotation(rotation: Quaternion): this;\r\n    rotate(rotation: Quaternion): this;\r\n\r\n    getScaling(scaling: Vector3): Vector3;\r\n    setScaling(scaling: Vector3): this;\r\n    scale(scaling: Vector3): this;\r\n    \r\n    lookAt(target: Vector3, up: Vector3): this;\r\n}\r\n\r\nclass TransformBase implements Transform {\r\n    readonly localArray: Float32Array;\r\n    readonly array: Float32Array;\r\n    readonly uuid: UUID;\r\n    readonly owner: Object3D | null;\r\n\r\n    readonly matrix: Matrix4;\r\n    readonly localMatrix: Matrix4;;\r\n\r\n    hasChanged: boolean;\r\n    readonly isStatic: boolean;\r\n\r\n    constructor(owner?: Object3D, isStatic?: boolean) {\r\n        this.uuid = UUIDGenerator.newUUID();\r\n        this.owner = owner || null;\r\n\r\n        this.isStatic = isStatic ?? false;\r\n        \r\n        this.array = new Float32Array(16);\r\n        this.localArray = new Float32Array(16);\r\n\r\n        this.matrix = new Matrix4(this.array).setIdentity();\r\n        this.localMatrix = new Matrix4(this.localArray).setIdentity();\r\n\r\n        this.hasChanged = false;\r\n    }\r\n\r\n    getMatrix(matrix: Matrix4): Matrix4 {\r\n        const thisArray = this.array;\r\n        const matrixArray = matrix.array;\r\n        matrixArray[ 0] = thisArray[ 0];\r\n        matrixArray[ 1] = thisArray[ 1];\r\n        matrixArray[ 2] = thisArray[ 2];\r\n        matrixArray[ 3] = thisArray[ 3];\r\n        matrixArray[ 4] = thisArray[ 4];\r\n        matrixArray[ 5] = thisArray[ 5];\r\n        matrixArray[ 6] = thisArray[ 6];\r\n        matrixArray[ 7] = thisArray[ 7];\r\n        matrixArray[ 8] = thisArray[ 8];\r\n        matrixArray[ 9] = thisArray[ 9];\r\n        matrixArray[10] = thisArray[10];\r\n        matrixArray[11] = thisArray[11];\r\n        matrixArray[12] = thisArray[12];\r\n        matrixArray[13] = thisArray[13];\r\n        matrixArray[14] = thisArray[14];\r\n        matrixArray[15] = thisArray[15];\r\n\r\n        return matrix;\r\n    }\r\n\r\n    setMatrix(matrix: Matrix4): this {\r\n        const thisArray = this.array;\r\n        const matrixArray = matrix.array;\r\n        thisArray[ 0] = matrixArray[ 0];\r\n        thisArray[ 1] = matrixArray[ 1];\r\n        thisArray[ 2] = matrixArray[ 2];\r\n        thisArray[ 3] = matrixArray[ 3];\r\n        thisArray[ 4] = matrixArray[ 4];\r\n        thisArray[ 5] = matrixArray[ 5];\r\n        thisArray[ 6] = matrixArray[ 6];\r\n        thisArray[ 7] = matrixArray[ 7];\r\n        thisArray[ 8] = matrixArray[ 8];\r\n        thisArray[ 9] = matrixArray[ 9];\r\n        thisArray[10] = matrixArray[10];\r\n        thisArray[11] = matrixArray[11];\r\n        thisArray[12] = matrixArray[12];\r\n        thisArray[13] = matrixArray[13];\r\n        thisArray[14] = matrixArray[14];\r\n        thisArray[15] = matrixArray[15];\r\n\r\n        return this;\r\n    }\r\n\r\n    getLocalMatrix(matrix: Matrix4): Matrix4 {\r\n        const thisLocalArray = this.localArray;\r\n        const matrixArray = matrix.array;\r\n        matrixArray[ 0] = thisLocalArray[ 0];\r\n        matrixArray[ 1] = thisLocalArray[ 1];\r\n        matrixArray[ 2] = thisLocalArray[ 2];\r\n        matrixArray[ 3] = thisLocalArray[ 3];\r\n        matrixArray[ 4] = thisLocalArray[ 4];\r\n        matrixArray[ 5] = thisLocalArray[ 5];\r\n        matrixArray[ 6] = thisLocalArray[ 6];\r\n        matrixArray[ 7] = thisLocalArray[ 7];\r\n        matrixArray[ 8] = thisLocalArray[ 8];\r\n        matrixArray[ 9] = thisLocalArray[ 9];\r\n        matrixArray[10] = thisLocalArray[10];\r\n        matrixArray[11] = thisLocalArray[11];\r\n        matrixArray[12] = thisLocalArray[12];\r\n        matrixArray[13] = thisLocalArray[13];\r\n        matrixArray[14] = thisLocalArray[14];\r\n        matrixArray[15] = thisLocalArray[15];\r\n\r\n        return matrix;\r\n    }\r\n\r\n    setLocalMatrix(matrix: Matrix4): this {\r\n        const thisLocalArray = this.localArray;\r\n        const matrixArray = matrix.array;\r\n        thisLocalArray[ 0] = matrixArray[ 0];\r\n        thisLocalArray[ 1] = matrixArray[ 1];\r\n        thisLocalArray[ 2] = matrixArray[ 2];\r\n        thisLocalArray[ 3] = matrixArray[ 3];\r\n        thisLocalArray[ 4] = matrixArray[ 4];\r\n        thisLocalArray[ 5] = matrixArray[ 5];\r\n        thisLocalArray[ 6] = matrixArray[ 6];\r\n        thisLocalArray[ 7] = matrixArray[ 7];\r\n        thisLocalArray[ 8] = matrixArray[ 8];\r\n        thisLocalArray[ 9] = matrixArray[ 9];\r\n        thisLocalArray[10] = matrixArray[10];\r\n        thisLocalArray[11] = matrixArray[11];\r\n        thisLocalArray[12] = matrixArray[12];\r\n        thisLocalArray[13] = matrixArray[13];\r\n        thisLocalArray[14] = matrixArray[14];\r\n        thisLocalArray[15] = matrixArray[15];\r\n\r\n        return this;\r\n    }\r\n\r\n    getRight(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[0];\r\n        vectorArray[1] = thisArray[1];\r\n        vectorArray[2] = thisArray[2];\r\n        return vector;\r\n    }\r\n\r\n    getLeft(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = -thisArray[0];\r\n        vectorArray[1] = -thisArray[1];\r\n        vectorArray[2] = -thisArray[2];\r\n        return vector;\r\n    }\r\n\r\n    getUp(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[4];\r\n        vectorArray[1] = thisArray[5];\r\n        vectorArray[2] = thisArray[6];\r\n        return vector;\r\n    }\r\n\r\n    getDown(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = -thisArray[4];\r\n        vectorArray[1] = -thisArray[5];\r\n        vectorArray[2] = -thisArray[6];\r\n        return vector;\r\n    }\r\n\r\n    getForward(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[ 8];\r\n        vectorArray[1] = thisArray[ 9];\r\n        vectorArray[2] = thisArray[10];\r\n        return vector;\r\n    }\r\n\r\n    getBackward(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = -thisArray[ 8];\r\n        vectorArray[1] = -thisArray[ 9];\r\n        vectorArray[2] = -thisArray[10];\r\n        return vector;\r\n    }\r\n\r\n    getTranslation(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[12];\r\n        vectorArray[1] = thisArray[13];\r\n        vectorArray[2] = thisArray[14];\r\n        return vector;\r\n    }\r\n\r\n    setTranslation(vector: Vector3): this {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        thisArray[12] = vectorArray[0];\r\n        thisArray[13] = vectorArray[1];\r\n        thisArray[14] = vectorArray[2];\r\n        return this;\r\n    }\r\n\r\n    translate(vector: Vector3): this {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        thisArray[12] += vectorArray[0];\r\n        thisArray[13] += vectorArray[1];\r\n        thisArray[14] += vectorArray[2];\r\n        return this;\r\n    }\r\n\r\n    getScaling(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[ 0];\r\n        vectorArray[1] = thisArray[ 5];\r\n        vectorArray[2] = thisArray[10];\r\n        return vector;\r\n    }\r\n\r\n    setScaling(vector: Vector3): this {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        thisArray[ 0] = vectorArray[0];\r\n        thisArray[ 5] = vectorArray[1];\r\n        thisArray[10] = vectorArray[2];\r\n        return this;\r\n    }\r\n\r\n    scale(vector: Vector3): this {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        thisArray[ 0] *= vectorArray[0];\r\n        thisArray[ 5] *= vectorArray[1];\r\n        thisArray[10] *= vectorArray[2];\r\n        return this;\r\n    }\r\n\r\n    getRotation(rotation: Quaternion): Quaternion {\r\n        rotation.setMatrix(this.matrix);\r\n        return rotation;\r\n    }\r\n    \r\n    setRotation(rotation: Quaternion): this {\r\n        this.matrix.setRotation(rotation);\r\n        return this;\r\n    }\r\n\r\n    rotate(rotation: Quaternion): this {\r\n        this.matrix.mult(\r\n            rotation.getMatrix4(tempMatrix)\r\n        );\r\n        return this;\r\n    }\r\n\r\n    transformPoint(point: Vector3): Vector3 {\r\n        return point;\r\n    }\r\n\r\n    transformDirection(direction: Vector3): Vector3 {\r\n        return direction;\r\n    }\r\n\r\n    transformVector(vector: Vector3): Vector3 {\r\n        return vector;\r\n    }\r\n\r\n    lookAt(target: Vector3, up: Vector3): this {\r\n        const thisPosition = this.getTranslation(Vector3Pool.acquire(1)[0]);\r\n        this.matrix.lookAt(thisPosition, target, up);\r\n        Vector3Pool.release(1);\r\n        return this;\r\n    }\r\n}\r\n\r\nconst Transform: TransformConstructor = TransformBase;","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { Vector3 } from \"../../algebra/vectors/Vector3\";\r\nimport { Vector3Pool } from \"../../extensions/pools/Vector3Pools\";\r\n\r\nexport { Plane };\r\nexport { PlaneInjector };\r\nexport { PlaneBase };\r\n\r\ninterface Plane {\r\n    readonly normal: Vector3;\r\n    constant: number;\r\n    copy(plane: Plane): Plane;\r\n    set(x: number, y: number, z: number, constant: number): Plane;\r\n    setFromNormalAndConstant(normal: Vector3, constant: number): Plane;\r\n\tsetFromNormalAndCoplanarPoint(normal: Vector3, point: Vector3): Plane;\r\n\tsetFromCoplanarPoints(point1: Vector3, point2: Vector3, point3: Vector3): Plane;\r\n\tdistanceToPoint(point: Vector3): number;\r\n    normalized(): Plane;\r\n}\r\n\r\ninterface PlaneConstructor {\r\n    readonly prototype: Plane;\r\n    new(): Plane;\r\n    new(normal: Vector3, constant: number): Plane;\r\n    new(normal?: Vector3, constant?: number): Plane;\r\n    fromNormalAndConstant(normal: Vector3, constant: number): Plane;\r\n    fromNormalAndCoplanarPoint(normal: Vector3, point: Vector3): Plane;\r\n    fromCoplanarPoints(a: Vector3, b: Vector3, c: Vector3): Plane;\r\n    intersection(a: Plane, b: Plane, c: Plane, result: Vector3): Vector3;\r\n}\r\n\r\nclass PlaneBase implements Plane {\r\n\r\n    readonly normal: Vector3;\r\n    constant: number;\r\n\r\n    constructor()\r\n    constructor(normal: Vector3, constant: number)\r\n    constructor(normal?: Vector3, constant?: number) {\r\n        this.normal = normal ?? new Vector3();\r\n        this.constant = constant ?? 0;\r\n    }\r\n\r\n    static fromNormalAndConstant(normal: Vector3, constant: number): Plane {\r\n        return new PlaneBase().setFromNormalAndConstant(normal, constant);\r\n    }\r\n\r\n\tstatic fromNormalAndCoplanarPoint(normal: Vector3, point: Vector3): Plane {\r\n\t\treturn new PlaneBase().setFromNormalAndCoplanarPoint(normal, point);\r\n\t}\r\n\r\n\tstatic fromCoplanarPoints(a: Vector3, b: Vector3, c: Vector3): Plane {\r\n        return new PlaneBase().setFromCoplanarPoints(a, b, c);\r\n    }\r\n\r\n    copy(plane: PlaneBase): PlaneBase {\r\n        this.normal.copy(plane.normal);\r\n        this.constant = plane.constant;\r\n        return this;\r\n    }\r\n\r\n    set(x: number, y: number, z: number, constant: number): PlaneBase {\r\n        this.normal.setValues(x, y, z);\r\n        this.constant = constant;\r\n\r\n        return this;\r\n    }\r\n\r\n    setFromNormalAndConstant(normal: Vector3, constant: number): PlaneBase {\r\n        this.normal.copy(normal);\r\n        this.constant = constant;\r\n\r\n        return this;\r\n    }\r\n\r\n\tsetFromNormalAndCoplanarPoint(normal: Vector3, point: Vector3): PlaneBase {\r\n\t\tthis.normal.copy(normal);\r\n        this.constant = -point.dot(this.normal);\r\n        \r\n        return this;\r\n\t}\r\n\r\n\tsetFromCoplanarPoints(point1: Vector3, point2: Vector3, point3: Vector3): PlaneBase {\r\n        const normal = point3.clone();\r\n        const [temp] = Vector3Pool.acquire(1);\r\n        temp.copy(point1);\r\n        normal.sub(point2).cross(temp.sub(point2)).normalize();\r\n        this.setFromNormalAndCoplanarPoint(normal, point1);\r\n        Vector3Pool.release(1);\r\n\t\treturn this;\r\n    }\r\n\r\n\tdistanceToPoint(point: Vector3): number {\r\n\t\treturn this.normal.dot(point) + this.constant;\r\n\t}\r\n    \r\n    normalized(): PlaneBase {\r\n        const inverseNormalLength = 1.0 / this.normal.length();\r\n        this.normal.scale(inverseNormalLength);\r\n\t\tthis.constant *= inverseNormalLength;\r\n\t\treturn this;\r\n\t}\r\n\r\n    static intersection(a: Plane, b: Plane, c: Plane, result: Vector3): Vector3 {\r\n        const {normal: aNormal, constant: aConstant} = a;\r\n        const {normal: bNormal, constant: bConstant} = b;\r\n        const {normal: cNormal, constant: cConstant} = c;\r\n        result.copy(bNormal).cross(cNormal);\r\n        const f = -aNormal.dot(result);\r\n        const [v1x, v1y, v1z] = result.scale(aConstant).array;\r\n        result.copy(cNormal).cross(aNormal);\r\n        const [v2x, v2y, v2z] = result.scale(bConstant).array;\r\n        result.copy(aNormal).cross(bNormal);\r\n        const [v3x, v3y, v3z] = result.scale(cConstant).array;\r\n        result.setValues(\r\n          (v1x + v2x + v3x) / f,\r\n          (v1y + v2y + v3y) / f,\r\n          (v1z + v2z + v3z) / f\r\n        );\r\n        return result;\r\n    }\r\n}\r\n\r\nvar Plane: PlaneConstructor = PlaneBase;\r\nconst PlaneInjector: Injector<PlaneConstructor> = new Injector({\r\n\tdefaultCtor: PlaneBase,\r\n\tonDefaultOverride:\r\n\t\t(ctor: PlaneConstructor) => {\r\n\t\t\tPlane = ctor;\r\n\t\t}\r\n});","import { BoundingBox } from \"../../../core/rendering/scenes/geometries/bounding/BoundingBox\";\r\nimport { Matrix4 } from \"../../maths/algebra/matrices/Matrix4\";\r\nimport { Vector3 } from \"../../maths/algebra/vectors/Vector3\";\r\nimport { Plane } from \"../../maths/geometry/primitives/Plane\";\r\nimport { BoundingSphere } from \"./BoundingSphere\";\r\n\r\nexport { Frustum };\r\n\r\nconst tempVector = new Vector3();\r\n\r\ninterface Frustum {\r\n    readonly nearPlane: Plane;\r\n    readonly farPlane: Plane;\r\n    readonly topPlane: Plane;\r\n    readonly bottomPlane: Plane;\r\n    readonly leftPlane: Plane;\r\n    readonly rightPlane: Plane;\r\n    readonly extents: Vector3[];\r\n    copy(Frustum: Frustum): Frustum;\r\n\tclone(): Frustum;\r\n\tsetFromMatrix(matrix: Matrix4): Frustum;\r\n\tset(\r\n        nearPlane: Plane, farPlane: Plane,\r\n        topPlane: Plane, bottomPlane: Plane,\r\n        leftPlane: Plane, rightPlane: Plane\r\n    ): Frustum;\r\n\tintersectsSphere(sphere: BoundingSphere): boolean;\r\n\tintersectsBox(box: BoundingBox): boolean;\r\n\tcontainsPoint(point: Vector3): boolean;\r\n    getEdges(edges: Vector3[]): Vector3[];\r\n    getExtents(extents: Vector3[]): Vector3[];\r\n}\r\n\r\ninterface FrustumConstructor {\r\n    readonly prototype: Frustum;\r\n    new(): Frustum;\r\n}\r\n\r\nclass FrustumBase implements Frustum {\r\n    readonly nearPlane: Plane;\r\n    readonly farPlane: Plane;\r\n    readonly topPlane: Plane;\r\n    readonly bottomPlane: Plane;\r\n    readonly leftPlane: Plane;\r\n    readonly rightPlane: Plane;\r\n    readonly extents: Vector3[];\r\n\r\n    constructor() {\r\n\t\tthis.nearPlane = new Plane();\r\n        this.farPlane = new Plane();\r\n        this.topPlane = new Plane();\r\n        this.bottomPlane = new Plane();\r\n        this.leftPlane = new Plane();\r\n        this.rightPlane = new Plane();\r\n        this.extents = new Array(8).fill(0).map(_ => new Vector3());\r\n    }\r\n\r\n    set(\r\n        nearPlane: Plane, farPlane: Plane,\r\n        topPlane: Plane, bottomPlane: Plane,\r\n        leftPlane: Plane, rightPlane: Plane): Frustum {\r\n        const {nearPlane: _nearPlane, farPlane: _farPlane, bottomPlane: _bottomPlane, topPlane: _topPlane, leftPlane: _leftPlane, rightPlane: _rightPlane} = this;\r\n\t\t_nearPlane.copy(nearPlane);\r\n\t\t_farPlane.copy(farPlane);\r\n        _topPlane.copy(topPlane);\r\n        _bottomPlane.copy(bottomPlane);\r\n        _leftPlane.copy(leftPlane);\r\n        _rightPlane.copy(rightPlane);\r\n\t\treturn this;\r\n\t}\r\n\r\n    copy(Frustum: FrustumBase): Frustum {\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane} = Frustum;\r\n        this.set(\r\n            nearPlane,\r\n            farPlane,\r\n            topPlane,\r\n            bottomPlane,\r\n            leftPlane,\r\n            rightPlane\r\n        );\r\n        return this;\r\n    }\r\n\r\n\tclone(): Frustum {\r\n\t\treturn new FrustumBase().copy(this);\r\n    }\r\n    \r\n\tsetFromMatrix(matrix: Matrix4): Frustum {\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane, extents} = this;\r\n        const [m0, m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, m13, m14, m15] = matrix.array;\r\n        rightPlane.set(m3 - m0, m7 - m4, m11 - m8, m15 - m12).normalized();\r\n        leftPlane.set(m3 + m0, m7 + m4, m11 + m8, m15 + m12).normalized();\r\n        bottomPlane.set(m3 + m1, m7 + m5, m11 + m9, m15 + m13).normalized();\r\n        topPlane.set(m3 - m1, m7 - m5, m11 - m9, m15 - m13).normalized();\r\n        farPlane.set(m3 - m2, m7 - m6, m11 - m10, m15 - m14).normalized();\r\n        nearPlane.set(m3 + m2, m7 + m6, m11 + m10, m15 + m14).normalized();\r\n\r\n        Plane.intersection(leftPlane, bottomPlane, nearPlane, extents[0]);\r\n        Plane.intersection(leftPlane, topPlane, nearPlane, extents[1]);\r\n        Plane.intersection(rightPlane, bottomPlane, nearPlane, extents[2]);\r\n        Plane.intersection(rightPlane, topPlane, nearPlane, extents[3]);\r\n        Plane.intersection(leftPlane, bottomPlane, farPlane, extents[4]);\r\n        Plane.intersection(leftPlane, topPlane, farPlane, extents[5]);\r\n        Plane.intersection(rightPlane, bottomPlane, farPlane, extents[6]);\r\n        Plane.intersection(rightPlane, topPlane, farPlane, extents[7]);\r\n        \r\n\t\treturn this;\r\n    }\r\n    \r\n\tintersectsSphere(sphere: BoundingSphere): boolean {\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane} = this;\r\n        const {center, radius} = sphere;\r\n        return center.dot(nearPlane.normal) + nearPlane.constant + radius <= 0 ||\r\n            center.dot(farPlane.normal) + farPlane.constant + radius <= 0 ||\r\n            center.dot(bottomPlane.normal) + bottomPlane.constant + radius <= 0 ||\r\n            center.dot(topPlane.normal) + topPlane.constant + radius <= 0 ||\r\n            center.dot(leftPlane.normal) + leftPlane.constant + radius <= 0 ||\r\n            center.dot(rightPlane.normal) + rightPlane.constant + radius <= 0;\r\n\t}\r\n    \r\n\tintersectsBox(box: BoundingBox): boolean {\r\n        const {max: boxMax, min: boxMin} = box;\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane} = this;\r\n        let intersects = \r\n            nearPlane.distanceToPoint(tempVector.setValues(\r\n                nearPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                nearPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                nearPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            farPlane.distanceToPoint(tempVector.setValues(\r\n                farPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                farPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                farPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            bottomPlane.distanceToPoint(tempVector.setValues(\r\n                bottomPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                bottomPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                bottomPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            topPlane.distanceToPoint(tempVector.setValues(\r\n                topPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                topPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                topPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            leftPlane.distanceToPoint(tempVector.setValues(\r\n                leftPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                leftPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                leftPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            rightPlane.distanceToPoint(tempVector.setValues(\r\n                rightPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                rightPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                rightPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0;\r\n\t\treturn intersects;\r\n\t}\r\n\r\n    getEdges(edges: Vector3[]): Vector3[] {\r\n        const {extents} = this;\r\n        const leftBottomNear = extents[0];\r\n        const leftTopNear = extents[1];\r\n        const rightBottomNear = extents[2];\r\n        const rightTopNear = extents[3];\r\n        const leftBottomFar = extents[4];\r\n        const leftTopFar = extents[5];\r\n        const rightBottomFar = extents[6];\r\n        const rightTopFar = extents[7];\r\n        edges[0].copy(leftTopFar).sub(leftTopNear);\r\n        edges[1].copy(rightTopFar).sub(rightTopNear);\r\n        edges[2].copy(leftBottomFar).sub(leftBottomNear);\r\n        edges[3].copy(rightBottomFar).sub(rightBottomNear);\r\n        edges[4].copy(rightTopFar).sub(leftTopFar);\r\n        edges[5].copy(rightTopNear).sub(rightBottomNear);\r\n        return edges;\r\n    }\r\n\r\n    getExtents(extents: Vector3[]): Vector3[] {\r\n        const {extents: _extents} = this;\r\n        extents[0].copy(_extents[0]);\r\n        extents[1].copy(_extents[1]);\r\n        extents[2].copy(_extents[2]);\r\n        extents[3].copy(_extents[3]);\r\n        extents[4].copy(_extents[4]);\r\n        extents[5].copy(_extents[5]);\r\n        extents[6].copy(_extents[6]);\r\n        extents[7].copy(_extents[7]);\r\n        return extents;\r\n    }\r\n\r\n\tcontainsPoint(point: Vector3): boolean {\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane} = this;\r\n        return nearPlane.distanceToPoint(point) >= 0 &&\r\n            farPlane.distanceToPoint(point) >= 0 &&\r\n            bottomPlane.distanceToPoint(point) >= 0 &&\r\n            topPlane.distanceToPoint(point) >= 0 &&\r\n            leftPlane.distanceToPoint(point) >= 0 &&\r\n            rightPlane.distanceToPoint(point) >= 0;\r\n    }\r\n}\r\n\r\nvar Frustum: FrustumConstructor = FrustumBase;","import { Transform } from \"../../../general/Transform\";\r\n\r\nexport { Object3D };\r\nexport { Object3DBase };\r\n\r\ninterface Object3D {\r\n    transform: Transform;\r\n}\r\n\r\nclass Object3DBase implements Object3D {\r\n    readonly transform: Transform;\r\n\r\n    constructor() {\r\n        this.transform = new Transform(this);\r\n    }\r\n}","import { Matrix4 } from \"../../../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Vector3 } from \"../../../../libs/maths/algebra/vectors/Vector3\";\r\nimport { Space } from \"../../../../libs/maths/geometry/space/Space\";\r\nimport { UUID, UUIDGenerator } from \"../../../../libs/maths/statistics/random/UUIDGenerator\";\r\nimport { Frustum } from \"../../../../libs/physics/collisions/Frustum\";\r\nimport { Mesh } from \"../objects/meshes/Mesh\";\r\nimport { Object3D, Object3DBase } from \"../objects/Object3D\";\r\n\r\nexport { Camera };\r\n\r\ninterface CameraConstructor {\r\n  prototype: Camera;\r\n  new(): Camera;\r\n  new(projection: Matrix4): Camera;\r\n}\r\n\r\ninterface Camera extends Object3D {\r\n  readonly uuid: UUID;\r\n  readonly viewProjection: Matrix4;\r\n  readonly projection: Matrix4;\r\n  readonly view: Matrix4;\r\n  readonly frustum: Frustum;\r\n  isViewing(mesh: Mesh): boolean;\r\n  updateFrustum(): void;\r\n  getFront(vector: Vector3): Vector3;\r\n}\r\n\r\nclass CameraBase extends Object3DBase {\r\n    readonly uuid: UUID;\r\n    readonly projection: Matrix4;\r\n    readonly frustum: Frustum;\r\n  \r\n    constructor()\r\n    constructor(projection: Matrix4)\r\n    constructor(projection?: Matrix4) {\r\n      super();\r\n      this.uuid = UUIDGenerator.newUUID();\r\n      this.projection = projection || new Matrix4();\r\n      this.frustum = new Frustum().setFromMatrix(this.viewProjection);\r\n    }\r\n\r\n    getFront(vector: Vector3): Vector3 {\r\n      return this.transform.getBackward(vector);\r\n    }\r\n\r\n    get view(): Matrix4 {\r\n      return this.transform.matrix.clone().invert();\r\n    }\r\n\r\n    get viewProjection(): Matrix4 {\r\n      return this.projection.clone().mult(this.view);\r\n    }\r\n\r\n    isViewing(mesh: Mesh): boolean {\r\n      return true;\r\n    }\r\n\r\n    updateFrustum(): void {\r\n      this.frustum.setFromMatrix(this.viewProjection);\r\n    }\r\n}\r\n\r\nvar Camera: CameraConstructor = CameraBase;","export { Buffer };\r\n\r\nexport enum BufferDataUsage {\r\n    STATIC_DRAW = 0x88E4,\r\n    DYNAMIC_DRAW = 0x88E8,\r\n    STREAM_DRAW = 0x88E0,\r\n    STATIC_READ = 0x88E5,\r\n    DYNAMIC_READ = 0x88E9,\r\n    STREAM_READ = 0x88E1,\r\n    STATIC_COPY = 0x88E6,\r\n    DYNAMIC_COPY = 0x88EA,\r\n    STREAM_COPY = 0x88E2\r\n}\r\n\r\nexport enum BufferTarget {\r\n    ARRAY_BUFFER = 0x8892,\r\n    ELEMENT_ARRAY_BUFFER = 0x8893,\r\n    TRANSFORM_FEEDBACK_BUFFER = 0x8C8E,\r\n    UNIFORM_BUFFER = 0x8A11,\r\n}\r\n\r\ntype Buffer = {\r\n    internalBuffer: WebGLBuffer;\r\n    target: BufferTarget;\r\n    usage: BufferDataUsage;\r\n    byteLength: number;\r\n}","import { BufferDataUsage, Buffer } from \"./WebGLBufferUtilities\";\r\nimport { Program, WebGLProgramUtilities } from \"./WebGLProgramUtilities\";\r\n\r\nexport { VertexAttributeValue };\r\nexport { VertexAttributeProperties };\r\nexport { VertexArrayProperties };\r\nexport { VertexArrayValues };\r\nexport { VertexArray };\r\nexport { WebGLVertexArrayUtilities };\r\n\r\nexport enum DrawMode {\r\n    POINTS = 0x0000,\r\n    LINES = 0x0001,\r\n    LINE_LOOP = 0x0002,\r\n    LINE_STRIP = 0x0003,\r\n    TRIANGLES = 0x0004,\r\n    TRIANGLE_STRIP = 0x0005,\r\n    TRIANGLE_FAN = 0x0006\r\n}\r\n\r\nexport enum DataComponentType {\r\n    BYTE = 0x1400,\r\n    UNSIGNED_BYTE = 0x1401,\r\n    SHORT = 0x1402,\r\n    UNSIGNED_SHORT = 0x1403,\r\n    INT = 0x1404,\r\n    UNSIGNED_INT = 0x1405,\r\n    FLOAT = 0x1406\r\n}\r\n\r\nexport enum AttributeDataType {\r\n    VEC2 = \"VEC2\",\r\n    VEC3 = \"VEC3\",\r\n    VEC4 = \"VEC4\",\r\n}\r\n\r\nexport enum ElementArrayDataType {\r\n    UNSIGNED_BYTE = 0x1401,\r\n    UNSIGNED_SHORT = 0x1403,\r\n    UNSIGNED_INT = 0x1405\r\n}\r\n\r\nexport type AttributeArray =\r\n    Float32Array | Int32Array | Uint32Array |\r\n    Int16Array | Uint16Array |\r\n    Int8Array | Uint8Array;\r\n\r\ntype VertexAttributeProperties = {\r\n    type: AttributeDataType;\r\n    array?: AttributeArray;\r\n    componentType?: DataComponentType;\r\n    byteLength?: number;\r\n    buffer?: number;\r\n    divisor?: number;\r\n    normalize?: boolean;\r\n    constant?: boolean;\r\n    srcOffset?: number;\r\n    srcLength?: number;\r\n}\r\n\r\ntype VertexAttributeValue = {\r\n    array: AttributeArray;\r\n    srcOffset?: number;\r\n    srcLength?: number;\r\n    constant?: boolean;\r\n}\r\n\r\ntype VertexAttribute = {\r\n    divisor: number;\r\n    componentType: DataComponentType;\r\n    numComponents: number;\r\n    constant: boolean;\r\n    constantValue?: AttributeArray;\r\n    byteOffset: number;\r\n    bytesPerElement: number;\r\n    type: AttributeDataType;\r\n    normalize: boolean;\r\n}\r\n\r\ntype VertexArrayProperties = {\r\n    vertexBuffers?: (VertexArrayBuffer | VertexArrayBufferProperties)[];\r\n    vertexAttributes?: Record<string, VertexAttributeProperties>;\r\n    elementBuffer?: VertexElementArrayBuffer | VertexElementArrayBufferProperties;\r\n    elementIndices?: Uint8Array | Uint16Array | Uint32Array;\r\n}\r\n\r\ntype VertexArrayValues = {\r\n    attributes: Record<string, VertexAttributeValue>;\r\n    drawMode?: DrawMode;\r\n    elementsCount?: number;\r\n    instanceCount?: number;\r\n}\r\n\r\ntype VertexArray = {\r\n    internalVertexArray: WebGLVertexArrayObject;\r\n    program: Program;\r\n    verticesBuffers: VertexArrayBuffer[];\r\n    elementBuffer?: VertexElementArrayBuffer;\r\n}\r\n\r\nexport type VertexArrayBuffer = Buffer & {\r\n    vertexAttributes: Record<string, VertexAttribute>;\r\n    byteLength: number;\r\n    byteStride: number;\r\n    interleaved: boolean;\r\n}\r\n\r\nexport type VertexArrayBufferProperties = {\r\n    usage?: BufferDataUsage;\r\n    interleaved?: boolean;\r\n}\r\n\r\nexport type VertexElementArrayBuffer = Buffer & {\r\n    indexType: ElementArrayDataType;\r\n};\r\n\r\nexport type VertexElementArrayBufferProperties = {\r\n    usage?: BufferDataUsage;\r\n}\r\n\r\nexport type VertexArrayBufferLayout = Record<string, {\r\n    byteOffset: number;\r\n    bytesPerElement: number;\r\n}>;\r\n\r\nclass WebGLVertexArrayUtilities {\r\n\r\n    static getDataTypeNumComponents(type: AttributeDataType): number {\r\n        switch (type) {\r\n            case AttributeDataType.VEC2:\r\n                return 2;\r\n            case AttributeDataType.VEC3:\r\n                return 3;\r\n            case AttributeDataType.VEC4:\r\n                return 4;\r\n        }\r\n    }\r\n\r\n    static getComponentTypeArrayConstructor(type: DataComponentType):\r\n        Float32ArrayConstructor | Int32ArrayConstructor | Uint32ArrayConstructor |\r\n        Int16ArrayConstructor | Uint16ArrayConstructor |\r\n        Int8ArrayConstructor | Uint8ArrayConstructor {\r\n        switch (type) {\r\n            case DataComponentType.FLOAT:\r\n                return Float32Array;\r\n            case DataComponentType.BYTE:\r\n                return Uint8Array;\r\n            case DataComponentType.UNSIGNED_BYTE:\r\n                return Uint8Array;\r\n            case DataComponentType.SHORT:\r\n                return Int16Array;\r\n            case DataComponentType.UNSIGNED_SHORT:\r\n                return Uint16Array;\r\n            case DataComponentType.INT:\r\n                return Int32Array;\r\n            case DataComponentType.UNSIGNED_INT:\r\n                return Uint32Array;\r\n        }\r\n    }\r\n\r\n    static getArrayComponentType(array: AttributeArray): DataComponentType {\r\n        if (array instanceof Float32Array) {\r\n            return DataComponentType.FLOAT;\r\n        }\r\n        else if (array instanceof Int32Array) {\r\n            return DataComponentType.INT;\r\n        }\r\n        else if (array instanceof Uint32Array) {\r\n            return DataComponentType.UNSIGNED_INT;\r\n        }\r\n        else if (array instanceof Int16Array) {\r\n            return DataComponentType.SHORT;\r\n        }\r\n        else if (array instanceof Uint16Array) {\r\n            return DataComponentType.UNSIGNED_SHORT;\r\n        }\r\n        else if (array instanceof Int8Array) {\r\n            return DataComponentType.BYTE;\r\n        }\r\n        else {\r\n            return DataComponentType.UNSIGNED_BYTE;\r\n        }\r\n    }\r\n\r\n    static createVertexElementArrayBuffer(gl: WebGL2RenderingContext, indices: Uint8Array | Uint16Array | Uint32Array): VertexElementArrayBuffer | null {\r\n        const internalBuffer = gl.createBuffer();\r\n        if (internalBuffer === null) {\r\n            return null;\r\n        }\r\n        const usage = BufferDataUsage.STATIC_READ;\r\n        const target = gl.ELEMENT_ARRAY_BUFFER;\r\n        const {byteLength} = indices;\r\n        const indexType = this.getElementArrayBufferType(indices);\r\n\r\n        gl.bindBuffer(target, internalBuffer);\r\n        gl.bufferData(target, indices, usage);\r\n\r\n        return {\r\n            internalBuffer,\r\n            target,\r\n            usage,\r\n            byteLength,\r\n            indexType\r\n        };\r\n    }\r\n    \r\n    static createVertexArrayBuffer(gl: WebGL2RenderingContext, program: Program, attributes: Record<string, VertexAttributeProperties>, usage?: BufferDataUsage, interleaved?: boolean): VertexArrayBuffer | null {\r\n        const {internalProgram} = program;\r\n\r\n        const DEFAULT_USAGE = BufferDataUsage.STATIC_READ;\r\n        const DEFAULT_INTERLEAVED = false;\r\n        interleaved = interleaved ?? DEFAULT_INTERLEAVED;\r\n        usage = usage ?? DEFAULT_USAGE;\r\n\r\n        const attributesEntries = attributes ? Object.entries(attributes) : null;\r\n        const byteLength = (attributesEntries !== null) ? attributesEntries.reduce(\r\n            (byteLength, [_, attribute]) => byteLength + (attribute.array?.byteLength ?? attribute.byteLength ?? 0), 0\r\n        ) : 0;\r\n        \r\n        const internalBuffer = gl.createBuffer();\r\n        if (internalBuffer === null) {\r\n            return null;\r\n        }\r\n\r\n        const target = gl.ARRAY_BUFFER;\r\n        gl.bindBuffer(target, internalBuffer);\r\n        const dataBuffer = new ArrayBuffer(byteLength);\r\n        let byteStride = 0;\r\n\r\n        const vertexAttributes: Record<string, VertexAttribute> = {};\r\n        if (attributesEntries !== null) {\r\n\r\n            attributesEntries.forEach(([_, attribute]) => {\r\n                const {array, componentType, byteLength} = attribute;\r\n                if (!array && !(componentType && byteLength)) {\r\n                    throw new Error(\"Every attribute requires either an array or a componentType and a byteLength\");\r\n                }\r\n            });\r\n\r\n            byteStride = interleaved ? attributesEntries.reduce(\r\n                (stride, [_, attribute]) => {\r\n                    const {constant} = attribute;\r\n                    if (!constant) {\r\n                        const {array, type, componentType} = attribute;\r\n                        const {BYTES_PER_ELEMENT} = array ?? this.getComponentTypeArrayConstructor(componentType!);\r\n                        const numComponents = this.getDataTypeNumComponents(type);\r\n                        return stride + BYTES_PER_ELEMENT * numComponents;\r\n                    }\r\n                    return stride;\r\n                }, 0\r\n            ) : 0;\r\n            const bufferSlices = interleaved ? Math.trunc(byteLength / byteStride) : 0;\r\n            let byteOffset = 0;\r\n            let constantValue: AttributeArray | undefined;\r\n    \r\n            attributesEntries.forEach(([attributeName, attribute]) => {\r\n                const {array, type} = attribute;\r\n                let {constant = false, divisor, normalize, componentType} = attribute;\r\n                componentType = array?this.getArrayComponentType(array) : componentType!;\r\n\r\n                const location = gl.getAttribLocation(internalProgram, attributeName);\r\n                if (location === -1) {\r\n                    console.warn(`Attribute ${attributeName} could not be located.`);\r\n                    return;\r\n                }\r\n\r\n                const numComponents = this.getDataTypeNumComponents(type);\r\n                divisor = divisor ?? 0;\r\n                normalize = normalize ?? false;\r\n                \r\n                gl.vertexAttribPointer(location, numComponents, componentType, normalize, byteStride, byteOffset);\r\n                if (divisor > 0) {\r\n                    gl.vertexAttribDivisor(location, divisor);\r\n                }\r\n                if (constant) {\r\n                    if (!array) {\r\n                        throw new Error(\"constant flag requires an array parameter\");\r\n                    }\r\n                    constantValue = array;\r\n                    switch (numComponents) {\r\n                        case 1:\r\n                            gl.vertexAttrib1fv(location, constantValue);\r\n                            break;\r\n                        case 2:\r\n                            gl.vertexAttrib2fv(location, constantValue);\r\n                            break;\r\n                        case 3:\r\n                            gl.vertexAttrib3fv(location, constantValue);\r\n                            break;\r\n                        case 4:\r\n                            gl.vertexAttrib4fv(location, constantValue);\r\n                            break;\r\n                    }\r\n                }\r\n                else {\r\n                    if (!constant) {\r\n                        const {array, type} = attribute;\r\n                        const numComponents = this.getDataTypeNumComponents(type);\r\n                        let byteLength = 0;\r\n                        let bytesPerElement = 0;\r\n                        if (interleaved) {\r\n                            if (array) {\r\n                                ({BYTES_PER_ELEMENT: bytesPerElement, byteLength} = array);\r\n                                const bufferArrayConstructor = this.getComponentTypeArrayConstructor(\r\n                                    this.getArrayComponentType(array)\r\n                                );\r\n                                const bufferArray = new bufferArrayConstructor(dataBuffer, byteOffset);\r\n                                const arrayStrideOffset = byteStride / bytesPerElement;\r\n                                for (let i = 0; i < bufferSlices; i++) {\r\n                                    let arraySliceIndex = i * numComponents;\r\n                                    bufferArray.set(\r\n                                        array.slice(\r\n                                            arraySliceIndex,\r\n                                            arraySliceIndex + numComponents\r\n                                        ),\r\n                                        i * arrayStrideOffset\r\n                                    );\r\n                                }\r\n                            }\r\n                            else {\r\n                                ({BYTES_PER_ELEMENT: bytesPerElement} = this.getComponentTypeArrayConstructor(componentType!));\r\n                                byteLength = attribute.byteLength!;\r\n                            }\r\n                        }\r\n                        else {\r\n                            if (array) {\r\n                                ({BYTES_PER_ELEMENT: bytesPerElement, byteLength} = array);\r\n                                const bufferArrayConstructor = WebGLVertexArrayUtilities.getComponentTypeArrayConstructor(\r\n                                    WebGLVertexArrayUtilities.getArrayComponentType(array)\r\n                                );\r\n                                const bufferArray = new bufferArrayConstructor(dataBuffer, byteOffset);\r\n                                bufferArray.set(array);\r\n                            }\r\n                            else {\r\n                                ({BYTES_PER_ELEMENT: bytesPerElement} = this.getComponentTypeArrayConstructor(componentType!));\r\n                                byteLength = attribute.byteLength!;\r\n                            }\r\n                        }\r\n                        vertexAttributes[attributeName] = {\r\n                            constantValue,\r\n                            numComponents,\r\n                            divisor,\r\n                            componentType,\r\n                            constant,\r\n                            byteOffset,\r\n                            bytesPerElement,\r\n                            type,\r\n                            normalize\r\n                        };\r\n                        byteOffset += interleaved ? bytesPerElement * numComponents : byteLength;\r\n                    }\r\n                    gl.enableVertexAttribArray(location);\r\n                }\r\n            });\r\n        }\r\n        gl.bufferData(target, dataBuffer, usage);\r\n        return {\r\n            internalBuffer,\r\n            target,\r\n            usage,\r\n            byteLength,\r\n            interleaved,\r\n            byteStride,\r\n            vertexAttributes\r\n        };\r\n    }\r\n\r\n    static setVertexArrayValues(gl: WebGL2RenderingContext, vertexArray: VertexArray, values: VertexArrayValues): void {\r\n        const {attributes, elementsCount} = values;\r\n        \r\n        const attributesRecords = Object.keys(attributes);\r\n        attributesRecords.forEach((attributeRecord) => {\r\n            const {verticesBuffers} = vertexArray;\r\n            const verticesBuffer = verticesBuffers.find(\r\n                (verticesBuffer) => attributeRecord in verticesBuffer.vertexAttributes\r\n            );\r\n            if (verticesBuffer) {\r\n                const {internalBuffer, target, byteStride, interleaved, vertexAttributes} = verticesBuffer;\r\n                const currentArrayBufferBinding = gl.getParameter(gl.ARRAY_BUFFER_BINDING);\r\n                if (currentArrayBufferBinding !== internalBuffer) {\r\n                    gl.bindBuffer(target, internalBuffer);\r\n                }\r\n                const attribute = attributes[attributeRecord];\r\n                const {byteOffset, numComponents} = vertexAttributes[attributeRecord];\r\n                let {array, srcOffset, srcLength} = attribute;\r\n                const {length} = array;\r\n                let dstOffset = byteOffset;\r\n                if (interleaved) {\r\n                    if (srcOffset || srcLength) {\r\n                        array = array.slice(srcOffset ?? 0, srcLength);\r\n                    }\r\n                    const slices = interleaved ? Math.trunc(length / numComponents) : 0;\r\n                    let sliceOffset = 0;\r\n                    for (let i = 0; i < slices; i++) {\r\n                        gl.bufferSubData(target, dstOffset, array, sliceOffset, numComponents);\r\n                        sliceOffset += numComponents;\r\n                        dstOffset += byteStride;\r\n                    }\r\n                }\r\n                else {\r\n                    srcOffset = srcOffset ?? 0;\r\n                    srcLength = srcLength ?? length;\r\n                    gl.bufferSubData(target, 0, array, srcOffset, srcLength);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    static setVertexArrayBufferData(gl: WebGL2RenderingContext, buffer: VertexArrayBuffer | VertexElementArrayBuffer, data: ArrayBufferView, dstByteOffset?: number, srcOffset?: number, length?: number): void {\r\n        const {internalBuffer, target} = buffer;\r\n        gl.bindBuffer(target, internalBuffer);\r\n        dstByteOffset = dstByteOffset ?? 0;\r\n        srcOffset = srcOffset ?? 0;\r\n        gl.bufferSubData(target, dstByteOffset, data, srcOffset, length);\r\n    }\r\n\r\n    static createVertexArray(gl: WebGL2RenderingContext, program: Program, vertexArray: VertexArrayProperties): VertexArray | null {\r\n        const {vertexAttributes, vertexBuffers, elementIndices, elementBuffer: elementBufferOrBufferProperties} = vertexArray;\r\n        \r\n        const internalVertexArray = gl.createVertexArray();\r\n        if (internalVertexArray === null) {\r\n            return null;\r\n        }\r\n        gl.bindVertexArray(internalVertexArray);\r\n\r\n        const attributesEntries = vertexAttributes ? Object.entries(vertexAttributes) : [];\r\n        \r\n        const {internalProgram} = program;\r\n        const verticesBuffers: VertexArray[\"verticesBuffers\"] = [];\r\n        if (vertexBuffers) {\r\n            vertexBuffers.forEach((buffer_i, i) => {\r\n                const attributes = Object.fromEntries(attributesEntries.filter(\r\n                    ([_, attribute_i]) => attribute_i.buffer == i \r\n                ));\r\n                let buffer: VertexArrayBuffer | null = null;\r\n                if (buffer_i !== undefined) {\r\n                    if (\"internalBuffer\" in buffer_i) {\r\n                        const {target, internalBuffer} = buffer_i;\r\n                        buffer = buffer_i;\r\n                        gl.bindBuffer(target, internalBuffer);\r\n                        const {byteStride, vertexAttributes} = buffer;\r\n                        Object.entries(vertexAttributes).forEach(([attributeName, setter]) => {\r\n                            const {numComponents, componentType, normalize, byteOffset, divisor, constant, constantValue} = setter;\r\n                            const location = gl.getAttribLocation(internalProgram, attributeName);\r\n                            if (location > -1) {\r\n                                gl.vertexAttribPointer(location, numComponents, componentType, normalize, byteStride, byteOffset);\r\n                                if (divisor > 0) {\r\n                                    gl.vertexAttribDivisor(location, divisor);\r\n                                }\r\n                                if (constant && constantValue) {\r\n                                    switch (numComponents) {\r\n                                        case 1:\r\n                                            gl.vertexAttrib1fv(location, constantValue);\r\n                                            break;\r\n                                        case 2:\r\n                                            gl.vertexAttrib2fv(location, constantValue);\r\n                                            break;\r\n                                        case 3:\r\n                                            gl.vertexAttrib3fv(location, constantValue);\r\n                                            break;\r\n                                        case 4:\r\n                                            gl.vertexAttrib4fv(location, constantValue);\r\n                                            break;\r\n                                    }\r\n                                }\r\n                                else {\r\n                                    gl.enableVertexAttribArray(location);\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    else if (attributes) {\r\n                        const {usage, interleaved} = buffer_i;\r\n                        buffer = this.createVertexArrayBuffer(gl, program, attributes, usage, interleaved);\r\n                    }\r\n                }\r\n                else if (attributes) {\r\n                    buffer = this.createVertexArrayBuffer(gl, program, attributes);\r\n                }\r\n                if (buffer === null) {\r\n                    return null;\r\n                }\r\n                verticesBuffers.push(buffer);\r\n            });\r\n        }\r\n        else if (vertexAttributes) {\r\n            let buffer: VertexArrayBuffer | null = null;\r\n            buffer = this.createVertexArrayBuffer(gl, program, vertexAttributes);\r\n            if (buffer === null) {\r\n                return null;\r\n            }\r\n            verticesBuffers.push(buffer);\r\n        }\r\n        \r\n        let elementBuffer: VertexElementArrayBuffer | null | undefined = undefined;\r\n        if (elementBufferOrBufferProperties !== undefined) {\r\n            if (\"internalBuffer\" in elementBufferOrBufferProperties) {\r\n                const {target, internalBuffer} = elementBufferOrBufferProperties;\r\n                elementBuffer = elementBufferOrBufferProperties;\r\n                gl.bindBuffer(target, internalBuffer);\r\n            }\r\n            else if (elementIndices) {\r\n                elementBuffer = this.createVertexElementArrayBuffer(gl, elementIndices);\r\n            }\r\n        }\r\n        else if (elementIndices) {\r\n            elementBuffer = this.createVertexElementArrayBuffer(gl, elementIndices);\r\n        }\r\n        if (elementBuffer === null) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            verticesBuffers,\r\n            elementBuffer,\r\n            program,\r\n            internalVertexArray\r\n        };\r\n    }\r\n\r\n    static deleteVertexArray(gl: WebGL2RenderingContext, vertexArray: VertexArray): void {\r\n        const {internalVertexArray} = vertexArray;\r\n        if (gl.isVertexArray(internalVertexArray)) {\r\n            gl.deleteVertexArray(internalVertexArray);\r\n        }\r\n    }\r\n\r\n    static getElementArrayBufferType(indices: Uint8Array | Uint16Array | Uint32Array): ElementArrayDataType {\r\n        if (indices instanceof Uint8Array) {\r\n            return ElementArrayDataType.UNSIGNED_BYTE;\r\n        }\r\n        else if (indices instanceof Uint16Array) {\r\n            return ElementArrayDataType.UNSIGNED_SHORT;\r\n        }\r\n        else {\r\n            return ElementArrayDataType.UNSIGNED_INT;\r\n        }\r\n    }\r\n}","import { Matrix4 } from \"../../../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Camera } from \"./Camera\";\r\n\r\nexport { PerspectiveCamera };\r\n\r\ninterface PerspectiveCameraConstructor {\r\n    prototype: PerspectiveCamera;\r\n    new(fov: number, aspect: number, zNear: number, zFar: number): PerspectiveCamera;\r\n}\r\n\r\ninterface PerspectiveCamera extends Camera {\r\n    setValues(fov: number, aspect: number, zNear: number, zFar: number): PerspectiveCamera\r\n}\r\n\r\nclass PerspectiveCameraBase extends Camera {\r\n    \r\n    constructor(\r\n        fov: number,\r\n        aspect: number,\r\n        zNear: number,\r\n        zFar: number) {\r\n        super(Matrix4.perspective(fov, aspect, zNear, zFar));\r\n    }\r\n\r\n    setValues(\r\n        fov: number,\r\n        aspect: number,\r\n        zNear: number,\r\n        zFar: number): PerspectiveCamera\r\n    {\r\n        this.projection.setPerspective(fov, aspect, zNear, zFar);\r\n        this.updateFrustum();\r\n        return this;\r\n    }\r\n}\r\n\r\nvar PerspectiveCamera: PerspectiveCameraConstructor = PerspectiveCameraBase;","import { AttributeArray, AttributeDataType, DataComponentType, WebGLVertexArrayUtilities } from \"../../webgl/WebGLVertexArrayUtilities\";\r\n\r\nexport { GeometryBuffer };\r\n\r\ninterface GeometryBufferConstructor {\r\n    readonly prototype: GeometryBuffer;\r\n    new(): GeometryBuffer;\r\n    new(\r\n        attributes: Record<string, GeometryBufferAttribute>,\r\n        indices?: Uint8Array | Uint16Array | Uint32Array,\r\n        interleaved?: boolean\r\n    ): GeometryBuffer;\r\n    fromBlob(blob: Blob): Promise<GeometryBuffer>;\r\n}\r\n\r\ninterface GeometryBuffer {\r\n    interleaved: boolean;\r\n    buffer: ArrayBuffer;\r\n    stride: number;\r\n    indices?: Uint8Array | Uint16Array | Uint32Array;\r\n    attributes: Record<string, {\r\n        type: AttributeDataType;\r\n        componentType: DataComponentType;\r\n        byteOffset: number;\r\n        byteLength: number;\r\n        constant?: boolean;\r\n        normalize?: boolean;\r\n    }>;\r\n    getAttribute(name: string): GeometryBufferAttribute | null;\r\n    toBlob(): Blob;\r\n}\r\n\r\ninterface GeometryBufferAttribute {\r\n    array: AttributeArray,\r\n    type: AttributeDataType;\r\n    constant?: boolean;\r\n    normalize?: boolean;\r\n}\r\n\r\nclass GeometryBufferBase implements GeometryBuffer {\r\n    buffer: ArrayBuffer;\r\n    attributes: Record<string, {\r\n        type: AttributeDataType;\r\n        componentType: DataComponentType;\r\n        byteOffset: number;\r\n        byteLength: number;\r\n        constant?: boolean;\r\n        normalize?: boolean;\r\n    }>;\r\n    indices?: Uint8Array | Uint16Array | Uint32Array;\r\n    interleaved: boolean;\r\n    stride: number;\r\n\r\n    constructor()\r\n    constructor(\r\n        attributes: Record<string, GeometryBufferAttribute>,\r\n        indices?: Uint8Array | Uint16Array | Uint32Array,\r\n        interleaved?: boolean\r\n    )\r\n    constructor(\r\n        attributes: Record<string, GeometryBufferAttribute> = {},\r\n        indices?: Uint8Array | Uint16Array | Uint32Array,\r\n        interleaved?: boolean\r\n    ) {\r\n        if (attributes) {\r\n            const attributesEntries = Object.entries(attributes);\r\n            const bufferByteLength = attributesEntries.reduce(\r\n                (byteLength, [_, attribute]) => byteLength + attribute.array.byteLength, 0\r\n            );\r\n            const buffer = new ArrayBuffer(bufferByteLength);\r\n            const stride = (interleaved) ? attributesEntries.reduce(\r\n                (stride, [_, attribute]) => {\r\n                    const {array, type} = attribute;\r\n                    return stride + array.BYTES_PER_ELEMENT * WebGLVertexArrayUtilities.getDataTypeNumComponents(type);\r\n                }, 0\r\n            ) : 0;\r\n            const bufferSlices = Math.trunc(bufferByteLength / stride);\r\n            \r\n            this.attributes = {};\r\n            this.indices = indices;\r\n            this.interleaved = interleaved ?? false;\r\n            this.stride = stride;\r\n            this.buffer = buffer;\r\n            \r\n            let byteOffset = 0;\r\n            if (interleaved) {\r\n                Object.entries(attributes).forEach(([name, attribute]) => {\r\n                    const {array, type, constant, normalize} = attribute;\r\n                    const componentType = WebGLVertexArrayUtilities.getArrayComponentType(array);\r\n                    const numComponents = WebGLVertexArrayUtilities.getDataTypeNumComponents(type);\r\n                    const bufferArrayConstructor = WebGLVertexArrayUtilities.getComponentTypeArrayConstructor(\r\n                        WebGLVertexArrayUtilities.getArrayComponentType(array)\r\n                    );\r\n                    const {byteLength, BYTES_PER_ELEMENT} = array;\r\n                    const bufferArray = new bufferArrayConstructor(buffer, byteOffset);\r\n                    const arrayStrideOffset = stride / BYTES_PER_ELEMENT;\r\n                    for (let i = 0; i < bufferSlices; i++) {\r\n                        let arraySliceIndex = i * numComponents;\r\n                        bufferArray.set(\r\n                            array.slice(\r\n                                arraySliceIndex,\r\n                                arraySliceIndex + numComponents\r\n                            ),\r\n                            i * arrayStrideOffset\r\n                        );\r\n                    }\r\n                    this.attributes[name] = {\r\n                        type,\r\n                        byteOffset,\r\n                        byteLength,\r\n                        componentType,\r\n                        constant,\r\n                        normalize\r\n                    };\r\n                    byteOffset += numComponents * BYTES_PER_ELEMENT;\r\n                });\r\n            }\r\n            else {\r\n                Object.entries(attributes).forEach(([name, attribute]) => {\r\n                    const {array, type} = attribute;\r\n                    const {byteLength} = array;\r\n                    const componentType = WebGLVertexArrayUtilities.getArrayComponentType(array);\r\n                    const bufferArrayConstructor = WebGLVertexArrayUtilities.getComponentTypeArrayConstructor(\r\n                        WebGLVertexArrayUtilities.getArrayComponentType(array)\r\n                    );\r\n                    const bufferArray = new bufferArrayConstructor(buffer, byteOffset);\r\n                    bufferArray.set(array);\r\n                    this.attributes[name] = {\r\n                        byteOffset,\r\n                        byteLength,\r\n                        type,\r\n                        componentType\r\n                    };\r\n                    byteOffset += byteLength;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this.attributes = {};\r\n            this.indices = undefined;\r\n            this.interleaved = false;\r\n            this.stride = 0;\r\n            this.buffer = new ArrayBuffer(0);\r\n        }\r\n    }\r\n\r\n    toBlob(): Blob {\r\n        const {attributes, buffer, stride, interleaved, indices} = this;\r\n        const bufferData = new Uint8Array(buffer);\r\n        const {length: bufferLength} = bufferData;\r\n        const indicesData = Uint8Array.from(indices ?? []);\r\n        const indicesLength = indices?.length ?? 0;\r\n        const headerData = new TextEncoder().encode(JSON.stringify({attributes, stride, interleaved}));\r\n        const {length: headerLength} = headerData;\r\n\r\n        const blobDataView = new Uint8Array(4 + headerLength + indicesLength + bufferLength);\r\n        const {buffer: blobDataViewBuffer} = blobDataView;\r\n        const blobDataHeaderView = new Uint16Array(blobDataViewBuffer, 0, 2);\r\n        const blobDataHeaderLength = blobDataHeaderView.length * (Uint16Array.BYTES_PER_ELEMENT / Uint8Array.BYTES_PER_ELEMENT);\r\n        blobDataHeaderView[0] = headerLength;\r\n        blobDataHeaderView[1] = indicesLength;\r\n        blobDataView.set(headerData, blobDataHeaderLength);\r\n        blobDataView.set(indicesData, blobDataHeaderLength + headerLength);\r\n        blobDataView.set(bufferData, blobDataHeaderLength + headerLength + indicesLength);\r\n\r\n        return new Blob([blobDataView], {type: \"application/octet-stream\"});\r\n    }\r\n\r\n    static async fromBlob(blob: Blob): Promise<GeometryBuffer> {\r\n        const arrayBuffer = await blob.arrayBuffer();\r\n        const blobDataHeaderView = new Uint16Array(arrayBuffer, 0, 2);\r\n        const {byteLength: blobDataHeaderByteLength} = blobDataHeaderView;\r\n        const headerLength = blobDataHeaderView[0];\r\n        const indicesLength = blobDataHeaderView[1];\r\n        const headerData = new Uint8Array(arrayBuffer, blobDataHeaderByteLength, headerLength);\r\n        const arrayConstructor = (indicesLength < Math.pow(2, 8)) ? Uint8Array : (indicesLength < Math.pow(2, 16)) ? Uint16Array : Uint32Array;\r\n        const indices = new arrayConstructor(arrayBuffer.slice(blobDataHeaderByteLength + headerLength * Uint8Array.BYTES_PER_ELEMENT, indicesLength * arrayConstructor.BYTES_PER_ELEMENT));\r\n        const buffer = arrayBuffer.slice(blobDataHeaderByteLength + (indicesLength + headerLength) * Uint8Array.BYTES_PER_ELEMENT);\r\n        const header = <Pick<GeometryBuffer, \"attributes\" | \"stride\" | \"interleaved\">>JSON.parse(new TextDecoder().decode(headerData));\r\n        const {attributes, interleaved, stride} = header;\r\n        const geometryBuffer = new GeometryBuffer();\r\n        geometryBuffer.buffer = buffer;\r\n        geometryBuffer.attributes = attributes;\r\n        geometryBuffer.interleaved = interleaved;\r\n        geometryBuffer.stride = stride;\r\n        geometryBuffer.indices = indices;\r\n        return geometryBuffer;\r\n    }\r\n\r\n    getAttribute(name: string): GeometryBufferAttribute | null {\r\n        const {attributes} = this;\r\n        const attribute = attributes[name];\r\n        if (attribute) {\r\n            const {buffer, interleaved, stride} = this;\r\n            const {type, byteOffset, byteLength, componentType} = attribute;\r\n            const attributeArrayConstructor = WebGLVertexArrayUtilities.getComponentTypeArrayConstructor(componentType);\r\n            const bytesPerElement = attributeArrayConstructor.BYTES_PER_ELEMENT;\r\n            const length = byteLength / bytesPerElement;\r\n            const numComponents = WebGLVertexArrayUtilities.getDataTypeNumComponents(type);\r\n            const {byteLength: bufferByteLength} = buffer;\r\n            const {BYTES_PER_ELEMENT} = attributeArrayConstructor;\r\n            const attributeArray = new attributeArrayConstructor(length);\r\n            if (interleaved) {\r\n                const bufferArray = new attributeArrayConstructor(buffer, byteOffset);\r\n                const bufferStride = stride;\r\n                const bufferSlices = Math.trunc(bufferByteLength / bufferStride);\r\n                const arrayStrideOffset = bufferStride / BYTES_PER_ELEMENT;\r\n                for (let i = 0; i < bufferSlices; i++) {\r\n                    let bufferArraySliceIndex = arrayStrideOffset * i;\r\n                    attributeArray.set(\r\n                        bufferArray.slice(\r\n                            bufferArraySliceIndex,\r\n                            bufferArraySliceIndex + numComponents\r\n                        ),\r\n                        numComponents * i\r\n                    );\r\n                }\r\n            }\r\n            else {\r\n                const bufferArray = new attributeArrayConstructor(buffer, byteOffset, length);\r\n                attributeArray.set(bufferArray);\r\n            }\r\n            return {\r\n                array: attributeArray,\r\n                type: type\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nvar GeometryBuffer: GeometryBufferConstructor = GeometryBufferBase;","\r\n\r\n// Vertices : counter clock-wise ordered\r\n\r\nimport { TriangleList } from \"../../../../libs/maths/extensions/lists/TriangleList\";\r\nimport { Vector2List } from \"../../../../libs/maths/extensions/lists/Vector2List\";\r\nimport { Vector3List } from \"../../../../libs/maths/extensions/lists/Vector3List\";\r\nimport { UUID, UUIDGenerator } from \"../../../../libs/maths/statistics/random/UUIDGenerator\";\r\nimport { BoundingBox } from \"../../../../libs/physics/collisions/AxisAlignedBoundingBox\";\r\nimport { BoundingSphere } from \"../../../../libs/physics/collisions/BoundingSphere\";\r\nimport { GeometryBuffer } from \"./GeometryBuffer\";\r\nimport { GeometryBuilder } from \"./GeometryBuilder\";\r\nimport { GeometryUtils } from \"./GeometryUtils\";\r\n\r\n// FaceIndices : 3 vertices indices\r\n// FaceArea : triangle.getArea()\r\n// FaceNormal : triangle.getNormal()\r\n// FaceUV / FaceColor ?\r\n\r\n// VertexNormal => Weighted (by area) average of the normals of the faces containing the vertex (=> Varying)\r\n// - Clone the vertex array, read the face indices array\r\n\r\n// VertexIndices\r\n\r\n// PerVertex Animation / MorphTargets\r\n\r\n// SkeletalAnimation\r\n\r\n// Bones are a hierarchical tree\r\n\r\n// bonesWeights\r\n// bonesIndices\r\n\r\n// MorphTarget Animation\r\n\r\n// MorphTargets are a copy of each face, being transformed over time\r\n\r\n// morphIndices\r\n// morphTargets = []; MorphTargets are a transformed copy of faces\r\n// morphNormals = [];\r\n\r\nexport { Geometry };\r\nexport { GeometryBase };\r\n\r\nenum GeometryAttributes {\r\n    VERTICES,\r\n    UVS,\r\n    NORMALS,\r\n    TANGENTS\r\n}\r\n\r\ninterface GeometryConstructor {\r\n    \r\n}\r\n\r\ninterface Geometry {\r\n\r\n}\r\n\r\nclass GeometryBase implements Geometry {\r\n\r\n    toBuilder(): GeometryBuilder {\r\n        throw new Error(\"No builder defined.\");\r\n    }\r\n}\r\n\r\nvar Geometry: GeometryConstructor = GeometryBase;","import { Matrix4 } from \"../../../../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Vector3 } from \"../../../../../libs/maths/algebra/vectors/Vector3\";\r\nimport { BoundingBox } from \"./BoundingBox\";\r\n\r\nexport class BoundingSphere {\r\n    center: Vector3;\r\n    radius: number;\r\n\r\n    constructor(\r\n        center: Vector3,\r\n        radius: number\r\n    ) {\r\n        this.center = center;\r\n        this.radius = radius;\r\n    }\r\n\r\n    transform(matrix: Matrix4): void {\r\n        const {center} = this;\r\n        matrix.transformPoint(center);\r\n    }\r\n    \r\n    containsPoint(point: Vector3): boolean {\r\n        const {center, radius} = this;\r\n        return center.distance(point) < radius;\r\n    }\r\n\r\n    hitsSphere(other: BoundingSphere) {\r\n        const {center, radius} = this;\r\n        const {center: otherCenter, radius: otherRadius} = other;\r\n        return center.distance(otherCenter) < radius + otherRadius;\r\n    }\r\n\r\n    hitsBox(other: BoundingBox) {\r\n        const {center, radius} = this;\r\n        const {x: sphereX, y: sphereY, z: sphereZ} = center;\r\n        const {min, max} = other;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        // get box closest point to sphere center by clamping\r\n        const x = Math.max(minX, Math.min(sphereX, maxX));\r\n        const y = Math.max(minY, Math.min(sphereY, maxY));\r\n        const z = Math.max(minZ, Math.min(sphereZ, maxZ));\r\n\r\n        // this is the same as isPointInsideSphere\r\n        const distance = Math.sqrt((x - sphereX) * (x - sphereX) + (y - sphereY) * (y - sphereY) + (z - sphereZ) * (z - sphereZ));\r\n        return distance < radius;\r\n    }\r\n}","import { Matrix4 } from \"../../../../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Vector3 } from \"../../../../../libs/maths/algebra/vectors/Vector3\";\r\n\r\nexport { BoundingBox };\r\n\r\nconst corners = new Array(8).fill(0).map(_ => new Vector3());\r\n\r\ninterface BoundingBoxConstructor {\r\n    prototype: BoundingBox;\r\n    new(\r\n        min: Vector3,\r\n        max: Vector3\r\n    ): BoundingBox;\r\n}\r\n\r\ninterface BoundingBox {\r\n    readonly min: Vector3;\r\n    readonly max: Vector3;\r\n    hits(other: BoundingBox): boolean;\r\n    transform(matrix: Matrix4): BoundingBox;\r\n    transformed(matrix: Matrix4): BoundingBox;\r\n    getExtents(extents: Vector3[]): Vector3[];\r\n    getEdges(edges: Vector3[]): Vector3[];\r\n}\r\n\r\nclass BoundingBoxBase {\r\n    readonly min: Vector3;\r\n    readonly max: Vector3;\r\n\r\n    constructor(\r\n        min: Vector3,\r\n        max: Vector3\r\n    ) {\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n\r\n    static fromBoxes(...boxes: BoundingBox[]) {\r\n        const positiveInfinity = Number.POSITIVE_INFINITY;\r\n        const negativeInfinity = Number.NEGATIVE_INFINITY;\r\n        let minX = positiveInfinity;\r\n        let minY = positiveInfinity;\r\n        let minZ = positiveInfinity;\r\n        let maxX = negativeInfinity;\r\n        let maxY = negativeInfinity;\r\n        let maxZ = negativeInfinity;\r\n        boxes.forEach((box_i) => {\r\n            const {min: boxMin, max: boxMax} = box_i;\r\n            const {x: boxMinX, y: boxMinY, z: boxMinZ} = boxMin;\r\n            const {x: boxMaxX, y: boxMaxY, z: boxMaxZ} = boxMax;\r\n            if (boxMinX < minX) minX = boxMinX;\r\n            else if (boxMaxX > maxX) maxX = boxMaxX;\r\n            if (boxMinY < minY) minY = boxMinY;\r\n            else if (boxMaxY > maxY) maxY = boxMaxY;\r\n            if (boxMinZ < minZ) minZ = boxMinZ;\r\n            else if (boxMaxZ > maxZ) maxZ = boxMaxZ;\r\n        });\r\n        return new BoundingBox(\r\n            new Vector3(minX, minY, minZ),\r\n            new Vector3(maxX, maxY, maxZ)\r\n        );\r\n    }\r\n\r\n    hits(other: BoundingBox): boolean {\r\n        const {min, max} = this;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        const {min: otherMin, max: otherMax} = other;\r\n        const {x: otherMinX, y: otherMinY, z: otherMinZ} = otherMin;\r\n        const {x: otherMaxX, y: otherMaxY, z: otherMaxZ} = otherMax;\r\n        return (minX <= otherMaxX && maxX >= otherMinX) &&\r\n            (minY <= otherMaxY && maxY >= otherMinY) &&\r\n            (minZ <= otherMaxZ && maxZ >= otherMinZ);\r\n    }\r\n\r\n    transform(matrix: Matrix4): BoundingBox {\r\n        const {min, max} = this;\r\n        let {x: minX, y: minY, z: minZ} = min;\r\n        let {x: maxX, y: maxY, z: maxZ} = max;\r\n        corners[0].setValues(minX, minY, minZ);\r\n        corners[1].setValues(minX, minY, maxZ);\r\n        corners[2].setValues(minX, maxY, minZ);\r\n        corners[3].setValues(maxX, minY, minZ);\r\n        corners[4].setValues(minX, maxY, maxZ);\r\n        corners[5].setValues(maxX, minY, maxZ);\r\n        corners[6].setValues(maxX, maxY, minZ);\r\n        corners[7].setValues(maxX, maxY, maxZ);\r\n        const {POSITIVE_INFINITY, NEGATIVE_INFINITY} = Number;\r\n        minX = minY = minZ = POSITIVE_INFINITY;\r\n        maxX = maxY = maxZ = NEGATIVE_INFINITY;\r\n        corners.forEach((corner_i) => {\r\n            matrix.transformPoint(corner_i);\r\n            const [x, y, z] = corner_i;\r\n            if (x < minX) minX = x;\r\n            else if (x > maxX) maxX = x;\r\n            if (y < minY) minY = y;\r\n            else if (y > maxY) maxY = y;\r\n            if (z < minZ) minZ = z;\r\n            else if (z > maxZ) maxZ = z;\r\n        });\r\n        min.setValues(minX, minY, minZ);\r\n        max.setValues(maxX, maxY, maxZ);\r\n        return this;\r\n    }\r\n\r\n    getEdges(edges: Vector3[]): Vector3[] {\r\n        const {min, max} = this;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        edges[0].setValues(maxX - minX, 0, 0);\r\n        edges[1].setValues(0, maxY - minY, 0);\r\n        edges[2].setValues(0, 0, maxZ - minZ);\r\n        return edges;\r\n    }\r\n\r\n    getExtents(extents: Vector3[]): Vector3[] {\r\n        const {min, max} = this;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        extents[0].setValues(minX, minY, minZ);\r\n        extents[1].setValues(minX, minY, maxZ);\r\n        extents[2].setValues(minX, maxY, minZ);\r\n        extents[3].setValues(maxX, minY, minZ);\r\n        extents[4].setValues(minX, maxY, maxZ);\r\n        extents[5].setValues(maxX, minY, maxZ);\r\n        extents[6].setValues(maxX, maxY, minZ);\r\n        extents[7].setValues(maxX, maxY, maxZ);\r\n        return extents;\r\n    }\r\n\r\n    transformed(matrix: Matrix4): BoundingBox {\r\n        const {min, max} = this;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        return new BoundingBox(\r\n            new Vector3(minX, minY, minZ),\r\n            new Vector3(maxX, maxY, maxZ)\r\n        ).transform(matrix);\r\n    }\r\n}\r\n\r\nvar BoundingBox: BoundingBoxConstructor = BoundingBoxBase;","\r\n\r\n// Vertices : counter clock-wise ordered\r\n\r\nimport { TriangleList } from \"../../../../libs/maths/extensions/lists/TriangleList\";\r\nimport { Vector2List } from \"../../../../libs/maths/extensions/lists/Vector2List\";\r\nimport { Vector3List } from \"../../../../libs/maths/extensions/lists/Vector3List\";\r\nimport { UUID, UUIDGenerator } from \"../../../../libs/maths/statistics/random/UUIDGenerator\";\r\nimport { BoundingBox } from \"../../../../libs/physics/collisions/AxisAlignedBoundingBox\";\r\nimport { BoundingSphere } from \"../../../../libs/physics/collisions/BoundingSphere\";\r\nimport { GeometryBuffer } from \"./GeometryBuffer\";\r\nimport { GeometryBuilder } from \"./GeometryBuilder\";\r\nimport { GeometryUtils } from \"./GeometryUtils\";\r\n\r\n// FaceIndices : 3 vertices indices\r\n// FaceArea : triangle.getArea()\r\n// FaceNormal : triangle.getNormal()\r\n// FaceUV / FaceColor ?\r\n\r\n// VertexNormal => Weighted (by area) average of the normals of the faces containing the vertex (=> Varying)\r\n// - Clone the vertex array, read the face indices array\r\n\r\n// VertexIndices\r\n\r\n// PerVertex Animation / MorphTargets\r\n\r\n// SkeletalAnimation\r\n\r\n// Bones are a hierarchical tree\r\n\r\n// bonesWeights\r\n// bonesIndices\r\n\r\n// MorphTarget Animation\r\n\r\n// MorphTargets are a copy of each face, being transformed over time\r\n\r\n// morphIndices\r\n// morphTargets = []; MorphTargets are a transformed copy of faces\r\n// morphNormals = [];\r\n\r\nexport { Geometry };\r\nexport { GeometryBase };\r\n\r\nenum GeometryAttributes {\r\n    VERTICES,\r\n    UVS,\r\n    NORMALS,\r\n    TANGENTS\r\n}\r\n\r\ninterface GeometryConstructor {\r\n    \r\n}\r\n\r\ninterface Geometry {\r\n\r\n}\r\n\r\nclass GeometryBase implements Geometry {\r\n\r\n    toBuilder(): GeometryBuilder {\r\n        throw new Error(\"No builder defined.\");\r\n    }\r\n}\r\n\r\nvar Geometry: GeometryConstructor = GeometryBase;","import { BufferMask } from \"./WebGLRendererUtilities\";\r\nimport { Texture, TextureMagFilter, TexturePixelFormat, TexturePixelType } from \"./WebGLTextureUtilities\";\r\n\r\nexport enum FramebufferStatus {\r\n    FRAMEBUFFER_COMPLETE = 0x8CD5,\r\n    FRAMEBUFFER_INCOMPLETE_ATTACHMENT = 0x8CD6,\r\n    FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT = 0x8CD7,\r\n    FRAMEBUFFER_INCOMPLETE_DIMENSIONS = 0x8CD9,\r\n    FRAMEBUFFER_UNSUPPORTED = 0x8CDD\r\n}\r\n\r\nexport enum FramebufferTextureTarget {\r\n    TEXTURE_2D = 0x0DE1,\r\n    TEXTURE_CUBE_MAP_POSITIVE_X = 0x8515,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_X = 0x8516,\r\n    TEXTURE_CUBE_MAP_POSITIVE_Y = 0x8517,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_Y = 0x8518,\r\n    TEXTURE_CUBE_MAP_POSITIVE_Z = 0x8519,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_Z = 0x851A\r\n}\r\n\r\nexport enum FramebufferAttachment {\r\n    COLOR_ATTACHMENT0 = 0x8CE0,\r\n    COLOR_ATTACHMENT1 = 0x8CE1,\r\n    COLOR_ATTACHMENT2 = 0x8CE2,\r\n    COLOR_ATTACHMENT3 = 0x8CE3,\r\n    COLOR_ATTACHMENT4 = 0x8CE4,\r\n    COLOR_ATTACHMENT5 = 0x8CE5,\r\n    COLOR_ATTACHMENT6 = 0x8CE6,\r\n    COLOR_ATTACHMENT7 = 0x8CE7,\r\n    COLOR_ATTACHMENT8 = 0x8CE8,\r\n    COLOR_ATTACHMENT9 = 0x8CE9,\r\n    COLOR_ATTACHMENT10 = 0x8CEA,\r\n    COLOR_ATTACHMENT11 = 0x8CEB,\r\n    COLOR_ATTACHMENT12 = 0x8CEC,\r\n    COLOR_ATTACHMENT13 = 0x8CED,\r\n    COLOR_ATTACHMENT14 = 0x8CEE,\r\n    COLOR_ATTACHMENT15 = 0x8CEF,\r\n    DEPTH_ATTACHMENT = 0x8D00,\r\n    STENCIL_ATTACHMENT = 0x8D20,\r\n    DEPTH_STENCIL_ATTACHMENT = 0x821A\r\n}\r\n\r\nexport enum RenderbufferPixelFormat {\r\n    R8 = 0x8229,\r\n    R8UI = 0x8232,\r\n    R8I = 0x8231,\r\n    R16UI = 0x8234,\r\n    R16I = 0x8233,\r\n    R32UI = 0x8236,\r\n    R32I = 0x8235,\r\n    RG8 = 0x822B,\r\n    RG8UI = 0x8238,\r\n    RG8I = 0x8237,\r\n    RG16UI = 0x823A,\r\n    RG16I = 0x8239,\r\n    RG32UI = 0x823C,\r\n    RG32I = 0x823B,\r\n    RGB8 = 0x8051,\r\n    RGBA8 = 0x8058,\r\n    SRGB8_ALPHA8 = 0x8C43,\r\n    RGBA4 = 0x8056,\r\n    RGB565 = 0x8D62,\r\n    RGB5_A1 = 0x8057,\r\n    RGB10_A2 = 0x8059,\r\n    RGBA8UI = 0x8D7C,\r\n    RGBA8I = 0x8D8E,\r\n    RGB10_A2UI = 0x906F,\r\n    RGBA16UI = 0x8D76,\r\n    RGBA16I = 0x8D88,\r\n    RGBA32I = 0x8D82,\r\n    RGBA32UI = 0x8D70,\r\n    DEPTH_COMPONENT16 = 0x81A5,\r\n    DEPTH_COMPONENT24 = 0x81A6,\r\n    DEPTH_COMPONENT32F = 0x8CAC,\r\n    DEPTH24_STENCIL8 = 0x88F0,\r\n    DEPTH32F_STENCIL8 = 0x8CAD,\r\n    STENCIL_INDEX8 = 0x8D48\r\n}\r\n\r\nexport enum DrawBuffer {\r\n    NONE = 0x0000,\r\n    BACK = 0x0405,\r\n    COLOR_ATTACHMENT0 = 0x8CE0,\r\n    COLOR_ATTACHMENT1 = 0x8CE1,\r\n    COLOR_ATTACHMENT2 = 0x8CE2,\r\n    COLOR_ATTACHMENT3 = 0x8CE3,\r\n    COLOR_ATTACHMENT4 = 0x8CE4,\r\n    COLOR_ATTACHMENT5 = 0x8CE5,\r\n    COLOR_ATTACHMENT6 = 0x8CE6,\r\n    COLOR_ATTACHMENT7 = 0x8CE7,\r\n    COLOR_ATTACHMENT8 = 0x8CE8,\r\n    COLOR_ATTACHMENT9 = 0x8CE9,\r\n    COLOR_ATTACHMENT10 = 0x8CEA,\r\n    COLOR_ATTACHMENT11 = 0x8CEB,\r\n    COLOR_ATTACHMENT12 = 0x8CEC,\r\n    COLOR_ATTACHMENT13 = 0x8CED,\r\n    COLOR_ATTACHMENT14 = 0x8CEE,\r\n    COLOR_ATTACHMENT15 = 0x8CEF,\r\n\r\n}\r\nexport type Renderbuffer = {\r\n    internalRenderbuffer: WebGLRenderbuffer;\r\n}\r\n\r\nexport type RenderbufferProperties = {\r\n    internalFormat: RenderbufferPixelFormat;\r\n    width: number;\r\n    height: number;\r\n    samples?: number;\r\n}\r\n\r\ntype Framebuffer = {\r\n    internalFramebuffer: WebGLFramebuffer;\r\n};\r\n\r\ntype FramebufferTextureAttachmentProperties = {\r\n    attachment: FramebufferAttachment;\r\n    textureTarget: FramebufferTextureTarget;\r\n    texture: Texture;\r\n}\r\n\r\ntype FramebufferTextureAttachment = FramebufferTextureAttachmentProperties & Framebuffer;\r\n\r\ntype FramebufferRenderbufferAttachmentProperties = {\r\n    attachment: FramebufferAttachment;\r\n    renderbuffer: Renderbuffer;\r\n}\r\n\r\ntype FramebufferRenderbufferAttachment = FramebufferRenderbufferAttachmentProperties & Framebuffer;\r\n\r\nexport class WebGLFramebufferUtilities {\r\n\r\n    static createFramebuffer(gl: WebGL2RenderingContext): Framebuffer | null {\r\n        const internalFramebuffer = gl.createFramebuffer();\r\n    \r\n        if (internalFramebuffer === null) {\r\n            return null;\r\n        }\r\n        \r\n        return {\r\n            internalFramebuffer\r\n        };\r\n    }\r\n\r\n    static createRenderbuffer(gl: WebGL2RenderingContext, properties: RenderbufferProperties): Renderbuffer | null {\r\n        const internalRenderbuffer = gl.createRenderbuffer();\r\n        if (internalRenderbuffer === null) {\r\n            return null;\r\n        }\r\n\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, internalRenderbuffer);\r\n        \r\n        const {samples, internalFormat, width, height} = properties;\r\n        if (typeof samples !== \"undefined\") {\r\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, samples, internalFormat, width, height);\r\n        }\r\n        else {\r\n            gl.renderbufferStorage(gl.RENDERBUFFER, internalFormat, width, height);\r\n        }\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n\r\n        return {\r\n            ...properties,\r\n            internalRenderbuffer\r\n        };\r\n    }\r\n\r\n    static attachTexture(gl: WebGL2RenderingContext, framebuffer: Framebuffer, ...properties: FramebufferTextureAttachmentProperties[]): FramebufferTextureAttachment[] {\r\n        const {internalFramebuffer} = framebuffer;\r\n        const currentFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING);\r\n        if (currentFramebuffer !== internalFramebuffer) {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, internalFramebuffer);\r\n        }\r\n        \r\n        const attachments = properties.map((properties) => {\r\n            const {attachment, textureTarget, texture} = properties;\r\n            const {internalTexture} = texture;\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, textureTarget, internalTexture, 0);\r\n            return {\r\n                ...properties,\r\n                ...framebuffer\r\n            };\r\n        });\r\n\r\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n        if (status !== FramebufferStatus.FRAMEBUFFER_COMPLETE) {\r\n            console.warn(`Incomplete framebuffer status: ${FramebufferStatus[status]}`);\r\n        }\r\n\r\n        this.unbindFramebuffer(gl);\r\n\r\n        return attachments;\r\n    }\r\n\r\n    static drawBuffers(gl: WebGL2RenderingContext, framebuffer: Framebuffer, drawBuffers: DrawBuffer[]): void {\r\n        const {internalFramebuffer} = framebuffer;\r\n        const currentFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING);\r\n        if (currentFramebuffer !== internalFramebuffer) {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, internalFramebuffer);\r\n        }\r\n        \r\n        gl.drawBuffers(drawBuffers);\r\n\r\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n        if (status !== FramebufferStatus.FRAMEBUFFER_COMPLETE) {\r\n            console.warn(`Incomplete framebuffer status: ${FramebufferStatus[status]}`);\r\n        }\r\n\r\n        this.unbindFramebuffer(gl);\r\n    }\r\n\r\n    static attachRenderbuffer(gl: WebGL2RenderingContext, framebuffer: Framebuffer, ...props: FramebufferRenderbufferAttachmentProperties[]): FramebufferRenderbufferAttachment[] {\r\n        const {internalFramebuffer} = framebuffer;\r\n        const currentFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING);\r\n        if (currentFramebuffer !== internalFramebuffer) {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, internalFramebuffer);\r\n        }\r\n\r\n        const attachments = props.map((props) => {\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, props.attachment, gl.RENDERBUFFER, props.renderbuffer.internalRenderbuffer);\r\n            return {\r\n                ...props,\r\n                ...framebuffer\r\n            };\r\n        });\r\n\r\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n        if (status !== FramebufferStatus.FRAMEBUFFER_COMPLETE) {\r\n            console.warn(`Incomplete framebuffer status: ${FramebufferStatus[status]}`);\r\n        }\r\n\r\n        this.unbindFramebuffer(gl);\r\n\r\n        return attachments;\r\n    }\r\n\r\n    static blit(gl: WebGL2RenderingContext, readFramebuffer: Framebuffer | null, drawFramebuffer: Framebuffer | null, readRectangle: number[], drawRectangle: number[], mask: BufferMask, filter: TextureMagFilter): void {\r\n        const currentReadFramebuffer = gl.getParameter(gl.READ_FRAMEBUFFER_BINDING);\r\n        if (currentReadFramebuffer !== readFramebuffer) {\r\n            const internalReadFramebuffer = readFramebuffer?.internalFramebuffer ?? null;\r\n            gl.bindFramebuffer(gl.READ_FRAMEBUFFER, internalReadFramebuffer);\r\n        }\r\n        \r\n        const currentDrawFramebuffer = gl.getParameter(gl.DRAW_FRAMEBUFFER_BINDING);\r\n        if (currentDrawFramebuffer !== drawFramebuffer) {\r\n            const internalDrawFramebuffer = drawFramebuffer?.internalFramebuffer ?? null;\r\n            gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, internalDrawFramebuffer);\r\n        }\r\n        \r\n        gl.blitFramebuffer(readRectangle[0], readRectangle[1], readRectangle[2], readRectangle[3], drawRectangle[0], drawRectangle[1], drawRectangle[2], drawRectangle[3], mask, filter);\r\n\r\n        this.unbindFramebuffer(gl);\r\n    }\r\n\r\n    static readPixels(gl: WebGL2RenderingContext, x: number, y: number, width: number, height: number, format: TexturePixelFormat, type: TexturePixelType, pixels: ArrayBufferView): void {\r\n        gl.readPixels(x, y, width, height, format, type, pixels);\r\n    }\r\n\r\n    static bindFramebuffer(gl: WebGL2RenderingContext, framebuffer: Framebuffer): void {\r\n        const {internalFramebuffer} = framebuffer;\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, internalFramebuffer);\r\n    }\r\n\r\n    static unbindFramebuffer(gl: WebGL2RenderingContext): void {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n    static deleteFramebuffer(gl: WebGL2RenderingContext, framebuffer: Framebuffer): void {\r\n        const {internalFramebuffer} = framebuffer;\r\n        if (gl.isFramebuffer(internalFramebuffer)) {\r\n            gl.deleteFramebuffer(internalFramebuffer);\r\n        }\r\n    }\r\n\r\n    static deleteRenderbuffer(gl: WebGL2RenderingContext, renderbuffer: Renderbuffer): void {\r\n        const {internalRenderbuffer} = renderbuffer;\r\n        if (gl.isRenderbuffer(internalRenderbuffer)) {\r\n            gl.deleteRenderbuffer(internalRenderbuffer);\r\n        }\r\n    }\r\n}","export enum TexturePixelFormat {\r\n    ALPHA = 0x1906,\r\n    RGB = 0x1907,\r\n    RGBA = 0x1908,\r\n    LUMINANCE = 0x1909,\r\n    LUMINANCE_ALPHA = 0x190A,\r\n    DEPTH_COMPONENT = 0x1902,\r\n    DEPTH_STENCIL = 0x84F9,\r\n    RED = 0x1903,\r\n    RG = 0x8227,\r\n    RED_INTEGER = 0x8D94,\r\n    RG_INTEGER = 0x8228,\r\n    RGB_INTEGER = 0x8D98,\r\n    RGBA_INTEGER = 0x8D99\r\n}\r\n\r\nexport enum TextureInternalPixelFormat {\r\n    ALPHA = 0x1906,\r\n    RGB = 0x1907,\r\n    RGBA = 0x1908,\r\n    LUMINANCE = 0x1909,\r\n    LUMINANCE_ALPHA = 0x190A,\r\n    DEPTH_COMPONENT16 = 0x81A5,\r\n    DEPTH_COMPONENT24 = 0x81A6,\r\n    DEPTH_COMPONENT32F = 0x8CAC,\r\n    DEPTH24_STENCIL8 = 0x88F0,\r\n    DEPTH32F_STENCIL8 = 0x8CAD,\r\n    R8 = 0x8229,\r\n    R8_SNORM = 0x8F94,\r\n    RG8 = 0x822B,\r\n    RG8_SNORM = 0x8F95,\r\n    RGB8 = 0x8051,\r\n    RGB8_SNORM = 0x8F96,\r\n    RGB565 = 0x8D62,\r\n    RGBA8 = 0x8058,\r\n    RGBA4 = 0x8056,\r\n    RGB5_A1 = 0x8057,\r\n    RGBA8_SNORM = 0x8F97,\r\n    RGB10_A2UI = 0x906F,\r\n    SRGB = 0x8C40,\r\n    SRGB8 = 0x8C41,\r\n    SRGB8_ALPHA8 = 0x8C43,\r\n    R16F = 0x822D,\r\n    RGB16F = 0x881B,\r\n    RGBA16F = 0x881A,\r\n    R32F = 0x822E,\r\n    RG32F = 0x8230,\r\n    RGB32F = 0x8815,\r\n    RGBA32F\t= 0x8814,\r\n    R11F_G11F_B10F = 0x8C3A,\r\n    RGB9_E5 = 0x8C3D,\r\n    R8UI = 0x8232,\r\n    R16I = 0x8233,\r\n    R16UI = 0x8234,\r\n    R32I = 0x8235,\r\n    R32UI = 0x8236,\r\n    RG8I = 0x8237,\r\n    RG8UI = 0x8238,\r\n    RG16I = 0x8239,\r\n    RG16UI = 0x823A,\r\n    RG32I = 0x823B,\r\n    RG32UI = 0x823C,\r\n    RGB8I = 0x8D8F,\r\n    RGB8UI = 0x8D7D,\r\n    RGB16I = 0x8D89,\r\n    RGB16UI = 0x8D77,\r\n    RGB32I = 0x8D83,\r\n    RGB32UI = 0x8D71,\r\n    RGBA8I = 0x8D8E,\r\n    RGBA8UI = 0x8D7C,\r\n    RGBA16I = 0x8D88,\r\n    RGBA16UI = 0x8D76,\r\n    RGBA32I = 0x8D82,\r\n    RGBA32UI = 0x8D70,\r\n}\r\n\r\nexport enum TexturePixelType {\r\n    BYTE = 0x1400,\r\n    UNSIGNED_BYTE = 0x1401,\r\n    SHORT = 0x1402,\r\n    UNSIGNED_SHORT = 0x1403,\r\n    INT = 0x1404,\r\n    UNSIGNED_INT = 0x1405,\r\n    FLOAT = 0x1406,\r\n    HALF_FLOAT = 0x140B,\r\n    UNSIGNED_SHORT_4_4_4_4 = 0x8033,\r\n    UNSIGNED_SHORT_5_5_5_1 = 0x8034,\r\n    UNSIGNED_SHORT_5_6_5 = 0x8363,\r\n    UNSIGNED_INT_2_10_10_10_REV = 0x8368,\r\n    UNSIGNED_INT_24_8 = 0x84FA,\r\n    UNSIGNED_INT_10F_11F_11F_REV = 0x8C3B,\r\n    UNSIGNED_INT_5_9_9_9_REV = 0x8C3E,\r\n    FLOAT_32_UNSIGNED_INT_24_8_REV = 0x8DAD,\r\n    INT_2_10_10_10_REV = 0x8D9F\r\n}\r\n\r\nexport enum TextureParameter {\r\n    TEXTURE_MAG_FILTER = 0x2800,\r\n    TEXTURE_MIN_FILTER = 0x2801,\r\n    TEXTURE_WRAP_S = 0x2802,\r\n    TEXTURE_WRAP_T = 0x2803,\r\n    TEXTURE_BASE_LEVEL = 0x813C,\r\n    TEXTURE_MAX_LEVEL = 0x813D,\r\n    TEXTURE_MAX_LOD = 0x813B,\r\n    TEXTURE_MIN_LOD = 0x813A,\r\n    TEXTURE_WRAP_R = 0x8072,\r\n    TEXTURE_COMPARE_FUNC = 0x884D,\r\n    TEXTURE_COMPARE_MODE = 0x884C\r\n}\r\n\r\nexport enum TextureTarget {\r\n    TEXTURE_2D = 0x0DE1,\r\n    TEXTURE_CUBE_MAP = 0x8513,\r\n    TEXTURE_3D = 0x806F,\r\n    TEXTURE_2D_ARRAY = 0x8C1A,\r\n    TEXTURE_CUBE_MAP_POSITIVE_X = 0x8515,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_X = 0x8516,\r\n    TEXTURE_CUBE_MAP_POSITIVE_Y = 0x8517,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_Y = 0x8518,\r\n    TEXTURE_CUBE_MAP_POSITIVE_Z = 0x8519,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_Z = 0x851A\r\n}\r\n\r\nexport enum TextureMagFilter {\r\n    LINEAR = 0x2601,\r\n    NEAREST = 0x2600\r\n}\r\n\r\nexport enum TextureMinFilter {\r\n    LINEAR = 0x2601,\r\n    NEAREST = 0x2600,\r\n    NEAREST_MIPMAP_NEAREST = 0x2700, \r\n    LINEAR_MIPMAP_NEAREST = 0x2701, \r\n    NEAREST_MIPMAP_LINEAR = 0x2702,\r\n    LINEAR_MIPMAP_LINEAR = 0x2703\r\n}\r\n\r\nexport enum TextureCompareMode {\r\n    COMPARE_REF_TO_TEXTURE = 0x884E,\r\n    NONE = 0\r\n}\r\n\r\nexport enum TextureWrapMode {\r\n    REPEAT = 0x2901,\r\n    CLAMP_TO_EDGE = 0x812F, \r\n    MIRRORED_REPEAT = 0x8370\r\n}\r\n\r\nexport enum TextureCompareFunction {\r\n    NEVER = 0x0200,\r\n    LESS = 0x0201,\r\n    EQUAL = 0x0202,\r\n    LEQUAL = 0x0203,\r\n    GREATER = 0x0204,\r\n    NOTEQUAL = 0x0205,\r\n    GEQUAL = 0x0206,\r\n    ALWAYS = 0x0207\r\n}\r\n\r\nexport type Texture2DPixels = Uint32Array |  Uint16Array | Uint8Array | TexImageSource;\r\n\r\nexport type TextureCubeMapPixels = {\r\n    xPos: TexImageSource;\r\n    xNeg: TexImageSource;\r\n    yPos: TexImageSource;\r\n    yNeg: TexImageSource;\r\n    zPos: TexImageSource;\r\n    zNeg: TexImageSource;\r\n}\r\n\r\nexport type TextureProperties = {\r\n    target: TextureTarget;\r\n    pixels: Texture2DPixels | TextureCubeMapPixels | null;\r\n    width: number;\r\n    height: number;\r\n    format: TexturePixelFormat;\r\n    internalFormat: TextureInternalPixelFormat;\r\n    type: TexturePixelType;\r\n\r\n    depth?: number;\r\n    lod?: number;\r\n    border?: number;\r\n\r\n    subimages?: {\r\n        pixels: Texture2DPixels;\r\n        xoffset: number;\r\n        yoffset: number;\r\n        zoffset?: number;\r\n        width: number;\r\n        height: number;\r\n        depth?: number;\r\n    }[];\r\n\r\n    mipmap?: boolean;\r\n    min?: TextureMinFilter;\r\n    mag?: TextureMagFilter;\r\n\r\n    wrapS?: TextureWrapMode;\r\n    wrapT?: TextureWrapMode;\r\n    wrapR?: TextureWrapMode;\r\n\r\n    baseMipmapLevel?: number;\r\n    maxMipmapLevel?: number;\r\n\r\n    minLod?: number;\r\n    maxLod?: number;\r\n\r\n    compareFunction?: TextureCompareFunction;\r\n    compareMode?: TextureCompareMode;\r\n}\r\n\r\nexport type Texture = {\r\n    name: string;\r\n    unit: number;\r\n    internalTexture: WebGLTexture;\r\n    properties?: TextureProperties;\r\n}\r\n\r\nexport class WebGLTextureUtilities {\r\n\r\n    static #textureUnits: Map<string, number> = new Map();\r\n\r\n\r\n    static getTexturesUnitsEntries(): IterableIterator<[string, number]> {\r\n        return this.#textureUnits.entries();\r\n    }\r\n\r\n    static createTexture(gl: WebGL2RenderingContext, name: string, properties: TextureProperties): Texture | null {\r\n        const internalTexture = gl.createTexture();\r\n        if (internalTexture === null) {\r\n            return null;\r\n        }\r\n\r\n        let unit = this.#textureUnits.get(name);\r\n        if (unit == undefined) {\r\n            unit = Math.max(-1, ...this.#textureUnits.values()) + 1;\r\n            this.#textureUnits.set(name, unit);\r\n        }\r\n\r\n        const {pixels, target, subimages, width, height, format, internalFormat, type} = properties;\r\n        let {lod, border, depth, mipmap} = properties;\r\n\r\n        lod = lod ?? 0;\r\n        border = border ?? 0;\r\n        depth = depth ?? 0;\r\n        mipmap = mipmap ?? true;\r\n\r\n        const activeTexture = gl.getParameter(gl.ACTIVE_TEXTURE);\r\n        if (activeTexture !== unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + unit);\r\n            gl.bindTexture(target, internalTexture);\r\n        }\r\n        \r\n        switch (target) {\r\n            case TextureTarget.TEXTURE_2D: {\r\n                gl.texImage2D(target, lod, internalFormat, width, height, border, format, type, <ArrayBufferView | null>pixels);\r\n                if (subimages) {\r\n                    subimages.forEach((subimage_i) => {\r\n                        const {xoffset, yoffset, width, height, pixels} = subimage_i;\r\n                        gl.texSubImage2D(target, lod!, xoffset, yoffset, width, height, format, type, pixels as ArrayBufferView);\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n            case TextureTarget.TEXTURE_CUBE_MAP: {\r\n                if (pixels === null) {\r\n                    gl.texImage2D(target, lod, internalFormat, width, height, border, format, type, null);  \r\n                }\r\n                else {\r\n                    if (\"xPos\" in pixels) {\r\n                        const {xPos, xNeg, yPos, yNeg, zPos, zNeg} = pixels;\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_POSITIVE_X, lod, internalFormat, width, height, border, format, type, xPos);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_NEGATIVE_X, lod, internalFormat, width, height, border, format, type, xNeg);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_POSITIVE_Y, lod, internalFormat, width, height, border, format, type, yPos);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_NEGATIVE_Y, lod, internalFormat, width, height, border, format, type, yNeg);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_POSITIVE_Z, lod, internalFormat, width, height, border, format, type, zPos);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_NEGATIVE_Z, lod, internalFormat, width, height, border, format, type, zNeg);\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case TextureTarget.TEXTURE_2D_ARRAY: {\r\n                gl.texImage3D(target, lod, internalFormat, width, height,  depth, border, format, type, <ArrayBufferView | null>pixels);\r\n                if (subimages) {\r\n                    subimages.forEach((subimage_i, i) => {\r\n                        const {xoffset, yoffset, zoffset, width, height, depth, pixels} = subimage_i;\r\n                        gl.texSubImage3D(target, lod!, xoffset, yoffset, zoffset!, width, height, depth!, format, type, pixels as ArrayBufferView);\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        if (mipmap) {\r\n            gl.generateMipmap(target);\r\n        }\r\n\r\n        const {min, mag, wrapS, wrapT, wrapR, baseMipmapLevel, maxMipmapLevel, compareFunction, compareMode, minLod, maxLod} = properties;\r\n\r\n        if (min !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_MIN_FILTER, min);\r\n        if (mag !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_MAG_FILTER, mag);\r\n        if (wrapS  !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_WRAP_S, wrapS);\r\n        if (wrapT !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_WRAP_T, wrapT);\r\n        if (wrapR !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_WRAP_R, wrapR);\r\n        if (baseMipmapLevel !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_BASE_LEVEL, baseMipmapLevel);\r\n        if (maxMipmapLevel !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_MAX_LEVEL, maxMipmapLevel);\r\n        if (compareFunction !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_COMPARE_FUNC, compareFunction);\r\n        if (compareMode !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_COMPARE_MODE, compareMode);\r\n        if (minLod !== undefined)\r\n            gl.texParameterf(target, TextureParameter.TEXTURE_MIN_LOD, minLod);\r\n        if (maxLod !== undefined)\r\n            gl.texParameterf(target, TextureParameter.TEXTURE_MAX_LOD, maxLod);\r\n        \r\n        return {\r\n            unit,\r\n            internalTexture,\r\n            name,\r\n            properties: {\r\n                pixels,\r\n                target,\r\n                subimages,\r\n                lod,\r\n                width,\r\n                height,\r\n                format,\r\n                internalFormat,\r\n                type,\r\n                min,\r\n                mag,\r\n                wrapS,\r\n                wrapT,\r\n                wrapR,\r\n                baseMipmapLevel,\r\n                maxMipmapLevel,\r\n                compareFunction,\r\n                compareMode,\r\n                minLod,\r\n                maxLod\r\n            }\r\n        };\r\n    }\r\n\r\n    static setUnpackAlignment(gl: WebGL2RenderingContext, alignment: number): void {\r\n        gl.pixelStorei(gl.UNPACK_ALIGNMENT, alignment);\r\n    }\r\n\r\n    static deleteTexture(gl: WebGL2RenderingContext, texture: Texture): void {\r\n        const {internalTexture, name} = texture;\r\n        if (gl.isTexture(internalTexture)) {\r\n            gl.deleteTexture(internalTexture);\r\n            this.#textureUnits.delete(name);\r\n        }\r\n    }\r\n}","export enum ShaderType {\r\n    FRAGMENT_SHADER = 0x8B30,\r\n    VERTEX_SHADER = 0x8B31,\r\n}\r\n\r\nexport type Program = {\r\n    internalProgram: WebGLProgram;\r\n    vertexShader: Shader;\r\n    fragmentShader: Shader;\r\n}\r\n\r\nexport type Shader = {\r\n    internalShader: WebGLShader;\r\n    type: ShaderType;\r\n    source: string;\r\n}\r\n\r\nexport type ProgramProperties = {\r\n    vertexSource: string;\r\n    vertexFlags?: string[];\r\n    fragmentSource: string;\r\n    fragmentFlags?: string[];\r\n}\r\n\r\nexport class WebGLProgramUtilities {\r\n\r\n    static createShader(gl: WebGL2RenderingContext, type: ShaderType, source: string): Shader | null {\r\n        const internalShader = gl.createShader(type);\r\n        if (internalShader === null) {\r\n            return null;\r\n        }\r\n        gl.shaderSource(internalShader, source);\r\n        gl.compileShader(internalShader);\r\n        \r\n        const success = gl.getShaderParameter(internalShader, gl.COMPILE_STATUS);\r\n        if (success) {\r\n            return {\r\n                type,\r\n                internalShader,\r\n                source\r\n            };\r\n        }\r\n\r\n        const shaderInfoLog = gl.getShaderInfoLog(internalShader);\r\n        if (shaderInfoLog !== null) {\r\n            console.warn(shaderInfoLog);\r\n        }\r\n\r\n        gl.deleteShader(internalShader);\r\n        return null;\r\n    }\r\n    \r\n    static createProgram(gl: WebGL2RenderingContext, properties: ProgramProperties): Program | null {\r\n        const {vertexSource, fragmentSource} = properties;\r\n\r\n        const vertexShader = this.createShader(gl, ShaderType.VERTEX_SHADER, vertexSource);\r\n        if (vertexShader === null) {\r\n            return null;\r\n        }\r\n\r\n        const fragmentShader = this.createShader(gl, ShaderType.FRAGMENT_SHADER, fragmentSource);\r\n        if (fragmentShader === null) {\r\n            return null;\r\n        }\r\n        \r\n        const internalProgram = gl.createProgram();\r\n        if (internalProgram === null) {\r\n            return null;\r\n        }\r\n\r\n        const program: Program = {\r\n            internalProgram,\r\n            vertexShader,\r\n            fragmentShader\r\n        };\r\n        \r\n        gl.attachShader(internalProgram, vertexShader.internalShader);\r\n        gl.attachShader(internalProgram, fragmentShader.internalShader);\r\n        gl.linkProgram(internalProgram);\r\n\r\n        const success = gl.getProgramParameter(internalProgram, gl.LINK_STATUS);\r\n        if (success) {\r\n            return program;\r\n        }\r\n\r\n        const programInfoLog = gl.getProgramInfoLog(internalProgram);\r\n        if (programInfoLog !== null) {\r\n            const vertexInfoLog = gl.getShaderInfoLog(vertexShader.internalShader);\r\n            const fragmentInfoLog = gl.getShaderInfoLog(fragmentShader.internalShader);\r\n            console.warn(programInfoLog);\r\n            console.warn(vertexInfoLog);\r\n            console.warn(fragmentInfoLog);\r\n        }\r\n        this.deleteProgram(gl, program);\r\n\r\n        return null;\r\n    }\r\n\r\n    static recompileProgram(gl: WebGL2RenderingContext, program: Program, properties: Partial<ProgramProperties>) {\r\n        const {internalProgram, vertexShader, fragmentShader} = program;\r\n        let {vertexSource, fragmentSource} = properties;\r\n        if (typeof vertexSource === \"string\") {\r\n            const {internalShader} = vertexShader;\r\n            gl.shaderSource(internalShader, vertexSource);\r\n            gl.compileShader(internalShader);\r\n            vertexShader.source = vertexSource;\r\n        }\r\n        if (typeof fragmentSource === \"string\") {\r\n            const {internalShader} = fragmentShader;\r\n            gl.shaderSource(internalShader, fragmentSource);\r\n            gl.compileShader(internalShader);\r\n            fragmentShader.source = fragmentSource;\r\n        }\r\n        gl.linkProgram(internalProgram);\r\n\r\n        const success = gl.getProgramParameter(internalProgram, gl.LINK_STATUS);\r\n        if (success) {\r\n            return program;\r\n        }\r\n\r\n        const programInfoLog = gl.getProgramInfoLog(internalProgram);\r\n        if (programInfoLog !== null) {\r\n            const vertexInfoLog = gl.getShaderInfoLog(vertexShader.internalShader);\r\n            const fragmentInfoLog = gl.getShaderInfoLog(fragmentShader.internalShader);\r\n            console.warn(programInfoLog);\r\n            console.warn(vertexInfoLog);\r\n            console.warn(fragmentInfoLog);\r\n        }\r\n        return program;\r\n    }\r\n    \r\n    static deleteProgram(gl: WebGL2RenderingContext, program: Program) {\r\n        const {vertexShader, fragmentShader, internalProgram} = program;\r\n        gl.deleteShader(vertexShader.internalShader);\r\n        gl.deleteShader(fragmentShader.internalShader);\r\n        gl.deleteProgram(internalProgram);\r\n    }\r\n\r\n    static useProgram(gl: WebGL2RenderingContext, program: Program) {\r\n        const {internalProgram} = program;\r\n        const currentProgram = gl.getParameter(gl.CURRENT_PROGRAM);\r\n        if (currentProgram !== internalProgram) {\r\n            gl.useProgram(internalProgram);\r\n        }\r\n    }\r\n}","import { Program, WebGLProgramUtilities } from \"./WebGLProgramUtilities\";\r\nimport { Texture } from \"./WebGLTextureUtilities\";\r\n\r\nexport { UniformValue };\r\nexport { Uniform };\r\nexport { UniformSetter };\r\nexport { UniformsListSetter };\r\nexport { WebGLUniformUtilities };\r\n\r\nexport enum UniformType {\r\n    BOOL = 0x8B56,\r\n    BOOL_VEC2 = 0x8B57,\t \r\n    BOOL_VEC3 = 0x8B58,\t \r\n    BOOL_VEC4 = 0x8B59,\r\n    INT = 0x1404,\r\n    INT_VEC2 = 0x8B53,\t \r\n    INT_VEC3 = 0x8B54,\t \r\n    INT_VEC4 = 0x8B55,\t \r\n    INT_SAMPLER_2D = 0x8DCA,\r\n    INT_SAMPLER_3D = 0x8DCB,\r\n    INT_SAMPLER_CUBE = 0x8DCC,\r\n    INT_SAMPLER_2D_ARRAY = 0x8DCF,\r\n    UNSIGNED_INT_SAMPLER_2D = 0x8DD2,\r\n    UNSIGNED_INT_SAMPLER_3D = 0x8DD3,\r\n    UNSIGNED_INT_SAMPLER_CUBE = 0x8DD4,\r\n    UNSIGNED_INT_SAMPLER_2D_ARRAY = 0x8DD7,\r\n    UNSIGNED_INT = 0x1405,\r\n    UNSIGNED_INT_VEC2 = 0x8DC6,\r\n    UNSIGNED_INT_VEC3 = 0x8DC7,\r\n    UNSIGNED_INT_VEC4 = 0x8DC8,\r\n    FLOAT = 0x1406,\r\n    FLOAT_VEC2 = 0x8B50,\t \r\n    FLOAT_VEC3 = 0x8B51,\t \r\n    FLOAT_VEC4 = 0x8B52,\r\n    FLOAT_MAT2 = 0x8B5A,\t \r\n    FLOAT_MAT3 = 0x8B5B,\t \r\n    FLOAT_MAT4 = 0x8B5C,\t \r\n    FLOAT_MAT2x3 = 0x8B65,\r\n    FLOAT_MAT2x4 = 0x8B66,\r\n    FLOAT_MAT3x2 = 0x8B67,\r\n    FLOAT_MAT3x4 = 0x8B68,\r\n    FLOAT_MAT4x2 = 0x8B69,\r\n    FLOAT_MAT4x3 = 0x8B6A,\r\n    SAMPLER_2D = 0x8B5E,\t \r\n    SAMPLER_3D = 0x8B5F,\r\n    SAMPLER_CUBE = 0x8B60,\r\n    SAMPLER_2D_SHADOW = 0x8B62,\r\n    SAMPLER_2D_ARRAY = 0x8DC1,\r\n    SAMPLER_2D_ARRAY_SHADOW = 0x8DC4,\r\n    SAMPLER_CUBE_SHADOW = 0x8DC5\r\n}\r\n\r\ntype UniformValue = number | Float32List | Uint32List | Int32List | Texture;\r\n\r\ntype Uniform = {\r\n    value: UniformValue;\r\n    srcOffset?: number;\r\n    srcLength?: number;\r\n    transpose?: boolean;\r\n}\r\n\r\ntype UniformSetter = {\r\n    type: UniformType;\r\n    set: (value: any) => void;\r\n}\r\n\r\ntype UniformsListSetter = {\r\n    setters: Record<string, UniformSetter>;\r\n    program: Program;\r\n}\r\n\r\nexport enum UniformDataType {\r\n    SCALAR = \"SCALAR\",\r\n    VEC2 = \"VEC2\",\r\n    VEC3 = \"VEC3\",\r\n    VEC4 = \"VEC4\",\r\n    MAT2 = \"MAT2\",\r\n    MAT3 = \"MAT3\",\r\n    MAT4 = \"MAT4\"\r\n}\r\n\r\nclass WebGLUniformUtilities {\r\n\r\n    static asArrayBufferView(uniformValue: UniformValue): ArrayBufferView {\r\n        if (typeof uniformValue === \"object\") {\r\n            if (\"buffer\" in uniformValue) {\r\n                return uniformValue;\r\n            }\r\n            else if (\"unit\" in uniformValue) {\r\n                return Float32Array.of(uniformValue.unit);\r\n            }\r\n            else {\r\n                return Float32Array.from(uniformValue);\r\n            }\r\n        }\r\n        else {\r\n            return Float32Array.of(uniformValue);\r\n        }\r\n    }\r\n\r\n    static getUniformSetter(gl: WebGL2RenderingContext, uniform: Uniform, location: WebGLUniformLocation , uniformType: UniformType): UniformSetter | null { \r\n        const {value, srcOffset, srcLength} = uniform;\r\n        let {transpose = false} = uniform;\r\n\r\n        switch (uniformType) {\r\n            case UniformType.FLOAT:\r\n                if (typeof value === \"number\") {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (num: number) => {\r\n                            gl.uniform1f(location, num);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.UNSIGNED_INT:\r\n                if (typeof value === \"number\") {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (num: number) => {\r\n                            gl.uniform1ui(location, num);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.BOOL:\r\n            case UniformType.INT:\r\n                if (typeof value === \"number\") {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (num: number) => {\r\n                            gl.uniform1i(location, num);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.INT_SAMPLER_2D:\r\n            case UniformType.INT_SAMPLER_2D_ARRAY:\r\n            case UniformType.INT_SAMPLER_3D:\r\n            case UniformType.INT_SAMPLER_CUBE:\r\n            case UniformType.SAMPLER_2D:\r\n            case UniformType.SAMPLER_3D:\r\n            case UniformType.SAMPLER_CUBE:\r\n            case UniformType.SAMPLER_2D_SHADOW:\r\n            case UniformType.SAMPLER_2D_ARRAY:\r\n            case UniformType.SAMPLER_2D_ARRAY_SHADOW:\r\n            case UniformType.SAMPLER_CUBE_SHADOW:\r\n            case UniformType.UNSIGNED_INT_SAMPLER_2D:\r\n            case UniformType.UNSIGNED_INT_SAMPLER_3D:\r\n            case UniformType.UNSIGNED_INT_SAMPLER_CUBE:\r\n            case UniformType.UNSIGNED_INT_SAMPLER_2D_ARRAY:\r\n                if (typeof value == \"object\" && \"unit\" in value) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (tex: Texture) => {\r\n                            const {unit} = tex;\r\n                            gl.uniform1i(location, unit);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_VEC2:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniform2fv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.BOOL_VEC2:\r\n            case UniformType.INT_VEC2:\r\n                if (value instanceof Int32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Int32List) => {\r\n                            gl.uniform2iv(location, list);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.UNSIGNED_INT_VEC2:\r\n                if (value instanceof Uint32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Uint32List) => {\r\n                            gl.uniform2uiv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_VEC3:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniform3fv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.BOOL_VEC3:\r\n            case UniformType.INT_VEC3:\t\r\n                if (value instanceof Int32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Int32List) => {\r\n                            gl.uniform3iv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.UNSIGNED_INT_VEC3:\r\n                if (value instanceof Uint32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Uint32List) => {\r\n                            gl.uniform3uiv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_VEC4:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniform4fv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.BOOL_VEC4:\r\n            case UniformType.INT_VEC4:\r\n                if (value instanceof Int32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Int32List) => {\r\n                            gl.uniform4iv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.UNSIGNED_INT_VEC4:\r\n                if (value instanceof Uint32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Uint32List) => {\r\n                            gl.uniform4uiv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT2:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix2fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT3:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix3fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT4:\t\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix4fv(location, transpose!, list);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT2x3:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix2x3fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT2x4:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix2x4fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT3x2:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix3x2fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT3x4:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix3x4fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT4x2:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix4x2fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT4x3:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix4x3fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static getUniformsListSetter(gl: WebGL2RenderingContext, program: Program, list: Record<string, Uniform>): UniformsListSetter | null {\r\n        const {internalProgram} = program;\r\n        \r\n        const uniformsNames = Object.keys(list);\r\n        let uniformIndices = gl.getUniformIndices(internalProgram, uniformsNames);\r\n        if (uniformIndices === null) {\r\n            console.error(`No uniform indices found.`);\r\n            return null;\r\n        }\r\n\r\n        const activeUniforms = gl.getProgramParameter(internalProgram, gl.ACTIVE_UNIFORMS);\r\n        const validUniformIndices = Array.from(uniformIndices).filter((index_i, i) => {\r\n            const isValid = index_i >= 0 && index_i < activeUniforms;\r\n            if (!isValid) {\r\n                console.warn(`Uniform ${uniformsNames[i]} could not be located.`);\r\n            }\r\n            return isValid;\r\n        });\r\n        \r\n        const setters: Record<string, UniformSetter> = {};\r\n\r\n        const activeUniformsInfo: WebGLActiveInfo[] = validUniformIndices.map(index => gl.getActiveUniform(internalProgram, index)!);\r\n        activeUniformsInfo.forEach(({name, type}) => {\r\n            const uniform = list[name];\r\n            const location = gl.getUniformLocation(internalProgram, name);\r\n            if (location === null) {\r\n                console.warn(`Uniform ${name} could not be located.`);\r\n                return null;\r\n            }\r\n            const setter = this.getUniformSetter(gl, uniform, location, type);\r\n            if (setter) {\r\n                setters[name] = setter;\r\n            }\r\n        });\r\n        \r\n        return {\r\n            setters,\r\n            program\r\n        };\r\n    }\r\n\r\n    static setUniformsListValues(gl: WebGL2RenderingContext, setter: UniformsListSetter, list: Record<string, Uniform>): void {\r\n        const {program, setters} = setter;\r\n        WebGLProgramUtilities.useProgram(gl, program);\r\n        \r\n        Object.entries(list).forEach(([uniformName, uniform]) => {\r\n            if (uniformName in setters) {\r\n                const setter = setters[uniformName];\r\n                const {value} = uniform;\r\n                setter.set(value);\r\n            }\r\n            else {\r\n                console.error(`Uniform ${uniformName} does not match any of the given setters.`);\r\n            }\r\n        });\r\n    }\r\n}","export enum StencilAction {\r\n    KEEP = 0x1E00,\r\n    REPLACE\t= 0x1E01,\r\n    INCR = 0x1E02,\r\n    DECR = 0x1E03,\r\n    INVERT = 0x150A,\r\n    INCR_WRAP = 0x8507,\r\n    DECR_WRAP = 0x8508\r\n}\r\n\r\nexport enum BufferMask {\r\n    DEPTH_BUFFER_BIT = 0x00000100,\r\n    STENCIL_BUFFER_BIT = 0x00000400,\r\n    COLOR_BUFFER_BIT = 0x00004000\r\n}\r\n\r\nexport enum Buffer {\r\n    COLOR = 0x1800,\r\n    DEPTH = 0x1801,\r\n    STENCIL = 0x1802,\r\n    DEPTH_STENCIL = 0x84F9\r\n}\r\n\r\nexport enum TestFunction {\r\n    NEVER = 0x0200,\r\n    LESS = 0x0201,\r\n    EQUAL = 0x0202,\r\n    LEQUAL = 0x0203,\r\n    GREATER = 0x0204,\r\n    NOTEQUAL = 0x0205,\r\n    GEQUAL = 0x0206,\r\n    ALWAYS = 0x0207,\r\n}\r\n\r\nexport enum BlendingMode {\r\n    ZERO = 0,\r\n    ONE = 1,\r\n    SRC_COLOR = 0x0300,\r\n    ONE_MINUS_SRC_COLOR = 0x0301,\r\n    SRC_ALPHA = 0x0302,\r\n    ONE_MINUS_SRC_ALPHA\t= 0x0303,\r\n    DST_ALPHA = 0x0304,\r\n    ONE_MINUS_DST_ALPHA = 0x0305,\r\n    DST_COLOR = 0x0306,\r\n    ONE_MINUS_DST_COLOR = 0x0307,\r\n    SRC_ALPHA_SATURATE = 0x0308,\r\n    CONSTANT_COLOR = 0x8001,\r\n    ONE_MINUS_CONSTANT_COLOR = 0x8002,\r\n    CONSTANT_ALPHA = 0x8003,\r\n    ONE_MINUS_CONSTANT_ALPHA = 0x8004\r\n}\r\n\r\nexport enum BlendingEquation {\r\n    FUNC_ADD = 0x8006,\r\n    FUNC_SUBTRACT = 0x800A,\r\n    FUNC_REVERSE_SUBTRACT = 0x800B,\r\n    MIN = 0x8007,\r\n    MAX = 0x8008,\r\n}\r\n\r\nexport enum Capabilities {\r\n    BLEND = 0x0BE2,\r\n    CULL_FACE = 0x0B44,\r\n    DEPTH_TEST = 0x0B71,\r\n    DITHER = 0x0BD0,\r\n    POLYGON_OFFSET_FILL = 0x8037,\r\n    SAMPLE_ALPHA_TO_COVERAGE = 0x809E,\r\n    SAMPLE_COVERAGE = 0x80A0,\r\n    SCISSOR_TEST = 0x0C11,\r\n    STENCIL_TEST= 0x0B90,\r\n    RASTERIZER_DISCARD = 0x8C89\r\n}\r\n\r\nexport enum Face {\r\n    FRONT = 0x0404,\r\n    BACK = 0x0405,\r\n    FRONT_AND_BACK = 0x0408\r\n}\r\n\r\nexport enum WindingOrder {\r\n    CW = 0x0900,\r\n    CCW = 0x0901\r\n}\r\n\r\nexport enum HintTarget {\r\n    GENERATE_MIPMAP_HINT = 0x8192,\r\n    FRAGMENT_SHADER_DERIVATIVE_HINT = 0x8B8B\r\n}\r\n\r\nexport enum HintMode {\r\n    DONT_CARE = 0x1100,\r\n    FASTEST\t= 0x1101,\r\n    NICEST = 0x1102\r\n}\r\n\r\nexport class WebGLRendererUtilities {\r\n\r\n    static hint(gl: WebGL2RenderingContext, target: HintTarget, mode: HintMode) {\r\n        gl.hint(target, mode);\r\n    }\r\n\r\n    static frontFace(gl: WebGL2RenderingContext, winding: WindingOrder): void {\r\n        gl.frontFace(winding);\r\n    }\r\n\r\n    static scissor(gl: WebGL2RenderingContext, x: number, y: number, width: number, height: number): void {\r\n        gl.scissor(x, y, width, height);\r\n    }\r\n\r\n    static viewport(gl: WebGL2RenderingContext, x: number, y: number, width: number, height: number): void {\r\n        gl.viewport(x, y, width, height);\r\n    }\r\n\r\n    static clearColor(gl: WebGL2RenderingContext, color: ArrayLike<number>): void {\r\n        gl.clearColor(color[0], color[1], color[2], color[3]);\r\n    }\r\n\r\n    static depthFunction(gl: WebGL2RenderingContext, func: TestFunction): void {\r\n        gl.depthFunc(func);\r\n    }\r\n\r\n    static blendEquation(gl: WebGL2RenderingContext, equ: BlendingEquation): void {\r\n        gl.blendEquation(equ);\r\n    }\r\n\r\n    static blendFunction(gl: WebGL2RenderingContext, srcFunc: BlendingMode, dstFunc: BlendingMode): void {\r\n        gl.blendFunc(srcFunc, dstFunc);\r\n    }\r\n\r\n    static blendFunctionSeparate(gl: WebGL2RenderingContext, srcFunc: BlendingMode, dstFunc: BlendingMode, srcAlpha: number, dstAlpha: number): void {\r\n        gl.blendFuncSeparate(srcFunc, dstFunc, srcAlpha, dstAlpha);\r\n    }\r\n\r\n    static stencilFunction(gl: WebGL2RenderingContext, func: TestFunction, ref: number, mask: number, face: Face): void {\r\n        gl.stencilFuncSeparate(face, func, ref, mask);\r\n    }\r\n\r\n    static stencilOperations(gl: WebGL2RenderingContext, fail: StencilAction, zFail: StencilAction, zPass: StencilAction, face: Face) {\r\n        gl.stencilOpSeparate(face, fail, zFail, zPass);\r\n    }\r\n\r\n    static stencilMask(gl: WebGL2RenderingContext, mask: number, face: Face) {\r\n        gl.stencilMaskSeparate(face, mask);\r\n    }\r\n\r\n    static colorMask(gl: WebGL2RenderingContext, red: boolean, green: boolean, blue: boolean, alpha: boolean) {\r\n        gl.colorMask(red, green, blue, alpha);\r\n    }\r\n\r\n    static depthMask(gl: WebGL2RenderingContext, flag: boolean) {\r\n        gl.depthMask(flag);\r\n    }\r\n\r\n    static enable(gl: WebGL2RenderingContext, capability: Capabilities): void {\r\n        gl.enable(capability);\r\n    }\r\n\r\n    static disable(gl: WebGL2RenderingContext, capability: Capabilities): void {\r\n        gl.disable(capability);\r\n    }\r\n\r\n    static clear(gl: WebGL2RenderingContext, buffer: BufferMask): void {\r\n        gl.clear(buffer);\r\n    }\r\n\r\n    static getViewport(gl: WebGL2RenderingContext): Int32Array {\r\n        return gl.getParameter(gl.VIEWPORT) as Int32Array;\r\n    }\r\n\r\n    static getMaxSamples(gl: WebGL2RenderingContext): number {\r\n        return gl.getParameter(gl.MAX_SAMPLES) as number;\r\n    }\r\n\r\n    static drawBuffers(gl: WebGL2RenderingContext, buffers: Iterable<number>): void {\r\n        gl.drawBuffers(buffers);\r\n    }\r\n\r\n    static clearBuffers(gl: WebGL2RenderingContext, buffer: Buffer, index: number, values: Float32Array | Int32Array | Uint32Array, srcOffset?: number): void {\r\n        if (values instanceof Float32Array) {\r\n            gl.clearBufferfv(buffer, index, values, srcOffset);\r\n        }\r\n        else if (values instanceof Int32Array) {\r\n            gl.clearBufferiv(buffer, index, values, srcOffset);\r\n        }\r\n        else if (values instanceof Uint32Array) {\r\n            gl.clearBufferuiv(buffer, index, values, srcOffset);\r\n        }\r\n    }\r\n}","import { Vector3 } from \"../../../../libs/maths/algebra/vectors/Vector3\"\r\nimport { BoundingSphere } from \"./bounding/BoundingSphere\";\r\nimport { BoundingBox } from \"./bounding/BoundingBox\";\r\n\r\nexport { GeometryBuilder };\r\n\r\ninterface GeometryBuilder {\r\n    readonly halfEdges: Array<HalfEdge>;\r\n    readonly vertices: Array<Vertex>;\r\n    readonly faces: Array<Face>;\r\n    clone(): GeometryBuilder;\r\n    addTriangleFace(v0: VertexID, v1: VertexID, v2: VertexID, properties?: {[key: string]: any;}): void;\r\n    addQuadFace(v0: VertexID, v1: VertexID, v2: VertexID, v3: VertexID, properties?: {[key: string]: any;}): void;\r\n    addVertex(vertex: number[] | Float32Array | Float64Array): VertexID;\r\n    addFace(vertices: VertexID[], properties?: {[key: string]: any;}[]): void;\r\n    verticesArray(): Float32Array;\r\n    uvsArray(): Float32Array;\r\n    trianglesIndicesArray(): Uint8Array | Uint16Array | Uint32Array;\r\n    linesIndicesArray(): Uint8Array | Uint16Array | Uint32Array;\r\n    normalsArray(): Float32Array;\r\n    tangentsArray(): Float32Array;\r\n    boundingBox(): BoundingBox;\r\n    faceHalfEdgesIterator(face: FaceID): FaceHalfEdgesIterator;\r\n    faceVerticesIterator(face: FaceID): FaceHalfEdgesIterator;\r\n    vertexFacesIterator(vertex: VertexID): VertexFacesIterator;\r\n}\r\n\r\ninterface GeometryBuilderConstructor {\r\n    readonly prototype: GeometryBuilder;\r\n    new(): GeometryBuilder;\r\n}\r\n\r\nclass GeometryBuilderBase implements GeometryBuilder {\r\n    readonly halfEdges: Array<HalfEdge>;\r\n    readonly vertices: Array<Vertex>;\r\n    readonly faces: Array<Face>;\r\n\r\n    constructor() {\r\n        this.halfEdges = [];\r\n        this.vertices = [];\r\n        this.faces = [];\r\n    }\r\n\r\n    clone(): GeometryBuilder {\r\n        return Object.assign(Object.create(this.constructor.prototype), structuredClone(this));\r\n    }\r\n\r\n    addTriangleFace(v0: VertexID, v1: VertexID, v2: VertexID, properties?: {[key: string]: any;}): void {\r\n        this.addFace([v0, v1, v2], properties);\r\n    }\r\n\r\n    addQuadFace(v0: VertexID, v1: VertexID, v2: VertexID, v3: VertexID, properties?: {[key: string]: any;}): void {\r\n        this.addFace([v0, v1, v2, v3], properties);\r\n    }\r\n    \r\n    addVertex(position: number[] | Float32Array | Float64Array): VertexID {\r\n        const {vertices} = this;\r\n        const vertex: Vertex = {\r\n            position: position,\r\n            halfEdgeID: null\r\n        };\r\n        return vertices.push(vertex) - 1;\r\n    }\r\n\r\n    addFace(vertices: VertexID[], properties?: {[key: string]: any;}): void {\r\n        const {halfEdges: _halfEdges, vertices: _vertices, faces: _faces} = this;\r\n        const {length: faceVerticesCount} = vertices;\r\n        if (faceVerticesCount < 2) {\r\n            console.error(`At least 2 vertices are required to create a face.`);\r\n            return;\r\n        }\r\n        const face: Face = {\r\n            halfEdgeID: null,\r\n            ...properties\r\n        };\r\n        const faceID = _faces.length;\r\n        let sourceID: VertexID | null = null;\r\n        let targetID: VertexID | null = null;\r\n        let firstHalfEdgeID: HalfEdgeID | null = null;\r\n        let halfEdge: HalfEdge | null = null;\r\n        let halfEdgeID: HalfEdgeID | null = null;\r\n        let previousHalfEdgeID: HalfEdgeID | null = null;\r\n        for (let i = 0; i < faceVerticesCount; i++) {\r\n            sourceID = vertices[i];\r\n            targetID = (i < faceVerticesCount - 1) ? vertices[i + 1] : vertices[0];\r\n            const existingHalfEdge = Array.from(this.vertexFacesIterator(sourceID)).find(\r\n                (face_i) => {\r\n                    if (face_i === null) return false;\r\n                    return Array.from(this.faceHalfEdgesIterator(face_i)).find(\r\n                        (halfEdge_i) => {\r\n                            const {targetID: targetID_i, prevID: prevID_i} = _halfEdges[halfEdge_i];\r\n                            return targetID_i === targetID && _halfEdges[prevID_i ?? -1]?.targetID === sourceID;\r\n                        }\r\n                    );\r\n                }\r\n            );\r\n            if (existingHalfEdge) {\r\n                continue;\r\n            }\r\n            halfEdge = {\r\n                targetID: targetID,\r\n                twinID: null,\r\n                nextID: null,\r\n                prevID: null,\r\n                faceID: faceID\r\n            };\r\n            halfEdgeID = _halfEdges.length;\r\n            if (previousHalfEdgeID === null) {\r\n                face.halfEdge = halfEdgeID;\r\n                firstHalfEdgeID = halfEdgeID;\r\n            }\r\n            else {\r\n                halfEdge.prevID = previousHalfEdgeID;\r\n                _halfEdges[previousHalfEdgeID].nextID = halfEdgeID;\r\n            }\r\n            const source = _vertices[sourceID]!;\r\n            if (source.halfEdgeID === null) {\r\n                source.halfEdgeID = halfEdgeID;\r\n            }\r\n            const twinHalfEdge = _halfEdges.find(\r\n                (halfEdge_i) => {\r\n                    const {targetID: targetID_i, prevID: prevID_i} = halfEdge_i;\r\n                    return targetID_i === sourceID && _halfEdges[prevID_i ?? -1]?.targetID === targetID;\r\n                }\r\n            ) ?? null;\r\n            if (twinHalfEdge !== null) {\r\n                halfEdge.twinID = _halfEdges.indexOf(twinHalfEdge);\r\n                twinHalfEdge.twinID = halfEdgeID;\r\n            }\r\n            previousHalfEdgeID = halfEdgeID;\r\n            _halfEdges.push(halfEdge);\r\n        }\r\n        if (halfEdge !== null && firstHalfEdgeID !== null) {\r\n            _halfEdges[firstHalfEdgeID].prevID = halfEdgeID;\r\n            halfEdge.nextID = firstHalfEdgeID;\r\n        }\r\n        _faces.push(face);\r\n    }\r\n\r\n    linesArray(): Float32Array {\r\n        const {faces, vertices} = this;\r\n        return new Float32Array(faces.flatMap((_, i) => {\r\n            const faceVertices = Array.from(this.faceVerticesIterator(i));\r\n            if (faceVertices.length === 4) {\r\n                const [v0, v1, v2, v3] = faceVertices.map(vertex_i => vertices[vertex_i].position);\r\n                return [\r\n                    ...v0, ...v1,\r\n                    ...v1, ...v2,\r\n                    ...v2, ...v3,\r\n                    ...v3, ...v0\r\n                ];\r\n            }\r\n            else {\r\n                const [v0, v1, v2] = faceVertices.map(vertex_i => vertices[vertex_i].position);\r\n                return [\r\n                    ...v0, ...v1,\r\n                    ...v1, ...v2,\r\n                    ...v2, ...v0\r\n                ];\r\n            }\r\n        }));\r\n    }\r\n\r\n    verticesArray(): Float32Array {\r\n        const {faces, vertices} = this;\r\n        return new Float32Array(faces.flatMap((_, i) => {\r\n            return Array.from(this.faceVerticesIterator(i)).flatMap((vertex) => {\r\n                return Array.from(vertices[vertex].position);\r\n            });\r\n        }));\r\n    }\r\n\r\n    tangentsArray(): Float32Array {\r\n        const {faces, vertices} = this;\r\n        return new Float32Array(faces.flatMap((face_i, i) => {\r\n            const faceVertices = Array.from(this.faceVerticesIterator(i));\r\n            const faceUvs = face_i.uv as Array<Array<number>>;\r\n            const [v0, v1, v2] = faceVertices.map(vertex_i => vertices[vertex_i].position);\r\n            const [uv0, uv1, uv2] = faceUvs;\r\n            const edge1 = v1.map((v1_i, i) => v0[i] - v1_i);\r\n            const edge2 = v1.map((v1_i, i) => v2[i] - v1_i);\r\n            const deltaUV1 = uv1.map((uv1_i, i) => uv0[i] - uv1_i);\r\n            const deltaUV2 = uv1.map((uv1_i, i) => uv2[i] - uv1_i);\r\n            const f = 1.0 / (deltaUV1[0] * deltaUV2[1] - deltaUV1[1] * deltaUV2[0]);\r\n            const tangent = edge1.map((edge1_i, i) => -(edge1_i * deltaUV2[1] - edge2[i] * deltaUV1[1]) * f);\r\n            const length = Math.hypot(...tangent);\r\n            face_i.tangent = tangent.map(tangent_i => tangent_i / length);\r\n\r\n            return faceVertices.flatMap(() => {\r\n                return Array.from(face_i.tangent);\r\n            });\r\n        }));\r\n    }\r\n\r\n    normalsArray(): Float32Array {\r\n        const {faces, vertices} = this;\r\n        return new Float32Array(faces.flatMap((face_i, i) => {\r\n            const faceVertices = Array.from(this.faceVerticesIterator(i));\r\n            const [v0, v1, v2] = faceVertices.map(vertex_i => vertices[vertex_i].position);\r\n            const edge1 = v1.map((v1_i, i) => v0[i] - v1_i);\r\n            const edge2 = v1.map((v1_i, i) => v2[i] - v1_i);\r\n            const normal = edge1.map((_, i) => {\r\n                const ni = (i + 1) % 3;\r\n                const pi = ((i - 1) + 3) % 3;\r\n                return -(edge1[ni] * edge2[pi] - edge1[pi] * edge2[ni]);\r\n            });\r\n            const length = Math.hypot(...normal);\r\n            face_i.normal = normal.map(normal_i => normal_i / length);\r\n            \r\n            return faceVertices.flatMap(() => {\r\n                return Array.from(face_i.normal);\r\n            });\r\n        }));\r\n    }\r\n\r\n    uvsArray(): Float32Array {\r\n        const {faces} = this;\r\n        return new Float32Array(faces.flatMap((face) => {\r\n            return face.uv.flat(1);\r\n        }));\r\n    }\r\n\r\n    trianglesIndicesArray(): Uint8Array | Uint16Array | Uint32Array {\r\n        const {faces} = this;\r\n        const count = faces.reduce((verticesCount, _, i) => {\r\n            return verticesCount + Array.from(this.faceVerticesIterator(i)).length;\r\n        }, 0);\r\n        const arrayConstructor = (count < Math.pow(2, 8)) ? Uint8Array : (count < Math.pow(2, 16)) ? Uint16Array : Uint32Array;\r\n        return new arrayConstructor(faces.reduce(([indices, index], face_i, i) => {\r\n            const vertices = Array.from(this.faceVerticesIterator(i));\r\n            if (vertices.length === 4) {\r\n                return [indices.concat([index, index + 1, index + 2, index + 1, index + 3, index + 2]), index + 4] as [number[], number];\r\n            }\r\n            return [indices.concat([index, index + 1, index + 2]), index + 3] as [number[], number];\r\n        }, [[], 0] as [number[], number])[0]);\r\n    }\r\n\r\n    linesIndicesArray(): Uint8Array | Uint16Array | Uint32Array {\r\n        const {faces} = this;\r\n        const count = faces.reduce((verticesCount, _, i) => {\r\n            return verticesCount + Array.from(this.faceVerticesIterator(i)).length * 2;\r\n        }, 0);\r\n        const arrayConstructor = (count < Math.pow(2, 8)) ? Uint8Array : (count < Math.pow(2, 16)) ? Uint16Array : Uint32Array;\r\n        return new arrayConstructor(faces.reduce(([indices, index], face_i, i) => {\r\n            const vertices = Array.from(this.faceVerticesIterator(i));\r\n            if (vertices.length === 4) {\r\n                return [indices.concat([index, index + 1, index + 1, index + 3, index + 3, index + 2, index + 2, index]), index + 4] as [number[], number];\r\n            }\r\n            return [indices.concat([index, index + 1, index + 1, index + 2, index + 2, index]), index + 3] as [number[], number];\r\n        }, [[], 0] as [number[], number])[0]);\r\n    }\r\n\r\n    boundingBox(): BoundingBox {\r\n        const positiveInfinity = Number.POSITIVE_INFINITY;\r\n        const negativeInfinity = Number.NEGATIVE_INFINITY;\r\n        let minX = positiveInfinity;\r\n        let minY = positiveInfinity;\r\n        let minZ = positiveInfinity;\r\n        let maxX = negativeInfinity;\r\n        let maxY = negativeInfinity;\r\n        let maxZ = negativeInfinity;\r\n        const {vertices} = this;\r\n        if (vertices.length > 0) {\r\n            vertices.forEach((vertex_i) => {\r\n                const [x, y, z] = vertex_i.position;\r\n                if (x < minX) minX = x;\r\n                else if (x > maxX) maxX = x;\r\n                if (y < minY) minY = y;\r\n                else if (y > maxY) maxY = y;\r\n                if (z < minZ) minZ = z;\r\n                else if (z > maxZ) maxZ = z;\r\n            });\r\n        }\r\n        const min = new Vector3([minX, minY, minZ]);\r\n        const max = new Vector3([maxX, maxY, maxZ]);\r\n        return new BoundingBox(min, max);\r\n    }\r\n\r\n    boundingSphere(): BoundingSphere {\r\n        const positiveInfinity = Number.POSITIVE_INFINITY;\r\n        const negativeInfinity = Number.NEGATIVE_INFINITY;\r\n        let minX = positiveInfinity;\r\n        let minY = positiveInfinity;\r\n        let minZ = positiveInfinity;\r\n        let maxX = negativeInfinity;\r\n        let maxY = negativeInfinity;\r\n        let maxZ = negativeInfinity;\r\n        const {vertices} = this;\r\n        if (vertices.length > 0) {\r\n            vertices.forEach((vertex_i) => {\r\n                const [x, y, z] = vertex_i.position;\r\n                if (x < minX) minX = x;\r\n                else if (x > maxX) maxX = x;\r\n                if (y < minY) minY = y;\r\n                else if (y > maxY) maxY = y;\r\n                if (z < minZ) minZ = z;\r\n                else if (z > maxZ) maxZ = z;\r\n            });\r\n        }\r\n        const min = new Vector3([minX, minY, minZ]);\r\n        const max = new Vector3([maxX, maxY, maxZ]);\r\n        return new BoundingSphere(\r\n            new Vector3(), Math.max(min.length(), max.length())\r\n        );\r\n    }\r\n    \r\n    faceHalfEdgesIterator(face: FaceID): FaceHalfEdgesIterator {\r\n        return new FaceHalfEdgesIterator(this, face);\r\n    }\r\n\r\n    faceVerticesIterator(face: FaceID): FaceHalfEdgesIterator {\r\n        return new FaceVerticesIterator(this, face);\r\n    }\r\n\r\n    vertexFacesIterator(vertex: VertexID): VertexFacesIterator {\r\n        return new VertexFacesIterator(this, vertex);\r\n    }\r\n}\r\n\r\nvar GeometryBuilder: GeometryBuilderConstructor = GeometryBuilderBase;\r\n\r\nexport type HalfEdgeID = number;\r\nexport type FaceID = number;\r\nexport type VertexID = number;\r\n\r\nexport type HalfEdge = {\r\n    targetID: VertexID | null;\r\n    twinID: HalfEdgeID | null;\r\n    prevID: HalfEdgeID | null;\r\n    nextID: HalfEdgeID | null;\r\n    faceID: FaceID | null;\r\n}\r\n\r\nexport type Face = {\r\n    halfEdgeID: HalfEdgeID | null;\r\n    [key: string]: any;\r\n}\r\n\r\nexport type Vertex = {\r\n    position: number[] | Float32Array | Float64Array;\r\n    halfEdgeID: HalfEdgeID | null;\r\n    properties?: {\r\n        [key: string]: any;\r\n    }\r\n}\r\n\r\nexport class FaceHalfEdgesIterator {\r\n    geometry: GeometryBuilder;\r\n    faceID: FaceID;\r\n    halfEdgeID: HalfEdgeID | null;\r\n\r\n    constructor(geometry: GeometryBuilder, face: FaceID) {\r\n        this.geometry = geometry;\r\n        this.faceID = face;\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    reset(): void {\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    current(): HalfEdgeID | null {\r\n        return this.halfEdgeID;\r\n    }\r\n\r\n    next(): IteratorResult<HalfEdgeID> {\r\n        const {halfEdgeID, faceID, geometry} = this;\r\n        const {faces, halfEdges} = geometry;\r\n        const face = faces[faceID];\r\n        if (face !== null) {\r\n            if (halfEdgeID === null) {\r\n                const firstHalfEdgeID = face.halfEdgeID ?? null;\r\n                const nextHalfEdgeID = faces[firstHalfEdgeID ?? -1]?.nextID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (firstHalfEdgeID !== null) {\r\n                    return {\r\n                        value: firstHalfEdgeID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n            else if (halfEdgeID !== face.halfEdge) {\r\n                const nextHalfEdgeID = halfEdges[halfEdgeID].nextID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (halfEdgeID !== null) {\r\n                    return {\r\n                        value: halfEdgeID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return {\r\n            value: undefined, done: true\r\n        };\r\n    }\r\n\r\n    [Symbol.iterator](): Iterator<HalfEdgeID> {\r\n        this.halfEdgeID = null;\r\n        return this;\r\n    }\r\n}\r\n\r\nexport class FaceVerticesIterator {\r\n    geometry: GeometryBuilder;\r\n    faceID: FaceID;\r\n    halfEdgeID: HalfEdgeID | null;\r\n\r\n    constructor(geometry: GeometryBuilder, face: FaceID) {\r\n        this.geometry = geometry;\r\n        this.faceID = face;\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    reset(): void {\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    current(): VertexID | null {\r\n        const {halfEdgeID, geometry} = this;\r\n        const {halfEdges} = geometry;\r\n        return halfEdges[halfEdges[halfEdgeID ?? -1]?.prevID ?? -1]?.targetID ?? null;\r\n    }\r\n\r\n    next(): IteratorResult<VertexID> {\r\n        const {halfEdgeID, geometry, faceID} = this;\r\n        const {faces, halfEdges} = geometry;\r\n        const face = faces[faceID ?? -1];\r\n        if (face !== null) {\r\n            const {halfEdge: faceHalfEdgeID} = face;\r\n            if (halfEdgeID === null) {\r\n                const firstVertexID = halfEdges[halfEdges[faceHalfEdgeID ?? -1].prevID ?? -1].targetID ?? null;\r\n                const nextHalfEdgeID = halfEdges[faceHalfEdgeID ?? -1].nextID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (firstVertexID !== null) {\r\n                    return {\r\n                        value: firstVertexID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n            else if (halfEdgeID !== face.halfEdge) {\r\n                const vertex = halfEdges[halfEdges[halfEdgeID].prevID ?? -1].targetID ?? null;\r\n                const nextHalfEdgeID = halfEdges[halfEdgeID].nextID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (vertex !== null) {\r\n                    return {\r\n                        value: vertex, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return {\r\n            value: undefined, done: true\r\n        };\r\n    }\r\n\r\n    [Symbol.iterator](): Iterator<VertexID> {\r\n        this.halfEdgeID = null;\r\n        return this;\r\n    }\r\n}\r\n\r\nexport class VertexFacesIterator {\r\n    geometry: GeometryBuilder;\r\n    halfEdgeID: HalfEdgeID | null;\r\n    vertexID: VertexID;\r\n    \r\n    constructor(geometry: GeometryBuilder, vertex: VertexID) {\r\n        this.geometry = geometry;\r\n        this.vertexID = vertex;\r\n        this.halfEdgeID = null;\r\n    }\r\n    \r\n    reset(): void {\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    current(): FaceID | null {\r\n        const {geometry, halfEdgeID} = this;\r\n        const {halfEdges} = geometry;\r\n        return halfEdges[halfEdgeID ?? -1].faceID ?? null;\r\n    }\r\n\r\n    next(): IteratorResult<FaceID>  {\r\n        const {halfEdgeID, vertexID, geometry} = this;\r\n        const {halfEdges, vertices} = geometry;\r\n        const vertex = vertices[vertexID ?? -1];\r\n        if (vertex) {\r\n            const {halfEdgeID: vertexHalfEdgeID} = vertex;\r\n            if (halfEdgeID === null) {\r\n                const faceID = halfEdges[vertexHalfEdgeID ?? -1]?.faceID ?? null;\r\n                const nextHalfEdgeID = halfEdges[halfEdges[vertexHalfEdgeID ?? -1]?.prevID ?? -1]?.twinID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (faceID !== null) {\r\n                    return {\r\n                        value: faceID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n            else if (halfEdgeID !== vertex.halfEdgeID) {\r\n                const faceID = halfEdges[halfEdgeID]?.faceID ?? null;\r\n                const nextHalfEdgeID = halfEdges[halfEdges[halfEdgeID].prevID ?? -1].twinID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (faceID !== null) {\r\n                    return {\r\n                        value: faceID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return {\r\n            value: undefined, done: true\r\n        };\r\n    }\r\n\r\n    [Symbol.iterator](): Iterator<FaceID> {\r\n        this.halfEdgeID = null;\r\n        return this;\r\n    }\r\n}","import { GeometryBase } from \"../../Geometry\";\r\nimport { GeometryBuilder } from \"../../GeometryBuilder\";\r\n\r\nexport class CubeGeometry extends GeometryBase {\r\n\twidth: number;\r\n\theight: number;\r\n\tdepth: number;\r\n\twidthSegments: number;\r\n\theightSegments: number;\r\n\tdepthSegments: number;\r\n\r\n\tconstructor(properties?: {width?: number, height?: number, depth?: number, widthSegments?: number, heightSegments?: number, depthSegments?: number}) {\r\n\t\tsuper();\r\n\t\tconst {width, height, depth, widthSegments, heightSegments, depthSegments} = properties ?? {};\r\n\t\tthis.width = width ?? 1;\r\n\t\tthis.height = height ?? 1;\r\n\t\tthis.depth = depth ?? 1;\r\n\t\tthis.widthSegments = widthSegments ?? 1;\r\n\t\tthis.heightSegments = heightSegments ?? 1;\r\n\t\tthis.depthSegments = depthSegments ?? 1;\r\n\t}\r\n\t\r\n\ttoBuilder(): GeometryBuilder {\r\n\t\tconst builder = new GeometryBuilder();\r\n\t\tconst {width, height, depth} = this;\r\n\t\tlet {widthSegments, heightSegments, depthSegments} = this;\r\n\t\twidthSegments = Math.floor(widthSegments);\r\n\t\theightSegments = Math.floor(heightSegments);\r\n\t\tdepthSegments = Math.floor(depthSegments);\r\n\r\n\t\tconst indices: number[] = [];\r\n\t\tconst vertices: number[] = [];\r\n\t\tconst uvs: number[] = [];\r\n\t\tlet verticesCount = 0;\r\n\r\n\t\t[\r\n\t\t\t[2, 1, 0, -1, -1, depth, height, width, depthSegments, heightSegments],\r\n\t\t\t[2, 1, 0, +1, -1, depth, height, -width, depthSegments, heightSegments],\r\n\t\t\t[0, 2, 1, +1, +1, width, depth, height, widthSegments, depthSegments],\r\n\t\t\t[0, 2, 1, +1, -1, width, depth, -height, widthSegments, depthSegments],\r\n\t\t\t[0, 1, 2, +1, -1, width, height, depth, widthSegments, heightSegments],\r\n\t\t\t[0, 1, 2, -1, -1, width, height, -depth, widthSegments, heightSegments]\r\n\t\t].forEach(([u, v, w, udir, vdir, width, height, depth, gridX, gridY]) => {\r\n\t\t\tconst segmentWidth = width / gridX;\r\n\t\t\tconst segmentHeight = height / gridY;\r\n\t\t\tconst widthHalf = width / 2;\r\n\t\t\tconst heightHalf = height / 2;\r\n\t\t\tconst depthHalf = depth / 2;\r\n\t\t\tconst gridX1 = gridX + 1;\r\n\t\t\tconst gridY1 = gridY + 1;\r\n\t\t\tlet index = 0;\r\n\t\t\tfor (let iy = 0; iy < gridY1; iy++) {\r\n\t\t\t\tconst y = iy * segmentHeight - heightHalf;\r\n\t\t\t\tfor (let ix = 0; ix < gridX1; ix++) {\r\n\t\t\t\t\tconst x = ix * segmentWidth - widthHalf;\r\n\t\t\t\t\tconst vertex = new Array(3);\r\n\t\t\t\t\tvertex[u] = x * udir;\r\n\t\t\t\t\tvertex[v] = y * vdir;\r\n\t\t\t\t\tvertex[w] = depthHalf;\r\n\t\t\t\t\tvertices.push(\r\n\t\t\t\t\t\t...vertex\r\n\t\t\t\t\t);\r\n\t\t\t\t\tuvs.push(ix / gridX, 1 - (iy / gridY));\r\n\t\t\t\t\tindex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let iy = 0; iy < gridY; iy++) {\r\n\t\t\t\tfor (let ix = 0; ix < gridX; ix++) {\r\n\t\t\t\t\tconst a = verticesCount + ix + gridX1 * iy;\r\n\t\t\t\t\tconst b = verticesCount + ix + gridX1 * (iy + 1);\r\n\t\t\t\t\tconst c = verticesCount + (ix + 1) + gridX1 * (iy + 1);\r\n\t\t\t\t\tconst d = verticesCount + (ix + 1) + gridX1 * iy;\r\n\t\t\t\t\t// indices.push(a, b, d);\r\n\t\t\t\t\t// indices.push(b, c, d);\r\n\t\t\t\t\tindices.push(a, b, d, c);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tverticesCount += index;\r\n\t\t});\r\n\t\t\r\n\t\tconst {length: indicesCount} = indices;\r\n\t\tconst verticesArray: number[] = [];\r\n\t\tconst uvsArray: number[][] = [];\r\n\t\tfor (let i = 0; i < indicesCount; i += 4) {\r\n\t\t\tconst vi1 = 3 * indices[i], vi2 = 3 * indices[i + 1], vi3 = 3 * indices[i + 2], vi4 = 3 * indices[i + 3];\r\n\t\t\tconst ui1 = 2 * indices[i], ui2 = 2 * indices[i + 1], ui3 = 2 * indices[i + 2], ui4 = 2 * indices[i + 3];\r\n\t\t\tlet v1 = verticesArray[vi1], v2 = verticesArray[vi2], v3 = verticesArray[vi3], v4 = verticesArray[vi4];\r\n\t\t\tif (v1 === undefined) {\r\n\t\t\t\tv1 = builder.addVertex([vertices[vi1], vertices[vi1 + 1], vertices[vi1 + 2]]), verticesArray[vi1] = v1;\r\n\t\t\t}\r\n\t\t\tif (v2 === undefined) {\r\n\t\t\t\tv2 = builder.addVertex([vertices[vi2], vertices[vi2 + 1], vertices[vi2 + 2]]), verticesArray[vi2] = v2;\r\n\t\t\t}\r\n\t\t\tif (v3 === undefined) {\r\n\t\t\t\tv3 = builder.addVertex([vertices[vi3], vertices[vi3 + 1], vertices[vi3 + 2]]), verticesArray[vi3] = v3;\r\n\t\t\t}\r\n\t\t\t//\r\n\t\t\tif (v4 === undefined) {\r\n\t\t\t\tv4 = builder.addVertex([vertices[vi4], vertices[vi4 + 1], vertices[vi4 + 2]]), verticesArray[vi4] = v4;\r\n\t\t\t}\r\n\t\t\tlet uv1 = uvsArray[ui1], uv2 = uvsArray[ui2], uv3 = uvsArray[ui3], uv4 = uvsArray[ui4];\r\n\t\t\tif (uv1 === undefined) {\r\n\t\t\t\tuv1 = [uvs[ui1], uvs[ui1 + 1]], uvsArray[ui1] = uv1;\r\n\t\t\t}\r\n\t\t\tif (uv2 === undefined) {\r\n\t\t\t\tuv2 = [uvs[ui2], uvs[ui2 + 1]], uvsArray[ui2] = uv2;\r\n\t\t\t}\r\n\t\t\tif (uv3 === undefined) {\r\n\t\t\t\tuv3 = [uvs[ui3], uvs[ui3 + 1]], uvsArray[ui3] = uv3;\r\n\t\t\t}\r\n\t\t\t//\r\n\t\t\tif (uv4 === undefined) {\r\n\t\t\t\tuv4 = [uvs[ui4], uvs[ui4 + 1]], uvsArray[ui4] = uv4;\r\n\t\t\t}\r\n\t\t\t/*builder.addTriangleFace(v1, v2, v3, {\r\n\t\t\t\tuv: [uv1, uv2, uv3]\r\n\t\t\t});*/\r\n\t\t\tbuilder.addQuadFace(v1, v2, v3, v4, {\r\n\t\t\t\tuv: [uv1, uv2, uv3, uv4]\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\treturn builder;\r\n\t}\r\n}","import { GeometryBase } from \"../geometry\";\r\nimport { GeometryBuilder } from \"../GeometryBuilder\";\r\n\r\nexport { QuadGeometry };\r\n\r\nclass QuadGeometry extends GeometryBase {\r\n\twidth: number;\r\n\theight: number;\r\n\twidthSegments: number;\r\n\theightSegments: number;\r\n\r\n\tconstructor(properties?: {width?: number, height?: number, widthSegments?: number, heightSegments?: number}) {\r\n\t\tsuper();\r\n\t\tthis.width = properties?.width ?? 1;\r\n\t\tthis.height = properties?.height ?? 1;\r\n\t\tthis.widthSegments = properties?.widthSegments ?? 1;\r\n\t\tthis.heightSegments = properties?.heightSegments ?? 1;\r\n\t}\r\n\t\r\n\ttoBuilder(): GeometryBuilder {\r\n\t\tconst builder = new GeometryBuilder();\r\n\t\tconst {heightSegments, widthSegments, width, height} = this;\r\n\t\tconst widthHalf = width / 2;\r\n\t\tconst heightHalf = height / 2;\r\n\r\n\t\tconst gridX = Math.floor(widthSegments);\r\n\t\tconst gridY = Math.floor(heightSegments);\r\n\r\n\t\tconst gridX1 = gridX + 1;\r\n\t\tconst gridY1 = gridY + 1;\r\n\r\n\t\tconst segmentWidth = width / gridX;\r\n\t\tconst segmentHeight = height / gridY;\r\n\t\tconst indices = [];\r\n\t\tconst vertices = [];\r\n\t\tconst uvs = [];\r\n\r\n\t\tfor (let iy = 0; iy < gridY1; iy++) {\r\n\t\t\tconst y = iy * segmentHeight - heightHalf;\r\n\t\t\tfor (let ix = 0; ix < gridX1; ix++) {\r\n\t\t\t\tconst x = ix * segmentWidth - widthHalf;\r\n\t\t\t\tvertices.push(x, - y, 0);\r\n\t\t\t\tuvs.push(ix / gridX);\r\n\t\t\t\tuvs.push(1 - (iy / gridY));\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let iy = 0; iy < gridY; iy++) {\r\n\t\t\tfor (let ix = 0; ix < gridX; ix++) {\r\n\t\t\t\tconst a = ix + gridX1 * iy;\r\n\t\t\t\tconst b = ix + gridX1 * (iy + 1);\r\n\t\t\t\tconst c = (ix + 1) + gridX1 * (iy + 1);\r\n\t\t\t\tconst d = (ix + 1) + gridX1 * iy;\r\n\t\t\t\tindices.push(a, b, d);\r\n\t\t\t\tindices.push(b, c, d);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst {length: indicesCount} = indices;\r\n\t\tconst verticesArray: number[] = [];\r\n\t\tconst uvsArray: number[][] = [];\r\n\t\tfor (let i = 0; i < indicesCount; i += 3) {\r\n\t\t\tconst vi1 = 3 * indices[i], vi2 = 3 * indices[i + 1], vi3 = 3 * indices[i + 2];\r\n\t\t\tconst ui1 = 2 * indices[i], ui2 = 2 * indices[i + 1], ui3 = 2 * indices[i + 2];\r\n\t\t\tlet v1 = verticesArray[vi1], v2 = verticesArray[vi2], v3 = verticesArray[vi3];\r\n\t\t\tif (v1 == undefined) {\r\n\t\t\t\tv1 = builder.addVertex([vertices[vi1], vertices[vi1 + 1], vertices[vi1 + 2]]), verticesArray[vi1] = v1;\r\n\t\t\t}\r\n\t\t\tif (v2 == undefined) {\r\n\t\t\t\tv2 = builder.addVertex([vertices[vi2], vertices[vi2 + 1], vertices[vi2 + 2]]), verticesArray[vi2] = v2;\r\n\t\t\t}\r\n\t\t\tif (v3 == undefined) {\r\n\t\t\t\tv3 = builder.addVertex([vertices[vi3], vertices[vi3 + 1], vertices[vi3 + 2]]), verticesArray[vi3] = v3;\r\n\t\t\t}\r\n\t\t\tlet uv1 = uvsArray[ui1], uv2 = uvsArray[ui2], uv3 = uvsArray[ui3];\r\n\t\t\tif (uv1 == undefined) {\r\n\t\t\t\tuv1 = [uvs[ui1], uvs[ui1 + 1]], uvsArray[ui1] = uv1;\r\n\t\t\t}\r\n\t\t\tif (uv2 == undefined) {\r\n\t\t\t\tuv2 = [uvs[ui2], uvs[ui2 + 1]], uvsArray[ui2] = uv2;\r\n\t\t\t}\r\n\t\t\tif (uv3 == undefined) {\r\n\t\t\t\tuv3 = [uvs[ui3], uvs[ui3 + 1]], uvsArray[ui3] = uv3;\r\n\t\t\t}\r\n\t\t\tbuilder.addTriangleFace(v1, v2, v3, {\r\n\t\t\t\tuv: [uv1, uv2, uv3]\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\treturn builder;\r\n\t}\r\n}","import { Uniform, WebGLUniformUtilities } from \"./WebGLUniformUtilities\";\r\nimport { Buffer, BufferDataUsage } from \"./WebGLBufferUtilities\";\r\nimport { Program } from \"./WebGLProgramUtilities\";\r\n\r\nexport type UniformBlock = {\r\n    name: string;\r\n    blockIndex: number;\r\n    program: Program;\r\n    layout: Record<string, {\r\n        byteOffset: number;\r\n    }>;\r\n    blockSize: number;\r\n    bindingPoint?: number;\r\n    buffer?: UniformBuffer;\r\n}\r\n\r\nexport type UniformBlockProperties = {\r\n    buffer?: number;\r\n    uniforms?: Record<string, Uniform>;\r\n}\r\n\r\nexport type UniformBuffer = Buffer & {\r\n    bindingPoint?: number;\r\n    rangeOffset?: number;\r\n    rangeSize?: number;\r\n}\r\n\r\nexport type UniformBufferProperties = {\r\n    usage: BufferDataUsage;\r\n    data?: ArrayBuffer;\r\n}\r\n\r\nexport type UniformBlocksProperties = {\r\n    buffers: (UniformBuffer | UniformBufferProperties)[];\r\n    blocks: Record<string, {\r\n        buffer: number;\r\n        uniforms: Record<string, Uniform>;\r\n    }>;\r\n}\r\n\r\nexport class WebGLUniformBlockUtilities {\r\n\r\n    static #bindingPoints: Map<string, number> = new Map();\r\n\r\n    static getBindingPointsEntries(): IterableIterator<[string, number]> {\r\n        const bindingPoints = this.#bindingPoints;\r\n        return bindingPoints.entries();\r\n    }\r\n\r\n    static createUniformBlock(gl: WebGL2RenderingContext, program: Program, name: string): UniformBlock | null {\r\n        const {internalProgram} = program;\r\n\r\n        const blockIndex = gl.getUniformBlockIndex(internalProgram, name);\r\n        if (blockIndex === gl.INVALID_INDEX) {\r\n            console.error(`Block '${name}' does not identify a valid uniform block.`);\r\n            return null;\r\n        }\r\n\r\n        const blockSize = gl.getActiveUniformBlockParameter(internalProgram, blockIndex, gl.UNIFORM_BLOCK_DATA_SIZE);\r\n        const layout: UniformBlock[\"layout\"] = {};\r\n        const blockUniformsIndices = gl.getActiveUniformBlockParameter(internalProgram, blockIndex, gl.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES);\r\n        const activeUniformsOffsets = gl.getActiveUniforms(internalProgram, blockUniformsIndices, gl.UNIFORM_OFFSET);\r\n        activeUniformsOffsets.forEach((uniformOffset_i: number, i: number) => {\r\n            const uniformIndex = blockUniformsIndices[i];\r\n            const uniformInfo = gl.getActiveUniform(internalProgram, uniformIndex);\r\n            if (uniformInfo !== null) {\r\n                const {name} = uniformInfo;\r\n                layout[name] = {\r\n                    byteOffset: uniformOffset_i\r\n                };\r\n            }\r\n        });\r\n\r\n        return {\r\n            name,\r\n            blockIndex,\r\n            blockSize,\r\n            layout,\r\n            program\r\n        };\r\n    }\r\n\r\n    static createUniformBuffer(gl: WebGL2RenderingContext, byteLength: number, bind?: boolean, usage?: BufferDataUsage): UniformBuffer | null {\r\n        const internalBuffer = gl.createBuffer();\r\n        if (internalBuffer === null) {\r\n            return null;\r\n        }\r\n        \r\n        const target = gl.UNIFORM_BUFFER;\r\n        gl.bindBuffer(target, internalBuffer);\r\n\r\n        usage = usage ?? BufferDataUsage.STATIC_READ;\r\n        bind = bind ?? false;\r\n\r\n        const bindingPoint = bind ? this.lastBindingPoint++ : undefined;\r\n        \r\n        gl.bufferData(target, byteLength, usage);\r\n        \r\n        return {\r\n            internalBuffer,\r\n            byteLength,\r\n            bindingPoint,\r\n            target,\r\n            usage\r\n        };\r\n    }\r\n\r\n    static createRangedUniformBuffers(gl: WebGL2RenderingContext, blocks: UniformBlock[], bind?: boolean, usage?: BufferDataUsage): UniformBuffer[] | null {\r\n\r\n        const offsetAlignment = gl.getParameter(gl.UNIFORM_BUFFER_OFFSET_ALIGNMENT);\r\n        const bufferByteLength = blocks.reduce(\r\n            (size, block) => size + Math.max(Math.ceil(block.blockSize / offsetAlignment), 1) * offsetAlignment, 0\r\n        );\r\n        \r\n        const buffer = this.createUniformBuffer(gl, bufferByteLength, false, usage);\r\n        if (buffer === null) {\r\n            return null;\r\n        }\r\n        \r\n        bind = bind ?? false;\r\n\r\n        let rangeOffset = 0;\r\n        const rangedUniformBuffers = blocks.map((block) => {\r\n            const {blockSize: rangeSize} = block;\r\n            const bindingPoint = bind ? this.lastBindingPoint++ : undefined;\r\n            const rangedUniformBuffer = {\r\n                ...buffer,\r\n                bindingPoint,\r\n                rangeOffset,\r\n                rangeSize\r\n            };\r\n            rangeOffset += Math.max(Math.ceil(rangeSize / offsetAlignment), 1) * offsetAlignment;\r\n            return rangedUniformBuffer;\r\n        });\r\n\r\n        return rangedUniformBuffers;\r\n    }\r\n\r\n    static setUniformBufferValues(gl: WebGL2RenderingContext, block: UniformBlock, buffer: UniformBuffer, uniforms: Record<string, Uniform>): void {\r\n        const {internalBuffer, target} = buffer;\r\n        const currentUniformBuffer = gl.getParameter(gl.UNIFORM_BUFFER_BINDING);\r\n        if (currentUniformBuffer !== internalBuffer) {\r\n            gl.bindBuffer(target, internalBuffer);\r\n        }\r\n        \r\n        const {layout, name} = block;\r\n        const {rangeOffset} = buffer;\r\n        Object.entries(uniforms).forEach(([uniformName, uniform]) => {\r\n            const {value} = uniform;\r\n            if (!(uniformName in layout)) {\r\n                console.warn(`${uniformName} does not exist in block ${name}.`);\r\n            }\r\n            const {byteOffset} = layout[uniformName];\r\n            gl.bufferSubData(target, byteOffset + (rangeOffset ?? 0), WebGLUniformUtilities.asArrayBufferView(value));\r\n        });\r\n    }\r\n\r\n    static setUniformBufferData(gl: WebGL2RenderingContext, buffer: UniformBuffer, data: ArrayBuffer | ArrayBufferView, dstByteOffset?: number, srcOffset?: number, length?: number): void {\r\n        const {internalBuffer, target} = buffer;\r\n        let {rangeOffset} = buffer;\r\n        gl.bindBuffer(target, internalBuffer);\r\n        const byteOffset = (rangeOffset ?? 0) + (dstByteOffset ?? 0);\r\n        if (data instanceof ArrayBuffer) {\r\n            gl.bufferSubData(target, byteOffset, data);\r\n        }\r\n        else {\r\n            srcOffset = srcOffset ?? 0;\r\n            gl.bufferSubData(target, byteOffset, data, srcOffset, length);\r\n        }\r\n    }\r\n\r\n    static lastBindingPoint = 0;\r\n\r\n    static bindUniformBuffer(gl: WebGL2RenderingContext, block: UniformBlock, buffer: UniformBuffer): void {\r\n        const {internalBuffer, target} = buffer;\r\n        let {rangeOffset, rangeSize} = buffer;\r\n        const {bindingPoint} = buffer;\r\n        const {program, blockIndex} = block;\r\n        const {internalProgram} = program;\r\n\r\n        if (bindingPoint !== undefined) {\r\n            block.buffer = buffer;\r\n            gl.uniformBlockBinding(internalProgram, blockIndex, bindingPoint);\r\n            \r\n            if (bindingPoint !== undefined) {\r\n                if (rangeOffset !== undefined && rangeSize !== undefined) {\r\n                    gl.bindBufferRange(target, bindingPoint, internalBuffer, rangeOffset, rangeSize);\r\n                }\r\n                else {\r\n                    gl.bindBufferBase(target, bindingPoint, internalBuffer);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import { VertexArray, VertexArrayValues, VertexArrayProperties, WebGLVertexArrayUtilities, DrawMode } from \"./WebGLVertexArrayUtilities\"\r\nimport { Texture, TextureProperties, WebGLTextureUtilities } from \"./WebGLTextureUtilities\"\r\nimport { UniformBlock, UniformBlockProperties, UniformBuffer, UniformBufferProperties, WebGLUniformBlockUtilities } from \"./WebGLUniformBlockUtilities\"\r\nimport { Uniform, UniformsListSetter, WebGLUniformUtilities } from \"./WebGLUniformUtilities\"\r\nimport { Program, ProgramProperties, WebGLProgramUtilities } from \"./WebGLProgramUtilities\"\r\n\r\nexport type PacketProperties = {\r\n    program: ProgramProperties | Program;\r\n    vertexArray: VertexArrayProperties;\r\n    uniformBuffers?: (UniformBufferProperties | UniformBuffer)[];\r\n    uniformBlocks?: Record<string, UniformBlockProperties>;\r\n    uniforms?: Record<string, Uniform>;\r\n    drawCommand: {\r\n        mode: DrawMode;\r\n        elementsCount?: number;\r\n        instanceCount?: number;\r\n        multiDraw?: {\r\n            firstsList?: Iterable<number> | Int32Array;\r\n            firstsOffset?: number;\r\n            countsList?: Iterable<number> | Int32Array;\r\n            countsOffset?: number;\r\n            offsetsList?: Iterable<number> | Int32Array;\r\n            offsetsOffset?: number;\r\n            instanceCountsList?: Iterable<number> | Int32Array;\r\n            instanceCountsOffset?: number;\r\n            drawCount?: number;\r\n        }\r\n    }\r\n}\r\n\r\nexport type PacketValues = {\r\n    vertexArray?: VertexArrayValues;\r\n    uniforms?: Record<string, Uniform>;\r\n    uniformBlocks?: Record<string, {\r\n        uniforms: Record<string, Uniform>;\r\n    }>;\r\n}\r\n\r\nexport type Packet = {\r\n    program: Program;\r\n    vertexArray: VertexArray;\r\n    uniforms?: UniformsListSetter;\r\n    uniformBlocks?: Record<string, UniformBlock>;\r\n    drawCommand: PacketDrawCommand;\r\n}\r\n\r\nexport interface PacketDrawCommand {\r\n    mode: DrawMode;\r\n    elementsCount?: number;\r\n    instanceCount?: number;\r\n    multiDraw?: {\r\n        firstsList?: Iterable<number> | Int32Array;\r\n        firstsOffset?: number;\r\n        countsList?: Iterable<number> | Int32Array;\r\n        countsOffset?: number;\r\n        offsetsList?: Iterable<number> | Int32Array;\r\n        offsetsOffset?: number;\r\n        instanceCountsList?: Iterable<number> | Int32Array;\r\n        instanceCountsOffset?: number;\r\n        drawCount?: number;\r\n    };\r\n}\r\n\r\nexport class WebGLPacketUtilities {\r\n\r\n    static createTextures(gl: WebGL2RenderingContext, textures: Record<string, TextureProperties>): Record<string, Texture> {\r\n        const _textures: {\r\n            [key: string]: Texture\r\n        } = {};\r\n        Object.entries(textures).forEach(([name, properties]) => {\r\n            const texture = WebGLTextureUtilities.createTexture(gl, name, properties);\r\n            if (texture !== null) {\r\n                _textures[name] = texture;\r\n            }\r\n        });\r\n        return _textures;\r\n    }\r\n    \r\n    static createPacket(gl: WebGL2RenderingContext, packet: PacketProperties): Packet | null {\r\n        const {program: programProperties, vertexArray: vertexArrayProperties, uniforms: uniformsProperties, uniformBlocks: uniformBlocksProperties, uniformBuffers: uniformBuffersProperties} = packet;\r\n        const {drawCommand} = packet;\r\n\r\n        let program: Program | null = null;\r\n        if (\"internalProgram\" in programProperties) {\r\n            program = programProperties;\r\n        }\r\n        else {\r\n            program = WebGLProgramUtilities.createProgram(gl, programProperties);\r\n        }\r\n        if (program === null) {\r\n            return null;\r\n        }\r\n        \r\n        let vertexArray: VertexArray | null = null;\r\n        vertexArray = WebGLVertexArrayUtilities.createVertexArray(gl, program, vertexArrayProperties);\r\n        if (vertexArray === null) {\r\n            return null;\r\n        }\r\n      \r\n        let uniforms: UniformsListSetter | null | undefined = undefined;\r\n        if (uniformsProperties !== undefined) {\r\n            uniforms = WebGLUniformUtilities.getUniformsListSetter(gl, program, uniformsProperties);\r\n            if (uniforms === null) {\r\n                return null;\r\n            }\r\n            WebGLUniformUtilities.setUniformsListValues(gl, uniforms, uniformsProperties);\r\n        }\r\n\r\n        let uniformBlocks: Record<string, UniformBlock> = {};\r\n        const uniformBlocksPropertiesEntries = uniformBlocksProperties ? Object.entries(uniformBlocksProperties) : [];\r\n        const uniformBuffersMaxIndex = (uniformBuffersProperties?.length ?? 0) - 1;\r\n        uniformBlocksPropertiesEntries.forEach(([_, uniformBlockProperty]) => {\r\n            const {buffer} = uniformBlockProperty;\r\n            if (buffer !== undefined && buffer > uniformBuffersMaxIndex) {\r\n                console.error(`Uniform buffer with index ${buffer} does not exist.`);\r\n            }\r\n        });\r\n        if (uniformBuffersProperties) {\r\n            uniformBuffersProperties.forEach(\r\n                (uniformBuffersProperty_i, i) => {\r\n                    const relatedBlockProperties = uniformBlocksPropertiesEntries.filter(\r\n                        ([_, uniformBlockProperty]) => uniformBlockProperty.buffer === i\r\n                    );\r\n                    const relatedBlocks = <UniformBlock[]>relatedBlockProperties.map(\r\n                        ([blockName, _]) => WebGLUniformBlockUtilities.createUniformBlock(gl, program!, blockName)\r\n                    );\r\n                    const {length: relatedBlocksCount} = relatedBlocks;        \r\n                    if (\"internalBuffer\" in uniformBuffersProperty_i) {\r\n                        relatedBlocks.forEach((block_i) => {\r\n                            const {name} = block_i!;\r\n                            WebGLUniformBlockUtilities.bindUniformBuffer(gl, block_i!, uniformBuffersProperty_i);\r\n                            uniformBlocks[name] = block_i!;\r\n                        });\r\n                    }\r\n                    else {\r\n                        if (relatedBlocksCount > 0) {\r\n                            const {usage, data} = uniformBuffersProperty_i;\r\n                            if (relatedBlocksCount > 1) {\r\n                                const rangedBuffers = WebGLUniformBlockUtilities.createRangedUniformBuffers(gl, <UniformBlock[]>relatedBlocks, true, usage)!;\r\n                                if (data) {\r\n                                    WebGLUniformBlockUtilities.setUniformBufferData(gl, rangedBuffers[0], data);\r\n                                }\r\n                                relatedBlocks.forEach((block_i, i) => {\r\n                                    const {name} = block_i!;\r\n                                    const rangedBuffer = rangedBuffers[i];\r\n                                    WebGLUniformBlockUtilities.bindUniformBuffer(gl, block_i!, rangedBuffer);\r\n                                    const {uniforms} = relatedBlockProperties[i][1];\r\n                                    if (uniforms) {\r\n                                        WebGLUniformBlockUtilities.setUniformBufferValues(gl, block_i, rangedBuffer, uniforms);\r\n                                    }\r\n                                    uniformBlocks[name] = block_i!;\r\n                                });\r\n                            }\r\n                            else {\r\n                                const relatedBlock = relatedBlocks[0];\r\n                                const {blockSize, name} = relatedBlock;\r\n                                const buffer = WebGLUniformBlockUtilities.createUniformBuffer(gl, blockSize, true, usage);\r\n                                if (buffer === null) {\r\n                                    return null;\r\n                                }\r\n                                if (data) {\r\n                                    WebGLUniformBlockUtilities.setUniformBufferData(gl, buffer, data);\r\n                                }\r\n                                WebGLUniformBlockUtilities.bindUniformBuffer(gl, relatedBlock!, buffer!);\r\n                                const {uniforms} = relatedBlockProperties[0][1];\r\n                                if (uniforms) {\r\n                                    WebGLUniformBlockUtilities.setUniformBufferValues(gl, relatedBlock, buffer, uniforms);\r\n                                }\r\n                                uniformBlocks[name] = relatedBlock!;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            );\r\n        }\r\n        const remainingBlockProperties = uniformBlocksPropertiesEntries.filter(\r\n            ([_, uniformBlockProperty]) => uniformBlockProperty.buffer === undefined\r\n        );\r\n        remainingBlockProperties.forEach(([blockName, uniformBlockProperties]) => {\r\n            const {uniforms} = uniformBlockProperties;\r\n            const block = WebGLUniformBlockUtilities.createUniformBlock(gl, program!, blockName);\r\n            if (block === null) {\r\n                return null;\r\n            }\r\n            const {blockSize} = block;\r\n            const buffer = WebGLUniformBlockUtilities.createUniformBuffer(gl, blockSize, true);\r\n            if (buffer === null) {\r\n                return null;\r\n            }\r\n            WebGLUniformBlockUtilities.bindUniformBuffer(gl, block, buffer);\r\n            if (uniforms !== undefined) {\r\n                WebGLUniformBlockUtilities.setUniformBufferValues(gl, block, buffer, uniforms);\r\n            }\r\n            uniformBlocks[blockName] = block;\r\n        });\r\n\r\n        return {\r\n            program,\r\n            vertexArray,\r\n            uniforms,\r\n            uniformBlocks,\r\n            drawCommand\r\n        };\r\n    }\r\n\r\n    static setPacketValues(gl: WebGL2RenderingContext, packet: Packet, values: PacketValues): void {\r\n        const {vertexArray: vertexArrayValues, uniforms: uniformsValues, uniformBlocks: uniformsBlocksValues} = values;\r\n        const {vertexArray, uniforms, uniformBlocks} = packet;\r\n\r\n        if (vertexArrayValues !== undefined) {\r\n            WebGLVertexArrayUtilities.setVertexArrayValues(gl, vertexArray, vertexArrayValues);\r\n        }\r\n        if (uniforms !== undefined && uniformsValues !== undefined) {\r\n            WebGLUniformUtilities.setUniformsListValues(gl, uniforms, uniformsValues);\r\n        }\r\n        if (uniformBlocks !== undefined && uniformsBlocksValues !== undefined) {\r\n            const uniformBlocksValuesEntries = uniformsBlocksValues ? Object.entries(uniformsBlocksValues) : [];\r\n            uniformBlocksValuesEntries.forEach(([blockName, uniformBlock]) => {\r\n                const {uniforms} = uniformBlock;\r\n                const block = uniformBlocks[blockName];\r\n                const {buffer} = block;\r\n                if (buffer) {\r\n                    WebGLUniformBlockUtilities.setUniformBufferValues(gl, block, buffer, uniforms);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    static #multiDrawExtension: WEBGL_multi_draw | null = null;\r\n\r\n    static enableMultidrawExtension(gl: WebGL2RenderingContext) {\r\n        this.#multiDrawExtension = gl.getExtension(\"WEBGL_multi_draw\");\r\n    }\r\n\r\n    static drawPacket(gl: WebGL2RenderingContext, packet: Packet, drawCommand: PacketDrawCommand = packet.drawCommand): void {\r\n        const {vertexArray} = packet;\r\n        const {program, internalVertexArray, elementBuffer} = vertexArray;\r\n        const {mode, elementsCount, instanceCount, multiDraw} = drawCommand;\r\n\r\n        WebGLProgramUtilities.useProgram(gl, program);\r\n        \r\n        const currentVertexArray = gl.getParameter(gl.VERTEX_ARRAY_BINDING);\r\n        if (currentVertexArray !== internalVertexArray) {\r\n            gl.bindVertexArray(internalVertexArray);\r\n        }\r\n        \r\n        if (elementBuffer) {\r\n            const {indexType} = elementBuffer;\r\n            if (instanceCount !== undefined && elementsCount !== undefined) {\r\n                gl.drawElementsInstanced(mode, elementsCount, indexType, 0, instanceCount);\r\n            }\r\n            else if (multiDraw) {\r\n                const multiDrawExtension = this.#multiDrawExtension!;\r\n                const {countsList, countsOffset, offsetsList, offsetsOffset, drawCount, instanceCountsList, instanceCountsOffset} = multiDraw;\r\n                if (instanceCountsList !== undefined && instanceCountsOffset !== undefined) {\r\n                    multiDrawExtension.multiDrawElementsInstancedWEBGL(\r\n                        mode, countsList!, countsOffset!, indexType!,\r\n                        offsetsList!, offsetsOffset!, instanceCountsList, instanceCountsOffset, drawCount!\r\n                    );\r\n                }\r\n                else {\r\n                    multiDrawExtension.multiDrawElementsWEBGL(\r\n                        mode, countsList!, countsOffset!, indexType!,\r\n                        offsetsList!, offsetsOffset!, drawCount!\r\n                    );\r\n                }\r\n            }\r\n            else if (elementsCount !== undefined) {\r\n                gl.drawElements(mode, elementsCount, indexType, 0);\r\n            }\r\n        }\r\n        else {\r\n            if (instanceCount !== undefined && elementsCount !== undefined) {\r\n                gl.drawArraysInstanced(mode, 0, elementsCount, instanceCount);\r\n            }\r\n            else if (multiDraw) {\r\n                const multiDrawExtension = this.#multiDrawExtension!;\r\n                const {countsList, countsOffset, firstsList, firstsOffset, drawCount, instanceCountsList, instanceCountsOffset} = multiDraw;\r\n                if (instanceCountsList !== undefined && instanceCountsOffset !== undefined) {\r\n                    multiDrawExtension.multiDrawArraysInstancedWEBGL(\r\n                        mode, firstsList!, firstsOffset!,\r\n                        countsList!, countsOffset!, instanceCountsList, instanceCountsOffset, drawCount!\r\n                    );\r\n                }\r\n                else {\r\n                    multiDrawExtension.multiDrawArraysWEBGL(\r\n                        mode, firstsList!, firstsOffset!, \r\n                        countsList!, countsOffset!, drawCount!\r\n                    );\r\n                }\r\n            }\r\n            else if (elementsCount !== undefined) {\r\n                gl.drawArrays(mode, 0, elementsCount);\r\n            }\r\n        }\r\n    }\r\n}","export { ColorValues };\r\nexport { Color };\r\n\r\ntype ColorValues = [number, number, number];\r\n\r\ninterface ColorConstructor {\r\n    readonly prototype: Color;\r\n    new(): Color;\r\n    new(r: number, g: number, b: number): Color;\r\n    new(r: number, g: number, b: number, a: number): Color;\r\n    readonly YELLOW: Color;\r\n    readonly BLACK: Color;\r\n    readonly RED: Color;\r\n    readonly GREEN: Color;\r\n    readonly BLUE: Color;\r\n    readonly WHITE: Color;\r\n    array(...colors: Color[]): number[];\r\n    lerp(a: Color, b: Color, t: number): Color;\r\n    rgb(r: number, g: number, b: number): Color;\r\n    rgba(rgb: Color): Color;\r\n    rgba(rgb: Color, a: number): Color;\r\n    rgba(r: number, g: number, b: number, a: number): Color;\r\n}\r\n\r\ninterface Color extends ArrayLike<number>, Iterable<number> {\r\n    readonly array: Float32Array;\r\n    readonly length: number;\r\n    0: number;\r\n    1: number;\r\n    2: number;\r\n    3: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n    a: number;\r\n    copy(color: Color): Color;\r\n    clone(): Color;\r\n    getValues(): ColorValues;\r\n    setValues(\r\n        r: number,\r\n        g: number,\r\n        b: number,\r\n        a?: number\r\n    ): Color;\r\n    lerp(color: Color, t: number): Color;\r\n    normalize(): Color;\r\n}\r\n\r\nclass ColorBase implements Color {\r\n    [index: number]: number;\r\n    readonly array: Float32Array;\r\n\r\n\tconstructor()\r\n    constructor(r: number, g: number, b: number)\r\n    constructor(r: number, g: number, b: number, a: number)\r\n    constructor(r?: number, g?: number, b?: number, a?: number) {\r\n\t\tthis.array = a !== undefined ? new Float32Array([\r\n            r ?? 0, g ?? 0, b ?? 0, a\r\n        ]) : new Float32Array([\r\n            r ?? 0, g ?? 0, b ?? 0\r\n        ]);\r\n    }\r\n    \r\n    static readonly BLACK = new ColorBase(0, 0, 0);\r\n    static readonly RED = new ColorBase(1, 0, 0);\r\n    static readonly YELLOW = new ColorBase(1, 1, 0);\r\n    static readonly GREEN = new ColorBase(0, 1, 0);\r\n    static readonly BLUE = new ColorBase(0, 0, 1);\r\n    static readonly WHITE = new ColorBase(1, 1, 1);\r\n\r\n    static rgb(r: number, g: number, b: number): Color {\r\n        return new Color(r, g, b);\r\n    }\r\n\r\n    static rgba(rgb: Color): Color;\r\n    static rgba(rgb: Color, a: number): Color;\r\n    static rgba(r: number, g: number, b: number, a: number): Color;\r\n    static rgba(rgbOrR: any, aOrG?: number, b?: number, a?: number): Color {\r\n        if (rgbOrR instanceof Color) {\r\n            const {r, g, b} = rgbOrR;\r\n            return aOrG !== undefined ?\r\n                new Color(r, g, b, aOrG) :\r\n                new Color(r, g, b, 1.0);\r\n        }\r\n        else {\r\n            return new Color(rgbOrR, aOrG!, b!, a!);\r\n        }\r\n    }\r\n\r\n    static array(...colors: Color[]): number[] {\r\n        const a = new Array<number>(colors.length * 4);\r\n        let c;\r\n        let i = 0;\r\n        for (const color of colors) {\r\n            c = color.array;\r\n            a[i + 0] = c[0];\r\n            a[i + 1] = c[1];\r\n            a[i + 2] = c[2];\r\n            i += 3;\r\n        }\r\n        return a;\r\n    }\r\n\r\n    get length(): number {\r\n        return 3;\r\n    }\r\n\r\n    get r(): number {\r\n        return this.array[0];\r\n    }\r\n\r\n    set r(r: number) {\r\n        this.array[0] = r;\r\n    }\r\n\r\n    get g(): number {\r\n        return this.array[1];\r\n    }\r\n\r\n    set g(g: number) {\r\n        this.array[1] = g;\r\n    }\r\n\r\n    get b(): number {\r\n        return this.array[2];\r\n    }\r\n\r\n    set b(b: number) {\r\n        this.array[2] = b;\r\n    }\r\n\r\n    get a(): number {\r\n        return this.array[3];\r\n    }\r\n\r\n    set a(a: number) {\r\n        this.array[3] = a;\r\n    }\r\n\r\n    get 0(): number {\r\n        return this.array[0];\r\n    }\r\n\r\n    set 0(r: number) {\r\n        this.array[0] = r;\r\n    }\r\n\r\n    get 1(): number {\r\n        return this.array[1];\r\n    }\r\n\r\n    set 1(g: number) {\r\n        this.array[1] = g;\r\n    }\r\n\r\n    get 2(): number {\r\n        return this.array[2];\r\n    }\r\n\r\n    set 2(b: number) {\r\n        this.array[2] = b;\r\n    }\r\n\r\n    get 3(): number {\r\n        return this.array[3];\r\n    }\r\n\r\n    set 3(a: number) {\r\n        this.array[3] = a;\r\n    }\r\n\r\n    setValues(r: number, g: number, b: number): this {\r\n\t\tconst {array} = this;\r\n\r\n\t\tarray[0] = r;\r\n\t\tarray[1] = g;\r\n\t\tarray[2] = b;\r\n\r\n\t\treturn this;\r\n    }\r\n    \r\n    getValues(): ColorValues {\r\n\t\tconst {array} = this;\r\n\t\t\r\n\t\treturn [\r\n\t\t\tarray[0], array[1], array[2]\r\n\t\t];\r\n\t}\r\n    \r\n    copy(color: Color): this {\r\n        const {array} = this;\r\n        const {r, g, b} = color;\r\n\r\n        array[0] = r;\r\n        array[1] = g;\r\n        array[2] = b;\r\n\r\n        return this;\r\n\t}\r\n\r\n\tclone(): this {\r\n\t\treturn <this>(new ColorBase()).copy(this);\r\n    }\r\n\r\n    static lerp(a: Color, b: Color, t: number): Color {\r\n\t\treturn a.lerp(b, t);\r\n\t}\r\n    \r\n    lerp(color: Color, t: number): this {\r\n        const {array} = this;\r\n        const {r, g, b} = color;\r\n\r\n\t\tarray[0] = t * (r - array[0]);\r\n\t\tarray[1] = t * (g - array[1]);\r\n\t\tarray[2] = t * (b - array[2]);\r\n\r\n\t\treturn this;\r\n\t}\r\n    \r\n\tnormalize(): this {\r\n\t\tconst {array} = this;\r\n\t\tconst length = 255;\r\n        array[0] /= length;\r\n        array[1] /= length;\r\n        array[2] /= length;\r\n\t\treturn this;\r\n\t}\r\n\r\n    [Symbol.iterator] (): Iterator<number> {\r\n\t\tconst {array} = this;\r\n\t\tconst {length} = array;\r\n\t\tlet i = 0;\r\n\t\treturn {\r\n\t\t\tnext() {\r\n\t\t\t\tif (i < length) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: array[i++], done: false\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: undefined, done: true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst Color: ColorConstructor = ColorBase;","import { IcosahedronGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/polyhedron/IcosahedronGeometry\";\r\nimport { ArcballCameraControl } from \"../../engine/core/controls/ArcballCameraControl\";\r\nimport { FreeCameraControl } from \"../../engine/core/controls/FreeCameraControl\";\r\nimport { Transform } from \"../../engine/core/general/Transform\";\r\nimport { Input } from \"../../engine/core/input/Input\";\r\nimport { PerspectiveCamera } from \"../../engine/core/rendering/scenes/cameras/PerspectiveCamera\";\r\nimport { GeometryBuffer } from \"../../engine/core/rendering/scenes/geometries/GeometryBuffer\";\r\nimport { CubeGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/polyhedron/CubeGeometry\";\r\nimport { QuadGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/QuadGeometry\";\r\nimport { BufferDataUsage } from \"../../engine/core/rendering/webgl/WebGLBufferUtilities\";\r\nimport { FramebufferAttachment, FramebufferTextureTarget, RenderbufferPixelFormat, WebGLFramebufferUtilities } from \"../../engine/core/rendering/webgl/WebGLFramebufferUtilities\";\r\nimport { WebGLPacketUtilities, PacketProperties, PacketValues } from \"../../engine/core/rendering/webgl/WebGLPacketUtilities\";\r\nimport { WebGLProgramUtilities } from \"../../engine/core/rendering/webgl/WebGLProgramUtilities\";\r\nimport { BlendingEquation, BlendingMode, BufferMask, Capabilities, TestFunction, WebGLRendererUtilities, WindingOrder } from \"../../engine/core/rendering/webgl/WebGLRendererUtilities\";\r\nimport { TexturePixelFormat, TexturePixelType, TextureMagFilter, TextureMinFilter, TextureTarget, TextureWrapMode, WebGLTextureUtilities, TextureInternalPixelFormat } from \"../../engine/core/rendering/webgl/WebGLTextureUtilities\";\r\nimport { WebGLUniformBlockUtilities } from \"../../engine/core/rendering/webgl/WebGLUniformBlockUtilities\";\r\nimport { AttributeDataType, DataComponentType, DrawMode, WebGLVertexArrayUtilities } from \"../../engine/core/rendering/webgl/WebGLVertexArrayUtilities\";\r\nimport { Color } from \"../../engine/libs/graphics/colors/Color\";\r\nimport { Matrix4 } from \"../../engine/libs/maths/algebra/matrices/Matrix4\";\r\nimport { Quaternion } from \"../../engine/libs/maths/algebra/quaternions/Quaternion\";\r\nimport { Vector3, Vector3Values } from \"../../engine/libs/maths/algebra/vectors/Vector3\";\r\nimport { Space } from \"../../engine/libs/maths/geometry/space/Space\";\r\nimport { addWidgets, createPositionWidgets, createRelativePositionWidgets, createRotationWidgets } from \"./Common\";\r\nimport { SphereGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/SphereGeometry\";\r\nimport { CylinderGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/polyhedron/CylinderGeometry\";\r\nimport { DodecahedronGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/polyhedron/DodecahedronGeometry\";\r\nimport { HTMLEToolBarElement, HTMLEToolBarItemElement } from \"editor/lib/elements/containers/toolbars\";\r\n\r\nconst simpleSceneDOM = /*html*/`\r\n<!--<link rel=\"stylesheet\" href=\"./css/main.css\"/>-->\r\n  <div class=\"flex-auto flex-cols\">\r\n    <main class=\"flex-rows flex-auto\">\r\n        <section class=\"centered padded\">\r\n          <div id=\"canvas-container\" style=\"position: relative;\">\r\n            <canvas id=\"canvas\" tabindex=\"0\" oncontextmenu=\"return false;\"></canvas>\r\n            <canvas id=\"canvas-2d\" tabindex=\"0\" style=\"display: block; position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;\"></canvas>\r\n          </div>\r\n          <!--\r\n          <style>\r\n            circle:hover {\r\n              fill: rgb(255, 0, 0);\r\n            }\r\n          </style>\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" width=\"100\" height=\"100\">\r\n            <circle cx=\"10\" cy=\"10\" r=\"4\"/>\r\n          </svg>\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 200 200\" width=\"200\" height=\"200\" id=\"save\" fill=\"none\">\r\n            <g>\r\n              <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"red\"></rect>\r\n              <text text-anchor=\"middle\" alignment-baseline=\"middle\" x=\"50\" y=\"50\" font-family=\"Verdana\" fill=\"blue\">Hello,World!</text>\r\n            </g>\r\n          </svg>\r\n          -->\r\n        </section>\r\n    </main>\r\n  </div>`;\r\n\r\nexport async function start() {\r\n  const template = document.createElement(\"template\");\r\n  template.innerHTML = simpleSceneDOM;\r\n  document.body.insertBefore(template.content, document.body.firstChild);\r\n\r\n  /*let onCapture = false;\r\n  const handlePointerUpEvent = (event: PointerEvent) => {\r\n    const {target, pointerId} = event;\r\n    if (target instanceof Element && target.tagName == \"circle\") {\r\n      (<Element>target).releasePointerCapture(pointerId);\r\n      onCapture = false;\r\n    }\r\n  }\r\n  const handlePointerDownEvent = (event: PointerEvent) => {\r\n    const {target, pointerId} = event;\r\n    if (target instanceof Element && target.tagName == \"circle\") {\r\n      (<Element>target).setPointerCapture(pointerId);\r\n      onCapture = true;\r\n    }\r\n  }\r\n  const handlePointerOutEvent = (event: PointerEvent) => {\r\n    const {target, pointerId} = event;\r\n    if (target instanceof Element && target.tagName == \"circle\") {\r\n      (<Element>target).releasePointerCapture(pointerId);\r\n      onCapture = false;\r\n    }\r\n  }\r\n  const handlePointerMoveEvent = (event: PointerEvent) => {\r\n    if (onCapture) {\r\n      const {currentTarget, clientX, clientY} = event;\r\n      const svg = <Element>currentTarget;\r\n      const {\r\n        right: svgRight, left: svgLeft, width: svgWidth,\r\n        bottom: svgBottom, top: svgTop, height: svgHeight\r\n      } = svg.getBoundingClientRect();\r\n      const {target} = event;\r\n      const targetElement = <Element>target;\r\n      const [viewMinX, viewMinY, viewMaxX, viewMaxY] = svg.getAttribute(\"viewBox\")!.split(\" \").map(value => parseFloat(value));\r\n      const offsetX = (Math.min(svgRight, Math.max(clientX, svgLeft)) - svgLeft) / svgWidth;\r\n      const offsetY = (Math.min(svgBottom, Math.max(clientY, svgTop)) - svgTop) / svgHeight;\r\n      const newTargetX = Math.round(offsetX * (viewMaxX - viewMinX));\r\n      const newTargetY = Math.round(offsetY * (viewMaxY - viewMinY));\r\n      targetElement.setAttribute(\"cx\", `${newTargetX}`);\r\n      targetElement.setAttribute(\"cy\", `${newTargetY}`);\r\n    }\r\n  }\r\n  const svg = document.querySelector(\"svg\");\r\n  svg!.addEventListener(\"pointerdown\", handlePointerDownEvent);\r\n  svg!.addEventListener(\"pointermove\", handlePointerMoveEvent);\r\n  svg!.addEventListener(\"pointerup\", handlePointerUpEvent);\r\n  svg!.addEventListener(\"pointerout\", handlePointerOutEvent);*/\r\n\r\n  try {\r\n    launchScene();\r\n  }\r\n  catch (e) {\r\n    console.trace(e);\r\n  }\r\n}\r\n/*\r\nlet file: File | undefined;\r\nconst input = document.createElement(\"input\");\r\ninput.type = \"file\";\r\ndocument.body.append(input);\r\ninput.addEventListener(\"input\", () => {\r\n  file = input.files![0];\r\n  launchScene();\r\n});\r\n*/\r\nexport async function launchScene() {\r\n  let render: (time: number) => void;\r\n  let fps: number = 0;\r\n  let playing = false;\r\n\r\n  const toolbar = document.querySelector<HTMLEToolBarElement>(\"e-toolbar\");/*getElementById('playpause') as HTMLButtonElement;*/\r\n  if (toolbar !== null) {\r\n    toolbar.onclick = (event) => {\r\n      const item = (<Element>event.target).closest(\"e-toolbaritem\");\r\n      if (item) {\r\n        switch (item.name) {\r\n          case \"play-pause\": {\r\n            playing = item.pressed;\r\n            if (playing) {\r\n              requestAnimationFrame(render);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  const canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\r\n  if (!canvas) {\r\n    return;\r\n  }\r\n\r\n  const canvas2D = document.getElementById(\"canvas-2d\") as HTMLCanvasElement;\r\n  if (!canvas2D) {\r\n    return;\r\n  }\r\n\r\n  const ctx = canvas2D.getContext(\"2d\");\r\n  if (!ctx) {\r\n    return;\r\n  }\r\n  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\r\n  \r\n  const CANVAS_WIDTH = 900;\r\n  const CANVAS_HEIGHT = 600;\r\n  const supersamplingRatio = 1;\r\n  canvas.width = CANVAS_WIDTH * supersamplingRatio;\r\n  canvas.height = CANVAS_HEIGHT * supersamplingRatio;\r\n  canvas.style.width = `${CANVAS_WIDTH}px`;\r\n  canvas.style.height = `${CANVAS_HEIGHT}px`;\r\n\r\n  canvas2D.width = CANVAS_WIDTH;\r\n  canvas2D.height = CANVAS_HEIGHT;\r\n  canvas2D.style.width = `${CANVAS_WIDTH}px`;\r\n  canvas2D.style.height = `${CANVAS_HEIGHT}px`;\r\n  \r\n  const gl = canvas.getContext(\"webgl2\");\r\n  if (!gl) {\r\n    return;\r\n  }\r\n\r\n  WebGLTextureUtilities.setUnpackAlignment(gl, 1);\r\n\r\n  // Shaders\r\n  const phongVert = await fetch(\"assets/engine/shaders/common/phong.vert.glsl\").then(resp => resp.text());\r\n  const phongFrag = await fetch(\"assets/engine/shaders/common/phong.frag.glsl\").then(resp => resp.text());\r\n  const phongProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: phongVert, fragmentSource: phongFrag});\r\n  if (phongProgram === null) return;\r\n\r\n  const skyboxVert = await fetch(\"assets/engine/shaders/common/skybox.vert\").then(resp => resp.text());\r\n  const skyboxFrag = await fetch(\"assets/engine/shaders/common/skybox.frag\").then(resp => resp.text());\r\n  const skyboxProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: skyboxVert, fragmentSource: skyboxFrag});\r\n  if (skyboxProgram === null) return;\r\n  \r\n  const textureVert = await fetch(\"assets/engine/shaders/common/texture.vert\").then(resp => resp.text());\r\n  const textureFrag = await fetch(\"assets/engine/shaders/common/texture.frag\").then(resp => resp.text());\r\n  const texProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: textureVert, fragmentSource: textureFrag});\r\n  if (texProgram === null) return;\r\n\r\n  const basicVert = await fetch(\"assets/engine/shaders/common/basic.vert.glsl\").then(resp => resp.text());\r\n  const basicFrag = await fetch(\"assets/engine/shaders/common/basic.frag.glsl\").then(resp => resp.text());\r\n  const basicProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: basicVert, fragmentSource: basicFrag});\r\n  if (basicProgram === null) return;\r\n  \r\n  const depthVert = await fetch(\"assets/engine/shaders/common/depth.vert.glsl\").then(resp => resp.text());\r\n  const depthFrag = await fetch(\"assets/engine/shaders/common/depth.frag.glsl\").then(resp => resp.text());\r\n  const depthProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: depthVert, fragmentSource: depthFrag});\r\n  if (depthProgram === null) return;\r\n\r\n  const linesVertex = await fetch(\"assets/engine/shaders/common/lines.vert.glsl\").then(resp => resp.text());\r\n  const linesFragment = await fetch(\"assets/engine/shaders/common/lines.frag.glsl\").then(resp => resp.text());\r\n  const linesProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: linesVertex, fragmentSource: linesFragment});\r\n  if (linesProgram === null) return;\r\n\r\n  async function fetchImage(url: string) {\r\n    return fetch(url).then((resp) => {\r\n      if (resp.ok) {\r\n        return new Promise<HTMLImageElement>((resolve) => {\r\n          const img = new Image();\r\n          img.onload = () => {\r\n            resolve(img);\r\n          };\r\n          img.src = url;\r\n        })\r\n      }\r\n      else {\r\n        throw new Error(`Image '${url}' not found.`);\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Images\r\n  const albedoMapImg = await fetchImage(\"assets/engine/img/NormalMap.png\");\r\n  const brickwallImg = await fetchImage(\"assets/engine/img/brickwall.jpg\");\r\n  const normalMapImg = await fetchImage(\"assets/engine/img/NormalMap_0.png\");\r\n  const normalMap2Img = await fetchImage(\"assets/engine/img/Normal_Map_1024.png\");\r\n  const displacementMapImg = await fetchImage(\"assets/engine/img/DisplacementMap.png\");\r\n  const skyboxXPosImg = await fetchImage(\"assets/engine/img/skybox_x_pos.png\");\r\n  const skyboxXNegImg = await fetchImage(\"assets/engine/img/skybox_x_neg.png\");\r\n  const skyboxYPosImg = await fetchImage(\"assets/engine/img/skybox_y_pos.png\");\r\n  const skyboxYNegImg = await fetchImage(\"assets/engine/img/skybox_y_neg.png\");\r\n  const skyboxZPosImg = await fetchImage(\"assets/engine/img/skybox_z_pos.png\");\r\n  const skyboxZNegImg = await fetchImage(\"assets/engine/img/skybox_z_neg.png\");\r\n  const colorsImg = await fetchImage(\"assets/engine/img/colors.png\");\r\n\r\n  const PADDING = 1;\r\n\r\n  const paddedImage = function(image: HTMLImageElement) {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const {width, height} = image;\r\n    const paddedWidth = width + PADDING * 2;\r\n    const paddedHeight = height + PADDING * 2;\r\n    canvas.width = paddedWidth;\r\n    canvas.height = paddedHeight;\r\n    const ctx = canvas.getContext(\"2d\")!;\r\n    // Draws upper and lower extensions\r\n    /*ctx.drawImage(image, 0, 0, width, 1, 0, 0, paddedWidth, 1);\r\n    ctx.drawImage(image, 0, height - 1, width, 1, 0, height + 1, paddedWidth, 1);\r\n    // Draws left and right extensions\r\n    ctx.drawImage(image, 0, 0, 1, height, 0, 0, 1, paddedHeight);\r\n    ctx.drawImage(image, width - 1, 0, 1, height, width + 1, 0, 1, paddedHeight);*/\r\n    \r\n    // Draws original image\r\n    ctx.drawImage(image, 0, 0, paddedWidth, paddedHeight);\r\n    ctx.drawImage(image, PADDING, PADDING, width, height);\r\n    const data = ctx.getImageData(0, 0, paddedWidth, paddedHeight);\r\n    /*document.body.append(image);\r\n    const img = new Image();\r\n    img.src = canvas.toDataURL();\r\n    document.body.append(img);*/\r\n    return {\r\n      width,\r\n      height,\r\n      paddedWidth,\r\n      paddedHeight, \r\n      data\r\n    };\r\n  }\r\n\r\n  const paddedBrickwallImg = paddedImage(brickwallImg);\r\n  const paddedAlbedoMapImg = paddedImage(albedoMapImg);\r\n  const paddedNormalMap2 = paddedImage(normalMap2Img);\r\n  const paddedColorsImg = paddedImage(colorsImg);\r\n  /*const norm16Extension = gl.getExtension(\"EXT_texture_norm16\");\r\n  if (norm16Extension) {\r\n    console.log(`Extension EXT_texture_norm16 activated.`);\r\n  }*/\r\n\r\n  const textures = WebGLPacketUtilities.createTextures(gl, {\r\n    // albedoMap: {\r\n    //   pixels: albedoMapImg,\r\n    //   width: albedoMapImg.width, height: albedoMapImg.height,\r\n    //   target: TextureTarget.TEXTURE_2D,\r\n    //   type: TexturePixelType.UNSIGNED_BYTE,\r\n    //   format: TexturePixelFormat.RGB,\r\n    //   internalFormat: TextureInternalPixelFormat.RGB,\r\n\r\n    //   min: TextureMinFilter.NEAREST,\r\n    //   mag: TextureMagFilter.NEAREST,\r\n    // },\r\n    albedoMap: {\r\n      pixels: null,\r\n      width: 8, height: 8, depth: 2,\r\n      // pixels: albedoMapImg,\r\n      // width: albedoMapImg.width, height: albedoMapImg.height,\r\n      target: TextureTarget.TEXTURE_2D_ARRAY,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n\r\n      /*wrapS: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapT: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapR: TextureWrapMode.CLAMP_TO_EDGE,*/\r\n\r\n      format: TexturePixelFormat.LUMINANCE,\r\n      internalFormat: TextureInternalPixelFormat.LUMINANCE,\r\n\r\n      // format: TexturePixelFormat.RGB,\r\n      // internalFormat: TextureInternalPixelFormat.RGB\r\n\r\n      min: TextureMinFilter.NEAREST,\r\n      mag: TextureMagFilter.NEAREST,\r\n\r\n      subimages: [\r\n        {\r\n          pixels: new Uint8Array([\r\n            0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC,\r\n            0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF,\r\n            0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC,\r\n            0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF,\r\n            0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC,\r\n            0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF,\r\n            0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC,\r\n            0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF,\r\n          ]),\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 0,\r\n          width: 8,\r\n          height: 8,\r\n          depth: 1\r\n        },\r\n        {\r\n          pixels: new Uint8Array([\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n          ]),\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 1,\r\n          width: 8,\r\n          height: 8,\r\n          depth: 1\r\n        }\r\n      ]\r\n    },\r\n    albedoMaps: {\r\n      pixels: null,\r\n      width: paddedBrickwallImg.paddedWidth, height: paddedBrickwallImg.paddedHeight, depth: 4,\r\n      target: TextureTarget.TEXTURE_2D_ARRAY,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGB,\r\n      internalFormat: TextureInternalPixelFormat.RGB,\r\n      subimages: [\r\n        {\r\n          pixels: paddedBrickwallImg.data,\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 0,\r\n          width: paddedBrickwallImg.paddedWidth,\r\n          height: paddedBrickwallImg.paddedHeight,\r\n          depth: 1\r\n        },\r\n        {\r\n          pixels: paddedAlbedoMapImg.data,\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 1,\r\n          width: paddedAlbedoMapImg.paddedWidth,\r\n          height: paddedAlbedoMapImg.paddedHeight,\r\n          depth: 1\r\n        },\r\n        {\r\n          pixels: paddedNormalMap2.data,\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 2,\r\n          width: paddedNormalMap2.paddedWidth,\r\n          height: paddedNormalMap2.paddedHeight,\r\n          depth: 1\r\n        },\r\n        {\r\n          pixels: paddedColorsImg.data,\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 3,\r\n          width: paddedColorsImg.paddedWidth,\r\n          height: paddedColorsImg.paddedHeight,\r\n          depth: 1\r\n        },\r\n      ],\r\n      // wrapS: TextureWrapMode.CLAMP_TO_EDGE,\r\n      // wrapT: TextureWrapMode.CLAMP_TO_EDGE,\r\n      // wrapR: TextureWrapMode.CLAMP_TO_EDGE,\r\n      min: TextureMinFilter.LINEAR,\r\n      mag: TextureMagFilter.LINEAR,\r\n      // mipmap: false\r\n    },\r\n    normalMap: {\r\n      pixels: normalMapImg,\r\n      width: normalMapImg.width, height: normalMapImg.height,\r\n      target: TextureTarget.TEXTURE_2D,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGB,\r\n      internalFormat: TextureInternalPixelFormat.RGB,\r\n      min: TextureMinFilter.LINEAR_MIPMAP_LINEAR,\r\n      mag: TextureMagFilter.LINEAR\r\n    },\r\n    displacementMap: {\r\n      pixels: displacementMapImg,\r\n      width: displacementMapImg.width, height: displacementMapImg.height,\r\n      target: TextureTarget.TEXTURE_2D,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGBA,\r\n      internalFormat: TextureInternalPixelFormat.RGBA\r\n    },\r\n    skybox: {\r\n      pixels: {\r\n        xPos: skyboxXPosImg, xNeg: skyboxXNegImg,\r\n        yPos: skyboxYPosImg, yNeg: skyboxYNegImg,\r\n        zPos: skyboxZPosImg, zNeg: skyboxZNegImg\r\n      },\r\n      width: skyboxXPosImg.width, height: skyboxXPosImg.height,\r\n      target: TextureTarget.TEXTURE_CUBE_MAP,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGBA,\r\n      internalFormat: TextureInternalPixelFormat.RGBA\r\n    },\r\n    fbColorTex: {\r\n      width: canvas.width, height: canvas.height,\r\n      pixels: null,\r\n      target: TextureTarget.TEXTURE_2D,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGBA,\r\n      internalFormat: TextureInternalPixelFormat.RGBA,\r\n      mag: TextureMagFilter.LINEAR,\r\n      min: TextureMinFilter.LINEAR,\r\n      wrapS: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapT: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapR: TextureWrapMode.CLAMP_TO_EDGE,\r\n    },\r\n    depthTex: {\r\n      width: canvas.width, height: canvas.height,\r\n      pixels: null,\r\n      target: TextureTarget.TEXTURE_2D,\r\n      type: TexturePixelType.UNSIGNED_INT,\r\n      format: TexturePixelFormat.DEPTH_COMPONENT,\r\n      internalFormat: TextureInternalPixelFormat.DEPTH_COMPONENT24,\r\n      wrapS: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapT: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapR: TextureWrapMode.CLAMP_TO_EDGE,\r\n      mag: TextureMagFilter.NEAREST,\r\n      min: TextureMinFilter.NEAREST,\r\n    }\r\n  })!;\r\n\r\n  const {albedoMap, albedoMaps, normalMap, displacementMap, skybox, fbColorTex, depthTex} = textures;\r\n\r\n  const anisotropicTargetTextures = [albedoMaps];\r\n  const anisotropicExtension = gl.getExtension(\"EXT_texture_filter_anisotropic\");\r\n  if (anisotropicExtension) {\r\n    console.log(`Extension EXT_texture_filter_anisotropic activated.`);\r\n    const maxFiltering = gl.getParameter(anisotropicExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT);\r\n    anisotropicTargetTextures.forEach((texture) => {\r\n      const {properties, internalTexture} = texture;\r\n      const {target} = properties!;\r\n      gl.bindTexture(target, internalTexture);\r\n      gl.texParameterf(target, anisotropicExtension.TEXTURE_MAX_ANISOTROPY_EXT, maxFiltering);\r\n    });\r\n  }\r\n\r\n  const cubeGeometry =\r\n    // new QuadGeometry({heightSegments: 64, widthSegments: 64});\r\n    new CubeGeometry({height: 4, width: 4, depth: 4, heightSegments: 32, widthSegments: 32, depthSegments: 32});\r\n    // new SphereGeometry({widthSegments: 64, heightSegments: 64});\r\n    // new CylinderGeometry();\r\n    // new DodecahedronGeometry();\r\n  \r\n  const quad = new QuadGeometry({height: 2, width: 2});\r\n  const quadGeometryBuilder = quad.toBuilder();\r\n  const cube = new Transform();\r\n  cube.setScaling(new Vector3([1, 1, 1]));\r\n  \r\n  const fov = (1 / 3) * Math.PI;\r\n  const aspect = gl.canvas.width / gl.canvas.height;\r\n  const zNear = 0.1;\r\n  const zFar = 100;\r\n\r\n  const camera = new PerspectiveCamera(fov, aspect, zNear, zFar);\r\n  camera.transform.setTranslation(new Vector3([0, 8, 8]));\r\n  camera.transform.lookAt(new Vector3([0, 0, 0]), Space.up);\r\n\r\n  const lightTransform = new Transform();\r\n  lightTransform.setTranslation(new Vector3([0, 2, 2]));\r\n  lightTransform.setScaling(new Vector3([0.2, 0.2, 0.2]));\r\n\r\n  camera.transform.setTranslation(lightTransform.getTranslation(new Vector3()).scale(2));\r\n  camera.transform.lookAt(new Vector3([0, 0, 0]), Space.up);\r\n\r\n  const viewDirectionProjectionInverse = camera.projection.clone().mult(Matrix4.identity().setRotation(camera.view.getRotation())).invert();\r\n/*\r\n  addWidgets([\r\n    ...createRotationWidgets(cube, \"Cube\"),\r\n    ...createPositionWidgets(cube, \"Cube\"),\r\n    ...createRelativePositionWidgets(cube, \"Cube\"),\r\n    ...createRelativePositionWidgets(camera.transform, \"Camera\"),\r\n  ]);*/\r\n\r\n  const cubeGeometryBuilder = cubeGeometry.toBuilder();\r\n  const cubeVerticesArray = cubeGeometryBuilder.verticesArray();\r\n  const cubeIndicesArray = cubeGeometryBuilder.trianglesIndicesArray();\r\n  const cubeNormalsArray = cubeGeometryBuilder.normalsArray();\r\n  const cubeUVsArray= cubeGeometryBuilder.uvsArray();\r\n  const cubeTangentsArray = cubeGeometryBuilder.tangentsArray();\r\n  const cubeLinesArray = cubeGeometryBuilder.verticesArray();\r\n\r\n  const cubeGeometryBuffer = new GeometryBuffer({\r\n    a_position: { array: cubeVerticesArray, type: AttributeDataType.VEC3 },\r\n    a_tangent: { array: cubeTangentsArray, type: AttributeDataType.VEC3 },\r\n    a_normal: { array: cubeNormalsArray, type: AttributeDataType.VEC3 },\r\n    a_uv: { array: cubeUVsArray, type: AttributeDataType.VEC2 },\r\n  }, cubeIndicesArray, false);\r\n\r\n  const cubeVertices = cubeGeometryBuffer.getAttribute(\"a_position\")!;\r\n  const cubeIndices = cubeGeometryBuffer.indices!;\r\n  const cubeNormals = cubeGeometryBuffer.getAttribute(\"a_normal\")!;\r\n  const cubeUVs = cubeGeometryBuffer.getAttribute(\"a_uv\")!;\r\n  const cubeTangents = cubeGeometryBuffer.getAttribute(\"a_tangent\")!;\r\n  const cubeColors = cubeGeometryBuffer.getAttribute(\"a_normal\")!;\r\n  \r\n  //const cubeLines = cubeGeometryBuffer.getAttribute(\"a_lines\")!;\r\n\r\n  // const blob = cubeGeometryBuffer.toBlob();\r\n  // const anchor = document.createElement(\"a\");\r\n  // anchor.download = \"dat.bin\";\r\n  // anchor.href = URL.createObjectURL(blob);\r\n  // anchor.click();\r\n\r\n  // console.log(cubeGeometryBuffer);\r\n\r\n  // const cubeGeometryBuffer = await GeometryBuffer.fromBlob(file!);\r\n\r\n  // const cubeVertices = cubeGeometryBuffer.getAttribute(\"a_position\")!;\r\n  // const cubeIndices = cubeGeometryBuffer.indices!;\r\n  // const cubeNormals = cubeGeometryBuffer.getAttribute(\"a_normal\")!;\r\n  // const cubeUVs = cubeGeometryBuffer.getAttribute(\"a_uv\")!;\r\n  // const cubeTangents = cubeGeometryBuffer.getAttribute(\"a_tangent\")!;\r\n\r\n  const phongCubePacketProperties: PacketProperties = {\r\n    program: phongProgram,\r\n    vertexArray: {\r\n      vertexBuffers: [\r\n        {\r\n          interleaved: false\r\n        },\r\n        {\r\n          usage: BufferDataUsage.DYNAMIC_READ\r\n        },\r\n      ],\r\n      vertexAttributes: {\r\n        a_position: { buffer: 0, type: AttributeDataType.VEC3, componentType: DataComponentType.FLOAT, byteLength: cubeNormals.array.byteLength },\r\n        a_tangent: { buffer: 0, type: AttributeDataType.VEC3, componentType: DataComponentType.FLOAT, byteLength: cubeTangents.array.byteLength },\r\n        a_normal: { ...cubeNormals, buffer: 0 },\r\n        a_uv: { ...cubeUVs, buffer: 0 },\r\n        a_color: { buffer: 1, type: AttributeDataType.VEC3, componentType: DataComponentType.FLOAT, byteLength: cubeColors.array.byteLength },\r\n      },\r\n      elementIndices: cubeGeometryBuffer.indices\r\n    },\r\n    uniformBuffers: [\r\n      {\r\n        usage: BufferDataUsage.DYNAMIC_READ\r\n      },\r\n      {\r\n        usage: BufferDataUsage.DYNAMIC_READ\r\n      }\r\n    ],\r\n    uniformBlocks: {\r\n      subTexture: {\r\n        uniforms: {\r\n          u_xOffset: { value: PADDING / paddedBrickwallImg.paddedWidth },\r\n          u_yOffset: { value: PADDING / paddedBrickwallImg.paddedHeight },\r\n          u_zOffset: { value: 1 },\r\n          u_xScaling: { value: paddedAlbedoMapImg.width / paddedBrickwallImg.paddedWidth },\r\n          u_yScaling: { value: paddedAlbedoMapImg.height / paddedBrickwallImg.paddedHeight }\r\n        }\r\n      },\r\n      viewBlock: {\r\n        buffer: 0,\r\n        /*uniforms: {\r\n          u_view: { value: camera.view.array },\r\n          u_projection: { value: camera.projection.array },\r\n        }*/\r\n      },\r\n      modelBlock: {\r\n        buffer: 0,\r\n        /*uniforms: {\r\n          \"models[0].u_model\": { value: cube.matrix.array },\r\n          \"models[0].u_modelView\": { value: camera.view.mult(cube.matrix).array },\r\n          \"models[0].u_normal\": { value: camera.view.mult(cube.matrix).invert().transpose().array }\r\n        }*/\r\n      },\r\n      lightsBlock: {\r\n        buffer: 0,\r\n        /*uniforms: {\r\n          \"lights[0].u_lightWorldPos\": { value: Array.from(lightTransform.getTranslation(new Vector3())) },\r\n          \"lights[0].u_lightDirection\": { value: Array.from(lightTransform.getBackward(new Vector3())) },\r\n          \"lights[0].u_cutOff\": { value: (2 / 360) * Math.PI },\r\n          \"lights[0].u_lightColor\": { value: Array.from(Color.RED) }\r\n        }*/\r\n      },\r\n      phongBlock: {\r\n        buffer: 1,\r\n        /*uniforms: {\r\n          \"phong.u_ambientColor\": { value: [0.1, 0.1, 0.1] },\r\n          \"phong.u_diffuseColor\": { value: [0.8, 0, 0] },\r\n          \"phong.u_specularColor\": { value: [1, 1, 1] },\r\n          \"phong.u_ambientFactor\": { value: 0.0008 },\r\n          \"phong.u_diffuseFactor\": { value: 1 },\r\n          \"phong.u_specularFactor\": { value: 1 },\r\n          \"phong.u_shininess\": { value: 36 },\r\n          \"phong.u_constant\": { value: 1 }, \r\n          \"phong.u_linear\": { value: 0.09 },\r\n          \"phong.u_quadratic\": { value: 0.032 }\r\n        }*/\r\n      }\r\n    },\r\n    uniforms: {\r\n      u_albedoMap: { value: albedoMap },\r\n      u_normalMap: { value: normalMap },\r\n      u_displacementMap: { value: displacementMap },\r\n      u_albedoMaps: { value: albedoMaps }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: cubeGeometryBuffer.indices!.length,\r\n    }\r\n  };\r\n\r\n  const phongPacketInitValues = <PacketValues>{\r\n    program: phongProgram,\r\n    uniformBlocks: {\r\n      viewBlock: {\r\n        uniforms: {\r\n          u_view: { value: camera.view.array },\r\n          u_projection: { value: camera.projection.array },\r\n        }\r\n      },\r\n      modelBlock: {\r\n        uniforms: {\r\n          \"models[0].u_model\": { value: cube.matrix.array },\r\n          \"models[0].u_modelView\": { value: camera.view.mult(cube.matrix).array },\r\n          \"models[0].u_normal\": { value: camera.view.mult(cube.matrix).invert().transpose().array }\r\n        }\r\n      },\r\n      lightsBlock: {\r\n        uniforms: {\r\n          \"lights[0].u_lightWorldPos\": { value: Array.from(lightTransform.getTranslation(new Vector3())) },\r\n          \"lights[0].u_lightDirection\": { value: Array.from(lightTransform.getBackward(new Vector3())) },\r\n          \"lights[0].u_cutOff\": { value: (2 / 360) * Math.PI },\r\n          \"lights[0].u_lightColor\": { value: /*[1, 0.8, 0.8]*/Array.from(Color.RED) }\r\n        }\r\n      },\r\n      phongBlock: {\r\n        uniforms: {\r\n          \"phong.u_ambientColor\": { value: [0.1, 0.1, 0.1] },\r\n          \"phong.u_diffuseColor\": { value: [0.8, 0, 0] },\r\n          \"phong.u_specularColor\": { value: [1, 1, 1] },\r\n          \"phong.u_ambientFactor\": { value: 0.0008 },\r\n          \"phong.u_diffuseFactor\": { value: 1 },\r\n          \"phong.u_specularFactor\": { value: 1 },\r\n          \"phong.u_shininess\": { value: 36 },\r\n          \"phong.u_constant\": { value: 1 }, \r\n          \"phong.u_linear\": { value: 0.09 },\r\n          \"phong.u_quadratic\": { value: 0.032 }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  let phongCubePacket = WebGLPacketUtilities.createPacket(gl, phongCubePacketProperties)!;\r\n  \r\n  WebGLVertexArrayUtilities.setVertexArrayBufferData(gl, phongCubePacket.vertexArray.verticesBuffers[1]!, cubeColors.array);\r\n  WebGLVertexArrayUtilities.setVertexArrayBufferData(gl, phongCubePacket.vertexArray.verticesBuffers[0]!, new Uint8Array(cubeGeometryBuffer.buffer));\r\n  WebGLVertexArrayUtilities.setVertexArrayValues(gl, phongCubePacket.vertexArray, {\r\n    attributes: {\r\n      a_position: {\r\n        array: cubeVertices.array\r\n      }\r\n    }\r\n  });\r\n\r\n  WebGLUniformBlockUtilities.setUniformBufferData(gl,\r\n    phongCubePacket.uniformBlocks!.phongBlock!.buffer!,\r\n    Color.lerp(Color.WHITE, Color.GREEN, 0.5).array,\r\n    phongCubePacket.uniformBlocks!.phongBlock!.layout[\"phong.u_ambientColor\"]!.byteOffset!,\r\n  );\r\n\r\n  const linesProperties: PacketProperties = {\r\n    program: linesProgram,\r\n    vertexArray: {\r\n      vertexAttributes: {\r\n        a_position: {\r\n          array: cubeLinesArray,\r\n          type: AttributeDataType.VEC3\r\n        }\r\n      }\r\n    },\r\n    uniformBuffers: [\r\n      phongCubePacket.uniformBlocks!.modelBlock.buffer!,\r\n      phongCubePacket.uniformBlocks!.viewBlock.buffer!\r\n    ],\r\n    uniformBlocks: {\r\n      modelBlock: { buffer: 0 },\r\n      viewBlock: { buffer: 1 }\r\n    },\r\n    uniforms: {\r\n      u_color: {\r\n        value: new Float32Array([1, 0, 0])\r\n      }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.LINES,\r\n      elementsCount: cubeLinesArray.length / 2\r\n    }\r\n  };\r\n\r\n  const basicPacketProperties: PacketProperties = {\r\n    program: basicProgram,\r\n    vertexArray: {\r\n      vertexBuffers: [\r\n        phongCubePacket.vertexArray.verticesBuffers[0]\r\n      ],\r\n      elementBuffer: phongCubePacket.vertexArray.elementBuffer\r\n    },\r\n    uniformBuffers: [\r\n      phongCubePacket.uniformBlocks!.viewBlock.buffer!\r\n    ],\r\n    uniformBlocks: {\r\n      basicModelBlock: {\r\n        uniforms: {\r\n          u_model: { value: lightTransform.matrix.array },\r\n          u_color: { value: [1, 1, 0] }\r\n        }\r\n      },\r\n      viewBlock: {\r\n        buffer: 0\r\n      }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: phongCubePacket.drawCommand.elementsCount\r\n    }\r\n  };\r\n\r\n  const quadIndices = quadGeometryBuilder.trianglesIndicesArray();\r\n  const quadVertices = quadGeometryBuilder.verticesArray();\r\n  const quadUVs = quadGeometryBuilder.uvsArray();\r\n  const quadWorld = new Matrix4().setIdentity();\r\n\r\n  const skyboxPacketProperties: PacketProperties = {\r\n    program: skyboxProgram,\r\n    vertexArray: {\r\n      vertexAttributes: {\r\n        a_position: { array: quadVertices, type: AttributeDataType.VEC3 },\r\n      },\r\n      elementIndices: quadIndices\r\n    },\r\n    uniforms: {\r\n      u_world: { value: quadWorld.array },\r\n      u_viewDirectionProjectionInverse: { value: viewDirectionProjectionInverse.array }, \r\n      u_skybox: { value: skybox },\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: quadIndices.length\r\n    }\r\n  };\r\n\r\n  const depthPacketProperties: PacketProperties = {\r\n    program: depthProgram,\r\n    vertexArray: {\r\n      vertexAttributes: {\r\n        a_position: { array: quadVertices, type: AttributeDataType.VEC3 },\r\n        a_uv: { array: quadUVs, type: AttributeDataType.VEC2 },\r\n      },\r\n      elementIndices: quadIndices\r\n    },\r\n    uniforms: {\r\n      u_depthWorld: { value: quadWorld.array },\r\n      u_depthTex: { value: depthTex }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: quadIndices.length\r\n    }\r\n  };\r\n\r\n  const texPacketProperties: PacketProperties = {\r\n    program: texProgram,\r\n    vertexArray: {\r\n      vertexAttributes: {\r\n        a_position: { array: quadVertices, type: AttributeDataType.VEC3 },\r\n        a_uv: { array: quadUVs, type: AttributeDataType.VEC2 },\r\n      },\r\n      elementIndices: quadIndices\r\n    },\r\n    uniforms: {\r\n      u_world: { value: quadWorld.array },\r\n      u_tex: { value: fbColorTex }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: quadIndices.length\r\n    }\r\n  };\r\n\r\n  const linesPacket = WebGLPacketUtilities.createPacket(gl, linesProperties)!;\r\n  const basicPacket = WebGLPacketUtilities.createPacket(gl, basicPacketProperties)!;\r\n  const skyboxPacket = WebGLPacketUtilities.createPacket(gl, skyboxPacketProperties)!;\r\n  const depthPacket = WebGLPacketUtilities.createPacket(gl, depthPacketProperties)!;\r\n  const texPacket = WebGLPacketUtilities.createPacket(gl, texPacketProperties)!;\r\n\r\n  const framebuffer = WebGLFramebufferUtilities.createFramebuffer(gl)!;\r\n  const maxSamples = WebGLRendererUtilities.getMaxSamples(gl);\r\n  \r\n  WebGLFramebufferUtilities.attachRenderbuffer(\r\n    gl, framebuffer,\r\n    {\r\n      renderbuffer: WebGLFramebufferUtilities.createRenderbuffer(gl, {\r\n        internalFormat: RenderbufferPixelFormat.DEPTH_COMPONENT24,\r\n        width: canvas.width,\r\n        height: canvas.height,\r\n        samples: maxSamples\r\n      })!,\r\n      attachment: FramebufferAttachment.DEPTH_ATTACHMENT\r\n    },\r\n    {\r\n      renderbuffer: WebGLFramebufferUtilities.createRenderbuffer(gl, {\r\n        internalFormat: RenderbufferPixelFormat.RGBA8,\r\n        width: canvas.width,\r\n        height: canvas.height,\r\n        samples: maxSamples\r\n      })!,\r\n      attachment: FramebufferAttachment.COLOR_ATTACHMENT0,\r\n    }\r\n  );\r\n\r\n  const postFramebuffer = WebGLFramebufferUtilities.createFramebuffer(gl)!;\r\n\r\n  WebGLFramebufferUtilities.attachTexture(\r\n    gl, postFramebuffer, \r\n    {\r\n      textureTarget: FramebufferTextureTarget.TEXTURE_2D,\r\n      texture: fbColorTex,\r\n      attachment: FramebufferAttachment.COLOR_ATTACHMENT0\r\n    },\r\n    {\r\n      textureTarget: FramebufferTextureTarget.TEXTURE_2D,\r\n      texture: depthTex,\r\n      attachment: FramebufferAttachment.DEPTH_ATTACHMENT\r\n    }\r\n  );\r\n\r\n  WebGLRendererUtilities.viewport(gl, 0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n  // WebGLRendererUtilities.frontFace(gl, WindingOrder.CW);\r\n  WebGLRendererUtilities.enable(gl, Capabilities.DEPTH_TEST);\r\n  WebGLRendererUtilities.enable(gl, Capabilities.CULL_FACE);\r\n  WebGLRendererUtilities.enable(gl, Capabilities.BLEND);\r\n  WebGLRendererUtilities.blendFunction(gl, BlendingMode.SRC_ALPHA, BlendingMode.ONE_MINUS_SRC_ALPHA);\r\n  \r\n  let lastFrameTime = 0;\r\n  let deltaTime = 0;\r\n\r\n  let t = 0;\r\n  let direction = 1;\r\n  \r\n  let initRotation = cube.getRotation(new Quaternion());\r\n  let initPosition = cube.getTranslation(new Vector3());\r\n\r\n  const targetPosition = new Vector3([2, -2, -2]);\r\n  const targetRotation = Quaternion.fromAxisAngle(Space.down, Math.PI / 3);\r\n\r\n  Input.initialize(canvas);\r\n  \r\n  WebGLFramebufferUtilities.unbindFramebuffer(gl);\r\n\r\n  const cameraControl = new FreeCameraControl(camera);\r\n  \r\n  // WebGLProgramUtilities.recompileProgram(gl, phongProgram, {fragmentSource: phong2Frag});\r\n  // phongCubePacket = WebGLPacketUtilities.createPacket(gl, phongCubePacketProperties)!;\r\n  \r\n  WebGLPacketUtilities.setPacketValues(gl, phongCubePacket, phongPacketInitValues);\r\n  WebGLRendererUtilities.clearColor(gl, Color.BLACK.normalize());\r\n  \r\n  ctx.font = \"14px Menlo\";\r\n  ctx.strokeStyle = \"black\";\r\n  ctx.fillStyle = \"white\";\r\n\r\n  const renderGUI = function(frameTime: number) {\r\n    frameTime *= 0.001;\r\n    deltaTime = frameTime - lastFrameTime;\r\n    \r\n    fps = 1 / deltaTime;\r\n\r\n    ctx.clearRect(0, 0, canvas2D.width, canvas2D.height);\r\n\r\n    ctx.shadowBlur = 2;\r\n    ctx.strokeText(`${fps.toFixed(1)} FPS`, 20, 20);\r\n    ctx.shadowBlur = 0;\r\n    ctx.fillText(`${fps.toFixed(1)} FPS`, 20, 20);\r\n  };\r\n\r\n  render = function(frameTime: number) {\r\n    renderGUI(frameTime);\r\n\r\n    frameTime *= 0.001;\r\n    deltaTime = frameTime - lastFrameTime;\r\n    lastFrameTime = frameTime;\r\n\r\n    if (!playing) {\r\n      return;\r\n    }\r\n\r\n    //fpsElement.textContent = fps.toFixed(1);\r\n\r\n\r\n    cameraControl.update(deltaTime);\r\n    lightTransform.setMatrix(camera.transform.matrix);\r\n\r\n    cube.rotate(Quaternion.fromAxisAngle(Space.down, Math.PI / 128));\r\n    \r\n    t += deltaTime * direction * 0.5;\r\n    if (t > 1 || t < 0) {\r\n      direction *= -1;\r\n    }\r\n    \r\n    \r\n    WebGLRendererUtilities.clear(gl, BufferMask.COLOR_BUFFER_BIT | BufferMask.DEPTH_BUFFER_BIT);\r\n    \r\n    viewDirectionProjectionInverse.copy(camera.projection).mult(new Matrix4().setIdentity().setRotation(camera.view.getRotation())).invert();\r\n\r\n    // Framebuffer\r\n\r\n    WebGLRendererUtilities.viewport(gl, 0, 0, canvas.width, canvas.height);\r\n\r\n    WebGLFramebufferUtilities.bindFramebuffer(gl, framebuffer);\r\n\r\n    WebGLRendererUtilities.clear(gl, BufferMask.COLOR_BUFFER_BIT | BufferMask.DEPTH_BUFFER_BIT);\r\n    \r\n    WebGLRendererUtilities.depthFunction(gl, TestFunction.LEQUAL);\r\n\r\n    WebGLPacketUtilities.drawPacket(gl, skyboxPacket);\r\n\r\n    WebGLRendererUtilities.depthFunction(gl, TestFunction.LESS);\r\n\r\n    WebGLPacketUtilities.setPacketValues(gl, phongCubePacket, {\r\n      uniformBlocks: {\r\n        modelBlock: {\r\n          uniforms: {\r\n            \"models[0].u_model\": { value: cube.matrix.array },\r\n            \"models[0].u_modelView\": { value: camera.view.mult(cube.matrix).array },\r\n            \"models[0].u_normal\": { value: camera.view.mult(cube.matrix).invert().transpose().array },\r\n          }\r\n        },\r\n        viewBlock: {\r\n          uniforms: {\r\n            u_view: { value: camera.view.array },\r\n            u_projection: { value: camera.projection.array },\r\n          }\r\n        },\r\n        lightsBlock: {\r\n          uniforms: {\r\n            \"lights[0].u_lightWorldPos\": { value: Array.from(lightTransform.getTranslation(new Vector3())) },\r\n            \"lights[0].u_lightDirection\": { value: Array.from(lightTransform.getBackward(new Vector3())) },\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    // WebGLPacketUtilities.drawPacket(gl, basicPacket);\r\n    // WebGLPacketUtilities.drawPacket(gl, linesPacket);\r\n    WebGLPacketUtilities.drawPacket(gl, phongCubePacket);\r\n    \r\n    WebGLPacketUtilities.setPacketValues(gl, skyboxPacket, {\r\n      uniforms: {\r\n        u_viewDirectionProjectionInverse: { value: viewDirectionProjectionInverse.array }\r\n      }\r\n    });\r\n    \r\n    // WebGLRendererUtilities.depthFunction(gl, TestFunction.LEQUAL);\r\n    // WebGLPacketUtilities.drawPacket(gl, skyboxPacket);\r\n    \r\n    // Framebuffer\r\n    WebGLFramebufferUtilities.blit(gl, framebuffer, postFramebuffer,\r\n      [0, 0, canvas.width, canvas.height],\r\n      [0, 0, canvas.width, canvas.height],\r\n      BufferMask.COLOR_BUFFER_BIT,\r\n      TextureMagFilter.LINEAR\r\n    );\r\n    \r\n    WebGLFramebufferUtilities.blit(gl, framebuffer, postFramebuffer,\r\n      [0, 0, canvas.width, canvas.height],\r\n      [0, 0, canvas.width, canvas.height],\r\n      BufferMask.DEPTH_BUFFER_BIT,\r\n      TextureMagFilter.NEAREST\r\n    );\r\n\r\n    WebGLFramebufferUtilities.unbindFramebuffer(gl);\r\n    \r\n    WebGLPacketUtilities.drawPacket(gl, texPacket);\r\n\r\n    const newWidth = canvas.width / 4;\r\n    const newHeight = canvas.height / 4;\r\n    WebGLRendererUtilities.viewport(gl, 0, canvas.height - newHeight, newWidth, newHeight);\r\n\r\n    WebGLRendererUtilities.depthFunction(gl, TestFunction.ALWAYS);\r\n\r\n    WebGLPacketUtilities.drawPacket(gl, depthPacket);\r\n\r\n    Input.clear();\r\n\r\n    requestAnimationFrame(render);\r\n  };\r\n\r\n  /*const stream = gl.canvas.captureStream(60);\r\n  const rec = new MediaRecorder(stream, {\r\n    mimeType: \"video/webm; codecs=vp9\",\r\n    audioBitsPerSecond: 0,\r\n    videoBitsPerSecond: canvas.width * canvas.height * 24 * 60\r\n  });\r\n\r\n  const chunks: BlobPart[] = [];\r\n  rec.addEventListener(\"dataavailable\", (event) => {\r\n    chunks.push(event.data);\r\n  });\r\n  rec.addEventListener(\"stop\", () => {\r\n    const blob = new Blob(chunks, {type: \"video/webm; codecs=vp9\"});\r\n    const anchor = document.createElement(\"a\");\r\n    anchor.download = \"recorded.webm\";\r\n    anchor.href = URL.createObjectURL(blob);\r\n    anchor.click();\r\n  });\r\n  rec.start();\r\n\r\n  setTimeout(() => {\r\n    rec.stop();\r\n  }, 5_000);*/\r\n  \r\n  // const saveSVG = document.querySelector<SVGSVGElement>(\"svg#save\")!;\r\n  // const getSVGImageData = (svg: SVGSVGElement) => new Promise((resolve: (value: string) => void) => {\r\n  //   const url = URL.createObjectURL(new Blob([svg.outerHTML], {\r\n  //     type: \"image/svg+xml\"\r\n  //   }));\r\n  //   const svgImage = document.createElement(\"img\");\r\n  //   document.body.appendChild(svgImage);\r\n  //   svgImage.onload = () => {\r\n  //     const canvas = document.createElement(\"canvas\");\r\n  //     const ctx = canvas.getContext(\"2d\", {alpha: true})!;\r\n  //     canvas.width = svgImage.clientWidth;\r\n  //     canvas.height = svgImage.clientHeight;\r\n  //     ctx.drawImage(svgImage, 0, 0);\r\n  //     const imgData = canvas.toDataURL(\"image/png\");\r\n  //     resolve(imgData);\r\n  //     URL.revokeObjectURL(url);\r\n  //     svgImage.remove();\r\n  //   };\r\n  //   svgImage.src = url;\r\n  // });\r\n\r\n  // getSVGImageData(saveSVG).then(\r\n  //   (data: string) => {\r\n  //     const img = new Image();\r\n  //     img.src = data;\r\n  //     document.body.append(img);\r\n  //   }\r\n  // )\r\n}","export { ModelChangeRecord };\r\nexport { ModelEvent };\r\nexport { ModelNode };\r\nexport { ModelObject };\r\nexport { ReactiveProperty };\r\nexport { ModelList };\r\nexport { ModelChangeObserver };\r\nclass ModelChangeRecordBase {\r\n    target;\r\n    changeType;\r\n    propertyName;\r\n    oldValue;\r\n    newValue;\r\n    removedIndex;\r\n    removedItems;\r\n    insertedIndex;\r\n    insertedItems;\r\n    sortedIndices;\r\n    constructor(init) {\r\n        this.target = init.target;\r\n        this.changeType = init.changeType;\r\n        this.propertyName = init.propertyName ?? null;\r\n        this.oldValue = init.oldValue ?? undefined;\r\n        this.newValue = init.newValue ?? undefined;\r\n        this.removedIndex = init.removedIndex ?? 0;\r\n        this.removedItems = new ModelNodesList(init.removedItems ?? []);\r\n        this.insertedIndex = init.insertedIndex ?? 0;\r\n        this.insertedItems = new ModelNodesList(init.insertedItems ?? []);\r\n        this.sortedIndices = init.sortedIndices ?? [];\r\n    }\r\n    static get PROPERTY_CHANGE() {\r\n        return 1;\r\n    }\r\n    static get LIST_REMOVE() {\r\n        return 2;\r\n    }\r\n    static get LIST_INSERT() {\r\n        return 3;\r\n    }\r\n    static get LIST_SORT() {\r\n        return 4;\r\n    }\r\n    get PROPERTY_CHANGE() {\r\n        return ModelChangeRecordBase.PROPERTY_CHANGE;\r\n    }\r\n    get LIST_REMOVE() {\r\n        return ModelChangeRecordBase.LIST_REMOVE;\r\n    }\r\n    get LIST_INSERT() {\r\n        return ModelChangeRecordBase.LIST_INSERT;\r\n    }\r\n    get LIST_SORT() {\r\n        return ModelChangeRecordBase.LIST_SORT;\r\n    }\r\n}\r\nvar ModelChangeRecord = ModelChangeRecordBase;\r\nclass ModelNodesListBase {\r\n    #items;\r\n    constructor(items) {\r\n        this.#items = items.slice();\r\n    }\r\n    get length() {\r\n        return this.#items.length;\r\n    }\r\n    item(index) {\r\n        return this.#items[index] ?? null;\r\n    }\r\n    values() {\r\n        return this.#items.values();\r\n    }\r\n}\r\nvar ModelNodesList = ModelNodesListBase;\r\nclass ModelEventBase {\r\n    type;\r\n    #currentTarget;\r\n    #target;\r\n    constructor(type) {\r\n        this.type = type;\r\n        this.#currentTarget = null;\r\n        this.#target = null;\r\n    }\r\n    get currentTarget() {\r\n        return this.#currentTarget;\r\n    }\r\n    get target() {\r\n        return this.#target;\r\n    }\r\n    static ModelEventTargetAccessor = new class ModelEventTargetAccessor {\r\n        setCurrentTarget(event, currentTarget) {\r\n            if (event instanceof ModelEventBase) {\r\n                event.#currentTarget = currentTarget;\r\n            }\r\n        }\r\n        setTarget(event, target) {\r\n            if (event instanceof ModelEventBase) {\r\n                event.#target = target;\r\n            }\r\n        }\r\n    };\r\n}\r\nvar ModelEventTargetAccessor = ModelEventBase.ModelEventTargetAccessor;\r\ndelete ModelEventBase.ModelEventTargetAccessor;\r\nvar ModelEvent = ModelEventBase;\r\nclass ModelEventTargetBase {\r\n    #callbacks;\r\n    constructor() {\r\n        this.#callbacks = new Map();\r\n    }\r\n    receiveEvent(event) {\r\n        const { type } = event;\r\n        const callbacks = this.#callbacks.get(type);\r\n        ModelEventTargetAccessor.setCurrentTarget(event, this);\r\n        if (callbacks) {\r\n            callbacks.forEach((callback_i) => {\r\n                callback_i(event);\r\n            });\r\n        }\r\n    }\r\n    addEventListener(type, callback) {\r\n        const callbacks = this.#callbacks.get(type);\r\n        if (callbacks) {\r\n            callbacks.push(callback);\r\n        }\r\n        else {\r\n            this.#callbacks.set(type, [callback]);\r\n        }\r\n    }\r\n    removeEventListener(type, callback) {\r\n        const callbacks = this.#callbacks.get(type);\r\n        if (callbacks) {\r\n            const callbackIndex = callbacks.findIndex(callback_i => callback_i == callback);\r\n            if (callbackIndex > -1) {\r\n                callbacks.splice(callbackIndex, 1);\r\n            }\r\n            if (callbacks.length == 0) {\r\n                this.#callbacks.delete(type);\r\n            }\r\n        }\r\n    }\r\n    dispatchEvent(event) {\r\n        ModelEventTargetAccessor.setTarget(event, this);\r\n        this.receiveEvent(event);\r\n    }\r\n}\r\nvar ModelEventTarget = ModelEventTargetBase;\r\nclass ModelNodeBase extends ModelEventTargetBase {\r\n    #parentNode;\r\n    #records;\r\n    #isRecording;\r\n    constructor() {\r\n        super();\r\n        this.#parentNode = null;\r\n        this.#records = [];\r\n        this.#isRecording = false;\r\n    }\r\n    get parentNode() {\r\n        return this.#parentNode;\r\n    }\r\n    setParent(parentNode) {\r\n        if (parentNode !== null) {\r\n            let isCyclicReference = parentNode == this;\r\n            let { parentNode: ancestorNode } = parentNode;\r\n            while (!isCyclicReference && ancestorNode !== null) {\r\n                ({ parentNode: ancestorNode } = ancestorNode);\r\n                isCyclicReference = ancestorNode == this;\r\n            }\r\n            if (!isCyclicReference) {\r\n                this.#parentNode = parentNode;\r\n            }\r\n            else {\r\n                throw new TypeError(\"Failed to set parent on ModelNode: circular reference detected in the hierarchy.\");\r\n            }\r\n        }\r\n        else {\r\n            this.#parentNode = null;\r\n        }\r\n    }\r\n    beginChanges() {\r\n        this.#isRecording = true;\r\n    }\r\n    endChanges() {\r\n        this.dispatchEvent(new ModelEvent(\"modelchange\"));\r\n        this.#records.splice(0);\r\n        this.#isRecording = false;\r\n    }\r\n    getRecords() {\r\n        return this.#records.slice();\r\n    }\r\n    receiveEvent(event) {\r\n        super.receiveEvent(event);\r\n        const { parentNode } = this;\r\n        if (parentNode) {\r\n            parentNode.receiveEvent(event);\r\n        }\r\n    }\r\n    #triggerChange(property, oldValue, newValue) {\r\n        const records = this.#records;\r\n        const record = new ModelChangeRecord({\r\n            target: this,\r\n            changeType: ModelChangeRecord.PROPERTY_CHANGE,\r\n            propertyName: property,\r\n            oldValue, newValue\r\n        });\r\n        records.push(record);\r\n        if (!this.#isRecording) {\r\n            this.dispatchEvent(new ModelEvent(\"modelchange\"));\r\n            records.splice(0);\r\n        }\r\n    }\r\n    #handleRecord(record) {\r\n        this.#records.push(record);\r\n        if (!this.#isRecording) {\r\n            this.dispatchEvent(new ModelEvent(\"modelchange\"));\r\n            this.#records.splice(0);\r\n        }\r\n    }\r\n    static ModelNodeRecordsAccessor = new class ModelNodeRecordsAccessor {\r\n        triggerChange(node, property, oldValue, newValue) {\r\n            if (node instanceof ModelNodeBase) {\r\n                node.#triggerChange(property, oldValue, newValue);\r\n            }\r\n        }\r\n        handleRecord(node, record) {\r\n            if (node instanceof ModelNodeBase) {\r\n                node.#handleRecord(record);\r\n            }\r\n        }\r\n    };\r\n}\r\nvar ModelNodeRecordsAccessor = ModelNodeBase.ModelNodeRecordsAccessor;\r\ndelete ModelNodeBase.ModelNodeRecordsAccessor;\r\nvar ModelNode = ModelNodeBase;\r\nconst ReactiveProperty = function () {\r\n    return (target, property) => {\r\n        const { constructor } = target;\r\n        const { prototype } = constructor;\r\n        const setter = function (value) {\r\n            const oldValue = ModelReactivePropertiesAccessor.getProperty(this, property);\r\n            ModelReactivePropertiesAccessor.setProperty(this, property, value);\r\n            if (value !== oldValue) {\r\n                ModelNodeRecordsAccessor.triggerChange(this, property, oldValue, value);\r\n            }\r\n            return true;\r\n        };\r\n        const getter = function () {\r\n            return ModelReactivePropertiesAccessor.getProperty(this, property);\r\n        };\r\n        Object.defineProperty(prototype, property, {\r\n            set: setter,\r\n            get: getter,\r\n            enumerable: true\r\n        });\r\n    };\r\n};\r\nclass ModelObjectBase extends ModelNodeBase {\r\n    #properties;\r\n    constructor() {\r\n        super();\r\n        this.#properties = new Map();\r\n    }\r\n    static ModelReactivePropertiesAccessor = new class ModelReactivePropertiesAccessor {\r\n        setProperty(node, property, value) {\r\n            if (node instanceof ModelObjectBase) {\r\n                node.#properties.set(property, value);\r\n            }\r\n        }\r\n        getProperty(node, property) {\r\n            if (node instanceof ModelObjectBase) {\r\n                return node.#properties.get(property);\r\n            }\r\n        }\r\n    };\r\n}\r\nvar ModelReactivePropertiesAccessor = ModelObjectBase.ModelReactivePropertiesAccessor;\r\ndelete ModelObjectBase.ModelReactivePropertiesAccessor;\r\nvar ModelObject = ModelObjectBase;\r\nclass ModelListBase extends ModelNodeBase {\r\n    #items;\r\n    constructor(items) {\r\n        super();\r\n        this.#items = items?.slice() ?? [];\r\n    }\r\n    setParent(parentNode) {\r\n        super.setParent(parentNode);\r\n        this.#items.forEach((item_i) => {\r\n            item_i.setParent(parentNode);\r\n        });\r\n    }\r\n    get length() {\r\n        return this.#items.length;\r\n    }\r\n    get(index) {\r\n        return this.#items[index] ?? null;\r\n    }\r\n    index(item) {\r\n        return this.#items.indexOf(item);\r\n    }\r\n    values() {\r\n        return this.#items.values();\r\n    }\r\n    sort(compareFunction) {\r\n        const items = this.#items;\r\n        const indexedItems = items.map((item_i, i) => {\r\n            return {\r\n                item: item_i,\r\n                index: i\r\n            };\r\n        });\r\n        indexedItems.sort((indexedItem_a, indexedItem_b) => {\r\n            return compareFunction(indexedItem_a.item, indexedItem_b.item);\r\n        });\r\n        this.#items = indexedItems.map(indexedItem_i => indexedItem_i.item);\r\n        const record = new ModelChangeRecord({\r\n            target: this,\r\n            changeType: ModelChangeRecord.LIST_SORT,\r\n            sortedIndices: indexedItems.map(indexedItem_i => indexedItem_i.index)\r\n        });\r\n        ModelNodeRecordsAccessor.handleRecord(this, record);\r\n    }\r\n    prepend(...items) {\r\n        const _items = this.#items;\r\n        const { parentNode } = this;\r\n        if (parentNode) {\r\n            items.forEach(item_i => {\r\n                item_i.setParent(parentNode);\r\n            });\r\n        }\r\n        _items.splice(0, 0, ...items);\r\n        const record = new ModelChangeRecord({\r\n            target: this,\r\n            changeType: ModelChangeRecord.LIST_INSERT,\r\n            insertedIndex: 0,\r\n            insertedItems: items\r\n        });\r\n        ModelNodeRecordsAccessor.handleRecord(this, record);\r\n    }\r\n    append(...items) {\r\n        const _items = this.#items;\r\n        const { length } = _items;\r\n        const { parentNode } = this;\r\n        if (parentNode) {\r\n            items.forEach(item_i => {\r\n                item_i.setParent(parentNode);\r\n            });\r\n        }\r\n        _items.push(...items);\r\n        const record = new ModelChangeRecord({\r\n            target: this,\r\n            changeType: ModelChangeRecord.LIST_INSERT,\r\n            insertedIndex: length,\r\n            insertedItems: items\r\n        });\r\n        ModelNodeRecordsAccessor.handleRecord(this, record);\r\n    }\r\n    insert(index, ...items) {\r\n        const _items = this.#items;\r\n        const { length } = _items;\r\n        const positiveIndex = Math.abs(index);\r\n        if (positiveIndex <= length) {\r\n            if (index >= 0) {\r\n                const { parentNode } = this;\r\n                items.forEach(item_i => {\r\n                    item_i.setParent(parentNode);\r\n                });\r\n                if (index < length) {\r\n                    _items.splice(index, 0, ...items);\r\n                }\r\n                else {\r\n                    _items.push(...items);\r\n                }\r\n            }\r\n            else if (index < 0) {\r\n                index = length - index;\r\n                const { parentNode } = this;\r\n                if (parentNode) {\r\n                    items.forEach(item_i => {\r\n                        item_i.setParent(parentNode);\r\n                    });\r\n                }\r\n                _items.splice(index, 0, ...items);\r\n            }\r\n            const record = new ModelChangeRecord({\r\n                target: this,\r\n                changeType: ModelChangeRecord.LIST_INSERT,\r\n                insertedIndex: index,\r\n                insertedItems: items.slice()\r\n            });\r\n            ModelNodeRecordsAccessor.handleRecord(this, record);\r\n        }\r\n    }\r\n    remove(item) {\r\n        const _items = this.#items;\r\n        const index = _items.indexOf(item);\r\n        if (index > -1) {\r\n            const item = _items.splice(index, 1)[0];\r\n            const { parentNode } = this;\r\n            if (parentNode) {\r\n                item.setParent(null);\r\n            }\r\n            const record = new ModelChangeRecord({\r\n                target: this,\r\n                changeType: ModelChangeRecord.LIST_REMOVE,\r\n                removedIndex: index,\r\n                removedItems: [item]\r\n            });\r\n            ModelNodeRecordsAccessor.handleRecord(this, record);\r\n        }\r\n    }\r\n    clear() {\r\n        const items = this.#items;\r\n        const { length } = items;\r\n        if (length > 0) {\r\n            const removedItems = items.splice(0);\r\n            const { parentNode } = this;\r\n            if (parentNode) {\r\n                removedItems.forEach((removedItem_i) => {\r\n                    removedItem_i.setParent(null);\r\n                });\r\n            }\r\n            const record = new ModelChangeRecord({\r\n                target: this,\r\n                changeType: ModelChangeRecord.LIST_REMOVE,\r\n                removedIndex: 0,\r\n                removedItems: removedItems\r\n            });\r\n            ModelNodeRecordsAccessor.handleRecord(this, record);\r\n        }\r\n    }\r\n}\r\n;\r\nvar ModelList = ModelListBase;\r\nclass ModelChangeObserverBase {\r\n    #callback;\r\n    #records;\r\n    #disconnected;\r\n    #references;\r\n    constructor(callback) {\r\n        this.#callback = callback;\r\n        this.#records = [];\r\n        this.#disconnected = false;\r\n        this.#references = new WeakMap();\r\n    }\r\n    observe(node, options) {\r\n        this.#disconnected = false;\r\n        const references = this.#references;\r\n        let reference = references.get(node);\r\n        if (!reference) {\r\n            const listener = this.#handleModelEvent.bind(this);\r\n            node.addEventListener(\"modelchange\", listener);\r\n            reference = { listener, options };\r\n            references.set(node, reference);\r\n        }\r\n        else {\r\n            references.set(node, reference);\r\n        }\r\n    }\r\n    unobserve(node) {\r\n        const references = this.#references;\r\n        let reference = references.get(node);\r\n        if (reference) {\r\n            const { listener } = reference;\r\n            node.removeEventListener(\"modelchange\", listener);\r\n        }\r\n    }\r\n    disconnect() {\r\n        this.#records.splice(0);\r\n        this.#disconnected = true;\r\n    }\r\n    #trigger() {\r\n        const records = this.#records.splice(0);\r\n        if (records.length > 0) {\r\n            this.#callback(records);\r\n        }\r\n    }\r\n    #handleModelEvent(event) {\r\n        if (!this.#disconnected) {\r\n            const { target, currentTarget } = event;\r\n            const reference = this.#references.get(currentTarget);\r\n            if (reference) {\r\n                const { options } = reference;\r\n                const { properties, propertiesFilter, childList, subtree } = options;\r\n                if (subtree) {\r\n                    if (properties && target instanceof ModelNode) {\r\n                        if (propertiesFilter) {\r\n                            this.#records.push(...target.getRecords()\r\n                                .filter(record_i => {\r\n                                const { propertyName } = record_i;\r\n                                return propertiesFilter.includes(propertyName);\r\n                            }));\r\n                        }\r\n                        else {\r\n                            this.#records.push(...target.getRecords());\r\n                        }\r\n                        this.#trigger();\r\n                    }\r\n                    else if (childList && target instanceof ModelList) {\r\n                        this.#records.push(...target.getRecords());\r\n                        this.#trigger();\r\n                    }\r\n                }\r\n                else if (target == currentTarget) {\r\n                    if (properties && target instanceof ModelNode) {\r\n                        if (propertiesFilter) {\r\n                            this.#records.push(...target.getRecords()\r\n                                .filter(record_i => {\r\n                                const { propertyName } = record_i;\r\n                                return propertiesFilter.includes(propertyName);\r\n                            }));\r\n                        }\r\n                        else {\r\n                            this.#records.push(...target.getRecords());\r\n                        }\r\n                        this.#trigger();\r\n                    }\r\n                    else if (childList && target instanceof ModelList) {\r\n                        this.#records.push(...target.getRecords());\r\n                        this.#trigger();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nvar ModelChangeObserver = ModelChangeObserverBase;\r\n//# sourceMappingURL=Model.js.map","export { snakeToCamel };\r\nexport { camelToSnake };\r\nexport { trainToCamel };\r\nexport { camelToTrain };\r\nfunction snakeToCamel(str) {\r\n    return str.split('_').map(str => str.charAt(0).toUpperCase() + str.substring(1).toLowerCase()).join(\"\");\r\n}\r\nfunction camelToSnake(str) {\r\n    return str.replace(/(?<!^)(?=[A-Z])/g, '_').toLowerCase();\r\n}\r\nfunction trainToCamel(str) {\r\n    return str.split('-').map(str => str.charAt(0).toUpperCase() + str.substring(1).toLowerCase()).join(\"\");\r\n}\r\nfunction camelToTrain(str) {\r\n    return str.replace(/(?<!^)(?=[A-Z])/g, '-').toLowerCase();\r\n}\r\n//# sourceMappingURL=Snippets.js.map","import { ModelChangeObserver } from \"../models/Model\";\r\nimport { camelToTrain } from \"./Snippets\";\r\nexport { CustomElement };\r\nexport { QueryProperty };\r\nexport { QueryAllProperty };\r\nexport { AttributeProperty };\r\nexport { reactiveElement };\r\nexport { revokeReactiveElement };\r\nexport { reactiveChildElements };\r\nexport { revokeReactiveChildElements };\r\nexport { element };\r\nexport { fragment };\r\nexport { textNode };\r\nexport { areAttributesMatching };\r\nexport { AttributeMutationMixinBase };\r\nexport { trimMultilineIndent };\r\nexport { Stylesheet };\r\nexport { reactiveElementsMap };\r\nconst AttributeProperty = function (init) {\r\n    return (target, property) => {\r\n        const { constructor } = target;\r\n        const { prototype } = constructor;\r\n        const propertyName = String(property);\r\n        const { defaultValue = null, observed = false, name = camelToTrain(propertyName) } = init;\r\n        if (observed) {\r\n            const observedAttributes = Reflect.get(constructor, \"observedAttributes\", constructor);\r\n            if (Array.isArray(observedAttributes)) {\r\n                observedAttributes.push(name);\r\n            }\r\n            else {\r\n                Object.defineProperty(constructor, \"observedAttributes\", {\r\n                    value: [name],\r\n                    writable: false\r\n                });\r\n            }\r\n        }\r\n        const { type } = init;\r\n        switch (type) {\r\n            case Boolean: {\r\n                Object.defineProperty(prototype, propertyName, {\r\n                    get: function () {\r\n                        return this.hasAttribute(name);\r\n                    },\r\n                    set: function (value) {\r\n                        if (value) {\r\n                            this.setAttribute(name, \"\");\r\n                        }\r\n                        else {\r\n                            this.removeAttribute(name);\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            }\r\n            case Object: {\r\n                Object.defineProperty(prototype, propertyName, {\r\n                    get: function () {\r\n                        const val = this.getAttribute(name);\r\n                        return (val !== null) ? JSON.parse(val) : defaultValue;\r\n                    },\r\n                    set: function (value) {\r\n                        if (value !== null) {\r\n                            this.setAttribute(name, JSON.stringify(value));\r\n                        }\r\n                        else {\r\n                            this.removeAttribute(name);\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            }\r\n            case Number: {\r\n                Object.defineProperty(prototype, propertyName, {\r\n                    get: function () {\r\n                        const val = this.getAttribute(name);\r\n                        return (val !== null) ? parseFloat(val) : defaultValue;\r\n                    },\r\n                    set: function (value) {\r\n                        if (value !== null) {\r\n                            this.setAttribute(name, value);\r\n                        }\r\n                        else {\r\n                            this.removeAttribute(name);\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            }\r\n            case String:\r\n            default: {\r\n                Object.defineProperty(prototype, propertyName, {\r\n                    get: function () {\r\n                        const val = this.getAttribute(name);\r\n                        return (val !== null) ? val : defaultValue;\r\n                    },\r\n                    set: function (value) {\r\n                        if (value !== null) {\r\n                            this.setAttribute(name, value);\r\n                        }\r\n                        else {\r\n                            this.removeAttribute(name);\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            }\r\n        }\r\n    };\r\n};\r\nfunction Stylesheet(text) {\r\n    const stylesheet = new CSSStyleSheet();\r\n    stylesheet.replaceSync(text);\r\n    return stylesheet;\r\n}\r\nfunction trimMultilineIndent(text) {\r\n    const newlineIndex = text.indexOf(\"\\n\");\r\n    text = text.substring(newlineIndex + 1);\r\n    const indentMatch = text.match(/^[\\s]*/);\r\n    if (indentMatch) {\r\n        const indent = text.substring(0, indentMatch[0].length);\r\n        text = text.replaceAll(indent, \"\").trimEnd();\r\n    }\r\n    return text;\r\n}\r\nconst CustomElement = function (init) {\r\n    return (elementCtor) => {\r\n        const { name, options } = init;\r\n        if (!customElements.get(name)) {\r\n            customElements.define(name, elementCtor, options);\r\n        }\r\n        return elementCtor;\r\n    };\r\n};\r\nconst QueryProperty = function (init) {\r\n    return (target, propertyKey) => {\r\n        const { constructor } = target;\r\n        const { prototype } = constructor;\r\n        const propertyName = String(propertyKey);\r\n        const { selector } = init;\r\n        const withinShadowRoot = init.withinShadowRoot ?? false;\r\n        const getter = withinShadowRoot ? function () {\r\n            return this.shadowRoot.querySelector(selector);\r\n        } : function () {\r\n            return this.querySelector(selector);\r\n        };\r\n        Object.defineProperty(prototype, propertyName, {\r\n            get: getter\r\n        });\r\n    };\r\n};\r\nconst QueryAllProperty = function (init) {\r\n    return (target, propertyKey) => {\r\n        const { constructor } = target;\r\n        const { prototype } = constructor;\r\n        const propertyName = String(propertyKey);\r\n        const { selector } = init;\r\n        const withinShadowRoot = init.withinShadowRoot ?? false;\r\n        const getter = withinShadowRoot ? function () {\r\n            return Array.from(this.shadowRoot.querySelectorAll(selector));\r\n        } : function () {\r\n            return Array.from(this.querySelectorAll(selector));\r\n        };\r\n        Object.defineProperty(prototype, propertyName, {\r\n            get: getter\r\n        });\r\n    };\r\n};\r\nfunction fragment(...nodes) {\r\n    const fragment = document.createDocumentFragment();\r\n    fragment.append(...nodes);\r\n    return fragment;\r\n}\r\nfunction textNode(text) {\r\n    return document.createTextNode(text);\r\n}\r\nfunction element(tagName, init) {\r\n    if (init) {\r\n        const { options, attributes, dataset, children, listeners } = init;\r\n        const element = document.createElement(tagName, options);\r\n        if (attributes) {\r\n            Object.entries(attributes).forEach(([attributeName, attributeValue]) => {\r\n                if (attributeValue !== undefined) {\r\n                    if (typeof attributeValue === \"boolean\") {\r\n                        element.toggleAttribute(camelToTrain(attributeName), attributeValue);\r\n                    }\r\n                    else {\r\n                        element.setAttribute(camelToTrain(attributeName), String(attributeValue));\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        if (dataset) {\r\n            const { dataset: elementDataset } = element;\r\n            Object.entries(dataset).forEach(([attributeName, attributeValue]) => {\r\n                if (typeof attributeValue === \"boolean\") {\r\n                    if (attributeValue) {\r\n                        elementDataset[camelToTrain(attributeName)] = \"\";\r\n                    }\r\n                    else {\r\n                        delete elementDataset[camelToTrain(attributeName)];\r\n                    }\r\n                }\r\n                else {\r\n                    elementDataset[camelToTrain(attributeName)] = String(attributeValue);\r\n                }\r\n            });\r\n        }\r\n        if (children) {\r\n            if (typeof children === \"function\") {\r\n                children(element);\r\n            }\r\n            else if (typeof children === \"object\" && \"length\" in children) {\r\n                element.append(...Array.from(children));\r\n            }\r\n            else {\r\n                element.append(children);\r\n            }\r\n        }\r\n        if (listeners) {\r\n            Object.entries(listeners).forEach(([name_i, listener_i]) => {\r\n                if (Array.isArray(listener_i)) {\r\n                    element.addEventListener(name_i, listener_i[0], listener_i[1]);\r\n                }\r\n                else {\r\n                    element.addEventListener(name_i, listener_i);\r\n                }\r\n            });\r\n        }\r\n        return element;\r\n    }\r\n    return document.createElement(tagName);\r\n}\r\nconst reactiveElementsMap = new WeakMap();\r\nconst reactiveElementsFinalizationRegistry = new FinalizationRegistry((heldValue) => {\r\n    const { model, reactiveElement } = heldValue;\r\n    const reactiveElementsMapEntry = reactiveElementsMap.get(model);\r\n    if (reactiveElementsMapEntry !== undefined) {\r\n        const { reactiveElementsArray } = reactiveElementsMapEntry;\r\n        reactiveElementsArray.splice(reactiveElementsArray.indexOf(reactiveElement), 1);\r\n    }\r\n});\r\nconst reactiveElementsPropertyObserver = new ModelChangeObserver((records) => {\r\n    records.forEach((record_i) => {\r\n        const { target, propertyName, oldValue, newValue } = record_i;\r\n        const { reactiveElementsArray } = reactiveElementsMap.get(target);\r\n        reactiveElementsArray.forEach(reactiveElement_i => {\r\n            const { elementRef, react, properties } = reactiveElement_i;\r\n            const element = elementRef.deref();\r\n            if (element) {\r\n                if (properties.includes(propertyName)) {\r\n                    react(element, propertyName, oldValue, newValue);\r\n                }\r\n            }\r\n        });\r\n    });\r\n});\r\nfunction reactiveElement(model, element, properties, react) {\r\n    const elementRef = new WeakRef(element);\r\n    const reactiveElement = { elementRef, react, properties };\r\n    const reactiveElementsMapEntry = reactiveElementsMap.get(model);\r\n    reactiveElementsFinalizationRegistry.register(element, { model, reactiveElement });\r\n    if (!reactiveElementsMapEntry) {\r\n        const observerOptions = {\r\n            properties: true,\r\n            propertiesFilter: properties\r\n        };\r\n        const reactiveElementsArray = [reactiveElement];\r\n        reactiveElementsMap.set(model, { observerOptions, reactiveElementsArray });\r\n        reactiveElementsPropertyObserver.observe(model, observerOptions);\r\n    }\r\n    else {\r\n        const { reactiveElementsArray, observerOptions } = reactiveElementsMapEntry;\r\n        const { propertiesFilter } = observerOptions;\r\n        reactiveElementsArray.push(reactiveElement);\r\n        observerOptions.propertiesFilter = propertiesFilter ?\r\n            propertiesFilter.concat(properties.filter(property_i => !propertiesFilter.includes(property_i))) : properties.filter((property_i, i, properties) => properties.indexOf(property_i) === i);\r\n    }\r\n    properties.forEach((property_i) => {\r\n        if (property_i in model) {\r\n            const value = Reflect.get(model, property_i, model);\r\n            react(element, property_i, undefined, value);\r\n        }\r\n    });\r\n    return element;\r\n}\r\nfunction revokeReactiveElement(model, element) {\r\n    const reactiveElementsMapEntry = reactiveElementsMap.get(model);\r\n    if (reactiveElementsMapEntry) {\r\n        const { reactiveElementsArray } = reactiveElementsMapEntry;\r\n        const reactiveElementIndex = reactiveElementsArray.findIndex(reactiveElement => reactiveElement.elementRef.deref() === element);\r\n        if (reactiveElementIndex > -1) {\r\n            reactiveElementsArray.splice(reactiveElementIndex, 1);\r\n        }\r\n        if (reactiveElementsArray.length === 0) {\r\n            reactiveElementsMap.delete(model);\r\n        }\r\n    }\r\n}\r\nconst reactiveChildElementsMap = new WeakMap();\r\nconst reactiveChildElementsFinalizationRegistry = new FinalizationRegistry((heldValue) => {\r\n    const { list, reactiveChildElement } = heldValue;\r\n    const reactiveChildrenElementsMapEntry = reactiveChildElementsMap.get(list);\r\n    if (reactiveChildrenElementsMapEntry) {\r\n        const { reactiveChildElementsArray } = reactiveChildrenElementsMapEntry;\r\n        reactiveChildElementsArray.splice(reactiveChildElementsArray.indexOf(reactiveChildElement), 1);\r\n    }\r\n});\r\nconst reactiveChildElementsObserver = new ModelChangeObserver((records) => {\r\n    let range = null;\r\n    Array.from(records.values()).forEach((record_i) => {\r\n        const { target } = record_i;\r\n        const list = target;\r\n        const { length: listLength } = list;\r\n        const { reactiveChildElementsArray } = reactiveChildElementsMap.get(list);\r\n        reactiveChildElementsArray.forEach((reactiveChildElements_i) => {\r\n            const { parentRef, mapping, placeholder } = reactiveChildElements_i;\r\n            const parent = parentRef.deref();\r\n            if (parent) {\r\n                const { firstChild, children } = parent;\r\n                const { length: childrenCount } = children;\r\n                if (placeholder && listLength > 0 && firstChild == placeholder) {\r\n                    parent.removeChild(placeholder);\r\n                }\r\n                const { changeType, LIST_INSERT, LIST_REMOVE, LIST_SORT } = record_i;\r\n                switch (changeType) {\r\n                    case LIST_INSERT: {\r\n                        const { insertedIndex, insertedItems } = record_i;\r\n                        const insertedItemsArray = Array.from(insertedItems.values()).map(mapping);\r\n                        const { length: childrenCount } = children;\r\n                        if (insertedIndex < childrenCount) {\r\n                            children[insertedIndex].before(...insertedItemsArray);\r\n                        }\r\n                        else {\r\n                            parent.append(...insertedItemsArray);\r\n                        }\r\n                        break;\r\n                    }\r\n                    case LIST_REMOVE: {\r\n                        const { removedIndex, removedItems } = record_i;\r\n                        const { length: removedCount } = removedItems;\r\n                        range = range ?? document.createRange();\r\n                        const removeEndIndex = removedIndex + (removedCount - 1);\r\n                        if (removeEndIndex < childrenCount) {\r\n                            range.setStartBefore(children[removedIndex]);\r\n                            range.setEndAfter(children[removeEndIndex]);\r\n                            range.deleteContents();\r\n                        }\r\n                        break;\r\n                    }\r\n                    case LIST_SORT: {\r\n                        const { sortedIndices } = record_i;\r\n                        const childrenArray = Array.from(children);\r\n                        parent.append(...sortedIndices.filter(index_i => index_i < childrenCount).map(index_i => childrenArray[index_i]));\r\n                        break;\r\n                    }\r\n                }\r\n                if (listLength == 0 && placeholder) {\r\n                    parent.append(placeholder);\r\n                }\r\n            }\r\n        });\r\n    });\r\n});\r\nfunction reactiveChildElements(list, mapping, placeholder) {\r\n    return (parent) => {\r\n        const parentRef = new WeakRef(parent);\r\n        const reactiveChildElementsMapEntry = reactiveChildElementsMap.get(list);\r\n        const reactiveChildElement = { parentRef, mapping, placeholder };\r\n        reactiveChildElementsFinalizationRegistry.register(parent, { list, reactiveChildElement });\r\n        if (!reactiveChildElementsMapEntry) {\r\n            const reactiveChildElementsArray = [reactiveChildElement];\r\n            reactiveChildElementsMap.set(list, { reactiveChildElementsArray });\r\n            reactiveChildElementsObserver.observe(list, {\r\n                childList: true\r\n            });\r\n        }\r\n        else {\r\n            const { reactiveChildElementsArray } = reactiveChildElementsMapEntry;\r\n            reactiveChildElementsArray.push(reactiveChildElement);\r\n        }\r\n        const children = list.length == 0 && placeholder ?\r\n            [placeholder] : Array.from(list.values()).map(mapping);\r\n        parent.replaceChildren(...children);\r\n    };\r\n}\r\nfunction revokeReactiveChildElements(list, parent) {\r\n    const reactiveChildElementsMapEntry = reactiveChildElementsMap.get(list);\r\n    if (reactiveChildElementsMapEntry) {\r\n        const { reactiveChildElementsArray } = reactiveChildElementsMapEntry;\r\n        const reactiveChildElementsIndex = reactiveChildElementsArray.findIndex(reactiveChildElement => reactiveChildElement.parentRef.deref() === parent);\r\n        if (reactiveChildElementsIndex > -1) {\r\n            reactiveChildElementsArray.splice(reactiveChildElementsIndex, 1);\r\n        }\r\n        if (reactiveChildElementsArray.length === 0) {\r\n            reactiveChildElementsMap.delete(list);\r\n        }\r\n    }\r\n}\r\nfunction areAttributesMatching(referenceAttributeType, referenceAttributeName, referenceAttributeValue, attributeName, attributeValue) {\r\n    if (referenceAttributeName == attributeName) {\r\n        switch (referenceAttributeType) {\r\n            case \"boolean\":\r\n                return referenceAttributeValue == \"\" && attributeValue == \"\";\r\n            case \"string\":\r\n                return referenceAttributeValue !== \"\" && (referenceAttributeValue == attributeValue);\r\n            case \"list\":\r\n                return (referenceAttributeValue !== \"\" && attributeValue !== null) && new RegExp(`${referenceAttributeValue}\\s*?`, \"g\").test(attributeValue);\r\n        }\r\n    }\r\n    return false;\r\n}\r\nclass AttributeMutationMixinBase {\r\n    attributeName;\r\n    attributeValue;\r\n    attributeType;\r\n    constructor(attributeName, attributeType = \"boolean\", attributeValue = \"\") {\r\n        this.attributeName = attributeName;\r\n        this.attributeType = attributeType;\r\n        this.attributeValue = attributeValue;\r\n    }\r\n    attach() {\r\n        throw new TypeError(\"Not implemented method.\");\r\n    }\r\n    detach() {\r\n        throw new TypeError(\"Not implemented method.\");\r\n    }\r\n}\r\n//# sourceMappingURL=Element.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport DEFAULT_THEME_ARROW_RIGHT_IMAGE from \"../../assets/arrow_right_FILL0_wght400_GRAD0_opsz48.svg\";\r\nimport DEFAULT_THEME_ARROW_DROPDOWN_IMAGE from \"../../assets/arrow_drop_down_FILL0_wght400_GRAD0_opsz48.svg\";\r\nimport DEFAULT_THEME_ARROW_DROPUP_IMAGE from \"../../assets/arrow_drop_up_FILL0_wght400_GRAD0_opsz48.svg\";\r\nimport DEFAULT_THEME_CHECKED_IMAGE from \"../../assets/done_FILL0_wght400_GRAD0_opsz48.svg\";\r\nimport openSansTtf from \"../../assets/fonts/Open_Sans/OpenSans-VariableFont_wdth,wght.ttf\";\r\nimport { ModelObject, ReactiveProperty } from \"../models/Model\";\r\nexport { theme };\r\nexport { DEFAULT_THEME_HOVERED_ITEM_COLOR };\r\nexport { DEFAULT_THEME_FOCUSED_ITEM_COLOR };\r\nexport { DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR };\r\nexport { DEFAULT_THEME_SELECTED_ITEM_COLOR };\r\nexport { DEFAULT_THEME_ACTIVATED_ITEM_COLOR };\r\nexport { DEFAULT_THEME_DROPTARGET_ITEM_COLOR };\r\nexport { DEFAULT_THEME_ARROW_RIGHT_IMAGE };\r\nexport { DEFAULT_THEME_ARROW_DROPDOWN_IMAGE };\r\nexport { DEFAULT_THEME_ARROW_DROPUP_IMAGE };\r\nexport { DEFAULT_THEME_CHECKED_IMAGE };\r\nconst DEFAULT_THEME_TINT = 203;\r\nconst DEFAULT_THEME_ACCENT_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%, 50%)`;\r\nconst DEFAULT_THEME_HOVERED_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 80%, 50%)`;\r\nconst DEFAULT_THEME_FOCUSED_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%, 50%)`;\r\nconst DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%)`;\r\nconst DEFAULT_THEME_SELECTED_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 75%, 75%)`;\r\nconst DEFAULT_THEME_ACTIVATED_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%, 50%)`;\r\nconst DEFAULT_THEME_DROPTARGET_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%, 50%)`;\r\nclass Theme extends ModelObject {\r\n    stylesheet;\r\n    images() {\r\n        return new Map([\r\n            [\"checkedImage\", this.checkedImage],\r\n            [\"arrowRightImage\", this.arrowRightImage],\r\n            [\"arrowDropDownImage\", this.arrowDropDownImage],\r\n            [\"arrowDropUpImage\", this.arrowDropUpImage],\r\n        ]);\r\n    }\r\n    constructor() {\r\n        super();\r\n        this.stylesheet = new CSSStyleSheet();\r\n        this.stylesheet.replace(/*css*/ `\r\n            :root {\r\n                --theme-accent-color: ${DEFAULT_THEME_ACCENT_COLOR};\r\n                --theme-hovered-item-color: ${DEFAULT_THEME_HOVERED_ITEM_COLOR};\r\n                --theme-focused-item-color: ${DEFAULT_THEME_FOCUSED_ITEM_COLOR};\r\n                --theme-focused-item-outline-color: ${DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR};\r\n                --theme-selected-item-color: ${DEFAULT_THEME_SELECTED_ITEM_COLOR};\r\n                --theme-activated-item-color: ${DEFAULT_THEME_ACTIVATED_ITEM_COLOR};\r\n                --theme-droptarget-item-color: ${DEFAULT_THEME_DROPTARGET_ITEM_COLOR};\r\n\r\n                --theme-tint: ${DEFAULT_THEME_TINT};\r\n                --theme-arrow-right-image: url(${DEFAULT_THEME_ARROW_RIGHT_IMAGE});\r\n                --theme-arrow-dropdown-image: url(${DEFAULT_THEME_ARROW_DROPDOWN_IMAGE});\r\n                --theme-arrow-dropup-image: url(${DEFAULT_THEME_ARROW_DROPUP_IMAGE});\r\n                --theme-checked-image: url(${DEFAULT_THEME_ARROW_DROPDOWN_IMAGE});\r\n\r\n                --theme-arrow-color: var(--font-color);\r\n                --theme-arrow-icon-collapsed: var(--arrow-right);\r\n                --theme-arrow-icon-expanded: var(--arrow-dropdown);\r\n\r\n                --theme-sortorder-indicator-color: var(--font-color);\r\n                --theme-sortorder-indicator-ascending: var(--arrow-dropup);\r\n                --theme-sortorder-indicator-descending: var(--arrow-dropdown);\r\n            }\r\n            \r\n            @font-face {\r\n                font-family: \"Open Sans\";\r\n                src: url(${openSansTtf}) format(\"truetype\")\r\n            }\r\n\r\n            :root {\r\n                font-size: 10px;\r\n                font-family: \"Open Sans\";\r\n                accent-color: var(--theme-accent-color);\r\n            }\r\n\r\n            ::selection {\r\n                background-color: var(--theme-selected-item-color);\r\n            }\r\n        `);\r\n        this.addEventListener(\"modelchange\", this.#handleModelChangeEvent.bind(this));\r\n        this.tint = DEFAULT_THEME_TINT;\r\n        this.arrowRightImage = DEFAULT_THEME_ARROW_RIGHT_IMAGE;\r\n        this.arrowDropDownImage = DEFAULT_THEME_ARROW_DROPDOWN_IMAGE;\r\n        this.arrowDropUpImage = DEFAULT_THEME_ARROW_DROPUP_IMAGE;\r\n        this.checkedImage = DEFAULT_THEME_ARROW_DROPDOWN_IMAGE;\r\n    }\r\n    #handleModelChangeEvent() {\r\n        const { stylesheet } = this;\r\n        const variablesMap = stylesheet.cssRules[0].styleMap;\r\n        const records = this.getRecords();\r\n        records.forEach((record) => {\r\n            const { propertyName, newValue } = record;\r\n            switch (propertyName) {\r\n                case \"tint\": {\r\n                    variablesMap.set(\"--theme-tint\", String(newValue));\r\n                    break;\r\n                }\r\n                case \"checkedImage\": {\r\n                    variablesMap.set(\"--theme-checked-image\", `url(${String(newValue)})`);\r\n                    break;\r\n                }\r\n                case \"arrowRightImage\": {\r\n                    variablesMap.set(\"--theme-arrow-right-image\", `url(${String(newValue)})`);\r\n                    break;\r\n                }\r\n                case \"arrowDropDown\": {\r\n                    variablesMap.set(\"--theme-arrow-dropdown-image\", `url(${String(newValue)})`);\r\n                    break;\r\n                }\r\n                case \"arrowDropUp\": {\r\n                    variablesMap.set(\"--theme-arrow-dropup-image\", `url(${String(newValue)})`);\r\n                    break;\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"tint\", void 0);\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"checkedImage\", void 0);\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"arrowRightImage\", void 0);\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"arrowDropDownImage\", void 0);\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"arrowDropUpImage\", void 0);\r\nconst theme = new Theme();\r\n//# sourceMappingURL=Theme.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { DEFAULT_THEME_CHECKED_IMAGE, DEFAULT_THEME_ACTIVATED_ITEM_COLOR, DEFAULT_THEME_FOCUSED_ITEM_COLOR, DEFAULT_THEME_HOVERED_ITEM_COLOR, DEFAULT_THEME_ARROW_RIGHT_IMAGE } from \"../../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, QueryProperty, element } from \"../../Element\";\r\nexport { HTMLEMenuItemElement };\r\nexport { EMenuItem };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEMenuItemElementBase = class HTMLEMenuItemElementBase extends HTMLElement {\r\n    internals;\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"span\", {\r\n            attributes: {\r\n                part: \"icon\"\r\n            }\r\n        }), element(\"span\", {\r\n            attributes: {\r\n                part: \"label\"\r\n            },\r\n            children: [\r\n                element(\"slot\")\r\n            ]\r\n        }), element(\"span\", {\r\n            attributes: {\r\n                part: \"arrow\"\r\n            }\r\n        }), element(\"slot\", {\r\n            attributes: {\r\n                name: \"menu\"\r\n            }\r\n        }));\r\n        style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                user-select: none;\r\n                white-space: nowrap;\r\n                box-sizing: border-box;\r\n            }\r\n            \r\n            :host([disabled]) {\r\n                opacity: 0.38;\r\n                pointer-events: none;\r\n            }\r\n            \r\n            :host(:focus-within) {\r\n                background-color: ${DEFAULT_THEME_FOCUSED_ITEM_COLOR};\r\n            }\r\n            \r\n            :host(:is([type=\"menu\"], [type=\"submenu\"])) ::slotted([slot=\"menu\"]) {\r\n                z-index: 1;\r\n                position: absolute;\r\n            }\r\n            \r\n            :host(:is([type=\"menu\"], [type=\"submenu\"]):not([expanded])) ::slotted([slot=\"menu\"]) {\r\n                width: 0;\r\n                height: 0;\r\n                padding: 0;\r\n                opacity: 0;\r\n                pointer-events: none;\r\n                overflow: hidden;\r\n            }\r\n            \r\n            :host([type=\"submenu\"]) [part=\"icon\"] {\r\n                visibility: hidden;\r\n            }\r\n            \r\n            :host([type=\"menu\"]) [part=\"icon\"],\r\n            :host(:not([type=\"submenu\"])) [part=\"arrow\"] {\r\n                display: none;\r\n            }\r\n            \r\n            :host(:is([type=\"checkbox\"], [type=\"radio\"])[checked]) [part=\"icon\"]::before {\r\n                -webkit-mask-image: var(--theme-arrow-done-image, url(${DEFAULT_THEME_CHECKED_IMAGE}));\r\n                mask-image: var(--theme-arrow-done-image, url(${DEFAULT_THEME_CHECKED_IMAGE}));\r\n                background-color: black;\r\n            }\r\n            \r\n            :host([type=\"submenu\"]) [part=\"arrow\"]::after {\r\n                -webkit-mask-image: var(--theme-arrow-right-image, url(${DEFAULT_THEME_ARROW_RIGHT_IMAGE}));\r\n                mask-image: var(--theme-arrow-right-image, url(${DEFAULT_THEME_ARROW_RIGHT_IMAGE}));\r\n                background-color: black;\r\n            }\r\n            \r\n            [part=\"icon\"],\r\n            [part=\"label\"],\r\n            [part=\"arrow\"] {\r\n                pointer-events: none;\r\n            }\r\n            \r\n            [part=\"icon\"] {\r\n                flex: none;\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                padding: 2px;\r\n                overflow: hidden;\r\n                margin-right: 4px;\r\n            }\r\n            \r\n            [part=\"label\"] {\r\n                flex: auto;\r\n                line-height: 18px;\r\n                padding: 2px;\r\n                margin-left: 8px;\r\n                margin-right: 8px;\r\n            }\r\n            \r\n            :host(:is(:not([type]), [type=\"button\"], [type=\"radio\"], [type=\"checkbox\"])[checked]) [part=\"icon\"] {\r\n                background-color: var(--theme-activated-item-color, ${DEFAULT_THEME_ACTIVATED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host(:is(:not([type]), [type=\"button\"], [type=\"radio\"], [type=\"checkbox\"])) [part=\"icon\"]::before {\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                content: \"\";\r\n                mask-size: 18px 18px;\r\n                -webkit-mask-size: 18px 18px;\r\n\r\n                mask-image: none;\r\n                -webkit-mask-image: none;\r\n                background-color: none;\r\n            }\r\n            \r\n            [part=\"arrow\"] {\r\n                flex: none;\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                margin: 1px 4px 1px 1px;\r\n            }\r\n            \r\n            [part=\"arrow\"]::after {\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                margin: 1px;\r\n                content: \"\";\r\n                mask-size: 18px 18px;\r\n                -webkit-mask-size: 18px 18px;\r\n\r\n                mask-image: none;\r\n                -webkit-mask-image: none;\r\n                background-color: none;\r\n            }\r\n\r\n            :host(:hover):host-context(e-menubar:focus),\r\n            :host(:hover):host-context(e-menubar:not(:focus-within)) {\r\n                background-color: var(--theme-hovered-item-color, ${DEFAULT_THEME_HOVERED_ITEM_COLOR});\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const internals = this.attachInternals();\r\n        this.internals = internals;\r\n        internals.role = \"menuitem\";\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n    }\r\n    connectedCallback() {\r\n        const { tabIndex } = this;\r\n        this.tabIndex = tabIndex;\r\n    }\r\n    attributeChangedCallback(attributeName, oldValue, newValue) {\r\n        const { internals } = this;\r\n        switch (attributeName) {\r\n            case \"type\": {\r\n                switch (newValue) {\r\n                    case \"checkbox\":\r\n                    case \"radio\": {\r\n                        internals.role = `menuitem${newValue}`;\r\n                        break;\r\n                    }\r\n                    default: {\r\n                        internals.role = \"menuitem\";\r\n                        break;\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"checked\": {\r\n                internals.ariaChecked = String(newValue !== null);\r\n                break;\r\n            }\r\n            case \"disabled\": {\r\n                internals.ariaDisabled = String(newValue !== null);\r\n                break;\r\n            }\r\n            case \"expanded\": {\r\n                internals.ariaExpanded = String(newValue !== null);\r\n                break;\r\n            }\r\n            case \"label\": {\r\n                internals.ariaLabel = newValue;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    toggle(force) {\r\n        const { type, expanded } = this;\r\n        switch (type) {\r\n            case \"menu\":\r\n            case \"submenu\": {\r\n                const expand = force ?? !expanded;\r\n                this.expanded = expand;\r\n                if (expand) {\r\n                    this.#positionMenu();\r\n                }\r\n                this.dispatchEvent(new Event(\"toggle\", { bubbles: true }));\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    expand() {\r\n        const { type, expanded } = this;\r\n        switch (type) {\r\n            case \"menu\":\r\n            case \"submenu\": {\r\n                if (!expanded) {\r\n                    this.expanded = true;\r\n                    this.#positionMenu();\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    collapse() {\r\n        const { type, expanded } = this;\r\n        switch (type) {\r\n            case \"menu\":\r\n            case \"submenu\": {\r\n                if (expanded) {\r\n                    this.expanded = false;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    #positionMenu() {\r\n        const { menu } = this;\r\n        if (menu !== null) {\r\n            const { width, height } = this.getBoundingClientRect();\r\n            const { style: menuStyle } = menu;\r\n            const { width: menuWidth, height: menuHeight } = menu.getBoundingClientRect();\r\n            const { clientWidth, clientHeight } = document.body;\r\n            const { type, offsetLeft, offsetTop } = this;\r\n            const overflowX = offsetLeft + width + menuWidth - clientWidth;\r\n            const overflowY = offsetTop + menuHeight - clientHeight;\r\n            if (type === \"menu\") {\r\n                menuStyle.setProperty(\"left\", `${overflowX > 0 ?\r\n                    offsetLeft + width - menuWidth :\r\n                    offsetLeft}px`);\r\n                menuStyle.setProperty(\"top\", `${overflowY > 0 ?\r\n                    offsetTop - menuHeight :\r\n                    offsetTop + height}px`);\r\n            }\r\n            else {\r\n                menuStyle.setProperty(\"left\", `${overflowX > 0 ?\r\n                    offsetLeft - menuWidth :\r\n                    offsetLeft + width}px`);\r\n                menuStyle.setProperty(\"top\", `${overflowY > 0 ?\r\n                    offsetTop + height - menuHeight :\r\n                    offsetTop}px`);\r\n            }\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-menu[slot=menu]\" })\r\n], HTMLEMenuItemElementBase.prototype, \"menu\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuItemElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"label\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuItemElementBase.prototype, \"value\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuItemElementBase.prototype, \"hotkey\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean, observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"disabled\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean, observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"checked\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean, observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"expanded\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuItemElementBase.prototype, \"overflown\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, defaultValue: \"button\", observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"type\", void 0);\r\nHTMLEMenuItemElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-menuitem\"\r\n    })\r\n], HTMLEMenuItemElementBase);\r\nvar HTMLEMenuItemElement = HTMLEMenuItemElementBase;\r\nvar EMenuItem = Object.assign(function (init) {\r\n    const { label, name, type, value, trigger, menu } = init;\r\n    if (menu) {\r\n        menu.slot = \"menu\";\r\n    }\r\n    return element(\"e-menuitem\", {\r\n        attributes: {\r\n            tabindex: -1,\r\n            title: label,\r\n            name: name,\r\n            value: value,\r\n            type: type\r\n        },\r\n        children: menu ? [\r\n            label,\r\n            menu\r\n        ] : [\r\n            label\r\n        ],\r\n        listeners: {\r\n            click: trigger\r\n        }\r\n    });\r\n}, {\r\n    prototype: HTMLEMenuItemElement.prototype,\r\n    button(init) {\r\n        return new EMenuItem({\r\n            ...init, type: \"button\"\r\n        });\r\n    },\r\n    checkbox(init) {\r\n        return new EMenuItem({\r\n            ...init, type: \"checkbox\"\r\n        });\r\n    },\r\n    radio(init) {\r\n        return new EMenuItem({\r\n            ...init, type: \"radio\"\r\n        });\r\n    },\r\n    menu(init) {\r\n        return new EMenuItem({\r\n            ...init, type: \"menu\"\r\n        });\r\n    },\r\n    submenu(init) {\r\n        return new EMenuItem({\r\n            ...init, type: \"submenu\"\r\n        });\r\n    }\r\n});\r\n//# sourceMappingURL=MenuItem.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { element, CustomElement, AttributeProperty } from \"../../Element\";\r\nimport { EMenuItem } from \"./MenuItem\";\r\nimport \"./MenuItem\";\r\nexport { HTMLEMenuItemGroupElement };\r\nexport { EMenuItemGroup };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEMenuItemGroupElementBase = class HTMLEMenuItemGroupElementBase extends HTMLElement {\r\n    internals;\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"span\", {\r\n            attributes: {\r\n                part: \"label\"\r\n            }\r\n        }), element(\"slot\"));\r\n        style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                flex-direction: column;\r\n            }\r\n            \r\n            [part=\"label\"] {\r\n                font-weight: bold;\r\n            }\r\n            \r\n            :host([label]) [part=\"label\"] {\r\n                padding-bottom: 6px;\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        const internals = this.attachInternals();\r\n        internals.role = \"group\";\r\n        this.internals = internals;\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        const { internals } = this;\r\n        switch (name) {\r\n            case \"label\":\r\n                internals.ariaLabel = newValue;\r\n                break;\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuItemGroupElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEMenuItemGroupElementBase.prototype, \"label\", void 0);\r\nHTMLEMenuItemGroupElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-menuitemgroup\"\r\n    })\r\n], HTMLEMenuItemGroupElementBase);\r\nvar HTMLEMenuItemGroupElement = HTMLEMenuItemGroupElementBase;\r\nvar EMenuItemGroup = Object.assign(function (init) {\r\n    const { name, items } = init;\r\n    return element(\"e-menuitemgroup\", {\r\n        attributes: {\r\n            name: name\r\n        },\r\n        children: items\r\n    });\r\n}, {\r\n    prototype: HTMLEMenuItemGroupElement.prototype,\r\n    radios: (init) => {\r\n        const { name, items } = init;\r\n        return element(\"e-menuitemgroup\", {\r\n            attributes: {\r\n                name: name\r\n            },\r\n            children: items.map(({ label, value }) => new EMenuItem({ name, label, type: \"radio\", value }))\r\n        });\r\n    }\r\n});\r\n//# sourceMappingURL=MenuItemGroup.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar HTMLEMenuElementBase_1;\r\nimport { CustomElement, AttributeProperty, element } from \"../../Element\";\r\nimport { HTMLEMenuItemElement } from \"./MenuItem\";\r\nimport { HTMLEMenuItemGroupElement } from \"./MenuItemGroup\";\r\nimport \"./MenuItem\";\r\nimport \"./MenuItemGroup\";\r\nexport { HTMLEMenuElement };\r\nexport { EMenu };\r\nvar shadowTemplate;\r\nvar style;\r\nvar toggleAnimations;\r\nvar HIDE_DELAY_MS = 200;\r\nvar SHOW_DELAY_MS = 400;\r\nlet HTMLEMenuElementBase = HTMLEMenuElementBase_1 = class HTMLEMenuElementBase extends HTMLElement {\r\n    items() {\r\n        return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem\"));\r\n    }\r\n    get activeIndex() {\r\n        return this.#activeIndex;\r\n    }\r\n    get activeItem() {\r\n        const { activeIndex } = this;\r\n        return (this.querySelector(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem:focus-within\") ?? activeIndex > -1) ? this.items()[activeIndex] ?? null : null;\r\n    }\r\n    #walker;\r\n    #activeIndex;\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"slot\"));\r\n        style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                flex-direction: column;\r\n            \r\n                padding: 3px;\r\n                background-color: white;\r\n                width: max-content;\r\n                box-sizing: border-box;\r\n            \r\n                -webkit-box-shadow: rgba(0, 0, 0, 0.2) 0 1px 3px;\r\n                box-shadow: rgba(0, 0, 0, 0.2) 0 1px 3px;\r\n            }\r\n            \r\n            :host([contextual]) {\r\n                z-index: 1;\r\n                position: absolute;\r\n            }\r\n        `;\r\n        toggleAnimations = new WeakMap();\r\n    }\r\n    constructor() {\r\n        super();\r\n        this.#activeIndex = -1;\r\n        this.#walker = document.createTreeWalker(this, NodeFilter.SHOW_ELEMENT, this.#walkerNodeFilter.bind(this));\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"click\", this.#handleClickEvent.bind(this));\r\n        this.addEventListener(\"mouseover\", this.#handleMouseOverEvent.bind(this));\r\n        this.addEventListener(\"mouseout\", this.#handleMouseOutEvent.bind(this));\r\n        this.addEventListener(\"focusin\", this.#handleFocusInEvent.bind(this));\r\n        this.addEventListener(\"focusout\", this.#handleFocusOutEvent.bind(this));\r\n        this.addEventListener(\"keydown\", this.#handleKeyDownEvent.bind(this));\r\n    }\r\n    connectedCallback() {\r\n        const tabindex = this.getAttribute(\"tabindex\");\r\n        this.tabIndex = tabindex !== null ? parseInt(tabindex) : -1;\r\n    }\r\n    positionContextual(x, y) {\r\n        const { style } = this;\r\n        const { width: menuWidth, height: menuHeight } = this.getBoundingClientRect();\r\n        const { scrollX, scrollY } = window;\r\n        const left = x + scrollX;\r\n        const top = y + scrollY;\r\n        const { clientWidth, clientHeight } = document.body;\r\n        const overflowX = left + menuWidth - clientWidth;\r\n        const overflowY = top + menuHeight - clientHeight;\r\n        style.setProperty(\"left\", `${overflowX > 0 ? left - menuWidth : left}px`);\r\n        style.setProperty(\"top\", `${overflowY > 0 ? top - menuHeight : top}px`);\r\n    }\r\n    #collapseSubmenus() {\r\n        this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem[expanded]\")\r\n            .forEach((item_i) => {\r\n            item_i.collapse();\r\n        });\r\n    }\r\n    #nearestItem(target) {\r\n        return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem\")).find(item_i => item_i.contains(target)) ?? null;\r\n    }\r\n    #walkerNodeFilter(node) {\r\n        if (node instanceof HTMLEMenuItemElement) {\r\n            return NodeFilter.FILTER_ACCEPT;\r\n        }\r\n        if (node instanceof HTMLEMenuItemGroupElement) {\r\n            return NodeFilter.FILTER_SKIP;\r\n        }\r\n        return NodeFilter.FILTER_REJECT;\r\n    }\r\n    firstItem() {\r\n        const walker = this.#walker;\r\n        walker.currentNode = walker.root;\r\n        return walker.firstChild();\r\n    }\r\n    #lastItem() {\r\n        const walker = this.#walker;\r\n        walker.currentNode = walker.root;\r\n        return walker.lastChild();\r\n    }\r\n    #previousItem(item) {\r\n        const walker = this.#walker;\r\n        walker.currentNode = item;\r\n        return walker.previousNode();\r\n    }\r\n    #nextItem(item) {\r\n        const walker = this.#walker;\r\n        walker.currentNode = item;\r\n        return walker.nextNode();\r\n    }\r\n    #firstChildItem(item) {\r\n        const { menu } = item;\r\n        return menu instanceof HTMLEMenuElementBase_1 ?\r\n            menu.firstItem() :\r\n            null;\r\n    }\r\n    #setActiveItem(item) {\r\n        if (item !== null) {\r\n            this.#activeIndex = this.items().indexOf(item);\r\n        }\r\n    }\r\n    #handleClickEvent(event) {\r\n        const { target } = event;\r\n        const targetItem = target.closest(\"e-menuitem\");\r\n        if (targetItem) {\r\n            const { type, checked } = targetItem;\r\n            switch (type) {\r\n                case \"checkbox\": {\r\n                    targetItem.checked = !checked;\r\n                    break;\r\n                }\r\n                case \"radio\": {\r\n                    const { name, value } = targetItem;\r\n                    targetItem.checked = true;\r\n                    this.querySelectorAll(`:is(:scope, :scope > e-menuitemgroup) > e-menuitem[type=radio][name=${name}]`)\r\n                        .forEach((radio_i) => {\r\n                        radio_i.checked = radio_i.value == value;\r\n                    });\r\n                    break;\r\n                }\r\n                case \"menu\":\r\n                case \"submenu\": {\r\n                    targetItem.toggle();\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        event.stopPropagation();\r\n    }\r\n    #handleFocusInEvent(event) {\r\n        const { target } = event;\r\n        if (target instanceof HTMLEMenuItemElement) {\r\n            const nearestItem = this.#nearestItem(target);\r\n            if (nearestItem) {\r\n                this.#setActiveItem(nearestItem);\r\n            }\r\n        }\r\n    }\r\n    #handleFocusOutEvent(event) {\r\n        const { relatedTarget } = event;\r\n        const lostFocusWithin = !this.contains(relatedTarget);\r\n        if (lostFocusWithin) {\r\n            const { contextual } = this;\r\n            if (contextual) {\r\n                try {\r\n                    this.remove();\r\n                }\r\n                catch (error) { }\r\n                ;\r\n            }\r\n            else {\r\n                const { activeItem } = this;\r\n                if (activeItem?.expanded) {\r\n                    activeItem.collapse();\r\n                }\r\n                this.#setActiveItem(null);\r\n            }\r\n        }\r\n    }\r\n    #handleKeyDownEvent(event) {\r\n        const { key } = event;\r\n        const { activeItem } = this;\r\n        switch (key) {\r\n            case \"ArrowUp\": {\r\n                const previousItem = activeItem ?\r\n                    this.#previousItem(activeItem) ?? this.#lastItem() :\r\n                    this.firstItem();\r\n                previousItem?.focus({ preventScroll: true });\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n            case \"ArrowDown\": {\r\n                const nextItem = activeItem ?\r\n                    this.#nextItem(activeItem) ?? this.firstItem() :\r\n                    this.firstItem();\r\n                nextItem?.focus({ preventScroll: true });\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n            case \"Home\": {\r\n                const firstItem = this.firstItem();\r\n                firstItem?.focus({ preventScroll: true });\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n            case \"End\": {\r\n                const lastItem = this.#lastItem();\r\n                lastItem?.focus({ preventScroll: true });\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n            case \"Enter\":\r\n            case \" \": {\r\n                if (activeItem) {\r\n                    const { type } = activeItem;\r\n                    switch (type) {\r\n                        case \"menu\":\r\n                        case \"submenu\": {\r\n                            activeItem.expand();\r\n                            if (activeItem.expanded) {\r\n                                const firstChildItem = this.#firstChildItem(activeItem);\r\n                                firstChildItem?.focus({ preventScroll: true });\r\n                            }\r\n                            break;\r\n                        }\r\n                        default: {\r\n                            activeItem.click();\r\n                            break;\r\n                        }\r\n                    }\r\n                    event.stopPropagation();\r\n                }\r\n                break;\r\n            }\r\n            case \"Escape\": {\r\n                if (activeItem) {\r\n                    const isClosestTargetMenu = event.composedPath().find(target_i => target_i instanceof HTMLEMenuElement) == this;\r\n                    if (!isClosestTargetMenu) {\r\n                        activeItem.collapse();\r\n                        activeItem.focus({ preventScroll: true });\r\n                        event.stopPropagation();\r\n                    }\r\n                    else {\r\n                        const { contextual } = this;\r\n                        if (contextual) {\r\n                            this.blur();\r\n                            this.dispatchEvent(new Event(\"close\", { bubbles: true }));\r\n                            event.stopPropagation();\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"ArrowLeft\": {\r\n                if (activeItem) {\r\n                    const isClosestTargetMenu = event.composedPath().find(target_i => target_i instanceof HTMLEMenuElement) == this;\r\n                    if (!isClosestTargetMenu) {\r\n                        activeItem.collapse();\r\n                        activeItem.focus({ preventScroll: true });\r\n                        event.stopPropagation();\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"ArrowRight\": {\r\n                if (activeItem) {\r\n                    const { type } = activeItem;\r\n                    switch (type) {\r\n                        case \"submenu\": {\r\n                            if (!activeItem.expanded) {\r\n                                activeItem.expand();\r\n                                const firstChildItem = this.#firstChildItem(activeItem);\r\n                                firstChildItem?.focus({ preventScroll: true });\r\n                                event.stopPropagation();\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    #handleMouseOutEvent(event) {\r\n        const { target, relatedTarget } = event;\r\n        if (target instanceof HTMLEMenuItemElement) {\r\n            const nearestItem = this.#nearestItem(target);\r\n            if (nearestItem !== null) {\r\n                if (nearestItem.type == \"submenu\" &&\r\n                    !nearestItem.expanded) {\r\n                    toggleAnimations.get(nearestItem)?.cancel();\r\n                }\r\n                const isTargetClosestMenu = event.composedPath().find(target_i => target_i instanceof HTMLEMenuElement) == this;\r\n                if (isTargetClosestMenu) {\r\n                    const { activeItem } = this;\r\n                    if (activeItem?.type == \"submenu\" &&\r\n                        activeItem.expanded) {\r\n                        let toggleAnimation = toggleAnimations.get(activeItem);\r\n                        if (toggleAnimation) {\r\n                            toggleAnimation.cancel();\r\n                        }\r\n                        toggleAnimation = activeItem.animate(null, {\r\n                            duration: HIDE_DELAY_MS\r\n                        });\r\n                        toggleAnimations.set(activeItem, toggleAnimation);\r\n                        const { finished } = toggleAnimation;\r\n                        finished\r\n                            .then(() => {\r\n                            activeItem.collapse();\r\n                        })\r\n                            .catch(() => undefined)\r\n                            .finally(() => {\r\n                            toggleAnimations.delete(activeItem);\r\n                        });\r\n                    }\r\n                    const { left, right, top, bottom } = (() => {\r\n                        const parentItem = this.closest(\"e-menuitem\");\r\n                        if (parentItem && !parentItem.expanded) {\r\n                            parentItem.expand();\r\n                            const menuRect = this.getBoundingClientRect();\r\n                            parentItem.collapse();\r\n                            return menuRect;\r\n                        }\r\n                        else {\r\n                            return this.getBoundingClientRect();\r\n                        }\r\n                    })();\r\n                    const { clientX, clientY } = event;\r\n                    const intersectsWithMouse = !(left > clientX || right < clientX || top > clientY || bottom < clientY);\r\n                    const containsRelatedTarget = this.contains(relatedTarget);\r\n                    if (intersectsWithMouse && containsRelatedTarget) {\r\n                        if (relatedTarget instanceof HTMLEMenuElement && relatedTarget !== this) {\r\n                            relatedTarget.focus({ preventScroll: true });\r\n                        }\r\n                        else {\r\n                            this.focus({ preventScroll: true });\r\n                            this.#setActiveItem(null);\r\n                        }\r\n                    }\r\n                    if (!intersectsWithMouse) {\r\n                        this.focus({ preventScroll: true });\r\n                        this.#setActiveItem(null);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    #handleMouseOverEvent(event) {\r\n        const { target } = event;\r\n        if (target instanceof HTMLEMenuItemElement) {\r\n            const nearestItem = this.#nearestItem(target);\r\n            if (nearestItem !== null) {\r\n                if (nearestItem.type === \"submenu\" && nearestItem.expanded) {\r\n                    toggleAnimations.get(nearestItem)?.cancel();\r\n                }\r\n                const isTargetClosestMenu = event.composedPath().find(target_i => target_i instanceof HTMLEMenuElement) == this;\r\n                if (isTargetClosestMenu) {\r\n                    const { activeItem } = this;\r\n                    if (activeItem?.type === \"submenu\" &&\r\n                        activeItem.expanded &&\r\n                        !activeItem.contains(target)) {\r\n                        let toggleAnimation = toggleAnimations.get(activeItem);\r\n                        if (toggleAnimation) {\r\n                            toggleAnimation.cancel();\r\n                        }\r\n                        toggleAnimation = activeItem.animate(null, {\r\n                            duration: SHOW_DELAY_MS\r\n                        });\r\n                        toggleAnimations.set(activeItem, toggleAnimation);\r\n                        const { finished } = toggleAnimation;\r\n                        finished\r\n                            .then(() => {\r\n                            activeItem.collapse();\r\n                        })\r\n                            .catch(() => undefined)\r\n                            .finally(() => {\r\n                            toggleAnimations.delete(activeItem);\r\n                        });\r\n                    }\r\n                    this.#setActiveItem(nearestItem);\r\n                    nearestItem.focus({ preventScroll: true });\r\n                    if (nearestItem.type === \"submenu\") {\r\n                        if (!nearestItem.expanded) {\r\n                            let toggleAnimation = toggleAnimations.get(nearestItem);\r\n                            if (toggleAnimation) {\r\n                                toggleAnimation.cancel();\r\n                            }\r\n                            toggleAnimation = nearestItem.animate(null, {\r\n                                duration: HIDE_DELAY_MS\r\n                            });\r\n                            toggleAnimations.set(nearestItem, toggleAnimation);\r\n                            const { finished } = toggleAnimation;\r\n                            finished\r\n                                .then(() => {\r\n                                const { activeItem } = this;\r\n                                this.#collapseSubmenus();\r\n                                if (activeItem) {\r\n                                    toggleAnimations.get(activeItem)?.cancel();\r\n                                    activeItem.expand();\r\n                                    activeItem.menu?.focus({ preventScroll: true });\r\n                                }\r\n                            })\r\n                                .catch(() => undefined)\r\n                                .finally(() => {\r\n                                toggleAnimations.delete(nearestItem);\r\n                            });\r\n                        }\r\n                        else {\r\n                            nearestItem.menu?.focus({ preventScroll: true });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuElementBase.prototype, \"contextual\", void 0);\r\nHTMLEMenuElementBase = HTMLEMenuElementBase_1 = __decorate([\r\n    CustomElement({\r\n        name: \"e-menu\"\r\n    })\r\n], HTMLEMenuElementBase);\r\nvar HTMLEMenuElement = HTMLEMenuElementBase;\r\nvar EMenu = Object.assign(function (init) {\r\n    const { name, children } = init;\r\n    return element(\"e-menu\", {\r\n        attributes: {\r\n            name: name,\r\n            tabindex: -1,\r\n        },\r\n        children: children\r\n    });\r\n}, {\r\n    prototype: HTMLEMenuElement.prototype,\r\n});\r\n//# sourceMappingURL=Menu.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR } from \"../../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, element } from \"../../Element\";\r\nimport { HTMLEMenuItemElement } from \"./MenuItem\";\r\nimport { HTMLEMenuItemGroupElement } from \"./MenuItemGroup\";\r\nimport \"./Menu\";\r\nimport \"./MenuItem\";\r\nimport \"./MenuItemGroup\";\r\nexport { HTMLEMenuBarElement };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEMenuBarElementBase = class HTMLEMenuBarElementBase extends HTMLElement {\r\n    #activeIndex;\r\n    #walker;\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"slot\"));\r\n        style = /*css*/ `\r\n            :host {\r\n                position: relative;\r\n                display: flex;\r\n                flex-direction: row;\r\n                width: max-content;\r\n            }\r\n            \r\n            :host(:focus) {\r\n                outline: 1px solid var(--theme-focused-item-outline-color, ${DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR});\r\n                outline-offset: -1px;\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        this.#walker = document.createTreeWalker(this, NodeFilter.SHOW_ELEMENT, this.#walkerNodeFilter.bind(this));\r\n        this.#activeIndex = -1;\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"click\", this.#handleClickEvent.bind(this));\r\n        this.addEventListener(\"focus\", this.#handleFocusEvent.bind(this));\r\n        this.addEventListener(\"focusin\", this.#handleFocusInEvent.bind(this));\r\n        this.addEventListener(\"focusout\", this.#handleFocusOutEvent.bind(this));\r\n        this.addEventListener(\"mouseover\", this.#handleMouseOverEvent.bind(this));\r\n        this.addEventListener(\"keydown\", this.#handleKeyDownEvent.bind(this));\r\n    }\r\n    connectedCallback() {\r\n        const tabindex = this.getAttribute(\"tabindex\");\r\n        this.tabIndex = tabindex !== null ? parseInt(tabindex) : -1;\r\n    }\r\n    items() {\r\n        return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem\"));\r\n    }\r\n    get activeIndex() {\r\n        return this.#activeIndex;\r\n    }\r\n    get activeItem() {\r\n        const { activeIndex } = this;\r\n        return (this.querySelector(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem:focus-within\") ?? activeIndex > -1) ? this.items()[activeIndex] ?? null : null;\r\n    }\r\n    #walkerNodeFilter(node) {\r\n        if (node instanceof HTMLEMenuItemElement && !(node.disabled || node.hidden)) {\r\n            return NodeFilter.FILTER_ACCEPT;\r\n        }\r\n        if (node instanceof HTMLEMenuItemGroupElement) {\r\n            return NodeFilter.FILTER_SKIP;\r\n        }\r\n        return NodeFilter.FILTER_REJECT;\r\n    }\r\n    firstItem() {\r\n        const walker = this.#walker;\r\n        walker.currentNode = walker.root;\r\n        return walker.firstChild();\r\n    }\r\n    #lastItem() {\r\n        const walker = this.#walker;\r\n        walker.currentNode = walker.root;\r\n        return walker.lastChild();\r\n    }\r\n    #previousItem(item) {\r\n        const walker = this.#walker;\r\n        walker.currentNode = item;\r\n        return walker.previousSibling();\r\n    }\r\n    #nextItem(item) {\r\n        const walker = this.#walker;\r\n        walker.currentNode = item;\r\n        return walker.nextSibling();\r\n    }\r\n    #firstChildItem(item) {\r\n        const { menu } = item;\r\n        if (menu) {\r\n            const walker = this.#walker;\r\n            walker.currentNode = menu;\r\n            return walker.firstChild();\r\n        }\r\n        return null;\r\n    }\r\n    #setActiveItem(item) {\r\n        const { activeItem, expanded } = this;\r\n        if (activeItem !== null && activeItem !== item) {\r\n            activeItem.collapse();\r\n        }\r\n        if (item !== null) {\r\n            if (expanded) {\r\n                item.expand();\r\n            }\r\n            this.#activeIndex = this.items().indexOf(item);\r\n        }\r\n        else {\r\n            this.#activeIndex = -1;\r\n        }\r\n    }\r\n    get #items() {\r\n        return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem\"));\r\n    }\r\n    #isClosestMenu(target) {\r\n        return target.closest(\":is(e-menubar, e-menu)\") == this;\r\n    }\r\n    #nearestItem(target) {\r\n        return this.#items.find(item_i => item_i.contains(target)) ?? null;\r\n    }\r\n    #handleFocusEvent(event) {\r\n        const { relatedTarget } = event;\r\n        const { activeItem } = this;\r\n        if (!this.contains(relatedTarget)) {\r\n            (activeItem ?? this.firstItem())?.focus();\r\n        }\r\n    }\r\n    #handleFocusInEvent(event) {\r\n        const { target } = event;\r\n        if (target instanceof Element) {\r\n            const nearestItem = this.#nearestItem(target);\r\n            this.#setActiveItem(nearestItem);\r\n            this.tabIndex = -1;\r\n        }\r\n    }\r\n    #handleFocusOutEvent(event) {\r\n        const { target, relatedTarget } = event;\r\n        if (target instanceof HTMLElement) {\r\n            const nearestItem = this.#nearestItem(target);\r\n            if (nearestItem) {\r\n                nearestItem.collapse();\r\n            }\r\n        }\r\n        const lostFocusWithin = !this.contains(relatedTarget);\r\n        if (lostFocusWithin) {\r\n            this.expanded = false;\r\n            this.tabIndex = 0;\r\n        }\r\n    }\r\n    #handleMouseOverEvent(event) {\r\n        const { target } = event;\r\n        const { expanded, activeItem } = this;\r\n        if (target instanceof HTMLEMenuItemElement) {\r\n            const isClosestMenu = this.#isClosestMenu(target);\r\n            if (isClosestMenu && target !== activeItem && expanded) {\r\n                const { menu } = target;\r\n                if (menu) {\r\n                    target.expand();\r\n                    menu.focus({ preventScroll: true });\r\n                }\r\n            }\r\n        }\r\n    }\r\n    #handleClickEvent(event) {\r\n        const { target } = event;\r\n        const { expanded, activeItem } = this;\r\n        if (target instanceof HTMLEMenuItemElement) {\r\n            const isClosestMenu = this.#isClosestMenu(target);\r\n            if (isClosestMenu) {\r\n                const isExpanded = !expanded;\r\n                this.expanded = isExpanded;\r\n                if (isExpanded) {\r\n                    if (activeItem && !activeItem.expanded) {\r\n                        activeItem.expand();\r\n                    }\r\n                    const { menu } = target;\r\n                    menu?.focus({ preventScroll: true });\r\n                }\r\n                else {\r\n                    if (activeItem) {\r\n                        activeItem.collapse();\r\n                        activeItem.blur();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    #handleKeyDownEvent(event) {\r\n        const { key } = event;\r\n        const { expanded } = this;\r\n        let { activeItem } = this;\r\n        switch (key) {\r\n            case \"ArrowLeft\": {\r\n                const previousItem = activeItem ?\r\n                    this.#previousItem(activeItem) ?? this.#lastItem() :\r\n                    this.firstItem();\r\n                previousItem?.focus({ preventScroll: true });\r\n                ({ activeItem } = this);\r\n                if (expanded && activeItem) {\r\n                    const firstChildItem = this.#firstChildItem(activeItem);\r\n                    firstChildItem?.focus({ preventScroll: true });\r\n                }\r\n                break;\r\n            }\r\n            case \"ArrowRight\": {\r\n                const nextItem = activeItem ?\r\n                    this.#nextItem(activeItem) ?? this.firstItem() :\r\n                    this.#lastItem();\r\n                nextItem?.focus({ preventScroll: true });\r\n                ({ activeItem } = this);\r\n                if (expanded && activeItem) {\r\n                    const firstChildItem = this.#firstChildItem(activeItem);\r\n                    firstChildItem?.focus({ preventScroll: true });\r\n                }\r\n                break;\r\n            }\r\n            case \"Enter\":\r\n            case \" \": {\r\n                if (activeItem) {\r\n                    this.expanded = !expanded;\r\n                    if (!expanded) {\r\n                        const firstChildItem = this.#firstChildItem(activeItem);\r\n                        firstChildItem?.focus({ preventScroll: true });\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"Escape\": {\r\n                if (expanded) {\r\n                    this.expanded = false;\r\n                    if (activeItem) {\r\n                        activeItem.collapse();\r\n                        activeItem.focus({ preventScroll: true });\r\n                    }\r\n                }\r\n                else {\r\n                    this.focus({ preventScroll: true });\r\n                }\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuBarElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuBarElementBase.prototype, \"expanded\", void 0);\r\nHTMLEMenuBarElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-menubar\"\r\n    })\r\n], HTMLEMenuBarElementBase);\r\nvar HTMLEMenuBarElement = HTMLEMenuBarElementBase;\r\n//# sourceMappingURL=MenuBar.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR, DEFAULT_THEME_FOCUSED_ITEM_COLOR, DEFAULT_THEME_HOVERED_ITEM_COLOR } from \"../../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, element, QueryProperty } from \"../../Element\";\r\nimport \"./Menu\";\r\nimport \"./MenuItem\";\r\nimport \"./MenuItemGroup\";\r\nexport { HTMLEMenuButtonElement };\r\nexport { EMenuButton };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEMenuButtonElementBase = class HTMLEMenuButtonElementBase extends HTMLElement {\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"slot\"), element(\"slot\", {\r\n            attributes: {\r\n                name: \"menu\"\r\n            }\r\n        }));\r\n        style = /*css*/ `\r\n            :host {\r\n                position: relative;\r\n                display: inline-block;\r\n                padding: 2px;\r\n                line-height: 18px;\r\n                user-select: none;\r\n                white-space: nowrap;\r\n                cursor: pointer;\r\n            }\r\n            \r\n            :host(:focus) {\r\n                outline: 1px solid var(--theme-focused-item-outline-color, ${DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR});\r\n                outline-offset: -1px;\r\n            }\r\n            \r\n            :host(:focus-within:not(:focus)) {\r\n                background-color: var(--theme-focused-item-color, ${DEFAULT_THEME_FOCUSED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host(:hover:not(:focus-within)) {\r\n                background-color: var(--theme-hovered-item-color, ${DEFAULT_THEME_HOVERED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host([disabled]) {\r\n                color: lightgray;\r\n            }\r\n            \r\n            ::slotted([slot=\"menu\"]) {\r\n                z-index: 1;\r\n                position: absolute;\r\n                color: initial;\r\n            }\r\n            \r\n            :host(:not([expanded])) ::slotted([slot=\"menu\"]) {\r\n                opacity: 0;\r\n                pointer-events: none;\r\n            }\r\n            \r\n            :host::after {\r\n                display: inline-block;\r\n                text-align: center;\r\n                width: 18px;\r\n                height: 18px;\r\n                content: \"▾\";\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"keydown\", this.#handleKeyDownEvent.bind(this));\r\n        this.addEventListener(\"click\", this.#handleClickEvent.bind(this));\r\n        this.addEventListener(\"focusout\", this.#handleFocusOutEvent.bind(this));\r\n    }\r\n    connectedCallback() {\r\n        const tabindex = this.getAttribute(\"tabindex\");\r\n        this.tabIndex = tabindex !== null ? parseInt(tabindex) : -1;\r\n    }\r\n    toggle(force) {\r\n        const { expanded } = this;\r\n        const expand = force ?? !expanded;\r\n        expand ? this.expand() : this.collapse();\r\n    }\r\n    expand() {\r\n        const { expanded } = this;\r\n        if (!expanded) {\r\n            this.expanded = true;\r\n            this.#positionMenu();\r\n        }\r\n    }\r\n    collapse() {\r\n        const { expanded } = this;\r\n        if (expanded) {\r\n            this.expanded = false;\r\n        }\r\n    }\r\n    #positionMenu() {\r\n        const { menu } = this;\r\n        if (menu !== null) {\r\n            const { width, height } = this.getBoundingClientRect();\r\n            const { style: menuStyle } = menu;\r\n            const { width: menuWidth, height: menuHeight } = menu.getBoundingClientRect();\r\n            const { clientWidth, clientHeight } = document.body;\r\n            const { offsetLeft, offsetTop } = this;\r\n            const overflowX = offsetLeft + width + menuWidth - clientWidth;\r\n            const overflowY = offsetTop + menuHeight - clientHeight;\r\n            menuStyle.setProperty(\"left\", `${overflowX > 0 ?\r\n                width - menuWidth :\r\n                0}px`);\r\n            menuStyle.setProperty(\"top\", `${overflowY > 0 ?\r\n                -menuHeight :\r\n                height}px`);\r\n        }\r\n    }\r\n    #handleClickEvent(event) {\r\n        const { target } = event;\r\n        const { menu } = this;\r\n        if (menu && !menu.contains(target)) {\r\n            this.toggle();\r\n            const { expanded } = this;\r\n            if (expanded) {\r\n                menu?.focus({ preventScroll: true });\r\n            }\r\n        }\r\n    }\r\n    #handleFocusOutEvent(event) {\r\n        const { relatedTarget } = event;\r\n        const lostFocusWithin = !this.contains(relatedTarget);\r\n        if (lostFocusWithin) {\r\n            this.collapse();\r\n        }\r\n    }\r\n    #handleKeyDownEvent(event) {\r\n        const { key } = event;\r\n        const { expanded } = this;\r\n        switch (key) {\r\n            case \"ArrowDown\":\r\n            case \"Enter\":\r\n                if (!expanded) {\r\n                    this.expand();\r\n                    this.firstItem?.focus({ preventScroll: true });\r\n                    event.stopPropagation();\r\n                }\r\n                break;\r\n            case \"Escape\":\r\n                if (expanded) {\r\n                    this.collapse();\r\n                }\r\n                this.focus({ preventScroll: true });\r\n                event.stopPropagation();\r\n                break;\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-menu[slot=menu]\" })\r\n], HTMLEMenuButtonElementBase.prototype, \"menu\", void 0);\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-menu[slot=menu] e-menuitem\" })\r\n], HTMLEMenuButtonElementBase.prototype, \"firstItem\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuButtonElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuButtonElementBase.prototype, \"disabled\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuButtonElementBase.prototype, \"expanded\", void 0);\r\nHTMLEMenuButtonElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-menubutton\"\r\n    })\r\n], HTMLEMenuButtonElementBase);\r\nvar HTMLEMenuButtonElement = HTMLEMenuButtonElementBase;\r\nvar EMenuButton = Object.assign(function (init) {\r\n    const { menu } = init;\r\n    menu.slot = \"menu\";\r\n    return element(\"e-menubutton\", {\r\n        attributes: {\r\n            tabindex: -1\r\n        },\r\n        children: [menu]\r\n    });\r\n}, {\r\n    prototype: HTMLEMenuButtonElement.prototype,\r\n});\r\n//# sourceMappingURL=MenuButton.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { DEFAULT_THEME_ACTIVATED_ITEM_COLOR, DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR, DEFAULT_THEME_HOVERED_ITEM_COLOR } from \"../../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, element, QueryProperty } from \"../../Element\";\r\nexport { HTMLEToolBarItemElement };\r\nexport { EToolBarItem };\r\nvar shadowTemplate;\r\nvar style;\r\nvar iconPartTemplate;\r\nlet HTMLEToolBarItemElementBase = class HTMLEToolBarItemElementBase extends HTMLElement {\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"slot\"), element(\"slot\", {\r\n            attributes: {\r\n                name: \"select\"\r\n            }\r\n        }), element(\"slot\", {\r\n            attributes: {\r\n                name: \"menubutton\"\r\n            }\r\n        }));\r\n        iconPartTemplate = element(\"span\", {\r\n            attributes: {\r\n                part: \"icon\"\r\n            }\r\n        });\r\n        style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                user-select: none;\r\n                white-space: nowrap;\r\n                cursor: pointer;\r\n                line-height: 22px;\r\n            }\r\n            \r\n            :host([disabled]) {\r\n                opacity: 0.38;\r\n                pointer-events: none;\r\n            }\r\n            \r\n            :host(:hover) {\r\n                background-color: var(--theme-hovered-item-color, ${DEFAULT_THEME_HOVERED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host([pressed]),\r\n            :host(:active) {\r\n                background-color: var(--theme-activated-item-color, ${DEFAULT_THEME_ACTIVATED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host(:not([iconed])) [part=\"icon\"] {\r\n                display: none;\r\n            }\r\n\r\n            [part=\"icon\"] {\r\n                flex: none;\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                padding: 2px;\r\n                overflow: hidden;\r\n            }\r\n            \r\n            [part=\"icon\"]::before {\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                content: \"\";\r\n                mask-size: 18px 18px;\r\n                -webkit-mask-size: 18px 18px;\r\n                background-color: none;\r\n                -webkit-mask-image: none;\r\n                mask-image: none;\r\n                filter: none;\r\n            }\r\n            \r\n            :host(:focus) {\r\n                outline: 1px solid var(--theme-focused-item-outline-color, ${DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR});\r\n                outline-offset: -1px;\r\n            }\r\n            \r\n            :host([type=\"select\"]:focus) ::slotted(e-select) {\r\n                border-color: transparent;\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"focusin\", () => {\r\n            console.log(\"in\");\r\n        });\r\n        this.addEventListener(\"focusout\", () => {\r\n            console.log(\"out\");\r\n        });\r\n    }\r\n    connectedCallback() {\r\n        const { tabIndex } = this;\r\n        this.tabIndex = tabIndex;\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"label\": {\r\n                //...\r\n                break;\r\n            }\r\n            case \"iconed\": {\r\n                const { shadowRoot } = this;\r\n                if (newValue !== null) {\r\n                    shadowRoot.prepend(iconPartTemplate.cloneNode(true));\r\n                }\r\n                else {\r\n                    const iconPart = this.#icon();\r\n                    if (iconPart) {\r\n                        iconPart.remove();\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    #icon() {\r\n        return this.shadowRoot.querySelector(\"[part=icon]\");\r\n    }\r\n};\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-menubutton[slot=menubutton]\" })\r\n], HTMLEToolBarItemElementBase.prototype, \"menubutton\", void 0);\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-select[slot=select]\" })\r\n], HTMLEToolBarItemElementBase.prototype, \"select\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEToolBarItemElementBase.prototype, \"active\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEToolBarItemElementBase.prototype, \"pressed\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEToolBarItemElementBase.prototype, \"expanded\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean, observed: true })\r\n], HTMLEToolBarItemElementBase.prototype, \"iconed\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEToolBarItemElementBase.prototype, \"value\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarItemElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEToolBarItemElementBase.prototype, \"label\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarItemElementBase.prototype, \"type\", void 0);\r\nHTMLEToolBarItemElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-toolbaritem\"\r\n    })\r\n], HTMLEToolBarItemElementBase);\r\nvar HTMLEToolBarItemElement = HTMLEToolBarItemElementBase;\r\nvar EToolBarItem = Object.assign(function (init) {\r\n    const { label, name, type, value, trigger, menubutton, select } = init;\r\n    if (menubutton) {\r\n        menubutton.slot = \"menubutton\";\r\n    }\r\n    if (select) {\r\n        select.slot = \"select\";\r\n    }\r\n    return element(\"e-toolbaritem\", {\r\n        attributes: {\r\n            tabindex: -1,\r\n            title: label,\r\n            name: name,\r\n            value: value,\r\n            type: type\r\n        },\r\n        children: menubutton ? [menubutton] : select ? [select] : undefined,\r\n        listeners: {\r\n            click: trigger\r\n        }\r\n    });\r\n}, {\r\n    prototype: HTMLEToolBarItemElement.prototype,\r\n    button(init) {\r\n        return new EToolBarItem({\r\n            ...init, type: \"button\"\r\n        });\r\n    },\r\n    checkbox(init) {\r\n        return new EToolBarItem({\r\n            ...init, type: \"checkbox\"\r\n        });\r\n    },\r\n    radio(init) {\r\n        return new EToolBarItem({\r\n            ...init, type: \"radio\"\r\n        });\r\n    },\r\n    menubutton(init) {\r\n        return new EToolBarItem({\r\n            ...init, type: \"menubutton\"\r\n        });\r\n    },\r\n    select(init) {\r\n        return new EToolBarItem({\r\n            ...init, type: \"select\"\r\n        });\r\n    },\r\n});\r\n//# sourceMappingURL=ToolBarItem.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { element, CustomElement, AttributeProperty } from \"../../Element\";\r\nimport \"./ToolBarItem\";\r\nexport { HTMLEToolBarItemGroupElement };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEToolBarItemGroupElementBase = class HTMLEToolBarItemGroupElementBase extends HTMLElement {\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"slot\"));\r\n        style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                width: max-content;\r\n                flex-direction: row;\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"label\": {\r\n                const label = this.shadowRoot.querySelector(\"[part='label']\");\r\n                if (label) {\r\n                    label.textContent = newValue;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarItemGroupElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEToolBarItemGroupElementBase.prototype, \"label\", void 0);\r\nHTMLEToolBarItemGroupElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-toolbaritemgroup\"\r\n    })\r\n], HTMLEToolBarItemGroupElementBase);\r\nvar HTMLEToolBarItemGroupElement = HTMLEToolBarItemGroupElementBase;\r\n//# sourceMappingURL=ToolBarItemGroup.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { CustomElement, AttributeProperty, element } from \"../../Element\";\r\nimport { HTMLEToolBarItemElement } from \"./ToolBarItem\";\r\nimport { HTMLEToolBarItemGroupElement } from \"./ToolBarItemGroup\";\r\nimport \"./ToolBarItem\";\r\nimport \"./ToolBarItemGroup\";\r\nexport { HTMLEToolBarElement };\r\nvar shadowTemplate;\r\nvar style;\r\nvar wasExpandedOnMouseDown;\r\nlet HTMLEToolBarElementBase = class HTMLEToolBarElementBase extends HTMLElement {\r\n    get activeItem() {\r\n        return this.querySelector(\"e-toolbaritem[active]\");\r\n    }\r\n    items() {\r\n        return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-toolbaritemgroup) > e-toolbaritem\"));\r\n    }\r\n    #walker;\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"slot\"));\r\n        wasExpandedOnMouseDown = new WeakMap();\r\n        style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                flex-direction: row;\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        this.#walker = document.createTreeWalker(this, NodeFilter.SHOW_ELEMENT, this.#nodeFilter.bind(this));\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"click\", this.#handleClickEvent.bind(this));\r\n        this.addEventListener(\"contextmenu\", this.#handleContextMenuEvent.bind(this));\r\n        this.addEventListener(\"dblclick\", this.#handleDblClickEvent.bind(this));\r\n        this.addEventListener(\"focus\", this.#handleFocusEvent.bind(this));\r\n        this.addEventListener(\"focusin\", this.#handleFocusInEvent.bind(this));\r\n        this.addEventListener(\"focusout\", this.#handleFocusOutEvent.bind(this));\r\n        this.addEventListener(\"mousedown\", this.#handleMouseDownEvent.bind(this));\r\n        this.addEventListener(\"keydown\", this.#handleKeyDownEvent.bind(this));\r\n    }\r\n    connectedCallback() {\r\n        const { tabIndex } = this;\r\n        this.tabIndex = tabIndex;\r\n    }\r\n    #nodeFilter(node) {\r\n        if (node instanceof HTMLEToolBarItemElement) {\r\n            return NodeFilter.FILTER_ACCEPT;\r\n        }\r\n        if (node instanceof HTMLEToolBarItemGroupElement) {\r\n            return NodeFilter.FILTER_SKIP;\r\n        }\r\n        return NodeFilter.FILTER_REJECT;\r\n    }\r\n    firstItem() {\r\n        const walker = this.#walker;\r\n        walker.currentNode = walker.root;\r\n        return walker.firstChild();\r\n    }\r\n    #lastItem() {\r\n        const walker = this.#walker;\r\n        walker.currentNode = walker.root;\r\n        return walker.lastChild();\r\n    }\r\n    #previousItem(item) {\r\n        const walker = this.#walker;\r\n        walker.currentNode = item;\r\n        const previousItem = walker.previousSibling();\r\n        return previousItem;\r\n    }\r\n    #nextItem(item) {\r\n        const walker = this.#walker;\r\n        walker.currentNode = item;\r\n        return walker.nextSibling();\r\n    }\r\n    #setActiveItem(item) {\r\n        const { activeItem } = this;\r\n        if (activeItem !== null && activeItem !== item) {\r\n            activeItem.active = false;\r\n        }\r\n        if (item !== null) {\r\n            item.active = true;\r\n        }\r\n    }\r\n    #handleClickEvent(event) {\r\n        const { target } = event;\r\n        const targetItem = target.closest(\"e-toolbaritem\");\r\n        if (targetItem) {\r\n            const { type, pressed } = targetItem;\r\n            switch (type) {\r\n                case \"checkbox\": {\r\n                    targetItem.pressed = !pressed;\r\n                    break;\r\n                }\r\n                case \"radio\": {\r\n                    targetItem.pressed = true;\r\n                    break;\r\n                }\r\n                case \"menubutton\": {\r\n                    const { menubutton } = targetItem;\r\n                    if (menubutton && !menubutton.contains(target)) {\r\n                        const expand = !wasExpandedOnMouseDown.get(targetItem);\r\n                        menubutton.toggle(expand);\r\n                        if (expand) {\r\n                            menubutton.firstItem?.focus({ preventScroll: true });\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case \"select\": {\r\n                    const { select } = targetItem;\r\n                    if (select && !select.contains(target)) {\r\n                        const expand = !wasExpandedOnMouseDown.get(targetItem);\r\n                        select.toggle(expand);\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        event.stopPropagation();\r\n    }\r\n    #handleContextMenuEvent(event) {\r\n        event.stopPropagation();\r\n    }\r\n    #handleDblClickEvent(event) {\r\n        event.stopPropagation();\r\n    }\r\n    #handleFocusEvent(event) {\r\n        const { relatedTarget } = event;\r\n        const { activeItem } = this;\r\n        if (!this.contains(relatedTarget)) {\r\n            (activeItem ?? this.firstItem())?.focus();\r\n        }\r\n    }\r\n    #handleFocusInEvent(event) {\r\n        const { target } = event;\r\n        const targetItem = target.closest(\"e-toolbaritem\");\r\n        if (targetItem) {\r\n            this.#setActiveItem(targetItem);\r\n            this.tabIndex = -1;\r\n        }\r\n    }\r\n    #handleFocusOutEvent(event) {\r\n        const { relatedTarget } = event;\r\n        const lostFocusWithin = !this.contains(relatedTarget);\r\n        if (lostFocusWithin) {\r\n            this.tabIndex = 0;\r\n        }\r\n    }\r\n    #handleMouseDownEvent(event) {\r\n        const { target } = event;\r\n        const targetItem = target.closest(\"e-toolbaritem\");\r\n        if (targetItem) {\r\n            const { type } = targetItem;\r\n            switch (type) {\r\n                case \"menubutton\": {\r\n                    const { menubutton } = targetItem;\r\n                    if (menubutton && !menubutton.contains(target)) {\r\n                        wasExpandedOnMouseDown.set(targetItem, menubutton.expanded);\r\n                    }\r\n                    break;\r\n                }\r\n                case \"select\": {\r\n                    const { select } = targetItem;\r\n                    if (select && !select.contains(target)) {\r\n                        wasExpandedOnMouseDown.set(targetItem, select.expanded);\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    #handleKeyDownEvent(event) {\r\n        const { key } = event;\r\n        const { activeItem } = this;\r\n        switch (key) {\r\n            case \"Enter\":\r\n            case \" \": {\r\n                if (activeItem) {\r\n                    const { type } = activeItem;\r\n                    switch (type) {\r\n                        case \"menubutton\": {\r\n                            const { menubutton } = activeItem;\r\n                            if (menubutton) {\r\n                                menubutton.expand();\r\n                                menubutton.firstItem?.focus({ preventScroll: true });\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"select\": {\r\n                            const { select } = activeItem;\r\n                            if (select) {\r\n                                select.expand();\r\n                            }\r\n                            break;\r\n                        }\r\n                        default: {\r\n                            activeItem.click();\r\n                            break;\r\n                        }\r\n                    }\r\n                    event.stopPropagation();\r\n                }\r\n                break;\r\n            }\r\n            case \"ArrowLeft\": {\r\n                if (activeItem) {\r\n                    const previousItem = this.#previousItem(activeItem);\r\n                    if (previousItem) {\r\n                        previousItem.focus({ preventScroll: true });\r\n                    }\r\n                }\r\n                else {\r\n                    const firstItem = this.firstItem();\r\n                    if (firstItem) {\r\n                        firstItem.focus({ preventScroll: true });\r\n                    }\r\n                }\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n            case \"ArrowRight\": {\r\n                if (activeItem) {\r\n                    const nextItem = this.#nextItem(activeItem);\r\n                    if (nextItem) {\r\n                        nextItem.focus({ preventScroll: true });\r\n                    }\r\n                }\r\n                else {\r\n                    const lastItem = this.#lastItem();\r\n                    if (lastItem) {\r\n                        lastItem.focus({ preventScroll: true });\r\n                    }\r\n                }\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n            case \"ArrowDown\": {\r\n                if (activeItem) {\r\n                    const { type } = activeItem;\r\n                    switch (type) {\r\n                        case \"select\": {\r\n                            activeItem.select?.expand();\r\n                            event.stopPropagation();\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"Home\": {\r\n                const firstItem = this.firstItem();\r\n                if (firstItem) {\r\n                    firstItem.focus({ preventScroll: true });\r\n                }\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n            case \"End\": {\r\n                const lastItem = this.#lastItem();\r\n                if (lastItem) {\r\n                    lastItem.focus({ preventScroll: true });\r\n                }\r\n                event.stopPropagation();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarElementBase.prototype, \"orientation\", void 0);\r\nHTMLEToolBarElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-toolbar\"\r\n    })\r\n], HTMLEToolBarElementBase);\r\nvar HTMLEToolBarElement = HTMLEToolBarElementBase;\r\n//# sourceMappingURL=ToolBar.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { DEFAULT_THEME_SELECTED_ITEM_COLOR } from \"../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty } from \"../Element\";\r\nexport { HTMLEHandleElement };\r\nvar style;\r\nlet HTMLEHandleElementBase = class HTMLEHandleElementBase extends HTMLElement {\r\n    #target;\r\n    #onCapture;\r\n    static {\r\n        style = /*css*/ `\r\n            :host {\r\n                display: block;\r\n                            \r\n                width: 24px;\r\n                height: 12px;\r\n                \r\n                background-color: var(--theme-selected-item-color, ${DEFAULT_THEME_SELECTED_ITEM_COLOR});\r\n\r\n                -webkit-mask-image: url(\"/assets/dots.png\");\r\n                mask-image: url(\"/assets/dots.png\");\r\n\r\n                -webkit-mask-repeat: repeat;\r\n                mask-repeat: repeat;\r\n                cursor: move;\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        this.#target = null;\r\n        this.#onCapture = false;\r\n        this.addEventListener(\"pointerdown\", this.#handlePointerDownEvent.bind(this));\r\n        this.addEventListener(\"pointermove\", this.#handlePointerMoveEvent.bind(this));\r\n        this.addEventListener(\"pointerup\", this.#handlePointerUpEvent.bind(this));\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"controls\": {\r\n                const { controls } = this;\r\n                this.#target = document.getElementById(controls);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    #handlePointerUpEvent(event) {\r\n        const { pointerId } = event;\r\n        this.releasePointerCapture(pointerId);\r\n        this.#onCapture = false;\r\n    }\r\n    #handlePointerDownEvent(event) {\r\n        const { pointerId } = event;\r\n        const { controls } = this;\r\n        this.#target = document.getElementById(controls);\r\n        this.setPointerCapture(pointerId);\r\n        this.#onCapture = true;\r\n    }\r\n    #handlePointerMoveEvent(event) {\r\n        if (this.#onCapture) {\r\n            const target = this.#target;\r\n            if (target !== null) {\r\n                const targetComputedStyle = window.getComputedStyle(target);\r\n                const { movementX, movementY } = event;\r\n                const { width: rectWidth, height: rectHeight } = target.getBoundingClientRect();\r\n                const outerElement = target.parentElement ?? document.body;\r\n                const { left: outerRectLeft, right: outerRectRight, top: outerRectTop, bottom: outerRectBottom } = outerElement.getBoundingClientRect();\r\n                const left = parseFloat(targetComputedStyle.getPropertyValue(\"left\"));\r\n                const newLeft = Math.max(outerRectLeft, Math.min(Math.trunc(left + movementX), outerRectRight - rectWidth));\r\n                const top = parseFloat(targetComputedStyle.getPropertyValue(\"top\"));\r\n                const newTop = Math.max(outerRectTop, Math.min(Math.trunc(top + movementY), outerRectBottom - rectHeight));\r\n                target.style.setProperty(\"left\", `${newLeft}px`);\r\n                target.style.setProperty(\"top\", `${newTop}px`);\r\n                this.dispatchEvent(new CustomEvent(\"move\"));\r\n            }\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEHandleElementBase.prototype, \"controls\", void 0);\r\nHTMLEHandleElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-handle\"\r\n    })\r\n], HTMLEHandleElementBase);\r\nvar HTMLEHandleElement = HTMLEHandleElementBase;\r\n//# sourceMappingURL=Handle.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { CustomElement, AttributeProperty } from \"../Element\";\r\nexport { HTMLEImportElement };\r\nlet HTMLEImportElementBase = class HTMLEImportElementBase extends HTMLElement {\r\n    connectedCallback() {\r\n        const { src } = this;\r\n        if (src) {\r\n            this.#importRequest(src);\r\n        }\r\n    }\r\n    async #importRequest(src) {\r\n        this.outerHTML = await fetch(src).then((response) => {\r\n            if (response.ok) {\r\n                return response.text();\r\n            }\r\n            else {\r\n                throw new Error(response.statusText);\r\n            }\r\n        });\r\n        this.dispatchEvent(new Event(\"load\", { bubbles: true }));\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEImportElementBase.prototype, \"src\", void 0);\r\nHTMLEImportElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-import\"\r\n    })\r\n], HTMLEImportElementBase);\r\nvar HTMLEImportElement = HTMLEImportElementBase;\r\n//# sourceMappingURL=Import.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { DEFAULT_THEME_SELECTED_ITEM_COLOR } from \"../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, element } from \"../Element\";\r\nexport { HTMLELoaderElement };\r\nvar barShadowTemplate;\r\nvar spinnerShadowTemplate;\r\nvar style;\r\nlet HTMLELoaderElementBase = class HTMLELoaderElementBase extends HTMLElement {\r\n    static {\r\n        barShadowTemplate = element(\"template\");\r\n        barShadowTemplate.content.append(element(\"div\", {\r\n            attributes: {\r\n                part: \"bar\"\r\n            },\r\n            children: [\r\n                element(\"div\", {\r\n                    attributes: {\r\n                        part: \"slider\"\r\n                    },\r\n                    children: [\r\n                        element(\"div\", {\r\n                            attributes: {\r\n                                part: \"cursor\"\r\n                            }\r\n                        })\r\n                    ]\r\n                })\r\n            ]\r\n        }));\r\n        spinnerShadowTemplate = element(\"template\");\r\n        spinnerShadowTemplate.content.append(element(\"div\", {\r\n            attributes: {\r\n                part: \"spinner\"\r\n            }\r\n        }));\r\n        style = /*css*/ `\r\n            :host {\r\n                display: inline-block;\r\n            }\r\n\r\n            :host(:is(:not([type]), [type=\"bar\"])) {\r\n                border: 1px solid gainsboro;\r\n                border-radius: 4px;\r\n            }\r\n        \r\n            [part=\"bar\"] {\r\n                position: relative;\r\n                overflow: hidden;\r\n                height: 6px;\r\n                width: 100%;\r\n                width: 86px;\r\n                border-radius: 4px;\r\n                background-color: whitesmoke;\r\n            }\r\n        \r\n            [part=\"slider\"] {\r\n                display: flex;\r\n                position: absolute;\r\n                width: 100%;\r\n                height: 100%;\r\n                animation-name: slider;\r\n            }\r\n        \r\n            [part=\"slider\"],\r\n            [part=\"cursor\"] {\r\n                border-radius: 4px;\r\n                will-change: transform;\r\n                animation-duration: 1s;\r\n                animation-timing-function: linear;\r\n                animation-iteration-count: infinite;\r\n            }\r\n        \r\n            [part=\"cursor\"] {\r\n                display: block;\r\n                width: 32px;\r\n                background-color: var(--theme-activated-item-color, ${DEFAULT_THEME_SELECTED_ITEM_COLOR});\r\n                animation-name: cursor;\r\n            }\r\n        \r\n            :host([type=\"spinner\"]) {\r\n                display: inline-block;\r\n                width: 20px;\r\n                height: 20px;\r\n            }\r\n        \r\n            [part=\"spinner\"] {\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n            }\r\n        \r\n            [part=\"spinner\"]::after {\r\n                content: \"\";\r\n                display: block;\r\n                width: 12px;\r\n                height: 12px;\r\n                border-radius: 50%;\r\n                border-width: 4px;\r\n                border-style: solid;\r\n                border-color: transparent var(--theme-activated-item-color, ${DEFAULT_THEME_SELECTED_ITEM_COLOR});\r\n                animation: spin 1.2s linear infinite;\r\n            }\r\n        \r\n            @keyframes slider {\r\n                0% {\r\n                    transform: translateX(0%);\r\n                }\r\n                100% {\r\n                    transform: translateX(100%);\r\n                }\r\n            }\r\n        \r\n            @keyframes cursor {\r\n                0% {\r\n                    transform: translateX(-100%);\r\n                }\r\n                100% {\r\n                    transform: translateX(100%);\r\n                }\r\n            }\r\n        \r\n            @keyframes spin {\r\n                0% {\r\n                    transform: rotate(0);\r\n                }\r\n                100% {\r\n                    transform: rotate(360deg);\r\n                }\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.replaceChildren(barShadowTemplate.content.cloneNode(true));\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"type\": {\r\n                this.#updateTemplate();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    #updateTemplate() {\r\n        const { type, shadowRoot } = this;\r\n        switch (type) {\r\n            case \"spinner\": {\r\n                shadowRoot.replaceChildren(spinnerShadowTemplate.content.cloneNode(true));\r\n                break;\r\n            }\r\n            case \"bar\": {\r\n                shadowRoot.replaceChildren(barShadowTemplate.content.cloneNode(true));\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String, defaultValue: \"bar\", observed: true })\r\n], HTMLELoaderElementBase.prototype, \"type\", void 0);\r\nHTMLELoaderElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-loader\"\r\n    })\r\n], HTMLELoaderElementBase);\r\nvar HTMLELoaderElement = HTMLELoaderElementBase;\r\n//# sourceMappingURL=Loader.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { CustomElement } from \"../Element\";\r\nexport { HTMLESeparatorElement };\r\nvar style;\r\nlet HTMLESeparatorElementBase = class HTMLESeparatorElementBase extends HTMLElement {\r\n    #internals;\r\n    static {\r\n        style = /*css*/ `\r\n            :host {\r\n                display: block;\r\n                margin: 10px 0 10px 27px;\r\n                border: none;\r\n                border-top: 1px solid lightgrey;\r\n            }\r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        this.#internals = this.attachInternals();\r\n        this.#internals.role = \"separator\";\r\n    }\r\n};\r\nHTMLESeparatorElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-separator\"\r\n    })\r\n], HTMLESeparatorElementBase);\r\nvar HTMLESeparatorElement = HTMLESeparatorElementBase;\r\n//# sourceMappingURL=Separator.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { CustomElement, AttributeProperty, element } from \"../Element\";\r\nexport { HTMLEToolTipElement };\r\nvar shadowTemplate;\r\nvar style;\r\nvar HIDE_DELAY_MS = 100;\r\nvar SHOW_DELAY_MS = 200;\r\nvar ANIMATION_DURATION = 100;\r\nlet HTMLEToolTipElementBase = class HTMLEToolTipElementBase extends HTMLElement {\r\n    get target() {\r\n        return this.#target;\r\n    }\r\n    #target;\r\n    #targetListenerObject;\r\n    #documentListenerObject;\r\n    #toggleAnimation;\r\n    static {\r\n        shadowTemplate = element(\"template\");\r\n        shadowTemplate.content.append(element(\"div\", {\r\n            attributes: {\r\n                part: \"container\"\r\n            },\r\n            children: [\r\n                element(\"span\", {\r\n                    attributes: {\r\n                        part: \"arrow\"\r\n                    }\r\n                }),\r\n                element(\"slot\")\r\n            ]\r\n        }));\r\n        style = /*css*/ `\r\n            :host {\r\n                position: fixed;\r\n                display: inline-block;\r\n                z-index: 1;\r\n                padding: 4px;\r\n                border-radius: 3px;\r\n                box-sizing: border-box;\r\n                background-color: white;\r\n                border: 1px solid black;\r\n                pointer-events: none;\r\n            }\r\n            \r\n            :host([hidden]) {\r\n                display: none;\r\n            }\r\n\r\n            :host(:not([visible])) {\r\n                opacity: 0;\r\n            }\r\n            \r\n            [part=\"arrow\"] {\r\n                display: inline-block;\r\n                position: fixed;\r\n                z-index: 1;\r\n                width: 4px;\r\n                height: 4px;\r\n                box-sizing: border-box;\r\n                background-color: white;\r\n                border: 1px solid black;\r\n                border-width: 0 1px 1px 0;\r\n            }\r\n            \r\n            :host(:is(:not([position]), [position=\"top\"])) [part=\"arrow\"] {\r\n                transform: translate(-2px, -2px) rotate(45deg);\r\n            }\r\n            \r\n            :host(:is([position=\"bottom\"])) [part=\"arrow\"] {\r\n                transform: translate(-2px, -2px) rotate(225deg);\r\n            }\r\n            \r\n            :host(:is([position=\"left\"])) [part=\"arrow\"] {\r\n                transform: translate(-2px, -2px) rotate(315deg);\r\n            }\r\n            \r\n            :host(:is([position=\"right\"])) [part=\"arrow\"] {\r\n                transform: translate(-2px, -2px) rotate(135deg);\r\n            }        \r\n        `;\r\n    }\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.#target = null;\r\n        this.#toggleAnimation = null;\r\n        this.#targetListenerObject = (function (tooltip) {\r\n            return {\r\n                handleEvent(event) {\r\n                    const { type } = event;\r\n                    switch (type) {\r\n                        case \"mouseenter\": {\r\n                            tooltip.#handleTargetMouseEnterEvent();\r\n                            break;\r\n                        }\r\n                        case \"mouseleave\": {\r\n                            tooltip.#handleTargetMouseLeaveEvent();\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        })(this);\r\n        this.#documentListenerObject = (function (tooltip) {\r\n            return {\r\n                handleEvent(event) {\r\n                    const { type } = event;\r\n                    switch (type) {\r\n                        case \"keydown\": {\r\n                            tooltip.#handleDocumentKeyDownEvent(event);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        })(this);\r\n    }\r\n    connectedCallback() {\r\n        this.#setTarget();\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"for\": {\r\n                this.#setTarget();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    #setTarget() {\r\n        const { htmlFor } = this;\r\n        if (htmlFor) {\r\n            const rootNode = this.getRootNode();\r\n            if (rootNode instanceof Document || rootNode instanceof ShadowRoot) {\r\n                const target = rootNode.getElementById(htmlFor);\r\n                if (target !== null) {\r\n                    const oldTarget = this.#target;\r\n                    const targetListenerObject = this.#targetListenerObject;\r\n                    if (oldTarget) {\r\n                        oldTarget.removeEventListener(\"mouseenter\", targetListenerObject);\r\n                        oldTarget.removeEventListener(\"mouseleave\", targetListenerObject);\r\n                    }\r\n                    target.addEventListener(\"mouseenter\", targetListenerObject);\r\n                    target.addEventListener(\"mouseleave\", targetListenerObject);\r\n                }\r\n                this.#target = target;\r\n            }\r\n            this.#position();\r\n        }\r\n    }\r\n    show(options) {\r\n        const { immediate = false } = options ?? {};\r\n        let toggleAnimation = this.#toggleAnimation;\r\n        if (toggleAnimation !== null) {\r\n            const { id } = toggleAnimation;\r\n            if (id === \"hide\") {\r\n                toggleAnimation.cancel();\r\n            }\r\n            else if (!immediate) {\r\n                return;\r\n            }\r\n        }\r\n        if (!this.visible) {\r\n            this.hidden = false;\r\n            toggleAnimation = this.animate([\r\n                { opacity: 0 },\r\n                { opacity: 1 }\r\n            ], {\r\n                id: \"show\",\r\n                delay: immediate ? 0 : SHOW_DELAY_MS,\r\n                duration: immediate ? 0 : ANIMATION_DURATION\r\n            });\r\n            const { finished } = toggleAnimation;\r\n            finished.then(() => {\r\n                this.visible = true;\r\n            }).catch(_ => void 0);\r\n            this.#toggleAnimation = toggleAnimation;\r\n            this.#position();\r\n        }\r\n        else {\r\n            this.#toggleAnimation = null;\r\n        }\r\n    }\r\n    hide(options) {\r\n        const { immediate = false } = options ?? {};\r\n        let toggleAnimation = this.#toggleAnimation;\r\n        if (toggleAnimation !== null) {\r\n            const { id } = toggleAnimation;\r\n            if (id === \"show\") {\r\n                toggleAnimation.cancel();\r\n            }\r\n            else if (!immediate) {\r\n                return;\r\n            }\r\n        }\r\n        if (this.visible) {\r\n            toggleAnimation = this.animate([\r\n                { opacity: 1 },\r\n                { opacity: 0 }\r\n            ], {\r\n                id: \"hide\",\r\n                delay: immediate ? 0 : HIDE_DELAY_MS,\r\n                duration: immediate ? 0 : ANIMATION_DURATION\r\n            });\r\n            const { finished } = toggleAnimation;\r\n            finished.then(() => {\r\n                this.visible = false;\r\n                this.hidden = true;\r\n            }).catch(_ => void 0);\r\n            this.#toggleAnimation = toggleAnimation;\r\n        }\r\n        else {\r\n            this.#toggleAnimation = null;\r\n        }\r\n    }\r\n    #arrow() {\r\n        return this.shadowRoot.querySelector(\"[part=arrow]\");\r\n    }\r\n    #position() {\r\n        const target = this.#target;\r\n        if (target !== null) {\r\n            const { top: targetTop, bottom: targetBottom, left: targetLeft, right: targetRight } = target.getBoundingClientRect();\r\n            const { width: tooltipWidth, height: tooltipHeight } = this.getBoundingClientRect();\r\n            const tooltipHalfWidth = tooltipWidth / 2;\r\n            const tooltipHalfHeight = tooltipHeight / 2;\r\n            const targetCenter = (targetRight + targetLeft) / 2;\r\n            const targetMiddle = (targetBottom + targetTop) / 2;\r\n            const { position, style: tooltipStyle } = this;\r\n            const arrow = this.#arrow();\r\n            const { style: arrowStyle } = arrow;\r\n            const { width: arrowWidth, height: arrowHeight } = arrow.getBoundingClientRect();\r\n            const arrowHalfWidth = arrowWidth / 2;\r\n            const arrowHalfHeight = arrowHeight / 2;\r\n            const { clientWidth } = document.body;\r\n            switch (position) {\r\n                case \"top\": {\r\n                    tooltipStyle.setProperty(\"top\", `${targetTop - tooltipHeight - arrowHalfHeight}px`);\r\n                    tooltipStyle.setProperty(\"left\", `${Math.max(0, Math.min(targetCenter - tooltipHalfWidth, clientWidth - tooltipWidth))}px`);\r\n                    arrowStyle.setProperty(\"top\", `${targetTop - arrowHalfHeight}px`);\r\n                    arrowStyle.setProperty(\"left\", `${targetCenter}px`);\r\n                    break;\r\n                }\r\n                case \"bottom\": {\r\n                    tooltipStyle.setProperty(\"top\", `${targetBottom + arrowHalfHeight}px`);\r\n                    tooltipStyle.setProperty(\"left\", `${Math.max(0, Math.min(targetCenter - tooltipHalfWidth, clientWidth - tooltipWidth))}px`);\r\n                    arrowStyle.setProperty(\"top\", `${targetBottom + arrowHalfHeight}px`);\r\n                    arrowStyle.setProperty(\"left\", `${targetCenter}px`);\r\n                    break;\r\n                }\r\n                case \"left\": {\r\n                    tooltipStyle.setProperty(\"top\", `${targetMiddle - tooltipHalfHeight}px`);\r\n                    tooltipStyle.setProperty(\"left\", `${targetLeft - tooltipWidth - arrowHalfWidth}px`);\r\n                    arrowStyle.setProperty(\"top\", `${targetMiddle}px`);\r\n                    arrowStyle.setProperty(\"left\", `${targetLeft - arrowHalfWidth}px`);\r\n                    break;\r\n                }\r\n                case \"right\": {\r\n                    tooltipStyle.setProperty(\"top\", `${targetMiddle - tooltipHalfHeight}px`);\r\n                    tooltipStyle.setProperty(\"left\", `${targetRight + arrowHalfWidth}px`);\r\n                    arrowStyle.setProperty(\"top\", `${targetMiddle}px`);\r\n                    arrowStyle.setProperty(\"left\", `${targetRight + arrowHalfWidth}px`);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    #handleTargetMouseEnterEvent() {\r\n        this.show();\r\n        const toggleAnimation = this.#toggleAnimation;\r\n        if (toggleAnimation) {\r\n            const documentListenerObject = this.#documentListenerObject;\r\n            const { finished } = toggleAnimation;\r\n            finished.then(() => {\r\n                document.addEventListener(\"keydown\", documentListenerObject);\r\n            }).catch(_ => void 0);\r\n        }\r\n    }\r\n    #handleTargetMouseLeaveEvent() {\r\n        this.hide();\r\n        const toggleAnimation = this.#toggleAnimation;\r\n        if (toggleAnimation) {\r\n            const documentListenerObject = this.#documentListenerObject;\r\n            const { finished } = toggleAnimation;\r\n            finished.then(() => {\r\n                document.removeEventListener(\"keydown\", documentListenerObject);\r\n            }).catch(_ => void 0);\r\n        }\r\n    }\r\n    #handleDocumentKeyDownEvent(event) {\r\n        const { key } = event;\r\n        switch (key) {\r\n            case \"Escape\": {\r\n                this.hide({\r\n                    immediate: true\r\n                });\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true, name: \"for\" })\r\n], HTMLEToolTipElementBase.prototype, \"htmlFor\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, defaultValue: \"top\" })\r\n], HTMLEToolTipElementBase.prototype, \"position\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEToolTipElementBase.prototype, \"visible\", void 0);\r\nHTMLEToolTipElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-tooltip\"\r\n    })\r\n], HTMLEToolTipElementBase);\r\nvar HTMLEToolTipElement = HTMLEToolTipElementBase;\r\n//# sourceMappingURL=ToolTip.js.map","import { multiDraw } from \"./src/samples/scenes/MultiDraw\";\r\nimport { Entity } from \"./src/engine/core/general/Entity\";\r\nimport { Scene } from \"./src/engine/core/general/Scene\";\r\nimport { FaceHalfEdgesIterator, FaceVerticesIterator, Vertex, VertexFacesIterator } from \"./src/engine/core/rendering/scenes/geometries/GeometryBuilder\";\r\nimport { QuadGeometry } from \"./src/engine/core/rendering/scenes/geometries/lib/QuadGeometry\";\r\nimport { Matrix3 } from \"./src/engine/libs/maths/algebra/matrices/Matrix3\";\r\nimport { Matrix4 } from \"./src/engine/libs/maths/algebra/matrices/Matrix4\";\r\nimport { Vector2 } from \"./src/engine/libs/maths/algebra/vectors/Vector2\";\r\nimport { Vector3, Vector3Values } from \"./src/engine/libs/maths/algebra/vectors/Vector3\";\r\nimport { Vector4 } from \"./src/engine/libs/maths/algebra/vectors/Vector4\";\r\nimport { GOLDEN_RATIO } from \"./src/engine/libs/maths/geometry/GeometryConstants\";\r\nimport { Triangle } from \"./src/engine/libs/maths/geometry/primitives/Triangle\";\r\nimport { Space } from \"./src/engine/libs/maths/geometry/space/Space\";\r\nimport { buildArrayFromIndexedArrays } from \"./src/engine/utils/Snippets\";\r\nimport { start } from \"./src/samples/scenes/SimpleScene\";\r\nimport { octree } from \"./src/samples/scenes/Octree\";\r\nimport { deferred } from \"./src/samples/scenes/Deferred\";\r\nimport { helpers } from \"./src/samples/scenes/Helpers\";\r\nimport { physics } from \"./src/samples/scenes/Physics\";\r\n\r\nimport { element } from \"editor/lib/elements/Element\";\r\nimport { HTMLEMenuBarElement } from \"editor/lib/elements/containers/menus/MenuBar\";\r\n/*\r\nfunction windingOrder(v0: Vector3, v1: Vector3, v2: Vector3) {\r\n    const triangle = new Triangle(v0, v1, v2);\r\n    const centroid = triangle.getMidpoint(new Vector3());\r\n    const normal = triangle.getNormal(new Vector3());\r\n    \r\n    const e1 = v1.clone().sub(v0);\r\n    const e2 = e1.clone().cross(normal);\r\n\r\n    e1.normalize();\r\n    e2.normalize();\r\n\r\n    const v0_centered = v0.clone().sub(centroid);\r\n    const v1_centered = v1.clone().sub(centroid);\r\n    const v2_centered = v2.clone().sub(centroid);\r\n\r\n    const v0_t1 = e1.dot(v0_centered);\r\n    const v0_t2 = e2.dot(v0_centered);\r\n\r\n    const v1_t1 = e1.dot(v1_centered);\r\n    const v1_t2 = e2.dot(v1_centered);\r\n\r\n    const v2_t1 = e1.dot(v2_centered);\r\n    const v2_t2 = e2.dot(v2_centered);\r\n\r\n    const det = (v1_t1 - v0_t1) * (v2_t2 - v0_t2) - (v1_t2 - v0_t2) * (v2_t1 - v0_t1);\r\n    console.log(det < 0 ? \"CW\" : \"CCW\");\r\n\r\n    // const v0_out = new Vector2([v0_t1, v0_t2]);\r\n    // const v1_out = new Vector2([v1_t1, v1_t2]);\r\n    // const v2_out = new Vector2([v2_t1, v2_t2]);\r\n    // const v0_angle = Math.atan2(v0_out.y, v0_out.x);\r\n    // const v1_angle = Math.atan2(v1_out.y, v1_out.x);\r\n    // const v2_angle = Math.atan2(v2_out.y, v2_out.x);\r\n    \r\n    // const angles = [v0_angle, v1_angle, v2_angle];\r\n}*/\r\n\r\nimport \"editor/lib/elements/containers/menus\";\r\nimport \"editor/lib/elements/containers/toolbars\";\r\n\r\nimport \"editor/lib/elements/misc\";\r\n\r\nconst menubar = element(\"e-menubar\", {\r\n    children: [\r\n        element(\"e-menuitem\", {\r\n            attributes: {\r\n                type: \"menu\"\r\n            },\r\n            children: [\r\n                \"File\",\r\n                element(\"e-menu\", {\r\n                    attributes: {\r\n                        slot: \"menu\"\r\n                    },\r\n                    children: [\r\n                        element(\"e-menuitem\", {\r\n                            attributes: {\r\n                                type: \"button\"\r\n                            },\r\n                            children: \"Action 1\"\r\n                        })\r\n                    ]\r\n                })\r\n            ]\r\n        }),\r\n        element(\"e-menuitem\", {\r\n            attributes: {\r\n                type: \"menu\"\r\n            },\r\n            children: [\r\n                \"Help\",\r\n                element(\"e-menu\", {\r\n                    attributes: {\r\n                        slot: \"menu\"\r\n                    },\r\n                    children: [\r\n                        element(\"e-menuitem\", {\r\n                            attributes: {\r\n                                type: \"button\"\r\n                            },\r\n                            children: \"About\"\r\n                        })\r\n                    ]\r\n                })\r\n            ]\r\n        })\r\n    ]\r\n});\r\n\r\nconst toolbar = element(\"e-toolbar\", {\r\n    children: [\r\n        element(\"e-toolbaritem\", {\r\n            attributes: {\r\n                id: \"play-pause\",\r\n                type: \"checkbox\",\r\n                name: \"play-pause\",\r\n                iconed: true\r\n            }\r\n        })\r\n    ]\r\n});\r\n\r\nconst tooltips = [\r\n    element(\"e-tooltip\", {\r\n        attributes: {\r\n            for: \"play-pause\"\r\n        },\r\n        children: \"Play/pause rendering\"\r\n    })\r\n];\r\n\r\nexport async function main() {\r\n    document.body.prepend(menubar);\r\n    menubar.after(toolbar);\r\n    document.body.append(...tooltips);\r\n    //instanced();\r\n    //wireframe();\r\n\r\n    /*const myWorker = new Worker(\"./worker.js\");\r\n    const sab = new SharedArrayBuffer(1024);\r\n    const array = new Uint32Array(sab);\r\n    myWorker.addEventListener(\"message\", (event) => {\r\n        console.log(`Received back: ${array[10]}`);\r\n    });\r\n\r\n    myWorker.postMessage(sab);*/\r\n\r\n    //physics();\r\n    //helpers();\r\n    //deferred();\r\n    //octree();\r\n    start();\r\n    //multiDraw();\r\n\r\n    //startMaps();\r\n\r\n    // const button = document.createElement(\"button\");\r\n    // button.textContent = \"Get bin\";\r\n    // document.body.insertAdjacentElement(\"beforebegin\", button);\r\n    // button.onclick = () => {\r\n    //     const anchor = document.createElement(\"a\");\r\n    //     const myData = new Float32Array([32.20, 1]);\r\n    //     const myBlob = new Blob([myData]);\r\n    //     anchor.download = \"dat.bin\";\r\n    //     anchor.href = URL.createObjectURL(myBlob);\r\n    //     anchor.click();\r\n    // };\r\n    \r\n    // const input = document.createElement(\"input\");\r\n    // input.type = \"file\";\r\n    // input.oninput = () => {\r\n    //     if (input.files) {\r\n    //         Array.from(input.files).forEach((file) => {\r\n    //             file.arrayBuffer().then((arr) => {\r\n    //                 console.log(Array.from(new Float32Array(arr)).map(val => val.toFixed(3)));\r\n    //             });\r\n    //         });\r\n    //     }\r\n    // };\r\n    // document.body.insertAdjacentElement(\"beforebegin\", input);\r\n}"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","Error","replace","p","Injector","_forcedQualifier","_constructors","_defaultCtor","_onDefaultOverride","defaultCtor","overrideDefaultCtor","constructor","args","onDefaultOverride","Map","forceQualifier","qualifier","unforceQualifier","getConstructor","qualifierValue","inject","Array","from","register","has","set","MathError","name","Vector2Base","array","Float32Array","values","x","y","setValues","equals","vec","v","copy","clone","setUnit","setZeros","add","addScalar","k","sub","lerp","t","clamp","min","max","l","Math","multScalar","cross","a","b","dot","sqrt","lengthSquared","dist","dx","dy","distSquared","normalize","lenSq","len","Number","EPSILON","negate","mult","arg0","Vector2","m","addScaled","writeIntoArray","out","offset","readFromArray","arr","copyAndSub","vecA","vecB","ctor","Vector3Base","toString","join","angle","vectorA","vectorB","temp","Vector3","acos","z","vector","to","scale","t0","t1","t2","distance","dz","hypot","distanceSquared","toSpherical","center","thisArray","centerArray","roh","theta","phi","atan2","toCartesian","sin","cos","mat","copyAndCross","iterator","i","next","done","undefined","Key","Space","static","KEYS_COUNT","keys","KeyModifier","MouseButton","MOUSE_BUTTONS_COUNT","MOUSE_BUTTONS_INDICES","freeze","reduce","map","button","index","assign","KEYS_INDICES","Input","keyFlags","fill","mouseFlags","pointerPosition","wheelDelta","canvas","canvasRectangle","initialize","getBoundingClientRect","addEventListener","getCanvasRect","rect","clear","handleEvent","event","eventIndex","type","canvasRect","clientX","left","clientY","top","deltaY","getKey","getKeyUp","getKeyDown","getMouseButton","getPointerPosition","getPointerScreenPosition","positionAray","width","height","getWheelDelta","getMouseButtonDown","getMouseButtonUp","tempVector1","tempVector2","tempVector3","PoolAutoExtendPolicy","FreeCameraControl","camera","rotationSpeed","translationSpeed","params","update","deltaTime","lastPointerPosition","transform","cameraTransform","cameraPosition","getTranslation","cameraForward","getBackward","cameraForwardArray","origin","up","down","cameraUpSign","getUp","Z","ARROW_UP","forward","translate","Q","ARROW_LEFT","getLeft","S","ARROW_DOWN","backward","getForward","D","ARROW_RIGHT","right","getRight","RIGHT","newPointerPosition","sign","newTheta","PI","lookAt","PoolBase","autoExtendPolicy","autoExtendTicks","policy","AUTO_EXTEND_ONE","autoExtend","extend","AUTO_EXTEND_POW2","pow","acquire","count","release","StackPool","objects","options","super","size","target","slice","console","warn","push","_bytes","ArrayBuffer","BYTES_PER_ELEMENT","_floatView","_intView","Uint32Array","Matrix3Base","checkArray","row1","row","row2","row3","col1","col","col2","col3","m11","val","m12","m13","m21","m22","m23","m31","m32","m33","getValues","other","setIdentity","det","trace","transpose","invert","t11","t12","t13","t21","t22","t23","t31","t32","t33","d","a11","a12","a13","a21","a22","a23","a31","a32","a33","b11","b12","b13","b21","b22","b23","b31","b32","b33","rotationX","setRotationX","cosAngle","sinAngle","rotationY","setRotationY","rotationZ","setRotationZ","solve","A0x","A0y","A0z","A1x","A1y","A1z","A2x","A2y","A2z","rx","ry","rz","x_","y_","solve2","bx","by","Matrix3","QuaternionBase","_array","_checkArray","w","pitch","sinPitch","abs","asin","yaw","sinYawCosPitch","cosYawCosPitch","roll","sinRollCosPitch","cosRollCosPitch","fromArray","fromAxisAngle","axis","setAxisAngle","fromVector","fromEuler","setEuler","quat","q","quatArray","getAxis","outArray","den","halfx","qSqrt","getMatrix3","matrix","s","xs","ys","zs","wx","wy","wz","xx","xy","xz","yy","yz","zz","getMatrix4","rotate","vectorArray","vx","vy","vz","qx","qy","qz","qw","tx","ty","tz","tw","toVector","cosYaw","sinYaw","cosPitch","cosRoll","sinRoll","axisLength","halfSin","axisArray","setMatrix","matrixArray","source","dest","Quaternion","fromMatrix","setVectors","crossArray","fromLength","toLength","angleTo","rotation","rotateTowards","slerp","conjugate","ax","ay","az","aw","bz","bw","scalar","toArray","cosHalfTheta","halfTheta","sinHalfTheta","trunc","ratioA","ratioB","copyIntoArray","Matrix4Base","fromValues","m41","m42","m43","m14","m24","m34","m44","getRotation","setTRS","translation","scaling","rotationArray","translationArray","scalingArray","x2","y2","z2","sx","sy","sz","setRotation","quaternion","quaternionArray","matArray","identity","zeros","det2_01_01","det2_01_02","det2_01_03","det2_01_12","det2_01_13","det2_01_23","det3_201_012","det3_201_013","det3_201_023","A","a41","a42","a43","a14","a24","a34","a44","o00","o01","o02","o03","o10","o11","o12","o13","o20","o21","o22","o23","o30","o31","o32","o33","t00","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","invDet","B","b41","b42","b43","b14","b24","b34","b44","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","bX","bY","bZ","bW","solve3","setTranslation","vecArray","t3","t4","rotateX","t5","t6","t7","t8","rotateY","sinAngles","rotateZ","c","C","t9","setScaling","eye","eyeArray","upArray","targetArray","e0","e1","e2","u0","u1","u2","x0","x1","y0","y1","z0","z1","transformPoint","point","pointArray","transformPoint4","transformDirection","direction","directionArray","transformNormal","normal","normalArray","thisInvArray","perspective","fov","aspect","zNear","zFar","setPerspective","tan","rangeInv","orthographic","bottom","near","far","setOrthographic","frustum","setFrustum","invWidth","invHeight","invDepth","Matrix4","Vector3Pool","_buffer","_bufferViews","_extensions","subarray","UUIDGenerator","_count","newUUID","tempMatrix","Transform","localArray","uuid","owner","localMatrix","hasChanged","isStatic","getMatrix","getLocalMatrix","thisLocalArray","setLocalMatrix","getDown","getScaling","transformVector","thisPosition","PlaneBase","constant","fromNormalAndConstant","setFromNormalAndConstant","fromNormalAndCoplanarPoint","setFromNormalAndCoplanarPoint","fromCoplanarPoints","setFromCoplanarPoints","plane","point1","point2","point3","distanceToPoint","normalized","inverseNormalLength","intersection","result","aNormal","aConstant","bNormal","bConstant","cNormal","cConstant","f","v1x","v1y","v1z","v2x","v2y","v2z","v3x","v3y","v3z","Plane","tempVector","FrustumBase","nearPlane","farPlane","topPlane","bottomPlane","leftPlane","rightPlane","extents","_","_nearPlane","_farPlane","_bottomPlane","_topPlane","_leftPlane","_rightPlane","Frustum","setFromMatrix","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m15","intersectsSphere","sphere","radius","intersectsBox","box","boxMax","boxMin","getEdges","edges","leftBottomNear","leftTopNear","rightBottomNear","rightTopNear","leftBottomFar","leftTopFar","rightBottomFar","rightTopFar","getExtents","_extents","containsPoint","Object3DBase","BufferDataUsage","BufferTarget","DrawMode","DataComponentType","AttributeDataType","ElementArrayDataType","Camera","projection","viewProjection","getFront","view","isViewing","mesh","updateFrustum","PerspectiveCamera","WebGLVertexArrayUtilities","getDataTypeNumComponents","VEC2","VEC3","VEC4","getComponentTypeArrayConstructor","FLOAT","BYTE","UNSIGNED_BYTE","Uint8Array","SHORT","Int16Array","UNSIGNED_SHORT","Uint16Array","INT","Int32Array","UNSIGNED_INT","getArrayComponentType","Int8Array","createVertexElementArrayBuffer","gl","indices","internalBuffer","createBuffer","usage","STATIC_READ","ELEMENT_ARRAY_BUFFER","byteLength","indexType","getElementArrayBufferType","bindBuffer","bufferData","createVertexArrayBuffer","program","attributes","interleaved","internalProgram","DEFAULT_USAGE","attributesEntries","entries","attribute","ARRAY_BUFFER","dataBuffer","byteStride","vertexAttributes","forEach","componentType","stride","bufferSlices","constantValue","byteOffset","attributeName","divisor","getAttribLocation","numComponents","vertexAttribPointer","vertexAttribDivisor","vertexAttrib1fv","vertexAttrib2fv","vertexAttrib3fv","vertexAttrib4fv","bytesPerElement","bufferArray","arrayStrideOffset","arraySliceIndex","enableVertexAttribArray","setVertexArrayValues","vertexArray","elementsCount","attributeRecord","verticesBuffers","verticesBuffer","find","getParameter","ARRAY_BUFFER_BINDING","srcOffset","srcLength","dstOffset","slices","sliceOffset","bufferSubData","setVertexArrayBufferData","buffer","data","dstByteOffset","createVertexArray","vertexBuffers","elementIndices","elementBuffer","elementBufferOrBufferProperties","internalVertexArray","bindVertexArray","buffer_i","fromEntries","filter","attribute_i","setter","deleteVertexArray","isVertexArray","GeometryAttributes","GeometryBuffer","bufferByteLength","bufferArrayConstructor","toBlob","bufferLength","indicesData","indicesLength","headerData","TextEncoder","encode","JSON","stringify","headerLength","blobDataView","blobDataViewBuffer","blobDataHeaderView","blobDataHeaderLength","Blob","fromBlob","blob","arrayBuffer","blobDataHeaderByteLength","arrayConstructor","header","parse","TextDecoder","decode","geometryBuffer","getAttribute","attributeArrayConstructor","attributeArray","bufferStride","bufferArraySliceIndex","GeometryBase","toBuilder","BoundingSphere","hitsSphere","otherCenter","otherRadius","hitsBox","sphereX","sphereY","sphereZ","minX","minY","minZ","maxX","maxY","maxZ","corners","FramebufferStatus","FramebufferTextureTarget","FramebufferAttachment","RenderbufferPixelFormat","DrawBuffer","TexturePixelFormat","TextureInternalPixelFormat","TexturePixelType","TextureParameter","TextureTarget","TextureMagFilter","TextureMinFilter","TextureCompareMode","TextureWrapMode","TextureCompareFunction","ShaderType","UniformType","UniformDataType","StencilAction","BufferMask","Buffer","TestFunction","BlendingMode","BlendingEquation","Capabilities","Face","WindingOrder","HintTarget","HintMode","BoundingBox","fromBoxes","boxes","positiveInfinity","POSITIVE_INFINITY","negativeInfinity","NEGATIVE_INFINITY","box_i","boxMinX","boxMinY","boxMinZ","boxMaxX","boxMaxY","boxMaxZ","hits","otherMin","otherMax","otherMinX","otherMinY","otherMinZ","otherMaxX","otherMaxZ","otherMaxY","corner_i","transformed","GeometryBuilder","halfEdges","vertices","faces","create","structuredClone","addTriangleFace","v0","v1","v2","properties","addFace","addQuadFace","v3","addVertex","position","vertex","halfEdgeID","_halfEdges","_vertices","_faces","faceVerticesCount","error","face","faceID","sourceID","targetID","firstHalfEdgeID","halfEdge","previousHalfEdgeID","vertexFacesIterator","face_i","faceHalfEdgesIterator","halfEdge_i","targetID_i","prevID","prevID_i","twinID","nextID","twinHalfEdge","indexOf","linesArray","flatMap","faceVertices","faceVerticesIterator","vertex_i","verticesArray","tangentsArray","faceUvs","uv","uv0","uv1","uv2","edge1","v1_i","edge2","deltaUV1","uv1_i","deltaUV2","tangent","edge1_i","tangent_i","normalsArray","ni","pi","normal_i","uvsArray","flat","trianglesIndicesArray","verticesCount","concat","linesIndicesArray","boundingBox","boundingSphere","FaceHalfEdgesIterator","FaceVerticesIterator","VertexFacesIterator","geometry","reset","current","nextHalfEdgeID","faceHalfEdgeID","firstVertexID","vertexID","vertexHalfEdgeID","CubeGeometry","depth","widthSegments","heightSegments","depthSegments","builder","floor","uvs","u","udir","vdir","gridX","gridY","segmentWidth","segmentHeight","widthHalf","heightHalf","depthHalf","gridX1","gridY1","iy","ix","indicesCount","vi1","vi2","vi3","vi4","ui1","ui2","ui3","ui4","v4","uv3","uv4","QuadGeometry","WebGLFramebufferUtilities","createFramebuffer","internalFramebuffer","createRenderbuffer","internalRenderbuffer","bindRenderbuffer","RENDERBUFFER","samples","internalFormat","renderbufferStorageMultisample","renderbufferStorage","attachTexture","framebuffer","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","attachments","attachment","textureTarget","texture","internalTexture","framebufferTexture2D","status","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","unbindFramebuffer","drawBuffers","attachRenderbuffer","props","framebufferRenderbuffer","renderbuffer","blit","readFramebuffer","drawFramebuffer","readRectangle","drawRectangle","mask","READ_FRAMEBUFFER_BINDING","internalReadFramebuffer","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER_BINDING","internalDrawFramebuffer","DRAW_FRAMEBUFFER","blitFramebuffer","readPixels","format","pixels","deleteFramebuffer","isFramebuffer","deleteRenderbuffer","isRenderbuffer","WebGLTextureUtilities","getTexturesUnitsEntries","createTexture","unit","subimages","lod","border","mipmap","ACTIVE_TEXTURE","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texImage2D","subimage_i","xoffset","yoffset","texSubImage2D","TEXTURE_CUBE_MAP","xPos","xNeg","yPos","yNeg","zPos","zNeg","TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_CUBE_MAP_NEGATIVE_X","TEXTURE_CUBE_MAP_POSITIVE_Y","TEXTURE_CUBE_MAP_NEGATIVE_Y","TEXTURE_CUBE_MAP_POSITIVE_Z","TEXTURE_CUBE_MAP_NEGATIVE_Z","TEXTURE_2D_ARRAY","texImage3D","zoffset","texSubImage3D","generateMipmap","mag","wrapS","wrapT","wrapR","baseMipmapLevel","maxMipmapLevel","compareFunction","compareMode","minLod","maxLod","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE_WRAP_R","TEXTURE_BASE_LEVEL","TEXTURE_MAX_LEVEL","TEXTURE_COMPARE_FUNC","TEXTURE_COMPARE_MODE","texParameterf","TEXTURE_MIN_LOD","TEXTURE_MAX_LOD","setUnpackAlignment","alignment","pixelStorei","UNPACK_ALIGNMENT","deleteTexture","isTexture","delete","WebGLProgramUtilities","createShader","internalShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","shaderInfoLog","getShaderInfoLog","deleteShader","createProgram","vertexSource","fragmentSource","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","attachShader","linkProgram","getProgramParameter","LINK_STATUS","programInfoLog","getProgramInfoLog","vertexInfoLog","fragmentInfoLog","deleteProgram","recompileProgram","useProgram","CURRENT_PROGRAM","WebGLUniformUtilities","asArrayBufferView","uniformValue","of","getUniformSetter","uniform","uniformType","num","uniform1f","uniform1ui","BOOL","uniform1i","INT_SAMPLER_2D","INT_SAMPLER_2D_ARRAY","INT_SAMPLER_3D","INT_SAMPLER_CUBE","SAMPLER_2D","SAMPLER_3D","SAMPLER_CUBE","SAMPLER_2D_SHADOW","SAMPLER_2D_ARRAY","SAMPLER_2D_ARRAY_SHADOW","SAMPLER_CUBE_SHADOW","UNSIGNED_INT_SAMPLER_2D","UNSIGNED_INT_SAMPLER_3D","UNSIGNED_INT_SAMPLER_CUBE","UNSIGNED_INT_SAMPLER_2D_ARRAY","tex","FLOAT_VEC2","isArray","list","uniform2fv","BOOL_VEC2","INT_VEC2","uniform2iv","UNSIGNED_INT_VEC2","uniform2uiv","FLOAT_VEC3","uniform3fv","BOOL_VEC3","INT_VEC3","uniform3iv","UNSIGNED_INT_VEC3","uniform3uiv","FLOAT_VEC4","uniform4fv","BOOL_VEC4","INT_VEC4","uniform4iv","UNSIGNED_INT_VEC4","uniform4uiv","FLOAT_MAT2","uniformMatrix2fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","FLOAT_MAT2x3","uniformMatrix2x3fv","FLOAT_MAT2x4","uniformMatrix2x4fv","FLOAT_MAT3x2","uniformMatrix3x2fv","FLOAT_MAT3x4","uniformMatrix3x4fv","FLOAT_MAT4x2","uniformMatrix4x2fv","FLOAT_MAT4x3","uniformMatrix4x3fv","getUniformsListSetter","uniformsNames","uniformIndices","getUniformIndices","activeUniforms","ACTIVE_UNIFORMS","validUniformIndices","index_i","isValid","setters","getActiveUniform","getUniformLocation","setUniformsListValues","uniformName","WebGLUniformBlockUtilities","getBindingPointsEntries","createUniformBlock","blockIndex","getUniformBlockIndex","INVALID_INDEX","blockSize","getActiveUniformBlockParameter","UNIFORM_BLOCK_DATA_SIZE","layout","blockUniformsIndices","UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES","getActiveUniforms","UNIFORM_OFFSET","uniformOffset_i","uniformIndex","uniformInfo","createUniformBuffer","bind","UNIFORM_BUFFER","bindingPoint","lastBindingPoint","createRangedUniformBuffers","blocks","offsetAlignment","UNIFORM_BUFFER_OFFSET_ALIGNMENT","block","ceil","rangeOffset","rangeSize","rangedUniformBuffer","setUniformBufferValues","uniforms","UNIFORM_BUFFER_BINDING","setUniformBufferData","bindUniformBuffer","uniformBlockBinding","bindBufferRange","bindBufferBase","WebGLPacketUtilities","createTextures","textures","_textures","createPacket","packet","programProperties","vertexArrayProperties","uniformsProperties","uniformBlocks","uniformBlocksProperties","uniformBuffers","uniformBuffersProperties","drawCommand","uniformBlocksPropertiesEntries","uniformBuffersMaxIndex","uniformBlockProperty","uniformBuffersProperty_i","relatedBlockProperties","relatedBlocks","blockName","relatedBlocksCount","block_i","rangedBuffers","rangedBuffer","relatedBlock","uniformBlockProperties","setPacketValues","vertexArrayValues","uniformsValues","uniformsBlocksValues","uniformBlock","enableMultidrawExtension","getExtension","drawPacket","mode","instanceCount","multiDraw","VERTEX_ARRAY_BINDING","drawElementsInstanced","multiDrawExtension","countsList","countsOffset","offsetsList","offsetsOffset","drawCount","instanceCountsList","instanceCountsOffset","multiDrawElementsInstancedWEBGL","multiDrawElementsWEBGL","drawElements","drawArraysInstanced","firstsList","firstsOffset","multiDrawArraysInstancedWEBGL","multiDrawArraysWEBGL","drawArrays","WebGLRendererUtilities","hint","frontFace","winding","scissor","viewport","clearColor","color","depthFunction","func","depthFunc","blendEquation","equ","blendFunction","srcFunc","dstFunc","blendFunc","blendFunctionSeparate","srcAlpha","dstAlpha","blendFuncSeparate","stencilFunction","ref","stencilFuncSeparate","stencilOperations","fail","zFail","zPass","stencilOpSeparate","stencilMask","stencilMaskSeparate","colorMask","red","green","blue","alpha","depthMask","flag","enable","capability","disable","getViewport","VIEWPORT","getMaxSamples","MAX_SAMPLES","buffers","clearBuffers","clearBufferfv","clearBufferiv","clearBufferuiv","ColorBase","rgb","Color","rgba","rgbOrR","aOrG","colors","simpleSceneDOM","async","start","template","createElement","innerHTML","body","insertBefore","content","firstChild","render","fps","playing","toolbar","querySelector","onclick","item","closest","pressed","requestAnimationFrame","getElementById","canvas2D","ctx","getContext","devicePixelRatio","CANVAS_WIDTH","CANVAS_HEIGHT","style","phongVert","fetch","then","resp","text","phongFrag","phongProgram","skyboxVert","skyboxFrag","skyboxProgram","textureVert","textureFrag","texProgram","basicVert","basicFrag","basicProgram","depthVert","depthFrag","depthProgram","linesVertex","linesFragment","linesProgram","fetchImage","url","ok","Promise","resolve","img","Image","onload","albedoMapImg","brickwallImg","normalMapImg","normalMap2Img","displacementMapImg","skyboxXPosImg","skyboxXNegImg","skyboxYPosImg","skyboxYNegImg","skyboxZPosImg","skyboxZNegImg","colorsImg","paddedImage","image","paddedWidth","PADDING","paddedHeight","drawImage","getImageData","paddedBrickwallImg","paddedAlbedoMapImg","paddedNormalMap2","paddedColorsImg","albedoMap","LUMINANCE","NEAREST","albedoMaps","RGB","LINEAR","normalMap","LINEAR_MIPMAP_LINEAR","displacementMap","RGBA","skybox","fbColorTex","CLAMP_TO_EDGE","depthTex","DEPTH_COMPONENT","DEPTH_COMPONENT24","anisotropicTargetTextures","anisotropicExtension","log","maxFiltering","MAX_TEXTURE_MAX_ANISOTROPY_EXT","TEXTURE_MAX_ANISOTROPY_EXT","cubeGeometry","quadGeometryBuilder","cube","lightTransform","viewDirectionProjectionInverse","cubeGeometryBuilder","cubeVerticesArray","cubeIndicesArray","cubeNormalsArray","cubeUVsArray","cubeTangentsArray","cubeLinesArray","cubeGeometryBuffer","a_position","a_tangent","a_normal","a_uv","cubeVertices","cubeNormals","cubeUVs","cubeTangents","cubeColors","phongCubePacketProperties","DYNAMIC_READ","a_color","subTexture","u_xOffset","u_yOffset","u_zOffset","u_xScaling","u_yScaling","viewBlock","modelBlock","lightsBlock","phongBlock","u_albedoMap","u_normalMap","u_displacementMap","u_albedoMaps","TRIANGLES","phongPacketInitValues","u_view","u_projection","RED","phongCubePacket","WHITE","GREEN","linesProperties","u_color","LINES","basicPacketProperties","basicModelBlock","u_model","quadIndices","quadVertices","quadUVs","quadWorld","skyboxPacketProperties","u_world","u_viewDirectionProjectionInverse","u_skybox","depthPacketProperties","u_depthWorld","u_depthTex","texPacketProperties","u_tex","skyboxPacket","depthPacket","texPacket","maxSamples","DEPTH_ATTACHMENT","RGBA8","COLOR_ATTACHMENT0","postFramebuffer","DEPTH_TEST","CULL_FACE","BLEND","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","lastFrameTime","cameraControl","BLACK","font","strokeStyle","fillStyle","frameTime","clearRect","shadowBlur","strokeText","toFixed","fillText","renderGUI","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","LEQUAL","LESS","newWidth","newHeight","ALWAYS","launchScene","ModelChangeRecordBase","changeType","propertyName","oldValue","newValue","removedIndex","removedItems","insertedIndex","insertedItems","sortedIndices","init","ModelNodesList","PROPERTY_CHANGE","LIST_REMOVE","LIST_INSERT","LIST_SORT","ModelChangeRecord","items","ModelEventBase","currentTarget","setCurrentTarget","setTarget","ModelEventTargetAccessor","ModelEvent","ModelEventTargetBase","receiveEvent","callbacks","callback_i","callback","removeEventListener","callbackIndex","findIndex","splice","dispatchEvent","ModelNodeBase","parentNode","setParent","isCyclicReference","ancestorNode","TypeError","beginChanges","endChanges","getRecords","property","records","record","triggerChange","node","handleRecord","ModelNodeRecordsAccessor","ModelNode","ReactiveProperty","ModelReactivePropertiesAccessor","getProperty","setProperty","ModelObjectBase","ModelObject","ModelList","item_i","sort","indexedItems","indexedItem_a","indexedItem_b","indexedItem_i","prepend","_items","append","insert","remove","removedItem_i","ModelChangeObserver","WeakMap","observe","references","reference","listener","unobserve","disconnect","propertiesFilter","childList","subtree","record_i","includes","camelToTrain","str","toLowerCase","AttributeProperty","String","defaultValue","observed","observedAttributes","Reflect","writable","Boolean","hasAttribute","setAttribute","removeAttribute","parseFloat","CustomElement","elementCtor","customElements","define","QueryProperty","propertyKey","selector","getter","withinShadowRoot","shadowRoot","tagName","dataset","children","listeners","element","attributeValue","toggleAttribute","elementDataset","name_i","listener_i","reactiveElementsMap","FinalizationRegistry","heldValue","model","reactiveElement","reactiveElementsMapEntry","reactiveElementsArray","reactiveElement_i","elementRef","react","deref","reactiveChildElementsMap","reactiveChildElement","reactiveChildrenElementsMapEntry","reactiveChildElementsArray","range","listLength","reactiveChildElements_i","parentRef","mapping","placeholder","parent","childrenCount","removeChild","insertedItemsArray","before","removedCount","createRange","removeEndIndex","setStartBefore","setEndAfter","deleteContents","childrenArray","__decorate","decorators","desc","arguments","getOwnPropertyDescriptor","decorate","DEFAULT_THEME_HOVERED_ITEM_COLOR","DEFAULT_THEME_FOCUSED_ITEM_COLOR","DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR","DEFAULT_THEME_SELECTED_ITEM_COLOR","DEFAULT_THEME_ACTIVATED_ITEM_COLOR","Theme","stylesheet","images","checkedImage","arrowRightImage","arrowDropDownImage","arrowDropUpImage","CSSStyleSheet","tint","variablesMap","cssRules","styleMap","shadowTemplate","HTMLEMenuItemElementBase","HTMLElement","internals","part","attachInternals","role","attachShadow","adoptedStylesheet","adoptedStyleSheets","cloneNode","connectedCallback","tabIndex","attributeChangedCallback","ariaChecked","ariaDisabled","ariaExpanded","ariaLabel","toggle","force","expanded","expand","Event","bubbles","collapse","menu","menuStyle","menuWidth","menuHeight","clientWidth","clientHeight","offsetLeft","offsetTop","overflowX","overflowY","HTMLEMenuItemElement","EMenuItem","label","trigger","slot","tabindex","title","click","checkbox","radio","submenu","HTMLEMenuItemGroupElementBase","HTMLEMenuElementBase_1","toggleAnimations","HTMLEMenuItemGroupElement","radios","HTMLEMenuElementBase","querySelectorAll","activeIndex","activeItem","createTreeWalker","NodeFilter","SHOW_ELEMENT","parseInt","positionContextual","scrollX","scrollY","contains","FILTER_ACCEPT","FILTER_SKIP","FILTER_REJECT","firstItem","walker","currentNode","root","lastChild","previousNode","nextNode","targetItem","checked","radio_i","stopPropagation","nearestItem","relatedTarget","contextual","previousItem","focus","preventScroll","nextItem","lastItem","firstChildItem","composedPath","target_i","HTMLEMenuElement","blur","cancel","toggleAnimation","animate","duration","finished","catch","finally","parentItem","menuRect","intersectsWithMouse","containsRelatedTarget","HTMLEMenuBarElementBase","disabled","hidden","previousSibling","nextSibling","Element","isExpanded","HTMLEMenuButtonElementBase","iconPartTemplate","HTMLEMenuButtonElement","HTMLEToolBarItemElementBase","iconPart","HTMLEToolBarItemElement","EToolBarItem","menubutton","select","HTMLEToolBarItemGroupElementBase","textContent","wasExpandedOnMouseDown","HTMLEToolBarItemGroupElement","HTMLEToolBarElementBase","active","HTMLEHandleElementBase","controls","pointerId","releasePointerCapture","setPointerCapture","targetComputedStyle","getComputedStyle","movementX","movementY","rectWidth","rectHeight","outerElement","parentElement","outerRectLeft","outerRectRight","outerRectTop","outerRectBottom","getPropertyValue","newLeft","newTop","CustomEvent","HTMLEImportElementBase","outerHTML","response","statusText","barShadowTemplate","spinnerShadowTemplate","HTMLELoaderElementBase","replaceChildren","HTMLESeparatorElementBase","HTMLEToolTipElementBase","tooltip","htmlFor","rootNode","getRootNode","Document","ShadowRoot","oldTarget","targetListenerObject","show","immediate","id","visible","opacity","delay","hide","targetTop","targetBottom","targetLeft","targetRight","tooltipWidth","tooltipHeight","tooltipHalfWidth","tooltipHalfHeight","targetCenter","targetMiddle","tooltipStyle","arrow","arrowStyle","arrowWidth","arrowHeight","arrowHalfWidth","arrowHalfHeight","documentListenerObject","menubar","iconed","tooltips","for","main","after"],"sourceRoot":""}