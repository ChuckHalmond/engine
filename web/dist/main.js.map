{"version":3,"file":"main.js","mappings":"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CA,4CACA,4CACA,yCACA,oBACA,mBACA,qCACA,mCACA,qCACA,uCAbJ,CAAYA,KAAAA,GAAkB,KAgB9B,SAAYC,GACR,wBACA,oBACA,sBACA,gCACA,4CACA,iDACA,iDACA,mDACA,+CACA,iDACA,mBACA,+BACA,qBACA,iCACA,uBACA,mCACA,2BACA,yBACA,yBACA,6BACA,qCACA,mCACA,uBACA,yBACA,uCACA,uBACA,2BACA,6BACA,uBACA,yBACA,2BACA,6BACA,2CACA,6BACA,uBACA,uBACA,yBACA,uBACA,yBACA,uBACA,yBACA,yBACA,2BACA,yBACA,2BACA,yBACA,2BACA,2BACA,6BACA,2BACA,6BACA,2BACA,6BACA,6BACA,+BACA,6BACA,+BAzDJ,CAAYA,KAAAA,GAA0B,KA4DtC,SAAYC,GACR,sBACA,wCACA,wBACA,0CACA,oBACA,sCACA,wBACA,kCACA,2DACA,2DACA,uDACA,qEACA,iDACA,uEACA,+DACA,2EACA,mDAjBJ,CAAYA,KAAAA,GAAgB,KAoB5B,SAAYC,GACR,mDACA,mDACA,2CACA,2CACA,mDACA,iDACA,6CACA,6CACA,2CACA,uDACA,uDAXJ,CAAYA,KAAAA,GAAgB,KAc5B,SAAYC,GACR,kCACA,+CACA,mCACA,+CACA,qEACA,qEACA,qEACA,qEACA,qEACA,qEAVJ,CAAYA,KAAAA,GAAa,KAazB,SAAYC,GACR,0BACA,4BAFJ,CAAYA,KAAAA,GAAgB,KAK5B,SAAYC,GACR,0BACA,4BACA,0DACA,wDACA,wDACA,sDANJ,CAAYA,KAAAA,GAAgB,KAS5B,SAAYC,GACR,2DACA,mBAFJ,CAAYA,KAAAA,GAAkB,KAK9B,SAAYC,GACR,2BACA,yCACA,6CAHJ,CAAYA,KAAAA,GAAe,KAM3B,SAAYC,GACR,uBACA,qBACA,uBACA,yBACA,2BACA,6BACA,yBACA,yBARJ,CAAYA,KAAAA,GAAsB,KAsE3B,MAAMI,GAKTj6B,iCACI,OAAO,GAAA5G,KAAI,WAAe0sB,UAG9B9lB,qBAAqB4kB,EAA4BxoB,EAAcizB,GAC3D,MAAMkI,EAAkB3S,EA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","sources":["webpack://main/webpack/bootstrap","webpack://main/webpack/runtime/define property getters","webpack://main/webpack/runtime/global","webpack://main/webpack/runtime/hasOwnProperty shorthand","webpack://main/webpack/runtime/make namespace object","webpack://main/webpack/runtime/publicPath","webpack://main/./src/engine/libs/patterns/injectors/Injector.ts","webpack://main/./src/engine/libs/maths/MathError.ts","webpack://main/./src/engine/libs/maths/algebra/vectors/Vector2.ts","webpack://main/./src/engine/libs/maths/algebra/vectors/Vector3.ts","webpack://main/./src/engine/core/input/Input.ts","webpack://main/./src/engine/libs/maths/geometry/space/Space.ts","webpack://main/./src/engine/core/controls/FreeCameraControl.ts","webpack://main/./src/engine/libs/patterns/pools/Pool.ts","webpack://main/./src/engine/libs/patterns/pools/StackPool.ts","webpack://main/./src/engine/libs/maths/Snippets.ts","webpack://main/./src/engine/libs/maths/algebra/matrices/Matrix3.ts","webpack://main/./src/engine/libs/maths/algebra/quaternions/Quaternion.ts","webpack://main/./src/engine/libs/maths/algebra/matrices/Matrix4.ts","webpack://main/./src/engine/libs/maths/extensions/pools/Vector3Pools.ts","webpack://main/./src/engine/libs/maths/statistics/random/UUIDGenerator.ts","webpack://main/./src/engine/core/general/Transform.ts","webpack://main/./src/engine/libs/maths/geometry/primitives/Plane.ts","webpack://main/./src/engine/libs/physics/collisions/Frustum.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLBufferUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLVertexArrayUtilities.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/GeometryBuffer.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/Geometry.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/bounding/BoundingSphere.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/bounding/BoundingBox.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/geometry.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLFramebufferUtilities.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/GeometryBuilder.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/lib/polyhedron/CubeGeometry.ts","webpack://main/./src/engine/core/rendering/scenes/geometries/lib/QuadGeometry.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLTextureUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLProgramUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLUniformUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLUniformBlockUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLRendererUtilities.ts","webpack://main/./src/engine/core/rendering/webgl/WebGLPacketUtilities.ts","webpack://main/./src/engine/libs/graphics/colors/Color.ts","webpack://main/./src/samples/scenes/SimpleScene.ts","webpack://main/./src/engine/core/rendering/scenes/cameras/PerspectiveCamera.ts","webpack://main/./src/engine/core/rendering/scenes/cameras/Camera.ts","webpack://main/./src/engine/core/rendering/scenes/objects/Object3D.ts","webpack://main/../editor/lib/models/Model.js","webpack://main/../editor/lib/elements/Snippets.js","webpack://main/../editor/lib/elements/Element.js","webpack://main/../editor/lib/stylesheets/Theme.js","webpack://main/../editor/lib/elements/containers/menus/MenuItem.js","webpack://main/../editor/lib/elements/containers/menus/MenuItemGroup.js","webpack://main/../editor/lib/elements/containers/menus/Menu.js","webpack://main/../editor/lib/elements/containers/menus/MenuBar.js","webpack://main/../editor/lib/elements/containers/menus/MenuButton.js","webpack://main/../editor/lib/elements/containers/toolbars/ToolBarItem.js","webpack://main/../editor/lib/elements/containers/toolbars/ToolBarItemGroup.js","webpack://main/../editor/lib/elements/containers/toolbars/ToolBar.js","webpack://main/../editor/lib/elements/misc/Handle.js","webpack://main/../editor/lib/elements/misc/Import.js","webpack://main/../editor/lib/elements/misc/Loader.js","webpack://main/../editor/lib/elements/misc/Separator.js","webpack://main/../editor/lib/elements/misc/ToolTip.js","webpack://main/./main.ts"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","export { Injector };\r\nexport { InjectorBase };\r\nexport { Inject };\r\nexport { Register };\r\n\r\ninterface InjectorConstructor {\r\n    readonly prototype: Injector;\r\n    new<C extends Constructor<any>>(args: {defaultCtor: C, onDefaultOverride: (constructor: C) => void}): Injector<C>;\r\n}\r\n\r\ninterface Injector<C extends Constructor<any> = Constructor<any>> {\r\n    readonly defaultCtor: C;\r\n    overrideDefaultCtor(constructor: C): void;\r\n    forceQualifier(qualifier: string): void;\r\n    unforceQualifier(): void;\r\n    getConstructor(qualifier?: string): C;\r\n    inject(args?: { qualifier?: string, args?: ConstructorParameters<C> }): InstanceType<C>;\r\n    register(constructor: C, qualifier: string): void; \r\n}\r\n\r\nclass InjectorBase<C extends Constructor<any> = Constructor<any>> implements Injector<C> {\r\n    private _forcedQualifier?: string;\r\n    private _constructors: Map<string, C>;\r\n    private _defaultCtor: C;\r\n    private _onDefaultOverride: (constructor: C) => void;\r\n\r\n    get defaultCtor(): C {\r\n        return this._defaultCtor;\r\n    }\r\n\r\n    overrideDefaultCtor(constructor: C): void {\r\n        this._defaultCtor = constructor;\r\n        this._onDefaultOverride(constructor);\r\n    }\r\n\r\n    constructor(args: {defaultCtor: C, onDefaultOverride: (constructor: C) => void}) {\r\n        this._defaultCtor = args.defaultCtor;\r\n        this._onDefaultOverride = args.onDefaultOverride;\r\n        this._constructors = new Map();\r\n    }\r\n\r\n    forceQualifier(qualifier: string): void {\r\n        this._forcedQualifier = qualifier;\r\n    }\r\n\r\n    unforceQualifier(): void {\r\n        delete this._forcedQualifier;\r\n    }\r\n\r\n    getConstructor(qualifier?: string): C {\r\n        const qualifierValue = this._forcedQualifier || qualifier;\r\n        if (typeof qualifierValue === 'undefined') {\r\n            return this._defaultCtor;\r\n        }\r\n        const constructor = this._constructors.get(qualifierValue);\r\n        if (typeof constructor === 'undefined') {\r\n            throw new Error(`No constructor for qualifier ${qualifierValue}`);\r\n        }\r\n        return constructor;\r\n    }\r\n\r\n    inject(args?: { qualifier?: string, args?: ConstructorParameters<C> }): InstanceType<C> {\r\n        const constructor = this.getConstructor(args?.qualifier);\r\n        if (args?.args) {\r\n            const parameters = Array.from(args.args);\r\n            return new constructor(...parameters);\r\n        }\r\n        return new constructor();\r\n    }\r\n\r\n    register(constructor: C, qualifier: string): void {\r\n        if (!this._constructors.has(qualifier)) {\r\n            this._constructors.set(qualifier, constructor);\r\n        }\r\n    }\r\n}\r\n\r\nconst Injector: InjectorConstructor = InjectorBase;\r\n\r\ntype UnwrappedInjectorConstructor<I> = I extends Injector<infer C> ? C : never;\r\n\r\ninterface RegisterDecorator {\r\n    <I extends Injector>(injector: I, qualifier?: string): <C extends UnwrappedInjectorConstructor<I>>(ctor: C) => C;\r\n}\r\n\r\nconst Register: RegisterDecorator = function<\r\n    I extends Injector\r\n>(injector: I, qualifier?: string): any {\r\n    return <C extends UnwrappedInjectorConstructor<I>>(\r\n        ctor: C\r\n    ) => {\r\n        if (typeof qualifier !== 'undefined') {\r\n            injector.register(ctor, qualifier);\r\n        }\r\n        injector.register(ctor, ctor.name);\r\n        return ctor;\r\n    }\r\n}\r\n\r\nfunction Inject<\r\n    I extends Injector,\r\n    P extends ConstructorParameters<UnwrappedInjectorConstructor<I>>,\r\n>(injector: I, options?: {qualifier?: string, args?: P}): any {\r\n    return (\r\n        target: any,\r\n        propertyKey: string\r\n    ) => {\r\n        const instance = injector.inject(options);\r\n\r\n        Object.defineProperty(target, propertyKey, {\r\n            value: instance\r\n        });\r\n    }\r\n}","export class MathError extends Error {\r\n    name = 'MathError';\r\n}","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { Matrix2 } from \"../matrices/Matrix2\";\r\n\r\nexport { Vector2Injector };\r\nexport { Vector2 };\r\nexport { Vector2Base };\r\n\r\nexport type Vector2Values = [number, ...number[]] & { length: 2 };\r\n\r\ninterface Vector2Constructor {\r\n\treadonly prototype: Vector2;\r\n\tnew(): Vector2;\r\n\tnew(a: number, y: number): Vector2;\r\n  \tnew(array: ArrayLike<number>): Vector2;\r\n}\r\n\r\ninterface Vector2 {\r\n\treadonly array: Float32Array;\r\n\tvalues: Vector2Values;\r\n\tx: number;\r\n\ty: number;\r\n\tsetValues(x: number, y: number): this;\r\n\tcopy(vec: Vector2): this;\r\n\tclone(): this;\r\n\tequals(vec: Vector2): boolean;\r\n\tsetUnit(): this;\r\n\tsetZeros(): this;\r\n\tadd(vec: Vector2): this;\r\n\taddScalar(k: number): this;\r\n\tsub(vec: Vector2): this;\r\n\tlerp(vec: Vector2, t: number): this;\r\n\tclamp(min: Vector2, max: Vector2): this;\r\n\tmultScalar(k: number): this;\r\n\tcross(vec: Vector2): number;\r\n\tdot(vec: Vector2): number;\r\n\tlength(): number;\r\n\tlengthSquared(): number;\r\n\tdist(vec: Vector2): number;\r\n\tdistSquared(vec: Vector2): number;\r\n\tnormalize(): this;\r\n\tnegate(): this;\r\n\tmult(vec: Vector2): this;\r\n\tmult(mat: Matrix2): this\r\n\taddScaled(vec: Vector2, k: number): this;\r\n\tcopyAndSub(vecA: Vector2, vecB: Vector2): this;\r\n\twriteIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n    readFromArray(arr: ArrayLike<number>, offset?: number): this;\r\n}\r\n\r\nclass Vector2Base {\r\n\treadonly array: Float32Array;\r\n\r\n\tconstructor()\r\n\tconstructor(array: ArrayLike<number>)\r\n\t  constructor(\r\n\t  x: number, y: number\r\n\t)\r\n\tconstructor(\r\n\t  ...args: any[]\r\n\t) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis.array = new Float32Array([args[0], args[1]]);\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n\t\t\tconst array = args[0];\r\n\t\t\tif (array.length < 2) {\r\n\t\t\t\tthrow new MathError(`Array must be of length 2 at least.`);\r\n\t\t\t}\r\n\t\t\tif (array instanceof Float32Array) {\r\n\t\t\t\tthis.array = array;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.array = new Float32Array(array);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.array = new Float32Array([0, 0]);\r\n\t\t}\r\n\t}\r\n\r\n\tget values(): Vector2Values {\r\n\t\treturn [\r\n\t\t\tthis.array[0],\r\n\t\t\tthis.array[1]\r\n\t\t];\r\n\t}\r\n\r\n\tset values(values: Vector2Values) {\r\n\t\tthis.array[0] = values[0];\r\n\t\tthis.array[1] = values[1];\r\n\t}\r\n\r\n\tget x() {\r\n\t\treturn this.array[0];\r\n\t}\r\n\r\n\tset x(x: number) {\r\n\t\tthis.array[0] = x;\r\n\t}\r\n\r\n\tget y() {\r\n\t\treturn this.array[1];\r\n\t}\r\n\r\n\tset y(y: number) {\r\n\t\tthis.array[1] = y;\r\n\t}\r\n\r\n\tsetValues(x: number, y: number): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = x;\r\n\t\to[1] = y;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tequals(vec: Vector2Base): boolean {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\t\t\r\n\t\treturn v[0] === o[0]\r\n\t\t\t&& v[1] === o[1];\r\n\t}\r\n\r\n\tcopy(vec: Vector2Base): this {\r\n\t\tconst o = this.array;\r\n\t\tconst v = vec.array;\r\n\r\n\t\to[0] = v[0];\r\n\t\to[1] = v[1];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone(): this {\r\n\t\treturn new Vector2Base(this.values) as this;\r\n\t}\r\n\r\n\tsetUnit(): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = 1;\r\n\t\to[1] = 1;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetZeros(): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = 0;\r\n\t\to[1] = 0;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tadd(vec: Vector2Base): this {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] + v[0];\r\n\t\to[1] = o[1] + v[1];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\taddScalar(k: number): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] + k;\r\n\t\to[1] = o[1] + k;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsub(vec: Vector2Base): this {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] - v[0];\r\n\t\to[1] = o[1] - v[1];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tlerp(vec: Vector2Base, t: number): this {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = t * (v[0] - o[0]);\r\n\t\to[1] = t * (v[1] - o[1]);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclamp(min: Vector2Base, max: Vector2Base): this {\r\n\t\tconst o = this.array;\r\n\t\tconst l = min.array;\r\n\t\tconst g = max.array;\r\n\r\n\t\to[0] = Math.min(g[0], Math.min(o[0], l[0])),\r\n\t\to[1] = Math.min(g[1], Math.min(o[1], l[1]))\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmultScalar(k: number): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] * k;\r\n\t\to[1] = o[1] * k;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcross(vec: Vector2Base): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\treturn a[0] * b[1] - a[1] * b[0];\r\n\t}\r\n\r\n\tdot(vec: Vector2Base): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\treturn (a[0] * b[0]) + (a[1] * b[1]);\r\n\t}\r\n\r\n\tlength(): number {\r\n\t\tconst v = this.array;\r\n\r\n\t\treturn Math.sqrt(v[0] * v[0] + v[1] * v[1]);\r\n\t}\r\n\r\n\tlengthSquared(): number {\r\n\t\tconst v = this.array;\r\n\r\n\t\treturn v[0] * v[0] + v[1] * v[1];\r\n\t}\r\n\r\n\tdist(vec: Vector2Base): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\tconst dx = a[0] - b[0];\r\n\t\tconst dy = a[1] - b[1];\r\n\r\n\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t}\r\n\r\n\tdistSquared(vec: Vector2Base): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\tconst dx = a[0] - b[0];\r\n\t\tconst dy = a[1] - b[1];\r\n\r\n\t\treturn dx * dx + dy * dy;\r\n\t}\r\n\r\n\tnormalize(): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\tconst lenSq = o[0] * o[0] + o[1] * o[1];\r\n\t\tconst len = Math.sqrt(lenSq);\r\n\t\tif (len > Number.EPSILON) {\r\n\t\t\to[0] = o[0] / len;\r\n\t\t\to[1] = o[1] / len;\r\n\t\t}\r\n\t\telse {\r\n\t\t\to[0] = 0;\r\n\t\t\to[1] = 0;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnegate(): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = -o[0];\r\n\t\to[1] = -o[1];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmult(mat: Matrix2): this\r\n\tmult(vec: Vector2): this\r\n\tmult(arg0: Matrix2 | Vector2): this {\r\n\t\tif (arg0 instanceof Vector2) {\r\n\t\t\tconst v = arg0.array;\r\n\r\n\t\t\tthis.array[0] = this.array[0] * v[0];\r\n\t\t\tthis.array[1] = this.array[1] * v[1];\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst x = this.x;\r\n\t\t\tconst y = this.y;\r\n\r\n\t\t\tconst m = arg0.array;\r\n\r\n\t\t\tthis.x = x * m[0] + y * m[2];\r\n\t\t\tthis.y = x * m[1] + y * m[3];\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\taddScaled(vec: Vector2Base, k: number): this {\r\n\t\tconst v = vec.array;\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = o[0] + v[0] * k;\r\n\t\to[1] = o[1] + v[1] * k;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\twriteIntoArray(out: WritableArrayLike<number>, offset: number = 0): void {\r\n\t\tconst v = this.array;\r\n\r\n\t\tout[offset    ] = v[0];\r\n\t\tout[offset + 1] = v[1];\r\n    }\r\n    \r\n    readFromArray(arr: ArrayLike<number>, offset: number = 0): this {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[0] = arr[offset    ];\r\n\t\to[1] = arr[offset + 1];\r\n\r\n\t\treturn this;\r\n    }\r\n\r\n\tcopyAndSub(vecA: Vector2Base, vecB: Vector2Base): this {\r\n\t\tconst o = this.array;\r\n\t\tconst a = vecA.array;\r\n\t\tconst b = vecB.array;\r\n\t\r\n\t\to[0] = a[0] - b[0];\r\n\t\to[1] = a[1] - b[1];\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nvar Vector2: Vector2Constructor = Vector2Base;\r\nconst Vector2Injector: Injector<Vector2Constructor> = new Injector({\r\n\tdefaultCtor: Vector2Base,\r\n\tonDefaultOverride:\r\n\t\t(ctor: Vector2Constructor) => {\r\n\t\t\tVector2 = ctor;\r\n\t\t}\r\n});","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { Matrix3 } from \"../matrices/Matrix3\";\r\n\r\nexport { Vector3Constructor };\r\nexport { Vector3 };\r\nexport { Vector3Base };\r\nexport { Vector3Injector };\r\n\r\nexport type Vector3Values = [number, ...number[]] & { length: 3 };\r\n\r\ninterface Vector3Constructor {\r\n\treadonly prototype: Vector3;\r\n\tnew(): Vector3;\r\n\tnew(x: number, y: number, z: number): Vector3;\r\n  \tnew(array: ArrayLike<number>): Vector3;\r\n\tangle(vectorA: Vector3, vectorB: Vector3): number;\r\n}\r\n\r\ninterface Vector3 extends Iterable<number> {\r\n\treadonly array: Float32Array;\r\n\tvalues: Vector3Values;\r\n\tx: number;\r\n\ty: number;\r\n\tz: number;\r\n\ttoString(): string;\r\n\tsetValues(\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\tz: number\r\n\t): this;\r\n\tequals(vec: Vector3): boolean;\r\n\tcopy(vec: Vector3): this;\r\n\tclone(): this;\r\n\tsetUnit(): this;\r\n\tsetZeros(): this;\r\n\ttoCartesian(center: Vector3): this;\r\n\ttoSpherical(center: Vector3): this;\r\n\tadd(vec: Vector3): this;\r\n\taddScalar(k: number): this;\r\n\tsub(vec: Vector3): this;\r\n\tlerp(from: Vector3, to: Vector3, t: number): this;\r\n\tmax(vecB: Vector3): this;\r\n\tmin(vecB: Vector3): this;\r\n\tclamp(min: Vector3, max: Vector3): this;\r\n\tscale(k: number): this;\r\n\tcross(vec: Vector3): this;\r\n\tdot(vec: Vector3): number;\r\n\tlength(): number;\r\n\tlengthSquared(): number;\r\n\tdistance(vec: Vector3): number;\r\n\tdistanceSquared(vec: Vector3): number;\r\n\tnormalize(): this;\r\n\tnegate(): this;\r\n\tmult(vec: Vector3): this;\r\n\tmult(mat: Matrix3): this;\r\n\taddScaled(vec: Vector3, k: number): this;\r\n\tcopyAndSub(vecA: Vector3, vecB: Vector3): this;\r\n\tcopyAndCross(vecA: Vector3, vecB: Vector3): this;\r\n\twriteIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n    readFromArray(arr: ArrayLike<number>, offset?: number): this;\r\n}\r\n\r\nclass Vector3Base implements Vector3 {\r\n\treadonly array: Float32Array;\r\n\r\n\tconstructor()\r\n\tconstructor(array: ArrayLike<number>)\r\n\t  constructor(\r\n\t  x: number, y: number, z: number\r\n\t)\r\n\tconstructor(\r\n\t  ...args: any[]\r\n\t) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis.array = new Float32Array([args[0], args[1], args[2]]);\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n\t\t\tconst array = args[0];\r\n\t\t\tif (array.length < 3) {\r\n\t\t\t\tthrow new MathError(`Array must be of length 3 at least.`);\r\n\t\t\t}\r\n\t\t\tif (array instanceof Float32Array) {\r\n\t\t\t\tthis.array = array;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.array = new Float32Array(array);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.array = new Float32Array([0, 0, 0]);\r\n\t\t}\r\n\t}\r\n\r\n\ttoString(): string {\r\n\t\treturn `Vector3([${Array.from(this.array).join(\", \")}])`;\r\n\t}\r\n\r\n\tstatic angle(vectorA: Vector3, vectorB: Vector3): number {\r\n\t\tconst temp = new Vector3();\r\n\t\treturn Math.acos(temp.copy(vectorA).dot(vectorB) / (Math.sqrt(temp.copy(vectorA).dot(vectorA)) * Math.sqrt(temp.copy(vectorB).dot(vectorB))));\r\n\t}\r\n\r\n\tget values(): Vector3Values {\r\n\t\treturn [\r\n\t\t\tthis.array[0],\r\n\t\t\tthis.array[1],\r\n\t\t\tthis.array[2]\r\n\t\t];\r\n\t}\r\n\r\n\tset values(values: Vector3Values) {\r\n\t\tthis.array[0] = values[0];\r\n\t\tthis.array[1] = values[1];\r\n\t\tthis.array[2] = values[2];\r\n\t}\r\n\r\n\tget x() {\r\n\t\treturn this.array[0];\r\n\t}\r\n\r\n\tset x(x: number) {\r\n\t\tthis.array[0] = x;\r\n\t}\r\n\r\n\tget y() {\r\n\t\treturn this.array[1];\r\n\t}\r\n\r\n\tset y(y: number) {\r\n\t\tthis.array[1] = y;\r\n\t}\r\n\r\n\tget z() {\r\n\t\treturn this.array[2];\r\n\t}\r\n\r\n\tset z(z: number) {\r\n\t\tthis.array[2] = z;\r\n\t}\r\n\r\n\tsetValues(x: number, y: number, z: number): this {\r\n\t\tthis.array[0] = x;\r\n\t\tthis.array[1] = y;\r\n\t\tthis.array[2] = z;\r\n\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tcopy(vec: Vector3): this {\r\n\t\tconst v = vec.array;\r\n\r\n\t\tthis.array[0] = v[0];\r\n\t\tthis.array[1] = v[1];\r\n\t\tthis.array[2] = v[2];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone(): this {\r\n\t\treturn new Vector3Base(this.values) as this;\r\n\t}\r\n\r\n\tequals(vector: Vector3): boolean {\r\n\t\treturn vector.array[0] === this.array[0]\r\n\t\t\t&& vector.array[1] === this.array[1]\r\n\t\t\t&& vector.array[2] === this.array[2];\r\n\t}\r\n\r\n\tsetZeros(): this {\r\n\t\tthis.array[0] = 0;\r\n\t\tthis.array[1] = 0;\r\n\t\tthis.array[2] = 0;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetUnit(): this {\r\n\t\tthis.array[0] = 1;\r\n\t\tthis.array[1] = 1;\r\n\t\tthis.array[2] = 1;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tadd(vector: Vector3): this {\r\n\t\tthis.array[0] = this.array[0] + vector.array[0];\r\n\t\tthis.array[1] = this.array[1] + vector.array[1];\r\n\t\tthis.array[2] = this.array[2] + vector.array[2];\r\n\t\treturn this;\r\n\t}\r\n\r\n\taddScalar(k: number): this {\r\n\t\tthis.array[0] = this.array[0] + k;\r\n\t\tthis.array[1] = this.array[1] + k;\r\n\t\tthis.array[2] = this.array[2] + k;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsub(vector: Vector3): this {\r\n\t\tthis.array[0] = this.array[0] - vector.array[0];\r\n\t\tthis.array[1] = this.array[1] - vector.array[1];\r\n\t\tthis.array[2] = this.array[2] - vector.array[2];\r\n\t\treturn this;\r\n\t}\r\n\r\n\tlerp(from: Vector3, to: Vector3, t: number): this {\r\n\t\tthis.array[0] = (1 - t) * from.x + t * (to.x - from.x);\r\n\t\tthis.array[1] = (1 - t) * from.y + t * (to.y - from.y);\r\n\t\tthis.array[2] = (1 - t) * from.z + t * (to.z - from.z);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmax(vectorB: Vector3): this {\r\n\t\tthis.array[0] = Math.max(this.array[0], vectorB.array[0]);\r\n\t\tthis.array[1] = Math.max(this.array[1], vectorB.array[1]);\r\n\t\tthis.array[2] = Math.max(this.array[2], vectorB.array[2]);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmin(vectorB: Vector3): this {\r\n\t\tthis.array[0] = Math.min(this.array[0], vectorB.array[0]);\r\n\t\tthis.array[1] = Math.min(this.array[1], vectorB.array[1]);\r\n\t\tthis.array[2] = Math.min(this.array[2], vectorB.array[2]);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclamp(min: Vector3, max: Vector3): this {\r\n\t\tthis.array[0] = Math.min(max.array[0], Math.max(this.array[0], min.array[0]));\r\n\t\tthis.array[1] = Math.min(max.array[1], Math.max(this.array[1], min.array[1]));\r\n\t\tthis.array[2] = Math.min(max.array[2], Math.max(this.array[2], min.array[2]));\r\n\t\treturn this;\r\n\t}\r\n\r\n\tscale(k: number): this {\r\n\t\tthis.array[0] = this.array[0] * k;\r\n\t\tthis.array[1] = this.array[1] * k;\r\n\t\tthis.array[2] = this.array[2] * k;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcross(vector: Vector3): this {\r\n\t\tconst t0 = this.array[1] * vector.array[2] - this.array[2] * vector.array[1];\r\n\t\tconst t1 = this.array[2] * vector.array[0] - this.array[0] * vector.array[2];\r\n\t\tconst t2 = this.array[0] * vector.array[1] - this.array[1] * vector.array[0];\r\n\t\tthis.array[0] = t0;\r\n\t\tthis.array[1] = t1;\r\n\t\tthis.array[2] = t2;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdot(vec: Vector3): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\treturn a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n\t}\r\n\r\n\tlength(): number {\r\n\t\tconst a = this.array;\r\n\r\n\t\treturn Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\r\n\t}\r\n\r\n\tlengthSquared(): number {\r\n\t\tconst a = this.array;\r\n\t\t\r\n\t\treturn a[0] * a[0] + a[1] * a[1] + a[2] * a[2];\r\n\t}\r\n\r\n\tdistance(vec: Vector3): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\tconst dx = a[0] - b[0];\r\n\t\tconst dy = a[1] - b[1];\r\n\t\tconst dz = a[2] - b[2];\r\n\r\n\t\treturn Math.hypot(dx, dy, dz);\r\n\t}\r\n\r\n\tdistanceSquared(vec: Vector3): number {\r\n\t\tconst a = this.array;\r\n\t\tconst b = vec.array;\r\n\r\n\t\tconst dx = a[0] - b[0];\r\n\t\tconst dy = a[1] - b[1];\r\n\t\tconst dz = a[2] - b[2];\r\n\r\n\t\treturn dx * dx + dy * dy + dz * dz;\r\n\t}\r\n\r\n\tnormalize(): this {\r\n\t\tconst {array} = this;\r\n\t\tconst length = this.length();\r\n\t\tif (length > Number.EPSILON) {\r\n\t\t\tarray[0] /= length;\r\n\t\t\tarray[1] /= length;\r\n\t\t\tarray[2] /= length;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tarray[0] = 0;\r\n\t\t\tarray[1] = 0;\r\n\t\t\tarray[2] = 0;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnegate(): this {\r\n\t\tconst {array} = this;\r\n\t\tarray[0] *= -1;\r\n\t\tarray[1] *= -1;\r\n\t\tarray[2] *= -1;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmult(mat: Matrix3): this\r\n\tmult(vec: Vector3): this\r\n\tmult(arg0: Matrix3 | Vector3): this {\r\n\t\tconst {array} = this;\r\n\t\tif (arg0 instanceof Vector3) {\r\n\t\t\tconst v = arg0.array;\r\n\r\n\t\t\tarray[0] = array[0] * v[0];\r\n\t\t\tarray[1] = array[1] * v[1];\r\n\t\t\tarray[2] = array[2] * v[2];\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst [x, y, z] = this;\r\n\r\n\t\t\tconst m = arg0.array;\r\n\r\n\t\t\tthis.x = x * m[0] + y * m[3] + z * m[6];\r\n\t\t\tthis.y = x * m[1] + y * m[4] + z * m[7];\r\n\t\t\tthis.z = x * m[2] + y * m[5] + z * m[8];\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\ttoSpherical(center: Vector3): this {\r\n        const thisArray = this.array;\r\n        const centerArray = center.array;\r\n\r\n        const x = thisArray[0] - centerArray[0];\r\n        const y = thisArray[1] - centerArray[1];\r\n        const z = thisArray[2] - centerArray[2];\r\n\r\n        const roh = Math.hypot(x, y, z);\r\n        const theta = Math.acos(y / roh);\r\n        const phi = Math.atan2(z, x);\r\n        thisArray[0] = roh;\r\n        thisArray[1] = theta;\r\n        thisArray[2] = phi;\r\n\r\n\t\treturn this;\r\n    }\r\n\r\n    toCartesian(center: Vector3): this {\r\n        const thisArray = this.array;\r\n        const centerArray = center.array;\r\n\r\n        const roh = thisArray[0];\r\n        const theta = thisArray[1];\r\n        const phi = thisArray[2];\r\n\r\n        const x = roh * Math.sin(theta) * Math.cos(phi) + centerArray[0];\r\n        const y = roh * Math.cos(theta) + centerArray[1];\r\n        const z = roh * Math.sin(theta) * Math.sin(phi) + centerArray[2];\r\n        thisArray[0] = x;\r\n        thisArray[1] = y;\r\n        thisArray[2] = z;\r\n\r\n\t\treturn this;\r\n    }\r\n\r\n\tstatic mult(mat: Matrix3, vec: Vector3): Vector3 {\r\n\t\tconst m = mat.array;\r\n\t\tconst v = vec.array;\r\n\r\n\t\treturn new Vector3Base([\r\n\t\t\tm[0] * v[0] + m[1] * v[1] + m[2] * v[2],\r\n\t\t\tm[3] * v[0] + m[4] * v[1] + m[5] * v[2],\r\n\t\t\tm[6] * v[0] + m[7] * v[1] + m[8] * v[2]\r\n\t\t]);\r\n\t}\r\n\r\n\twriteIntoArray(out: WritableArrayLike<number>, offset: number = 0): void {\r\n\t\tconst v = this.array;\r\n\r\n\t\tout[offset    ] = v[0];\r\n\t\tout[offset + 1] = v[1];\r\n\t\tout[offset + 2] = v[2];\r\n    }\r\n    \r\n    readFromArray(arr: ArrayLike<number>, offset: number = 0): this {\r\n\t\tthis.array[0] = arr[offset    ];\r\n\t\tthis.array[1] = arr[offset + 1];\r\n\t\tthis.array[2] = arr[offset + 2];\r\n\r\n\t\treturn this;\r\n    }\r\n\r\n\taddScaled(vector: Vector3, k: number): this {\r\n\t\tthis.array[0] = this.array[0] + vector.array[0] * k;\r\n\t\tthis.array[1] = this.array[1] + vector.array[1] * k;\r\n\t\tthis.array[2] = this.array[2] + vector.array[2] * k;\r\n\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tcopyAndSub(vecA: Vector3, vecB: Vector3): this {\r\n\t\tconst a = vecA.array;\r\n\t\tconst b = vecB.array;\r\n\t\r\n\t\tthis.array[0] = a[0] - b[0];\r\n\t\tthis.array[1] = a[1] - b[1];\r\n\t\tthis.array[2] = a[2] - b[2];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcopyAndCross(vecA: Vector3, vecB: Vector3): this {\r\n\t\tconst a = vecA.array;\r\n\t\tconst b = vecB.array;\r\n\t\t\r\n\t\tconst t0 = a[1] * b[2] - a[2] * b[1];\r\n\t\tconst t1 = a[2] * b[0] - a[0] * b[2];\r\n\t\tconst t2 = a[0] * b[1] - a[1] * b[0];\r\n\r\n\t\tthis.array[0] = t0;\r\n\t\tthis.array[1] = t1;\r\n\t\tthis.array[2] = t2;\r\n\t\r\n\t\treturn this;\r\n\t}\r\n\r\n\t[Symbol.iterator] (): Iterator<number> {\r\n\t\tconst {array} = this;\r\n\t\tconst {length} = array;\r\n\t\tlet i = 0;\r\n\t\treturn {\r\n\t\t\tnext() {\r\n\t\t\t\tif (i < length) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: array[i++], done: false\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: undefined, done: true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar Vector3: Vector3Constructor = Vector3Base;\r\n\r\nconst Vector3Injector: Injector<Vector3Constructor> = new Injector({\r\n\tdefaultCtor: Vector3Base,\r\n\tonDefaultOverride:\r\n\t\t(ctor: Vector3Constructor) => {\r\n\t\t\tVector3 = ctor;\r\n\t\t}\r\n});","import { Vector2 } from \"../../libs/maths/algebra/vectors/Vector2\";\r\n\r\nexport { Key };\r\nexport { KeyModifier };\r\nexport { HotKey };\r\nexport { MouseButton };\r\nexport { Input };\r\n\r\nenum Key {\r\n    A = \"a\",\r\n    B = \"b\",\r\n    C = \"c\",\r\n    D = \"d\",\r\n    E = \"e\",\r\n    F = \"f\",\r\n    G = \"g\",\r\n    H = \"h\",\r\n    I = \"i\",\r\n    J = \"j\",\r\n    K = \"k\",\r\n    L = \"l\",\r\n    M = \"m\",\r\n    O = \"o\",\r\n    P = \"p\",\r\n    Q = \"q\",\r\n    R = \"r\",\r\n    S = \"s\",\r\n    T = \"t\",\r\n    U = \"u\",\r\n    V = \"v\",\r\n    W = \"w\",\r\n    X = \"x\",\r\n    Y = \"y\",\r\n    Z = \"z\",\r\n    ENTER = \"Enter\",\r\n    BACKSPACE = \"Backspace\",\r\n    ARROW_DOWN = \"ArrowDown\",\r\n    ARROW_LEFT = \"ArrowLeft\",\r\n    ARROW_RIGHT = \"ArrowRight\",\r\n    ARROW_UP = \"ArrowUp\",\r\n    SHIFT = \"Shift\"\r\n}\r\n\r\nconst KEYS_COUNT = Object.keys(Key).length;\r\n\r\nenum KeyModifier {\r\n    Alt = \"Alt\",\r\n    Control = \"Control\",\r\n    Shift = \"Shift\",\r\n}\r\n\r\nfunction displayKeyModifier(mode: KeyModifier): string {\r\n    switch (mode) {\r\n        case KeyModifier.Control:\r\n            return \"Ctrl\";\r\n        default:\r\n            return mode;\r\n    }\r\n}\r\n\r\nenum MouseButton {\r\n    LEFT = 0,\r\n    WHEEL = 1,\r\n    RIGHT = 2,\r\n    FORWARD = 3,\r\n    BACK = 4\r\n}\r\n\r\nconst MOUSE_BUTTONS_COUNT = Object.keys(MouseButton).length;\r\n\r\nconst MOUSE_BUTTONS_INDICES = Object.freeze(\r\n    Object.values(MouseButton).reduce(\r\n        (map, button, index) => Object.assign(map, {[button]: index}), {} as any\r\n    )\r\n);\r\n\r\nconst KEYS_INDICES = Object.freeze(\r\n    Object.values(Key).reduce(\r\n        (map, key, index) => Object.assign(map, {[key]: index}), {} as any\r\n    )\r\n);\r\n\r\nconst INPUT_EVENT_UP = 0;\r\nconst INPUT_EVENT_DOWN = 1;\r\nconst INPUT_EVENT_REPEAT = 2;\r\n\r\nconst testKeyModifier = (mod: KeyModifier, event: KeyboardEvent) => {\r\n    switch (mod) {\r\n        case \"Alt\":\r\n            return event.altKey;\r\n        case \"Control\":\r\n            return event.ctrlKey;\r\n        case \"Shift\":\r\n            return event.shiftKey;\r\n        default:\r\n            return () => true;\r\n    }\r\n}\r\n\r\nclass HotKey {\r\n\r\n    readonly key: Key;\r\n    readonly mod1?: KeyModifier;\r\n    readonly mod2?: KeyModifier;\r\n\r\n    constructor(key: Key, mod1?: KeyModifier, mod2?: KeyModifier) {\r\n        this.key = key;\r\n        this.mod1 = mod1;\r\n        this.mod2 = mod2;\r\n    }\r\n\r\n    toString(): string {\r\n        return `${this.mod1 ? `${displayKeyModifier(this.mod1)}+` : ''}${this.mod2 ? `${displayKeyModifier(this.mod2)}+` : ''}${(this.key.length === 1) ? this.key.toUpperCase() : this.key}`;\r\n    }\r\n\r\n    /*static fromString(str: string): HotKey | null {\r\n        const keys = Object.values(Key);\r\n        const keyModifiers = Object.values(KeyModifier);\r\n\r\n        let key: Key;\r\n        let mod1: KeyModifier | undefined;\r\n        let mod2: KeyModifier | undefined;\r\n\r\n        const keysStr = str.split(' + ');\r\n        if (keysStr.length >= 1) {\r\n            key = keysStr[0] as Key;\r\n            if (!keys.indexOf(key)) {\r\n                return null;\r\n            }\r\n            if (keysStr.length >= 2) {\r\n                mod1 = keysStr[1] as KeyModifier;\r\n                if (!keyModifiers.indexOf(mod1)) {\r\n                    return null;\r\n                }\r\n            }\r\n            if (keysStr.length >= 3) {\r\n                mod2 = keysStr[2] as KeyModifier;\r\n                if (!keyModifiers.indexOf(mod2)) {\r\n                    return null;\r\n                }\r\n            }\r\n            return new HotKey(key, mod1, mod2);\r\n        }\r\n        return null;\r\n    }*/\r\n\r\n    test(event: KeyboardEvent): boolean {\r\n        return ((!this.mod1 || testKeyModifier(this.mod1, event)) && (!this.mod2 || testKeyModifier(this.mod2, event)) && event.key === this.key);\r\n    }\r\n}\r\n\r\ninterface Input {\r\n    initialize(canvas: HTMLCanvasElement): void;\r\n    clear(): void;\r\n    getKey(key: Key): boolean;\r\n    getKeyUp(key: Key): boolean;\r\n    getKeyDown(key: Key): boolean;\r\n    getMouseButton(button: MouseButton): boolean;\r\n    getPointerPosition(): Vector2;\r\n    getPointerScreenPosition(): Vector2;\r\n    getWheelDelta(): number;\r\n    getMouseButtonDown(button: MouseButton): boolean;\r\n    getMouseButtonUp(button: MouseButton): boolean;\r\n}\r\n\r\nclass InputBase implements Input {\r\n    private readonly keyFlags = new Array<boolean>(3 * KEYS_COUNT).fill(false);\r\n    private readonly mouseFlags = new Array<boolean>(3 * MOUSE_BUTTONS_COUNT).fill(false);\r\n    private readonly pointerPosition = new Vector2();\r\n    private wheelDelta = 0;\r\n    private canvas: HTMLCanvasElement | null = null;\r\n    private canvasRectangle: DOMRect | null = null;\r\n\r\n    initialize(canvas: HTMLCanvasElement): void {\r\n        this.canvas = canvas;\r\n        this.canvasRectangle = canvas.getBoundingClientRect();\r\n        canvas.addEventListener(\"pointerdown\", this);\r\n        canvas.addEventListener(\"pointerup\", this);\r\n        canvas.addEventListener(\"contextmenu\", this);\r\n        canvas.addEventListener(\"pointermove\", this);\r\n        canvas.addEventListener(\"wheel\", this);\r\n        canvas.addEventListener(\"keydown\", this);\r\n        canvas.addEventListener(\"keyup\", this);\r\n        canvas.addEventListener(\"focusout\", this);\r\n    }\r\n\r\n    getCanvasRect(): DOMRect {\r\n        const rect = this.canvasRectangle;\r\n        if (rect === null) {\r\n            throw new Error(`Input manager not initialized.`);\r\n        }\r\n        return rect;\r\n    }\r\n\r\n    clear(): void {\r\n        this.keyFlags.fill(false, 0, INPUT_EVENT_REPEAT * KEYS_COUNT);\r\n        this.mouseFlags.fill(false, 0, INPUT_EVENT_REPEAT * MOUSE_BUTTONS_COUNT);\r\n        this.wheelDelta = 0;\r\n    }\r\n    \r\n    handleEvent(event: Event): void {\r\n        let eventIndex = -1;\r\n        switch (event.type) {\r\n            case \"pointerdown\":\r\n                eventIndex = MOUSE_BUTTONS_INDICES[(event as MouseEvent).button as MouseButton];\r\n                this.mouseFlags[INPUT_EVENT_DOWN * MOUSE_BUTTONS_COUNT + eventIndex] = true;\r\n                this.mouseFlags[INPUT_EVENT_REPEAT * MOUSE_BUTTONS_COUNT + eventIndex] = true;\r\n                break;\r\n            case \"pointerup\":\r\n                eventIndex = MOUSE_BUTTONS_INDICES[(event as MouseEvent).button as MouseButton];\r\n                this.mouseFlags[INPUT_EVENT_UP * MOUSE_BUTTONS_COUNT + eventIndex] = true;\r\n                this.mouseFlags[INPUT_EVENT_REPEAT * MOUSE_BUTTONS_COUNT + eventIndex] = false;\r\n                break;\r\n            case \"pointermove\":\r\n                const canvasRect = this.getCanvasRect();\r\n                this.pointerPosition.setValues(\r\n                    ((event as MouseEvent).clientX - canvasRect.left),\r\n                    ((event as MouseEvent).clientY - canvasRect.top),\r\n                );\r\n                break;\r\n            case \"wheel\":\r\n                this.wheelDelta = (event as WheelEvent).deltaY / 100;\r\n                break;\r\n            case \"keydown\":\r\n                eventIndex = KEYS_INDICES[(event as KeyboardEvent).key as Key];\r\n                this.keyFlags[INPUT_EVENT_DOWN * KEYS_COUNT + eventIndex] = true;\r\n                this.keyFlags[INPUT_EVENT_REPEAT * KEYS_COUNT + eventIndex] = true;\r\n                break;\r\n            case \"keyup\":\r\n                eventIndex = KEYS_INDICES[(event as KeyboardEvent).key as Key];\r\n                this.keyFlags[INPUT_EVENT_UP * KEYS_COUNT + eventIndex] = true;\r\n                this.keyFlags[INPUT_EVENT_REPEAT * KEYS_COUNT + eventIndex] = false;\r\n                break;\r\n            case \"focusout\":\r\n                this.keyFlags.fill(false);\r\n                this.mouseFlags.fill(false);\r\n                this.wheelDelta = 0;\r\n                this.pointerPosition.setZeros();\r\n                break;\r\n        }\r\n    }\r\n    \r\n    /*static getAxis(axisName: string) {\r\n\r\n    }\r\n\r\n    static getButton(buttonName: string) {\r\n\r\n    }\r\n\r\n    static getButtonUp(buttonName: string) {\r\n\r\n    }\r\n\r\n    static getButtonDown(buttonName: string) {\r\n\r\n    }*/\r\n\r\n    getKey(key: Key): boolean {\r\n        return this.keyFlags[INPUT_EVENT_REPEAT * KEYS_COUNT + KEYS_INDICES[key]];\r\n    }\r\n\r\n    getKeyUp(key: Key): boolean {\r\n        return this.keyFlags[INPUT_EVENT_UP * KEYS_COUNT + KEYS_INDICES[key]];\r\n    }\r\n\r\n    getKeyDown(key: Key): boolean {\r\n        return this.keyFlags[INPUT_EVENT_DOWN * KEYS_COUNT + KEYS_INDICES[key]];\r\n    }\r\n\r\n    getMouseButton(button: MouseButton): boolean {\r\n        return this.mouseFlags[INPUT_EVENT_REPEAT * MOUSE_BUTTONS_COUNT + MOUSE_BUTTONS_INDICES[button]];\r\n    }\r\n\r\n    getPointerPosition(): Vector2 {\r\n        return this.pointerPosition.clone();\r\n    }\r\n\r\n    getPointerScreenPosition(): Vector2 {\r\n        const positionAray = this.pointerPosition.array;\r\n        const canvasRect = this.getCanvasRect();\r\n        const x = (positionAray[0] / canvasRect.width) * 2 - 1;\r\n        const y = (positionAray[1] / canvasRect.height) * 2 - 1;\r\n        return new Vector2([x, y]);\r\n    }\r\n\r\n    getWheelDelta(): number {\r\n        return this.wheelDelta;\r\n    }\r\n\r\n    getMouseButtonDown(button: MouseButton): boolean {\r\n        return this.mouseFlags[INPUT_EVENT_DOWN * MOUSE_BUTTONS_COUNT + MOUSE_BUTTONS_INDICES[button]];\r\n    }\r\n\r\n    getMouseButtonUp(button: MouseButton): boolean {\r\n        return this.mouseFlags[INPUT_EVENT_UP * MOUSE_BUTTONS_COUNT + MOUSE_BUTTONS_INDICES[button]];\r\n    }\r\n}\r\n\r\nvar Input: Input = new InputBase();","import { Vector3 } from \"../../algebra/vectors/Vector3\";\r\n\r\nexport class Space {\r\n\r\n    private constructor () {};\r\n    \r\n    static readonly origin:      Vector3 = new Vector3([ 0,  0,  0]);\r\n    static readonly right:       Vector3 = new Vector3([ 1,  0,  0]);\r\n    static readonly left:        Vector3 = new Vector3([-1,  0,  0]);\r\n    static readonly up:          Vector3 = new Vector3([ 0,  1,  0]);\r\n    static readonly down:        Vector3 = new Vector3([ 0, -1,  0]);\r\n    static readonly forward:     Vector3 = new Vector3([ 0,  0,  1]);\r\n    static readonly backward:    Vector3 = new Vector3([ 0,  0, -1]);\r\n}","import { Vector2 } from \"../../libs/maths/algebra/vectors/Vector2\";\r\nimport { Vector3 } from \"../../libs/maths/algebra/vectors/Vector3\";\r\nimport { Space } from \"../../libs/maths/geometry/space/Space\";\r\nimport { Input, MouseButton, Key } from \"../input/Input\";\r\nimport { Camera } from \"../rendering/scenes/cameras/Camera\";\r\n\r\nexport { FreeCameraControl };\r\n\r\nconst tempVector1 = new Vector3();\r\nconst tempVector2 = new Vector3();\r\nconst tempVector3 = new Vector3();\r\n\r\ninterface FreeCameraControlConstructor {\r\n    readonly prototype: FreeCameraControl;\r\n    new(camera: Camera, params?: {rotationSpeed?: number, translationSpeed?: number}): FreeCameraControl;\r\n}\r\n\r\ninterface FreeCameraControl {\r\n    camera: Camera;\r\n    rotationSpeed: number;\r\n    translationSpeed: number;\r\n    update(deltaTime: number): void;\r\n}\r\n\r\nclass FreeCameraControlBase {\r\n    camera: Camera;\r\n    rotationSpeed: number;\r\n    translationSpeed: number;\r\n\r\n    #lastPointerPosition: Vector2;\r\n\r\n    constructor(camera: Camera, params?: {rotationSpeed?: number, translationSpeed?: number}) {\r\n        this.camera = camera;\r\n        this.rotationSpeed = params?.rotationSpeed ?? 50;\r\n        this.translationSpeed = params?.translationSpeed ?? 8;\r\n        this.#lastPointerPosition = new Vector2();\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        const {camera, rotationSpeed, translationSpeed} = this;\r\n        const lastPointerPosition = this.#lastPointerPosition;\r\n        const {transform: cameraTransform} = camera;\r\n        const cameraPosition = cameraTransform.getTranslation(tempVector1);\r\n        const cameraForward = cameraTransform.getBackward(tempVector2);\r\n        const {array: cameraForwardArray} = cameraForward;\r\n        const {origin, up, down} = Space;\r\n        let cameraUpSign = cameraTransform.getUp(tempVector3).dot(up);\r\n        \r\n        if (Input.getKey(Key.Z) || Input.getKey(Key.ARROW_UP)) {\r\n            const forward = cameraTransform.getBackward(tempVector3).scale(translationSpeed * deltaTime);\r\n            cameraTransform.translate(forward);\r\n        }\r\n        if (Input.getKey(Key.Q) || Input.getKey(Key.ARROW_LEFT)) {\r\n            const left = cameraTransform.getLeft(tempVector3).scale(translationSpeed * deltaTime);\r\n            cameraTransform.translate(left);\r\n        }\r\n        if (Input.getKey(Key.S) || Input.getKey(Key.ARROW_DOWN)) {\r\n            const backward = cameraTransform.getForward(tempVector3).scale(translationSpeed * deltaTime);\r\n            cameraTransform.translate(backward);\r\n        }\r\n        if (Input.getKey(Key.D) || Input.getKey(Key.ARROW_RIGHT)) {\r\n            const right = cameraTransform.getRight(tempVector3).scale(translationSpeed * deltaTime);\r\n            cameraTransform.translate(right);\r\n        }\r\n\r\n        if (Input.getMouseButtonDown(MouseButton.RIGHT)) {\r\n            lastPointerPosition.copy(Input.getPointerScreenPosition());\r\n        }\r\n        \r\n        if (Input.getMouseButton(MouseButton.RIGHT)) {\r\n            const newPointerPosition = Input.getPointerScreenPosition();\r\n            if (!newPointerPosition.equals(lastPointerPosition)) {\r\n                const dx = (lastPointerPosition.x - newPointerPosition.x) * rotationSpeed * deltaTime;\r\n                const dy = (lastPointerPosition.y - newPointerPosition.y) * rotationSpeed * deltaTime;\r\n                cameraPosition.copy(cameraTransform.getTranslation(tempVector3));\r\n                if (dx !== 0 || dy !== 0) {\r\n                    cameraUpSign = Math.sign(cameraTransform.getUp(tempVector3).dot(up));\r\n                    cameraForward.toSpherical(origin);\r\n                    const theta = cameraForwardArray[1];\r\n                    const phi = cameraForwardArray[2];\r\n                    const newTheta = theta + cameraUpSign * -dy;\r\n                    if (newTheta <= 0 || newTheta >= Math.PI) {\r\n                        cameraForwardArray[2] = (phi - dx + Math.PI) % (2 * Math.PI);\r\n                        cameraForwardArray[1] = newTheta < 0 ? -newTheta : Math.PI - (newTheta - Math.PI);\r\n                        cameraUpSign *= -1;\r\n                    }\r\n                    else {\r\n                        cameraForwardArray[2] = (phi - dx) % (2 * Math.PI);\r\n                        cameraForwardArray[1] = theta + cameraUpSign * -dy;\r\n                    }\r\n                    cameraForward.toCartesian(origin);\r\n                    cameraTransform.lookAt(cameraPosition.add(cameraForward), (cameraUpSign > 0) ? up : down);\r\n                }\r\n                lastPointerPosition.copy(newPointerPosition);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nvar FreeCameraControl: FreeCameraControlConstructor = FreeCameraControlBase;","export { PoolAutoExtendPolicy };\r\nexport { Pool };\r\nexport { PoolBase };\r\n\r\nenum PoolAutoExtendPolicy {\r\n    NO_AUTO_EXTEND = 0,\r\n    AUTO_EXTEND_ONE = 1,\r\n    AUTO_EXTEND_POW2 = 2\r\n}\r\n\r\ninterface PoolConstructor {\r\n    readonly prototype: Pool;\r\n    new<O extends object>(constructor: Constructor<O>, policy?: PoolAutoExtendPolicy): Pool<O>;\r\n}\r\n\r\ninterface Pool<O extends object = object> {\r\n    readonly ctor: Constructor<O>;\r\n    readonly autoExtendPolicy: PoolAutoExtendPolicy;\r\n    autoExtend(): void;\r\n    acquire(count: number): O[];\r\n    release(...args: any[]): void;\r\n    extend(count: number): void;\r\n    clear(): void;\r\n}\r\n\r\nclass PoolBase<O extends object = object> implements Pool<O> {\r\n    readonly ctor: Constructor<O>;\r\n    autoExtendPolicy: PoolAutoExtendPolicy;\r\n    autoExtendTicks: number;\r\n\r\n    constructor(constructor: Constructor<O>, policy?: PoolAutoExtendPolicy) {\r\n        this.ctor = constructor;\r\n        this.autoExtendPolicy = policy || PoolAutoExtendPolicy.AUTO_EXTEND_ONE;\r\n        this.autoExtendTicks = 0;\r\n    }\r\n\r\n    autoExtend(): void {\r\n        switch (this.autoExtendPolicy) {\r\n            case PoolAutoExtendPolicy.AUTO_EXTEND_ONE:\r\n                this.extend(1);\r\n                break;\r\n            case PoolAutoExtendPolicy.AUTO_EXTEND_POW2:\r\n                this.extend(Math.pow(2, this.autoExtendTicks));\r\n                break;\r\n        }\r\n        this.autoExtendTicks++;\r\n    }\r\n\r\n    acquire(count: number): O[] {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    release(...args: any[]): void {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    extend(count: number): void {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    clear(): void {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n}\r\n\r\nvar Pool: PoolConstructor = PoolBase;","import { PoolAutoExtendPolicy, PoolBase, Pool } from \"./Pool\";\r\n\r\nexport { StackPool };\r\n\r\ninterface StackPool<O extends object = object> extends Pool<O> {\r\n    release(count: number): void;\r\n}\r\n\r\ninterface StackPoolConstructor {\r\n    readonly prototype: StackPool;\r\n    new<O extends object>(constructor: Constructor<O>, options?: {args?: ConstructorParameters<Constructor<O>>, policy?: PoolAutoExtendPolicy, size?: number}): StackPool<O>;\r\n}\r\n\r\nclass StackPoolBase<O extends object = object> extends PoolBase<O> implements Pool<O> {\r\n    objects: Array<O>;\r\n    top: number;\r\n\r\n    constructor(constructor: Constructor<O>, options?: {args?: any, policy?: PoolAutoExtendPolicy, size?: number}) {\r\n        super(constructor, options?.policy);\r\n        this.objects = new Array(options?.size || 0).fill(0).map(() => {\r\n            return new this.ctor(options?.args);\r\n        });\r\n        this.top = 0;\r\n    }\r\n    \r\n    acquire(count: number): O[] {\r\n        const top = this.top;\r\n        const target = top + count;\r\n\r\n        if (this.autoExtendPolicy) {\r\n            while (this.objects.length < target) {\r\n                this.autoExtend();\r\n            }\r\n        }\r\n        this.top = target;\r\n        \r\n        return this.objects.slice(top, target);\r\n    }\r\n\r\n    release(count: number): void {\r\n        const top = this.top;\r\n        if (count > top) {\r\n            console.warn(\"Releasing under zero.\");\r\n        }\r\n        this.top = Math.max(top - count, 0);\r\n    }\r\n\r\n    extend(count: number): void {\r\n        this.objects.push(...Array(count).fill(0).map(() => {\r\n            return new this.ctor();\r\n        }));\r\n    }\r\n    \r\n    clear(): void {\r\n        this.objects = [];\r\n        this.top = 0;\r\n        this.autoExtendTicks = 0;\r\n    }\r\n}\r\n\r\nvar StackPool: StackPoolConstructor = StackPoolBase;","\r\nexport { deg2Rad };\r\nexport { rad2Deg };\r\nexport { qSqrt };\r\nexport { pow2 };\r\nexport { inRange };\r\nexport { clamp };\r\nexport { lerp };\r\nexport { smoothstep };\r\nexport { smootherstep };\r\nexport { randInt };\r\nexport { randFloat };\r\nexport { randFloatSpread };\r\nexport { degToRad };\r\nexport { radToDeg };\r\nexport { isPowerOfTwo };\r\nexport { ceilPowerOfTwo };\r\nexport { floorPowerOfTwo };\r\n\r\nconst DEG2RAD = Math.PI / 180;\r\nconst RAD2DEG = 180 / Math.PI;\r\n\r\nconst deg2Rad = function(deg: number): number {\r\n\treturn DEG2RAD * deg;\r\n}\r\n\r\nconst rad2Deg = function(rad: number): number {\r\n\treturn RAD2DEG / rad;\r\n}\r\n\r\nconst _bytes = new ArrayBuffer(Float32Array.BYTES_PER_ELEMENT);\r\nconst _floatView = new Float32Array(_bytes);\r\nconst _intView = new Uint32Array(_bytes);\r\n\r\nconst qSqrt = function(x: number) {\r\n\tconst halfx = x * 0.5;\r\n\r\n\t_floatView[0] = x;\r\n\t_intView[0] = 0x5f3759df -(_intView[0] >> 1);\r\n\r\n\tlet y = _floatView[0];\r\n\ty = y * (1.5 - (halfx * y * y));\r\n\r\n\treturn y;\r\n}\r\n\r\nconst pow2 = function(k: number): number {\r\n\treturn 1 << k;\r\n}\r\n\t\r\nconst inRange = function(x: number, min: number, max: number): boolean {\r\n\treturn (min <= x) && (x <= max);\r\n}\r\n\r\nconst clamp = function(value: number, min: number, max: number): number {\r\n\treturn Math.max(min, Math.min(max, value));\r\n}\r\n\r\nconst lerp = function(x: number, y: number, t: number): number {\r\n\treturn (1 - t) * x + t * y;\r\n}\r\n\r\nconst smoothstep = function(x: number, min: number, max: number): number {\r\n\tif (x <= min) return 0;\r\n\tif (x >= max) return 1;\r\n\r\n\tx = (x - min) / (max - min);\r\n\r\n\treturn x * x * (3 - 2 * x);\r\n}\r\n\r\nconst smootherstep = function(x: number, min: number, max: number): number {\r\n\tif (x <= min) return 0;\r\n\tif (x >= max) return 1;\r\n\r\n\tx = (x - min) / (max - min);\r\n\r\n\treturn x * x * x * ( x * ( x * 6 - 15) + 10);\r\n}\r\n\r\nconst randInt = function(low: number, high: number): number {\r\n\treturn low + Math.floor(Math.random() * (high - low + 1));\r\n}\r\n\r\nconst randFloat = function(low: number, high: number): number {\r\n\treturn low + Math.random() * (high - low);\r\n}\r\n\r\nconst randFloatSpread = function(range: number): number {\r\n\treturn range * (0.5 - Math.random());\r\n}\r\n\r\nconst degToRad = function(degrees: number): number {\r\n\treturn degrees * DEG2RAD;\r\n}\r\n\r\nconst radToDeg = function(radians: number): number {\r\n\treturn radians * RAD2DEG;\r\n}\r\nconst isPowerOfTwo = function(value: number): boolean {\r\n\treturn (value & (value - 1)) === 0 && value !== 0;\r\n}\r\n\r\nconst ceilPowerOfTwo = function(value: number): number {\r\n\treturn Math.pow(2, Math.ceil(Math.log(value) / Math.LN2));\r\n}\r\n\r\nconst floorPowerOfTwo = function(value: number): number {\r\n\treturn Math.pow(2, Math.floor(Math.log(value) / Math.LN2));\r\n}","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { Vector2, Vector2Values } from \"../vectors/Vector2\";\r\nimport { Vector3Values, Vector3 } from \"../vectors/Vector3\";\r\n\r\nexport { Matrix3Values };\r\nexport { Matrix3 };\r\nexport { Matrix3Injector };\r\nexport { Matrix3Base };\r\n\r\ntype Matrix3Values = [\r\n  number, number, number,\r\n  number, number, number,\r\n  number, number, number\r\n];\r\n\r\ninterface Matrix3Constructor {\r\n\treadonly prototype: Matrix3;\r\n\tnew(): Matrix3;\r\n\tnew(\r\n    m11: number, m21: number, m31: number,\r\n    m12: number, m22: number, m32: number,\r\n    m13: number, m23: number, m33: number\r\n  ): Matrix3;\r\n  new(array: ArrayLike<number>): Matrix3;\r\n  rotationX(angle: number): Matrix3;\r\n  rotationY(angle: number): Matrix3;\r\n  rotationZ(angle: number): Matrix3;\r\n}\r\n\r\ninterface Matrix3 {\r\n  readonly array: WritableArrayLike<number>;\r\n  setValues(\r\n    m11: number, m21: number, m31: number,\r\n    m12: number, m22: number, m32: number,\r\n    m13: number, m23: number, m33: number\r\n  ): this;\r\n  getValues(): Matrix3Values;\r\n  row1: Vector3Values;\r\n  row2: Vector3Values;\r\n  row3: Vector3Values;\r\n  col1: Vector3Values;\r\n  col2: Vector3Values;\r\n  col3: Vector3Values;\r\n  m11: number;\r\n  m12: number;\r\n  m13: number;\r\n  m21: number;\r\n  m22: number;\r\n  m23: number;\r\n  m31: number;\r\n  m32: number;\r\n  m33: number;\r\n  setRotationX(angle: number): this;\r\n  setRotationY(angle: number): this;\r\n  setRotationZ(angle: number): this;\r\n\r\n  equals(mat: Matrix3): boolean;\r\n  copy(mat: Matrix3): this;\r\n  clone(): this;\r\n  det(): number;\r\n  trace(): number;\r\n  setIdentity(): this;\r\n  setZeros(): this;\r\n  negate(): this;\r\n  transpose(): this;\r\n  invert(): this;\r\n  add(mat: Matrix3): this;\r\n  sub(mat: Matrix3): this;\r\n  mult(mat: Matrix3): this;\r\n  multScalar(k: number): this;\r\n  solve(vecB: Vector3): Vector3Values;\r\n  solve2(vecB: Vector2): Vector2Values;\r\n  writeIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n  readFromArray(arr: ArrayLike<number>, offset?: number): void;\r\n}\r\n\r\nclass Matrix3Base implements Matrix3 {\r\n  readonly array: Float32Array;\r\n\r\n\tconstructor()\r\n  constructor(array: ArrayLike<number>)\r\n\tconstructor(\r\n    m11: number, m21: number, m31: number,\r\n    m12: number, m22: number, m32: number,\r\n    m13: number, m23: number, m33: number\r\n  )\r\n\tconstructor(\r\n    ...args: any[]\r\n  ) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis.array = new Float32Array([\r\n        args[0], args[1], args[2],\r\n        args[3], args[4], args[5],\r\n        args[6], args[7], args[8]\r\n      ]);\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n      const array = args[0];\r\n      this.checkArray(array);\r\n      if (array instanceof Float32Array) {\r\n        this.array = array;\r\n      }\r\n      else {\r\n        this.array = new Float32Array(array);\r\n      }\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.array = new Float32Array([\r\n        0, 0, 0,\r\n        0, 0, 0,\r\n        0, 0, 0\r\n      ]);\r\n\t\t}\r\n  }\r\n\r\n  get row1(): Vector3Values {\r\n\t\treturn [\r\n      this.array[0],\r\n      this.array[3],\r\n      this.array[6]\r\n    ];\r\n\t}\r\n\r\n\tset row1(row: Vector3Values) {\r\n    this.array[0] = row[0];\r\n    this.array[3] = row[1];\r\n    this.array[6] = row[2];\r\n  }\r\n\r\n  get row2(): Vector3Values {\r\n\t\treturn [\r\n      this.array[1],\r\n      this.array[4],\r\n      this.array[7]\r\n    ];\r\n\t}\r\n\r\n\tset row2(row: Vector3Values) {\r\n    this.array[1] = row[0];\r\n    this.array[4] = row[1];\r\n    this.array[7] = row[2]\r\n  }\r\n\r\n  get row3(): Vector3Values {\r\n\t\treturn [\r\n      this.array[2],\r\n      this.array[5],\r\n      this.array[8]\r\n    ];\r\n\t}\r\n\r\n\tset row3(row: Vector3Values) {\r\n    this.array[2] = row[0];\r\n    this.array[5] = row[1];\r\n    this.array[8] = row[2]\r\n  }\r\n\r\n  get col1(): Vector3Values {\r\n\t\treturn [\r\n      this.array[0],\r\n      this.array[1],\r\n      this.array[2]\r\n    ];\r\n\t}\r\n\r\n\tset col1(col: Vector3Values) {\r\n    this.array[0] = col[0];\r\n    this.array[1] = col[1];\r\n    this.array[2] = col[2];\r\n  }\r\n\r\n  get col2(): Vector3Values {\r\n\t\treturn [\r\n      this.array[3],\r\n      this.array[4],\r\n      this.array[5]\r\n    ];\r\n\t}\r\n\r\n\tset col2(col: Vector3Values) {\r\n    this.array[3] = col[0];\r\n    this.array[4] = col[1];\r\n    this.array[5] = col[2]\r\n  }\r\n\r\n  get col3(): Vector3Values {\r\n\t\treturn [\r\n      this.array[6],\r\n      this.array[7],\r\n      this.array[8]\r\n    ];\r\n\t}\r\n\r\n\tset col3(col: Vector3Values) {\r\n    this.array[6] = col[0];\r\n    this.array[7] = col[1];\r\n    this.array[8] = col[2];\r\n  }\r\n\r\n  get m11() {\r\n\t\treturn this.array[0];\r\n\t}\r\n\r\n\tset m11(val: number) {\r\n\t\tthis.array[0] = val;\r\n  }\r\n  \r\n  get m12() {\r\n\t\treturn this.array[3];\r\n\t}\r\n\r\n\tset m12(val: number) {\r\n\t\tthis.array[3] = val;\r\n  }\r\n  \r\n  get m13() {\r\n\t\treturn this.array[6];\r\n\t}\r\n\r\n\tset m13(val: number) {\r\n\t\tthis.array[6] = val;\r\n  }\r\n  \r\n  get m21() {\r\n\t\treturn this.array[1];\r\n\t}\r\n\r\n\tset m21(val: number) {\r\n\t\tthis.array[1] = val;\r\n  }\r\n  \r\n  get m22() {\r\n\t\treturn this.array[4];\r\n\t}\r\n\r\n\tset m22(val: number) {\r\n\t\tthis.array[4] = val;\r\n  }\r\n  \r\n  get m23() {\r\n\t\treturn this.array[7];\r\n\t}\r\n\r\n\tset m23(val: number) {\r\n\t\tthis.array[7] = val;\r\n  }\r\n  \r\n  get m31() {\r\n\t\treturn this.array[2];\r\n\t}\r\n\r\n  set m31(val: number) {\r\n\t\tthis.array[2] = val;\r\n  }\r\n  \r\n  get m32() {\r\n\t\treturn this.array[5];\r\n\t}\r\n\r\n\tset m32(val: number) {\r\n\t\tthis.array[5] = val;\r\n  }\r\n  \r\n  get m33() {\r\n\t\treturn this.array[8];\r\n\t}\r\n\r\n  set m33(val: number) {\r\n\t\tthis.array[8] = val;\r\n  }\r\n\r\n  private checkArray(array: ArrayLike<number>): void {\r\n\t\tif (array.length < 9) {\r\n\t\t\tthrow new MathError(`Array must be of length 9 at least.`);\r\n\t\t}\r\n\t}\r\n\r\n  getValues(): Matrix3Values {\r\n\t\treturn [\r\n      this.array[0], this.array[1], this.array[2],\r\n      this.array[3], this.array[4], this.array[5],\r\n      this.array[6], this.array[7], this.array[8],\r\n    ];\r\n\t}\r\n\r\n\tsetValues(\r\n    m11: number, m21: number, m31: number,\r\n    m12: number, m22: number, m32: number,\r\n    m13: number, m23: number, m33: number\r\n  ): this {\r\n    this.array[0] = m11;\r\n    this.array[1] = m21;\r\n    this.array[2] = m31;\r\n    this.array[3] = m12;\r\n    this.array[4] = m22;\r\n    this.array[5] = m32;\r\n    this.array[6] = m13;\r\n    this.array[7] = m23;\r\n    this.array[8] = m33;\r\n\r\n    return this;\r\n  }\r\n\r\n\tequals(other: Matrix3): boolean {\r\n    const o = other.array;\r\n    return this.array[0] === o[0]\r\n      && this.array[1] === o[1]\r\n      && this.array[2] === o[2]\r\n      && this.array[3] === o[3]\r\n      && this.array[4] === o[4]\r\n      && this.array[5] === o[5]\r\n      && this.array[6] === o[6]\r\n      && this.array[7] === o[7]\r\n      && this.array[8] === o[8];\r\n  }\r\n\r\n  copy(mat: Matrix3): this {\r\n    const o = this.array;\r\n    const m = mat.array;\r\n\r\n    o[0] = m[0];\r\n    o[1] = m[1];\r\n    o[2] = m[2];\r\n    o[3] = m[3];\r\n    o[4] = m[4];\r\n    o[5] = m[5];\r\n    o[6] = m[6];\r\n    o[7] = m[7];\r\n    o[8] = m[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  clone(): this {\r\n    return new Matrix3Base(\r\n      this.array[0], this.array[1], this.array[2],\r\n      this.array[3], this.array[4], this.array[5],\r\n      this.array[6], this.array[7], this.array[8]\r\n    ) as this;\r\n  }\r\n\r\n  setIdentity(): this {\r\n    const o = this.array;\r\n\r\n    o[0] = 1;\r\n    o[1] = 0;\r\n    o[2] = 0;\r\n    o[3] = 0;\r\n    o[4] = 1;\r\n    o[5] = 0;\r\n    o[6] = 0;\r\n    o[7] = 0;\r\n    o[8] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  setZeros(): this {\r\n    const o = this.array;\r\n\r\n    o[0] = 0;\r\n    o[1] = 0;\r\n    o[2] = 0;\r\n    o[3] = 0;\r\n    o[4] = 0;\r\n    o[5] = 0;\r\n    o[6] = 0;\r\n    o[7] = 0;\r\n    o[8] = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  det(): number {\r\n    const o = this.array;\r\n\r\n    const x = o[0] * ((o[4] * o[8]) - (o[5] * o[7]));\r\n    const y = o[1] * ((o[3] * o[8]) - (o[5] * o[6]));\r\n    const z = o[2] * ((o[3] * o[7]) - (o[4] * o[6]));\r\n\r\n    return x - y + z;\r\n  }\r\n\r\n  trace(): number {\r\n    const o = this.array;\r\n    \r\n    return o[0] + o[4] + o[8];\r\n  }\r\n\r\n  negate(): this {\r\n    const o = this.array;\r\n\r\n    o[0] = -o[0];\r\n    o[1] = -o[1];\r\n    o[2] = -o[2];\r\n    o[3] = -o[3];\r\n    o[4] = -o[4];\r\n    o[5] = -o[5];\r\n    o[6] = -o[6];\r\n    o[7] = -o[7];\r\n    o[8] = -o[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  transpose(): this {\r\n    const o = this.array;\r\n\r\n    let t;\r\n\r\n    t = o[1];\r\n    o[1] = o[3];\r\n    o[3] = t;\r\n\r\n    t = o[2];\r\n    o[2] = o[6];\r\n    o[6] = t;\r\n\r\n    t = o[5];\r\n    o[5] = o[7];\r\n    o[7] = t;\r\n    \r\n    return this;\r\n  }\r\n\r\n  invert(): this {\r\n    const o = this.array;\r\n\r\n    const t11 = o[1 * 3 + 1] * o[2 * 3 + 2] - o[1 * 3 + 2] * o[2 * 3 + 1];\r\n    const t12 = o[0 * 3 + 1] * o[2 * 3 + 2] - o[0 * 3 + 2] * o[2 * 3 + 1];\r\n    const t13 = o[0 * 3 + 1] * o[1 * 3 + 2] - o[0 * 3 + 2] * o[1 * 3 + 1];\r\n\r\n    const t21 = o[1 * 3 + 0] * o[2 * 3 + 2] - o[1 * 3 + 2] * o[2 * 3 + 0];\r\n    const t22 = o[0 * 3 + 0] * o[2 * 3 + 2] - o[0 * 3 + 2] * o[2 * 3 + 0];\r\n    const t23 = o[0 * 3 + 0] * o[1 * 3 + 2] - o[0 * 3 + 2] * o[1 * 3 + 0];\r\n\r\n    const t31 = o[1 * 3 + 0] * o[2 * 3 + 1] - o[1 * 3 + 1] * o[2 * 3 + 0];\r\n    const t32 = o[0 * 3 + 0] * o[2 * 3 + 1] - o[0 * 3 + 1] * o[2 * 3 + 0];\r\n    const t33 = o[0 * 3 + 0] * o[1 * 3 + 1] - o[0 * 3 + 1] * o[1 * 3 + 0];\r\n\r\n    const d = 1.0 / (o[0 * 3 + 0] * t11 - o[1 * 3 + 0] * t12 + o[2 * 3 + 0] * t13);\r\n\r\n    if (d == 0) {\r\n      throw new MathError(`Matrix is not invertible.`);\r\n    }\r\n\r\n    o[0] = d * t11;\r\n    o[1] = -d * t12;\r\n    o[2] = d * t13;\r\n\r\n    o[3] = -d * t21;\r\n    o[4] = d * t22;\r\n    o[5] = -d * t23;\r\n\r\n    o[6] = d * t31;\r\n    o[7] = -d * t32;\r\n    o[8] = d * t33;\r\n\r\n    return this;\r\n  }\r\n\r\n  add(mat: Matrix3): this {\r\n    const o = this.array;\r\n    const m = mat.array;\r\n\r\n    o[0] = o[0] + m[0];\r\n    o[1] = o[1] + m[1];\r\n    o[2] = o[2] + m[2];\r\n    o[3] = o[3] + m[3];\r\n    o[4] = o[4] + m[4];\r\n    o[5] = o[5] + m[5];\r\n    o[6] = o[6] + m[6];\r\n    o[7] = o[7] + m[7];\r\n    o[8] = o[8] + m[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  sub(mat: Matrix3Base): this {\r\n    const o = this.array;\r\n    const m = mat.array;\r\n\r\n    o[0] = o[0] - m[0];\r\n    o[1] = o[1] - m[1];\r\n    o[2] = o[2] - m[2];\r\n    o[3] = o[3] - m[3];\r\n    o[4] = o[4] - m[4];\r\n    o[5] = o[5] - m[5];\r\n    o[6] = o[6] - m[6];\r\n    o[7] = o[7] - m[7];\r\n    o[8] = o[8] - m[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  mult(mat: Matrix3): this {\r\n    const o = this.array;\r\n    const m = mat.array;\r\n\r\n    const a11 = o[0 * 3 + 0];\r\n    const a12 = o[0 * 3 + 1];\r\n    const a13 = o[0 * 3 + 2];\r\n    const a21 = o[1 * 3 + 0];\r\n    const a22 = o[1 * 3 + 1];\r\n    const a23 = o[1 * 3 + 2];\r\n    const a31 = o[2 * 3 + 0];\r\n    const a32 = o[2 * 3 + 1];\r\n    const a33 = o[2 * 3 + 2];\r\n    const b11 = m[0 * 3 + 0];\r\n    const b12 = m[0 * 3 + 1];\r\n    const b13 = m[0 * 3 + 2];\r\n    const b21 = m[1 * 3 + 0];\r\n    const b22 = m[1 * 3 + 1];\r\n    const b23 = m[1 * 3 + 2];\r\n    const b31 = m[2 * 3 + 0];\r\n    const b32 = m[2 * 3 + 1];\r\n    const b33 = m[2 * 3 + 2];\r\n\r\n    o[0] = b11 * a11 + b12 * a21 + b13 * a31;\r\n    o[1] = b11 * a12 + b12 * a22 + b13 * a32;\r\n    o[2] = b11 * a13 + b12 * a23 + b13 * a33;\r\n    o[3] = b21 * a11 + b22 * a21 + b23 * a31;\r\n    o[4] = b21 * a12 + b22 * a22 + b23 * a32;\r\n    o[5] = b21 * a13 + b22 * a23 + b23 * a33;\r\n    o[6] = b31 * a11 + b32 * a21 + b33 * a31;\r\n    o[7] = b31 * a12 + b32 * a22 + b33 * a32;\r\n    o[8] = b31 * a13 + b32 * a23 + b33 * a33;\r\n\r\n    return this;\r\n  }\r\n\r\n  multScalar(k: number): this {\r\n    const o = this.array;\r\n\r\n    o[0] = o[0] * k;\r\n    o[1] = o[1] * k;\r\n    o[2] = o[2] * k;\r\n    o[3] = o[3] * k;\r\n    o[4] = o[4] * k;\r\n    o[5] = o[5] * k;\r\n    o[6] = o[6] * k;\r\n    o[7] = o[7] * k;\r\n    o[8] = o[8] * k;\r\n\r\n    return this;\r\n  }\r\n\r\n  writeIntoArray(out: WritableArrayLike<number>, offset: number = 0): void {\r\n\t\tconst m = this.array;\r\n\r\n\t\tout[offset     ] = m[ 0];\r\n\t\tout[offset +  1] = m[ 1];\r\n    out[offset +  2] = m[ 2];\r\n    out[offset +  3] = m[ 3];\r\n\t\tout[offset +  4] = m[ 4];\r\n    out[offset +  5] = m[ 5];\r\n    out[offset +  6] = m[ 6];\r\n\t\tout[offset +  7] = m[ 7];\r\n    out[offset +  8] = m[ 8];\r\n  }\r\n    \r\n  readFromArray(arr: ArrayLike<number>, offset: number = 0): void {\r\n\t\tconst o = this.array;\r\n\r\n\t\to[ 0] = arr[offset     ];\r\n\t\to[ 1] = arr[offset +  1];\r\n    o[ 2] = arr[offset +  2];\r\n    o[ 3] = arr[offset +  3];\r\n    o[ 4] = arr[offset +  4];\r\n    o[ 5] = arr[offset +  5];\r\n    o[ 6] = arr[offset +  6];\r\n\t\to[ 7] = arr[offset +  7];\r\n    o[ 8] = arr[offset +  8];\r\n  }\r\n\r\n  static rotationX(angle: number): Matrix3Base {\r\n    return new Matrix3Base().setRotationX(angle);\r\n  }\r\n\r\n  setRotationX(angle: number): this {\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    this.array[0] = 1;\r\n    this.array[1] = 0;\r\n    this.array[2] = 0;\r\n    this.array[3] = 0;\r\n    this.array[4] = cosAngle;\r\n    this.array[5] = sinAngle;\r\n    this.array[6] = 0;\r\n    this.array[7] = -sinAngle;\r\n    this.array[8] = cosAngle;\r\n\r\n    return this;\r\n  }\r\n  \r\n  static rotationY(angle: number): Matrix3Base {\r\n    return new Matrix3Base().setRotationY(angle);\r\n  }\r\n\r\n  setRotationY(angle: number): this {\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n    \r\n    this.array[0] = cosAngle;\r\n    this.array[1] = 0;\r\n    this.array[2] = -sinAngle;\r\n    this.array[3] = 0;\r\n    this.array[4] = 1;\r\n    this.array[5] = 0;\r\n    this.array[6] = sinAngle;\r\n    this.array[7] = 0;\r\n    this.array[8] = cosAngle;\r\n    \r\n    return this;\r\n  }\r\n\r\n  static rotationZ(angle: number): Matrix3Base {\r\n    return new Matrix3Base().setRotationZ(angle);\r\n  }\r\n\r\n  setRotationZ(angle: number): this {\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    this.array[0] = cosAngle;\r\n    this.array[1] = sinAngle;\r\n    this.array[2] = 0;\r\n    this.array[3] = -sinAngle;\r\n    this.array[4] = cosAngle;\r\n    this.array[5] = 0;\r\n    this.array[6] = 0;\r\n    this.array[7] = 0;\r\n    this.array[8] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  solve(b: Vector3): Vector3Values {\r\n    const a  = this.array;\r\n\r\n    const A0x = a[0];\r\n    const A0y = a[3];\r\n    const A0z = a[6];\r\n    const A1x = a[1];\r\n    const A1y = a[4];\r\n    const A1z = a[7];\r\n    const A2x = a[2];\r\n    const A2y = a[5];\r\n    const A2z = a[8];\r\n    let rx, ry, rz;\r\n    let det;\r\n\r\n    // Column1 cross Column 2\r\n    rx = A1y * A2z - A1z * A2y;\r\n    ry = A1z * A2x - A1x * A2z;\r\n    rz = A1x * A2y - A1y * A2x;\r\n\r\n    // A.getColumn(0).dot(x)\r\n    det = A0x * rx + A0y * ry + A0z * rz;\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    // b dot [Column1 cross Column 2]\r\n    const x_ = det * (b.x * rx + b.y * ry + b.z * rz);\r\n\r\n    // Column2 cross b\r\n    rx = -(A2y * b.z - A2z * b.y);\r\n    ry = -(A2z * b.x - A2x * b.z);\r\n    rz = -(A2x * b.y - A2y * b.x);\r\n    // Column0 dot -[Column2 cross b (Column3)]\r\n    const y_ = det * (A0x * rx + A0y * ry + A0z * rz);\r\n\r\n    // b cross Column 1\r\n    rx = -(b.y * A1z - b.z * A1y);\r\n    ry = -(b.z * A1x - b.x * A1z);\r\n    rz = -(b.x * A1y - b.y * A1x);\r\n    // Column0 dot -[b cross Column 1]\r\n    const z_ = det * (A0x * rx + A0y * ry + A0z * rz);\r\n    return [x_, y_, z_];\r\n    /*const a = this.array;\r\n    \r\n    const a11 = a[0];\r\n    const a12 = a[1];\r\n    const a13 = a[2];\r\n    const a21 = a[3];\r\n    const a22 = a[4];\r\n    const a23 = a[5];\r\n    const a31 = a[6];\r\n    const a32 = a[7];\r\n    const a33 = a[8];\r\n    const bx = vecB.x;\r\n    const by = vecB.y;\r\n    const bz = vecB.z;\r\n\r\n    let rx = a22 * a33 - a23 * a32;\r\n    let ry = a23 * a31 - a21 * a33;\r\n    let rz = a21 * a32 - a22 * a31;\r\n  \r\n    let det = a11 * rx + a12 * ry + a13 * rz;\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    const x = det * (bx * rx + by * ry + bz * rz);\r\n\r\n    rx = -(a32 * bz - a33 * by);\r\n    ry = -(a33 * bx - a31 * bz);\r\n    rz = -(a31 * by - a32 * bx);\r\n    \r\n    const y = det * (a11 * rx + a12 * ry + a13 * rz);\r\n    \r\n    rx = -(by * a23 - bz * a22);\r\n    ry = -(bz * a21 - bx * a23);\r\n    rz = -(bx * a22 - by * a21);\r\n    \r\n    const z = det * (a11 * rx + a12 * ry + a13 * rz);\r\n    \r\n    return [\r\n      x, y, z\r\n    ];*/\r\n  }\r\n\r\n  solve2(vecB: Vector2): Vector2Values {\r\n    const a = this.array;\r\n\r\n    const a11 = a[0];\r\n    const a12 = a[1];\r\n    const a21 = a[3];\r\n    const a22 = a[4];\r\n    const bx = vecB.x - a[4];\r\n    const by = vecB.y - a[7];\r\n    \r\n    let det = a11 * a22 - a12 * a21;\r\n\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    const x = det * (a22 * bx - a12 * by)\r\n    const y = det * (a11 * by - a21 * bx);\r\n\r\n    return [\r\n      x, y\r\n    ];\r\n  }\r\n}\r\n\r\nvar Matrix3: Matrix3Constructor = Matrix3Base;\r\nconst Matrix3Injector: Injector<Matrix3Constructor> = new Injector({\r\n\tdefaultCtor: Matrix3Base,\r\n\tonDefaultOverride:\r\n\t\t(ctor: Matrix3Constructor) => {\r\n\t\t\tMatrix3 = ctor;\r\n\t\t}\r\n});","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { StackPool } from \"../../../patterns/pools/StackPool\";\r\nimport { Space } from \"../../geometry/space/Space\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { qSqrt } from \"../../Snippets\";\r\nimport { Matrix3 } from \"../matrices/Matrix3\";\r\nimport { Matrix4 } from \"../matrices/Matrix4\";\r\nimport { Vector3 } from \"../vectors/Vector3\";\r\n\r\nexport { QuaternionValues };\r\nexport { Quaternion };\r\nexport { QuaternionInjector };\r\nexport { QuaternionPool };\r\n\r\ntype QuaternionValues = [number, ...number[]] & { length: 4 };\r\n\r\ninterface QuaternionConstructor {\r\n\treadonly prototype: Quaternion;\r\n\tnew(): Quaternion;\r\n\tnew(x: number, y: number, z: number, w: number): Quaternion;\r\n\tnew(array: WritableArrayLike<number>): Quaternion;\r\n\tslerp(from: Quaternion, to: Quaternion, t: number): Quaternion\r\n\tslerp(from: Quaternion, to: Quaternion, t: number, out: Quaternion): Quaternion\r\n\tfromArray(vector: ArrayLike<number>): Quaternion;\r\n\tfromAxisAngle(axis: Vector3, angle?: number): Quaternion;\r\n\tfromEuler(pitch: number, yaw: number, roll: number): Quaternion;\r\n\tfromVector(vector: Vector3): Quaternion;\r\n\tfromMatrix(matrix: Matrix3): Quaternion;\r\n}\r\n// TODO?:\r\n// roll => pitch\r\n// pitch => yaw\r\n// yaw => roll\r\ninterface Quaternion {\r\n\treadonly array: WritableArrayLike<number>;\r\n\tx: number;\r\n\ty: number;\r\n\tz: number;\r\n\tw: number;\r\n\tpitch: number;\r\n\tyaw: number;\r\n\troll: number;\r\n\tgetValues(): QuaternionValues;\r\n\tsetValues(\r\n\t  x: number, y: number,\r\n\t  z: number, w: number\r\n\t): this;\r\n\t//setArray(array: WritableArrayLike<number>): this;\r\n\tlookAt(source: Vector3, dest: Vector3): Quaternion ;\r\n\tsetEuler(pitch: number, yaw: number, roll: number): this;\r\n\r\n\tsetMatrix(matrix: Matrix3): Quaternion;\r\n\tsetMatrix(matrix: Matrix4): Quaternion;\r\n\r\n\tsetAxisAngle(axis: Vector3, angle: number): this;\r\n\tsetVectors(from: Vector3, to: Vector3): this;\r\n\t\r\n\tcopy(quat: Quaternion): this;\r\n\tclone(): this;\r\n\tgetAxis(out: Vector3): Vector3;\r\n\r\n\tgetMatrix3(matrix: Matrix3): Matrix3;\r\n\tgetMatrix4(matrix: Matrix4): Matrix4;\r\n\r\n\trotate(vec: Vector3): Vector3;\r\n\ttoVector(): Vector3;\r\n\r\n\tangleTo(quat: Quaternion): number;\r\n\trotateTowards(quat: Quaternion): this;\r\n\tinvert(): this;\r\n\tconjugate(): this;\r\n\tdot(quat: Quaternion): number;\r\n\tlengthSquared(): number;\r\n\tlength(): number;\r\n\tnormalize(): this;\r\n\tadd(quat: Quaternion): this;\r\n\tsub(quat: Quaternion): this;\r\n\tmult(quat: Quaternion): this;\r\n\tscale(scalar: number): this;\r\n\tslerp(from: Quaternion, to: Quaternion, t: number): this;\r\n\tequals(quat: Quaternion): boolean;\r\n\tcopyIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n    readFromArray(arr: ArrayLike<number>, offset?: number): void;\r\n}\r\n\r\nclass QuaternionBase {\r\n\tprivate _array: WritableArrayLike<number>;\r\n\r\n\tget array(): WritableArrayLike<number> {\r\n\t\treturn this._array;\r\n\t}\r\n\r\n\tconstructor()\r\n\tconstructor(array: WritableArrayLike<number>)\r\n\tconstructor(x: number, y: number, z: number, w: number)\r\n\tconstructor(...args: any[]) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis._array = [\r\n\t\t\t\targs[0], args[1], args[2], args[3]\r\n\t\t\t];\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n\t\t\tthis._checkArray(args[0]);\r\n\t\t\tthis._array = args[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._array = [0, 0, 0, 0];\r\n\t\t}\r\n\t}\r\n\r\n\tget x(): number {\r\n        return this._array[0];\r\n    }\r\n\r\n    set x(x: number) {\r\n\t\tthis._array[0] = x;\r\n    }\r\n\r\n    get y(): number {\r\n        return this._array[1];\r\n    }\r\n\r\n    set y(y: number) {\r\n\t\tthis._array[1] = y;\r\n    }\r\n\r\n    set z(z: number) {\r\n\t\tthis._array[2] = z;\r\n\t}\r\n\t\r\n    get z(): number {\r\n\t\treturn this._array[2];\r\n    }\r\n\r\n    set w(w: number) {\r\n\t\tthis._array[3] = w;\r\n\t}\r\n\r\n    get w(): number {\r\n\t\treturn this._array[3];\r\n\t}\r\n\t\r\n\tget pitch(): number {\r\n\t\tconst array = this.array;\r\n\t\tconst x = array[0];\r\n\t\tconst y = array[1];\r\n\t\tconst z = array[2];\r\n\t\tconst w = array[3];\r\n\t\tconst sinPitch = 2 * (w * y - z * x);\r\n\t\tif (Math.abs(sinPitch) >= 1) {\r\n            return Math.sign(sinPitch) * (Math.PI / 2);\r\n        }\r\n\t\telse {\r\n            return Math.asin(sinPitch);\r\n        }\r\n\t}\r\n\r\n\tget yaw(): number {\r\n\t\tconst array = this.array;\r\n\t\tconst x = array[0];\r\n\t\tconst y = array[1];\r\n\t\tconst z = array[2];\r\n\t\tconst w = array[3];\r\n\t\tconst sinYawCosPitch = 2 * (w * z + x * y);\r\n\t\tconst cosYawCosPitch = 1 - 2 * (y * y + z * z);\r\n\t\treturn Math.atan2(sinYawCosPitch, cosYawCosPitch);\r\n\t}\r\n\r\n\tget roll(): number {\r\n\t\tconst array = this.array;\r\n\t\tconst x = array[0];\r\n\t\tconst y = array[1];\r\n\t\tconst z = array[2];\r\n\t\tconst w = array[3];\r\n\t\tconst sinRollCosPitch = 2 * (w * x + y * z);\r\n\t\tconst cosRollCosPitch = 1 - 2 * (x * x + y * y);\r\n\t\treturn Math.atan2(sinRollCosPitch, cosRollCosPitch);\r\n\t}\r\n\r\n\tgetValues(): QuaternionValues {\r\n\t\treturn [\r\n\t\t\tthis._array[0],\r\n\t\t\tthis._array[1],\r\n\t\t\tthis._array[2],\r\n\t\t\tthis._array[3]\r\n\t\t];\r\n\t}\r\n\r\n\tsetValues(x: number, y: number, z: number, w: number): this {\r\n\t\tthis._array[0] = x;\r\n\t\tthis._array[1] = y;\r\n\t\tthis._array[2] = z;\r\n\t\tthis._array[3] = w;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprivate _checkArray(array: WritableArrayLike<number>): void {\r\n\t\tif (array.length < 4) {\r\n\t\t\tthrow new MathError(`Array must be of length 4 at least.`);\r\n\t\t}\r\n\t}\r\n\r\n\t/*setArray(array: WritableArrayLike<number>): this {\r\n\t\tthis._checkArray(array);\r\n\t\tthis._array = array;\r\n\t\treturn this;\r\n\t}*/\r\n\r\n\tstatic fromArray(array: WritableArrayLike<number>): QuaternionBase {\r\n\t\treturn new QuaternionBase(array);\r\n\t}\r\n\r\n\tstatic fromAxisAngle(axis: Vector3, angle: number): QuaternionBase {\r\n\t\treturn new QuaternionBase().setAxisAngle(axis, angle);\r\n\t}\r\n\r\n\tstatic fromVector(vector: Vector3): QuaternionBase {\r\n\t\treturn new QuaternionBase(vector.x, vector.y, vector.z, 1);\r\n\t}\r\n\t\r\n\tstatic fromEuler(yaw: number, pitch: number, roll: number): QuaternionBase {\r\n\t\treturn new QuaternionBase().setEuler(yaw, pitch, roll);\r\n\t}\r\n\r\n\tcopy(quat: Quaternion): this {\r\n\t\tconst o = this._array;\r\n\t\tconst q = quat.array;\r\n\r\n\t\to[0] = q[0];\r\n\t\to[1] = q[1];\r\n\t\to[2] = q[2];\r\n\t\to[3] = q[3];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone(): this {\r\n\t\treturn new QuaternionBase(this.x, this.y, this.z, this.w) as this;\r\n\t}\r\n\r\n\tequals(quat: Quaternion): boolean {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\r\n\t\treturn (thisArray[0] === quatArray[0])\r\n\t\t\t&& (thisArray[1] === quatArray[1])\r\n\t\t\t&& (thisArray[2] === quatArray[2])\r\n\t\t\t&& (thisArray[3] === quatArray[3]);\r\n\t}\r\n\r\n\tgetAxis(out: Vector3): Vector3 {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst outArray = out.array;\r\n\r\n\t\tconst den = 1 - (thisArray[3] * thisArray[3]);\r\n\r\n\t\tif (den < Number.EPSILON) {\r\n\t\t  return out.setZeros();\r\n\t\t}\r\n\t  \r\n\t\tconst scale = qSqrt(den);\r\n\t\t\r\n\t\toutArray[0] = thisArray[0] * scale;\r\n\t\toutArray[1] = thisArray[1] * scale;\r\n\t\toutArray[2] = thisArray[2] * scale;\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\tgetMatrix3(matrix: Matrix3): Matrix3 {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst thisLengthSquared = this.lengthSquared();\r\n\t\tconst s = 2.0 / thisLengthSquared;\r\n\r\n\t\tconst x = thisArray[0];\r\n\t\tconst y = thisArray[1];\r\n\t\tconst z = thisArray[2];\r\n\t\tconst w = thisArray[3];\r\n\r\n\t\tconst xs = x * s;\r\n\t\tconst ys = y * s;\r\n\t\tconst zs = z * s;\r\n\t  \r\n\t\tconst wx = w * xs;\r\n\t\tconst wy = w * ys;\r\n\t\tconst wz = w * zs;\r\n\t  \r\n\t\tconst xx = x * xs;\r\n\t\tconst xy = x * ys;\r\n\t\tconst xz = x * zs;\r\n\t\t\r\n\t\tconst yy = y * ys;\r\n\t\tconst yz = y * zs;\r\n\t\tconst zz = z * zs;\r\n\r\n\t\treturn matrix.setValues(\r\n\t\t\t1 - (yy + zz),\txy + wz,\t\txz - wy,\r\n\t\t\txy - wz,\t\t1 - (xx + zz),\tyz + wx,\r\n\t\t\txz + wy,\t\tyz - wx,\t\t1 - (xx + yy)\r\n\t\t);\r\n\t}\r\n\r\n\tgetMatrix4(matrix: Matrix4): Matrix4 {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst thisLengthSquared = this.lengthSquared();\r\n\t\tconst s = 2.0 / thisLengthSquared;\r\n\r\n\t\tconst x = thisArray[0];\r\n\t\tconst y = thisArray[1];\r\n\t\tconst z = thisArray[2];\r\n\t\tconst w = thisArray[3];\r\n\r\n\t\tconst xs = x * s;\r\n\t\tconst ys = y * s;\r\n\t\tconst zs = z * s;\r\n\t  \r\n\t\tconst wx = w * xs;\r\n\t\tconst wy = w * ys;\r\n\t\tconst wz = w * zs;\r\n\t  \r\n\t\tconst xx = x * xs;\r\n\t\tconst xy = x * ys;\r\n\t\tconst xz = x * zs;\r\n\t\t\r\n\t\tconst yy = y * ys;\r\n\t\tconst yz = y * zs;\r\n\t\tconst zz = z * zs;\r\n\r\n\t\treturn matrix.setValues(\r\n\t\t\t1 - (yy + zz),\txy + wz,\t\txz - wy, \t\t0,\r\n\t\t\txy - wz,\t\t1 - (xx + zz),\tyz + wx, \t\t0,\r\n\t\t\txz + wy,\t\tyz - wx,\t\t1 - (xx + yy), \t0,\r\n\t\t\t0, \t\t\t\t0, \t\t\t\t0, \t\t\t\t1\r\n\t\t);\r\n\t}\r\n\r\n\trotate(vector: Vector3): Vector3 {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst vectorArray = vector.array;\r\n\r\n\t\tconst vx = vectorArray[0];\r\n\t\tconst vy = vectorArray[1];\r\n\t\tconst vz = vectorArray[2];\t\t\r\n\t\t\r\n\t\tconst qx = thisArray[0];\r\n\t\tconst qy = thisArray[1];\r\n\t\tconst qz = thisArray[2];\r\n\t\tconst qw = thisArray[3];\r\n\r\n\t\tconst tx = qw * vx + -qx * 0 + -qy * vz + qz * vy;\r\n\t\tconst ty = qw * vy + -qy * 0 + -qz * vx + qx * vz;\r\n\t\tconst tz = qw * vz + -qz * 0 + -qx * vy + qy * vx;\r\n\t\tconst tw = qx * vx + qw * 0 + qy * vy + qz * vz;\r\n\r\n\t\tvectorArray[0] = tw * qz + tz * qw + tx * qy - ty * qx;\r\n\t\tvectorArray[1] = tw * qy + ty * qw + tz * qx - tx * qz;\r\n\t\tvectorArray[2] = tw * qx + tx * qw + ty * qz - tz * qy;\r\n\r\n\t\treturn vector;\r\n\t}\r\n\r\n\ttoVector(): Vector3 {\r\n\t\treturn new Vector3([\r\n\t\t\tthis.x, this.y, this.z\r\n\t\t]);\r\n\t}\r\n\t\r\n\tsetEuler(pitch: number, yaw: number, roll: number): this {\r\n\t\tconst cosYaw = Math.cos(yaw * 0.5);\r\n\t\tconst sinYaw = Math.sin(yaw * 0.5);\r\n\t\tconst cosPitch = Math.cos(pitch * 0.5);\r\n\t\tconst sinPitch = Math.sin(pitch * 0.5);\r\n\t\tconst cosRoll = Math.cos(roll * 0.5);\r\n\t\tconst sinRoll = Math.sin(roll * 0.5);\r\n\t\tconst thisArray = this.array;\r\n\r\n        thisArray[0] = sinRoll * cosPitch * cosYaw - cosRoll * sinPitch * sinYaw;\r\n        thisArray[1] = cosRoll * sinPitch * cosYaw + sinRoll * cosPitch * sinYaw;\r\n        thisArray[2] = cosRoll * cosPitch * sinYaw - sinRoll * sinPitch * cosYaw;\r\n\t\tthisArray[3] = cosRoll * cosPitch * cosYaw + sinRoll * sinPitch * sinYaw;\r\n        \r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetAxisAngle(axis: Vector3, angle: number = 0): this {\r\n\t\tconst axisLength = axis.length();\r\n\t\tif (axisLength === 0) {\r\n\t\t  return this;\r\n\t\t}\r\n\t\tconst halfSin = Math.sin(angle * 0.5) / axisLength;\r\n\t\tconst axisArray = axis.array;\r\n\t\tconst thisArray = this.array;\r\n\t\tthisArray[0] = axisArray[0] * halfSin;\r\n\t\tthisArray[1] = axisArray[1] * halfSin;\r\n\t\tthisArray[2] = axisArray[2] * halfSin;\r\n\t\tthisArray[3] = Math.cos(angle * 0.5);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetMatrix(matrix: Matrix3): this\r\n\tsetMatrix(matrix: Matrix4): this\r\n\tsetMatrix(matrix: Matrix3 | Matrix4): this {\r\n\t\tconst matrixArray = matrix.array;\r\n\t\tlet m11 = 0, m12 = 0, m13 = 0,\r\n\t\t\tm21 = 0, m22 = 0, m23 = 0,\r\n\t\t\tm31 = 0, m32 = 0, m33 = 0;\r\n\r\n\t\tif (matrix instanceof Matrix3) {\r\n\t\t\tm11 = matrixArray[0], m12 = matrixArray[3], m13 = matrixArray[6],\r\n\t\t\tm21 = matrixArray[1], m22 = matrixArray[4], m23 = matrixArray[7],\r\n\t\t\tm31 = matrixArray[2], m32 = matrixArray[5], m33 = matrixArray[8];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tm11 = matrixArray[0], m12 = matrixArray[4], m13 = matrixArray[ 8],\r\n\t\t\tm21 = matrixArray[1], m22 = matrixArray[5], m23 = matrixArray[ 9],\r\n\t\t\tm31 = matrixArray[2], m32 = matrixArray[6], m33 = matrixArray[10];\r\n\t\t}\r\n\r\n\t\tconst trace = m11 + m22 + m33;\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tif (trace > 0) {\r\n\t\t\tconst s = Math.sqrt(trace + 1) * 2;\r\n\t\t\tthisArray[3] = 0.25 * s;\r\n\t\t\tthisArray[0] = (m32 - m23) / s;\r\n\t\t\tthisArray[1] = (m13 - m31) / s;\r\n\t\t\tthisArray[2] = (m21 - m12) / s;\r\n\t\t}\r\n\t\telse if (m11 > m22 && m11 > m33) {\r\n\t\t\tconst s = 2 * Math.sqrt(1 + m11 - m22 - m33);\r\n\t\t\tthisArray[3] = (m32 - m23) / s;\r\n\t\t\tthisArray[0] = 0.25 * s;\r\n\t\t\tthisArray[1] = (m12 + m21) / s;\r\n\t\t\tthisArray[2] = (m13 + m31) / s;\r\n\t\t}\r\n\t\telse if (m22 > m33) {\r\n\t\t\tconst s = 2 * Math.sqrt(1 + m22 - m11 - m33);\r\n\t\t\tthisArray[3] = (m13 - m31) / s;\r\n\t\t\tthisArray[0] = (m12 + m21) / s;\r\n\t\t\tthisArray[1] = 0.25 * s;\r\n\t\t\tthisArray[2] = (m23 + m32) / s;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst s = 2 * Math.sqrt(1 + m33 - m11 - m22);\r\n\t\t\tthisArray[3] = (m21 - m12) / s;\r\n\t\t\tthisArray[0] = (m13 + m31) / s;\r\n\t\t\tthisArray[1] = (m23 + m32) / s;\r\n\t\t\tthisArray[2] = 0.25 * s;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tlookAt(source: Vector3, dest: Vector3): Quaternion {\r\n\t\tconst forward = dest.clone().sub(source).normalize();\r\n\r\n\t\tconst axis = Space.forward.clone().cross(forward);\r\n\t\tconst dot = Space.forward.dot(forward);\r\n\r\n\t\treturn new Quaternion(axis.x, axis.y, axis.z, dot + 1).normalize();\r\n\t}\r\n\r\n\tstatic fromMatrix(matrix: Matrix3): QuaternionBase {\r\n\t\treturn new QuaternionBase().setMatrix(matrix);\r\n\t}\r\n\r\n\tsetVectors(from: Vector3, to: Vector3): this {\r\n\t\tconst dot = from.dot(to);\r\n\t\tconst cross = from.cross(to);\r\n\t\tconst crossArray = cross.array;\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tthisArray[0] = crossArray[0];\r\n\t\tthisArray[1] = crossArray[1];\r\n\t\tthisArray[2] = crossArray[2];\r\n\r\n\t\tconst fromLength = from.length();\r\n\t\tconst toLength = from.length();\r\n\r\n\t\tthisArray[3] = Math.sqrt(fromLength * fromLength * toLength * toLength) + dot;\r\n\r\n\t\treturn this.normalize();\r\n\t}\r\n\r\n\tdot(quat: Quaternion): number {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\t\treturn thisArray[0] * quatArray[0] + thisArray[1] * quatArray[1] + thisArray[2] * quatArray[2] + thisArray[3] * quatArray[3];\r\n\t}\r\n\r\n\tlengthSquared(): number {\r\n\t\tconst thisArray = this.array;\r\n\t\treturn thisArray[0] ** 2 + thisArray[1] ** 2 + thisArray[2] ** 2 + thisArray[3] ** 2;\r\n\t}\r\n\r\n\tlength(): number {\r\n\t\tconst thisArray = this.array;\r\n\t\treturn Math.hypot(thisArray[0], thisArray[1], thisArray[2], thisArray[3]);\r\n\t}\r\n\r\n\tangleTo(rotation: Quaternion): number {\r\n\t\treturn 2 * Math.acos(Math.abs(Math.max(-1, Math.min(1, this.dot(rotation)))));\r\n\t}\r\n\r\n\trotateTowards(rotation: Quaternion): this {\r\n\t\tconst angle = this.angleTo(rotation);\r\n\r\n\t\tif (angle === 0) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tconst t = Math.min(1, angle);\r\n\t\tthis.slerp(this, rotation, t);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tinvert(): this {\r\n\t\treturn this.conjugate();\r\n\t}\r\n\t\r\n\tconjugate(): this {\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tthisArray[0] *= -1;\r\n\t\tthisArray[1] *= -1;\r\n\t\tthisArray[2] *= -1;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnormalize(): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tlet length = this.length();\r\n\r\n\t\tif (length === 0) {\r\n\t\t\tthisArray[0] = 0;\r\n\t\t\tthisArray[1] = 0;\r\n\t\t\tthisArray[2] = 0;\r\n\t\t\tthisArray[3] = 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlength = 1 / length;\r\n\t\t\tthisArray[0] *= length;\r\n\t\t\tthisArray[1] *= length;\r\n\t\t\tthisArray[2] *= length;\r\n\t\t\tthisArray[3] *= length;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tadd(quat: Quaternion): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\t\tthisArray[0] += quatArray[0];\r\n\t\tthisArray[1] += quatArray[1];\r\n\t\tthisArray[2] += quatArray[2];\r\n\t\tthisArray[3] += quatArray[3];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsub(quat: Quaternion): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\t\tthisArray[0] -= quatArray[0];\r\n\t\tthisArray[1] -= quatArray[1];\r\n\t\tthisArray[2] -= quatArray[2];\r\n\t\tthisArray[3] -= quatArray[3];\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmult(quat: Quaternion): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tconst quatArray = quat.array;\r\n\r\n\t\tconst ax = thisArray[0], ay = thisArray[1], az = thisArray[2], aw = thisArray[3];\r\n\t\tconst bx = quatArray[0], by = quatArray[1], bz = quatArray[2], bw = quatArray[3];\r\n\r\n\t\tthisArray[0] = ax * bw + aw * bx + ay * bz - az * by;\r\n\t\tthisArray[1] = ay * bw + aw * by + az * bx - ax * bz;\r\n\t\tthisArray[2] = az * bw + aw * bz + ax * by - ay * bx;\r\n\t\tthisArray[3] = aw * bw - ax * bx - ay * by - az * bz;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\r\n\tscale(scalar: number): this {\r\n\t\tconst thisArray = this.array;\r\n\t\tthisArray[0] *= scalar;\r\n\t\tthisArray[1] *= scalar;\r\n\t\tthisArray[2] *= scalar;\r\n\t\tthisArray[3] *= scalar;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tstatic slerp(from: Quaternion, to: Quaternion, t: number): Quaternion\r\n\tstatic slerp(from: Quaternion, to: Quaternion, t: number, out: Quaternion): Quaternion\r\n\tstatic slerp(from: Quaternion, to: Quaternion, t: number, out?: Quaternion): Quaternion {\r\n\t\tif (!(out instanceof Quaternion)) {\r\n\t\t\tout = new Quaternion();\r\n\t\t}\r\n\t\tif (t === 0) return out.copy(from);\r\n\t\tif (t === 1) return out.copy(to);\r\n\r\n\t\tconst outArray = out.array;\r\n\t\tconst fromArray = from.array;\r\n\t\tconst toArray = to.array;\r\n\r\n\t\tconst cosHalfTheta = fromArray[3] * toArray[3] + fromArray[0] * toArray[0] + fromArray[1] * toArray[1] + fromArray[2] * toArray[2];\r\n\t\t\r\n\t\tif (Math.abs(cosHalfTheta) >= 1) {\r\n\t\t\toutArray[3] = fromArray[3];\r\n\t\t\toutArray[0] = fromArray[0];\r\n\t\t\toutArray[1] = fromArray[1];\r\n\t\t\toutArray[2] = fromArray[2];\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\tconst halfTheta = Math.acos(cosHalfTheta);\r\n\t\tconst sinHalfTheta = Math.sqrt(1 - cosHalfTheta * cosHalfTheta);\r\n\t\t\r\n\t\tif (Math.abs(sinHalfTheta - Math.trunc(sinHalfTheta)) < Number.EPSILON) {\r\n\t\t\toutArray[3] = (fromArray[3] * 0.5 + toArray[3] * 0.5);\r\n\t\t\toutArray[0] = (fromArray[0] * 0.5 + toArray[0] * 0.5);\r\n\t\t\toutArray[1] = (fromArray[1] * 0.5 + toArray[1] * 0.5);\r\n\t\t\toutArray[2] = (fromArray[2] * 0.5 + toArray[2] * 0.5);\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\tconst ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta;\r\n\t\tconst ratioB = Math.sin(t * halfTheta) / sinHalfTheta; \r\n\t\toutArray[3] = (fromArray[3] * ratioA + toArray[3] * ratioB);\r\n\t\toutArray[0] = (fromArray[0] * ratioA + toArray[0] * ratioB);\r\n\t\toutArray[1] = (fromArray[1] * ratioA + toArray[1] * ratioB);\r\n\t\toutArray[2] = (fromArray[2] * ratioA + toArray[2] * ratioB);\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\t/**\r\n\t * https://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\t */\r\n\tslerp(from: Quaternion, to: Quaternion, t: number): this {\r\n\t\treturn Quaternion.slerp(from, to, t, this) as this;\r\n\t}\r\n\r\n\tcopyIntoArray(array: WritableArrayLike<number>, offset: number = 0): void {\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tarray[offset    ] = thisArray[0];\r\n\t\tarray[offset + 1] = thisArray[1];\r\n\t\tarray[offset + 2] = thisArray[2];\r\n\t\tarray[offset + 3] = thisArray[3];\r\n    }\r\n    \r\n    readFromArray(array: ArrayLike<number>, offset: number = 0): void {\r\n\t\tconst thisArray = this.array;\r\n\r\n\t\tthisArray[0] = array[offset    ];\r\n\t\tthisArray[1] = array[offset + 1];\r\n\t\tthisArray[2] = array[offset + 2];\r\n\t\tthisArray[3] = array[offset + 3];\r\n    }\r\n}\r\n\r\nvar Quaternion: QuaternionConstructor = QuaternionBase;\r\nconst QuaternionPool: StackPool<Quaternion> = new StackPool(QuaternionBase);\r\nconst QuaternionInjector: Injector<QuaternionConstructor> = new Injector({\r\n\tdefaultCtor: QuaternionBase,\r\n\tonDefaultOverride:\r\n\t\t(ctor: QuaternionConstructor) => {\r\n\t\t\tQuaternion = ctor;\r\n\t\t}\r\n});","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { Vector3Pool } from \"../../extensions/pools/Vector3Pools\";\r\nimport { MathError } from \"../../MathError\";\r\nimport { Quaternion } from \"../quaternions/Quaternion\";\r\nimport { Vector2, Vector2Values } from \"../vectors/Vector2\";\r\nimport { Vector3, Vector3Values } from \"../vectors/Vector3\";\r\nimport { Vector4, Vector4Values } from \"../vectors/Vector4\";\r\nimport { Matrix3, Matrix3Values } from \"./Matrix3\";\r\n\r\nexport { Matrix4Values };\r\nexport { Matrix4 };\r\nexport { Matrix4Injector };\r\nexport { Matrix4Base };\r\n\r\ntype Matrix4Values = [\r\n  number, number, number, number,\r\n  number, number, number, number,\r\n  number, number, number, number,\r\n  number, number, number, number\r\n];\r\n\r\ninterface Matrix4Constructor {\r\n\treadonly prototype: Matrix4;\r\n\tnew(): Matrix4;\r\n\tnew(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): Matrix4;\r\n  new(array: ArrayLike<number>): Matrix4;\r\n\r\n  fromValues(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): Matrix4;\r\n  fromArray(array: ArrayLike<number>): Matrix4;\r\n\r\n  invert(A: Matrix4, out: Matrix4): Matrix4;\r\n  transpose(A: Matrix4, out: Matrix4): Matrix4;\r\n  add(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4;\r\n  sub(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4;\r\n  mult(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4;\r\n\r\n  identity(): Matrix4;\r\n  zeros(): Matrix4;\r\n\r\n  translation(vector: Vector3): Matrix4;\r\n  rotationX(angle: number): Matrix4;\r\n  rotationY(angle: number): Matrix4;\r\n  rotationZ(angle: number): Matrix4;\r\n  rotation(matrix: Matrix3): Matrix4;\r\n  scaling(vector: Vector3): Matrix4;\r\n  \r\n  perspective(fieldOfViewYInRadians: number, aspect: number, zNear: number, zFar: number): Matrix4;\r\n  orthographic(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4;\r\n  frustum(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4;\r\n}\r\n\r\n/**\r\n * 4x4 matrix. Values are stored in column major order.\r\n */\r\ninterface Matrix4 {\r\n  readonly array: Float32Array;\r\n  getValues(): Matrix4Values\r\n  setValues(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): this;\r\n  /*row1: Vector4Values;\r\n  row2: Vector4Values;\r\n  row3: Vector4Values;\r\n  row4: Vector4Values;\r\n  col1: Vector4Values;\r\n  col2: Vector4Values;\r\n  col3: Vector4Values;\r\n  col4: Vector4Values;*/\r\n  m11: number;\r\n  m12: number;\r\n  m13: number;\r\n  m14: number;\r\n  m21: number;\r\n  m22: number;\r\n  m23: number;\r\n  m24: number;\r\n  m31: number;\r\n  m32: number;\r\n  m33: number;\r\n  m34: number;\r\n  m41: number;\r\n  m42: number;\r\n  m43: number;\r\n  m44: number;\r\n  //setArray(array: WritableArrayLike<number>): this;\r\n  getRotation(): Quaternion;\r\n  setRotation(rotation: Quaternion): this;\r\n  setTRS(translation: Vector3, rotation: Quaternion, scaling: Vector3): this;\r\n  equals(mat: Matrix4): boolean;\r\n  copy(mat: Matrix4): this;\r\n  clone(): this;\r\n  det(): number;\r\n  trace(): number;\r\n  setIdentity(): this;\r\n  setZeros(): this;\r\n  negate(): this;\r\n  transpose(): this;\r\n  invert(): this;\r\n  add(mat: Matrix4): this;\r\n  sub(mat: Matrix4): this;\r\n  mult(mat: Matrix4): this;\r\n\r\n  getMaxScaleOnAxis(): number;\r\n  solve(vecB: Vector4): Vector4Values;\r\n  solve2(vecB: Vector2): Vector2Values;\r\n  solve3(vecB: Vector3): Vector3Values;\r\n\r\n  writeIntoArray(out: WritableArrayLike<number>, offset?: number): void;\r\n  readFromArray(arr: ArrayLike<number>, offset?: number): this;\r\n\r\n  setTranslation(vector: Vector3): this;\r\n  translate(vector: Vector3): this;\r\n\r\n  setRotationX(angle: number): this;\r\n  rotateX(angle: number): this;\r\n  setRotationY(angle: number): this;\r\n  rotateY(angle: number): this;\r\n  setRotationZ(angle: number): this;\r\n  rotateZ(angle: number): this;\r\n\r\n  rotate(vector: Vector3, angle: number): this\r\n  rotation(matrix: Matrix3): this;\r\n\r\n  setScaling(vector: Vector3): this;\r\n  scale(vector: Vector3): this;\r\n\r\n  lookAt(eye: Vector3 | Vector3Values, target: Vector3, up: Vector3): this;\r\n\r\n  transformPoint(point: Vector3): Vector3;\r\n  transformPoint4(point: Vector4): Vector4;\r\n  transformDirection(direction: Vector3): Vector3;\r\n  transformNormal(normal: Vector3): Vector3;\r\n  \r\n  setFrustum(left: number, right: number, bottom: number, top: number, near: number, far: number): this;\r\n  setPerspective(fieldOfViewYInRadians: number, aspect: number, zNear: number, zFar: number): this;\r\n  setOrthographic(left: number, right: number, bottom: number, top: number, near: number, far: number): this;\r\n}\r\n\r\nclass Matrix4Base implements Matrix4 {\r\n  readonly array: Float32Array;\r\n\r\n\tconstructor()\r\n  constructor(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  )\r\n  constructor(array: ArrayLike<number>)\r\n\tconstructor(\r\n    ...args: any[]\r\n  ) {\r\n\t\tif (typeof args[0] === \"number\") {\r\n\t\t\tthis.array = new Float32Array([\r\n        args[ 0], args[ 1], args[ 2], args[ 3],\r\n        args[ 4], args[ 5], args[ 6], args[ 7],\r\n        args[ 8], args[ 9], args[10], args[11],\r\n        args[12], args[13], args[14], args[15]\r\n      ]);\r\n\t\t}\r\n\t\telse if (typeof args[0] === \"object\") {\r\n      const array = args[0];\r\n      this.checkArray(array);\r\n      if (array instanceof Float32Array) {\r\n        this.array = array;\r\n      }\r\n      else {\r\n        this.array = new Float32Array(array);\r\n      }\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.array = new Float32Array(16);\r\n\t\t}\r\n  }\r\n\r\n  static fromValues(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): Matrix4Base {\r\n    return new Matrix4Base(\r\n      m11, m21, m31, m41,\r\n      m12, m22, m32, m42,\r\n      m13, m23, m33, m43,\r\n      m14, m24, m34, m44\r\n    );\r\n  }\r\n\r\n  static fromArray(array: ArrayLike<number>): Matrix4Base {\r\n    if (array.length < 16) {\r\n      throw new Error(`Matrix4 needs an array of size 16 at least.`);\r\n    }\r\n    return new Matrix4Base(array);\r\n  }\r\n\r\n  getValues(): Matrix4Values {\r\n    const thisArray = this.array;\r\n\t\treturn [\r\n      thisArray[ 0], thisArray[ 1], thisArray[ 2], thisArray[ 3],\r\n      thisArray[ 4], thisArray[ 5], thisArray[ 6], thisArray[ 7],\r\n      thisArray[ 8], thisArray[ 9], thisArray[10], thisArray[11],\r\n      thisArray[12], thisArray[13], thisArray[14], thisArray[15]\r\n    ];\r\n\t}\r\n\r\n\tsetValues(\r\n    m11: number, m21: number, m31: number, m41: number,\r\n    m12: number, m22: number, m32: number, m42: number,\r\n    m13: number, m23: number, m33: number, m43: number,\r\n    m14: number, m24: number, m34: number, m44: number\r\n  ): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = m11;\r\n    thisArray[ 1] = m21;\r\n    thisArray[ 2] = m31;\r\n    thisArray[ 3] = m41;\r\n    thisArray[ 4] = m12;\r\n    thisArray[ 5] = m22;\r\n    thisArray[ 6] = m32;\r\n    thisArray[ 7] = m42;\r\n    thisArray[ 8] = m13;\r\n    thisArray[ 9] = m23;\r\n    thisArray[10] = m33;\r\n    thisArray[11] = m43;\r\n    thisArray[12] = m14;\r\n    thisArray[13] = m24;\r\n    thisArray[14] = m34;\r\n    thisArray[15] = m44;\r\n\r\n    return this;\r\n  }\r\n  \r\n  get m11(): number {\r\n\t\treturn this.array[0];\r\n\t}\r\n\r\n\tset m11(val: number) {\r\n\t\tthis.array[0] = val;\r\n  }\r\n  \r\n  get m12() {\r\n\t\treturn this.array[4];\r\n\t}\r\n\r\n\tset m12(val: number) {\r\n\t\tthis.array[4] = val;\r\n  }\r\n  \r\n  get m13() {\r\n\t\treturn this.array[8];\r\n\t}\r\n\r\n\tset m13(val: number) {\r\n\t\tthis.array[8] = val;\r\n  }\r\n  \r\n  get m14() {\r\n\t\treturn this.array[12];\r\n\t}\r\n\r\n\tset m14(val: number) {\r\n\t\tthis.array[12] = val;\r\n  }\r\n  \r\n  get m21() {\r\n\t\treturn this.array[1];\r\n\t}\r\n\r\n\tset m21(val: number) {\r\n\t\tthis.array[1] = val;\r\n  }\r\n  \r\n  get m22() {\r\n\t\treturn this.array[5];\r\n\t}\r\n\r\n\tset m22(val: number) {\r\n\t\tthis.array[5] = val;\r\n  }\r\n  \r\n  get m23() {\r\n\t\treturn this.array[9];\r\n\t}\r\n\r\n\tset m23(val: number) {\r\n\t\tthis.array[9] = val;\r\n  }\r\n  \r\n  get m24() {\r\n\t\treturn this.array[13];\r\n\t}\r\n\r\n\tset m24(val: number) {\r\n\t\tthis.array[13] = val;\r\n  }\r\n  \r\n  get m31() {\r\n\t\treturn this.array[2];\r\n\t}\r\n\r\n  set m31(val: number) {\r\n\t\tthis.array[2] = val;\r\n  }\r\n  \r\n  get m32() {\r\n\t\treturn this.array[6];\r\n\t}\r\n\r\n\tset m32(val: number) {\r\n\t\tthis.array[6] = val;\r\n  }\r\n  \r\n  get m33() {\r\n\t\treturn this.array[10];\r\n\t}\r\n\r\n  set m33(val: number) {\r\n\t\tthis.array[10] = val;\r\n  }\r\n  \r\n  get m34() {\r\n\t\treturn this.array[14];\r\n\t}\r\n\r\n\tset m34(m34: number) {\r\n\t\tthis.array[14] = m34;\r\n  }\r\n  \r\n  get m41() {\r\n\t\treturn this.array[3];\r\n\t}\r\n\r\n\tset m41(val: number) {\r\n\t\tthis.array[3] = val;\r\n  }\r\n  \r\n  get m42() {\r\n\t\treturn this.array[7];\r\n\t}\r\n\r\n\tset m42(val: number) {\r\n\t\tthis.array[7] = val;\r\n  }\r\n  \r\n  get m43() {\r\n\t\treturn this.array[11];\r\n\t}\r\n\r\n\tset m43(val: number) {\r\n\t\tthis.array[11] = val;\r\n  }\r\n  \r\n  get m44() {\r\n\t\treturn this.array[15];\r\n\t}\r\n\r\n\tset m44(m44: number) {\r\n\t\tthis.array[15] = m44;\r\n  }\r\n\r\n  private checkArray(array: ArrayLike<number>): void {\r\n\t\tif (array.length < 16) {\r\n\t\t\tthrow new MathError(`Array must be of length 16 at least.`);\r\n\t\t}\r\n\t}\r\n\r\n\t// setArray(array: WritableArrayLike<number>): this {\r\n\t// \tthis._checkArray(array);\r\n\t// \tthisArray = array;\r\n\t// \treturn this;\r\n\t// }\r\n\r\n  getRotation(): Quaternion {\r\n    const thisArray = this.array;\r\n    const m11 = thisArray[0], m12 = thisArray[4], m13 = thisArray[ 8],\r\n          m21 = thisArray[1], m22 = thisArray[5], m23 = thisArray[ 9],\r\n          m31 = thisArray[2], m32 = thisArray[6], m33 = thisArray[10];\r\n    const trace = m11 + m22 + m33;\r\n    \r\n    let x = 0;\r\n    let y = 0;\r\n    let z = 0;\r\n    let w = 0;\r\n\r\n    if (trace > 0) {\r\n      const s = Math.sqrt(trace + 1) * 2;\r\n      w = 0.25 * s;\r\n      x = (m32 - m23) / s;\r\n      y = (m13 - m31) / s;\r\n      z = (m21 - m12) / s;\r\n    }\r\n    else if (m11 > m22 && m11 > m33) {\r\n      const s = 2 * Math.sqrt(1 + m11 - m22 - m33);\r\n      w = (m32 - m23) / s;\r\n      x = 0.25 * s;\r\n      y = (m12 + m21) / s;\r\n      z = (m13 + m31) / s;\r\n    }\r\n    else if (m22 > m33) {\r\n      const s = 2 * Math.sqrt(1 + m22 - m11 - m33);\r\n      w = (m13 - m31) / s;\r\n      x = (m12 + m21) / s;\r\n      y = 0.25 * s;\r\n      z = (m23 + m32) / s;\r\n    }\r\n    else {\r\n      const s = 2 * Math.sqrt(1 + m33 - m11 - m22);\r\n      w = (m21 - m12) / s;\r\n      x = (m13 + m31) / s;\r\n      y = (m23 + m32) / s;\r\n      z = 0.25 * s;\r\n    }\r\n    \r\n    return new Quaternion(x, y, z, w);\r\n  }\r\n\r\n  setTRS(translation: Vector3, rotation: Quaternion, scaling: Vector3): this {\r\n    const thisArray = this.array;\r\n    const rotationArray = rotation.array;\r\n    const translationArray = translation.array;\r\n    const scalingArray = scaling.array;\r\n\r\n    const x = rotationArray[0];\r\n    const y = rotationArray[1];\r\n    const z = rotationArray[2];\r\n    const w = rotationArray[3];\r\n\r\n    const x2 = x + x;\r\n    const y2 = y + y;\r\n    const z2 = z + z;\r\n\r\n    const xx = x * x2;\r\n    const xy = x * y2;\r\n    const xz = x * z2;\r\n    const yy = y * y2;\r\n    const yz = y * z2;\r\n    const zz = z * z2;\r\n    const wx = w * x2;\r\n    const wy = w * y2;\r\n    const wz = w * z2;\r\n    const sx = scalingArray[0];\r\n    const sy = scalingArray[1];\r\n    const sz = scalingArray[2];\r\n\r\n    thisArray[0] = (1 - (yy + zz)) * sx;\r\n    thisArray[1] = (xy + wz) * sx;\r\n    thisArray[2] = (xz - wy) * sx;\r\n    thisArray[3] = 0;\r\n    thisArray[4] = (xy - wz) * sy;\r\n    thisArray[5] = (1 - (xx + zz)) * sy;\r\n    thisArray[6] = (yz + wx) * sy;\r\n    thisArray[7] = 0;\r\n    thisArray[8] = (xz + wy) * sz;\r\n    thisArray[9] = (yz - wx) * sz;\r\n    thisArray[10] = (1 - (xx + yy)) * sz;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = translationArray[0];\r\n    thisArray[13] = translationArray[1];\r\n    thisArray[14] = translationArray[2];\r\n    thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n  \r\n  setRotation(quaternion: Quaternion): this {\r\n    const thisArray = this.array;\r\n    const quaternionArray = quaternion.array;\r\n\t\tconst quaternionLengthSquared = quaternion.lengthSquared();\r\n\t\tconst s = 2.0 / quaternionLengthSquared;\r\n\r\n\t\tconst x = quaternionArray[0];\r\n\t\tconst y = quaternionArray[1];\r\n\t\tconst z = quaternionArray[2];\r\n\t\tconst w = quaternionArray[3];\r\n\r\n\t\tconst xs = x * s;\r\n\t\tconst ys = y * s;\r\n\t\tconst zs = z * s;\r\n\t  \r\n\t\tconst wx = w * xs;\r\n\t\tconst wy = w * ys;\r\n\t\tconst wz = w * zs;\r\n\t  \r\n\t\tconst xx = x * xs;\r\n\t\tconst xy = x * ys;\r\n\t\tconst xz = x * zs;\r\n\t\t\r\n\t\tconst yy = y * ys;\r\n\t\tconst yz = y * zs;\r\n\t\tconst zz = z * zs;\r\n\r\n    const m11 = 1 - (yy + zz);\r\n    const m21 = xy + wz;\r\n    const m31 = xz - wy;\r\n    const m12 = xy - wz;\r\n    const m22 = 1 - (xx + zz);\r\n    const m32 = yz + wx;\r\n    const m13 = xz + wy;\r\n    const m23 = yz - wx;\r\n    const m33 = 1 - (xx + yy);\r\n\r\n    thisArray[ 0] = m11;\r\n    thisArray[ 1] = m21;\r\n    thisArray[ 2] = m31;\r\n    thisArray[ 4] = m12;\r\n    thisArray[ 5] = m22;\r\n    thisArray[ 6] = m32;\r\n    thisArray[ 8] = m13;\r\n    thisArray[ 9] = m23;\r\n    thisArray[10] = m33;\r\n\r\n    return this;\r\n  }\r\n\r\n  equals(mat: Matrix4): boolean {\r\n    const thisArray = this.array;\r\n    const matArray = mat.array;\r\n    return thisArray[ 0] === matArray[ 0]\r\n      && thisArray[ 1] === matArray[ 1]\r\n      && thisArray[ 2] === matArray[ 2]\r\n      && thisArray[ 3] === matArray[ 3]\r\n      && thisArray[ 4] === matArray[ 4]\r\n      && thisArray[ 5] === matArray[ 5]\r\n      && thisArray[ 6] === matArray[ 6]\r\n      && thisArray[ 7] === matArray[ 7]\r\n      && thisArray[ 8] === matArray[ 8]\r\n      && thisArray[ 9] === matArray[ 9]\r\n      && thisArray[10] === matArray[10]\r\n      && thisArray[11] === matArray[11]\r\n      && thisArray[12] === matArray[12]\r\n      && thisArray[13] === matArray[13]\r\n      && thisArray[14] === matArray[14]\r\n      && thisArray[15] === matArray[15];\r\n  }\r\n\r\n  copy(mat: Matrix4): this {\r\n    const thisArray = this.array;\r\n    const matArray = mat.array;\r\n\r\n    thisArray[ 0] = matArray[ 0];\r\n    thisArray[ 1] = matArray[ 1];\r\n    thisArray[ 2] = matArray[ 2];\r\n    thisArray[ 3] = matArray[ 3];\r\n    thisArray[ 4] = matArray[ 4];\r\n    thisArray[ 5] = matArray[ 5];\r\n    thisArray[ 6] = matArray[ 6];\r\n    thisArray[ 7] = matArray[ 7];\r\n    thisArray[ 8] = matArray[ 8];\r\n    thisArray[ 9] = matArray[ 9];\r\n    thisArray[10] = matArray[10];\r\n    thisArray[11] = matArray[11];\r\n    thisArray[12] = matArray[12];\r\n    thisArray[13] = matArray[13];\r\n    thisArray[14] = matArray[14];\r\n    thisArray[15] = matArray[15];\r\n\r\n    return this;\r\n  }\r\n\r\n  clone(): this {\r\n    const thisArray = this.array;\r\n    return new Matrix4Base(\r\n      thisArray[ 0], thisArray[ 1], thisArray[ 2], thisArray[ 3],\r\n      thisArray[ 4], thisArray[ 5], thisArray[ 6], thisArray[ 7],\r\n      thisArray[ 8], thisArray[ 9], thisArray[10], thisArray[11],\r\n      thisArray[12], thisArray[13], thisArray[14], thisArray[15]\r\n    ) as this;\r\n  }\r\n\r\n  static identity(): Matrix4Base {\r\n    return new Matrix4Base(\r\n      1, 0, 0, 0,\r\n      0, 1, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n    );\r\n  }\r\n\r\n  setIdentity(): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = 1;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 1;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 1;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  static zeros(): Matrix4Base {\r\n    return new Matrix4Base(\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0\r\n    );\r\n  }\r\n\r\n  setZeros(): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = 0;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 0;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 0;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  det(): number {\r\n    const thisArray = this.array;\r\n    const det2_01_01 = thisArray[0] * thisArray[5] - thisArray[1] * thisArray[4];\r\n    const det2_01_02 = thisArray[0] * thisArray[6] - thisArray[2] * thisArray[4];\r\n    const det2_01_03 = thisArray[0] * thisArray[7] - thisArray[3] * thisArray[4];\r\n    const det2_01_12 = thisArray[1] * thisArray[6] - thisArray[2] * thisArray[5];\r\n    const det2_01_13 = thisArray[1] * thisArray[7] - thisArray[3] * thisArray[5];\r\n    const det2_01_23 = thisArray[2] * thisArray[7] - thisArray[3] * thisArray[6];\r\n    const det3_201_012 = thisArray[8] * det2_01_12 - thisArray[ 9] * det2_01_02 + thisArray[10] * det2_01_01;\r\n    const det3_201_013 = thisArray[8] * det2_01_13 - thisArray[ 9] * det2_01_03 + thisArray[11] * det2_01_01;\r\n    const det3_201_023 = thisArray[8] * det2_01_23 - thisArray[10] * det2_01_03 + thisArray[11] * det2_01_02;\r\n    const det3_201_123 = thisArray[9] * det2_01_23 - thisArray[10] * det2_01_13 + thisArray[11] * det2_01_12;\r\n\r\n    return -det3_201_123 * thisArray[12] + det3_201_023 * thisArray[13]\r\n      - det3_201_013 * thisArray[14] + det3_201_012 * thisArray[15];\r\n  }\r\n\r\n  trace(): number {\r\n    const thisArray = this.array;\r\n    return thisArray[0] + thisArray[5] + thisArray[10] + thisArray[15];\r\n  }\r\n\r\n  static negate(A: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const o = out.array;\r\n\r\n    o[ 0] = -a[ 0];\r\n    o[ 1] = -a[ 1];\r\n    o[ 2] = -a[ 2];\r\n    o[ 3] = -a[ 3];\r\n    o[ 4] = -a[ 4];\r\n    o[ 5] = -a[ 5];\r\n    o[ 6] = -a[ 6];\r\n    o[ 7] = -a[ 7];\r\n    o[ 8] = -a[ 8];\r\n    o[ 9] = -a[ 9];\r\n    o[10] = -a[10];\r\n    o[11] = -a[11];\r\n    o[12] = -a[12];\r\n    o[13] = -a[13];\r\n    o[14] = -a[14];\r\n    o[15] = -a[15];\r\n\r\n    return out;\r\n  }\r\n\r\n  negate(): this {\r\n    return Matrix4Base.negate(this, this) as this;\r\n  }\r\n\r\n  static transpose(A: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const o = out.array;\r\n\r\n    const a11 = a[ 0];\r\n    const a21 = a[ 1];\r\n    const a31 = a[ 2];\r\n    const a41 = a[ 3];\r\n    const a12 = a[ 4];\r\n    const a22 = a[ 5];\r\n    const a32 = a[ 6];\r\n    const a42 = a[ 7];\r\n    const a13 = a[ 8];\r\n    const a23 = a[ 9];\r\n    const a33 = a[10];\r\n    const a43 = a[11];\r\n    const a14 = a[12];\r\n    const a24 = a[13];\r\n    const a34 = a[14];\r\n    const a44 = a[15];\r\n\r\n    o[ 0] = a11;\r\n    o[ 1] = a12;\r\n    o[ 2] = a13;\r\n    o[ 3] = a14;\r\n    o[ 4] = a21;\r\n    o[ 5] = a22;\r\n    o[ 6] = a23;\r\n    o[ 7] = a24;\r\n    o[ 8] = a31;\r\n    o[ 9] = a32;\r\n    o[10] = a33;\r\n    o[11] = a34;\r\n    o[12] = a41;\r\n    o[13] = a42;\r\n    o[14] = a43;\r\n    o[15] = a44;\r\n    \r\n    return out;\r\n  }\r\n\r\n  transpose(): this {\r\n    return Matrix4Base.transpose(this, this) as this;\r\n  }\r\n\r\n  static invert(A: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const o = out.array;\r\n\r\n    const o00 = a[ 0];\r\n    const o01 = a[ 1];\r\n    const o02 = a[ 2];\r\n    const o03 = a[ 3];\r\n    const o10 = a[ 4];\r\n    const o11 = a[ 5];\r\n    const o12 = a[ 6];\r\n    const o13 = a[ 7];\r\n    const o20 = a[ 8];\r\n    const o21 = a[ 9];\r\n    const o22 = a[10];\r\n    const o23 = a[11];\r\n    const o30 = a[12];\r\n    const o31 = a[13];\r\n    const o32 = a[14];\r\n    const o33 = a[15];\r\n\r\n    const t00 = o00 * o11 - o01 * o10;\r\n    const t01 = o00 * o12 - o02 * o10;\r\n    const t02 = o00 * o13 - o03 * o10;\r\n    const t03 = o01 * o12 - o02 * o11;\r\n    const t04 = o01 * o13 - o03 * o11;\r\n    const t05 = o02 * o13 - o03 * o12;\r\n    const t06 = o20 * o31 - o21 * o30;\r\n    const t07 = o20 * o32 - o22 * o30;\r\n    const t08 = o20 * o33 - o23 * o30;\r\n    const t09 = o21 * o32 - o22 * o31;\r\n    const t10 = o21 * o33 - o23 * o31;\r\n    const t11 = o22 * o33 - o23 * o32;\r\n\r\n    const d = (t00 * t11 - t01 * t10 + t02 * t09 + t03 * t08 - t04 * t07 + t05 * t06);\r\n    \r\n    if (d == 0) {\r\n      throw new MathError(`Matrix is not invertible.`);\r\n    }\r\n\r\n    const invDet = 1 / d;\r\n\r\n    o[ 0] = (o11 * t11 - o12 * t10 + o13 * t09) * invDet;\r\n    o[ 1] = (-o01 * t11 + o02 * t10 - o03 * t09) * invDet;\r\n    o[ 2] = (o31 * t05 - o32 * t04 + o33 * t03) * invDet;\r\n    o[ 3] = (-o21 * t05 + o22 * t04 - o23 * t03) * invDet;\r\n    o[ 4] = (-o10 * t11 + o12 * t08 - o13 * t07) * invDet;\r\n    o[ 5] = (o00 * t11 - o02 * t08 + o03 * t07) * invDet;\r\n    o[ 6] = (-o30 * t05 + o32 * t02 - o33 * t01) * invDet;\r\n    o[ 7] = (o20 * t05 - o22 * t02 + o23 * t01) * invDet;\r\n    o[ 8] = (o10 * t10 - o11 * t08 + o13 * t06) * invDet;\r\n    o[ 9] = (-o00 * t10 + o01 * t08 - o03 * t06) * invDet;\r\n    o[10] = (o30 * t04 - o31 * t02 + o33 * t00) * invDet;\r\n    o[11] = (-o20 * t04 + o21 * t02 - o23 * t00) * invDet;\r\n    o[12] = (-o10 * t09 + o11 * t07 - o12 * t06) * invDet;\r\n    o[13] = (o00 * t09 - o01 * t07 + o02 * t06) * invDet;\r\n    o[14] = (-o30 * t03 + o31 * t01 - o32 * t00) * invDet;\r\n    o[15] = (o20 * t03 - o21 * t01 + o22 * t00) * invDet;\r\n\r\n    return out;\r\n  }\r\n\r\n  invert(): this {\r\n    return Matrix4Base.invert(this, this) as this;\r\n  }\r\n\r\n  static add(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const b = B.array;\r\n    const o = out.array;\r\n\r\n    o[ 0] = a[ 0] + b[ 0];\r\n    o[ 1] = a[ 1] + b[ 1];\r\n    o[ 2] = a[ 2] + b[ 2];\r\n    o[ 3] = a[ 3] + b[ 3];\r\n    o[ 4] = a[ 4] + b[ 4];\r\n    o[ 5] = a[ 5] + b[ 5];\r\n    o[ 6] = a[ 6] + b[ 6];\r\n    o[ 7] = a[ 7] + b[ 7];\r\n    o[ 8] = a[ 8] + b[ 8];\r\n    o[ 9] = a[ 9] + b[ 9];\r\n    o[10] = a[10] + b[10];\r\n    o[11] = a[11] + b[11];\r\n    o[12] = a[12] + b[12];\r\n    o[13] = a[13] + b[13];\r\n    o[14] = a[14] + b[14];\r\n    o[15] = a[15] + b[15];\r\n\r\n    return out;\r\n  }\r\n\r\n  add(matrix: Matrix4): this {\r\n    return Matrix4Base.add(this, matrix, this) as this;\r\n  }\r\n\r\n  static sub(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const b = B.array;\r\n    const o = out.array;\r\n\r\n    o[ 0] = a[ 0] - b[ 0];\r\n    o[ 1] = a[ 1] - b[ 1];\r\n    o[ 2] = a[ 2] - b[ 2];\r\n    o[ 3] = a[ 3] - b[ 3];\r\n    o[ 4] = a[ 4] - b[ 4];\r\n    o[ 5] = a[ 5] - b[ 5];\r\n    o[ 6] = a[ 6] - b[ 6];\r\n    o[ 7] = a[ 7] - b[ 7];\r\n    o[ 8] = a[ 8] - b[ 8];\r\n    o[ 9] = a[ 9] - b[ 9];\r\n    o[10] = a[10] - b[10];\r\n    o[11] = a[11] - b[11];\r\n    o[12] = a[12] - b[12];\r\n    o[13] = a[13] - b[13];\r\n    o[14] = a[14] - b[14];\r\n    o[15] = a[15] - b[15];\r\n\r\n    return out;\r\n  }\r\n\r\n  sub(matrix: Matrix4): this {\r\n    return Matrix4Base.sub(this, matrix, this) as this;\r\n  }\r\n\r\n  static mult(A: Matrix4, B: Matrix4, out: Matrix4): Matrix4 {\r\n    const a = A.array;\r\n    const b = B.array;\r\n    const o = out.array;\r\n\r\n    const a11 = a[ 0];\r\n    const a21 = a[ 1];\r\n    const a31 = a[ 2];\r\n    const a41 = a[ 3];\r\n    const a12 = a[ 4];\r\n    const a22 = a[ 5];\r\n    const a32 = a[ 6];\r\n    const a42 = a[ 7];\r\n    const a13 = a[ 8];\r\n    const a23 = a[ 9];\r\n    const a33 = a[10];\r\n    const a43 = a[11];\r\n    const a14 = a[12];\r\n    const a24 = a[13];\r\n    const a34 = a[14];\r\n    const a44 = a[15];\r\n\r\n    const b11 = b[ 0];\r\n    const b21 = b[ 1];\r\n    const b31 = b[ 2];\r\n    const b41 = b[ 3];\r\n    const b12 = b[ 4];\r\n    const b22 = b[ 5];\r\n    const b32 = b[ 6];\r\n    const b42 = b[ 7];\r\n    const b13 = b[ 8];\r\n    const b23 = b[ 9];\r\n    const b33 = b[10];\r\n    const b43 = b[11];\r\n    const b14 = b[12];\r\n    const b24 = b[13];\r\n    const b34 = b[14];\r\n    const b44 = b[15];\r\n\r\n    o[ 0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n    o[ 1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n    o[ 2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n    o[ 3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n    o[ 4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n    o[ 5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n    o[ 6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n    o[ 7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n    o[ 8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n    o[ 9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n    o[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n    o[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n    o[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n    o[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n    o[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n    o[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n    return out;\r\n  }\r\n\r\n  mult(matrix: Matrix4): this {\r\n    return Matrix4Base.mult(this, matrix, this) as this;\r\n  }\r\n\r\n\tgetMaxScaleOnAxis(): number {\r\n    const thisArray = this.array;\r\n    const scaleXSq = thisArray[ 0] * thisArray[ 0] + thisArray[ 1] * thisArray[ 1] + thisArray[ 2] * thisArray[ 2];\r\n    const scaleYSq = thisArray[ 4] * thisArray[ 4] + thisArray[ 5] * thisArray[ 5] + thisArray[ 6] * thisArray[ 6];\r\n    const scaleZSq = thisArray[ 8] * thisArray[ 8] + thisArray[ 9] * thisArray[ 9] + thisArray[10] * thisArray[10];\r\n\r\n    return Math.sqrt(Math.max(scaleXSq, scaleYSq, scaleZSq));\r\n  }\r\n\r\n  writeIntoArray(array: WritableArrayLike<number>, offset: number = 0): void {\r\n    const thisArray = this.array;\r\n\t\tarray[offset     ] = thisArray[ 0];\r\n\t\tarray[offset +  1] = thisArray[ 1];\r\n    array[offset +  2] = thisArray[ 2];\r\n    array[offset +  3] = thisArray[ 3];\r\n\t\tarray[offset +  4] = thisArray[ 4];\r\n    array[offset +  5] = thisArray[ 5];\r\n    array[offset +  6] = thisArray[ 6];\r\n\t\tarray[offset +  7] = thisArray[ 7];\r\n    array[offset +  8] = thisArray[ 8];\r\n    array[offset +  9] = thisArray[ 9];\r\n\t\tarray[offset + 10] = thisArray[10];\r\n    array[offset + 11] = thisArray[11];\r\n    array[offset + 12] = thisArray[12];\r\n\t\tarray[offset + 13] = thisArray[13];\r\n    array[offset + 14] = thisArray[14];\r\n    array[offset + 15] = thisArray[15];\r\n  }\r\n    \r\n  readFromArray(array: ArrayLike<number>, offset: number = 0): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = array[offset     ];\r\n    thisArray[ 1] = array[offset +  1];\r\n    thisArray[ 2] = array[offset +  2];\r\n    thisArray[ 3] = array[offset +  3];\r\n    thisArray[ 4] = array[offset +  4];\r\n    thisArray[ 5] = array[offset +  5];\r\n    thisArray[ 6] = array[offset +  6];\r\n    thisArray[ 7] = array[offset +  7];\r\n    thisArray[ 8] = array[offset +  8];\r\n    thisArray[ 9] = array[offset +  9];\r\n    thisArray[10] = array[offset + 10];\r\n    thisArray[11] = array[offset + 11];\r\n    thisArray[12] = array[offset + 12];\r\n    thisArray[13] = array[offset + 13];\r\n    thisArray[14] = array[offset + 14];\r\n    thisArray[15] = array[offset + 15];\r\n\r\n    return this;\r\n  }\r\n\r\n  solve(vecB: Vector4): Vector4Values {\r\n    const a = this.array;\r\n\r\n    const a11 = a[ 0];\r\n    const a12 = a[ 1];\r\n    const a13 = a[ 2];\r\n    const a14 = a[ 3];\r\n    const a21 = a[ 4];\r\n    const a22 = a[ 5];\r\n    const a23 = a[ 6];\r\n    const a24 = a[ 7];\r\n    const a31 = a[ 8];\r\n    const a32 = a[ 9];\r\n    const a33 = a[10];\r\n    const a34 = a[11];\r\n    const a41 = a[12];\r\n    const a42 = a[13];\r\n    const a43 = a[14];\r\n    const a44 = a[15];\r\n    const b00 = a11 * a22 - a12 * a21;\r\n    const b01 = a11 * a23 - a13 * a21;\r\n    const b02 = a11 * a24 - a14 * a21;\r\n    const b03 = a12 * a23 - a13 * a22;\r\n    const b04 = a12 * a24 - a14 * a22;\r\n    const b05 = a13 * a24 - a14 * a23;\r\n    const b06 = a31 * a42 - a32 * a41;\r\n    const b07 = a31 * a43 - a33 * a41;\r\n    const b08 = a31 * a44 - a34 * a41;\r\n    const b09 = a32 * a43 - a33 * a42;\r\n    const b10 = a32 * a44 - a34 * a42;\r\n    const b11 = a33 * a44 - a34 * a43;\r\n\r\n    const bX = vecB.x;\r\n    const bY = vecB.y;\r\n    const bZ = vecB.z;\r\n    const bW = vecB.w;\r\n\r\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n    if (det != 0) {\r\n      det = 1 / det;\r\n    }\r\n\r\n    const x = det *\r\n      ((a22 * b11 - a23 * b10 + a24 * b09) * bX -\r\n      (a21 * b11 - a23 * b08 + a24 * b07) * bY +\r\n      (a21 * b10 - a22 * b08 + a24 * b06) * bZ -\r\n      (a21 * b09 - a22 * b07 + a23 * b06) * bW)\r\n    const y = det *\r\n      -((a12 * b11 - a13 * b10 + a14 * b09) * bX -\r\n      (a11 * b11 - a13 * b08 + a14 * b07) * bY +\r\n      (a11 * b10 - a12 * b08 + a14 * b06) * bZ -\r\n      (a11 * b09 - a12 * b07 + a13 * b06) * bW)\r\n    const z = det *\r\n      ((a42 * b05 - a43 * b04 + a44 * b03) * bX -\r\n      (a41 * b05 - a43 * b02 + a44 * b01) * bY +\r\n      (a41 * b04 - a42 * b02 + a44 * b00) * bZ -\r\n      (a41 * b03 - a42 * b01 + a43 * b00) * bW)\r\n    const w = det *\r\n      -((a32 * b05 - a33 * b04 + a34 * b03) * bX -\r\n      (a31 * b05 - a33 * b02 + a34 * b01) * bY +\r\n      (a31 * b04 - a32 * b02 + a34 * b00) * bZ -\r\n      (a31 * b03 - a32 * b01 + a33 * b00) * bW);\r\n    \r\n    return [\r\n      x, y, z, w\r\n    ];\r\n  }\r\n\r\n  solve2(vecB: Vector2): Vector2Values {\r\n    const a = this.array;\r\n\r\n    const a11 = a[0];\r\n    const a12 = a[1];\r\n    const a21 = a[4];\r\n    const a22 = a[5];\r\n    const bx = vecB.x - a[8];\r\n    const by = vecB.y - a[9];\r\n    \r\n    let det = a11 * a22 - a12 * a21;\r\n\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    const x = det * (a22 * bx - a12 * by);\r\n    const y = det * (a11 * by - a21 * bx);\r\n\r\n    return [\r\n      x, y\r\n    ];\r\n  }\r\n\r\n  solve3(vecB: Vector3): Vector3Values {\r\n    const a = this.array;\r\n\r\n    const a11 = a[ 0];\r\n    const a12 = a[ 1];\r\n    const a13 = a[ 2];\r\n    const a21 = a[ 4];\r\n    const a22 = a[ 5];\r\n    const a23 = a[ 6];\r\n    const a31 = a[ 8];\r\n    const a32 = a[ 9];\r\n    const a33 = a[10];\r\n    const bx = vecB.x - a[12];\r\n    const by = vecB.y - a[13];\r\n    const bz = vecB.z - a[14];\r\n\r\n    let rx = a22 * a33 - a23 * a32;\r\n    let ry = a23 * a31 - a21 * a33;\r\n    let rz = a21 * a32 - a22 * a31;\r\n\r\n    let det = a11 * rx + a12 * ry + a13 * rz;\r\n    if (det != 0.0) {\r\n      det = 1.0 / det;\r\n    }\r\n\r\n    const x = det * (bx * rx + by * ry + bz * rz);\r\n\r\n    rx = -(a32 * bz - a33 * by);\r\n    ry = -(a33 * bx - a31 * bz);\r\n    rz = -(a31 * by - a32 * bx);\r\n    \r\n    const y = det * (a11 * rx + a12 * ry + a13 * rz);\r\n    \r\n    rx = -(by * a23 - bz * a22);\r\n    ry = -(bz * a21 - bx * a23);\r\n    rz = -(bx * a22 - by * a21);\r\n    \r\n    const z = det * (a11 * rx + a12 * ry + a13 * rz);\r\n\r\n    return [\r\n      x, y, z\r\n    ];\r\n  }\r\n\r\n  static translation(vector: Vector3): Matrix4Base {\r\n    return new Matrix4Base().setTranslation(vector);\r\n  }\r\n\r\n  setTranslation(vec: Vector3): this {\r\n    const thisArray = this.array;\r\n    const vecArray = vec.array;\r\n\r\n    const x = vecArray[0];\r\n    const y = vecArray[1];\r\n    const z = vecArray[2];\r\n\r\n    /*thisArray[ 0] = 1;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 1;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 1;\r\n    thisArray[11] = 0;*/\r\n    thisArray[12] = x;\r\n    thisArray[13] = y;\r\n    thisArray[14] = z;\r\n    //thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  translate(vector: Vector3): this {\r\n    const thisArray = this.array;\r\n    const vectorArray = vector.array;\r\n\r\n    const tx = vectorArray[0];\r\n    const ty = vectorArray[1];\r\n    const tz = vectorArray[2];\r\n    const tw = 1;\r\n\r\n    const t1 = thisArray[0] * tx + thisArray[4] * ty + thisArray[ 8] * tz + thisArray[12] * tw;\r\n    const t2 = thisArray[1] * tx + thisArray[5] * ty + thisArray[ 9] * tz + thisArray[13] * tw;\r\n    const t3 = thisArray[2] * tx + thisArray[6] * ty + thisArray[10] * tz + thisArray[14] * tw;\r\n    const t4 = thisArray[3] * tx + thisArray[7] * ty + thisArray[11] * tz + thisArray[15] * tw;\r\n\r\n    thisArray[12] = t1;\r\n    thisArray[13] = t2;\r\n    thisArray[14] = t3;\r\n    thisArray[15] = t4;\r\n\r\n    return this;\r\n  }\r\n\r\n  static rotationX(angle: number): Matrix4Base {\r\n    return new Matrix4Base().setRotationX(angle);\r\n  }\r\n\r\n  setRotationX(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    thisArray[ 0] = 1;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = cosAngle;\r\n    thisArray[ 6] = sinAngle;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = -sinAngle;\r\n    thisArray[10] = cosAngle;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  rotateX(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    const t1 = thisArray[4] *  cosAngle + thisArray[ 8] * sinAngle;\r\n    const t2 = thisArray[5] *  cosAngle + thisArray[ 9] * sinAngle;\r\n    const t3 = thisArray[6] *  cosAngle + thisArray[10] * sinAngle;\r\n    const t4 = thisArray[7] *  cosAngle + thisArray[11] * sinAngle;\r\n    const t5 = thisArray[4] * -sinAngle + thisArray[ 8] * cosAngle;\r\n    const t6 = thisArray[5] * -sinAngle + thisArray[ 9] * cosAngle;\r\n    const t7 = thisArray[6] * -sinAngle + thisArray[10] * cosAngle;\r\n    const t8 = thisArray[7] * -sinAngle + thisArray[11] * cosAngle;\r\n\r\n    thisArray[ 4] = t1;\r\n    thisArray[ 5] = t2;\r\n    thisArray[ 6] = t3;\r\n    thisArray[ 7] = t4;\r\n    thisArray[ 8] = t5;\r\n    thisArray[ 9] = t6;\r\n    thisArray[10] = t7;\r\n    thisArray[11] = t8;\r\n\r\n    return this;\r\n  }\r\n\r\n  static rotationY(angle: number): Matrix4Base {\r\n    return new Matrix4Base().setRotationY(angle);\r\n  }\r\n\r\n  setRotationY(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    thisArray[ 0] = cosAngle;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = -sinAngle;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 1;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = sinAngle;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = cosAngle;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 1;\r\n    \r\n    return this;\r\n  }\r\n\r\n  rotateY(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    const t1 = thisArray[ 0] * cosAngle + thisArray[ 8] * -sinAngle;\r\n    const t2 = thisArray[ 1] * cosAngle + thisArray[ 9] * -sinAngle;\r\n    const t3 = thisArray[ 2] * cosAngle + thisArray[10] * -sinAngle;\r\n    const t4 = thisArray[ 3] * cosAngle + thisArray[11] * -sinAngle;\r\n    const t5 = thisArray[ 0] * sinAngle + thisArray[ 8] *  cosAngle;\r\n    const t6 = thisArray[ 1] * sinAngle + thisArray[ 9] *  cosAngle;\r\n    const t7 = thisArray[ 2] * sinAngle + thisArray[10] *  cosAngle;\r\n    const t8 = thisArray[ 3] * sinAngle + thisArray[11] *  cosAngle;\r\n\r\n    thisArray[ 0] = t1;\r\n    thisArray[ 1] = t2;\r\n    thisArray[ 2] = t3;\r\n    thisArray[ 3] = t4;\r\n    thisArray[ 8] = t5;\r\n    thisArray[ 9] = t6;\r\n    thisArray[10] = t7;\r\n    thisArray[11] = t8;\r\n\r\n    return this;\r\n  }\r\n\r\n  static rotationZ(angle: number): Matrix4Base {\r\n    return new Matrix4Base().setRotationZ(angle);\r\n  }\r\n\r\n  setRotationZ(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngles = Math.sin(angle);\r\n\r\n    thisArray[ 0] = cosAngle;\r\n    thisArray[ 1] = sinAngles;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = -sinAngles;\r\n    thisArray[ 5] = cosAngle;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 1;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = 1;\r\n\r\n    return this;\r\n  }\r\n\r\n  rotateZ(angle: number): this {\r\n    const thisArray = this.array;\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    const t1 = thisArray[0] *  cosAngle + thisArray[4] * sinAngle;\r\n    const t2 = thisArray[1] *  cosAngle + thisArray[5] * sinAngle;\r\n    const t3 = thisArray[2] *  cosAngle + thisArray[6] * sinAngle;\r\n    const t4 = thisArray[3] *  cosAngle + thisArray[7] * sinAngle;\r\n    const t5 = thisArray[0] * -sinAngle + thisArray[4] * cosAngle;\r\n    const t6 = thisArray[1] * -sinAngle + thisArray[5] * cosAngle;\r\n    const t7 = thisArray[2] * -sinAngle + thisArray[6] * cosAngle;\r\n    const t8 = thisArray[3] * -sinAngle + thisArray[7] * cosAngle;\r\n    \r\n    thisArray[0] = t1;\r\n    thisArray[1] = t2;\r\n    thisArray[2] = t3;\r\n    thisArray[3] = t4;\r\n    thisArray[4] = t5;\r\n    thisArray[5] = t6;\r\n    thisArray[6] = t7;\r\n    thisArray[7] = t8;\r\n\r\n    return this;\r\n  }\r\n\r\n  static rotation(matrix: Matrix3): Matrix4Base {\r\n    return new Matrix4Base().rotation(matrix);\r\n  }\r\n\r\n  rotation(matrix: Matrix3): this {\r\n    const thisArray = this.array;\r\n    const matArray = matrix.array;\r\n\r\n    thisArray[ 0] = matArray[0];\r\n    thisArray[ 1] = matArray[1];\r\n    thisArray[ 2] = matArray[2];\r\n    thisArray[ 4] = matArray[3];\r\n    thisArray[ 5] = matArray[4];\r\n    thisArray[ 6] = matArray[5];\r\n    thisArray[ 8] = matArray[6];\r\n    thisArray[ 9] = matArray[7];\r\n    thisArray[10] = matArray[8];\r\n\r\n    return this;\r\n  }\r\n\r\n  rotate(axis: Vector3, angle: number): this {\r\n    const thisArray = this.array;\r\n    const axisArray = axis.array;\r\n    const axisLength = axis.length();\r\n    const x = axisArray[0] / axisLength;\r\n    const y = axisArray[1] / axisLength;\r\n    const z = axisArray[2] / axisLength;\r\n    const c = Math.cos(angle);\r\n    const s = Math.sin(angle);\r\n    const C = 1.0 - c;\r\n    const m11 = x * x * C + c;\r\n    const m12 = x * y * C - z * s;\r\n    const m13 = x * z * C + y * s;\r\n    const m21 = y * x * C + z * s;\r\n    const m22 = y * y * C + c;\r\n    const m23 = y * z * C - x * s;\r\n    const m31 = z * x * C - y * s;\r\n    const m32 = z * y * C + x * s;\r\n    const m33 = z * z * C + c;\r\n    const t1  = thisArray[0] * m11 + thisArray[4] * m21 + thisArray[8] * m31;\r\n    const t2  = thisArray[1] * m11 + thisArray[5] * m21 + thisArray[9] * m31;\r\n    const t3  = thisArray[2] * m11 + thisArray[6] * m21 + thisArray[10] * m31;\r\n    const t4  = thisArray[3] * m11 + thisArray[7] * m21 + thisArray[11] * m31;\r\n    const t5  = thisArray[0] * m12 + thisArray[4] * m22 + thisArray[8] * m32;\r\n    const t6  = thisArray[1] * m12 + thisArray[5] * m22 + thisArray[9] * m32;\r\n    const t7  = thisArray[2] * m12 + thisArray[6] * m22 + thisArray[10] * m32;\r\n    const t8  = thisArray[3] * m12 + thisArray[7] * m22 + thisArray[11] * m32;\r\n    const t9  = thisArray[0] * m13 + thisArray[4] * m23 + thisArray[8] * m33;\r\n    const t10 = thisArray[1] * m13 + thisArray[5] * m23 + thisArray[9] * m33;\r\n    const t11 = thisArray[2] * m13 + thisArray[6] * m23 + thisArray[10] * m33;\r\n    const t12 = thisArray[3] * m13 + thisArray[7] * m23 + thisArray[11] * m33;\r\n    thisArray[ 0] = t1;\r\n    thisArray[ 1] = t2;\r\n    thisArray[ 2] = t3;\r\n    thisArray[ 3] = t4;\r\n    thisArray[ 4] = t5;\r\n    thisArray[ 5] = t6;\r\n    thisArray[ 6] = t7;\r\n    thisArray[ 7] = t8;\r\n    thisArray[ 8] = t9;\r\n    thisArray[ 9] = t10;\r\n    thisArray[10] = t11;\r\n    thisArray[11] = t12;\r\n\r\n    return this;\r\n  }\r\n\r\n  static scaling(vec: Vector3): Matrix4Base {\r\n    return new Matrix4Base().setScaling(vec);\r\n  }\r\n\r\n  setScaling(vec: Vector3): this {\r\n    const thisArray = this.array;\r\n    const vecArray = vec.array;\r\n    const sx = vecArray[0];\r\n    const sy = vecArray[1];\r\n    const sz = vecArray[2];\r\n    const sw = 1;\r\n\r\n    thisArray[ 0] = sx;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = sy;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = sz;\r\n    thisArray[11] = 0;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = 0;\r\n    thisArray[15] = sw;\r\n\r\n    return this;\r\n  }\r\n\r\n  scale(vec: Vector3): this {\r\n    const thisArray = this.array;\r\n    const vecArray = vec.array;\r\n    const sx = vecArray[0];\r\n    const sy = vecArray[1];\r\n    const sz = vecArray[2];\r\n    const sw = 1;\r\n\r\n    thisArray[ 0] *= sx;\r\n    thisArray[ 1] *= sx;\r\n    thisArray[ 2] *= sx;\r\n    thisArray[ 3] *= sx;\r\n    thisArray[ 4] *= sy;\r\n    thisArray[ 5] *= sy;\r\n    thisArray[ 6] *= sy;\r\n    thisArray[ 7] *= sy;\r\n    thisArray[ 8] *= sz;\r\n    thisArray[ 9] *= sz;\r\n    thisArray[10] *= sz;\r\n    thisArray[11] *= sz;\r\n    thisArray[12] *= sw;\r\n    thisArray[13] *= sw;\r\n    thisArray[14] *= sw;\r\n    thisArray[15] *= sw;\r\n\r\n    return this;\r\n  }\r\n\r\n  static lookAt(eye: Vector3, target: Vector3, up: Vector3, out: Matrix4): Matrix4 {\r\n    const eyeArray = eye.array;\r\n    const upArray = up.array;\r\n    const targetArray = target.array;\r\n    const outArray = out.array;\r\n    const e0 = eyeArray[0];\r\n    const e1 = eyeArray[1];\r\n    const e2 = eyeArray[2];\r\n    const u0 = upArray[0];\r\n    const u1 = upArray[1];\r\n    const u2 = upArray[2];\r\n    const t0 = targetArray[0];\r\n    const t1 = targetArray[1];\r\n    const t2 = targetArray[2];\r\n    let x0, x1, x2, y0, y1, y2, z0, z1, z2, length;\r\n\r\n    z0 = e0 - t0;\r\n    z1 = e1 - t1;\r\n    z2 = e2 - t2;\r\n    length = Math.hypot(z0, z1, z2);\r\n    if (length > 0) {\r\n      length = 1 / Math.hypot(z0, z1, z2);\r\n      z0 *= length;\r\n      z1 *= length;\r\n      z2 *= length;\r\n    }\r\n  \r\n    x0 = u1 * z2 - u2 * z1;\r\n    x1 = u2 * z0 - u0 * z2;\r\n    x2 = u0 * z1 - u1 * z0;\r\n    length = Math.hypot(x0, x1, x2);\r\n    if (length > 0) {\r\n      length = 1 / length;\r\n      x0 *= length;\r\n      x1 *= length;\r\n      x2 *= length;\r\n    }\r\n\r\n    y0 = z1 * x2 - z2 * x1;\r\n    y1 = z2 * x0 - z0 * x2;\r\n    y2 = z0 * x1 - z1 * x0;\r\n    length = Math.hypot(y0, y1, y2);\r\n    if (length > 0) {\r\n      length = 1 / length;\r\n      y0 *= length;\r\n      y1 *= length;\r\n      y2 *= length;\r\n    }\r\n  \r\n    outArray[ 0] = x0;\r\n    outArray[ 1] = x1;\r\n    outArray[ 2] = x2;\r\n    outArray[ 3] = 0;\r\n    outArray[ 4] = y0;\r\n    outArray[ 5] = y1;\r\n    outArray[ 6] = y2;\r\n    outArray[ 7] = 0;\r\n    outArray[ 8] = z0;\r\n    outArray[ 9] = z1;\r\n    outArray[10] = z2;\r\n    outArray[11] = 0;\r\n    outArray[12] = e0;\r\n    outArray[13] = e1;\r\n    outArray[14] = e2;\r\n    outArray[15] = 1;\r\n  \r\n    return out;\r\n  }\r\n\r\n  lookAt(eye: Vector3, target: Vector3, up: Vector3): this {\r\n    return Matrix4Base.lookAt(eye, target, up, this) as this;\r\n  }\r\n\r\n  transformPoint(point: Vector3): Vector3 {\r\n    const thisArray = this.array;\r\n    const pointArray = point.array;\r\n\r\n    const x = pointArray[0];\r\n    const y = pointArray[1];\r\n    const z = pointArray[2];\r\n\r\n    const d = x * thisArray[3] + y * thisArray[7] + z * thisArray[11] + thisArray[15];\r\n\r\n    point.setValues(\r\n      (x * thisArray[0] + y * thisArray[4] + z * thisArray[ 8] + thisArray[12]) / d,\r\n      (x * thisArray[1] + y * thisArray[5] + z * thisArray[ 9] + thisArray[13]) / d,\r\n      (x * thisArray[2] + y * thisArray[6] + z * thisArray[10] + thisArray[14]) / d\r\n    );\r\n\r\n    return point;\r\n  }\r\n\r\n  transformPoint4(point: Vector4): Vector4 {\r\n    const thisArray = this.array;\r\n    const pointArray = point.array;\r\n\r\n    const x = pointArray[0];\r\n    const y = pointArray[1];\r\n    const z = pointArray[2];\r\n    const w = pointArray[3];\r\n\r\n    const d = x * thisArray[3] + y * thisArray[7] + z * thisArray[11] + w * thisArray[15];\r\n\r\n    point.setValues(\r\n      (x * thisArray[0] + y * thisArray[4] + z * thisArray[ 8] + thisArray[12]) / d,\r\n      (x * thisArray[1] + y * thisArray[5] + z * thisArray[ 9] + thisArray[13]) / d,\r\n      (x * thisArray[2] + y * thisArray[6] + z * thisArray[10] + thisArray[14]) / d,\r\n      (x * thisArray[3] + y * thisArray[7] + z * thisArray[11] + thisArray[15]) / d\r\n    );\r\n\r\n    return point;\r\n  }\r\n\r\n  transformDirection(direction: Vector3): Vector3 {\r\n    const thisArray = this.array;\r\n    const directionArray = direction.array;\r\n\r\n    const x = directionArray[0];\r\n    const y = directionArray[1];\r\n    const z = directionArray[2];\r\n\r\n    direction.setValues(\r\n      x * thisArray[0] + y * thisArray[4] + z * thisArray[ 8],\r\n      x * thisArray[1] + y * thisArray[5] + z * thisArray[ 9],\r\n      x * thisArray[2] + y * thisArray[6] + z * thisArray[10]\r\n    );\r\n\r\n    return direction;\r\n  }\r\n\r\n  transformNormal(normal: Vector3): Vector3 {\r\n    const normalArray = normal.array;\r\n\r\n    const thisInvArray = this.invert().array;\r\n\r\n    const x = normalArray[0];\r\n    const y = normalArray[1];\r\n    const z = normalArray[2];\r\n\r\n    normal.setValues(\r\n      x * thisInvArray[0] + y * thisInvArray[4] + z * thisInvArray[ 8],\r\n      x * thisInvArray[1] + y * thisInvArray[5] + z * thisInvArray[ 9],\r\n      x * thisInvArray[2] + y * thisInvArray[6] + z * thisInvArray[10]\r\n    );\r\n\r\n    this.invert();\r\n\r\n    return normal;\r\n  }\r\n\r\n  static perspective(fov: number, aspect: number, zNear: number, zFar: number): Matrix4Base {\r\n    return new Matrix4Base().setPerspective(fov, aspect, zNear, zFar);\r\n  }\r\n\r\n  setPerspective(fov: number, aspect: number, zNear: number, zFar: number): this {\r\n    const thisArray = this.array;\r\n    const width = Math.tan(Math.PI * 0.5 - 0.5 * fov);\r\n    const height = width / aspect;\r\n    const rangeInv = 1 / (zNear - zFar);\r\n\r\n    thisArray[ 0] = height;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = width;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = (zNear + zFar) * rangeInv;\r\n    thisArray[11] = -1;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = (2 * zNear * zFar) * rangeInv;\r\n    thisArray[15] = 0;\r\n    \r\n    return this;\r\n  }\r\n\r\n  static orthographic(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4Base {\r\n    return new Matrix4Base().setOrthographic(left, right, bottom, top, near, far);\r\n  }\r\n\r\n  setOrthographic(left: number, right: number, bottom: number, top: number, near: number, far: number): this {\r\n    const thisArray = this.array;\r\n    thisArray[ 0] = 2 / (right - left);\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = 2 / (top - bottom);\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = 0;\r\n    thisArray[ 9] = 0;\r\n    thisArray[10] = 2 / (near - far);\r\n    thisArray[11] = 0;\r\n    thisArray[12] = (right + left) / (left - right);\r\n    thisArray[13] = (top + bottom) / (bottom - top);\r\n    thisArray[14] = (far + near) / (near - far);\r\n    thisArray[15] = 1;\r\n    \r\n    return this;\r\n  }\r\n\r\n  static frustum(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4Base {\r\n    return new Matrix4Base().setFrustum(left, right, bottom, top, near, far);\r\n  }\r\n\r\n  setFrustum(left: number, right: number, bottom: number, top: number, near: number, far: number): this {\r\n    const thisArray = this.array;\r\n    const invWidth = 1 / (right - left);\r\n    const invHeight = 1 / (top - bottom);\r\n    const invDepth = 1 / (near - far);\r\n\r\n    thisArray[ 0] = near * 2 * invWidth;\r\n    thisArray[ 1] = 0;\r\n    thisArray[ 2] = 0;\r\n    thisArray[ 3] = 0;\r\n    thisArray[ 4] = 0;\r\n    thisArray[ 5] = near * 2 * invHeight;\r\n    thisArray[ 6] = 0;\r\n    thisArray[ 7] = 0;\r\n    thisArray[ 8] = (right + left) * invWidth;\r\n    thisArray [9] = (top + bottom) * invHeight;\r\n    thisArray[10] = (far + near) * invDepth;\r\n    thisArray[11] = -1;\r\n    thisArray[12] = 0;\r\n    thisArray[13] = 0;\r\n    thisArray[14] = far * near * 2 * invDepth;\r\n    thisArray[15] = 0;\r\n    \r\n    return this;\r\n  }\r\n}\r\n\r\nvar Matrix4: Matrix4Constructor = Matrix4Base;\r\n\r\nconst Matrix4Injector: Injector<Matrix4Constructor> = new Injector({\r\n\tdefaultCtor: Matrix4Base,\r\n\tonDefaultOverride:\r\n\t\t(ctor: Matrix4Constructor) => {\r\n\t\t\tMatrix4 = ctor;\r\n\t\t}\r\n});","import { StackPool } from \"../../../patterns/pools/StackPool\";\r\nimport { Matrix4 } from \"../../algebra/matrices/Matrix4\";\r\nimport { Vector3, Vector3Constructor } from \"../../algebra/vectors/Vector3\";\r\n\r\nexport { Vector3Pool };\r\n\r\nclass Vector3PoolBase extends StackPool<Vector3> implements StackPool<Vector3> {\r\n    private _buffer: Float32Array;\r\n    private _bufferViews: Array<WritableArrayLike<number>>;\r\n    private _extensions: Array<WritableArrayLike<number>>;\r\n\r\n    constructor(ctor: Vector3Constructor, options?: any) {\r\n        super(ctor, options);\r\n        this._buffer = new Float32Array(0);\r\n        this._bufferViews = Array(options?.size || 0).fill(0).map(() => {\r\n            return this._buffer.subarray();\r\n        });\r\n        this._extensions = [];\r\n    }\r\n}\r\n\r\nconst Vector3Pool: StackPool<Vector3> = new Vector3PoolBase(Vector3);","export { UUID };\r\nexport { Identifiable };\r\nexport { UUIDGeneratorBase };\r\nexport { UUIDGenerator };\r\n\r\ntype UUID = string;\r\n\r\ninterface Identifiable {\r\n    readonly uuid: UUID;\r\n}\r\n\r\ninterface UUIDGenerator {\r\n    newUUID(): UUID;\r\n}\r\n\r\nclass UUIDGeneratorBase {\r\n\r\n    private _count: number;\r\n\r\n    constructor() {\r\n        this._count = 0\r\n    }\r\n\r\n    newUUID(): UUID {\r\n        return (++this._count).toString(16);\r\n    }\r\n}\r\n\r\nconst UUIDGenerator: UUIDGenerator = new UUIDGeneratorBase();","import { EulerAngles } from \"../../libs/maths/algebra/angles/EulerAngles\";\r\nimport { Matrix3 } from \"../../libs/maths/algebra/matrices/Matrix3\";\r\nimport { Matrix4 } from \"../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Quaternion, QuaternionPool } from \"../../libs/maths/algebra/quaternions/Quaternion\";\r\nimport { Vector3 } from \"../../libs/maths/algebra/vectors/Vector3\";\r\nimport { Vector3Pool } from \"../../libs/maths/extensions/pools/Vector3Pools\";\r\nimport { UUID, UUIDGenerator } from \"../../libs/maths/statistics/random/UUIDGenerator\";\r\nimport { Object3D } from \"../rendering/scenes/objects/Object3D\";\r\n\r\nexport { Transform };\r\nexport { TransformBase };\r\n\r\ninterface TransformConstructor {\r\n    readonly prototype: Transform;\r\n    new(): Transform;\r\n    new(owner: Object3D): Transform;\r\n}\r\n\r\nconst tempMatrix = new Matrix4();\r\n\r\ninterface Transform {\r\n    hasChanged: boolean;\r\n\r\n    readonly localArray: Float32Array;\r\n    readonly array: Float32Array;\r\n    readonly uuid: UUID;\r\n    readonly owner: Object3D | null;\r\n\r\n    localMatrix: Matrix4;\r\n    matrix: Matrix4;\r\n\r\n    getMatrix(matrix: Matrix4): Matrix4;\r\n    setMatrix(matrix: Matrix4): this;\r\n    getLocalMatrix(matrix: Matrix4): Matrix4;\r\n    setLocalMatrix(matrix: Matrix4): this;\r\n\r\n    getRight(vector: Vector3): Vector3;\r\n    getLeft(vector: Vector3): Vector3;\r\n    getUp(vector: Vector3): Vector3;\r\n    getDown(vector: Vector3): Vector3;\r\n    getForward(vector: Vector3): Vector3;\r\n    getBackward(vector: Vector3): Vector3;\r\n\r\n    getTranslation(vector: Vector3): Vector3;\r\n    setTranslation(vector: Vector3): this;\r\n    translate(vector: Vector3): this;\r\n\r\n    getRotation(rotation: Quaternion): Quaternion;\r\n    setRotation(rotation: Quaternion): this;\r\n    rotate(rotation: Quaternion): this;\r\n\r\n    getScaling(scaling: Vector3): Vector3;\r\n    setScaling(scaling: Vector3): this;\r\n    scale(scaling: Vector3): this;\r\n    \r\n    lookAt(target: Vector3, up: Vector3): this;\r\n}\r\n\r\nclass TransformBase implements Transform {\r\n    readonly localArray: Float32Array;\r\n    readonly array: Float32Array;\r\n    readonly uuid: UUID;\r\n    readonly owner: Object3D | null;\r\n\r\n    readonly matrix: Matrix4;\r\n    readonly localMatrix: Matrix4;;\r\n\r\n    hasChanged: boolean;\r\n    readonly isStatic: boolean;\r\n\r\n    constructor(owner?: Object3D, isStatic?: boolean) {\r\n        this.uuid = UUIDGenerator.newUUID();\r\n        this.owner = owner || null;\r\n\r\n        this.isStatic = isStatic ?? false;\r\n        \r\n        this.array = new Float32Array(16);\r\n        this.localArray = new Float32Array(16);\r\n\r\n        this.matrix = new Matrix4(this.array).setIdentity();\r\n        this.localMatrix = new Matrix4(this.localArray).setIdentity();\r\n\r\n        this.hasChanged = false;\r\n    }\r\n\r\n    getMatrix(matrix: Matrix4): Matrix4 {\r\n        const thisArray = this.array;\r\n        const matrixArray = matrix.array;\r\n        matrixArray[ 0] = thisArray[ 0];\r\n        matrixArray[ 1] = thisArray[ 1];\r\n        matrixArray[ 2] = thisArray[ 2];\r\n        matrixArray[ 3] = thisArray[ 3];\r\n        matrixArray[ 4] = thisArray[ 4];\r\n        matrixArray[ 5] = thisArray[ 5];\r\n        matrixArray[ 6] = thisArray[ 6];\r\n        matrixArray[ 7] = thisArray[ 7];\r\n        matrixArray[ 8] = thisArray[ 8];\r\n        matrixArray[ 9] = thisArray[ 9];\r\n        matrixArray[10] = thisArray[10];\r\n        matrixArray[11] = thisArray[11];\r\n        matrixArray[12] = thisArray[12];\r\n        matrixArray[13] = thisArray[13];\r\n        matrixArray[14] = thisArray[14];\r\n        matrixArray[15] = thisArray[15];\r\n\r\n        return matrix;\r\n    }\r\n\r\n    setMatrix(matrix: Matrix4): this {\r\n        const thisArray = this.array;\r\n        const matrixArray = matrix.array;\r\n        thisArray[ 0] = matrixArray[ 0];\r\n        thisArray[ 1] = matrixArray[ 1];\r\n        thisArray[ 2] = matrixArray[ 2];\r\n        thisArray[ 3] = matrixArray[ 3];\r\n        thisArray[ 4] = matrixArray[ 4];\r\n        thisArray[ 5] = matrixArray[ 5];\r\n        thisArray[ 6] = matrixArray[ 6];\r\n        thisArray[ 7] = matrixArray[ 7];\r\n        thisArray[ 8] = matrixArray[ 8];\r\n        thisArray[ 9] = matrixArray[ 9];\r\n        thisArray[10] = matrixArray[10];\r\n        thisArray[11] = matrixArray[11];\r\n        thisArray[12] = matrixArray[12];\r\n        thisArray[13] = matrixArray[13];\r\n        thisArray[14] = matrixArray[14];\r\n        thisArray[15] = matrixArray[15];\r\n\r\n        return this;\r\n    }\r\n\r\n    getLocalMatrix(matrix: Matrix4): Matrix4 {\r\n        const thisLocalArray = this.localArray;\r\n        const matrixArray = matrix.array;\r\n        matrixArray[ 0] = thisLocalArray[ 0];\r\n        matrixArray[ 1] = thisLocalArray[ 1];\r\n        matrixArray[ 2] = thisLocalArray[ 2];\r\n        matrixArray[ 3] = thisLocalArray[ 3];\r\n        matrixArray[ 4] = thisLocalArray[ 4];\r\n        matrixArray[ 5] = thisLocalArray[ 5];\r\n        matrixArray[ 6] = thisLocalArray[ 6];\r\n        matrixArray[ 7] = thisLocalArray[ 7];\r\n        matrixArray[ 8] = thisLocalArray[ 8];\r\n        matrixArray[ 9] = thisLocalArray[ 9];\r\n        matrixArray[10] = thisLocalArray[10];\r\n        matrixArray[11] = thisLocalArray[11];\r\n        matrixArray[12] = thisLocalArray[12];\r\n        matrixArray[13] = thisLocalArray[13];\r\n        matrixArray[14] = thisLocalArray[14];\r\n        matrixArray[15] = thisLocalArray[15];\r\n\r\n        return matrix;\r\n    }\r\n\r\n    setLocalMatrix(matrix: Matrix4): this {\r\n        const thisLocalArray = this.localArray;\r\n        const matrixArray = matrix.array;\r\n        thisLocalArray[ 0] = matrixArray[ 0];\r\n        thisLocalArray[ 1] = matrixArray[ 1];\r\n        thisLocalArray[ 2] = matrixArray[ 2];\r\n        thisLocalArray[ 3] = matrixArray[ 3];\r\n        thisLocalArray[ 4] = matrixArray[ 4];\r\n        thisLocalArray[ 5] = matrixArray[ 5];\r\n        thisLocalArray[ 6] = matrixArray[ 6];\r\n        thisLocalArray[ 7] = matrixArray[ 7];\r\n        thisLocalArray[ 8] = matrixArray[ 8];\r\n        thisLocalArray[ 9] = matrixArray[ 9];\r\n        thisLocalArray[10] = matrixArray[10];\r\n        thisLocalArray[11] = matrixArray[11];\r\n        thisLocalArray[12] = matrixArray[12];\r\n        thisLocalArray[13] = matrixArray[13];\r\n        thisLocalArray[14] = matrixArray[14];\r\n        thisLocalArray[15] = matrixArray[15];\r\n\r\n        return this;\r\n    }\r\n\r\n    getRight(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[0];\r\n        vectorArray[1] = thisArray[1];\r\n        vectorArray[2] = thisArray[2];\r\n        return vector;\r\n    }\r\n\r\n    getLeft(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = -thisArray[0];\r\n        vectorArray[1] = -thisArray[1];\r\n        vectorArray[2] = -thisArray[2];\r\n        return vector;\r\n    }\r\n\r\n    getUp(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[4];\r\n        vectorArray[1] = thisArray[5];\r\n        vectorArray[2] = thisArray[6];\r\n        return vector;\r\n    }\r\n\r\n    getDown(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = -thisArray[4];\r\n        vectorArray[1] = -thisArray[5];\r\n        vectorArray[2] = -thisArray[6];\r\n        return vector;\r\n    }\r\n\r\n    getForward(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[ 8];\r\n        vectorArray[1] = thisArray[ 9];\r\n        vectorArray[2] = thisArray[10];\r\n        return vector;\r\n    }\r\n\r\n    getBackward(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = -thisArray[ 8];\r\n        vectorArray[1] = -thisArray[ 9];\r\n        vectorArray[2] = -thisArray[10];\r\n        return vector;\r\n    }\r\n\r\n    getTranslation(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[12];\r\n        vectorArray[1] = thisArray[13];\r\n        vectorArray[2] = thisArray[14];\r\n        return vector;\r\n    }\r\n\r\n    setTranslation(vector: Vector3): this {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        thisArray[12] = vectorArray[0];\r\n        thisArray[13] = vectorArray[1];\r\n        thisArray[14] = vectorArray[2];\r\n        return this;\r\n    }\r\n\r\n    translate(vector: Vector3): this {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        thisArray[12] += vectorArray[0];\r\n        thisArray[13] += vectorArray[1];\r\n        thisArray[14] += vectorArray[2];\r\n        return this;\r\n    }\r\n\r\n    getScaling(vector: Vector3): Vector3 {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        vectorArray[0] = thisArray[ 0];\r\n        vectorArray[1] = thisArray[ 5];\r\n        vectorArray[2] = thisArray[10];\r\n        return vector;\r\n    }\r\n\r\n    setScaling(vector: Vector3): this {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        thisArray[ 0] = vectorArray[0];\r\n        thisArray[ 5] = vectorArray[1];\r\n        thisArray[10] = vectorArray[2];\r\n        return this;\r\n    }\r\n\r\n    scale(vector: Vector3): this {\r\n        const thisArray = this.array;\r\n        const vectorArray = vector.array;\r\n        thisArray[ 0] *= vectorArray[0];\r\n        thisArray[ 5] *= vectorArray[1];\r\n        thisArray[10] *= vectorArray[2];\r\n        return this;\r\n    }\r\n\r\n    getRotation(rotation: Quaternion): Quaternion {\r\n        rotation.setMatrix(this.matrix);\r\n        return rotation;\r\n    }\r\n    \r\n    setRotation(rotation: Quaternion): this {\r\n        this.matrix.setRotation(rotation);\r\n        return this;\r\n    }\r\n\r\n    rotate(rotation: Quaternion): this {\r\n        this.matrix.mult(\r\n            rotation.getMatrix4(tempMatrix)\r\n        );\r\n        return this;\r\n    }\r\n\r\n    transformPoint(point: Vector3): Vector3 {\r\n        return point;\r\n    }\r\n\r\n    transformDirection(direction: Vector3): Vector3 {\r\n        return direction;\r\n    }\r\n\r\n    transformVector(vector: Vector3): Vector3 {\r\n        return vector;\r\n    }\r\n\r\n    lookAt(target: Vector3, up: Vector3): this {\r\n        const thisPosition = this.getTranslation(Vector3Pool.acquire(1)[0]);\r\n        this.matrix.lookAt(thisPosition, target, up);\r\n        Vector3Pool.release(1);\r\n        return this;\r\n    }\r\n}\r\n\r\nconst Transform: TransformConstructor = TransformBase;","import { Injector } from \"../../../patterns/injectors/Injector\";\r\nimport { Vector3 } from \"../../algebra/vectors/Vector3\";\r\nimport { Vector3Pool } from \"../../extensions/pools/Vector3Pools\";\r\n\r\nexport { Plane };\r\nexport { PlaneInjector };\r\nexport { PlaneBase };\r\n\r\ninterface Plane {\r\n    readonly normal: Vector3;\r\n    constant: number;\r\n    copy(plane: Plane): Plane;\r\n    set(x: number, y: number, z: number, constant: number): Plane;\r\n    setFromNormalAndConstant(normal: Vector3, constant: number): Plane;\r\n\tsetFromNormalAndCoplanarPoint(normal: Vector3, point: Vector3): Plane;\r\n\tsetFromCoplanarPoints(point1: Vector3, point2: Vector3, point3: Vector3): Plane;\r\n\tdistanceToPoint(point: Vector3): number;\r\n    normalized(): Plane;\r\n}\r\n\r\ninterface PlaneConstructor {\r\n    readonly prototype: Plane;\r\n    new(): Plane;\r\n    new(normal: Vector3, constant: number): Plane;\r\n    new(normal?: Vector3, constant?: number): Plane;\r\n    fromNormalAndConstant(normal: Vector3, constant: number): Plane;\r\n    fromNormalAndCoplanarPoint(normal: Vector3, point: Vector3): Plane;\r\n    fromCoplanarPoints(a: Vector3, b: Vector3, c: Vector3): Plane;\r\n    intersection(a: Plane, b: Plane, c: Plane, result: Vector3): Vector3;\r\n}\r\n\r\nclass PlaneBase implements Plane {\r\n\r\n    readonly normal: Vector3;\r\n    constant: number;\r\n\r\n    constructor()\r\n    constructor(normal: Vector3, constant: number)\r\n    constructor(normal?: Vector3, constant?: number) {\r\n        this.normal = normal ?? new Vector3();\r\n        this.constant = constant ?? 0;\r\n    }\r\n\r\n    static fromNormalAndConstant(normal: Vector3, constant: number): Plane {\r\n        return new PlaneBase().setFromNormalAndConstant(normal, constant);\r\n    }\r\n\r\n\tstatic fromNormalAndCoplanarPoint(normal: Vector3, point: Vector3): Plane {\r\n\t\treturn new PlaneBase().setFromNormalAndCoplanarPoint(normal, point);\r\n\t}\r\n\r\n\tstatic fromCoplanarPoints(a: Vector3, b: Vector3, c: Vector3): Plane {\r\n        return new PlaneBase().setFromCoplanarPoints(a, b, c);\r\n    }\r\n\r\n    copy(plane: PlaneBase): PlaneBase {\r\n        this.normal.copy(plane.normal);\r\n        this.constant = plane.constant;\r\n        return this;\r\n    }\r\n\r\n    set(x: number, y: number, z: number, constant: number): PlaneBase {\r\n        this.normal.setValues(x, y, z);\r\n        this.constant = constant;\r\n\r\n        return this;\r\n    }\r\n\r\n    setFromNormalAndConstant(normal: Vector3, constant: number): PlaneBase {\r\n        this.normal.copy(normal);\r\n        this.constant = constant;\r\n\r\n        return this;\r\n    }\r\n\r\n\tsetFromNormalAndCoplanarPoint(normal: Vector3, point: Vector3): PlaneBase {\r\n\t\tthis.normal.copy(normal);\r\n        this.constant = -point.dot(this.normal);\r\n        \r\n        return this;\r\n\t}\r\n\r\n\tsetFromCoplanarPoints(point1: Vector3, point2: Vector3, point3: Vector3): PlaneBase {\r\n        const normal = point3.clone();\r\n        const [temp] = Vector3Pool.acquire(1);\r\n        temp.copy(point1);\r\n        normal.sub(point2).cross(temp.sub(point2)).normalize();\r\n        this.setFromNormalAndCoplanarPoint(normal, point1);\r\n        Vector3Pool.release(1);\r\n\t\treturn this;\r\n    }\r\n\r\n\tdistanceToPoint(point: Vector3): number {\r\n\t\treturn this.normal.dot(point) + this.constant;\r\n\t}\r\n    \r\n    normalized(): PlaneBase {\r\n        const inverseNormalLength = 1.0 / this.normal.length();\r\n        this.normal.scale(inverseNormalLength);\r\n\t\tthis.constant *= inverseNormalLength;\r\n\t\treturn this;\r\n\t}\r\n\r\n    static intersection(a: Plane, b: Plane, c: Plane, result: Vector3): Vector3 {\r\n        const {normal: aNormal, constant: aConstant} = a;\r\n        const {normal: bNormal, constant: bConstant} = b;\r\n        const {normal: cNormal, constant: cConstant} = c;\r\n        result.copy(bNormal).cross(cNormal);\r\n        const f = -aNormal.dot(result);\r\n        const [v1x, v1y, v1z] = result.scale(aConstant).array;\r\n        result.copy(cNormal).cross(aNormal);\r\n        const [v2x, v2y, v2z] = result.scale(bConstant).array;\r\n        result.copy(aNormal).cross(bNormal);\r\n        const [v3x, v3y, v3z] = result.scale(cConstant).array;\r\n        result.setValues(\r\n          (v1x + v2x + v3x) / f,\r\n          (v1y + v2y + v3y) / f,\r\n          (v1z + v2z + v3z) / f\r\n        );\r\n        return result;\r\n    }\r\n}\r\n\r\nvar Plane: PlaneConstructor = PlaneBase;\r\nconst PlaneInjector: Injector<PlaneConstructor> = new Injector({\r\n\tdefaultCtor: PlaneBase,\r\n\tonDefaultOverride:\r\n\t\t(ctor: PlaneConstructor) => {\r\n\t\t\tPlane = ctor;\r\n\t\t}\r\n});","import { BoundingBox } from \"../../../core/rendering/scenes/geometries/bounding/BoundingBox\";\r\nimport { Matrix4 } from \"../../maths/algebra/matrices/Matrix4\";\r\nimport { Vector3 } from \"../../maths/algebra/vectors/Vector3\";\r\nimport { Plane } from \"../../maths/geometry/primitives/Plane\";\r\nimport { BoundingSphere } from \"./BoundingSphere\";\r\n\r\nexport { Frustum };\r\n\r\nconst tempVector = new Vector3();\r\n\r\ninterface Frustum {\r\n    readonly nearPlane: Plane;\r\n    readonly farPlane: Plane;\r\n    readonly topPlane: Plane;\r\n    readonly bottomPlane: Plane;\r\n    readonly leftPlane: Plane;\r\n    readonly rightPlane: Plane;\r\n    readonly extents: Vector3[];\r\n    copy(Frustum: Frustum): Frustum;\r\n\tclone(): Frustum;\r\n\tsetFromMatrix(matrix: Matrix4): Frustum;\r\n\tset(\r\n        nearPlane: Plane, farPlane: Plane,\r\n        topPlane: Plane, bottomPlane: Plane,\r\n        leftPlane: Plane, rightPlane: Plane\r\n    ): Frustum;\r\n\tintersectsSphere(sphere: BoundingSphere): boolean;\r\n\tintersectsBox(box: BoundingBox): boolean;\r\n\tcontainsPoint(point: Vector3): boolean;\r\n    getEdges(edges: Vector3[]): Vector3[];\r\n    getExtents(extents: Vector3[]): Vector3[];\r\n}\r\n\r\ninterface FrustumConstructor {\r\n    readonly prototype: Frustum;\r\n    new(): Frustum;\r\n}\r\n\r\nclass FrustumBase implements Frustum {\r\n    readonly nearPlane: Plane;\r\n    readonly farPlane: Plane;\r\n    readonly topPlane: Plane;\r\n    readonly bottomPlane: Plane;\r\n    readonly leftPlane: Plane;\r\n    readonly rightPlane: Plane;\r\n    readonly extents: Vector3[];\r\n\r\n    constructor() {\r\n\t\tthis.nearPlane = new Plane();\r\n        this.farPlane = new Plane();\r\n        this.topPlane = new Plane();\r\n        this.bottomPlane = new Plane();\r\n        this.leftPlane = new Plane();\r\n        this.rightPlane = new Plane();\r\n        this.extents = new Array(8).fill(0).map(_ => new Vector3());\r\n    }\r\n\r\n    set(\r\n        nearPlane: Plane, farPlane: Plane,\r\n        topPlane: Plane, bottomPlane: Plane,\r\n        leftPlane: Plane, rightPlane: Plane): Frustum {\r\n        const {nearPlane: _nearPlane, farPlane: _farPlane, bottomPlane: _bottomPlane, topPlane: _topPlane, leftPlane: _leftPlane, rightPlane: _rightPlane} = this;\r\n\t\t_nearPlane.copy(nearPlane);\r\n\t\t_farPlane.copy(farPlane);\r\n        _topPlane.copy(topPlane);\r\n        _bottomPlane.copy(bottomPlane);\r\n        _leftPlane.copy(leftPlane);\r\n        _rightPlane.copy(rightPlane);\r\n\t\treturn this;\r\n\t}\r\n\r\n    copy(Frustum: FrustumBase): Frustum {\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane} = Frustum;\r\n        this.set(\r\n            nearPlane,\r\n            farPlane,\r\n            topPlane,\r\n            bottomPlane,\r\n            leftPlane,\r\n            rightPlane\r\n        );\r\n        return this;\r\n    }\r\n\r\n\tclone(): Frustum {\r\n\t\treturn new FrustumBase().copy(this);\r\n    }\r\n    \r\n\tsetFromMatrix(matrix: Matrix4): Frustum {\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane, extents} = this;\r\n        const [m0, m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, m13, m14, m15] = matrix.array;\r\n        rightPlane.set(m3 - m0, m7 - m4, m11 - m8, m15 - m12).normalized();\r\n        leftPlane.set(m3 + m0, m7 + m4, m11 + m8, m15 + m12).normalized();\r\n        bottomPlane.set(m3 + m1, m7 + m5, m11 + m9, m15 + m13).normalized();\r\n        topPlane.set(m3 - m1, m7 - m5, m11 - m9, m15 - m13).normalized();\r\n        farPlane.set(m3 - m2, m7 - m6, m11 - m10, m15 - m14).normalized();\r\n        nearPlane.set(m3 + m2, m7 + m6, m11 + m10, m15 + m14).normalized();\r\n\r\n        Plane.intersection(leftPlane, bottomPlane, nearPlane, extents[0]);\r\n        Plane.intersection(leftPlane, topPlane, nearPlane, extents[1]);\r\n        Plane.intersection(rightPlane, bottomPlane, nearPlane, extents[2]);\r\n        Plane.intersection(rightPlane, topPlane, nearPlane, extents[3]);\r\n        Plane.intersection(leftPlane, bottomPlane, farPlane, extents[4]);\r\n        Plane.intersection(leftPlane, topPlane, farPlane, extents[5]);\r\n        Plane.intersection(rightPlane, bottomPlane, farPlane, extents[6]);\r\n        Plane.intersection(rightPlane, topPlane, farPlane, extents[7]);\r\n        \r\n\t\treturn this;\r\n    }\r\n    \r\n\tintersectsSphere(sphere: BoundingSphere): boolean {\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane} = this;\r\n        const {center, radius} = sphere;\r\n        return center.dot(nearPlane.normal) + nearPlane.constant + radius <= 0 ||\r\n            center.dot(farPlane.normal) + farPlane.constant + radius <= 0 ||\r\n            center.dot(bottomPlane.normal) + bottomPlane.constant + radius <= 0 ||\r\n            center.dot(topPlane.normal) + topPlane.constant + radius <= 0 ||\r\n            center.dot(leftPlane.normal) + leftPlane.constant + radius <= 0 ||\r\n            center.dot(rightPlane.normal) + rightPlane.constant + radius <= 0;\r\n\t}\r\n    \r\n\tintersectsBox(box: BoundingBox): boolean {\r\n        const {max: boxMax, min: boxMin} = box;\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane} = this;\r\n        let intersects = \r\n            nearPlane.distanceToPoint(tempVector.setValues(\r\n                nearPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                nearPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                nearPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            farPlane.distanceToPoint(tempVector.setValues(\r\n                farPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                farPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                farPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            bottomPlane.distanceToPoint(tempVector.setValues(\r\n                bottomPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                bottomPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                bottomPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            topPlane.distanceToPoint(tempVector.setValues(\r\n                topPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                topPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                topPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            leftPlane.distanceToPoint(tempVector.setValues(\r\n                leftPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                leftPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                leftPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0 &&\r\n            rightPlane.distanceToPoint(tempVector.setValues(\r\n                rightPlane.normal.x > 0 ? boxMax.x : boxMin.x,\r\n                rightPlane.normal.y > 0 ? boxMax.y : boxMin.y,\r\n                rightPlane.normal.z > 0 ? boxMax.z : boxMin.z\r\n            )) >= 0;\r\n\t\treturn intersects;\r\n\t}\r\n\r\n    getEdges(edges: Vector3[]): Vector3[] {\r\n        const {extents} = this;\r\n        const leftBottomNear = extents[0];\r\n        const leftTopNear = extents[1];\r\n        const rightBottomNear = extents[2];\r\n        const rightTopNear = extents[3];\r\n        const leftBottomFar = extents[4];\r\n        const leftTopFar = extents[5];\r\n        const rightBottomFar = extents[6];\r\n        const rightTopFar = extents[7];\r\n        edges[0].copy(leftTopFar).sub(leftTopNear);\r\n        edges[1].copy(rightTopFar).sub(rightTopNear);\r\n        edges[2].copy(leftBottomFar).sub(leftBottomNear);\r\n        edges[3].copy(rightBottomFar).sub(rightBottomNear);\r\n        edges[4].copy(rightTopFar).sub(leftTopFar);\r\n        edges[5].copy(rightTopNear).sub(rightBottomNear);\r\n        return edges;\r\n    }\r\n\r\n    getExtents(extents: Vector3[]): Vector3[] {\r\n        const {extents: _extents} = this;\r\n        extents[0].copy(_extents[0]);\r\n        extents[1].copy(_extents[1]);\r\n        extents[2].copy(_extents[2]);\r\n        extents[3].copy(_extents[3]);\r\n        extents[4].copy(_extents[4]);\r\n        extents[5].copy(_extents[5]);\r\n        extents[6].copy(_extents[6]);\r\n        extents[7].copy(_extents[7]);\r\n        return extents;\r\n    }\r\n\r\n\tcontainsPoint(point: Vector3): boolean {\r\n        const {nearPlane, farPlane, bottomPlane, topPlane, leftPlane, rightPlane} = this;\r\n        return nearPlane.distanceToPoint(point) >= 0 &&\r\n            farPlane.distanceToPoint(point) >= 0 &&\r\n            bottomPlane.distanceToPoint(point) >= 0 &&\r\n            topPlane.distanceToPoint(point) >= 0 &&\r\n            leftPlane.distanceToPoint(point) >= 0 &&\r\n            rightPlane.distanceToPoint(point) >= 0;\r\n    }\r\n}\r\n\r\nvar Frustum: FrustumConstructor = FrustumBase;","export { Buffer };\r\n\r\nexport enum BufferDataUsage {\r\n    STATIC_DRAW = 0x88E4,\r\n    DYNAMIC_DRAW = 0x88E8,\r\n    STREAM_DRAW = 0x88E0,\r\n    STATIC_READ = 0x88E5,\r\n    DYNAMIC_READ = 0x88E9,\r\n    STREAM_READ = 0x88E1,\r\n    STATIC_COPY = 0x88E6,\r\n    DYNAMIC_COPY = 0x88EA,\r\n    STREAM_COPY = 0x88E2\r\n}\r\n\r\nexport enum BufferTarget {\r\n    ARRAY_BUFFER = 0x8892,\r\n    ELEMENT_ARRAY_BUFFER = 0x8893,\r\n    TRANSFORM_FEEDBACK_BUFFER = 0x8C8E,\r\n    UNIFORM_BUFFER = 0x8A11,\r\n}\r\n\r\ntype Buffer = {\r\n    internalBuffer: WebGLBuffer;\r\n    target: BufferTarget;\r\n    usage: BufferDataUsage;\r\n    byteLength: number;\r\n}","import { BufferDataUsage, Buffer } from \"./WebGLBufferUtilities\";\r\nimport { Program, WebGLProgramUtilities } from \"./WebGLProgramUtilities\";\r\n\r\nexport { VertexAttributeValue };\r\nexport { VertexAttributeProperties };\r\nexport { VertexArrayProperties };\r\nexport { VertexArrayValues };\r\nexport { VertexArray };\r\nexport { WebGLVertexArrayUtilities };\r\n\r\nexport enum DrawMode {\r\n    POINTS = 0x0000,\r\n    LINES = 0x0001,\r\n    LINE_LOOP = 0x0002,\r\n    LINE_STRIP = 0x0003,\r\n    TRIANGLES = 0x0004,\r\n    TRIANGLE_STRIP = 0x0005,\r\n    TRIANGLE_FAN = 0x0006\r\n}\r\n\r\nexport enum DataComponentType {\r\n    BYTE = 0x1400,\r\n    UNSIGNED_BYTE = 0x1401,\r\n    SHORT = 0x1402,\r\n    UNSIGNED_SHORT = 0x1403,\r\n    INT = 0x1404,\r\n    UNSIGNED_INT = 0x1405,\r\n    FLOAT = 0x1406\r\n}\r\n\r\nexport enum AttributeDataType {\r\n    VEC2 = \"VEC2\",\r\n    VEC3 = \"VEC3\",\r\n    VEC4 = \"VEC4\",\r\n}\r\n\r\nexport enum ElementArrayDataType {\r\n    UNSIGNED_BYTE = 0x1401,\r\n    UNSIGNED_SHORT = 0x1403,\r\n    UNSIGNED_INT = 0x1405\r\n}\r\n\r\nexport type AttributeArray =\r\n    Float32Array | Int32Array | Uint32Array |\r\n    Int16Array | Uint16Array |\r\n    Int8Array | Uint8Array;\r\n\r\ntype VertexAttributeProperties = {\r\n    type: AttributeDataType;\r\n    array?: AttributeArray;\r\n    componentType?: DataComponentType;\r\n    byteLength?: number;\r\n    buffer?: number;\r\n    divisor?: number;\r\n    normalize?: boolean;\r\n    constant?: boolean;\r\n    srcOffset?: number;\r\n    srcLength?: number;\r\n}\r\n\r\ntype VertexAttributeValue = {\r\n    array: AttributeArray;\r\n    srcOffset?: number;\r\n    srcLength?: number;\r\n    constant?: boolean;\r\n}\r\n\r\ntype VertexAttribute = {\r\n    divisor: number;\r\n    componentType: DataComponentType;\r\n    numComponents: number;\r\n    constant: boolean;\r\n    constantValue?: AttributeArray;\r\n    byteOffset: number;\r\n    bytesPerElement: number;\r\n    type: AttributeDataType;\r\n    normalize: boolean;\r\n}\r\n\r\ntype VertexArrayProperties = {\r\n    vertexBuffers?: (VertexArrayBuffer | VertexArrayBufferProperties)[];\r\n    vertexAttributes?: Record<string, VertexAttributeProperties>;\r\n    elementBuffer?: VertexElementArrayBuffer | VertexElementArrayBufferProperties;\r\n    elementIndices?: Uint8Array | Uint16Array | Uint32Array;\r\n}\r\n\r\ntype VertexArrayValues = {\r\n    attributes: Record<string, VertexAttributeValue>;\r\n    drawMode?: DrawMode;\r\n    elementsCount?: number;\r\n    instanceCount?: number;\r\n}\r\n\r\ntype VertexArray = {\r\n    internalVertexArray: WebGLVertexArrayObject;\r\n    program: Program;\r\n    verticesBuffers: VertexArrayBuffer[];\r\n    elementBuffer?: VertexElementArrayBuffer;\r\n}\r\n\r\nexport type VertexArrayBuffer = Buffer & {\r\n    vertexAttributes: Record<string, VertexAttribute>;\r\n    byteLength: number;\r\n    byteStride: number;\r\n    interleaved: boolean;\r\n}\r\n\r\nexport type VertexArrayBufferProperties = {\r\n    usage?: BufferDataUsage;\r\n    interleaved?: boolean;\r\n}\r\n\r\nexport type VertexElementArrayBuffer = Buffer & {\r\n    indexType: ElementArrayDataType;\r\n};\r\n\r\nexport type VertexElementArrayBufferProperties = {\r\n    usage?: BufferDataUsage;\r\n}\r\n\r\nexport type VertexArrayBufferLayout = Record<string, {\r\n    byteOffset: number;\r\n    bytesPerElement: number;\r\n}>;\r\n\r\nclass WebGLVertexArrayUtilities {\r\n\r\n    static getDataTypeNumComponents(type: AttributeDataType): number {\r\n        switch (type) {\r\n            case AttributeDataType.VEC2:\r\n                return 2;\r\n            case AttributeDataType.VEC3:\r\n                return 3;\r\n            case AttributeDataType.VEC4:\r\n                return 4;\r\n        }\r\n    }\r\n\r\n    static getComponentTypeArrayConstructor(type: DataComponentType):\r\n        Float32ArrayConstructor | Int32ArrayConstructor | Uint32ArrayConstructor |\r\n        Int16ArrayConstructor | Uint16ArrayConstructor |\r\n        Int8ArrayConstructor | Uint8ArrayConstructor {\r\n        switch (type) {\r\n            case DataComponentType.FLOAT:\r\n                return Float32Array;\r\n            case DataComponentType.BYTE:\r\n                return Uint8Array;\r\n            case DataComponentType.UNSIGNED_BYTE:\r\n                return Uint8Array;\r\n            case DataComponentType.SHORT:\r\n                return Int16Array;\r\n            case DataComponentType.UNSIGNED_SHORT:\r\n                return Uint16Array;\r\n            case DataComponentType.INT:\r\n                return Int32Array;\r\n            case DataComponentType.UNSIGNED_INT:\r\n                return Uint32Array;\r\n        }\r\n    }\r\n\r\n    static getArrayComponentType(array: AttributeArray): DataComponentType {\r\n        if (array instanceof Float32Array) {\r\n            return DataComponentType.FLOAT;\r\n        }\r\n        else if (array instanceof Int32Array) {\r\n            return DataComponentType.INT;\r\n        }\r\n        else if (array instanceof Uint32Array) {\r\n            return DataComponentType.UNSIGNED_INT;\r\n        }\r\n        else if (array instanceof Int16Array) {\r\n            return DataComponentType.SHORT;\r\n        }\r\n        else if (array instanceof Uint16Array) {\r\n            return DataComponentType.UNSIGNED_SHORT;\r\n        }\r\n        else if (array instanceof Int8Array) {\r\n            return DataComponentType.BYTE;\r\n        }\r\n        else {\r\n            return DataComponentType.UNSIGNED_BYTE;\r\n        }\r\n    }\r\n\r\n    static createVertexElementArrayBuffer(gl: WebGL2RenderingContext, indices: Uint8Array | Uint16Array | Uint32Array): VertexElementArrayBuffer | null {\r\n        const internalBuffer = gl.createBuffer();\r\n        if (internalBuffer === null) {\r\n            return null;\r\n        }\r\n        const usage = BufferDataUsage.STATIC_READ;\r\n        const target = gl.ELEMENT_ARRAY_BUFFER;\r\n        const {byteLength} = indices;\r\n        const indexType = this.getElementArrayBufferType(indices);\r\n\r\n        gl.bindBuffer(target, internalBuffer);\r\n        gl.bufferData(target, indices, usage);\r\n\r\n        return {\r\n            internalBuffer,\r\n            target,\r\n            usage,\r\n            byteLength,\r\n            indexType\r\n        };\r\n    }\r\n    \r\n    static createVertexArrayBuffer(gl: WebGL2RenderingContext, program: Program, attributes: Record<string, VertexAttributeProperties>, usage?: BufferDataUsage, interleaved?: boolean): VertexArrayBuffer | null {\r\n        const {internalProgram} = program;\r\n\r\n        const DEFAULT_USAGE = BufferDataUsage.STATIC_READ;\r\n        const DEFAULT_INTERLEAVED = false;\r\n        interleaved = interleaved ?? DEFAULT_INTERLEAVED;\r\n        usage = usage ?? DEFAULT_USAGE;\r\n\r\n        const attributesEntries = attributes ? Object.entries(attributes) : null;\r\n        const byteLength = (attributesEntries !== null) ? attributesEntries.reduce(\r\n            (byteLength, [_, attribute]) => byteLength + (attribute.array?.byteLength ?? attribute.byteLength ?? 0), 0\r\n        ) : 0;\r\n        \r\n        const internalBuffer = gl.createBuffer();\r\n        if (internalBuffer === null) {\r\n            return null;\r\n        }\r\n\r\n        const target = gl.ARRAY_BUFFER;\r\n        gl.bindBuffer(target, internalBuffer);\r\n        const dataBuffer = new ArrayBuffer(byteLength);\r\n        let byteStride = 0;\r\n\r\n        const vertexAttributes: Record<string, VertexAttribute> = {};\r\n        if (attributesEntries !== null) {\r\n\r\n            attributesEntries.forEach(([_, attribute]) => {\r\n                const {array, componentType, byteLength} = attribute;\r\n                if (!array && !(componentType && byteLength)) {\r\n                    throw new Error(\"Every attribute requires either an array or a componentType and a byteLength\");\r\n                }\r\n            });\r\n\r\n            byteStride = interleaved ? attributesEntries.reduce(\r\n                (stride, [_, attribute]) => {\r\n                    const {constant} = attribute;\r\n                    if (!constant) {\r\n                        const {array, type, componentType} = attribute;\r\n                        const {BYTES_PER_ELEMENT} = array ?? this.getComponentTypeArrayConstructor(componentType!);\r\n                        const numComponents = this.getDataTypeNumComponents(type);\r\n                        return stride + BYTES_PER_ELEMENT * numComponents;\r\n                    }\r\n                    return stride;\r\n                }, 0\r\n            ) : 0;\r\n            const bufferSlices = interleaved ? Math.trunc(byteLength / byteStride) : 0;\r\n            let byteOffset = 0;\r\n            let constantValue: AttributeArray | undefined;\r\n    \r\n            attributesEntries.forEach(([attributeName, attribute]) => {\r\n                const {array, type} = attribute;\r\n                let {constant = false, divisor, normalize, componentType} = attribute;\r\n                componentType = array?this.getArrayComponentType(array) : componentType!;\r\n\r\n                const location = gl.getAttribLocation(internalProgram, attributeName);\r\n                if (location === -1) {\r\n                    console.warn(`Attribute ${attributeName} could not be located.`);\r\n                    return;\r\n                }\r\n\r\n                const numComponents = this.getDataTypeNumComponents(type);\r\n                divisor = divisor ?? 0;\r\n                normalize = normalize ?? false;\r\n                \r\n                gl.vertexAttribPointer(location, numComponents, componentType, normalize, byteStride, byteOffset);\r\n                if (divisor > 0) {\r\n                    gl.vertexAttribDivisor(location, divisor);\r\n                }\r\n                if (constant) {\r\n                    if (!array) {\r\n                        throw new Error(\"constant flag requires an array parameter\");\r\n                    }\r\n                    constantValue = array;\r\n                    switch (numComponents) {\r\n                        case 1:\r\n                            gl.vertexAttrib1fv(location, constantValue);\r\n                            break;\r\n                        case 2:\r\n                            gl.vertexAttrib2fv(location, constantValue);\r\n                            break;\r\n                        case 3:\r\n                            gl.vertexAttrib3fv(location, constantValue);\r\n                            break;\r\n                        case 4:\r\n                            gl.vertexAttrib4fv(location, constantValue);\r\n                            break;\r\n                    }\r\n                }\r\n                else {\r\n                    if (!constant) {\r\n                        const {array, type} = attribute;\r\n                        const numComponents = this.getDataTypeNumComponents(type);\r\n                        let byteLength = 0;\r\n                        let bytesPerElement = 0;\r\n                        if (interleaved) {\r\n                            if (array) {\r\n                                ({BYTES_PER_ELEMENT: bytesPerElement, byteLength} = array);\r\n                                const bufferArrayConstructor = this.getComponentTypeArrayConstructor(\r\n                                    this.getArrayComponentType(array)\r\n                                );\r\n                                const bufferArray = new bufferArrayConstructor(dataBuffer, byteOffset);\r\n                                const arrayStrideOffset = byteStride / bytesPerElement;\r\n                                for (let i = 0; i < bufferSlices; i++) {\r\n                                    let arraySliceIndex = i * numComponents;\r\n                                    bufferArray.set(\r\n                                        array.slice(\r\n                                            arraySliceIndex,\r\n                                            arraySliceIndex + numComponents\r\n                                        ),\r\n                                        i * arrayStrideOffset\r\n                                    );\r\n                                }\r\n                            }\r\n                            else {\r\n                                ({BYTES_PER_ELEMENT: bytesPerElement} = this.getComponentTypeArrayConstructor(componentType!));\r\n                                byteLength = attribute.byteLength!;\r\n                            }\r\n                        }\r\n                        else {\r\n                            if (array) {\r\n                                ({BYTES_PER_ELEMENT: bytesPerElement, byteLength} = array);\r\n                                const bufferArrayConstructor = WebGLVertexArrayUtilities.getComponentTypeArrayConstructor(\r\n                                    WebGLVertexArrayUtilities.getArrayComponentType(array)\r\n                                );\r\n                                const bufferArray = new bufferArrayConstructor(dataBuffer, byteOffset);\r\n                                bufferArray.set(array);\r\n                            }\r\n                            else {\r\n                                ({BYTES_PER_ELEMENT: bytesPerElement} = this.getComponentTypeArrayConstructor(componentType!));\r\n                                byteLength = attribute.byteLength!;\r\n                            }\r\n                        }\r\n                        vertexAttributes[attributeName] = {\r\n                            constantValue,\r\n                            numComponents,\r\n                            divisor,\r\n                            componentType,\r\n                            constant,\r\n                            byteOffset,\r\n                            bytesPerElement,\r\n                            type,\r\n                            normalize\r\n                        };\r\n                        byteOffset += interleaved ? bytesPerElement * numComponents : byteLength;\r\n                    }\r\n                    gl.enableVertexAttribArray(location);\r\n                }\r\n            });\r\n        }\r\n        gl.bufferData(target, dataBuffer, usage);\r\n        return {\r\n            internalBuffer,\r\n            target,\r\n            usage,\r\n            byteLength,\r\n            interleaved,\r\n            byteStride,\r\n            vertexAttributes\r\n        };\r\n    }\r\n\r\n    static setVertexArrayValues(gl: WebGL2RenderingContext, vertexArray: VertexArray, values: VertexArrayValues): void {\r\n        const {attributes, elementsCount} = values;\r\n        \r\n        const attributesRecords = Object.keys(attributes);\r\n        attributesRecords.forEach((attributeRecord) => {\r\n            const {verticesBuffers} = vertexArray;\r\n            const verticesBuffer = verticesBuffers.find(\r\n                (verticesBuffer) => attributeRecord in verticesBuffer.vertexAttributes\r\n            );\r\n            if (verticesBuffer) {\r\n                const {internalBuffer, target, byteStride, interleaved, vertexAttributes} = verticesBuffer;\r\n                const currentArrayBufferBinding = gl.getParameter(gl.ARRAY_BUFFER_BINDING);\r\n                if (currentArrayBufferBinding !== internalBuffer) {\r\n                    gl.bindBuffer(target, internalBuffer);\r\n                }\r\n                const attribute = attributes[attributeRecord];\r\n                const {byteOffset, numComponents} = vertexAttributes[attributeRecord];\r\n                let {array, srcOffset, srcLength} = attribute;\r\n                const {length} = array;\r\n                let dstOffset = byteOffset;\r\n                if (interleaved) {\r\n                    if (srcOffset || srcLength) {\r\n                        array = array.slice(srcOffset ?? 0, srcLength);\r\n                    }\r\n                    const slices = interleaved ? Math.trunc(length / numComponents) : 0;\r\n                    let sliceOffset = 0;\r\n                    for (let i = 0; i < slices; i++) {\r\n                        gl.bufferSubData(target, dstOffset, array, sliceOffset, numComponents);\r\n                        sliceOffset += numComponents;\r\n                        dstOffset += byteStride;\r\n                    }\r\n                }\r\n                else {\r\n                    srcOffset = srcOffset ?? 0;\r\n                    srcLength = srcLength ?? length;\r\n                    gl.bufferSubData(target, 0, array, srcOffset, srcLength);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    static setVertexArrayBufferData(gl: WebGL2RenderingContext, buffer: VertexArrayBuffer | VertexElementArrayBuffer, data: ArrayBufferView, dstByteOffset?: number, srcOffset?: number, length?: number): void {\r\n        const {internalBuffer, target} = buffer;\r\n        gl.bindBuffer(target, internalBuffer);\r\n        dstByteOffset = dstByteOffset ?? 0;\r\n        srcOffset = srcOffset ?? 0;\r\n        gl.bufferSubData(target, dstByteOffset, data, srcOffset, length);\r\n    }\r\n\r\n    static createVertexArray(gl: WebGL2RenderingContext, program: Program, vertexArray: VertexArrayProperties): VertexArray | null {\r\n        const {vertexAttributes, vertexBuffers, elementIndices, elementBuffer: elementBufferOrBufferProperties} = vertexArray;\r\n        \r\n        const internalVertexArray = gl.createVertexArray();\r\n        if (internalVertexArray === null) {\r\n            return null;\r\n        }\r\n        gl.bindVertexArray(internalVertexArray);\r\n\r\n        const attributesEntries = vertexAttributes ? Object.entries(vertexAttributes) : [];\r\n        \r\n        const {internalProgram} = program;\r\n        const verticesBuffers: VertexArray[\"verticesBuffers\"] = [];\r\n        if (vertexBuffers) {\r\n            vertexBuffers.forEach((buffer_i, i) => {\r\n                const attributes = Object.fromEntries(attributesEntries.filter(\r\n                    ([_, attribute_i]) => attribute_i.buffer == i \r\n                ));\r\n                let buffer: VertexArrayBuffer | null = null;\r\n                if (buffer_i !== undefined) {\r\n                    if (\"internalBuffer\" in buffer_i) {\r\n                        const {target, internalBuffer} = buffer_i;\r\n                        buffer = buffer_i;\r\n                        gl.bindBuffer(target, internalBuffer);\r\n                        const {byteStride, vertexAttributes} = buffer;\r\n                        Object.entries(vertexAttributes).forEach(([attributeName, setter]) => {\r\n                            const {numComponents, componentType, normalize, byteOffset, divisor, constant, constantValue} = setter;\r\n                            const location = gl.getAttribLocation(internalProgram, attributeName);\r\n                            if (location > -1) {\r\n                                gl.vertexAttribPointer(location, numComponents, componentType, normalize, byteStride, byteOffset);\r\n                                if (divisor > 0) {\r\n                                    gl.vertexAttribDivisor(location, divisor);\r\n                                }\r\n                                if (constant && constantValue) {\r\n                                    switch (numComponents) {\r\n                                        case 1:\r\n                                            gl.vertexAttrib1fv(location, constantValue);\r\n                                            break;\r\n                                        case 2:\r\n                                            gl.vertexAttrib2fv(location, constantValue);\r\n                                            break;\r\n                                        case 3:\r\n                                            gl.vertexAttrib3fv(location, constantValue);\r\n                                            break;\r\n                                        case 4:\r\n                                            gl.vertexAttrib4fv(location, constantValue);\r\n                                            break;\r\n                                    }\r\n                                }\r\n                                else {\r\n                                    gl.enableVertexAttribArray(location);\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    else if (attributes) {\r\n                        const {usage, interleaved} = buffer_i;\r\n                        buffer = this.createVertexArrayBuffer(gl, program, attributes, usage, interleaved);\r\n                    }\r\n                }\r\n                else if (attributes) {\r\n                    buffer = this.createVertexArrayBuffer(gl, program, attributes);\r\n                }\r\n                if (buffer === null) {\r\n                    return null;\r\n                }\r\n                verticesBuffers.push(buffer);\r\n            });\r\n        }\r\n        else if (vertexAttributes) {\r\n            let buffer: VertexArrayBuffer | null = null;\r\n            buffer = this.createVertexArrayBuffer(gl, program, vertexAttributes);\r\n            if (buffer === null) {\r\n                return null;\r\n            }\r\n            verticesBuffers.push(buffer);\r\n        }\r\n        \r\n        let elementBuffer: VertexElementArrayBuffer | null | undefined = undefined;\r\n        if (elementBufferOrBufferProperties !== undefined) {\r\n            if (\"internalBuffer\" in elementBufferOrBufferProperties) {\r\n                const {target, internalBuffer} = elementBufferOrBufferProperties;\r\n                elementBuffer = elementBufferOrBufferProperties;\r\n                gl.bindBuffer(target, internalBuffer);\r\n            }\r\n            else if (elementIndices) {\r\n                elementBuffer = this.createVertexElementArrayBuffer(gl, elementIndices);\r\n            }\r\n        }\r\n        else if (elementIndices) {\r\n            elementBuffer = this.createVertexElementArrayBuffer(gl, elementIndices);\r\n        }\r\n        if (elementBuffer === null) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            verticesBuffers,\r\n            elementBuffer,\r\n            program,\r\n            internalVertexArray\r\n        };\r\n    }\r\n\r\n    static deleteVertexArray(gl: WebGL2RenderingContext, vertexArray: VertexArray): void {\r\n        const {internalVertexArray} = vertexArray;\r\n        if (gl.isVertexArray(internalVertexArray)) {\r\n            gl.deleteVertexArray(internalVertexArray);\r\n        }\r\n    }\r\n\r\n    static getElementArrayBufferType(indices: Uint8Array | Uint16Array | Uint32Array): ElementArrayDataType {\r\n        if (indices instanceof Uint8Array) {\r\n            return ElementArrayDataType.UNSIGNED_BYTE;\r\n        }\r\n        else if (indices instanceof Uint16Array) {\r\n            return ElementArrayDataType.UNSIGNED_SHORT;\r\n        }\r\n        else {\r\n            return ElementArrayDataType.UNSIGNED_INT;\r\n        }\r\n    }\r\n}","import { AttributeArray, AttributeDataType, DataComponentType, WebGLVertexArrayUtilities } from \"../../webgl/WebGLVertexArrayUtilities\";\r\n\r\nexport { GeometryBuffer };\r\n\r\ninterface GeometryBufferConstructor {\r\n    readonly prototype: GeometryBuffer;\r\n    new(): GeometryBuffer;\r\n    new(\r\n        attributes: Record<string, GeometryBufferAttribute>,\r\n        indices?: Uint8Array | Uint16Array | Uint32Array,\r\n        interleaved?: boolean\r\n    ): GeometryBuffer;\r\n    fromBlob(blob: Blob): Promise<GeometryBuffer>;\r\n}\r\n\r\ninterface GeometryBuffer {\r\n    interleaved: boolean;\r\n    buffer: ArrayBuffer;\r\n    stride: number;\r\n    indices?: Uint8Array | Uint16Array | Uint32Array;\r\n    attributes: Record<string, {\r\n        type: AttributeDataType;\r\n        componentType: DataComponentType;\r\n        byteOffset: number;\r\n        byteLength: number;\r\n        constant?: boolean;\r\n        normalize?: boolean;\r\n    }>;\r\n    getAttribute(name: string): GeometryBufferAttribute | null;\r\n    toBlob(): Blob;\r\n}\r\n\r\ninterface GeometryBufferAttribute {\r\n    array: AttributeArray,\r\n    type: AttributeDataType;\r\n    constant?: boolean;\r\n    normalize?: boolean;\r\n}\r\n\r\nclass GeometryBufferBase implements GeometryBuffer {\r\n    buffer: ArrayBuffer;\r\n    attributes: Record<string, {\r\n        type: AttributeDataType;\r\n        componentType: DataComponentType;\r\n        byteOffset: number;\r\n        byteLength: number;\r\n        constant?: boolean;\r\n        normalize?: boolean;\r\n    }>;\r\n    indices?: Uint8Array | Uint16Array | Uint32Array;\r\n    interleaved: boolean;\r\n    stride: number;\r\n\r\n    constructor()\r\n    constructor(\r\n        attributes: Record<string, GeometryBufferAttribute>,\r\n        indices?: Uint8Array | Uint16Array | Uint32Array,\r\n        interleaved?: boolean\r\n    )\r\n    constructor(\r\n        attributes: Record<string, GeometryBufferAttribute> = {},\r\n        indices?: Uint8Array | Uint16Array | Uint32Array,\r\n        interleaved?: boolean\r\n    ) {\r\n        if (attributes) {\r\n            const attributesEntries = Object.entries(attributes);\r\n            const bufferByteLength = attributesEntries.reduce(\r\n                (byteLength, [_, attribute]) => byteLength + attribute.array.byteLength, 0\r\n            );\r\n            const buffer = new ArrayBuffer(bufferByteLength);\r\n            const stride = (interleaved) ? attributesEntries.reduce(\r\n                (stride, [_, attribute]) => {\r\n                    const {array, type} = attribute;\r\n                    return stride + array.BYTES_PER_ELEMENT * WebGLVertexArrayUtilities.getDataTypeNumComponents(type);\r\n                }, 0\r\n            ) : 0;\r\n            const bufferSlices = Math.trunc(bufferByteLength / stride);\r\n            \r\n            this.attributes = {};\r\n            this.indices = indices;\r\n            this.interleaved = interleaved ?? false;\r\n            this.stride = stride;\r\n            this.buffer = buffer;\r\n            \r\n            let byteOffset = 0;\r\n            if (interleaved) {\r\n                Object.entries(attributes).forEach(([name, attribute]) => {\r\n                    const {array, type, constant, normalize} = attribute;\r\n                    const componentType = WebGLVertexArrayUtilities.getArrayComponentType(array);\r\n                    const numComponents = WebGLVertexArrayUtilities.getDataTypeNumComponents(type);\r\n                    const bufferArrayConstructor = WebGLVertexArrayUtilities.getComponentTypeArrayConstructor(\r\n                        WebGLVertexArrayUtilities.getArrayComponentType(array)\r\n                    );\r\n                    const {byteLength, BYTES_PER_ELEMENT} = array;\r\n                    const bufferArray = new bufferArrayConstructor(buffer, byteOffset);\r\n                    const arrayStrideOffset = stride / BYTES_PER_ELEMENT;\r\n                    for (let i = 0; i < bufferSlices; i++) {\r\n                        let arraySliceIndex = i * numComponents;\r\n                        bufferArray.set(\r\n                            array.slice(\r\n                                arraySliceIndex,\r\n                                arraySliceIndex + numComponents\r\n                            ),\r\n                            i * arrayStrideOffset\r\n                        );\r\n                    }\r\n                    this.attributes[name] = {\r\n                        type,\r\n                        byteOffset,\r\n                        byteLength,\r\n                        componentType,\r\n                        constant,\r\n                        normalize\r\n                    };\r\n                    byteOffset += numComponents * BYTES_PER_ELEMENT;\r\n                });\r\n            }\r\n            else {\r\n                Object.entries(attributes).forEach(([name, attribute]) => {\r\n                    const {array, type} = attribute;\r\n                    const {byteLength} = array;\r\n                    const componentType = WebGLVertexArrayUtilities.getArrayComponentType(array);\r\n                    const bufferArrayConstructor = WebGLVertexArrayUtilities.getComponentTypeArrayConstructor(\r\n                        WebGLVertexArrayUtilities.getArrayComponentType(array)\r\n                    );\r\n                    const bufferArray = new bufferArrayConstructor(buffer, byteOffset);\r\n                    bufferArray.set(array);\r\n                    this.attributes[name] = {\r\n                        byteOffset,\r\n                        byteLength,\r\n                        type,\r\n                        componentType\r\n                    };\r\n                    byteOffset += byteLength;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this.attributes = {};\r\n            this.indices = undefined;\r\n            this.interleaved = false;\r\n            this.stride = 0;\r\n            this.buffer = new ArrayBuffer(0);\r\n        }\r\n    }\r\n\r\n    toBlob(): Blob {\r\n        const {attributes, buffer, stride, interleaved, indices} = this;\r\n        const bufferData = new Uint8Array(buffer);\r\n        const {length: bufferLength} = bufferData;\r\n        const indicesData = Uint8Array.from(indices ?? []);\r\n        const indicesLength = indices?.length ?? 0;\r\n        const headerData = new TextEncoder().encode(JSON.stringify({attributes, stride, interleaved}));\r\n        const {length: headerLength} = headerData;\r\n\r\n        const blobDataView = new Uint8Array(4 + headerLength + indicesLength + bufferLength);\r\n        const {buffer: blobDataViewBuffer} = blobDataView;\r\n        const blobDataHeaderView = new Uint16Array(blobDataViewBuffer, 0, 2);\r\n        const blobDataHeaderLength = blobDataHeaderView.length * (Uint16Array.BYTES_PER_ELEMENT / Uint8Array.BYTES_PER_ELEMENT);\r\n        blobDataHeaderView[0] = headerLength;\r\n        blobDataHeaderView[1] = indicesLength;\r\n        blobDataView.set(headerData, blobDataHeaderLength);\r\n        blobDataView.set(indicesData, blobDataHeaderLength + headerLength);\r\n        blobDataView.set(bufferData, blobDataHeaderLength + headerLength + indicesLength);\r\n\r\n        return new Blob([blobDataView], {type: \"application/octet-stream\"});\r\n    }\r\n\r\n    static async fromBlob(blob: Blob): Promise<GeometryBuffer> {\r\n        const arrayBuffer = await blob.arrayBuffer();\r\n        const blobDataHeaderView = new Uint16Array(arrayBuffer, 0, 2);\r\n        const {byteLength: blobDataHeaderByteLength} = blobDataHeaderView;\r\n        const headerLength = blobDataHeaderView[0];\r\n        const indicesLength = blobDataHeaderView[1];\r\n        const headerData = new Uint8Array(arrayBuffer, blobDataHeaderByteLength, headerLength);\r\n        const arrayConstructor = (indicesLength < Math.pow(2, 8)) ? Uint8Array : (indicesLength < Math.pow(2, 16)) ? Uint16Array : Uint32Array;\r\n        const indices = new arrayConstructor(arrayBuffer.slice(blobDataHeaderByteLength + headerLength * Uint8Array.BYTES_PER_ELEMENT, indicesLength * arrayConstructor.BYTES_PER_ELEMENT));\r\n        const buffer = arrayBuffer.slice(blobDataHeaderByteLength + (indicesLength + headerLength) * Uint8Array.BYTES_PER_ELEMENT);\r\n        const header = <Pick<GeometryBuffer, \"attributes\" | \"stride\" | \"interleaved\">>JSON.parse(new TextDecoder().decode(headerData));\r\n        const {attributes, interleaved, stride} = header;\r\n        const geometryBuffer = new GeometryBuffer();\r\n        geometryBuffer.buffer = buffer;\r\n        geometryBuffer.attributes = attributes;\r\n        geometryBuffer.interleaved = interleaved;\r\n        geometryBuffer.stride = stride;\r\n        geometryBuffer.indices = indices;\r\n        return geometryBuffer;\r\n    }\r\n\r\n    getAttribute(name: string): GeometryBufferAttribute | null {\r\n        const {attributes} = this;\r\n        const attribute = attributes[name];\r\n        if (attribute) {\r\n            const {buffer, interleaved, stride} = this;\r\n            const {type, byteOffset, byteLength, componentType} = attribute;\r\n            const attributeArrayConstructor = WebGLVertexArrayUtilities.getComponentTypeArrayConstructor(componentType);\r\n            const bytesPerElement = attributeArrayConstructor.BYTES_PER_ELEMENT;\r\n            const length = byteLength / bytesPerElement;\r\n            const numComponents = WebGLVertexArrayUtilities.getDataTypeNumComponents(type);\r\n            const {byteLength: bufferByteLength} = buffer;\r\n            const {BYTES_PER_ELEMENT} = attributeArrayConstructor;\r\n            const attributeArray = new attributeArrayConstructor(length);\r\n            if (interleaved) {\r\n                const bufferArray = new attributeArrayConstructor(buffer, byteOffset);\r\n                const bufferStride = stride;\r\n                const bufferSlices = Math.trunc(bufferByteLength / bufferStride);\r\n                const arrayStrideOffset = bufferStride / BYTES_PER_ELEMENT;\r\n                for (let i = 0; i < bufferSlices; i++) {\r\n                    let bufferArraySliceIndex = arrayStrideOffset * i;\r\n                    attributeArray.set(\r\n                        bufferArray.slice(\r\n                            bufferArraySliceIndex,\r\n                            bufferArraySliceIndex + numComponents\r\n                        ),\r\n                        numComponents * i\r\n                    );\r\n                }\r\n            }\r\n            else {\r\n                const bufferArray = new attributeArrayConstructor(buffer, byteOffset, length);\r\n                attributeArray.set(bufferArray);\r\n            }\r\n            return {\r\n                array: attributeArray,\r\n                type: type\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nvar GeometryBuffer: GeometryBufferConstructor = GeometryBufferBase;","\r\n\r\n// Vertices : counter clock-wise ordered\r\n\r\nimport { TriangleList } from \"../../../../libs/maths/extensions/lists/TriangleList\";\r\nimport { Vector2List } from \"../../../../libs/maths/extensions/lists/Vector2List\";\r\nimport { Vector3List } from \"../../../../libs/maths/extensions/lists/Vector3List\";\r\nimport { UUID, UUIDGenerator } from \"../../../../libs/maths/statistics/random/UUIDGenerator\";\r\nimport { BoundingBox } from \"../../../../libs/physics/collisions/AxisAlignedBoundingBox\";\r\nimport { BoundingSphere } from \"../../../../libs/physics/collisions/BoundingSphere\";\r\nimport { GeometryBuffer } from \"./GeometryBuffer\";\r\nimport { GeometryBuilder } from \"./GeometryBuilder\";\r\nimport { GeometryUtils } from \"./GeometryUtils\";\r\n\r\n// FaceIndices : 3 vertices indices\r\n// FaceArea : triangle.getArea()\r\n// FaceNormal : triangle.getNormal()\r\n// FaceUV / FaceColor ?\r\n\r\n// VertexNormal => Weighted (by area) average of the normals of the faces containing the vertex (=> Varying)\r\n// - Clone the vertex array, read the face indices array\r\n\r\n// VertexIndices\r\n\r\n// PerVertex Animation / MorphTargets\r\n\r\n// SkeletalAnimation\r\n\r\n// Bones are a hierarchical tree\r\n\r\n// bonesWeights\r\n// bonesIndices\r\n\r\n// MorphTarget Animation\r\n\r\n// MorphTargets are a copy of each face, being transformed over time\r\n\r\n// morphIndices\r\n// morphTargets = []; MorphTargets are a transformed copy of faces\r\n// morphNormals = [];\r\n\r\nexport { Geometry };\r\nexport { GeometryBase };\r\n\r\nenum GeometryAttributes {\r\n    VERTICES,\r\n    UVS,\r\n    NORMALS,\r\n    TANGENTS\r\n}\r\n\r\ninterface GeometryConstructor {\r\n    \r\n}\r\n\r\ninterface Geometry {\r\n\r\n}\r\n\r\nclass GeometryBase implements Geometry {\r\n\r\n    toBuilder(): GeometryBuilder {\r\n        throw new Error(\"No builder defined.\");\r\n    }\r\n}\r\n\r\nvar Geometry: GeometryConstructor = GeometryBase;","import { Matrix4 } from \"../../../../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Vector3 } from \"../../../../../libs/maths/algebra/vectors/Vector3\";\r\nimport { BoundingBox } from \"./BoundingBox\";\r\n\r\nexport class BoundingSphere {\r\n    center: Vector3;\r\n    radius: number;\r\n\r\n    constructor(\r\n        center: Vector3,\r\n        radius: number\r\n    ) {\r\n        this.center = center;\r\n        this.radius = radius;\r\n    }\r\n\r\n    transform(matrix: Matrix4): void {\r\n        const {center} = this;\r\n        matrix.transformPoint(center);\r\n    }\r\n    \r\n    containsPoint(point: Vector3): boolean {\r\n        const {center, radius} = this;\r\n        return center.distance(point) < radius;\r\n    }\r\n\r\n    hitsSphere(other: BoundingSphere) {\r\n        const {center, radius} = this;\r\n        const {center: otherCenter, radius: otherRadius} = other;\r\n        return center.distance(otherCenter) < radius + otherRadius;\r\n    }\r\n\r\n    hitsBox(other: BoundingBox) {\r\n        const {center, radius} = this;\r\n        const {x: sphereX, y: sphereY, z: sphereZ} = center;\r\n        const {min, max} = other;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        // get box closest point to sphere center by clamping\r\n        const x = Math.max(minX, Math.min(sphereX, maxX));\r\n        const y = Math.max(minY, Math.min(sphereY, maxY));\r\n        const z = Math.max(minZ, Math.min(sphereZ, maxZ));\r\n\r\n        // this is the same as isPointInsideSphere\r\n        const distance = Math.sqrt((x - sphereX) * (x - sphereX) + (y - sphereY) * (y - sphereY) + (z - sphereZ) * (z - sphereZ));\r\n        return distance < radius;\r\n    }\r\n}","import { Matrix4 } from \"../../../../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Vector3 } from \"../../../../../libs/maths/algebra/vectors/Vector3\";\r\n\r\nexport { BoundingBox };\r\n\r\nconst corners = new Array(8).fill(0).map(_ => new Vector3());\r\n\r\ninterface BoundingBoxConstructor {\r\n    prototype: BoundingBox;\r\n    new(\r\n        min: Vector3,\r\n        max: Vector3\r\n    ): BoundingBox;\r\n}\r\n\r\ninterface BoundingBox {\r\n    readonly min: Vector3;\r\n    readonly max: Vector3;\r\n    hits(other: BoundingBox): boolean;\r\n    transform(matrix: Matrix4): BoundingBox;\r\n    transformed(matrix: Matrix4): BoundingBox;\r\n    getExtents(extents: Vector3[]): Vector3[];\r\n    getEdges(edges: Vector3[]): Vector3[];\r\n}\r\n\r\nclass BoundingBoxBase {\r\n    readonly min: Vector3;\r\n    readonly max: Vector3;\r\n\r\n    constructor(\r\n        min: Vector3,\r\n        max: Vector3\r\n    ) {\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n\r\n    static fromBoxes(...boxes: BoundingBox[]) {\r\n        const positiveInfinity = Number.POSITIVE_INFINITY;\r\n        const negativeInfinity = Number.NEGATIVE_INFINITY;\r\n        let minX = positiveInfinity;\r\n        let minY = positiveInfinity;\r\n        let minZ = positiveInfinity;\r\n        let maxX = negativeInfinity;\r\n        let maxY = negativeInfinity;\r\n        let maxZ = negativeInfinity;\r\n        boxes.forEach((box_i) => {\r\n            const {min: boxMin, max: boxMax} = box_i;\r\n            const {x: boxMinX, y: boxMinY, z: boxMinZ} = boxMin;\r\n            const {x: boxMaxX, y: boxMaxY, z: boxMaxZ} = boxMax;\r\n            if (boxMinX < minX) minX = boxMinX;\r\n            else if (boxMaxX > maxX) maxX = boxMaxX;\r\n            if (boxMinY < minY) minY = boxMinY;\r\n            else if (boxMaxY > maxY) maxY = boxMaxY;\r\n            if (boxMinZ < minZ) minZ = boxMinZ;\r\n            else if (boxMaxZ > maxZ) maxZ = boxMaxZ;\r\n        });\r\n        return new BoundingBox(\r\n            new Vector3(minX, minY, minZ),\r\n            new Vector3(maxX, maxY, maxZ)\r\n        );\r\n    }\r\n\r\n    hits(other: BoundingBox): boolean {\r\n        const {min, max} = this;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        const {min: otherMin, max: otherMax} = other;\r\n        const {x: otherMinX, y: otherMinY, z: otherMinZ} = otherMin;\r\n        const {x: otherMaxX, y: otherMaxY, z: otherMaxZ} = otherMax;\r\n        return (minX <= otherMaxX && maxX >= otherMinX) &&\r\n            (minY <= otherMaxY && maxY >= otherMinY) &&\r\n            (minZ <= otherMaxZ && maxZ >= otherMinZ);\r\n    }\r\n\r\n    transform(matrix: Matrix4): BoundingBox {\r\n        const {min, max} = this;\r\n        let {x: minX, y: minY, z: minZ} = min;\r\n        let {x: maxX, y: maxY, z: maxZ} = max;\r\n        corners[0].setValues(minX, minY, minZ);\r\n        corners[1].setValues(minX, minY, maxZ);\r\n        corners[2].setValues(minX, maxY, minZ);\r\n        corners[3].setValues(maxX, minY, minZ);\r\n        corners[4].setValues(minX, maxY, maxZ);\r\n        corners[5].setValues(maxX, minY, maxZ);\r\n        corners[6].setValues(maxX, maxY, minZ);\r\n        corners[7].setValues(maxX, maxY, maxZ);\r\n        const {POSITIVE_INFINITY, NEGATIVE_INFINITY} = Number;\r\n        minX = minY = minZ = POSITIVE_INFINITY;\r\n        maxX = maxY = maxZ = NEGATIVE_INFINITY;\r\n        corners.forEach((corner_i) => {\r\n            matrix.transformPoint(corner_i);\r\n            const [x, y, z] = corner_i;\r\n            if (x < minX) minX = x;\r\n            else if (x > maxX) maxX = x;\r\n            if (y < minY) minY = y;\r\n            else if (y > maxY) maxY = y;\r\n            if (z < minZ) minZ = z;\r\n            else if (z > maxZ) maxZ = z;\r\n        });\r\n        min.setValues(minX, minY, minZ);\r\n        max.setValues(maxX, maxY, maxZ);\r\n        return this;\r\n    }\r\n\r\n    getEdges(edges: Vector3[]): Vector3[] {\r\n        const {min, max} = this;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        edges[0].setValues(maxX - minX, 0, 0);\r\n        edges[1].setValues(0, maxY - minY, 0);\r\n        edges[2].setValues(0, 0, maxZ - minZ);\r\n        return edges;\r\n    }\r\n\r\n    getExtents(extents: Vector3[]): Vector3[] {\r\n        const {min, max} = this;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        extents[0].setValues(minX, minY, minZ);\r\n        extents[1].setValues(minX, minY, maxZ);\r\n        extents[2].setValues(minX, maxY, minZ);\r\n        extents[3].setValues(maxX, minY, minZ);\r\n        extents[4].setValues(minX, maxY, maxZ);\r\n        extents[5].setValues(maxX, minY, maxZ);\r\n        extents[6].setValues(maxX, maxY, minZ);\r\n        extents[7].setValues(maxX, maxY, maxZ);\r\n        return extents;\r\n    }\r\n\r\n    transformed(matrix: Matrix4): BoundingBox {\r\n        const {min, max} = this;\r\n        const {x: minX, y: minY, z: minZ} = min;\r\n        const {x: maxX, y: maxY, z: maxZ} = max;\r\n        return new BoundingBox(\r\n            new Vector3(minX, minY, minZ),\r\n            new Vector3(maxX, maxY, maxZ)\r\n        ).transform(matrix);\r\n    }\r\n}\r\n\r\nvar BoundingBox: BoundingBoxConstructor = BoundingBoxBase;","\r\n\r\n// Vertices : counter clock-wise ordered\r\n\r\nimport { TriangleList } from \"../../../../libs/maths/extensions/lists/TriangleList\";\r\nimport { Vector2List } from \"../../../../libs/maths/extensions/lists/Vector2List\";\r\nimport { Vector3List } from \"../../../../libs/maths/extensions/lists/Vector3List\";\r\nimport { UUID, UUIDGenerator } from \"../../../../libs/maths/statistics/random/UUIDGenerator\";\r\nimport { BoundingBox } from \"../../../../libs/physics/collisions/AxisAlignedBoundingBox\";\r\nimport { BoundingSphere } from \"../../../../libs/physics/collisions/BoundingSphere\";\r\nimport { GeometryBuffer } from \"./GeometryBuffer\";\r\nimport { GeometryBuilder } from \"./GeometryBuilder\";\r\nimport { GeometryUtils } from \"./GeometryUtils\";\r\n\r\n// FaceIndices : 3 vertices indices\r\n// FaceArea : triangle.getArea()\r\n// FaceNormal : triangle.getNormal()\r\n// FaceUV / FaceColor ?\r\n\r\n// VertexNormal => Weighted (by area) average of the normals of the faces containing the vertex (=> Varying)\r\n// - Clone the vertex array, read the face indices array\r\n\r\n// VertexIndices\r\n\r\n// PerVertex Animation / MorphTargets\r\n\r\n// SkeletalAnimation\r\n\r\n// Bones are a hierarchical tree\r\n\r\n// bonesWeights\r\n// bonesIndices\r\n\r\n// MorphTarget Animation\r\n\r\n// MorphTargets are a copy of each face, being transformed over time\r\n\r\n// morphIndices\r\n// morphTargets = []; MorphTargets are a transformed copy of faces\r\n// morphNormals = [];\r\n\r\nexport { Geometry };\r\nexport { GeometryBase };\r\n\r\nenum GeometryAttributes {\r\n    VERTICES,\r\n    UVS,\r\n    NORMALS,\r\n    TANGENTS\r\n}\r\n\r\ninterface GeometryConstructor {\r\n    \r\n}\r\n\r\ninterface Geometry {\r\n\r\n}\r\n\r\nclass GeometryBase implements Geometry {\r\n\r\n    toBuilder(): GeometryBuilder {\r\n        throw new Error(\"No builder defined.\");\r\n    }\r\n}\r\n\r\nvar Geometry: GeometryConstructor = GeometryBase;","import { BufferMask } from \"./WebGLRendererUtilities\";\r\nimport { Texture, TextureMagFilter, TexturePixelFormat, TexturePixelType } from \"./WebGLTextureUtilities\";\r\n\r\nexport enum FramebufferStatus {\r\n    FRAMEBUFFER_COMPLETE = 0x8CD5,\r\n    FRAMEBUFFER_INCOMPLETE_ATTACHMENT = 0x8CD6,\r\n    FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT = 0x8CD7,\r\n    FRAMEBUFFER_INCOMPLETE_DIMENSIONS = 0x8CD9,\r\n    FRAMEBUFFER_UNSUPPORTED = 0x8CDD\r\n}\r\n\r\nexport enum FramebufferTextureTarget {\r\n    TEXTURE_2D = 0x0DE1,\r\n    TEXTURE_CUBE_MAP_POSITIVE_X = 0x8515,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_X = 0x8516,\r\n    TEXTURE_CUBE_MAP_POSITIVE_Y = 0x8517,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_Y = 0x8518,\r\n    TEXTURE_CUBE_MAP_POSITIVE_Z = 0x8519,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_Z = 0x851A\r\n}\r\n\r\nexport enum FramebufferAttachment {\r\n    COLOR_ATTACHMENT0 = 0x8CE0,\r\n    COLOR_ATTACHMENT1 = 0x8CE1,\r\n    COLOR_ATTACHMENT2 = 0x8CE2,\r\n    COLOR_ATTACHMENT3 = 0x8CE3,\r\n    COLOR_ATTACHMENT4 = 0x8CE4,\r\n    COLOR_ATTACHMENT5 = 0x8CE5,\r\n    COLOR_ATTACHMENT6 = 0x8CE6,\r\n    COLOR_ATTACHMENT7 = 0x8CE7,\r\n    COLOR_ATTACHMENT8 = 0x8CE8,\r\n    COLOR_ATTACHMENT9 = 0x8CE9,\r\n    COLOR_ATTACHMENT10 = 0x8CEA,\r\n    COLOR_ATTACHMENT11 = 0x8CEB,\r\n    COLOR_ATTACHMENT12 = 0x8CEC,\r\n    COLOR_ATTACHMENT13 = 0x8CED,\r\n    COLOR_ATTACHMENT14 = 0x8CEE,\r\n    COLOR_ATTACHMENT15 = 0x8CEF,\r\n    DEPTH_ATTACHMENT = 0x8D00,\r\n    STENCIL_ATTACHMENT = 0x8D20,\r\n    DEPTH_STENCIL_ATTACHMENT = 0x821A\r\n}\r\n\r\nexport enum RenderbufferPixelFormat {\r\n    R8 = 0x8229,\r\n    R8UI = 0x8232,\r\n    R8I = 0x8231,\r\n    R16UI = 0x8234,\r\n    R16I = 0x8233,\r\n    R32UI = 0x8236,\r\n    R32I = 0x8235,\r\n    RG8 = 0x822B,\r\n    RG8UI = 0x8238,\r\n    RG8I = 0x8237,\r\n    RG16UI = 0x823A,\r\n    RG16I = 0x8239,\r\n    RG32UI = 0x823C,\r\n    RG32I = 0x823B,\r\n    RGB8 = 0x8051,\r\n    RGBA8 = 0x8058,\r\n    SRGB8_ALPHA8 = 0x8C43,\r\n    RGBA4 = 0x8056,\r\n    RGB565 = 0x8D62,\r\n    RGB5_A1 = 0x8057,\r\n    RGB10_A2 = 0x8059,\r\n    RGBA8UI = 0x8D7C,\r\n    RGBA8I = 0x8D8E,\r\n    RGB10_A2UI = 0x906F,\r\n    RGBA16UI = 0x8D76,\r\n    RGBA16I = 0x8D88,\r\n    RGBA32I = 0x8D82,\r\n    RGBA32UI = 0x8D70,\r\n    DEPTH_COMPONENT16 = 0x81A5,\r\n    DEPTH_COMPONENT24 = 0x81A6,\r\n    DEPTH_COMPONENT32F = 0x8CAC,\r\n    DEPTH24_STENCIL8 = 0x88F0,\r\n    DEPTH32F_STENCIL8 = 0x8CAD,\r\n    STENCIL_INDEX8 = 0x8D48\r\n}\r\n\r\nexport enum DrawBuffer {\r\n    NONE = 0x0000,\r\n    BACK = 0x0405,\r\n    COLOR_ATTACHMENT0 = 0x8CE0,\r\n    COLOR_ATTACHMENT1 = 0x8CE1,\r\n    COLOR_ATTACHMENT2 = 0x8CE2,\r\n    COLOR_ATTACHMENT3 = 0x8CE3,\r\n    COLOR_ATTACHMENT4 = 0x8CE4,\r\n    COLOR_ATTACHMENT5 = 0x8CE5,\r\n    COLOR_ATTACHMENT6 = 0x8CE6,\r\n    COLOR_ATTACHMENT7 = 0x8CE7,\r\n    COLOR_ATTACHMENT8 = 0x8CE8,\r\n    COLOR_ATTACHMENT9 = 0x8CE9,\r\n    COLOR_ATTACHMENT10 = 0x8CEA,\r\n    COLOR_ATTACHMENT11 = 0x8CEB,\r\n    COLOR_ATTACHMENT12 = 0x8CEC,\r\n    COLOR_ATTACHMENT13 = 0x8CED,\r\n    COLOR_ATTACHMENT14 = 0x8CEE,\r\n    COLOR_ATTACHMENT15 = 0x8CEF,\r\n\r\n}\r\nexport type Renderbuffer = {\r\n    internalRenderbuffer: WebGLRenderbuffer;\r\n}\r\n\r\nexport type RenderbufferProperties = {\r\n    internalFormat: RenderbufferPixelFormat;\r\n    width: number;\r\n    height: number;\r\n    samples?: number;\r\n}\r\n\r\ntype Framebuffer = {\r\n    internalFramebuffer: WebGLFramebuffer;\r\n};\r\n\r\ntype FramebufferTextureAttachmentProperties = {\r\n    attachment: FramebufferAttachment;\r\n    textureTarget: FramebufferTextureTarget;\r\n    texture: Texture;\r\n}\r\n\r\ntype FramebufferTextureAttachment = FramebufferTextureAttachmentProperties & Framebuffer;\r\n\r\ntype FramebufferRenderbufferAttachmentProperties = {\r\n    attachment: FramebufferAttachment;\r\n    renderbuffer: Renderbuffer;\r\n}\r\n\r\ntype FramebufferRenderbufferAttachment = FramebufferRenderbufferAttachmentProperties & Framebuffer;\r\n\r\nexport class WebGLFramebufferUtilities {\r\n\r\n    static createFramebuffer(gl: WebGL2RenderingContext): Framebuffer | null {\r\n        const internalFramebuffer = gl.createFramebuffer();\r\n    \r\n        if (internalFramebuffer === null) {\r\n            return null;\r\n        }\r\n        \r\n        return {\r\n            internalFramebuffer\r\n        };\r\n    }\r\n\r\n    static createRenderbuffer(gl: WebGL2RenderingContext, properties: RenderbufferProperties): Renderbuffer | null {\r\n        const internalRenderbuffer = gl.createRenderbuffer();\r\n        if (internalRenderbuffer === null) {\r\n            return null;\r\n        }\r\n\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, internalRenderbuffer);\r\n        \r\n        const {samples, internalFormat, width, height} = properties;\r\n        if (typeof samples !== \"undefined\") {\r\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, samples, internalFormat, width, height);\r\n        }\r\n        else {\r\n            gl.renderbufferStorage(gl.RENDERBUFFER, internalFormat, width, height);\r\n        }\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n\r\n        return {\r\n            ...properties,\r\n            internalRenderbuffer\r\n        };\r\n    }\r\n\r\n    static attachTexture(gl: WebGL2RenderingContext, framebuffer: Framebuffer, ...properties: FramebufferTextureAttachmentProperties[]): FramebufferTextureAttachment[] {\r\n        const {internalFramebuffer} = framebuffer;\r\n        const currentFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING);\r\n        if (currentFramebuffer !== internalFramebuffer) {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, internalFramebuffer);\r\n        }\r\n        \r\n        const attachments = properties.map((properties) => {\r\n            const {attachment, textureTarget, texture} = properties;\r\n            const {internalTexture} = texture;\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, textureTarget, internalTexture, 0);\r\n            return {\r\n                ...properties,\r\n                ...framebuffer\r\n            };\r\n        });\r\n\r\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n        if (status !== FramebufferStatus.FRAMEBUFFER_COMPLETE) {\r\n            console.warn(`Incomplete framebuffer status: ${FramebufferStatus[status]}`);\r\n        }\r\n\r\n        this.unbindFramebuffer(gl);\r\n\r\n        return attachments;\r\n    }\r\n\r\n    static drawBuffers(gl: WebGL2RenderingContext, framebuffer: Framebuffer, drawBuffers: DrawBuffer[]): void {\r\n        const {internalFramebuffer} = framebuffer;\r\n        const currentFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING);\r\n        if (currentFramebuffer !== internalFramebuffer) {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, internalFramebuffer);\r\n        }\r\n        \r\n        gl.drawBuffers(drawBuffers);\r\n\r\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n        if (status !== FramebufferStatus.FRAMEBUFFER_COMPLETE) {\r\n            console.warn(`Incomplete framebuffer status: ${FramebufferStatus[status]}`);\r\n        }\r\n\r\n        this.unbindFramebuffer(gl);\r\n    }\r\n\r\n    static attachRenderbuffer(gl: WebGL2RenderingContext, framebuffer: Framebuffer, ...props: FramebufferRenderbufferAttachmentProperties[]): FramebufferRenderbufferAttachment[] {\r\n        const {internalFramebuffer} = framebuffer;\r\n        const currentFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING);\r\n        if (currentFramebuffer !== internalFramebuffer) {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, internalFramebuffer);\r\n        }\r\n\r\n        const attachments = props.map((props) => {\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, props.attachment, gl.RENDERBUFFER, props.renderbuffer.internalRenderbuffer);\r\n            return {\r\n                ...props,\r\n                ...framebuffer\r\n            };\r\n        });\r\n\r\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n        if (status !== FramebufferStatus.FRAMEBUFFER_COMPLETE) {\r\n            console.warn(`Incomplete framebuffer status: ${FramebufferStatus[status]}`);\r\n        }\r\n\r\n        this.unbindFramebuffer(gl);\r\n\r\n        return attachments;\r\n    }\r\n\r\n    static blit(gl: WebGL2RenderingContext, readFramebuffer: Framebuffer | null, drawFramebuffer: Framebuffer | null, readRectangle: number[], drawRectangle: number[], mask: BufferMask, filter: TextureMagFilter): void {\r\n        const currentReadFramebuffer = gl.getParameter(gl.READ_FRAMEBUFFER_BINDING);\r\n        if (currentReadFramebuffer !== readFramebuffer) {\r\n            const internalReadFramebuffer = readFramebuffer?.internalFramebuffer ?? null;\r\n            gl.bindFramebuffer(gl.READ_FRAMEBUFFER, internalReadFramebuffer);\r\n        }\r\n        \r\n        const currentDrawFramebuffer = gl.getParameter(gl.DRAW_FRAMEBUFFER_BINDING);\r\n        if (currentDrawFramebuffer !== drawFramebuffer) {\r\n            const internalDrawFramebuffer = drawFramebuffer?.internalFramebuffer ?? null;\r\n            gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, internalDrawFramebuffer);\r\n        }\r\n        \r\n        gl.blitFramebuffer(readRectangle[0], readRectangle[1], readRectangle[2], readRectangle[3], drawRectangle[0], drawRectangle[1], drawRectangle[2], drawRectangle[3], mask, filter);\r\n\r\n        this.unbindFramebuffer(gl);\r\n    }\r\n\r\n    static readPixels(gl: WebGL2RenderingContext, x: number, y: number, width: number, height: number, format: TexturePixelFormat, type: TexturePixelType, pixels: ArrayBufferView): void {\r\n        gl.readPixels(x, y, width, height, format, type, pixels);\r\n    }\r\n\r\n    static bindFramebuffer(gl: WebGL2RenderingContext, framebuffer: Framebuffer): void {\r\n        const {internalFramebuffer} = framebuffer;\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, internalFramebuffer);\r\n    }\r\n\r\n    static unbindFramebuffer(gl: WebGL2RenderingContext): void {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n    static deleteFramebuffer(gl: WebGL2RenderingContext, framebuffer: Framebuffer): void {\r\n        const {internalFramebuffer} = framebuffer;\r\n        if (gl.isFramebuffer(internalFramebuffer)) {\r\n            gl.deleteFramebuffer(internalFramebuffer);\r\n        }\r\n    }\r\n\r\n    static deleteRenderbuffer(gl: WebGL2RenderingContext, renderbuffer: Renderbuffer): void {\r\n        const {internalRenderbuffer} = renderbuffer;\r\n        if (gl.isRenderbuffer(internalRenderbuffer)) {\r\n            gl.deleteRenderbuffer(internalRenderbuffer);\r\n        }\r\n    }\r\n}","import { Vector3 } from \"../../../../libs/maths/algebra/vectors/Vector3\"\r\nimport { BoundingSphere } from \"./bounding/BoundingSphere\";\r\nimport { BoundingBox } from \"./bounding/BoundingBox\";\r\n\r\nexport { GeometryBuilder };\r\n\r\ninterface GeometryBuilder {\r\n    readonly halfEdges: Array<HalfEdge>;\r\n    readonly vertices: Array<Vertex>;\r\n    readonly faces: Array<Face>;\r\n    clone(): GeometryBuilder;\r\n    addTriangleFace(v0: VertexID, v1: VertexID, v2: VertexID, properties?: {[key: string]: any;}): void;\r\n    addQuadFace(v0: VertexID, v1: VertexID, v2: VertexID, v3: VertexID, properties?: {[key: string]: any;}): void;\r\n    addVertex(vertex: number[] | Float32Array | Float64Array): VertexID;\r\n    addFace(vertices: VertexID[], properties?: {[key: string]: any;}[]): void;\r\n    verticesArray(): Float32Array;\r\n    uvsArray(): Float32Array;\r\n    trianglesIndicesArray(): Uint8Array | Uint16Array | Uint32Array;\r\n    linesIndicesArray(): Uint8Array | Uint16Array | Uint32Array;\r\n    normalsArray(): Float32Array;\r\n    tangentsArray(): Float32Array;\r\n    boundingBox(): BoundingBox;\r\n    faceHalfEdgesIterator(face: FaceID): FaceHalfEdgesIterator;\r\n    faceVerticesIterator(face: FaceID): FaceHalfEdgesIterator;\r\n    vertexFacesIterator(vertex: VertexID): VertexFacesIterator;\r\n}\r\n\r\ninterface GeometryBuilderConstructor {\r\n    readonly prototype: GeometryBuilder;\r\n    new(): GeometryBuilder;\r\n}\r\n\r\nclass GeometryBuilderBase implements GeometryBuilder {\r\n    readonly halfEdges: Array<HalfEdge>;\r\n    readonly vertices: Array<Vertex>;\r\n    readonly faces: Array<Face>;\r\n\r\n    constructor() {\r\n        this.halfEdges = [];\r\n        this.vertices = [];\r\n        this.faces = [];\r\n    }\r\n\r\n    clone(): GeometryBuilder {\r\n        return Object.assign(Object.create(this.constructor.prototype), structuredClone(this));\r\n    }\r\n\r\n    addTriangleFace(v0: VertexID, v1: VertexID, v2: VertexID, properties?: {[key: string]: any;}): void {\r\n        this.addFace([v0, v1, v2], properties);\r\n    }\r\n\r\n    addQuadFace(v0: VertexID, v1: VertexID, v2: VertexID, v3: VertexID, properties?: {[key: string]: any;}): void {\r\n        this.addFace([v0, v1, v2, v3], properties);\r\n    }\r\n    \r\n    addVertex(position: number[] | Float32Array | Float64Array): VertexID {\r\n        const {vertices} = this;\r\n        const vertex: Vertex = {\r\n            position: position,\r\n            halfEdgeID: null\r\n        };\r\n        return vertices.push(vertex) - 1;\r\n    }\r\n\r\n    addFace(vertices: VertexID[], properties?: {[key: string]: any;}): void {\r\n        const {halfEdges: _halfEdges, vertices: _vertices, faces: _faces} = this;\r\n        const {length: faceVerticesCount} = vertices;\r\n        if (faceVerticesCount < 2) {\r\n            console.error(`At least 2 vertices are required to create a face.`);\r\n            return;\r\n        }\r\n        const face: Face = {\r\n            halfEdgeID: null,\r\n            ...properties\r\n        };\r\n        const faceID = _faces.length;\r\n        let sourceID: VertexID | null = null;\r\n        let targetID: VertexID | null = null;\r\n        let firstHalfEdgeID: HalfEdgeID | null = null;\r\n        let halfEdge: HalfEdge | null = null;\r\n        let halfEdgeID: HalfEdgeID | null = null;\r\n        let previousHalfEdgeID: HalfEdgeID | null = null;\r\n        for (let i = 0; i < faceVerticesCount; i++) {\r\n            sourceID = vertices[i];\r\n            targetID = (i < faceVerticesCount - 1) ? vertices[i + 1] : vertices[0];\r\n            const existingHalfEdge = Array.from(this.vertexFacesIterator(sourceID)).find(\r\n                (face_i) => {\r\n                    if (face_i === null) return false;\r\n                    return Array.from(this.faceHalfEdgesIterator(face_i)).find(\r\n                        (halfEdge_i) => {\r\n                            const {targetID: targetID_i, prevID: prevID_i} = _halfEdges[halfEdge_i];\r\n                            return targetID_i === targetID && _halfEdges[prevID_i ?? -1]?.targetID === sourceID;\r\n                        }\r\n                    );\r\n                }\r\n            );\r\n            if (existingHalfEdge) {\r\n                continue;\r\n            }\r\n            halfEdge = {\r\n                targetID: targetID,\r\n                twinID: null,\r\n                nextID: null,\r\n                prevID: null,\r\n                faceID: faceID\r\n            };\r\n            halfEdgeID = _halfEdges.length;\r\n            if (previousHalfEdgeID === null) {\r\n                face.halfEdge = halfEdgeID;\r\n                firstHalfEdgeID = halfEdgeID;\r\n            }\r\n            else {\r\n                halfEdge.prevID = previousHalfEdgeID;\r\n                _halfEdges[previousHalfEdgeID].nextID = halfEdgeID;\r\n            }\r\n            const source = _vertices[sourceID]!;\r\n            if (source.halfEdgeID === null) {\r\n                source.halfEdgeID = halfEdgeID;\r\n            }\r\n            const twinHalfEdge = _halfEdges.find(\r\n                (halfEdge_i) => {\r\n                    const {targetID: targetID_i, prevID: prevID_i} = halfEdge_i;\r\n                    return targetID_i === sourceID && _halfEdges[prevID_i ?? -1]?.targetID === targetID;\r\n                }\r\n            ) ?? null;\r\n            if (twinHalfEdge !== null) {\r\n                halfEdge.twinID = _halfEdges.indexOf(twinHalfEdge);\r\n                twinHalfEdge.twinID = halfEdgeID;\r\n            }\r\n            previousHalfEdgeID = halfEdgeID;\r\n            _halfEdges.push(halfEdge);\r\n        }\r\n        if (halfEdge !== null && firstHalfEdgeID !== null) {\r\n            _halfEdges[firstHalfEdgeID].prevID = halfEdgeID;\r\n            halfEdge.nextID = firstHalfEdgeID;\r\n        }\r\n        _faces.push(face);\r\n    }\r\n\r\n    linesArray(): Float32Array {\r\n        const {faces, vertices} = this;\r\n        return new Float32Array(faces.flatMap((_, i) => {\r\n            const faceVertices = Array.from(this.faceVerticesIterator(i));\r\n            if (faceVertices.length === 4) {\r\n                const [v0, v1, v2, v3] = faceVertices.map(vertex_i => vertices[vertex_i].position);\r\n                return [\r\n                    ...v0, ...v1,\r\n                    ...v1, ...v2,\r\n                    ...v2, ...v3,\r\n                    ...v3, ...v0\r\n                ];\r\n            }\r\n            else {\r\n                const [v0, v1, v2] = faceVertices.map(vertex_i => vertices[vertex_i].position);\r\n                return [\r\n                    ...v0, ...v1,\r\n                    ...v1, ...v2,\r\n                    ...v2, ...v0\r\n                ];\r\n            }\r\n        }));\r\n    }\r\n\r\n    verticesArray(): Float32Array {\r\n        const {faces, vertices} = this;\r\n        return new Float32Array(faces.flatMap((_, i) => {\r\n            return Array.from(this.faceVerticesIterator(i)).flatMap((vertex) => {\r\n                return Array.from(vertices[vertex].position);\r\n            });\r\n        }));\r\n    }\r\n\r\n    tangentsArray(): Float32Array {\r\n        const {faces, vertices} = this;\r\n        return new Float32Array(faces.flatMap((face_i, i) => {\r\n            const faceVertices = Array.from(this.faceVerticesIterator(i));\r\n            const faceUvs = face_i.uv as Array<Array<number>>;\r\n            const [v0, v1, v2] = faceVertices.map(vertex_i => vertices[vertex_i].position);\r\n            const [uv0, uv1, uv2] = faceUvs;\r\n            const edge1 = v1.map((v1_i, i) => v0[i] - v1_i);\r\n            const edge2 = v1.map((v1_i, i) => v2[i] - v1_i);\r\n            const deltaUV1 = uv1.map((uv1_i, i) => uv0[i] - uv1_i);\r\n            const deltaUV2 = uv1.map((uv1_i, i) => uv2[i] - uv1_i);\r\n            const f = 1.0 / (deltaUV1[0] * deltaUV2[1] - deltaUV1[1] * deltaUV2[0]);\r\n            const tangent = edge1.map((edge1_i, i) => -(edge1_i * deltaUV2[1] - edge2[i] * deltaUV1[1]) * f);\r\n            const length = Math.hypot(...tangent);\r\n            face_i.tangent = tangent.map(tangent_i => tangent_i / length);\r\n\r\n            return faceVertices.flatMap(() => {\r\n                return Array.from(face_i.tangent);\r\n            });\r\n        }));\r\n    }\r\n\r\n    normalsArray(): Float32Array {\r\n        const {faces, vertices} = this;\r\n        return new Float32Array(faces.flatMap((face_i, i) => {\r\n            const faceVertices = Array.from(this.faceVerticesIterator(i));\r\n            const [v0, v1, v2] = faceVertices.map(vertex_i => vertices[vertex_i].position);\r\n            const edge1 = v1.map((v1_i, i) => v0[i] - v1_i);\r\n            const edge2 = v1.map((v1_i, i) => v2[i] - v1_i);\r\n            const normal = edge1.map((_, i) => {\r\n                const ni = (i + 1) % 3;\r\n                const pi = ((i - 1) + 3) % 3;\r\n                return -(edge1[ni] * edge2[pi] - edge1[pi] * edge2[ni]);\r\n            });\r\n            const length = Math.hypot(...normal);\r\n            face_i.normal = normal.map(normal_i => normal_i / length);\r\n            \r\n            return faceVertices.flatMap(() => {\r\n                return Array.from(face_i.normal);\r\n            });\r\n        }));\r\n    }\r\n\r\n    uvsArray(): Float32Array {\r\n        const {faces} = this;\r\n        return new Float32Array(faces.flatMap((face) => {\r\n            return face.uv.flat(1);\r\n        }));\r\n    }\r\n\r\n    trianglesIndicesArray(): Uint8Array | Uint16Array | Uint32Array {\r\n        const {faces} = this;\r\n        const count = faces.reduce((verticesCount, _, i) => {\r\n            return verticesCount + Array.from(this.faceVerticesIterator(i)).length;\r\n        }, 0);\r\n        const arrayConstructor = (count < Math.pow(2, 8)) ? Uint8Array : (count < Math.pow(2, 16)) ? Uint16Array : Uint32Array;\r\n        return new arrayConstructor(faces.reduce(([indices, index], face_i, i) => {\r\n            const vertices = Array.from(this.faceVerticesIterator(i));\r\n            if (vertices.length === 4) {\r\n                return [indices.concat([index, index + 1, index + 2, index + 1, index + 3, index + 2]), index + 4] as [number[], number];\r\n            }\r\n            return [indices.concat([index, index + 1, index + 2]), index + 3] as [number[], number];\r\n        }, [[], 0] as [number[], number])[0]);\r\n    }\r\n\r\n    linesIndicesArray(): Uint8Array | Uint16Array | Uint32Array {\r\n        const {faces} = this;\r\n        const count = faces.reduce((verticesCount, _, i) => {\r\n            return verticesCount + Array.from(this.faceVerticesIterator(i)).length * 2;\r\n        }, 0);\r\n        const arrayConstructor = (count < Math.pow(2, 8)) ? Uint8Array : (count < Math.pow(2, 16)) ? Uint16Array : Uint32Array;\r\n        return new arrayConstructor(faces.reduce(([indices, index], face_i, i) => {\r\n            const vertices = Array.from(this.faceVerticesIterator(i));\r\n            if (vertices.length === 4) {\r\n                return [indices.concat([index, index + 1, index + 1, index + 3, index + 3, index + 2, index + 2, index]), index + 4] as [number[], number];\r\n            }\r\n            return [indices.concat([index, index + 1, index + 1, index + 2, index + 2, index]), index + 3] as [number[], number];\r\n        }, [[], 0] as [number[], number])[0]);\r\n    }\r\n\r\n    boundingBox(): BoundingBox {\r\n        const positiveInfinity = Number.POSITIVE_INFINITY;\r\n        const negativeInfinity = Number.NEGATIVE_INFINITY;\r\n        let minX = positiveInfinity;\r\n        let minY = positiveInfinity;\r\n        let minZ = positiveInfinity;\r\n        let maxX = negativeInfinity;\r\n        let maxY = negativeInfinity;\r\n        let maxZ = negativeInfinity;\r\n        const {vertices} = this;\r\n        if (vertices.length > 0) {\r\n            vertices.forEach((vertex_i) => {\r\n                const [x, y, z] = vertex_i.position;\r\n                if (x < minX) minX = x;\r\n                else if (x > maxX) maxX = x;\r\n                if (y < minY) minY = y;\r\n                else if (y > maxY) maxY = y;\r\n                if (z < minZ) minZ = z;\r\n                else if (z > maxZ) maxZ = z;\r\n            });\r\n        }\r\n        const min = new Vector3([minX, minY, minZ]);\r\n        const max = new Vector3([maxX, maxY, maxZ]);\r\n        return new BoundingBox(min, max);\r\n    }\r\n\r\n    boundingSphere(): BoundingSphere {\r\n        const positiveInfinity = Number.POSITIVE_INFINITY;\r\n        const negativeInfinity = Number.NEGATIVE_INFINITY;\r\n        let minX = positiveInfinity;\r\n        let minY = positiveInfinity;\r\n        let minZ = positiveInfinity;\r\n        let maxX = negativeInfinity;\r\n        let maxY = negativeInfinity;\r\n        let maxZ = negativeInfinity;\r\n        const {vertices} = this;\r\n        if (vertices.length > 0) {\r\n            vertices.forEach((vertex_i) => {\r\n                const [x, y, z] = vertex_i.position;\r\n                if (x < minX) minX = x;\r\n                else if (x > maxX) maxX = x;\r\n                if (y < minY) minY = y;\r\n                else if (y > maxY) maxY = y;\r\n                if (z < minZ) minZ = z;\r\n                else if (z > maxZ) maxZ = z;\r\n            });\r\n        }\r\n        const min = new Vector3([minX, minY, minZ]);\r\n        const max = new Vector3([maxX, maxY, maxZ]);\r\n        return new BoundingSphere(\r\n            new Vector3(), Math.max(min.length(), max.length())\r\n        );\r\n    }\r\n    \r\n    faceHalfEdgesIterator(face: FaceID): FaceHalfEdgesIterator {\r\n        return new FaceHalfEdgesIterator(this, face);\r\n    }\r\n\r\n    faceVerticesIterator(face: FaceID): FaceHalfEdgesIterator {\r\n        return new FaceVerticesIterator(this, face);\r\n    }\r\n\r\n    vertexFacesIterator(vertex: VertexID): VertexFacesIterator {\r\n        return new VertexFacesIterator(this, vertex);\r\n    }\r\n}\r\n\r\nvar GeometryBuilder: GeometryBuilderConstructor = GeometryBuilderBase;\r\n\r\nexport type HalfEdgeID = number;\r\nexport type FaceID = number;\r\nexport type VertexID = number;\r\n\r\nexport type HalfEdge = {\r\n    targetID: VertexID | null;\r\n    twinID: HalfEdgeID | null;\r\n    prevID: HalfEdgeID | null;\r\n    nextID: HalfEdgeID | null;\r\n    faceID: FaceID | null;\r\n}\r\n\r\nexport type Face = {\r\n    halfEdgeID: HalfEdgeID | null;\r\n    [key: string]: any;\r\n}\r\n\r\nexport type Vertex = {\r\n    position: number[] | Float32Array | Float64Array;\r\n    halfEdgeID: HalfEdgeID | null;\r\n    properties?: {\r\n        [key: string]: any;\r\n    }\r\n}\r\n\r\nexport class FaceHalfEdgesIterator {\r\n    geometry: GeometryBuilder;\r\n    faceID: FaceID;\r\n    halfEdgeID: HalfEdgeID | null;\r\n\r\n    constructor(geometry: GeometryBuilder, face: FaceID) {\r\n        this.geometry = geometry;\r\n        this.faceID = face;\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    reset(): void {\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    current(): HalfEdgeID | null {\r\n        return this.halfEdgeID;\r\n    }\r\n\r\n    next(): IteratorResult<HalfEdgeID> {\r\n        const {halfEdgeID, faceID, geometry} = this;\r\n        const {faces, halfEdges} = geometry;\r\n        const face = faces[faceID];\r\n        if (face !== null) {\r\n            if (halfEdgeID === null) {\r\n                const firstHalfEdgeID = face.halfEdgeID ?? null;\r\n                const nextHalfEdgeID = faces[firstHalfEdgeID ?? -1]?.nextID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (firstHalfEdgeID !== null) {\r\n                    return {\r\n                        value: firstHalfEdgeID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n            else if (halfEdgeID !== face.halfEdge) {\r\n                const nextHalfEdgeID = halfEdges[halfEdgeID].nextID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (halfEdgeID !== null) {\r\n                    return {\r\n                        value: halfEdgeID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return {\r\n            value: undefined, done: true\r\n        };\r\n    }\r\n\r\n    [Symbol.iterator](): Iterator<HalfEdgeID> {\r\n        this.halfEdgeID = null;\r\n        return this;\r\n    }\r\n}\r\n\r\nexport class FaceVerticesIterator {\r\n    geometry: GeometryBuilder;\r\n    faceID: FaceID;\r\n    halfEdgeID: HalfEdgeID | null;\r\n\r\n    constructor(geometry: GeometryBuilder, face: FaceID) {\r\n        this.geometry = geometry;\r\n        this.faceID = face;\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    reset(): void {\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    current(): VertexID | null {\r\n        const {halfEdgeID, geometry} = this;\r\n        const {halfEdges} = geometry;\r\n        return halfEdges[halfEdges[halfEdgeID ?? -1]?.prevID ?? -1]?.targetID ?? null;\r\n    }\r\n\r\n    next(): IteratorResult<VertexID> {\r\n        const {halfEdgeID, geometry, faceID} = this;\r\n        const {faces, halfEdges} = geometry;\r\n        const face = faces[faceID ?? -1];\r\n        if (face !== null) {\r\n            const {halfEdge: faceHalfEdgeID} = face;\r\n            if (halfEdgeID === null) {\r\n                const firstVertexID = halfEdges[halfEdges[faceHalfEdgeID ?? -1].prevID ?? -1].targetID ?? null;\r\n                const nextHalfEdgeID = halfEdges[faceHalfEdgeID ?? -1].nextID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (firstVertexID !== null) {\r\n                    return {\r\n                        value: firstVertexID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n            else if (halfEdgeID !== face.halfEdge) {\r\n                const vertex = halfEdges[halfEdges[halfEdgeID].prevID ?? -1].targetID ?? null;\r\n                const nextHalfEdgeID = halfEdges[halfEdgeID].nextID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (vertex !== null) {\r\n                    return {\r\n                        value: vertex, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return {\r\n            value: undefined, done: true\r\n        };\r\n    }\r\n\r\n    [Symbol.iterator](): Iterator<VertexID> {\r\n        this.halfEdgeID = null;\r\n        return this;\r\n    }\r\n}\r\n\r\nexport class VertexFacesIterator {\r\n    geometry: GeometryBuilder;\r\n    halfEdgeID: HalfEdgeID | null;\r\n    vertexID: VertexID;\r\n    \r\n    constructor(geometry: GeometryBuilder, vertex: VertexID) {\r\n        this.geometry = geometry;\r\n        this.vertexID = vertex;\r\n        this.halfEdgeID = null;\r\n    }\r\n    \r\n    reset(): void {\r\n        this.halfEdgeID = null;\r\n    }\r\n\r\n    current(): FaceID | null {\r\n        const {geometry, halfEdgeID} = this;\r\n        const {halfEdges} = geometry;\r\n        return halfEdges[halfEdgeID ?? -1].faceID ?? null;\r\n    }\r\n\r\n    next(): IteratorResult<FaceID>  {\r\n        const {halfEdgeID, vertexID, geometry} = this;\r\n        const {halfEdges, vertices} = geometry;\r\n        const vertex = vertices[vertexID ?? -1];\r\n        if (vertex) {\r\n            const {halfEdgeID: vertexHalfEdgeID} = vertex;\r\n            if (halfEdgeID === null) {\r\n                const faceID = halfEdges[vertexHalfEdgeID ?? -1]?.faceID ?? null;\r\n                const nextHalfEdgeID = halfEdges[halfEdges[vertexHalfEdgeID ?? -1]?.prevID ?? -1]?.twinID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (faceID !== null) {\r\n                    return {\r\n                        value: faceID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n            else if (halfEdgeID !== vertex.halfEdgeID) {\r\n                const faceID = halfEdges[halfEdgeID]?.faceID ?? null;\r\n                const nextHalfEdgeID = halfEdges[halfEdges[halfEdgeID].prevID ?? -1].twinID ?? null;\r\n                this.halfEdgeID = nextHalfEdgeID;\r\n                if (faceID !== null) {\r\n                    return {\r\n                        value: faceID, done: nextHalfEdgeID === null\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return {\r\n            value: undefined, done: true\r\n        };\r\n    }\r\n\r\n    [Symbol.iterator](): Iterator<FaceID> {\r\n        this.halfEdgeID = null;\r\n        return this;\r\n    }\r\n}","import { GeometryBase } from \"../../Geometry\";\r\nimport { GeometryBuilder } from \"../../GeometryBuilder\";\r\n\r\nexport class CubeGeometry extends GeometryBase {\r\n\twidth: number;\r\n\theight: number;\r\n\tdepth: number;\r\n\twidthSegments: number;\r\n\theightSegments: number;\r\n\tdepthSegments: number;\r\n\r\n\tconstructor(properties?: {width?: number, height?: number, depth?: number, widthSegments?: number, heightSegments?: number, depthSegments?: number}) {\r\n\t\tsuper();\r\n\t\tconst {width, height, depth, widthSegments, heightSegments, depthSegments} = properties ?? {};\r\n\t\tthis.width = width ?? 1;\r\n\t\tthis.height = height ?? 1;\r\n\t\tthis.depth = depth ?? 1;\r\n\t\tthis.widthSegments = widthSegments ?? 1;\r\n\t\tthis.heightSegments = heightSegments ?? 1;\r\n\t\tthis.depthSegments = depthSegments ?? 1;\r\n\t}\r\n\t\r\n\ttoBuilder(): GeometryBuilder {\r\n\t\tconst builder = new GeometryBuilder();\r\n\t\tconst {width, height, depth} = this;\r\n\t\tlet {widthSegments, heightSegments, depthSegments} = this;\r\n\t\twidthSegments = Math.floor(widthSegments);\r\n\t\theightSegments = Math.floor(heightSegments);\r\n\t\tdepthSegments = Math.floor(depthSegments);\r\n\r\n\t\tconst indices: number[] = [];\r\n\t\tconst vertices: number[] = [];\r\n\t\tconst uvs: number[] = [];\r\n\t\tlet verticesCount = 0;\r\n\r\n\t\t[\r\n\t\t\t[2, 1, 0, -1, -1, depth, height, width, depthSegments, heightSegments],\r\n\t\t\t[2, 1, 0, +1, -1, depth, height, -width, depthSegments, heightSegments],\r\n\t\t\t[0, 2, 1, +1, +1, width, depth, height, widthSegments, depthSegments],\r\n\t\t\t[0, 2, 1, +1, -1, width, depth, -height, widthSegments, depthSegments],\r\n\t\t\t[0, 1, 2, +1, -1, width, height, depth, widthSegments, heightSegments],\r\n\t\t\t[0, 1, 2, -1, -1, width, height, -depth, widthSegments, heightSegments]\r\n\t\t].forEach(([u, v, w, udir, vdir, width, height, depth, gridX, gridY]) => {\r\n\t\t\tconst segmentWidth = width / gridX;\r\n\t\t\tconst segmentHeight = height / gridY;\r\n\t\t\tconst widthHalf = width / 2;\r\n\t\t\tconst heightHalf = height / 2;\r\n\t\t\tconst depthHalf = depth / 2;\r\n\t\t\tconst gridX1 = gridX + 1;\r\n\t\t\tconst gridY1 = gridY + 1;\r\n\t\t\tlet index = 0;\r\n\t\t\tfor (let iy = 0; iy < gridY1; iy++) {\r\n\t\t\t\tconst y = iy * segmentHeight - heightHalf;\r\n\t\t\t\tfor (let ix = 0; ix < gridX1; ix++) {\r\n\t\t\t\t\tconst x = ix * segmentWidth - widthHalf;\r\n\t\t\t\t\tconst vertex = new Array(3);\r\n\t\t\t\t\tvertex[u] = x * udir;\r\n\t\t\t\t\tvertex[v] = y * vdir;\r\n\t\t\t\t\tvertex[w] = depthHalf;\r\n\t\t\t\t\tvertices.push(\r\n\t\t\t\t\t\t...vertex\r\n\t\t\t\t\t);\r\n\t\t\t\t\tuvs.push(ix / gridX, 1 - (iy / gridY));\r\n\t\t\t\t\tindex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let iy = 0; iy < gridY; iy++) {\r\n\t\t\t\tfor (let ix = 0; ix < gridX; ix++) {\r\n\t\t\t\t\tconst a = verticesCount + ix + gridX1 * iy;\r\n\t\t\t\t\tconst b = verticesCount + ix + gridX1 * (iy + 1);\r\n\t\t\t\t\tconst c = verticesCount + (ix + 1) + gridX1 * (iy + 1);\r\n\t\t\t\t\tconst d = verticesCount + (ix + 1) + gridX1 * iy;\r\n\t\t\t\t\t// indices.push(a, b, d);\r\n\t\t\t\t\t// indices.push(b, c, d);\r\n\t\t\t\t\tindices.push(a, b, d, c);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tverticesCount += index;\r\n\t\t});\r\n\t\t\r\n\t\tconst {length: indicesCount} = indices;\r\n\t\tconst verticesArray: number[] = [];\r\n\t\tconst uvsArray: number[][] = [];\r\n\t\tfor (let i = 0; i < indicesCount; i += 4) {\r\n\t\t\tconst vi1 = 3 * indices[i], vi2 = 3 * indices[i + 1], vi3 = 3 * indices[i + 2], vi4 = 3 * indices[i + 3];\r\n\t\t\tconst ui1 = 2 * indices[i], ui2 = 2 * indices[i + 1], ui3 = 2 * indices[i + 2], ui4 = 2 * indices[i + 3];\r\n\t\t\tlet v1 = verticesArray[vi1], v2 = verticesArray[vi2], v3 = verticesArray[vi3], v4 = verticesArray[vi4];\r\n\t\t\tif (v1 === undefined) {\r\n\t\t\t\tv1 = builder.addVertex([vertices[vi1], vertices[vi1 + 1], vertices[vi1 + 2]]), verticesArray[vi1] = v1;\r\n\t\t\t}\r\n\t\t\tif (v2 === undefined) {\r\n\t\t\t\tv2 = builder.addVertex([vertices[vi2], vertices[vi2 + 1], vertices[vi2 + 2]]), verticesArray[vi2] = v2;\r\n\t\t\t}\r\n\t\t\tif (v3 === undefined) {\r\n\t\t\t\tv3 = builder.addVertex([vertices[vi3], vertices[vi3 + 1], vertices[vi3 + 2]]), verticesArray[vi3] = v3;\r\n\t\t\t}\r\n\t\t\t//\r\n\t\t\tif (v4 === undefined) {\r\n\t\t\t\tv4 = builder.addVertex([vertices[vi4], vertices[vi4 + 1], vertices[vi4 + 2]]), verticesArray[vi4] = v4;\r\n\t\t\t}\r\n\t\t\tlet uv1 = uvsArray[ui1], uv2 = uvsArray[ui2], uv3 = uvsArray[ui3], uv4 = uvsArray[ui4];\r\n\t\t\tif (uv1 === undefined) {\r\n\t\t\t\tuv1 = [uvs[ui1], uvs[ui1 + 1]], uvsArray[ui1] = uv1;\r\n\t\t\t}\r\n\t\t\tif (uv2 === undefined) {\r\n\t\t\t\tuv2 = [uvs[ui2], uvs[ui2 + 1]], uvsArray[ui2] = uv2;\r\n\t\t\t}\r\n\t\t\tif (uv3 === undefined) {\r\n\t\t\t\tuv3 = [uvs[ui3], uvs[ui3 + 1]], uvsArray[ui3] = uv3;\r\n\t\t\t}\r\n\t\t\t//\r\n\t\t\tif (uv4 === undefined) {\r\n\t\t\t\tuv4 = [uvs[ui4], uvs[ui4 + 1]], uvsArray[ui4] = uv4;\r\n\t\t\t}\r\n\t\t\t/*builder.addTriangleFace(v1, v2, v3, {\r\n\t\t\t\tuv: [uv1, uv2, uv3]\r\n\t\t\t});*/\r\n\t\t\tbuilder.addQuadFace(v1, v2, v3, v4, {\r\n\t\t\t\tuv: [uv1, uv2, uv3, uv4]\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\treturn builder;\r\n\t}\r\n}","import { GeometryBase } from \"../geometry\";\r\nimport { GeometryBuilder } from \"../GeometryBuilder\";\r\n\r\nexport { QuadGeometry };\r\n\r\nclass QuadGeometry extends GeometryBase {\r\n\twidth: number;\r\n\theight: number;\r\n\twidthSegments: number;\r\n\theightSegments: number;\r\n\r\n\tconstructor(properties?: {width?: number, height?: number, widthSegments?: number, heightSegments?: number}) {\r\n\t\tsuper();\r\n\t\tthis.width = properties?.width ?? 1;\r\n\t\tthis.height = properties?.height ?? 1;\r\n\t\tthis.widthSegments = properties?.widthSegments ?? 1;\r\n\t\tthis.heightSegments = properties?.heightSegments ?? 1;\r\n\t}\r\n\t\r\n\ttoBuilder(): GeometryBuilder {\r\n\t\tconst builder = new GeometryBuilder();\r\n\t\tconst {heightSegments, widthSegments, width, height} = this;\r\n\t\tconst widthHalf = width / 2;\r\n\t\tconst heightHalf = height / 2;\r\n\r\n\t\tconst gridX = Math.floor(widthSegments);\r\n\t\tconst gridY = Math.floor(heightSegments);\r\n\r\n\t\tconst gridX1 = gridX + 1;\r\n\t\tconst gridY1 = gridY + 1;\r\n\r\n\t\tconst segmentWidth = width / gridX;\r\n\t\tconst segmentHeight = height / gridY;\r\n\t\tconst indices = [];\r\n\t\tconst vertices = [];\r\n\t\tconst uvs = [];\r\n\r\n\t\tfor (let iy = 0; iy < gridY1; iy++) {\r\n\t\t\tconst y = iy * segmentHeight - heightHalf;\r\n\t\t\tfor (let ix = 0; ix < gridX1; ix++) {\r\n\t\t\t\tconst x = ix * segmentWidth - widthHalf;\r\n\t\t\t\tvertices.push(x, - y, 0);\r\n\t\t\t\tuvs.push(ix / gridX);\r\n\t\t\t\tuvs.push(1 - (iy / gridY));\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let iy = 0; iy < gridY; iy++) {\r\n\t\t\tfor (let ix = 0; ix < gridX; ix++) {\r\n\t\t\t\tconst a = ix + gridX1 * iy;\r\n\t\t\t\tconst b = ix + gridX1 * (iy + 1);\r\n\t\t\t\tconst c = (ix + 1) + gridX1 * (iy + 1);\r\n\t\t\t\tconst d = (ix + 1) + gridX1 * iy;\r\n\t\t\t\tindices.push(a, b, d);\r\n\t\t\t\tindices.push(b, c, d);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst {length: indicesCount} = indices;\r\n\t\tconst verticesArray: number[] = [];\r\n\t\tconst uvsArray: number[][] = [];\r\n\t\tfor (let i = 0; i < indicesCount; i += 3) {\r\n\t\t\tconst vi1 = 3 * indices[i], vi2 = 3 * indices[i + 1], vi3 = 3 * indices[i + 2];\r\n\t\t\tconst ui1 = 2 * indices[i], ui2 = 2 * indices[i + 1], ui3 = 2 * indices[i + 2];\r\n\t\t\tlet v1 = verticesArray[vi1], v2 = verticesArray[vi2], v3 = verticesArray[vi3];\r\n\t\t\tif (v1 == undefined) {\r\n\t\t\t\tv1 = builder.addVertex([vertices[vi1], vertices[vi1 + 1], vertices[vi1 + 2]]), verticesArray[vi1] = v1;\r\n\t\t\t}\r\n\t\t\tif (v2 == undefined) {\r\n\t\t\t\tv2 = builder.addVertex([vertices[vi2], vertices[vi2 + 1], vertices[vi2 + 2]]), verticesArray[vi2] = v2;\r\n\t\t\t}\r\n\t\t\tif (v3 == undefined) {\r\n\t\t\t\tv3 = builder.addVertex([vertices[vi3], vertices[vi3 + 1], vertices[vi3 + 2]]), verticesArray[vi3] = v3;\r\n\t\t\t}\r\n\t\t\tlet uv1 = uvsArray[ui1], uv2 = uvsArray[ui2], uv3 = uvsArray[ui3];\r\n\t\t\tif (uv1 == undefined) {\r\n\t\t\t\tuv1 = [uvs[ui1], uvs[ui1 + 1]], uvsArray[ui1] = uv1;\r\n\t\t\t}\r\n\t\t\tif (uv2 == undefined) {\r\n\t\t\t\tuv2 = [uvs[ui2], uvs[ui2 + 1]], uvsArray[ui2] = uv2;\r\n\t\t\t}\r\n\t\t\tif (uv3 == undefined) {\r\n\t\t\t\tuv3 = [uvs[ui3], uvs[ui3 + 1]], uvsArray[ui3] = uv3;\r\n\t\t\t}\r\n\t\t\tbuilder.addTriangleFace(v1, v2, v3, {\r\n\t\t\t\tuv: [uv1, uv2, uv3]\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\treturn builder;\r\n\t}\r\n}","export enum TexturePixelFormat {\r\n    ALPHA = 0x1906,\r\n    RGB = 0x1907,\r\n    RGBA = 0x1908,\r\n    LUMINANCE = 0x1909,\r\n    LUMINANCE_ALPHA = 0x190A,\r\n    DEPTH_COMPONENT = 0x1902,\r\n    DEPTH_STENCIL = 0x84F9,\r\n    RED = 0x1903,\r\n    RG = 0x8227,\r\n    RED_INTEGER = 0x8D94,\r\n    RG_INTEGER = 0x8228,\r\n    RGB_INTEGER = 0x8D98,\r\n    RGBA_INTEGER = 0x8D99\r\n}\r\n\r\nexport enum TextureInternalPixelFormat {\r\n    ALPHA = 0x1906,\r\n    RGB = 0x1907,\r\n    RGBA = 0x1908,\r\n    LUMINANCE = 0x1909,\r\n    LUMINANCE_ALPHA = 0x190A,\r\n    DEPTH_COMPONENT16 = 0x81A5,\r\n    DEPTH_COMPONENT24 = 0x81A6,\r\n    DEPTH_COMPONENT32F = 0x8CAC,\r\n    DEPTH24_STENCIL8 = 0x88F0,\r\n    DEPTH32F_STENCIL8 = 0x8CAD,\r\n    R8 = 0x8229,\r\n    R8_SNORM = 0x8F94,\r\n    RG8 = 0x822B,\r\n    RG8_SNORM = 0x8F95,\r\n    RGB8 = 0x8051,\r\n    RGB8_SNORM = 0x8F96,\r\n    RGB565 = 0x8D62,\r\n    RGBA8 = 0x8058,\r\n    RGBA4 = 0x8056,\r\n    RGB5_A1 = 0x8057,\r\n    RGBA8_SNORM = 0x8F97,\r\n    RGB10_A2UI = 0x906F,\r\n    SRGB = 0x8C40,\r\n    SRGB8 = 0x8C41,\r\n    SRGB8_ALPHA8 = 0x8C43,\r\n    R16F = 0x822D,\r\n    RGB16F = 0x881B,\r\n    RGBA16F = 0x881A,\r\n    R32F = 0x822E,\r\n    RG32F = 0x8230,\r\n    RGB32F = 0x8815,\r\n    RGBA32F\t= 0x8814,\r\n    R11F_G11F_B10F = 0x8C3A,\r\n    RGB9_E5 = 0x8C3D,\r\n    R8UI = 0x8232,\r\n    R16I = 0x8233,\r\n    R16UI = 0x8234,\r\n    R32I = 0x8235,\r\n    R32UI = 0x8236,\r\n    RG8I = 0x8237,\r\n    RG8UI = 0x8238,\r\n    RG16I = 0x8239,\r\n    RG16UI = 0x823A,\r\n    RG32I = 0x823B,\r\n    RG32UI = 0x823C,\r\n    RGB8I = 0x8D8F,\r\n    RGB8UI = 0x8D7D,\r\n    RGB16I = 0x8D89,\r\n    RGB16UI = 0x8D77,\r\n    RGB32I = 0x8D83,\r\n    RGB32UI = 0x8D71,\r\n    RGBA8I = 0x8D8E,\r\n    RGBA8UI = 0x8D7C,\r\n    RGBA16I = 0x8D88,\r\n    RGBA16UI = 0x8D76,\r\n    RGBA32I = 0x8D82,\r\n    RGBA32UI = 0x8D70,\r\n}\r\n\r\nexport enum TexturePixelType {\r\n    BYTE = 0x1400,\r\n    UNSIGNED_BYTE = 0x1401,\r\n    SHORT = 0x1402,\r\n    UNSIGNED_SHORT = 0x1403,\r\n    INT = 0x1404,\r\n    UNSIGNED_INT = 0x1405,\r\n    FLOAT = 0x1406,\r\n    HALF_FLOAT = 0x140B,\r\n    UNSIGNED_SHORT_4_4_4_4 = 0x8033,\r\n    UNSIGNED_SHORT_5_5_5_1 = 0x8034,\r\n    UNSIGNED_SHORT_5_6_5 = 0x8363,\r\n    UNSIGNED_INT_2_10_10_10_REV = 0x8368,\r\n    UNSIGNED_INT_24_8 = 0x84FA,\r\n    UNSIGNED_INT_10F_11F_11F_REV = 0x8C3B,\r\n    UNSIGNED_INT_5_9_9_9_REV = 0x8C3E,\r\n    FLOAT_32_UNSIGNED_INT_24_8_REV = 0x8DAD,\r\n    INT_2_10_10_10_REV = 0x8D9F\r\n}\r\n\r\nexport enum TextureParameter {\r\n    TEXTURE_MAG_FILTER = 0x2800,\r\n    TEXTURE_MIN_FILTER = 0x2801,\r\n    TEXTURE_WRAP_S = 0x2802,\r\n    TEXTURE_WRAP_T = 0x2803,\r\n    TEXTURE_BASE_LEVEL = 0x813C,\r\n    TEXTURE_MAX_LEVEL = 0x813D,\r\n    TEXTURE_MAX_LOD = 0x813B,\r\n    TEXTURE_MIN_LOD = 0x813A,\r\n    TEXTURE_WRAP_R = 0x8072,\r\n    TEXTURE_COMPARE_FUNC = 0x884D,\r\n    TEXTURE_COMPARE_MODE = 0x884C\r\n}\r\n\r\nexport enum TextureTarget {\r\n    TEXTURE_2D = 0x0DE1,\r\n    TEXTURE_CUBE_MAP = 0x8513,\r\n    TEXTURE_3D = 0x806F,\r\n    TEXTURE_2D_ARRAY = 0x8C1A,\r\n    TEXTURE_CUBE_MAP_POSITIVE_X = 0x8515,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_X = 0x8516,\r\n    TEXTURE_CUBE_MAP_POSITIVE_Y = 0x8517,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_Y = 0x8518,\r\n    TEXTURE_CUBE_MAP_POSITIVE_Z = 0x8519,\r\n    TEXTURE_CUBE_MAP_NEGATIVE_Z = 0x851A\r\n}\r\n\r\nexport enum TextureMagFilter {\r\n    LINEAR = 0x2601,\r\n    NEAREST = 0x2600\r\n}\r\n\r\nexport enum TextureMinFilter {\r\n    LINEAR = 0x2601,\r\n    NEAREST = 0x2600,\r\n    NEAREST_MIPMAP_NEAREST = 0x2700, \r\n    LINEAR_MIPMAP_NEAREST = 0x2701, \r\n    NEAREST_MIPMAP_LINEAR = 0x2702,\r\n    LINEAR_MIPMAP_LINEAR = 0x2703\r\n}\r\n\r\nexport enum TextureCompareMode {\r\n    COMPARE_REF_TO_TEXTURE = 0x884E,\r\n    NONE = 0\r\n}\r\n\r\nexport enum TextureWrapMode {\r\n    REPEAT = 0x2901,\r\n    CLAMP_TO_EDGE = 0x812F, \r\n    MIRRORED_REPEAT = 0x8370\r\n}\r\n\r\nexport enum TextureCompareFunction {\r\n    NEVER = 0x0200,\r\n    LESS = 0x0201,\r\n    EQUAL = 0x0202,\r\n    LEQUAL = 0x0203,\r\n    GREATER = 0x0204,\r\n    NOTEQUAL = 0x0205,\r\n    GEQUAL = 0x0206,\r\n    ALWAYS = 0x0207\r\n}\r\n\r\nexport type Texture2DPixels = Uint32Array |  Uint16Array | Uint8Array | TexImageSource;\r\n\r\nexport type TextureCubeMapPixels = {\r\n    xPos: TexImageSource;\r\n    xNeg: TexImageSource;\r\n    yPos: TexImageSource;\r\n    yNeg: TexImageSource;\r\n    zPos: TexImageSource;\r\n    zNeg: TexImageSource;\r\n}\r\n\r\nexport type TextureProperties = {\r\n    target: TextureTarget;\r\n    pixels: Texture2DPixels | TextureCubeMapPixels | null;\r\n    width: number;\r\n    height: number;\r\n    format: TexturePixelFormat;\r\n    internalFormat: TextureInternalPixelFormat;\r\n    type: TexturePixelType;\r\n\r\n    depth?: number;\r\n    lod?: number;\r\n    border?: number;\r\n\r\n    subimages?: {\r\n        pixels: Texture2DPixels;\r\n        xoffset: number;\r\n        yoffset: number;\r\n        zoffset?: number;\r\n        width: number;\r\n        height: number;\r\n        depth?: number;\r\n    }[];\r\n\r\n    mipmap?: boolean;\r\n    min?: TextureMinFilter;\r\n    mag?: TextureMagFilter;\r\n\r\n    wrapS?: TextureWrapMode;\r\n    wrapT?: TextureWrapMode;\r\n    wrapR?: TextureWrapMode;\r\n\r\n    baseMipmapLevel?: number;\r\n    maxMipmapLevel?: number;\r\n\r\n    minLod?: number;\r\n    maxLod?: number;\r\n\r\n    compareFunction?: TextureCompareFunction;\r\n    compareMode?: TextureCompareMode;\r\n}\r\n\r\nexport type Texture = {\r\n    name: string;\r\n    unit: number;\r\n    internalTexture: WebGLTexture;\r\n    properties?: TextureProperties;\r\n}\r\n\r\nexport class WebGLTextureUtilities {\r\n\r\n    static #textureUnits: Map<string, number> = new Map();\r\n\r\n\r\n    static getTexturesUnitsEntries(): IterableIterator<[string, number]> {\r\n        return this.#textureUnits.entries();\r\n    }\r\n\r\n    static createTexture(gl: WebGL2RenderingContext, name: string, properties: TextureProperties): Texture | null {\r\n        const internalTexture = gl.createTexture();\r\n        if (internalTexture === null) {\r\n            return null;\r\n        }\r\n\r\n        let unit = this.#textureUnits.get(name);\r\n        if (unit == undefined) {\r\n            unit = Math.max(-1, ...this.#textureUnits.values()) + 1;\r\n            this.#textureUnits.set(name, unit);\r\n        }\r\n\r\n        const {pixels, target, subimages, width, height, format, internalFormat, type} = properties;\r\n        let {lod, border, depth, mipmap} = properties;\r\n\r\n        lod = lod ?? 0;\r\n        border = border ?? 0;\r\n        depth = depth ?? 0;\r\n        mipmap = mipmap ?? true;\r\n\r\n        const activeTexture = gl.getParameter(gl.ACTIVE_TEXTURE);\r\n        if (activeTexture !== unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + unit);\r\n            gl.bindTexture(target, internalTexture);\r\n        }\r\n        \r\n        switch (target) {\r\n            case TextureTarget.TEXTURE_2D: {\r\n                gl.texImage2D(target, lod, internalFormat, width, height, border, format, type, <ArrayBufferView | null>pixels);\r\n                if (subimages) {\r\n                    subimages.forEach((subimage_i) => {\r\n                        const {xoffset, yoffset, width, height, pixels} = subimage_i;\r\n                        gl.texSubImage2D(target, lod!, xoffset, yoffset, width, height, format, type, pixels as ArrayBufferView);\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n            case TextureTarget.TEXTURE_CUBE_MAP: {\r\n                if (pixels === null) {\r\n                    gl.texImage2D(target, lod, internalFormat, width, height, border, format, type, null);  \r\n                }\r\n                else {\r\n                    if (\"xPos\" in pixels) {\r\n                        const {xPos, xNeg, yPos, yNeg, zPos, zNeg} = pixels;\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_POSITIVE_X, lod, internalFormat, width, height, border, format, type, xPos);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_NEGATIVE_X, lod, internalFormat, width, height, border, format, type, xNeg);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_POSITIVE_Y, lod, internalFormat, width, height, border, format, type, yPos);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_NEGATIVE_Y, lod, internalFormat, width, height, border, format, type, yNeg);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_POSITIVE_Z, lod, internalFormat, width, height, border, format, type, zPos);\r\n                        gl.texImage2D(TextureTarget.TEXTURE_CUBE_MAP_NEGATIVE_Z, lod, internalFormat, width, height, border, format, type, zNeg);\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case TextureTarget.TEXTURE_2D_ARRAY: {\r\n                gl.texImage3D(target, lod, internalFormat, width, height,  depth, border, format, type, <ArrayBufferView | null>pixels);\r\n                if (subimages) {\r\n                    subimages.forEach((subimage_i, i) => {\r\n                        const {xoffset, yoffset, zoffset, width, height, depth, pixels} = subimage_i;\r\n                        gl.texSubImage3D(target, lod!, xoffset, yoffset, zoffset!, width, height, depth!, format, type, pixels as ArrayBufferView);\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        if (mipmap) {\r\n            gl.generateMipmap(target);\r\n        }\r\n\r\n        const {min, mag, wrapS, wrapT, wrapR, baseMipmapLevel, maxMipmapLevel, compareFunction, compareMode, minLod, maxLod} = properties;\r\n\r\n        if (min !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_MIN_FILTER, min);\r\n        if (mag !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_MAG_FILTER, mag);\r\n        if (wrapS  !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_WRAP_S, wrapS);\r\n        if (wrapT !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_WRAP_T, wrapT);\r\n        if (wrapR !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_WRAP_R, wrapR);\r\n        if (baseMipmapLevel !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_BASE_LEVEL, baseMipmapLevel);\r\n        if (maxMipmapLevel !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_MAX_LEVEL, maxMipmapLevel);\r\n        if (compareFunction !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_COMPARE_FUNC, compareFunction);\r\n        if (compareMode !== undefined)\r\n            gl.texParameteri(target, TextureParameter.TEXTURE_COMPARE_MODE, compareMode);\r\n        if (minLod !== undefined)\r\n            gl.texParameterf(target, TextureParameter.TEXTURE_MIN_LOD, minLod);\r\n        if (maxLod !== undefined)\r\n            gl.texParameterf(target, TextureParameter.TEXTURE_MAX_LOD, maxLod);\r\n        \r\n        return {\r\n            unit,\r\n            internalTexture,\r\n            name,\r\n            properties: {\r\n                pixels,\r\n                target,\r\n                subimages,\r\n                lod,\r\n                width,\r\n                height,\r\n                format,\r\n                internalFormat,\r\n                type,\r\n                min,\r\n                mag,\r\n                wrapS,\r\n                wrapT,\r\n                wrapR,\r\n                baseMipmapLevel,\r\n                maxMipmapLevel,\r\n                compareFunction,\r\n                compareMode,\r\n                minLod,\r\n                maxLod\r\n            }\r\n        };\r\n    }\r\n\r\n    static setUnpackAlignment(gl: WebGL2RenderingContext, alignment: number): void {\r\n        gl.pixelStorei(gl.UNPACK_ALIGNMENT, alignment);\r\n    }\r\n\r\n    static deleteTexture(gl: WebGL2RenderingContext, texture: Texture): void {\r\n        const {internalTexture, name} = texture;\r\n        if (gl.isTexture(internalTexture)) {\r\n            gl.deleteTexture(internalTexture);\r\n            this.#textureUnits.delete(name);\r\n        }\r\n    }\r\n}","export enum ShaderType {\r\n    FRAGMENT_SHADER = 0x8B30,\r\n    VERTEX_SHADER = 0x8B31,\r\n}\r\n\r\nexport type Program = {\r\n    internalProgram: WebGLProgram;\r\n    vertexShader: Shader;\r\n    fragmentShader: Shader;\r\n}\r\n\r\nexport type Shader = {\r\n    internalShader: WebGLShader;\r\n    type: ShaderType;\r\n    source: string;\r\n}\r\n\r\nexport type ProgramProperties = {\r\n    vertexSource: string;\r\n    vertexFlags?: string[];\r\n    fragmentSource: string;\r\n    fragmentFlags?: string[];\r\n}\r\n\r\nexport class WebGLProgramUtilities {\r\n\r\n    static createShader(gl: WebGL2RenderingContext, type: ShaderType, source: string): Shader | null {\r\n        const internalShader = gl.createShader(type);\r\n        if (internalShader === null) {\r\n            return null;\r\n        }\r\n        gl.shaderSource(internalShader, source);\r\n        gl.compileShader(internalShader);\r\n        \r\n        const success = gl.getShaderParameter(internalShader, gl.COMPILE_STATUS);\r\n        if (success) {\r\n            return {\r\n                type,\r\n                internalShader,\r\n                source\r\n            };\r\n        }\r\n\r\n        const shaderInfoLog = gl.getShaderInfoLog(internalShader);\r\n        if (shaderInfoLog !== null) {\r\n            console.warn(shaderInfoLog);\r\n        }\r\n\r\n        gl.deleteShader(internalShader);\r\n        return null;\r\n    }\r\n    \r\n    static createProgram(gl: WebGL2RenderingContext, properties: ProgramProperties): Program | null {\r\n        const {vertexSource, fragmentSource} = properties;\r\n\r\n        const vertexShader = this.createShader(gl, ShaderType.VERTEX_SHADER, vertexSource);\r\n        if (vertexShader === null) {\r\n            return null;\r\n        }\r\n\r\n        const fragmentShader = this.createShader(gl, ShaderType.FRAGMENT_SHADER, fragmentSource);\r\n        if (fragmentShader === null) {\r\n            return null;\r\n        }\r\n        \r\n        const internalProgram = gl.createProgram();\r\n        if (internalProgram === null) {\r\n            return null;\r\n        }\r\n\r\n        const program: Program = {\r\n            internalProgram,\r\n            vertexShader,\r\n            fragmentShader\r\n        };\r\n        \r\n        gl.attachShader(internalProgram, vertexShader.internalShader);\r\n        gl.attachShader(internalProgram, fragmentShader.internalShader);\r\n        gl.linkProgram(internalProgram);\r\n\r\n        const success = gl.getProgramParameter(internalProgram, gl.LINK_STATUS);\r\n        if (success) {\r\n            return program;\r\n        }\r\n\r\n        const programInfoLog = gl.getProgramInfoLog(internalProgram);\r\n        if (programInfoLog !== null) {\r\n            const vertexInfoLog = gl.getShaderInfoLog(vertexShader.internalShader);\r\n            const fragmentInfoLog = gl.getShaderInfoLog(fragmentShader.internalShader);\r\n            console.warn(programInfoLog);\r\n            console.warn(vertexInfoLog);\r\n            console.warn(fragmentInfoLog);\r\n        }\r\n        this.deleteProgram(gl, program);\r\n\r\n        return null;\r\n    }\r\n\r\n    static recompileProgram(gl: WebGL2RenderingContext, program: Program, properties: Partial<ProgramProperties>) {\r\n        const {internalProgram, vertexShader, fragmentShader} = program;\r\n        let {vertexSource, fragmentSource} = properties;\r\n        if (typeof vertexSource === \"string\") {\r\n            const {internalShader} = vertexShader;\r\n            gl.shaderSource(internalShader, vertexSource);\r\n            gl.compileShader(internalShader);\r\n            vertexShader.source = vertexSource;\r\n        }\r\n        if (typeof fragmentSource === \"string\") {\r\n            const {internalShader} = fragmentShader;\r\n            gl.shaderSource(internalShader, fragmentSource);\r\n            gl.compileShader(internalShader);\r\n            fragmentShader.source = fragmentSource;\r\n        }\r\n        gl.linkProgram(internalProgram);\r\n\r\n        const success = gl.getProgramParameter(internalProgram, gl.LINK_STATUS);\r\n        if (success) {\r\n            return program;\r\n        }\r\n\r\n        const programInfoLog = gl.getProgramInfoLog(internalProgram);\r\n        if (programInfoLog !== null) {\r\n            const vertexInfoLog = gl.getShaderInfoLog(vertexShader.internalShader);\r\n            const fragmentInfoLog = gl.getShaderInfoLog(fragmentShader.internalShader);\r\n            console.warn(programInfoLog);\r\n            console.warn(vertexInfoLog);\r\n            console.warn(fragmentInfoLog);\r\n        }\r\n        return program;\r\n    }\r\n    \r\n    static deleteProgram(gl: WebGL2RenderingContext, program: Program) {\r\n        const {vertexShader, fragmentShader, internalProgram} = program;\r\n        gl.deleteShader(vertexShader.internalShader);\r\n        gl.deleteShader(fragmentShader.internalShader);\r\n        gl.deleteProgram(internalProgram);\r\n    }\r\n\r\n    static useProgram(gl: WebGL2RenderingContext, program: Program) {\r\n        const {internalProgram} = program;\r\n        const currentProgram = gl.getParameter(gl.CURRENT_PROGRAM);\r\n        if (currentProgram !== internalProgram) {\r\n            gl.useProgram(internalProgram);\r\n        }\r\n    }\r\n}","import { Program, WebGLProgramUtilities } from \"./WebGLProgramUtilities\";\r\nimport { Texture } from \"./WebGLTextureUtilities\";\r\n\r\nexport { UniformValue };\r\nexport { Uniform };\r\nexport { UniformSetter };\r\nexport { UniformsListSetter };\r\nexport { WebGLUniformUtilities };\r\n\r\nexport enum UniformType {\r\n    BOOL = 0x8B56,\r\n    BOOL_VEC2 = 0x8B57,\t \r\n    BOOL_VEC3 = 0x8B58,\t \r\n    BOOL_VEC4 = 0x8B59,\r\n    INT = 0x1404,\r\n    INT_VEC2 = 0x8B53,\t \r\n    INT_VEC3 = 0x8B54,\t \r\n    INT_VEC4 = 0x8B55,\t \r\n    INT_SAMPLER_2D = 0x8DCA,\r\n    INT_SAMPLER_3D = 0x8DCB,\r\n    INT_SAMPLER_CUBE = 0x8DCC,\r\n    INT_SAMPLER_2D_ARRAY = 0x8DCF,\r\n    UNSIGNED_INT_SAMPLER_2D = 0x8DD2,\r\n    UNSIGNED_INT_SAMPLER_3D = 0x8DD3,\r\n    UNSIGNED_INT_SAMPLER_CUBE = 0x8DD4,\r\n    UNSIGNED_INT_SAMPLER_2D_ARRAY = 0x8DD7,\r\n    UNSIGNED_INT = 0x1405,\r\n    UNSIGNED_INT_VEC2 = 0x8DC6,\r\n    UNSIGNED_INT_VEC3 = 0x8DC7,\r\n    UNSIGNED_INT_VEC4 = 0x8DC8,\r\n    FLOAT = 0x1406,\r\n    FLOAT_VEC2 = 0x8B50,\t \r\n    FLOAT_VEC3 = 0x8B51,\t \r\n    FLOAT_VEC4 = 0x8B52,\r\n    FLOAT_MAT2 = 0x8B5A,\t \r\n    FLOAT_MAT3 = 0x8B5B,\t \r\n    FLOAT_MAT4 = 0x8B5C,\t \r\n    FLOAT_MAT2x3 = 0x8B65,\r\n    FLOAT_MAT2x4 = 0x8B66,\r\n    FLOAT_MAT3x2 = 0x8B67,\r\n    FLOAT_MAT3x4 = 0x8B68,\r\n    FLOAT_MAT4x2 = 0x8B69,\r\n    FLOAT_MAT4x3 = 0x8B6A,\r\n    SAMPLER_2D = 0x8B5E,\t \r\n    SAMPLER_3D = 0x8B5F,\r\n    SAMPLER_CUBE = 0x8B60,\r\n    SAMPLER_2D_SHADOW = 0x8B62,\r\n    SAMPLER_2D_ARRAY = 0x8DC1,\r\n    SAMPLER_2D_ARRAY_SHADOW = 0x8DC4,\r\n    SAMPLER_CUBE_SHADOW = 0x8DC5\r\n}\r\n\r\ntype UniformValue = number | Float32List | Uint32List | Int32List | Texture;\r\n\r\ntype Uniform = {\r\n    value: UniformValue;\r\n    srcOffset?: number;\r\n    srcLength?: number;\r\n    transpose?: boolean;\r\n}\r\n\r\ntype UniformSetter = {\r\n    type: UniformType;\r\n    set: (value: any) => void;\r\n}\r\n\r\ntype UniformsListSetter = {\r\n    setters: Record<string, UniformSetter>;\r\n    program: Program;\r\n}\r\n\r\nexport enum UniformDataType {\r\n    SCALAR = \"SCALAR\",\r\n    VEC2 = \"VEC2\",\r\n    VEC3 = \"VEC3\",\r\n    VEC4 = \"VEC4\",\r\n    MAT2 = \"MAT2\",\r\n    MAT3 = \"MAT3\",\r\n    MAT4 = \"MAT4\"\r\n}\r\n\r\nclass WebGLUniformUtilities {\r\n\r\n    static asArrayBufferView(uniformValue: UniformValue): ArrayBufferView {\r\n        if (typeof uniformValue === \"object\") {\r\n            if (\"buffer\" in uniformValue) {\r\n                return uniformValue;\r\n            }\r\n            else if (\"unit\" in uniformValue) {\r\n                return Float32Array.of(uniformValue.unit);\r\n            }\r\n            else {\r\n                return Float32Array.from(uniformValue);\r\n            }\r\n        }\r\n        else {\r\n            return Float32Array.of(uniformValue);\r\n        }\r\n    }\r\n\r\n    static getUniformSetter(gl: WebGL2RenderingContext, uniform: Uniform, location: WebGLUniformLocation , uniformType: UniformType): UniformSetter | null { \r\n        const {value, srcOffset, srcLength} = uniform;\r\n        let {transpose = false} = uniform;\r\n\r\n        switch (uniformType) {\r\n            case UniformType.FLOAT:\r\n                if (typeof value === \"number\") {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (num: number) => {\r\n                            gl.uniform1f(location, num);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.UNSIGNED_INT:\r\n                if (typeof value === \"number\") {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (num: number) => {\r\n                            gl.uniform1ui(location, num);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.BOOL:\r\n            case UniformType.INT:\r\n                if (typeof value === \"number\") {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (num: number) => {\r\n                            gl.uniform1i(location, num);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.INT_SAMPLER_2D:\r\n            case UniformType.INT_SAMPLER_2D_ARRAY:\r\n            case UniformType.INT_SAMPLER_3D:\r\n            case UniformType.INT_SAMPLER_CUBE:\r\n            case UniformType.SAMPLER_2D:\r\n            case UniformType.SAMPLER_3D:\r\n            case UniformType.SAMPLER_CUBE:\r\n            case UniformType.SAMPLER_2D_SHADOW:\r\n            case UniformType.SAMPLER_2D_ARRAY:\r\n            case UniformType.SAMPLER_2D_ARRAY_SHADOW:\r\n            case UniformType.SAMPLER_CUBE_SHADOW:\r\n            case UniformType.UNSIGNED_INT_SAMPLER_2D:\r\n            case UniformType.UNSIGNED_INT_SAMPLER_3D:\r\n            case UniformType.UNSIGNED_INT_SAMPLER_CUBE:\r\n            case UniformType.UNSIGNED_INT_SAMPLER_2D_ARRAY:\r\n                if (typeof value == \"object\" && \"unit\" in value) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (tex: Texture) => {\r\n                            const {unit} = tex;\r\n                            gl.uniform1i(location, unit);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_VEC2:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniform2fv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.BOOL_VEC2:\r\n            case UniformType.INT_VEC2:\r\n                if (value instanceof Int32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Int32List) => {\r\n                            gl.uniform2iv(location, list);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.UNSIGNED_INT_VEC2:\r\n                if (value instanceof Uint32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Uint32List) => {\r\n                            gl.uniform2uiv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_VEC3:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniform3fv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.BOOL_VEC3:\r\n            case UniformType.INT_VEC3:\t\r\n                if (value instanceof Int32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Int32List) => {\r\n                            gl.uniform3iv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.UNSIGNED_INT_VEC3:\r\n                if (value instanceof Uint32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Uint32List) => {\r\n                            gl.uniform3uiv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_VEC4:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniform4fv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.BOOL_VEC4:\r\n            case UniformType.INT_VEC4:\r\n                if (value instanceof Int32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Int32List) => {\r\n                            gl.uniform4iv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.UNSIGNED_INT_VEC4:\r\n                if (value instanceof Uint32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Uint32List) => {\r\n                            gl.uniform4uiv(location, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT2:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix2fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT3:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix3fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT4:\t\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix4fv(location, transpose!, list);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT2x3:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix2x3fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT2x4:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix2x4fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT3x2:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix3x2fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT3x4:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix3x4fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT4x2:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix4x2fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n            case UniformType.FLOAT_MAT4x3:\r\n                if (value instanceof Float32Array || Array.isArray(value)) {\r\n                    return {\r\n                        type: uniformType,\r\n                        set: (list: Float32List) => {\r\n                            gl.uniformMatrix4x3fv(location, transpose!, list, srcOffset, srcLength);\r\n                        }\r\n                    };\r\n                }\r\n                break;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static getUniformsListSetter(gl: WebGL2RenderingContext, program: Program, list: Record<string, Uniform>): UniformsListSetter | null {\r\n        const {internalProgram} = program;\r\n        \r\n        const uniformsNames = Object.keys(list);\r\n        let uniformIndices = gl.getUniformIndices(internalProgram, uniformsNames);\r\n        if (uniformIndices === null) {\r\n            console.error(`No uniform indices found.`);\r\n            return null;\r\n        }\r\n\r\n        const activeUniforms = gl.getProgramParameter(internalProgram, gl.ACTIVE_UNIFORMS);\r\n        const validUniformIndices = Array.from(uniformIndices).filter((index_i, i) => {\r\n            const isValid = index_i >= 0 && index_i < activeUniforms;\r\n            if (!isValid) {\r\n                console.warn(`Uniform ${uniformsNames[i]} could not be located.`);\r\n            }\r\n            return isValid;\r\n        });\r\n        \r\n        const setters: Record<string, UniformSetter> = {};\r\n\r\n        const activeUniformsInfo: WebGLActiveInfo[] = validUniformIndices.map(index => gl.getActiveUniform(internalProgram, index)!);\r\n        activeUniformsInfo.forEach(({name, type}) => {\r\n            const uniform = list[name];\r\n            const location = gl.getUniformLocation(internalProgram, name);\r\n            if (location === null) {\r\n                console.warn(`Uniform ${name} could not be located.`);\r\n                return null;\r\n            }\r\n            const setter = this.getUniformSetter(gl, uniform, location, type);\r\n            if (setter) {\r\n                setters[name] = setter;\r\n            }\r\n        });\r\n        \r\n        return {\r\n            setters,\r\n            program\r\n        };\r\n    }\r\n\r\n    static setUniformsListValues(gl: WebGL2RenderingContext, setter: UniformsListSetter, list: Record<string, Uniform>): void {\r\n        const {program, setters} = setter;\r\n        WebGLProgramUtilities.useProgram(gl, program);\r\n        \r\n        Object.entries(list).forEach(([uniformName, uniform]) => {\r\n            if (uniformName in setters) {\r\n                const setter = setters[uniformName];\r\n                const {value} = uniform;\r\n                setter.set(value);\r\n            }\r\n            else {\r\n                console.error(`Uniform ${uniformName} does not match any of the given setters.`);\r\n            }\r\n        });\r\n    }\r\n}","import { Uniform, WebGLUniformUtilities } from \"./WebGLUniformUtilities\";\r\nimport { Buffer, BufferDataUsage } from \"./WebGLBufferUtilities\";\r\nimport { Program } from \"./WebGLProgramUtilities\";\r\n\r\nexport type UniformBlock = {\r\n    name: string;\r\n    blockIndex: number;\r\n    program: Program;\r\n    layout: Record<string, {\r\n        byteOffset: number;\r\n    }>;\r\n    blockSize: number;\r\n    bindingPoint?: number;\r\n    buffer?: UniformBuffer;\r\n}\r\n\r\nexport type UniformBlockProperties = {\r\n    buffer?: number;\r\n    uniforms?: Record<string, Uniform>;\r\n}\r\n\r\nexport type UniformBuffer = Buffer & {\r\n    bindingPoint?: number;\r\n    rangeOffset?: number;\r\n    rangeSize?: number;\r\n}\r\n\r\nexport type UniformBufferProperties = {\r\n    usage: BufferDataUsage;\r\n    data?: ArrayBuffer;\r\n}\r\n\r\nexport type UniformBlocksProperties = {\r\n    buffers: (UniformBuffer | UniformBufferProperties)[];\r\n    blocks: Record<string, {\r\n        buffer: number;\r\n        uniforms: Record<string, Uniform>;\r\n    }>;\r\n}\r\n\r\nexport class WebGLUniformBlockUtilities {\r\n\r\n    static #bindingPoints: Map<string, number> = new Map();\r\n\r\n    static getBindingPointsEntries(): IterableIterator<[string, number]> {\r\n        const bindingPoints = this.#bindingPoints;\r\n        return bindingPoints.entries();\r\n    }\r\n\r\n    static createUniformBlock(gl: WebGL2RenderingContext, program: Program, name: string): UniformBlock | null {\r\n        const {internalProgram} = program;\r\n\r\n        const blockIndex = gl.getUniformBlockIndex(internalProgram, name);\r\n        if (blockIndex === gl.INVALID_INDEX) {\r\n            console.error(`Block '${name}' does not identify a valid uniform block.`);\r\n            return null;\r\n        }\r\n\r\n        const blockSize = gl.getActiveUniformBlockParameter(internalProgram, blockIndex, gl.UNIFORM_BLOCK_DATA_SIZE);\r\n        const layout: UniformBlock[\"layout\"] = {};\r\n        const blockUniformsIndices = gl.getActiveUniformBlockParameter(internalProgram, blockIndex, gl.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES);\r\n        const activeUniformsOffsets = gl.getActiveUniforms(internalProgram, blockUniformsIndices, gl.UNIFORM_OFFSET);\r\n        activeUniformsOffsets.forEach((uniformOffset_i: number, i: number) => {\r\n            const uniformIndex = blockUniformsIndices[i];\r\n            const uniformInfo = gl.getActiveUniform(internalProgram, uniformIndex);\r\n            if (uniformInfo !== null) {\r\n                const {name} = uniformInfo;\r\n                layout[name] = {\r\n                    byteOffset: uniformOffset_i\r\n                };\r\n            }\r\n        });\r\n\r\n        return {\r\n            name,\r\n            blockIndex,\r\n            blockSize,\r\n            layout,\r\n            program\r\n        };\r\n    }\r\n\r\n    static createUniformBuffer(gl: WebGL2RenderingContext, byteLength: number, bind?: boolean, usage?: BufferDataUsage): UniformBuffer | null {\r\n        const internalBuffer = gl.createBuffer();\r\n        if (internalBuffer === null) {\r\n            return null;\r\n        }\r\n        \r\n        const target = gl.UNIFORM_BUFFER;\r\n        gl.bindBuffer(target, internalBuffer);\r\n\r\n        usage = usage ?? BufferDataUsage.STATIC_READ;\r\n        bind = bind ?? false;\r\n\r\n        const bindingPoint = bind ? this.lastBindingPoint++ : undefined;\r\n        \r\n        gl.bufferData(target, byteLength, usage);\r\n        \r\n        return {\r\n            internalBuffer,\r\n            byteLength,\r\n            bindingPoint,\r\n            target,\r\n            usage\r\n        };\r\n    }\r\n\r\n    static createRangedUniformBuffers(gl: WebGL2RenderingContext, blocks: UniformBlock[], bind?: boolean, usage?: BufferDataUsage): UniformBuffer[] | null {\r\n\r\n        const offsetAlignment = gl.getParameter(gl.UNIFORM_BUFFER_OFFSET_ALIGNMENT);\r\n        const bufferByteLength = blocks.reduce(\r\n            (size, block) => size + Math.max(Math.ceil(block.blockSize / offsetAlignment), 1) * offsetAlignment, 0\r\n        );\r\n        \r\n        const buffer = this.createUniformBuffer(gl, bufferByteLength, false, usage);\r\n        if (buffer === null) {\r\n            return null;\r\n        }\r\n        \r\n        bind = bind ?? false;\r\n\r\n        let rangeOffset = 0;\r\n        const rangedUniformBuffers = blocks.map((block) => {\r\n            const {blockSize: rangeSize} = block;\r\n            const bindingPoint = bind ? this.lastBindingPoint++ : undefined;\r\n            const rangedUniformBuffer = {\r\n                ...buffer,\r\n                bindingPoint,\r\n                rangeOffset,\r\n                rangeSize\r\n            };\r\n            rangeOffset += Math.max(Math.ceil(rangeSize / offsetAlignment), 1) * offsetAlignment;\r\n            return rangedUniformBuffer;\r\n        });\r\n\r\n        return rangedUniformBuffers;\r\n    }\r\n\r\n    static setUniformBufferValues(gl: WebGL2RenderingContext, block: UniformBlock, buffer: UniformBuffer, uniforms: Record<string, Uniform>): void {\r\n        const {internalBuffer, target} = buffer;\r\n        const currentUniformBuffer = gl.getParameter(gl.UNIFORM_BUFFER_BINDING);\r\n        if (currentUniformBuffer !== internalBuffer) {\r\n            gl.bindBuffer(target, internalBuffer);\r\n        }\r\n        \r\n        const {layout, name} = block;\r\n        const {rangeOffset} = buffer;\r\n        Object.entries(uniforms).forEach(([uniformName, uniform]) => {\r\n            const {value} = uniform;\r\n            if (!(uniformName in layout)) {\r\n                console.warn(`${uniformName} does not exist in block ${name}.`);\r\n            }\r\n            const {byteOffset} = layout[uniformName];\r\n            gl.bufferSubData(target, byteOffset + (rangeOffset ?? 0), WebGLUniformUtilities.asArrayBufferView(value));\r\n        });\r\n    }\r\n\r\n    static setUniformBufferData(gl: WebGL2RenderingContext, buffer: UniformBuffer, data: ArrayBuffer | ArrayBufferView, dstByteOffset?: number, srcOffset?: number, length?: number): void {\r\n        const {internalBuffer, target} = buffer;\r\n        let {rangeOffset} = buffer;\r\n        gl.bindBuffer(target, internalBuffer);\r\n        const byteOffset = (rangeOffset ?? 0) + (dstByteOffset ?? 0);\r\n        if (data instanceof ArrayBuffer) {\r\n            gl.bufferSubData(target, byteOffset, data);\r\n        }\r\n        else {\r\n            srcOffset = srcOffset ?? 0;\r\n            gl.bufferSubData(target, byteOffset, data, srcOffset, length);\r\n        }\r\n    }\r\n\r\n    static lastBindingPoint = 0;\r\n\r\n    static bindUniformBuffer(gl: WebGL2RenderingContext, block: UniformBlock, buffer: UniformBuffer): void {\r\n        const {internalBuffer, target} = buffer;\r\n        let {rangeOffset, rangeSize} = buffer;\r\n        const {bindingPoint} = buffer;\r\n        const {program, blockIndex} = block;\r\n        const {internalProgram} = program;\r\n\r\n        if (bindingPoint !== undefined) {\r\n            block.buffer = buffer;\r\n            gl.uniformBlockBinding(internalProgram, blockIndex, bindingPoint);\r\n            \r\n            if (bindingPoint !== undefined) {\r\n                if (rangeOffset !== undefined && rangeSize !== undefined) {\r\n                    gl.bindBufferRange(target, bindingPoint, internalBuffer, rangeOffset, rangeSize);\r\n                }\r\n                else {\r\n                    gl.bindBufferBase(target, bindingPoint, internalBuffer);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","export enum StencilAction {\r\n    KEEP = 0x1E00,\r\n    REPLACE\t= 0x1E01,\r\n    INCR = 0x1E02,\r\n    DECR = 0x1E03,\r\n    INVERT = 0x150A,\r\n    INCR_WRAP = 0x8507,\r\n    DECR_WRAP = 0x8508\r\n}\r\n\r\nexport enum BufferMask {\r\n    DEPTH_BUFFER_BIT = 0x00000100,\r\n    STENCIL_BUFFER_BIT = 0x00000400,\r\n    COLOR_BUFFER_BIT = 0x00004000\r\n}\r\n\r\nexport enum Buffer {\r\n    COLOR = 0x1800,\r\n    DEPTH = 0x1801,\r\n    STENCIL = 0x1802,\r\n    DEPTH_STENCIL = 0x84F9\r\n}\r\n\r\nexport enum TestFunction {\r\n    NEVER = 0x0200,\r\n    LESS = 0x0201,\r\n    EQUAL = 0x0202,\r\n    LEQUAL = 0x0203,\r\n    GREATER = 0x0204,\r\n    NOTEQUAL = 0x0205,\r\n    GEQUAL = 0x0206,\r\n    ALWAYS = 0x0207,\r\n}\r\n\r\nexport enum BlendingMode {\r\n    ZERO = 0,\r\n    ONE = 1,\r\n    SRC_COLOR = 0x0300,\r\n    ONE_MINUS_SRC_COLOR = 0x0301,\r\n    SRC_ALPHA = 0x0302,\r\n    ONE_MINUS_SRC_ALPHA\t= 0x0303,\r\n    DST_ALPHA = 0x0304,\r\n    ONE_MINUS_DST_ALPHA = 0x0305,\r\n    DST_COLOR = 0x0306,\r\n    ONE_MINUS_DST_COLOR = 0x0307,\r\n    SRC_ALPHA_SATURATE = 0x0308,\r\n    CONSTANT_COLOR = 0x8001,\r\n    ONE_MINUS_CONSTANT_COLOR = 0x8002,\r\n    CONSTANT_ALPHA = 0x8003,\r\n    ONE_MINUS_CONSTANT_ALPHA = 0x8004\r\n}\r\n\r\nexport enum BlendingEquation {\r\n    FUNC_ADD = 0x8006,\r\n    FUNC_SUBTRACT = 0x800A,\r\n    FUNC_REVERSE_SUBTRACT = 0x800B,\r\n    MIN = 0x8007,\r\n    MAX = 0x8008,\r\n}\r\n\r\nexport enum Capabilities {\r\n    BLEND = 0x0BE2,\r\n    CULL_FACE = 0x0B44,\r\n    DEPTH_TEST = 0x0B71,\r\n    DITHER = 0x0BD0,\r\n    POLYGON_OFFSET_FILL = 0x8037,\r\n    SAMPLE_ALPHA_TO_COVERAGE = 0x809E,\r\n    SAMPLE_COVERAGE = 0x80A0,\r\n    SCISSOR_TEST = 0x0C11,\r\n    STENCIL_TEST= 0x0B90,\r\n    RASTERIZER_DISCARD = 0x8C89\r\n}\r\n\r\nexport enum Face {\r\n    FRONT = 0x0404,\r\n    BACK = 0x0405,\r\n    FRONT_AND_BACK = 0x0408\r\n}\r\n\r\nexport enum WindingOrder {\r\n    CW = 0x0900,\r\n    CCW = 0x0901\r\n}\r\n\r\nexport enum HintTarget {\r\n    GENERATE_MIPMAP_HINT = 0x8192,\r\n    FRAGMENT_SHADER_DERIVATIVE_HINT = 0x8B8B\r\n}\r\n\r\nexport enum HintMode {\r\n    DONT_CARE = 0x1100,\r\n    FASTEST\t= 0x1101,\r\n    NICEST = 0x1102\r\n}\r\n\r\nexport class WebGLRendererUtilities {\r\n\r\n    static hint(gl: WebGL2RenderingContext, target: HintTarget, mode: HintMode) {\r\n        gl.hint(target, mode);\r\n    }\r\n\r\n    static frontFace(gl: WebGL2RenderingContext, winding: WindingOrder): void {\r\n        gl.frontFace(winding);\r\n    }\r\n\r\n    static scissor(gl: WebGL2RenderingContext, x: number, y: number, width: number, height: number): void {\r\n        gl.scissor(x, y, width, height);\r\n    }\r\n\r\n    static viewport(gl: WebGL2RenderingContext, x: number, y: number, width: number, height: number): void {\r\n        gl.viewport(x, y, width, height);\r\n    }\r\n\r\n    static clearColor(gl: WebGL2RenderingContext, color: ArrayLike<number>): void {\r\n        gl.clearColor(color[0], color[1], color[2], color[3]);\r\n    }\r\n\r\n    static depthFunction(gl: WebGL2RenderingContext, func: TestFunction): void {\r\n        gl.depthFunc(func);\r\n    }\r\n\r\n    static blendEquation(gl: WebGL2RenderingContext, equ: BlendingEquation): void {\r\n        gl.blendEquation(equ);\r\n    }\r\n\r\n    static blendFunction(gl: WebGL2RenderingContext, srcFunc: BlendingMode, dstFunc: BlendingMode): void {\r\n        gl.blendFunc(srcFunc, dstFunc);\r\n    }\r\n\r\n    static blendFunctionSeparate(gl: WebGL2RenderingContext, srcFunc: BlendingMode, dstFunc: BlendingMode, srcAlpha: number, dstAlpha: number): void {\r\n        gl.blendFuncSeparate(srcFunc, dstFunc, srcAlpha, dstAlpha);\r\n    }\r\n\r\n    static stencilFunction(gl: WebGL2RenderingContext, func: TestFunction, ref: number, mask: number, face: Face): void {\r\n        gl.stencilFuncSeparate(face, func, ref, mask);\r\n    }\r\n\r\n    static stencilOperations(gl: WebGL2RenderingContext, fail: StencilAction, zFail: StencilAction, zPass: StencilAction, face: Face) {\r\n        gl.stencilOpSeparate(face, fail, zFail, zPass);\r\n    }\r\n\r\n    static stencilMask(gl: WebGL2RenderingContext, mask: number, face: Face) {\r\n        gl.stencilMaskSeparate(face, mask);\r\n    }\r\n\r\n    static colorMask(gl: WebGL2RenderingContext, red: boolean, green: boolean, blue: boolean, alpha: boolean) {\r\n        gl.colorMask(red, green, blue, alpha);\r\n    }\r\n\r\n    static depthMask(gl: WebGL2RenderingContext, flag: boolean) {\r\n        gl.depthMask(flag);\r\n    }\r\n\r\n    static enable(gl: WebGL2RenderingContext, capability: Capabilities): void {\r\n        gl.enable(capability);\r\n    }\r\n\r\n    static disable(gl: WebGL2RenderingContext, capability: Capabilities): void {\r\n        gl.disable(capability);\r\n    }\r\n\r\n    static clear(gl: WebGL2RenderingContext, buffer: BufferMask): void {\r\n        gl.clear(buffer);\r\n    }\r\n\r\n    static getViewport(gl: WebGL2RenderingContext): Int32Array {\r\n        return gl.getParameter(gl.VIEWPORT) as Int32Array;\r\n    }\r\n\r\n    static getMaxSamples(gl: WebGL2RenderingContext): number {\r\n        return gl.getParameter(gl.MAX_SAMPLES) as number;\r\n    }\r\n\r\n    static drawBuffers(gl: WebGL2RenderingContext, buffers: Iterable<number>): void {\r\n        gl.drawBuffers(buffers);\r\n    }\r\n\r\n    static clearBuffers(gl: WebGL2RenderingContext, buffer: Buffer, index: number, values: Float32Array | Int32Array | Uint32Array, srcOffset?: number): void {\r\n        if (values instanceof Float32Array) {\r\n            gl.clearBufferfv(buffer, index, values, srcOffset);\r\n        }\r\n        else if (values instanceof Int32Array) {\r\n            gl.clearBufferiv(buffer, index, values, srcOffset);\r\n        }\r\n        else if (values instanceof Uint32Array) {\r\n            gl.clearBufferuiv(buffer, index, values, srcOffset);\r\n        }\r\n    }\r\n}","import { VertexArray, VertexArrayValues, VertexArrayProperties, WebGLVertexArrayUtilities, DrawMode } from \"./WebGLVertexArrayUtilities\"\r\nimport { Texture, TextureProperties, WebGLTextureUtilities } from \"./WebGLTextureUtilities\"\r\nimport { UniformBlock, UniformBlockProperties, UniformBuffer, UniformBufferProperties, WebGLUniformBlockUtilities } from \"./WebGLUniformBlockUtilities\"\r\nimport { Uniform, UniformsListSetter, WebGLUniformUtilities } from \"./WebGLUniformUtilities\"\r\nimport { Program, ProgramProperties, WebGLProgramUtilities } from \"./WebGLProgramUtilities\"\r\n\r\nexport type PacketProperties = {\r\n    program: ProgramProperties | Program;\r\n    vertexArray: VertexArrayProperties;\r\n    uniformBuffers?: (UniformBufferProperties | UniformBuffer)[];\r\n    uniformBlocks?: Record<string, UniformBlockProperties>;\r\n    uniforms?: Record<string, Uniform>;\r\n    drawCommand: {\r\n        mode: DrawMode;\r\n        elementsCount?: number;\r\n        instanceCount?: number;\r\n        multiDraw?: {\r\n            firstsList?: Iterable<number> | Int32Array;\r\n            firstsOffset?: number;\r\n            countsList?: Iterable<number> | Int32Array;\r\n            countsOffset?: number;\r\n            offsetsList?: Iterable<number> | Int32Array;\r\n            offsetsOffset?: number;\r\n            instanceCountsList?: Iterable<number> | Int32Array;\r\n            instanceCountsOffset?: number;\r\n            drawCount?: number;\r\n        }\r\n    }\r\n}\r\n\r\nexport type PacketValues = {\r\n    vertexArray?: VertexArrayValues;\r\n    uniforms?: Record<string, Uniform>;\r\n    uniformBlocks?: Record<string, {\r\n        uniforms: Record<string, Uniform>;\r\n    }>;\r\n}\r\n\r\nexport type Packet = {\r\n    program: Program;\r\n    vertexArray: VertexArray;\r\n    uniforms?: UniformsListSetter;\r\n    uniformBlocks?: Record<string, UniformBlock>;\r\n    drawCommand: PacketDrawCommand;\r\n}\r\n\r\nexport interface PacketDrawCommand {\r\n    mode: DrawMode;\r\n    elementsCount?: number;\r\n    instanceCount?: number;\r\n    multiDraw?: {\r\n        firstsList?: Iterable<number> | Int32Array;\r\n        firstsOffset?: number;\r\n        countsList?: Iterable<number> | Int32Array;\r\n        countsOffset?: number;\r\n        offsetsList?: Iterable<number> | Int32Array;\r\n        offsetsOffset?: number;\r\n        instanceCountsList?: Iterable<number> | Int32Array;\r\n        instanceCountsOffset?: number;\r\n        drawCount?: number;\r\n    };\r\n}\r\n\r\nexport class WebGLPacketUtilities {\r\n\r\n    static createTextures(gl: WebGL2RenderingContext, textures: Record<string, TextureProperties>): Record<string, Texture> {\r\n        const _textures: {\r\n            [key: string]: Texture\r\n        } = {};\r\n        Object.entries(textures).forEach(([name, properties]) => {\r\n            const texture = WebGLTextureUtilities.createTexture(gl, name, properties);\r\n            if (texture !== null) {\r\n                _textures[name] = texture;\r\n            }\r\n        });\r\n        return _textures;\r\n    }\r\n    \r\n    static createPacket(gl: WebGL2RenderingContext, packet: PacketProperties): Packet | null {\r\n        const {program: programProperties, vertexArray: vertexArrayProperties, uniforms: uniformsProperties, uniformBlocks: uniformBlocksProperties, uniformBuffers: uniformBuffersProperties} = packet;\r\n        const {drawCommand} = packet;\r\n\r\n        let program: Program | null = null;\r\n        if (\"internalProgram\" in programProperties) {\r\n            program = programProperties;\r\n        }\r\n        else {\r\n            program = WebGLProgramUtilities.createProgram(gl, programProperties);\r\n        }\r\n        if (program === null) {\r\n            return null;\r\n        }\r\n        \r\n        let vertexArray: VertexArray | null = null;\r\n        vertexArray = WebGLVertexArrayUtilities.createVertexArray(gl, program, vertexArrayProperties);\r\n        if (vertexArray === null) {\r\n            return null;\r\n        }\r\n      \r\n        let uniforms: UniformsListSetter | null | undefined = undefined;\r\n        if (uniformsProperties !== undefined) {\r\n            uniforms = WebGLUniformUtilities.getUniformsListSetter(gl, program, uniformsProperties);\r\n            if (uniforms === null) {\r\n                return null;\r\n            }\r\n            WebGLUniformUtilities.setUniformsListValues(gl, uniforms, uniformsProperties);\r\n        }\r\n\r\n        let uniformBlocks: Record<string, UniformBlock> = {};\r\n        const uniformBlocksPropertiesEntries = uniformBlocksProperties ? Object.entries(uniformBlocksProperties) : [];\r\n        const uniformBuffersMaxIndex = (uniformBuffersProperties?.length ?? 0) - 1;\r\n        uniformBlocksPropertiesEntries.forEach(([_, uniformBlockProperty]) => {\r\n            const {buffer} = uniformBlockProperty;\r\n            if (buffer !== undefined && buffer > uniformBuffersMaxIndex) {\r\n                console.error(`Uniform buffer with index ${buffer} does not exist.`);\r\n            }\r\n        });\r\n        if (uniformBuffersProperties) {\r\n            uniformBuffersProperties.forEach(\r\n                (uniformBuffersProperty_i, i) => {\r\n                    const relatedBlockProperties = uniformBlocksPropertiesEntries.filter(\r\n                        ([_, uniformBlockProperty]) => uniformBlockProperty.buffer === i\r\n                    );\r\n                    const relatedBlocks = <UniformBlock[]>relatedBlockProperties.map(\r\n                        ([blockName, _]) => WebGLUniformBlockUtilities.createUniformBlock(gl, program!, blockName)\r\n                    );\r\n                    const {length: relatedBlocksCount} = relatedBlocks;        \r\n                    if (\"internalBuffer\" in uniformBuffersProperty_i) {\r\n                        relatedBlocks.forEach((block_i) => {\r\n                            const {name} = block_i!;\r\n                            WebGLUniformBlockUtilities.bindUniformBuffer(gl, block_i!, uniformBuffersProperty_i);\r\n                            uniformBlocks[name] = block_i!;\r\n                        });\r\n                    }\r\n                    else {\r\n                        if (relatedBlocksCount > 0) {\r\n                            const {usage, data} = uniformBuffersProperty_i;\r\n                            if (relatedBlocksCount > 1) {\r\n                                const rangedBuffers = WebGLUniformBlockUtilities.createRangedUniformBuffers(gl, <UniformBlock[]>relatedBlocks, true, usage)!;\r\n                                if (data) {\r\n                                    WebGLUniformBlockUtilities.setUniformBufferData(gl, rangedBuffers[0], data);\r\n                                }\r\n                                relatedBlocks.forEach((block_i, i) => {\r\n                                    const {name} = block_i!;\r\n                                    const rangedBuffer = rangedBuffers[i];\r\n                                    WebGLUniformBlockUtilities.bindUniformBuffer(gl, block_i!, rangedBuffer);\r\n                                    const {uniforms} = relatedBlockProperties[i][1];\r\n                                    if (uniforms) {\r\n                                        WebGLUniformBlockUtilities.setUniformBufferValues(gl, block_i, rangedBuffer, uniforms);\r\n                                    }\r\n                                    uniformBlocks[name] = block_i!;\r\n                                });\r\n                            }\r\n                            else {\r\n                                const relatedBlock = relatedBlocks[0];\r\n                                const {blockSize, name} = relatedBlock;\r\n                                const buffer = WebGLUniformBlockUtilities.createUniformBuffer(gl, blockSize, true, usage);\r\n                                if (buffer === null) {\r\n                                    return null;\r\n                                }\r\n                                if (data) {\r\n                                    WebGLUniformBlockUtilities.setUniformBufferData(gl, buffer, data);\r\n                                }\r\n                                WebGLUniformBlockUtilities.bindUniformBuffer(gl, relatedBlock!, buffer!);\r\n                                const {uniforms} = relatedBlockProperties[0][1];\r\n                                if (uniforms) {\r\n                                    WebGLUniformBlockUtilities.setUniformBufferValues(gl, relatedBlock, buffer, uniforms);\r\n                                }\r\n                                uniformBlocks[name] = relatedBlock!;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            );\r\n        }\r\n        const remainingBlockProperties = uniformBlocksPropertiesEntries.filter(\r\n            ([_, uniformBlockProperty]) => uniformBlockProperty.buffer === undefined\r\n        );\r\n        remainingBlockProperties.forEach(([blockName, uniformBlockProperties]) => {\r\n            const {uniforms} = uniformBlockProperties;\r\n            const block = WebGLUniformBlockUtilities.createUniformBlock(gl, program!, blockName);\r\n            if (block === null) {\r\n                return null;\r\n            }\r\n            const {blockSize} = block;\r\n            const buffer = WebGLUniformBlockUtilities.createUniformBuffer(gl, blockSize, true);\r\n            if (buffer === null) {\r\n                return null;\r\n            }\r\n            WebGLUniformBlockUtilities.bindUniformBuffer(gl, block, buffer);\r\n            if (uniforms !== undefined) {\r\n                WebGLUniformBlockUtilities.setUniformBufferValues(gl, block, buffer, uniforms);\r\n            }\r\n            uniformBlocks[blockName] = block;\r\n        });\r\n\r\n        return {\r\n            program,\r\n            vertexArray,\r\n            uniforms,\r\n            uniformBlocks,\r\n            drawCommand\r\n        };\r\n    }\r\n\r\n    static setPacketValues(gl: WebGL2RenderingContext, packet: Packet, values: PacketValues): void {\r\n        const {vertexArray: vertexArrayValues, uniforms: uniformsValues, uniformBlocks: uniformsBlocksValues} = values;\r\n        const {vertexArray, uniforms, uniformBlocks} = packet;\r\n\r\n        if (vertexArrayValues !== undefined) {\r\n            WebGLVertexArrayUtilities.setVertexArrayValues(gl, vertexArray, vertexArrayValues);\r\n        }\r\n        if (uniforms !== undefined && uniformsValues !== undefined) {\r\n            WebGLUniformUtilities.setUniformsListValues(gl, uniforms, uniformsValues);\r\n        }\r\n        if (uniformBlocks !== undefined && uniformsBlocksValues !== undefined) {\r\n            const uniformBlocksValuesEntries = uniformsBlocksValues ? Object.entries(uniformsBlocksValues) : [];\r\n            uniformBlocksValuesEntries.forEach(([blockName, uniformBlock]) => {\r\n                const {uniforms} = uniformBlock;\r\n                const block = uniformBlocks[blockName];\r\n                const {buffer} = block;\r\n                if (buffer) {\r\n                    WebGLUniformBlockUtilities.setUniformBufferValues(gl, block, buffer, uniforms);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    static #multiDrawExtension: WEBGL_multi_draw | null = null;\r\n\r\n    static enableMultidrawExtension(gl: WebGL2RenderingContext) {\r\n        this.#multiDrawExtension = gl.getExtension(\"WEBGL_multi_draw\");\r\n    }\r\n\r\n    static drawPacket(gl: WebGL2RenderingContext, packet: Packet, drawCommand: PacketDrawCommand = packet.drawCommand): void {\r\n        const {vertexArray} = packet;\r\n        const {program, internalVertexArray, elementBuffer} = vertexArray;\r\n        const {mode, elementsCount, instanceCount, multiDraw} = drawCommand;\r\n\r\n        WebGLProgramUtilities.useProgram(gl, program);\r\n        \r\n        const currentVertexArray = gl.getParameter(gl.VERTEX_ARRAY_BINDING);\r\n        if (currentVertexArray !== internalVertexArray) {\r\n            gl.bindVertexArray(internalVertexArray);\r\n        }\r\n        \r\n        if (elementBuffer) {\r\n            const {indexType} = elementBuffer;\r\n            if (instanceCount !== undefined && elementsCount !== undefined) {\r\n                gl.drawElementsInstanced(mode, elementsCount, indexType, 0, instanceCount);\r\n            }\r\n            else if (multiDraw) {\r\n                const multiDrawExtension = this.#multiDrawExtension!;\r\n                const {countsList, countsOffset, offsetsList, offsetsOffset, drawCount, instanceCountsList, instanceCountsOffset} = multiDraw;\r\n                if (instanceCountsList !== undefined && instanceCountsOffset !== undefined) {\r\n                    multiDrawExtension.multiDrawElementsInstancedWEBGL(\r\n                        mode, countsList!, countsOffset!, indexType!,\r\n                        offsetsList!, offsetsOffset!, instanceCountsList, instanceCountsOffset, drawCount!\r\n                    );\r\n                }\r\n                else {\r\n                    multiDrawExtension.multiDrawElementsWEBGL(\r\n                        mode, countsList!, countsOffset!, indexType!,\r\n                        offsetsList!, offsetsOffset!, drawCount!\r\n                    );\r\n                }\r\n            }\r\n            else if (elementsCount !== undefined) {\r\n                gl.drawElements(mode, elementsCount, indexType, 0);\r\n            }\r\n        }\r\n        else {\r\n            if (instanceCount !== undefined && elementsCount !== undefined) {\r\n                gl.drawArraysInstanced(mode, 0, elementsCount, instanceCount);\r\n            }\r\n            else if (multiDraw) {\r\n                const multiDrawExtension = this.#multiDrawExtension!;\r\n                const {countsList, countsOffset, firstsList, firstsOffset, drawCount, instanceCountsList, instanceCountsOffset} = multiDraw;\r\n                if (instanceCountsList !== undefined && instanceCountsOffset !== undefined) {\r\n                    multiDrawExtension.multiDrawArraysInstancedWEBGL(\r\n                        mode, firstsList!, firstsOffset!,\r\n                        countsList!, countsOffset!, instanceCountsList, instanceCountsOffset, drawCount!\r\n                    );\r\n                }\r\n                else {\r\n                    multiDrawExtension.multiDrawArraysWEBGL(\r\n                        mode, firstsList!, firstsOffset!, \r\n                        countsList!, countsOffset!, drawCount!\r\n                    );\r\n                }\r\n            }\r\n            else if (elementsCount !== undefined) {\r\n                gl.drawArrays(mode, 0, elementsCount);\r\n            }\r\n        }\r\n    }\r\n}","export { ColorValues };\r\nexport { Color };\r\n\r\ntype ColorValues = [number, number, number];\r\n\r\ninterface ColorConstructor {\r\n    readonly prototype: Color;\r\n    new(): Color;\r\n    new(r: number, g: number, b: number): Color;\r\n    new(r: number, g: number, b: number, a: number): Color;\r\n    readonly YELLOW: Color;\r\n    readonly BLACK: Color;\r\n    readonly RED: Color;\r\n    readonly GREEN: Color;\r\n    readonly BLUE: Color;\r\n    readonly WHITE: Color;\r\n    array(...colors: Color[]): number[];\r\n    lerp(a: Color, b: Color, t: number): Color;\r\n    rgb(r: number, g: number, b: number): Color;\r\n    rgba(rgb: Color): Color;\r\n    rgba(rgb: Color, a: number): Color;\r\n    rgba(r: number, g: number, b: number, a: number): Color;\r\n}\r\n\r\ninterface Color extends ArrayLike<number>, Iterable<number> {\r\n    readonly array: Float32Array;\r\n    readonly length: number;\r\n    0: number;\r\n    1: number;\r\n    2: number;\r\n    3: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n    a: number;\r\n    copy(color: Color): Color;\r\n    clone(): Color;\r\n    getValues(): ColorValues;\r\n    setValues(\r\n        r: number,\r\n        g: number,\r\n        b: number,\r\n        a?: number\r\n    ): Color;\r\n    lerp(color: Color, t: number): Color;\r\n    normalize(): Color;\r\n}\r\n\r\nclass ColorBase implements Color {\r\n    [index: number]: number;\r\n    readonly array: Float32Array;\r\n\r\n\tconstructor()\r\n    constructor(r: number, g: number, b: number)\r\n    constructor(r: number, g: number, b: number, a: number)\r\n    constructor(r?: number, g?: number, b?: number, a?: number) {\r\n\t\tthis.array = a !== undefined ? new Float32Array([\r\n            r ?? 0, g ?? 0, b ?? 0, a\r\n        ]) : new Float32Array([\r\n            r ?? 0, g ?? 0, b ?? 0\r\n        ]);\r\n    }\r\n    \r\n    static readonly BLACK = new ColorBase(0, 0, 0);\r\n    static readonly RED = new ColorBase(1, 0, 0);\r\n    static readonly YELLOW = new ColorBase(1, 1, 0);\r\n    static readonly GREEN = new ColorBase(0, 1, 0);\r\n    static readonly BLUE = new ColorBase(0, 0, 1);\r\n    static readonly WHITE = new ColorBase(1, 1, 1);\r\n\r\n    static rgb(r: number, g: number, b: number): Color {\r\n        return new Color(r, g, b);\r\n    }\r\n\r\n    static rgba(rgb: Color): Color;\r\n    static rgba(rgb: Color, a: number): Color;\r\n    static rgba(r: number, g: number, b: number, a: number): Color;\r\n    static rgba(rgbOrR: any, aOrG?: number, b?: number, a?: number): Color {\r\n        if (rgbOrR instanceof Color) {\r\n            const {r, g, b} = rgbOrR;\r\n            return aOrG !== undefined ?\r\n                new Color(r, g, b, aOrG) :\r\n                new Color(r, g, b, 1.0);\r\n        }\r\n        else {\r\n            return new Color(rgbOrR, aOrG!, b!, a!);\r\n        }\r\n    }\r\n\r\n    static array(...colors: Color[]): number[] {\r\n        const a = new Array<number>(colors.length * 4);\r\n        let c;\r\n        let i = 0;\r\n        for (const color of colors) {\r\n            c = color.array;\r\n            a[i + 0] = c[0];\r\n            a[i + 1] = c[1];\r\n            a[i + 2] = c[2];\r\n            i += 3;\r\n        }\r\n        return a;\r\n    }\r\n\r\n    get length(): number {\r\n        return 3;\r\n    }\r\n\r\n    get r(): number {\r\n        return this.array[0];\r\n    }\r\n\r\n    set r(r: number) {\r\n        this.array[0] = r;\r\n    }\r\n\r\n    get g(): number {\r\n        return this.array[1];\r\n    }\r\n\r\n    set g(g: number) {\r\n        this.array[1] = g;\r\n    }\r\n\r\n    get b(): number {\r\n        return this.array[2];\r\n    }\r\n\r\n    set b(b: number) {\r\n        this.array[2] = b;\r\n    }\r\n\r\n    get a(): number {\r\n        return this.array[3];\r\n    }\r\n\r\n    set a(a: number) {\r\n        this.array[3] = a;\r\n    }\r\n\r\n    get 0(): number {\r\n        return this.array[0];\r\n    }\r\n\r\n    set 0(r: number) {\r\n        this.array[0] = r;\r\n    }\r\n\r\n    get 1(): number {\r\n        return this.array[1];\r\n    }\r\n\r\n    set 1(g: number) {\r\n        this.array[1] = g;\r\n    }\r\n\r\n    get 2(): number {\r\n        return this.array[2];\r\n    }\r\n\r\n    set 2(b: number) {\r\n        this.array[2] = b;\r\n    }\r\n\r\n    get 3(): number {\r\n        return this.array[3];\r\n    }\r\n\r\n    set 3(a: number) {\r\n        this.array[3] = a;\r\n    }\r\n\r\n    setValues(r: number, g: number, b: number): this {\r\n\t\tconst {array} = this;\r\n\r\n\t\tarray[0] = r;\r\n\t\tarray[1] = g;\r\n\t\tarray[2] = b;\r\n\r\n\t\treturn this;\r\n    }\r\n    \r\n    getValues(): ColorValues {\r\n\t\tconst {array} = this;\r\n\t\t\r\n\t\treturn [\r\n\t\t\tarray[0], array[1], array[2]\r\n\t\t];\r\n\t}\r\n    \r\n    copy(color: Color): this {\r\n        const {array} = this;\r\n        const {r, g, b} = color;\r\n\r\n        array[0] = r;\r\n        array[1] = g;\r\n        array[2] = b;\r\n\r\n        return this;\r\n\t}\r\n\r\n\tclone(): this {\r\n\t\treturn <this>(new ColorBase()).copy(this);\r\n    }\r\n\r\n    static lerp(a: Color, b: Color, t: number): Color {\r\n\t\treturn a.lerp(b, t);\r\n\t}\r\n    \r\n    lerp(color: Color, t: number): this {\r\n        const {array} = this;\r\n        const {r, g, b} = color;\r\n\r\n\t\tarray[0] = t * (r - array[0]);\r\n\t\tarray[1] = t * (g - array[1]);\r\n\t\tarray[2] = t * (b - array[2]);\r\n\r\n\t\treturn this;\r\n\t}\r\n    \r\n\tnormalize(): this {\r\n\t\tconst {array} = this;\r\n\t\tconst length = 255;\r\n        array[0] /= length;\r\n        array[1] /= length;\r\n        array[2] /= length;\r\n\t\treturn this;\r\n\t}\r\n\r\n    [Symbol.iterator] (): Iterator<number> {\r\n\t\tconst {array} = this;\r\n\t\tconst {length} = array;\r\n\t\tlet i = 0;\r\n\t\treturn {\r\n\t\t\tnext() {\r\n\t\t\t\tif (i < length) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: array[i++], done: false\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: undefined, done: true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst Color: ColorConstructor = ColorBase;","import { IcosahedronGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/polyhedron/IcosahedronGeometry\";\r\nimport { ArcballCameraControl } from \"../../engine/core/controls/ArcballCameraControl\";\r\nimport { FreeCameraControl } from \"../../engine/core/controls/FreeCameraControl\";\r\nimport { Transform } from \"../../engine/core/general/Transform\";\r\nimport { Input } from \"../../engine/core/input/Input\";\r\nimport { PerspectiveCamera } from \"../../engine/core/rendering/scenes/cameras/PerspectiveCamera\";\r\nimport { GeometryBuffer } from \"../../engine/core/rendering/scenes/geometries/GeometryBuffer\";\r\nimport { CubeGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/polyhedron/CubeGeometry\";\r\nimport { QuadGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/QuadGeometry\";\r\nimport { BufferDataUsage } from \"../../engine/core/rendering/webgl/WebGLBufferUtilities\";\r\nimport { FramebufferAttachment, FramebufferTextureTarget, RenderbufferPixelFormat, WebGLFramebufferUtilities } from \"../../engine/core/rendering/webgl/WebGLFramebufferUtilities\";\r\nimport { WebGLPacketUtilities, PacketProperties, PacketValues } from \"../../engine/core/rendering/webgl/WebGLPacketUtilities\";\r\nimport { WebGLProgramUtilities } from \"../../engine/core/rendering/webgl/WebGLProgramUtilities\";\r\nimport { BlendingEquation, BlendingMode, BufferMask, Capabilities, TestFunction, WebGLRendererUtilities, WindingOrder } from \"../../engine/core/rendering/webgl/WebGLRendererUtilities\";\r\nimport { TexturePixelFormat, TexturePixelType, TextureMagFilter, TextureMinFilter, TextureTarget, TextureWrapMode, WebGLTextureUtilities, TextureInternalPixelFormat } from \"../../engine/core/rendering/webgl/WebGLTextureUtilities\";\r\nimport { WebGLUniformBlockUtilities } from \"../../engine/core/rendering/webgl/WebGLUniformBlockUtilities\";\r\nimport { AttributeDataType, DataComponentType, DrawMode, WebGLVertexArrayUtilities } from \"../../engine/core/rendering/webgl/WebGLVertexArrayUtilities\";\r\nimport { Color } from \"../../engine/libs/graphics/colors/Color\";\r\nimport { Matrix4 } from \"../../engine/libs/maths/algebra/matrices/Matrix4\";\r\nimport { Quaternion } from \"../../engine/libs/maths/algebra/quaternions/Quaternion\";\r\nimport { Vector3, Vector3Values } from \"../../engine/libs/maths/algebra/vectors/Vector3\";\r\nimport { Space } from \"../../engine/libs/maths/geometry/space/Space\";\r\nimport { addWidgets, createPositionWidgets, createRelativePositionWidgets, createRotationWidgets } from \"./Common\";\r\nimport { SphereGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/SphereGeometry\";\r\nimport { CylinderGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/polyhedron/CylinderGeometry\";\r\nimport { DodecahedronGeometry } from \"../../engine/core/rendering/scenes/geometries/lib/polyhedron/DodecahedronGeometry\";\r\nimport { HTMLEToolBarElement, HTMLEToolBarItemElement } from \"editor/lib/elements/containers/toolbars\";\r\n\r\nconst simpleSceneDOM = /*html*/`\r\n<!--<link rel=\"stylesheet\" href=\"./css/main.css\"/>-->\r\n  <div class=\"flex-auto flex-cols\">\r\n    <main class=\"flex-rows flex-auto\">\r\n        <section class=\"centered padded\">\r\n          <div id=\"canvas-container\" style=\"position: relative;\">\r\n            <canvas id=\"canvas\" tabindex=\"0\" oncontextmenu=\"return false;\"></canvas>\r\n            <canvas id=\"canvas-2d\" tabindex=\"0\" style=\"display: block; position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;\"></canvas>\r\n          </div>\r\n          <!--\r\n          <style>\r\n            circle:hover {\r\n              fill: rgb(255, 0, 0);\r\n            }\r\n          </style>\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" width=\"100\" height=\"100\">\r\n            <circle cx=\"10\" cy=\"10\" r=\"4\"/>\r\n          </svg>\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 200 200\" width=\"200\" height=\"200\" id=\"save\" fill=\"none\">\r\n            <g>\r\n              <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"red\"></rect>\r\n              <text text-anchor=\"middle\" alignment-baseline=\"middle\" x=\"50\" y=\"50\" font-family=\"Verdana\" fill=\"blue\">Hello,World!</text>\r\n            </g>\r\n          </svg>\r\n          -->\r\n        </section>\r\n    </main>\r\n  </div>`;\r\n\r\nexport async function start() {\r\n  const template = document.createElement(\"template\");\r\n  template.innerHTML = simpleSceneDOM;\r\n  document.body.insertBefore(template.content, document.body.firstChild);\r\n\r\n  /*let onCapture = false;\r\n  const handlePointerUpEvent = (event: PointerEvent) => {\r\n    const {target, pointerId} = event;\r\n    if (target instanceof Element && target.tagName == \"circle\") {\r\n      (<Element>target).releasePointerCapture(pointerId);\r\n      onCapture = false;\r\n    }\r\n  }\r\n  const handlePointerDownEvent = (event: PointerEvent) => {\r\n    const {target, pointerId} = event;\r\n    if (target instanceof Element && target.tagName == \"circle\") {\r\n      (<Element>target).setPointerCapture(pointerId);\r\n      onCapture = true;\r\n    }\r\n  }\r\n  const handlePointerOutEvent = (event: PointerEvent) => {\r\n    const {target, pointerId} = event;\r\n    if (target instanceof Element && target.tagName == \"circle\") {\r\n      (<Element>target).releasePointerCapture(pointerId);\r\n      onCapture = false;\r\n    }\r\n  }\r\n  const handlePointerMoveEvent = (event: PointerEvent) => {\r\n    if (onCapture) {\r\n      const {currentTarget, clientX, clientY} = event;\r\n      const svg = <Element>currentTarget;\r\n      const {\r\n        right: svgRight, left: svgLeft, width: svgWidth,\r\n        bottom: svgBottom, top: svgTop, height: svgHeight\r\n      } = svg.getBoundingClientRect();\r\n      const {target} = event;\r\n      const targetElement = <Element>target;\r\n      const [viewMinX, viewMinY, viewMaxX, viewMaxY] = svg.getAttribute(\"viewBox\")!.split(\" \").map(value => parseFloat(value));\r\n      const offsetX = (Math.min(svgRight, Math.max(clientX, svgLeft)) - svgLeft) / svgWidth;\r\n      const offsetY = (Math.min(svgBottom, Math.max(clientY, svgTop)) - svgTop) / svgHeight;\r\n      const newTargetX = Math.round(offsetX * (viewMaxX - viewMinX));\r\n      const newTargetY = Math.round(offsetY * (viewMaxY - viewMinY));\r\n      targetElement.setAttribute(\"cx\", `${newTargetX}`);\r\n      targetElement.setAttribute(\"cy\", `${newTargetY}`);\r\n    }\r\n  }\r\n  const svg = document.querySelector(\"svg\");\r\n  svg!.addEventListener(\"pointerdown\", handlePointerDownEvent);\r\n  svg!.addEventListener(\"pointermove\", handlePointerMoveEvent);\r\n  svg!.addEventListener(\"pointerup\", handlePointerUpEvent);\r\n  svg!.addEventListener(\"pointerout\", handlePointerOutEvent);*/\r\n\r\n  try {\r\n    launchScene();\r\n  }\r\n  catch (e) {\r\n    console.trace(e);\r\n  }\r\n}\r\n/*\r\nlet file: File | undefined;\r\nconst input = document.createElement(\"input\");\r\ninput.type = \"file\";\r\ndocument.body.append(input);\r\ninput.addEventListener(\"input\", () => {\r\n  file = input.files![0];\r\n  launchScene();\r\n});\r\n*/\r\nexport async function launchScene() {\r\n  let render: (time: number) => void;\r\n  let fps: number = 0;\r\n  let playing = false;\r\n\r\n  const toolbar = document.querySelector<HTMLEToolBarElement>(\"e-toolbar\");/*getElementById('playpause') as HTMLButtonElement;*/\r\n  if (toolbar !== null) {\r\n    toolbar.onclick = (event) => {\r\n      const item = (<Element>event.target).closest(\"e-toolbaritem\");\r\n      if (item) {\r\n        switch (item.name) {\r\n          case \"play-pause\": {\r\n            playing = item.pressed;\r\n            if (playing) {\r\n              requestAnimationFrame(render);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  const canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\r\n  if (!canvas) {\r\n    return;\r\n  }\r\n\r\n  const canvas2D = document.getElementById(\"canvas-2d\") as HTMLCanvasElement;\r\n  if (!canvas2D) {\r\n    return;\r\n  }\r\n\r\n  const ctx = canvas2D.getContext(\"2d\");\r\n  if (!ctx) {\r\n    return;\r\n  }\r\n  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\r\n  \r\n  const CANVAS_WIDTH = 900;\r\n  const CANVAS_HEIGHT = 600;\r\n  const supersamplingRatio = 1;\r\n  canvas.width = CANVAS_WIDTH * supersamplingRatio;\r\n  canvas.height = CANVAS_HEIGHT * supersamplingRatio;\r\n  canvas.style.width = `${CANVAS_WIDTH}px`;\r\n  canvas.style.height = `${CANVAS_HEIGHT}px`;\r\n\r\n  canvas2D.width = CANVAS_WIDTH;\r\n  canvas2D.height = CANVAS_HEIGHT;\r\n  canvas2D.style.width = `${CANVAS_WIDTH}px`;\r\n  canvas2D.style.height = `${CANVAS_HEIGHT}px`;\r\n  \r\n  const gl = canvas.getContext(\"webgl2\");\r\n  if (!gl) {\r\n    return;\r\n  }\r\n\r\n  WebGLTextureUtilities.setUnpackAlignment(gl, 1);\r\n\r\n  // Shaders\r\n  const phongVert = await fetch(\"assets/engine/shaders/common/phong.vert.glsl\").then(resp => resp.text());\r\n  const phongFrag = await fetch(\"assets/engine/shaders/common/phong.frag.glsl\").then(resp => resp.text());\r\n  const phongProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: phongVert, fragmentSource: phongFrag});\r\n  if (phongProgram === null) return;\r\n\r\n  const skyboxVert = await fetch(\"assets/engine/shaders/common/skybox.vert\").then(resp => resp.text());\r\n  const skyboxFrag = await fetch(\"assets/engine/shaders/common/skybox.frag\").then(resp => resp.text());\r\n  const skyboxProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: skyboxVert, fragmentSource: skyboxFrag});\r\n  if (skyboxProgram === null) return;\r\n  \r\n  const textureVert = await fetch(\"assets/engine/shaders/common/texture.vert\").then(resp => resp.text());\r\n  const textureFrag = await fetch(\"assets/engine/shaders/common/texture.frag\").then(resp => resp.text());\r\n  const texProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: textureVert, fragmentSource: textureFrag});\r\n  if (texProgram === null) return;\r\n\r\n  const basicVert = await fetch(\"assets/engine/shaders/common/basic.vert.glsl\").then(resp => resp.text());\r\n  const basicFrag = await fetch(\"assets/engine/shaders/common/basic.frag.glsl\").then(resp => resp.text());\r\n  const basicProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: basicVert, fragmentSource: basicFrag});\r\n  if (basicProgram === null) return;\r\n  \r\n  const depthVert = await fetch(\"assets/engine/shaders/common/depth.vert.glsl\").then(resp => resp.text());\r\n  const depthFrag = await fetch(\"assets/engine/shaders/common/depth.frag.glsl\").then(resp => resp.text());\r\n  const depthProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: depthVert, fragmentSource: depthFrag});\r\n  if (depthProgram === null) return;\r\n\r\n  const linesVertex = await fetch(\"assets/engine/shaders/common/lines.vert.glsl\").then(resp => resp.text());\r\n  const linesFragment = await fetch(\"assets/engine/shaders/common/lines.frag.glsl\").then(resp => resp.text());\r\n  const linesProgram = WebGLProgramUtilities.createProgram(gl, {vertexSource: linesVertex, fragmentSource: linesFragment});\r\n  if (linesProgram === null) return;\r\n\r\n  async function fetchImage(url: string) {\r\n    return fetch(url).then((resp) => {\r\n      if (resp.ok) {\r\n        return new Promise<HTMLImageElement>((resolve) => {\r\n          const img = new Image();\r\n          img.onload = () => {\r\n            resolve(img);\r\n          };\r\n          img.src = url;\r\n        })\r\n      }\r\n      else {\r\n        throw new Error(`Image '${url}' not found.`);\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Images\r\n  const albedoMapImg = await fetchImage(\"assets/engine/img/NormalMap.png\");\r\n  const brickwallImg = await fetchImage(\"assets/engine/img/brickwall.jpg\");\r\n  const normalMapImg = await fetchImage(\"assets/engine/img/NormalMap_0.png\");\r\n  const normalMap2Img = await fetchImage(\"assets/engine/img/Normal_Map_1024.png\");\r\n  const displacementMapImg = await fetchImage(\"assets/engine/img/DisplacementMap.png\");\r\n  const skyboxXPosImg = await fetchImage(\"assets/engine/img/skybox_x_pos.png\");\r\n  const skyboxXNegImg = await fetchImage(\"assets/engine/img/skybox_x_neg.png\");\r\n  const skyboxYPosImg = await fetchImage(\"assets/engine/img/skybox_y_pos.png\");\r\n  const skyboxYNegImg = await fetchImage(\"assets/engine/img/skybox_y_neg.png\");\r\n  const skyboxZPosImg = await fetchImage(\"assets/engine/img/skybox_z_pos.png\");\r\n  const skyboxZNegImg = await fetchImage(\"assets/engine/img/skybox_z_neg.png\");\r\n  const colorsImg = await fetchImage(\"assets/engine/img/colors.png\");\r\n\r\n  const PADDING = 1;\r\n\r\n  const paddedImage = function(image: HTMLImageElement) {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const {width, height} = image;\r\n    const paddedWidth = width + PADDING * 2;\r\n    const paddedHeight = height + PADDING * 2;\r\n    canvas.width = paddedWidth;\r\n    canvas.height = paddedHeight;\r\n    const ctx = canvas.getContext(\"2d\")!;\r\n    // Draws upper and lower extensions\r\n    /*ctx.drawImage(image, 0, 0, width, 1, 0, 0, paddedWidth, 1);\r\n    ctx.drawImage(image, 0, height - 1, width, 1, 0, height + 1, paddedWidth, 1);\r\n    // Draws left and right extensions\r\n    ctx.drawImage(image, 0, 0, 1, height, 0, 0, 1, paddedHeight);\r\n    ctx.drawImage(image, width - 1, 0, 1, height, width + 1, 0, 1, paddedHeight);*/\r\n    \r\n    // Draws original image\r\n    ctx.drawImage(image, 0, 0, paddedWidth, paddedHeight);\r\n    ctx.drawImage(image, PADDING, PADDING, width, height);\r\n    const data = ctx.getImageData(0, 0, paddedWidth, paddedHeight);\r\n    /*document.body.append(image);\r\n    const img = new Image();\r\n    img.src = canvas.toDataURL();\r\n    document.body.append(img);*/\r\n    return {\r\n      width,\r\n      height,\r\n      paddedWidth,\r\n      paddedHeight, \r\n      data\r\n    };\r\n  }\r\n\r\n  const paddedBrickwallImg = paddedImage(brickwallImg);\r\n  const paddedAlbedoMapImg = paddedImage(albedoMapImg);\r\n  const paddedNormalMap2 = paddedImage(normalMap2Img);\r\n  const paddedColorsImg = paddedImage(colorsImg);\r\n  /*const norm16Extension = gl.getExtension(\"EXT_texture_norm16\");\r\n  if (norm16Extension) {\r\n    console.log(`Extension EXT_texture_norm16 activated.`);\r\n  }*/\r\n\r\n  const textures = WebGLPacketUtilities.createTextures(gl, {\r\n    // albedoMap: {\r\n    //   pixels: albedoMapImg,\r\n    //   width: albedoMapImg.width, height: albedoMapImg.height,\r\n    //   target: TextureTarget.TEXTURE_2D,\r\n    //   type: TexturePixelType.UNSIGNED_BYTE,\r\n    //   format: TexturePixelFormat.RGB,\r\n    //   internalFormat: TextureInternalPixelFormat.RGB,\r\n\r\n    //   min: TextureMinFilter.NEAREST,\r\n    //   mag: TextureMagFilter.NEAREST,\r\n    // },\r\n    albedoMap: {\r\n      pixels: null,\r\n      width: 8, height: 8, depth: 2,\r\n      // pixels: albedoMapImg,\r\n      // width: albedoMapImg.width, height: albedoMapImg.height,\r\n      target: TextureTarget.TEXTURE_2D_ARRAY,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n\r\n      /*wrapS: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapT: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapR: TextureWrapMode.CLAMP_TO_EDGE,*/\r\n\r\n      format: TexturePixelFormat.LUMINANCE,\r\n      internalFormat: TextureInternalPixelFormat.LUMINANCE,\r\n\r\n      // format: TexturePixelFormat.RGB,\r\n      // internalFormat: TextureInternalPixelFormat.RGB\r\n\r\n      min: TextureMinFilter.NEAREST,\r\n      mag: TextureMagFilter.NEAREST,\r\n\r\n      subimages: [\r\n        {\r\n          pixels: new Uint8Array([\r\n            0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC,\r\n            0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF,\r\n            0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC,\r\n            0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF,\r\n            0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC,\r\n            0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF,\r\n            0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC,\r\n            0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF, 0xCC, 0xFF,\r\n          ]),\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 0,\r\n          width: 8,\r\n          height: 8,\r\n          depth: 1\r\n        },\r\n        {\r\n          pixels: new Uint8Array([\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n            0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC,\r\n          ]),\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 1,\r\n          width: 8,\r\n          height: 8,\r\n          depth: 1\r\n        }\r\n      ]\r\n    },\r\n    albedoMaps: {\r\n      pixels: null,\r\n      width: paddedBrickwallImg.paddedWidth, height: paddedBrickwallImg.paddedHeight, depth: 4,\r\n      target: TextureTarget.TEXTURE_2D_ARRAY,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGB,\r\n      internalFormat: TextureInternalPixelFormat.RGB,\r\n      subimages: [\r\n        {\r\n          pixels: paddedBrickwallImg.data,\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 0,\r\n          width: paddedBrickwallImg.paddedWidth,\r\n          height: paddedBrickwallImg.paddedHeight,\r\n          depth: 1\r\n        },\r\n        {\r\n          pixels: paddedAlbedoMapImg.data,\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 1,\r\n          width: paddedAlbedoMapImg.paddedWidth,\r\n          height: paddedAlbedoMapImg.paddedHeight,\r\n          depth: 1\r\n        },\r\n        {\r\n          pixels: paddedNormalMap2.data,\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 2,\r\n          width: paddedNormalMap2.paddedWidth,\r\n          height: paddedNormalMap2.paddedHeight,\r\n          depth: 1\r\n        },\r\n        {\r\n          pixels: paddedColorsImg.data,\r\n          xoffset: 0,\r\n          yoffset: 0,\r\n          zoffset: 3,\r\n          width: paddedColorsImg.paddedWidth,\r\n          height: paddedColorsImg.paddedHeight,\r\n          depth: 1\r\n        },\r\n      ],\r\n      // wrapS: TextureWrapMode.CLAMP_TO_EDGE,\r\n      // wrapT: TextureWrapMode.CLAMP_TO_EDGE,\r\n      // wrapR: TextureWrapMode.CLAMP_TO_EDGE,\r\n      min: TextureMinFilter.LINEAR,\r\n      mag: TextureMagFilter.LINEAR,\r\n      // mipmap: false\r\n    },\r\n    normalMap: {\r\n      pixels: normalMapImg,\r\n      width: normalMapImg.width, height: normalMapImg.height,\r\n      target: TextureTarget.TEXTURE_2D,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGB,\r\n      internalFormat: TextureInternalPixelFormat.RGB,\r\n      min: TextureMinFilter.LINEAR_MIPMAP_LINEAR,\r\n      mag: TextureMagFilter.LINEAR\r\n    },\r\n    displacementMap: {\r\n      pixels: displacementMapImg,\r\n      width: displacementMapImg.width, height: displacementMapImg.height,\r\n      target: TextureTarget.TEXTURE_2D,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGBA,\r\n      internalFormat: TextureInternalPixelFormat.RGBA\r\n    },\r\n    skybox: {\r\n      pixels: {\r\n        xPos: skyboxXPosImg, xNeg: skyboxXNegImg,\r\n        yPos: skyboxYPosImg, yNeg: skyboxYNegImg,\r\n        zPos: skyboxZPosImg, zNeg: skyboxZNegImg\r\n      },\r\n      width: skyboxXPosImg.width, height: skyboxXPosImg.height,\r\n      target: TextureTarget.TEXTURE_CUBE_MAP,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGBA,\r\n      internalFormat: TextureInternalPixelFormat.RGBA\r\n    },\r\n    fbColorTex: {\r\n      width: canvas.width, height: canvas.height,\r\n      pixels: null,\r\n      target: TextureTarget.TEXTURE_2D,\r\n      type: TexturePixelType.UNSIGNED_BYTE,\r\n      format: TexturePixelFormat.RGBA,\r\n      internalFormat: TextureInternalPixelFormat.RGBA,\r\n      mag: TextureMagFilter.LINEAR,\r\n      min: TextureMinFilter.LINEAR,\r\n      wrapS: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapT: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapR: TextureWrapMode.CLAMP_TO_EDGE,\r\n    },\r\n    depthTex: {\r\n      width: canvas.width, height: canvas.height,\r\n      pixels: null,\r\n      target: TextureTarget.TEXTURE_2D,\r\n      type: TexturePixelType.UNSIGNED_INT,\r\n      format: TexturePixelFormat.DEPTH_COMPONENT,\r\n      internalFormat: TextureInternalPixelFormat.DEPTH_COMPONENT24,\r\n      wrapS: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapT: TextureWrapMode.CLAMP_TO_EDGE,\r\n      wrapR: TextureWrapMode.CLAMP_TO_EDGE,\r\n      mag: TextureMagFilter.NEAREST,\r\n      min: TextureMinFilter.NEAREST,\r\n    }\r\n  })!;\r\n\r\n  const {albedoMap, albedoMaps, normalMap, displacementMap, skybox, fbColorTex, depthTex} = textures;\r\n\r\n  const anisotropicTargetTextures = [albedoMaps];\r\n  const anisotropicExtension = gl.getExtension(\"EXT_texture_filter_anisotropic\");\r\n  if (anisotropicExtension) {\r\n    console.log(`Extension EXT_texture_filter_anisotropic activated.`);\r\n    const maxFiltering = gl.getParameter(anisotropicExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT);\r\n    anisotropicTargetTextures.forEach((texture) => {\r\n      const {properties, internalTexture} = texture;\r\n      const {target} = properties!;\r\n      gl.bindTexture(target, internalTexture);\r\n      gl.texParameterf(target, anisotropicExtension.TEXTURE_MAX_ANISOTROPY_EXT, maxFiltering);\r\n    });\r\n  }\r\n\r\n  const cubeGeometry =\r\n    // new QuadGeometry({heightSegments: 64, widthSegments: 64});\r\n    new CubeGeometry({height: 4, width: 4, depth: 4, heightSegments: 32, widthSegments: 32, depthSegments: 32});\r\n    // new SphereGeometry({widthSegments: 64, heightSegments: 64});\r\n    // new CylinderGeometry();\r\n    // new DodecahedronGeometry();\r\n  \r\n  const quad = new QuadGeometry({height: 2, width: 2});\r\n  const quadGeometryBuilder = quad.toBuilder();\r\n  const cube = new Transform();\r\n  cube.setScaling(new Vector3([1, 1, 1]));\r\n  \r\n  const fov = (1 / 3) * Math.PI;\r\n  const aspect = gl.canvas.width / gl.canvas.height;\r\n  const zNear = 0.1;\r\n  const zFar = 100;\r\n\r\n  const camera = new PerspectiveCamera(fov, aspect, zNear, zFar);\r\n  camera.transform.setTranslation(new Vector3([0, 8, 8]));\r\n  camera.transform.lookAt(new Vector3([0, 0, 0]), Space.up);\r\n\r\n  const lightTransform = new Transform();\r\n  lightTransform.setTranslation(new Vector3([0, 2, 2]));\r\n  lightTransform.setScaling(new Vector3([0.2, 0.2, 0.2]));\r\n\r\n  camera.transform.setTranslation(lightTransform.getTranslation(new Vector3()).scale(2));\r\n  camera.transform.lookAt(new Vector3([0, 0, 0]), Space.up);\r\n\r\n  const viewDirectionProjectionInverse = camera.projection.clone().mult(Matrix4.identity().setRotation(camera.view.getRotation())).invert();\r\n/*\r\n  addWidgets([\r\n    ...createRotationWidgets(cube, \"Cube\"),\r\n    ...createPositionWidgets(cube, \"Cube\"),\r\n    ...createRelativePositionWidgets(cube, \"Cube\"),\r\n    ...createRelativePositionWidgets(camera.transform, \"Camera\"),\r\n  ]);*/\r\n\r\n  const cubeGeometryBuilder = cubeGeometry.toBuilder();\r\n  const cubeVerticesArray = cubeGeometryBuilder.verticesArray();\r\n  const cubeIndicesArray = cubeGeometryBuilder.trianglesIndicesArray();\r\n  const cubeNormalsArray = cubeGeometryBuilder.normalsArray();\r\n  const cubeUVsArray= cubeGeometryBuilder.uvsArray();\r\n  const cubeTangentsArray = cubeGeometryBuilder.tangentsArray();\r\n  const cubeLinesArray = cubeGeometryBuilder.verticesArray();\r\n\r\n  const cubeGeometryBuffer = new GeometryBuffer({\r\n    a_position: { array: cubeVerticesArray, type: AttributeDataType.VEC3 },\r\n    a_tangent: { array: cubeTangentsArray, type: AttributeDataType.VEC3 },\r\n    a_normal: { array: cubeNormalsArray, type: AttributeDataType.VEC3 },\r\n    a_uv: { array: cubeUVsArray, type: AttributeDataType.VEC2 },\r\n  }, cubeIndicesArray, false);\r\n\r\n  const cubeVertices = cubeGeometryBuffer.getAttribute(\"a_position\")!;\r\n  const cubeIndices = cubeGeometryBuffer.indices!;\r\n  const cubeNormals = cubeGeometryBuffer.getAttribute(\"a_normal\")!;\r\n  const cubeUVs = cubeGeometryBuffer.getAttribute(\"a_uv\")!;\r\n  const cubeTangents = cubeGeometryBuffer.getAttribute(\"a_tangent\")!;\r\n  const cubeColors = cubeGeometryBuffer.getAttribute(\"a_normal\")!;\r\n  \r\n  //const cubeLines = cubeGeometryBuffer.getAttribute(\"a_lines\")!;\r\n\r\n  // const blob = cubeGeometryBuffer.toBlob();\r\n  // const anchor = document.createElement(\"a\");\r\n  // anchor.download = \"dat.bin\";\r\n  // anchor.href = URL.createObjectURL(blob);\r\n  // anchor.click();\r\n\r\n  // console.log(cubeGeometryBuffer);\r\n\r\n  // const cubeGeometryBuffer = await GeometryBuffer.fromBlob(file!);\r\n\r\n  // const cubeVertices = cubeGeometryBuffer.getAttribute(\"a_position\")!;\r\n  // const cubeIndices = cubeGeometryBuffer.indices!;\r\n  // const cubeNormals = cubeGeometryBuffer.getAttribute(\"a_normal\")!;\r\n  // const cubeUVs = cubeGeometryBuffer.getAttribute(\"a_uv\")!;\r\n  // const cubeTangents = cubeGeometryBuffer.getAttribute(\"a_tangent\")!;\r\n\r\n  const phongCubePacketProperties: PacketProperties = {\r\n    program: phongProgram,\r\n    vertexArray: {\r\n      vertexBuffers: [\r\n        {\r\n          interleaved: false\r\n        },\r\n        {\r\n          usage: BufferDataUsage.DYNAMIC_READ\r\n        },\r\n      ],\r\n      vertexAttributes: {\r\n        a_position: { buffer: 0, type: AttributeDataType.VEC3, componentType: DataComponentType.FLOAT, byteLength: cubeNormals.array.byteLength },\r\n        a_tangent: { buffer: 0, type: AttributeDataType.VEC3, componentType: DataComponentType.FLOAT, byteLength: cubeTangents.array.byteLength },\r\n        a_normal: { ...cubeNormals, buffer: 0 },\r\n        a_uv: { ...cubeUVs, buffer: 0 },\r\n        a_color: { buffer: 1, type: AttributeDataType.VEC3, componentType: DataComponentType.FLOAT, byteLength: cubeColors.array.byteLength },\r\n      },\r\n      elementIndices: cubeGeometryBuffer.indices\r\n    },\r\n    uniformBuffers: [\r\n      {\r\n        usage: BufferDataUsage.DYNAMIC_READ\r\n      },\r\n      {\r\n        usage: BufferDataUsage.DYNAMIC_READ\r\n      }\r\n    ],\r\n    uniformBlocks: {\r\n      subTexture: {\r\n        uniforms: {\r\n          u_xOffset: { value: PADDING / paddedBrickwallImg.paddedWidth },\r\n          u_yOffset: { value: PADDING / paddedBrickwallImg.paddedHeight },\r\n          u_zOffset: { value: 1 },\r\n          u_xScaling: { value: paddedAlbedoMapImg.width / paddedBrickwallImg.paddedWidth },\r\n          u_yScaling: { value: paddedAlbedoMapImg.height / paddedBrickwallImg.paddedHeight }\r\n        }\r\n      },\r\n      viewBlock: {\r\n        buffer: 0,\r\n        /*uniforms: {\r\n          u_view: { value: camera.view.array },\r\n          u_projection: { value: camera.projection.array },\r\n        }*/\r\n      },\r\n      modelBlock: {\r\n        buffer: 0,\r\n        /*uniforms: {\r\n          \"models[0].u_model\": { value: cube.matrix.array },\r\n          \"models[0].u_modelView\": { value: camera.view.mult(cube.matrix).array },\r\n          \"models[0].u_normal\": { value: camera.view.mult(cube.matrix).invert().transpose().array }\r\n        }*/\r\n      },\r\n      lightsBlock: {\r\n        buffer: 0,\r\n        /*uniforms: {\r\n          \"lights[0].u_lightWorldPos\": { value: Array.from(lightTransform.getTranslation(new Vector3())) },\r\n          \"lights[0].u_lightDirection\": { value: Array.from(lightTransform.getBackward(new Vector3())) },\r\n          \"lights[0].u_cutOff\": { value: (2 / 360) * Math.PI },\r\n          \"lights[0].u_lightColor\": { value: Array.from(Color.RED) }\r\n        }*/\r\n      },\r\n      phongBlock: {\r\n        buffer: 1,\r\n        /*uniforms: {\r\n          \"phong.u_ambientColor\": { value: [0.1, 0.1, 0.1] },\r\n          \"phong.u_diffuseColor\": { value: [0.8, 0, 0] },\r\n          \"phong.u_specularColor\": { value: [1, 1, 1] },\r\n          \"phong.u_ambientFactor\": { value: 0.0008 },\r\n          \"phong.u_diffuseFactor\": { value: 1 },\r\n          \"phong.u_specularFactor\": { value: 1 },\r\n          \"phong.u_shininess\": { value: 36 },\r\n          \"phong.u_constant\": { value: 1 }, \r\n          \"phong.u_linear\": { value: 0.09 },\r\n          \"phong.u_quadratic\": { value: 0.032 }\r\n        }*/\r\n      }\r\n    },\r\n    uniforms: {\r\n      u_albedoMap: { value: albedoMap },\r\n      u_normalMap: { value: normalMap },\r\n      u_displacementMap: { value: displacementMap },\r\n      u_albedoMaps: { value: albedoMaps }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: cubeGeometryBuffer.indices!.length,\r\n    }\r\n  };\r\n\r\n  const phongPacketInitValues = <PacketValues>{\r\n    program: phongProgram,\r\n    uniformBlocks: {\r\n      viewBlock: {\r\n        uniforms: {\r\n          u_view: { value: camera.view.array },\r\n          u_projection: { value: camera.projection.array },\r\n        }\r\n      },\r\n      modelBlock: {\r\n        uniforms: {\r\n          \"models[0].u_model\": { value: cube.matrix.array },\r\n          \"models[0].u_modelView\": { value: camera.view.mult(cube.matrix).array },\r\n          \"models[0].u_normal\": { value: camera.view.mult(cube.matrix).invert().transpose().array }\r\n        }\r\n      },\r\n      lightsBlock: {\r\n        uniforms: {\r\n          \"lights[0].u_lightWorldPos\": { value: Array.from(lightTransform.getTranslation(new Vector3())) },\r\n          \"lights[0].u_lightDirection\": { value: Array.from(lightTransform.getBackward(new Vector3())) },\r\n          \"lights[0].u_cutOff\": { value: (2 / 360) * Math.PI },\r\n          \"lights[0].u_lightColor\": { value: /*[1, 0.8, 0.8]*/Array.from(Color.RED) }\r\n        }\r\n      },\r\n      phongBlock: {\r\n        uniforms: {\r\n          \"phong.u_ambientColor\": { value: [0.1, 0.1, 0.1] },\r\n          \"phong.u_diffuseColor\": { value: [0.8, 0, 0] },\r\n          \"phong.u_specularColor\": { value: [1, 1, 1] },\r\n          \"phong.u_ambientFactor\": { value: 0.0008 },\r\n          \"phong.u_diffuseFactor\": { value: 1 },\r\n          \"phong.u_specularFactor\": { value: 1 },\r\n          \"phong.u_shininess\": { value: 36 },\r\n          \"phong.u_constant\": { value: 1 }, \r\n          \"phong.u_linear\": { value: 0.09 },\r\n          \"phong.u_quadratic\": { value: 0.032 }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  let phongCubePacket = WebGLPacketUtilities.createPacket(gl, phongCubePacketProperties)!;\r\n  \r\n  WebGLVertexArrayUtilities.setVertexArrayBufferData(gl, phongCubePacket.vertexArray.verticesBuffers[1]!, cubeColors.array);\r\n  WebGLVertexArrayUtilities.setVertexArrayBufferData(gl, phongCubePacket.vertexArray.verticesBuffers[0]!, new Uint8Array(cubeGeometryBuffer.buffer));\r\n  WebGLVertexArrayUtilities.setVertexArrayValues(gl, phongCubePacket.vertexArray, {\r\n    attributes: {\r\n      a_position: {\r\n        array: cubeVertices.array\r\n      }\r\n    }\r\n  });\r\n\r\n  WebGLUniformBlockUtilities.setUniformBufferData(gl,\r\n    phongCubePacket.uniformBlocks!.phongBlock!.buffer!,\r\n    Color.lerp(Color.WHITE, Color.GREEN, 0.5).array,\r\n    phongCubePacket.uniformBlocks!.phongBlock!.layout[\"phong.u_ambientColor\"]!.byteOffset!,\r\n  );\r\n\r\n  const linesProperties: PacketProperties = {\r\n    program: linesProgram,\r\n    vertexArray: {\r\n      vertexAttributes: {\r\n        a_position: {\r\n          array: cubeLinesArray,\r\n          type: AttributeDataType.VEC3\r\n        }\r\n      }\r\n    },\r\n    uniformBuffers: [\r\n      phongCubePacket.uniformBlocks!.modelBlock.buffer!,\r\n      phongCubePacket.uniformBlocks!.viewBlock.buffer!\r\n    ],\r\n    uniformBlocks: {\r\n      modelBlock: { buffer: 0 },\r\n      viewBlock: { buffer: 1 }\r\n    },\r\n    uniforms: {\r\n      u_color: {\r\n        value: new Float32Array([1, 0, 0])\r\n      }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.LINES,\r\n      elementsCount: cubeLinesArray.length / 2\r\n    }\r\n  };\r\n\r\n  const basicPacketProperties: PacketProperties = {\r\n    program: basicProgram,\r\n    vertexArray: {\r\n      vertexBuffers: [\r\n        phongCubePacket.vertexArray.verticesBuffers[0]\r\n      ],\r\n      elementBuffer: phongCubePacket.vertexArray.elementBuffer\r\n    },\r\n    uniformBuffers: [\r\n      phongCubePacket.uniformBlocks!.viewBlock.buffer!\r\n    ],\r\n    uniformBlocks: {\r\n      basicModelBlock: {\r\n        uniforms: {\r\n          u_model: { value: lightTransform.matrix.array },\r\n          u_color: { value: [1, 1, 0] }\r\n        }\r\n      },\r\n      viewBlock: {\r\n        buffer: 0\r\n      }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: phongCubePacket.drawCommand.elementsCount\r\n    }\r\n  };\r\n\r\n  const quadIndices = quadGeometryBuilder.trianglesIndicesArray();\r\n  const quadVertices = quadGeometryBuilder.verticesArray();\r\n  const quadUVs = quadGeometryBuilder.uvsArray();\r\n  const quadWorld = new Matrix4().setIdentity();\r\n\r\n  const skyboxPacketProperties: PacketProperties = {\r\n    program: skyboxProgram,\r\n    vertexArray: {\r\n      vertexAttributes: {\r\n        a_position: { array: quadVertices, type: AttributeDataType.VEC3 },\r\n      },\r\n      elementIndices: quadIndices\r\n    },\r\n    uniforms: {\r\n      u_world: { value: quadWorld.array },\r\n      u_viewDirectionProjectionInverse: { value: viewDirectionProjectionInverse.array }, \r\n      u_skybox: { value: skybox },\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: quadIndices.length\r\n    }\r\n  };\r\n\r\n  const depthPacketProperties: PacketProperties = {\r\n    program: depthProgram,\r\n    vertexArray: {\r\n      vertexAttributes: {\r\n        a_position: { array: quadVertices, type: AttributeDataType.VEC3 },\r\n        a_uv: { array: quadUVs, type: AttributeDataType.VEC2 },\r\n      },\r\n      elementIndices: quadIndices\r\n    },\r\n    uniforms: {\r\n      u_depthWorld: { value: quadWorld.array },\r\n      u_depthTex: { value: depthTex }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: quadIndices.length\r\n    }\r\n  };\r\n\r\n  const texPacketProperties: PacketProperties = {\r\n    program: texProgram,\r\n    vertexArray: {\r\n      vertexAttributes: {\r\n        a_position: { array: quadVertices, type: AttributeDataType.VEC3 },\r\n        a_uv: { array: quadUVs, type: AttributeDataType.VEC2 },\r\n      },\r\n      elementIndices: quadIndices\r\n    },\r\n    uniforms: {\r\n      u_world: { value: quadWorld.array },\r\n      u_tex: { value: fbColorTex }\r\n    },\r\n    drawCommand: {\r\n      mode: DrawMode.TRIANGLES,\r\n      elementsCount: quadIndices.length\r\n    }\r\n  };\r\n\r\n  const linesPacket = WebGLPacketUtilities.createPacket(gl, linesProperties)!;\r\n  const basicPacket = WebGLPacketUtilities.createPacket(gl, basicPacketProperties)!;\r\n  const skyboxPacket = WebGLPacketUtilities.createPacket(gl, skyboxPacketProperties)!;\r\n  const depthPacket = WebGLPacketUtilities.createPacket(gl, depthPacketProperties)!;\r\n  const texPacket = WebGLPacketUtilities.createPacket(gl, texPacketProperties)!;\r\n\r\n  const framebuffer = WebGLFramebufferUtilities.createFramebuffer(gl)!;\r\n  const maxSamples = WebGLRendererUtilities.getMaxSamples(gl);\r\n  \r\n  WebGLFramebufferUtilities.attachRenderbuffer(\r\n    gl, framebuffer,\r\n    {\r\n      renderbuffer: WebGLFramebufferUtilities.createRenderbuffer(gl, {\r\n        internalFormat: RenderbufferPixelFormat.DEPTH_COMPONENT24,\r\n        width: canvas.width,\r\n        height: canvas.height,\r\n        samples: maxSamples\r\n      })!,\r\n      attachment: FramebufferAttachment.DEPTH_ATTACHMENT\r\n    },\r\n    {\r\n      renderbuffer: WebGLFramebufferUtilities.createRenderbuffer(gl, {\r\n        internalFormat: RenderbufferPixelFormat.RGBA8,\r\n        width: canvas.width,\r\n        height: canvas.height,\r\n        samples: maxSamples\r\n      })!,\r\n      attachment: FramebufferAttachment.COLOR_ATTACHMENT0,\r\n    }\r\n  );\r\n\r\n  const postFramebuffer = WebGLFramebufferUtilities.createFramebuffer(gl)!;\r\n\r\n  WebGLFramebufferUtilities.attachTexture(\r\n    gl, postFramebuffer, \r\n    {\r\n      textureTarget: FramebufferTextureTarget.TEXTURE_2D,\r\n      texture: fbColorTex,\r\n      attachment: FramebufferAttachment.COLOR_ATTACHMENT0\r\n    },\r\n    {\r\n      textureTarget: FramebufferTextureTarget.TEXTURE_2D,\r\n      texture: depthTex,\r\n      attachment: FramebufferAttachment.DEPTH_ATTACHMENT\r\n    }\r\n  );\r\n\r\n  WebGLRendererUtilities.viewport(gl, 0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n  // WebGLRendererUtilities.frontFace(gl, WindingOrder.CW);\r\n  WebGLRendererUtilities.enable(gl, Capabilities.DEPTH_TEST);\r\n  WebGLRendererUtilities.enable(gl, Capabilities.CULL_FACE);\r\n  WebGLRendererUtilities.enable(gl, Capabilities.BLEND);\r\n  WebGLRendererUtilities.blendFunction(gl, BlendingMode.SRC_ALPHA, BlendingMode.ONE_MINUS_SRC_ALPHA);\r\n  \r\n  let lastFrameTime = 0;\r\n  let deltaTime = 0;\r\n\r\n  let t = 0;\r\n  let direction = 1;\r\n  \r\n  let initRotation = cube.getRotation(new Quaternion());\r\n  let initPosition = cube.getTranslation(new Vector3());\r\n\r\n  const targetPosition = new Vector3([2, -2, -2]);\r\n  const targetRotation = Quaternion.fromAxisAngle(Space.down, Math.PI / 3);\r\n\r\n  Input.initialize(canvas);\r\n  \r\n  WebGLFramebufferUtilities.unbindFramebuffer(gl);\r\n\r\n  const cameraControl = new FreeCameraControl(camera);\r\n  \r\n  // WebGLProgramUtilities.recompileProgram(gl, phongProgram, {fragmentSource: phong2Frag});\r\n  // phongCubePacket = WebGLPacketUtilities.createPacket(gl, phongCubePacketProperties)!;\r\n  \r\n  WebGLPacketUtilities.setPacketValues(gl, phongCubePacket, phongPacketInitValues);\r\n  WebGLRendererUtilities.clearColor(gl, Color.BLACK.normalize());\r\n  \r\n  ctx.font = \"18px 'Open Sans'\";\r\n  ctx.strokeStyle = \"black\";\r\n  ctx.fillStyle = \"white\";\r\n\r\n  const renderGUI = function(frameTime: number) {\r\n    frameTime *= 0.001;\r\n    deltaTime = frameTime - lastFrameTime;\r\n    \r\n    fps = 1 / deltaTime;\r\n\r\n    ctx.clearRect(0, 0, canvas2D.width, canvas2D.height);\r\n\r\n    ctx.shadowBlur = 2;\r\n    ctx.strokeText(`${fps.toFixed(1)} FPS`, 20, 20);\r\n    ctx.shadowBlur = 0;\r\n    ctx.fillText(`${fps.toFixed(1)} FPS`, 20, 20);\r\n  };\r\n\r\n  render = function(frameTime: number) {\r\n    renderGUI(frameTime);\r\n\r\n    frameTime *= 0.001;\r\n    deltaTime = frameTime - lastFrameTime;\r\n    lastFrameTime = frameTime;\r\n\r\n    if (!playing) {\r\n      return;\r\n    }\r\n\r\n    //fpsElement.textContent = fps.toFixed(1);\r\n\r\n\r\n    cameraControl.update(deltaTime);\r\n    lightTransform.setMatrix(camera.transform.matrix);\r\n\r\n    cube.rotate(Quaternion.fromAxisAngle(Space.down, Math.PI / 128));\r\n    \r\n    t += deltaTime * direction * 0.5;\r\n    if (t > 1 || t < 0) {\r\n      direction *= -1;\r\n    }\r\n    \r\n    \r\n    WebGLRendererUtilities.clear(gl, BufferMask.COLOR_BUFFER_BIT | BufferMask.DEPTH_BUFFER_BIT);\r\n    \r\n    viewDirectionProjectionInverse.copy(camera.projection).mult(new Matrix4().setIdentity().setRotation(camera.view.getRotation())).invert();\r\n\r\n    // Framebuffer\r\n\r\n    WebGLRendererUtilities.viewport(gl, 0, 0, canvas.width, canvas.height);\r\n\r\n    WebGLFramebufferUtilities.bindFramebuffer(gl, framebuffer);\r\n\r\n    WebGLRendererUtilities.clear(gl, BufferMask.COLOR_BUFFER_BIT | BufferMask.DEPTH_BUFFER_BIT);\r\n    \r\n    WebGLRendererUtilities.depthFunction(gl, TestFunction.LEQUAL);\r\n\r\n    WebGLPacketUtilities.drawPacket(gl, skyboxPacket);\r\n\r\n    WebGLRendererUtilities.depthFunction(gl, TestFunction.LESS);\r\n\r\n    WebGLPacketUtilities.setPacketValues(gl, phongCubePacket, {\r\n      uniformBlocks: {\r\n        modelBlock: {\r\n          uniforms: {\r\n            \"models[0].u_model\": { value: cube.matrix.array },\r\n            \"models[0].u_modelView\": { value: camera.view.mult(cube.matrix).array },\r\n            \"models[0].u_normal\": { value: camera.view.mult(cube.matrix).invert().transpose().array },\r\n          }\r\n        },\r\n        viewBlock: {\r\n          uniforms: {\r\n            u_view: { value: camera.view.array },\r\n            u_projection: { value: camera.projection.array },\r\n          }\r\n        },\r\n        lightsBlock: {\r\n          uniforms: {\r\n            \"lights[0].u_lightWorldPos\": { value: Array.from(lightTransform.getTranslation(new Vector3())) },\r\n            \"lights[0].u_lightDirection\": { value: Array.from(lightTransform.getBackward(new Vector3())) },\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    // WebGLPacketUtilities.drawPacket(gl, basicPacket);\r\n    // WebGLPacketUtilities.drawPacket(gl, linesPacket);\r\n    WebGLPacketUtilities.drawPacket(gl, phongCubePacket);\r\n    \r\n    WebGLPacketUtilities.setPacketValues(gl, skyboxPacket, {\r\n      uniforms: {\r\n        u_viewDirectionProjectionInverse: { value: viewDirectionProjectionInverse.array }\r\n      }\r\n    });\r\n    \r\n    // WebGLRendererUtilities.depthFunction(gl, TestFunction.LEQUAL);\r\n    // WebGLPacketUtilities.drawPacket(gl, skyboxPacket);\r\n    \r\n    // Framebuffer\r\n    WebGLFramebufferUtilities.blit(gl, framebuffer, postFramebuffer,\r\n      [0, 0, canvas.width, canvas.height],\r\n      [0, 0, canvas.width, canvas.height],\r\n      BufferMask.COLOR_BUFFER_BIT,\r\n      TextureMagFilter.LINEAR\r\n    );\r\n    \r\n    WebGLFramebufferUtilities.blit(gl, framebuffer, postFramebuffer,\r\n      [0, 0, canvas.width, canvas.height],\r\n      [0, 0, canvas.width, canvas.height],\r\n      BufferMask.DEPTH_BUFFER_BIT,\r\n      TextureMagFilter.NEAREST\r\n    );\r\n\r\n    WebGLFramebufferUtilities.unbindFramebuffer(gl);\r\n    \r\n    WebGLPacketUtilities.drawPacket(gl, texPacket);\r\n\r\n    const newWidth = canvas.width / 4;\r\n    const newHeight = canvas.height / 4;\r\n    WebGLRendererUtilities.viewport(gl, 0, canvas.height - newHeight, newWidth, newHeight);\r\n\r\n    WebGLRendererUtilities.depthFunction(gl, TestFunction.ALWAYS);\r\n\r\n    WebGLPacketUtilities.drawPacket(gl, depthPacket);\r\n\r\n    Input.clear();\r\n\r\n    requestAnimationFrame(render);\r\n  };\r\n\r\n  /*const stream = gl.canvas.captureStream(60);\r\n  const rec = new MediaRecorder(stream, {\r\n    mimeType: \"video/webm; codecs=vp9\",\r\n    audioBitsPerSecond: 0,\r\n    videoBitsPerSecond: canvas.width * canvas.height * 24 * 60\r\n  });\r\n\r\n  const chunks: BlobPart[] = [];\r\n  rec.addEventListener(\"dataavailable\", (event) => {\r\n    chunks.push(event.data);\r\n  });\r\n  rec.addEventListener(\"stop\", () => {\r\n    const blob = new Blob(chunks, {type: \"video/webm; codecs=vp9\"});\r\n    const anchor = document.createElement(\"a\");\r\n    anchor.download = \"recorded.webm\";\r\n    anchor.href = URL.createObjectURL(blob);\r\n    anchor.click();\r\n  });\r\n  rec.start();\r\n\r\n  setTimeout(() => {\r\n    rec.stop();\r\n  }, 5_000);*/\r\n  \r\n  // const saveSVG = document.querySelector<SVGSVGElement>(\"svg#save\")!;\r\n  // const getSVGImageData = (svg: SVGSVGElement) => new Promise((resolve: (value: string) => void) => {\r\n  //   const url = URL.createObjectURL(new Blob([svg.outerHTML], {\r\n  //     type: \"image/svg+xml\"\r\n  //   }));\r\n  //   const svgImage = document.createElement(\"img\");\r\n  //   document.body.appendChild(svgImage);\r\n  //   svgImage.onload = () => {\r\n  //     const canvas = document.createElement(\"canvas\");\r\n  //     const ctx = canvas.getContext(\"2d\", {alpha: true})!;\r\n  //     canvas.width = svgImage.clientWidth;\r\n  //     canvas.height = svgImage.clientHeight;\r\n  //     ctx.drawImage(svgImage, 0, 0);\r\n  //     const imgData = canvas.toDataURL(\"image/png\");\r\n  //     resolve(imgData);\r\n  //     URL.revokeObjectURL(url);\r\n  //     svgImage.remove();\r\n  //   };\r\n  //   svgImage.src = url;\r\n  // });\r\n\r\n  // getSVGImageData(saveSVG).then(\r\n  //   (data: string) => {\r\n  //     const img = new Image();\r\n  //     img.src = data;\r\n  //     document.body.append(img);\r\n  //   }\r\n  // )\r\n}","import { Matrix4 } from \"../../../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Camera } from \"./Camera\";\r\n\r\nexport { PerspectiveCamera };\r\n\r\ninterface PerspectiveCameraConstructor {\r\n    prototype: PerspectiveCamera;\r\n    new(fov: number, aspect: number, zNear: number, zFar: number): PerspectiveCamera;\r\n}\r\n\r\ninterface PerspectiveCamera extends Camera {\r\n    setValues(fov: number, aspect: number, zNear: number, zFar: number): PerspectiveCamera\r\n}\r\n\r\nclass PerspectiveCameraBase extends Camera {\r\n    \r\n    constructor(\r\n        fov: number,\r\n        aspect: number,\r\n        zNear: number,\r\n        zFar: number) {\r\n        super(Matrix4.perspective(fov, aspect, zNear, zFar));\r\n    }\r\n\r\n    setValues(\r\n        fov: number,\r\n        aspect: number,\r\n        zNear: number,\r\n        zFar: number): PerspectiveCamera\r\n    {\r\n        this.projection.setPerspective(fov, aspect, zNear, zFar);\r\n        this.updateFrustum();\r\n        return this;\r\n    }\r\n}\r\n\r\nvar PerspectiveCamera: PerspectiveCameraConstructor = PerspectiveCameraBase;","import { Matrix4 } from \"../../../../libs/maths/algebra/matrices/Matrix4\";\r\nimport { Vector3 } from \"../../../../libs/maths/algebra/vectors/Vector3\";\r\nimport { Space } from \"../../../../libs/maths/geometry/space/Space\";\r\nimport { UUID, UUIDGenerator } from \"../../../../libs/maths/statistics/random/UUIDGenerator\";\r\nimport { Frustum } from \"../../../../libs/physics/collisions/Frustum\";\r\nimport { Mesh } from \"../objects/meshes/Mesh\";\r\nimport { Object3D, Object3DBase } from \"../objects/Object3D\";\r\n\r\nexport { Camera };\r\n\r\ninterface CameraConstructor {\r\n  prototype: Camera;\r\n  new(): Camera;\r\n  new(projection: Matrix4): Camera;\r\n}\r\n\r\ninterface Camera extends Object3D {\r\n  readonly uuid: UUID;\r\n  readonly viewProjection: Matrix4;\r\n  readonly projection: Matrix4;\r\n  readonly view: Matrix4;\r\n  readonly frustum: Frustum;\r\n  isViewing(mesh: Mesh): boolean;\r\n  updateFrustum(): void;\r\n  getFront(vector: Vector3): Vector3;\r\n}\r\n\r\nclass CameraBase extends Object3DBase {\r\n    readonly uuid: UUID;\r\n    readonly projection: Matrix4;\r\n    readonly frustum: Frustum;\r\n  \r\n    constructor()\r\n    constructor(projection: Matrix4)\r\n    constructor(projection?: Matrix4) {\r\n      super();\r\n      this.uuid = UUIDGenerator.newUUID();\r\n      this.projection = projection || new Matrix4();\r\n      this.frustum = new Frustum().setFromMatrix(this.viewProjection);\r\n    }\r\n\r\n    getFront(vector: Vector3): Vector3 {\r\n      return this.transform.getBackward(vector);\r\n    }\r\n\r\n    get view(): Matrix4 {\r\n      return this.transform.matrix.clone().invert();\r\n    }\r\n\r\n    get viewProjection(): Matrix4 {\r\n      return this.projection.clone().mult(this.view);\r\n    }\r\n\r\n    isViewing(mesh: Mesh): boolean {\r\n      return true;\r\n    }\r\n\r\n    updateFrustum(): void {\r\n      this.frustum.setFromMatrix(this.viewProjection);\r\n    }\r\n}\r\n\r\nvar Camera: CameraConstructor = CameraBase;","import { Transform } from \"../../../general/Transform\";\r\n\r\nexport { Object3D };\r\nexport { Object3DBase };\r\n\r\ninterface Object3D {\r\n    transform: Transform;\r\n}\r\n\r\nclass Object3DBase implements Object3D {\r\n    readonly transform: Transform;\r\n\r\n    constructor() {\r\n        this.transform = new Transform(this);\r\n    }\r\n}","var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _ModelNodesListBase_items, _ModelEventBase_currentTarget, _ModelEventBase_target, _ModelEventTargetBase_callbacks, _ModelNodeBase_instances, _ModelNodeBase_parentNode, _ModelNodeBase_records, _ModelNodeBase_isRecording, _ModelNodeBase_triggerChange, _ModelNodeBase_handleRecord, _ModelObjectBase_properties, _ModelListBase_items, _ModelChangeObserverBase_instances, _ModelChangeObserverBase_callback, _ModelChangeObserverBase_records, _ModelChangeObserverBase_disconnected, _ModelChangeObserverBase_references, _ModelChangeObserverBase_trigger, _ModelChangeObserverBase_handleModelEvent;\r\nexport { ModelChangeRecord };\r\nexport { ModelEvent };\r\nexport { ModelNode };\r\nexport { ModelObject };\r\nexport { ReactiveProperty };\r\nexport { ModelList };\r\nexport { ModelChangeObserver };\r\nclass ModelChangeRecordBase {\r\n    constructor(init) {\r\n        var _a, _b, _c, _d, _e, _f, _g, _h;\r\n        this.target = init.target;\r\n        this.changeType = init.changeType;\r\n        this.propertyName = (_a = init.propertyName) !== null && _a !== void 0 ? _a : null;\r\n        this.oldValue = (_b = init.oldValue) !== null && _b !== void 0 ? _b : undefined;\r\n        this.newValue = (_c = init.newValue) !== null && _c !== void 0 ? _c : undefined;\r\n        this.removedIndex = (_d = init.removedIndex) !== null && _d !== void 0 ? _d : 0;\r\n        this.removedItems = new ModelNodesList((_e = init.removedItems) !== null && _e !== void 0 ? _e : []);\r\n        this.insertedIndex = (_f = init.insertedIndex) !== null && _f !== void 0 ? _f : 0;\r\n        this.insertedItems = new ModelNodesList((_g = init.insertedItems) !== null && _g !== void 0 ? _g : []);\r\n        this.sortedIndices = (_h = init.sortedIndices) !== null && _h !== void 0 ? _h : [];\r\n    }\r\n    static get PROPERTY_CHANGE() {\r\n        return 1;\r\n    }\r\n    static get LIST_REMOVE() {\r\n        return 2;\r\n    }\r\n    static get LIST_INSERT() {\r\n        return 3;\r\n    }\r\n    static get LIST_SORT() {\r\n        return 4;\r\n    }\r\n    get PROPERTY_CHANGE() {\r\n        return ModelChangeRecordBase.PROPERTY_CHANGE;\r\n    }\r\n    get LIST_REMOVE() {\r\n        return ModelChangeRecordBase.LIST_REMOVE;\r\n    }\r\n    get LIST_INSERT() {\r\n        return ModelChangeRecordBase.LIST_INSERT;\r\n    }\r\n    get LIST_SORT() {\r\n        return ModelChangeRecordBase.LIST_SORT;\r\n    }\r\n}\r\nvar ModelChangeRecord = ModelChangeRecordBase;\r\nclass ModelNodesListBase {\r\n    constructor(items) {\r\n        _ModelNodesListBase_items.set(this, void 0);\r\n        __classPrivateFieldSet(this, _ModelNodesListBase_items, items.slice(), \"f\");\r\n    }\r\n    get length() {\r\n        return __classPrivateFieldGet(this, _ModelNodesListBase_items, \"f\").length;\r\n    }\r\n    item(index) {\r\n        var _a;\r\n        return (_a = __classPrivateFieldGet(this, _ModelNodesListBase_items, \"f\")[index]) !== null && _a !== void 0 ? _a : null;\r\n    }\r\n    values() {\r\n        return __classPrivateFieldGet(this, _ModelNodesListBase_items, \"f\").values();\r\n    }\r\n}\r\n_ModelNodesListBase_items = new WeakMap();\r\nvar ModelNodesList = ModelNodesListBase;\r\nclass ModelEventBase {\r\n    constructor(type) {\r\n        _ModelEventBase_currentTarget.set(this, void 0);\r\n        _ModelEventBase_target.set(this, void 0);\r\n        this.type = type;\r\n        __classPrivateFieldSet(this, _ModelEventBase_currentTarget, null, \"f\");\r\n        __classPrivateFieldSet(this, _ModelEventBase_target, null, \"f\");\r\n    }\r\n    get currentTarget() {\r\n        return __classPrivateFieldGet(this, _ModelEventBase_currentTarget, \"f\");\r\n    }\r\n    get target() {\r\n        return __classPrivateFieldGet(this, _ModelEventBase_target, \"f\");\r\n    }\r\n}\r\n_ModelEventBase_currentTarget = new WeakMap(), _ModelEventBase_target = new WeakMap();\r\nModelEventBase.ModelEventTargetAccessor = new class ModelEventTargetAccessor {\r\n    setCurrentTarget(event, currentTarget) {\r\n        if (event instanceof ModelEventBase) {\r\n            __classPrivateFieldSet(event, _ModelEventBase_currentTarget, currentTarget, \"f\");\r\n        }\r\n    }\r\n    setTarget(event, target) {\r\n        if (event instanceof ModelEventBase) {\r\n            __classPrivateFieldSet(event, _ModelEventBase_target, target, \"f\");\r\n        }\r\n    }\r\n};\r\nvar ModelEventTargetAccessor = ModelEventBase.ModelEventTargetAccessor;\r\ndelete ModelEventBase.ModelEventTargetAccessor;\r\nvar ModelEvent = ModelEventBase;\r\nclass ModelEventTargetBase {\r\n    constructor() {\r\n        _ModelEventTargetBase_callbacks.set(this, void 0);\r\n        __classPrivateFieldSet(this, _ModelEventTargetBase_callbacks, new Map(), \"f\");\r\n    }\r\n    receiveEvent(event) {\r\n        const { type } = event;\r\n        const callbacks = __classPrivateFieldGet(this, _ModelEventTargetBase_callbacks, \"f\").get(type);\r\n        ModelEventTargetAccessor.setCurrentTarget(event, this);\r\n        if (callbacks) {\r\n            callbacks.forEach((callback_i) => {\r\n                callback_i(event);\r\n            });\r\n        }\r\n    }\r\n    addEventListener(type, callback) {\r\n        const callbacks = __classPrivateFieldGet(this, _ModelEventTargetBase_callbacks, \"f\").get(type);\r\n        if (callbacks) {\r\n            callbacks.push(callback);\r\n        }\r\n        else {\r\n            __classPrivateFieldGet(this, _ModelEventTargetBase_callbacks, \"f\").set(type, [callback]);\r\n        }\r\n    }\r\n    removeEventListener(type, callback) {\r\n        const callbacks = __classPrivateFieldGet(this, _ModelEventTargetBase_callbacks, \"f\").get(type);\r\n        if (callbacks) {\r\n            const callbackIndex = callbacks.findIndex(callback_i => callback_i == callback);\r\n            if (callbackIndex > -1) {\r\n                callbacks.splice(callbackIndex, 1);\r\n            }\r\n            if (callbacks.length == 0) {\r\n                __classPrivateFieldGet(this, _ModelEventTargetBase_callbacks, \"f\").delete(type);\r\n            }\r\n        }\r\n    }\r\n    dispatchEvent(event) {\r\n        ModelEventTargetAccessor.setTarget(event, this);\r\n        this.receiveEvent(event);\r\n    }\r\n}\r\n_ModelEventTargetBase_callbacks = new WeakMap();\r\nvar ModelEventTarget = ModelEventTargetBase;\r\nclass ModelNodeBase extends ModelEventTargetBase {\r\n    constructor() {\r\n        super();\r\n        _ModelNodeBase_instances.add(this);\r\n        _ModelNodeBase_parentNode.set(this, void 0);\r\n        _ModelNodeBase_records.set(this, void 0);\r\n        _ModelNodeBase_isRecording.set(this, void 0);\r\n        __classPrivateFieldSet(this, _ModelNodeBase_parentNode, null, \"f\");\r\n        __classPrivateFieldSet(this, _ModelNodeBase_records, [], \"f\");\r\n        __classPrivateFieldSet(this, _ModelNodeBase_isRecording, false, \"f\");\r\n    }\r\n    get parentNode() {\r\n        return __classPrivateFieldGet(this, _ModelNodeBase_parentNode, \"f\");\r\n    }\r\n    setParent(parentNode) {\r\n        if (parentNode !== null) {\r\n            let isCyclicReference = parentNode == this;\r\n            let { parentNode: ancestorNode } = parentNode;\r\n            while (!isCyclicReference && ancestorNode !== null) {\r\n                ({ parentNode: ancestorNode } = ancestorNode);\r\n                isCyclicReference = ancestorNode == this;\r\n            }\r\n            if (!isCyclicReference) {\r\n                __classPrivateFieldSet(this, _ModelNodeBase_parentNode, parentNode, \"f\");\r\n            }\r\n            else {\r\n                throw new TypeError(\"Failed to set parent on ModelNode: circular reference detected in the hierarchy.\");\r\n            }\r\n        }\r\n        else {\r\n            __classPrivateFieldSet(this, _ModelNodeBase_parentNode, null, \"f\");\r\n        }\r\n    }\r\n    beginChanges() {\r\n        __classPrivateFieldSet(this, _ModelNodeBase_isRecording, true, \"f\");\r\n    }\r\n    endChanges() {\r\n        this.dispatchEvent(new ModelEvent(\"modelchange\"));\r\n        __classPrivateFieldGet(this, _ModelNodeBase_records, \"f\").splice(0);\r\n        __classPrivateFieldSet(this, _ModelNodeBase_isRecording, false, \"f\");\r\n    }\r\n    getRecords() {\r\n        return __classPrivateFieldGet(this, _ModelNodeBase_records, \"f\").slice();\r\n    }\r\n    receiveEvent(event) {\r\n        super.receiveEvent(event);\r\n        const { parentNode } = this;\r\n        if (parentNode) {\r\n            parentNode.receiveEvent(event);\r\n        }\r\n    }\r\n}\r\n_ModelNodeBase_parentNode = new WeakMap(), _ModelNodeBase_records = new WeakMap(), _ModelNodeBase_isRecording = new WeakMap(), _ModelNodeBase_instances = new WeakSet(), _ModelNodeBase_triggerChange = function _ModelNodeBase_triggerChange(property, oldValue, newValue) {\r\n    const records = __classPrivateFieldGet(this, _ModelNodeBase_records, \"f\");\r\n    const record = new ModelChangeRecord({\r\n        target: this,\r\n        changeType: ModelChangeRecord.PROPERTY_CHANGE,\r\n        propertyName: property,\r\n        oldValue, newValue\r\n    });\r\n    records.push(record);\r\n    if (!__classPrivateFieldGet(this, _ModelNodeBase_isRecording, \"f\")) {\r\n        this.dispatchEvent(new ModelEvent(\"modelchange\"));\r\n        records.splice(0);\r\n    }\r\n}, _ModelNodeBase_handleRecord = function _ModelNodeBase_handleRecord(record) {\r\n    __classPrivateFieldGet(this, _ModelNodeBase_records, \"f\").push(record);\r\n    if (!__classPrivateFieldGet(this, _ModelNodeBase_isRecording, \"f\")) {\r\n        this.dispatchEvent(new ModelEvent(\"modelchange\"));\r\n        __classPrivateFieldGet(this, _ModelNodeBase_records, \"f\").splice(0);\r\n    }\r\n};\r\nModelNodeBase.ModelNodeRecordsAccessor = new class ModelNodeRecordsAccessor {\r\n    triggerChange(node, property, oldValue, newValue) {\r\n        if (node instanceof ModelNodeBase) {\r\n            __classPrivateFieldGet(node, _ModelNodeBase_instances, \"m\", _ModelNodeBase_triggerChange).call(node, property, oldValue, newValue);\r\n        }\r\n    }\r\n    handleRecord(node, record) {\r\n        if (node instanceof ModelNodeBase) {\r\n            __classPrivateFieldGet(node, _ModelNodeBase_instances, \"m\", _ModelNodeBase_handleRecord).call(node, record);\r\n        }\r\n    }\r\n};\r\nvar ModelNodeRecordsAccessor = ModelNodeBase.ModelNodeRecordsAccessor;\r\ndelete ModelNodeBase.ModelNodeRecordsAccessor;\r\nvar ModelNode = ModelNodeBase;\r\nconst ReactiveProperty = function () {\r\n    return (target, property) => {\r\n        const { constructor } = target;\r\n        const { prototype } = constructor;\r\n        const setter = function (value) {\r\n            const oldValue = ModelReactivePropertiesAccessor.getProperty(this, property);\r\n            ModelReactivePropertiesAccessor.setProperty(this, property, value);\r\n            if (value !== oldValue) {\r\n                ModelNodeRecordsAccessor.triggerChange(this, property, oldValue, value);\r\n            }\r\n            return true;\r\n        };\r\n        const getter = function () {\r\n            return ModelReactivePropertiesAccessor.getProperty(this, property);\r\n        };\r\n        Object.defineProperty(prototype, property, {\r\n            set: setter,\r\n            get: getter,\r\n            enumerable: true\r\n        });\r\n    };\r\n};\r\nclass ModelObjectBase extends ModelNodeBase {\r\n    constructor() {\r\n        super();\r\n        _ModelObjectBase_properties.set(this, void 0);\r\n        __classPrivateFieldSet(this, _ModelObjectBase_properties, new Map(), \"f\");\r\n    }\r\n}\r\n_ModelObjectBase_properties = new WeakMap();\r\nModelObjectBase.ModelReactivePropertiesAccessor = new class ModelReactivePropertiesAccessor {\r\n    setProperty(node, property, value) {\r\n        if (node instanceof ModelObjectBase) {\r\n            __classPrivateFieldGet(node, _ModelObjectBase_properties, \"f\").set(property, value);\r\n        }\r\n    }\r\n    getProperty(node, property) {\r\n        if (node instanceof ModelObjectBase) {\r\n            return __classPrivateFieldGet(node, _ModelObjectBase_properties, \"f\").get(property);\r\n        }\r\n    }\r\n};\r\nvar ModelReactivePropertiesAccessor = ModelObjectBase.ModelReactivePropertiesAccessor;\r\ndelete ModelObjectBase.ModelReactivePropertiesAccessor;\r\nvar ModelObject = ModelObjectBase;\r\nclass ModelListBase extends ModelNodeBase {\r\n    constructor(items) {\r\n        var _a;\r\n        super();\r\n        _ModelListBase_items.set(this, void 0);\r\n        __classPrivateFieldSet(this, _ModelListBase_items, (_a = items === null || items === void 0 ? void 0 : items.slice()) !== null && _a !== void 0 ? _a : [], \"f\");\r\n    }\r\n    setParent(parentNode) {\r\n        super.setParent(parentNode);\r\n        __classPrivateFieldGet(this, _ModelListBase_items, \"f\").forEach((item_i) => {\r\n            item_i.setParent(parentNode);\r\n        });\r\n    }\r\n    get length() {\r\n        return __classPrivateFieldGet(this, _ModelListBase_items, \"f\").length;\r\n    }\r\n    get(index) {\r\n        var _a;\r\n        return (_a = __classPrivateFieldGet(this, _ModelListBase_items, \"f\")[index]) !== null && _a !== void 0 ? _a : null;\r\n    }\r\n    index(item) {\r\n        return __classPrivateFieldGet(this, _ModelListBase_items, \"f\").indexOf(item);\r\n    }\r\n    values() {\r\n        return __classPrivateFieldGet(this, _ModelListBase_items, \"f\").values();\r\n    }\r\n    sort(compareFunction) {\r\n        const items = __classPrivateFieldGet(this, _ModelListBase_items, \"f\");\r\n        const indexedItems = items.map((item_i, i) => {\r\n            return {\r\n                item: item_i,\r\n                index: i\r\n            };\r\n        });\r\n        indexedItems.sort((indexedItem_a, indexedItem_b) => {\r\n            return compareFunction(indexedItem_a.item, indexedItem_b.item);\r\n        });\r\n        __classPrivateFieldSet(this, _ModelListBase_items, indexedItems.map(indexedItem_i => indexedItem_i.item), \"f\");\r\n        const record = new ModelChangeRecord({\r\n            target: this,\r\n            changeType: ModelChangeRecord.LIST_SORT,\r\n            sortedIndices: indexedItems.map(indexedItem_i => indexedItem_i.index)\r\n        });\r\n        ModelNodeRecordsAccessor.handleRecord(this, record);\r\n    }\r\n    prepend(...items) {\r\n        const _items = __classPrivateFieldGet(this, _ModelListBase_items, \"f\");\r\n        const { parentNode } = this;\r\n        if (parentNode) {\r\n            items.forEach(item_i => {\r\n                item_i.setParent(parentNode);\r\n            });\r\n        }\r\n        _items.splice(0, 0, ...items);\r\n        const record = new ModelChangeRecord({\r\n            target: this,\r\n            changeType: ModelChangeRecord.LIST_INSERT,\r\n            insertedIndex: 0,\r\n            insertedItems: items\r\n        });\r\n        ModelNodeRecordsAccessor.handleRecord(this, record);\r\n    }\r\n    append(...items) {\r\n        const _items = __classPrivateFieldGet(this, _ModelListBase_items, \"f\");\r\n        const { length } = _items;\r\n        const { parentNode } = this;\r\n        if (parentNode) {\r\n            items.forEach(item_i => {\r\n                item_i.setParent(parentNode);\r\n            });\r\n        }\r\n        _items.push(...items);\r\n        const record = new ModelChangeRecord({\r\n            target: this,\r\n            changeType: ModelChangeRecord.LIST_INSERT,\r\n            insertedIndex: length,\r\n            insertedItems: items\r\n        });\r\n        ModelNodeRecordsAccessor.handleRecord(this, record);\r\n    }\r\n    insert(index, ...items) {\r\n        const _items = __classPrivateFieldGet(this, _ModelListBase_items, \"f\");\r\n        const { length } = _items;\r\n        const positiveIndex = Math.abs(index);\r\n        if (positiveIndex <= length) {\r\n            if (index >= 0) {\r\n                const { parentNode } = this;\r\n                items.forEach(item_i => {\r\n                    item_i.setParent(parentNode);\r\n                });\r\n                if (index < length) {\r\n                    _items.splice(index, 0, ...items);\r\n                }\r\n                else {\r\n                    _items.push(...items);\r\n                }\r\n            }\r\n            else if (index < 0) {\r\n                index = length - index;\r\n                const { parentNode } = this;\r\n                if (parentNode) {\r\n                    items.forEach(item_i => {\r\n                        item_i.setParent(parentNode);\r\n                    });\r\n                }\r\n                _items.splice(index, 0, ...items);\r\n            }\r\n            const record = new ModelChangeRecord({\r\n                target: this,\r\n                changeType: ModelChangeRecord.LIST_INSERT,\r\n                insertedIndex: index,\r\n                insertedItems: items.slice()\r\n            });\r\n            ModelNodeRecordsAccessor.handleRecord(this, record);\r\n        }\r\n    }\r\n    remove(item) {\r\n        const _items = __classPrivateFieldGet(this, _ModelListBase_items, \"f\");\r\n        const index = _items.indexOf(item);\r\n        if (index > -1) {\r\n            const item = _items.splice(index, 1)[0];\r\n            const { parentNode } = this;\r\n            if (parentNode) {\r\n                item.setParent(null);\r\n            }\r\n            const record = new ModelChangeRecord({\r\n                target: this,\r\n                changeType: ModelChangeRecord.LIST_REMOVE,\r\n                removedIndex: index,\r\n                removedItems: [item]\r\n            });\r\n            ModelNodeRecordsAccessor.handleRecord(this, record);\r\n        }\r\n    }\r\n    clear() {\r\n        const items = __classPrivateFieldGet(this, _ModelListBase_items, \"f\");\r\n        const { length } = items;\r\n        if (length > 0) {\r\n            const removedItems = items.splice(0);\r\n            const { parentNode } = this;\r\n            if (parentNode) {\r\n                removedItems.forEach((removedItem_i) => {\r\n                    removedItem_i.setParent(null);\r\n                });\r\n            }\r\n            const record = new ModelChangeRecord({\r\n                target: this,\r\n                changeType: ModelChangeRecord.LIST_REMOVE,\r\n                removedIndex: 0,\r\n                removedItems: removedItems\r\n            });\r\n            ModelNodeRecordsAccessor.handleRecord(this, record);\r\n        }\r\n    }\r\n}\r\n_ModelListBase_items = new WeakMap();\r\n;\r\nvar ModelList = ModelListBase;\r\nclass ModelChangeObserverBase {\r\n    constructor(callback) {\r\n        _ModelChangeObserverBase_instances.add(this);\r\n        _ModelChangeObserverBase_callback.set(this, void 0);\r\n        _ModelChangeObserverBase_records.set(this, void 0);\r\n        _ModelChangeObserverBase_disconnected.set(this, void 0);\r\n        _ModelChangeObserverBase_references.set(this, void 0);\r\n        __classPrivateFieldSet(this, _ModelChangeObserverBase_callback, callback, \"f\");\r\n        __classPrivateFieldSet(this, _ModelChangeObserverBase_records, [], \"f\");\r\n        __classPrivateFieldSet(this, _ModelChangeObserverBase_disconnected, false, \"f\");\r\n        __classPrivateFieldSet(this, _ModelChangeObserverBase_references, new WeakMap(), \"f\");\r\n    }\r\n    observe(node, options) {\r\n        __classPrivateFieldSet(this, _ModelChangeObserverBase_disconnected, false, \"f\");\r\n        const references = __classPrivateFieldGet(this, _ModelChangeObserverBase_references, \"f\");\r\n        let reference = references.get(node);\r\n        if (!reference) {\r\n            const listener = __classPrivateFieldGet(this, _ModelChangeObserverBase_instances, \"m\", _ModelChangeObserverBase_handleModelEvent).bind(this);\r\n            node.addEventListener(\"modelchange\", listener);\r\n            reference = { listener, options };\r\n            references.set(node, reference);\r\n        }\r\n        else {\r\n            references.set(node, reference);\r\n        }\r\n    }\r\n    unobserve(node) {\r\n        const references = __classPrivateFieldGet(this, _ModelChangeObserverBase_references, \"f\");\r\n        let reference = references.get(node);\r\n        if (reference) {\r\n            const { listener } = reference;\r\n            node.removeEventListener(\"modelchange\", listener);\r\n        }\r\n    }\r\n    disconnect() {\r\n        __classPrivateFieldGet(this, _ModelChangeObserverBase_records, \"f\").splice(0);\r\n        __classPrivateFieldSet(this, _ModelChangeObserverBase_disconnected, true, \"f\");\r\n    }\r\n}\r\n_ModelChangeObserverBase_callback = new WeakMap(), _ModelChangeObserverBase_records = new WeakMap(), _ModelChangeObserverBase_disconnected = new WeakMap(), _ModelChangeObserverBase_references = new WeakMap(), _ModelChangeObserverBase_instances = new WeakSet(), _ModelChangeObserverBase_trigger = function _ModelChangeObserverBase_trigger() {\r\n    const records = __classPrivateFieldGet(this, _ModelChangeObserverBase_records, \"f\").splice(0);\r\n    if (records.length > 0) {\r\n        __classPrivateFieldGet(this, _ModelChangeObserverBase_callback, \"f\").call(this, records);\r\n    }\r\n}, _ModelChangeObserverBase_handleModelEvent = function _ModelChangeObserverBase_handleModelEvent(event) {\r\n    if (!__classPrivateFieldGet(this, _ModelChangeObserverBase_disconnected, \"f\")) {\r\n        const { target, currentTarget } = event;\r\n        const reference = __classPrivateFieldGet(this, _ModelChangeObserverBase_references, \"f\").get(currentTarget);\r\n        if (reference) {\r\n            const { options } = reference;\r\n            const { properties, propertiesFilter, childList, subtree } = options;\r\n            if (subtree) {\r\n                if (properties && target instanceof ModelNode) {\r\n                    if (propertiesFilter) {\r\n                        __classPrivateFieldGet(this, _ModelChangeObserverBase_records, \"f\").push(...target.getRecords()\r\n                            .filter(record_i => {\r\n                            const { propertyName } = record_i;\r\n                            return propertiesFilter.includes(propertyName);\r\n                        }));\r\n                    }\r\n                    else {\r\n                        __classPrivateFieldGet(this, _ModelChangeObserverBase_records, \"f\").push(...target.getRecords());\r\n                    }\r\n                    __classPrivateFieldGet(this, _ModelChangeObserverBase_instances, \"m\", _ModelChangeObserverBase_trigger).call(this);\r\n                }\r\n                else if (childList && target instanceof ModelList) {\r\n                    __classPrivateFieldGet(this, _ModelChangeObserverBase_records, \"f\").push(...target.getRecords());\r\n                    __classPrivateFieldGet(this, _ModelChangeObserverBase_instances, \"m\", _ModelChangeObserverBase_trigger).call(this);\r\n                }\r\n            }\r\n            else if (target == currentTarget) {\r\n                if (properties && target instanceof ModelNode) {\r\n                    if (propertiesFilter) {\r\n                        __classPrivateFieldGet(this, _ModelChangeObserverBase_records, \"f\").push(...target.getRecords()\r\n                            .filter(record_i => {\r\n                            const { propertyName } = record_i;\r\n                            return propertiesFilter.includes(propertyName);\r\n                        }));\r\n                    }\r\n                    else {\r\n                        __classPrivateFieldGet(this, _ModelChangeObserverBase_records, \"f\").push(...target.getRecords());\r\n                    }\r\n                    __classPrivateFieldGet(this, _ModelChangeObserverBase_instances, \"m\", _ModelChangeObserverBase_trigger).call(this);\r\n                }\r\n                else if (childList && target instanceof ModelList) {\r\n                    __classPrivateFieldGet(this, _ModelChangeObserverBase_records, \"f\").push(...target.getRecords());\r\n                    __classPrivateFieldGet(this, _ModelChangeObserverBase_instances, \"m\", _ModelChangeObserverBase_trigger).call(this);\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\nvar ModelChangeObserver = ModelChangeObserverBase;\r\n//# sourceMappingURL=Model.js.map","export { snakeToCamel };\r\nexport { camelToSnake };\r\nexport { trainToCamel };\r\nexport { camelToTrain };\r\nfunction snakeToCamel(str) {\r\n    return str.split('_').map(str => str.charAt(0).toUpperCase() + str.substring(1).toLowerCase()).join(\"\");\r\n}\r\nfunction camelToSnake(str) {\r\n    return str.replace(/(?<!^)(?=[A-Z])/g, '_').toLowerCase();\r\n}\r\nfunction trainToCamel(str) {\r\n    return str.split('-').map(str => str.charAt(0).toUpperCase() + str.substring(1).toLowerCase()).join(\"\");\r\n}\r\nfunction camelToTrain(str) {\r\n    return str.replace(/(?<!^)(?=[A-Z])/g, '-').toLowerCase();\r\n}\r\n//# sourceMappingURL=Snippets.js.map","import { ModelChangeObserver } from \"../models/Model\";\r\nimport { camelToTrain } from \"./Snippets\";\r\nexport { CustomElement };\r\nexport { QueryProperty };\r\nexport { QueryAllProperty };\r\nexport { AttributeProperty };\r\nexport { reactiveElement };\r\nexport { revokeReactiveElement };\r\nexport { reactiveChildElements };\r\nexport { revokeReactiveChildElements };\r\nexport { element };\r\nexport { fragment };\r\nexport { textNode };\r\nexport { areAttributesMatching };\r\nexport { AttributeMutationMixinBase };\r\nexport { trimMultilineIndent };\r\nexport { Stylesheet };\r\nexport { reactiveElementsMap };\r\nconst AttributeProperty = function (init) {\r\n    return (target, property) => {\r\n        const { constructor } = target;\r\n        const { prototype } = constructor;\r\n        const propertyName = String(property);\r\n        const { defaultValue = null, observed = false, name = camelToTrain(propertyName) } = init;\r\n        if (observed) {\r\n            const observedAttributes = Reflect.get(constructor, \"observedAttributes\", constructor);\r\n            if (Array.isArray(observedAttributes)) {\r\n                observedAttributes.push(name);\r\n            }\r\n            else {\r\n                Object.defineProperty(constructor, \"observedAttributes\", {\r\n                    value: [name],\r\n                    writable: false\r\n                });\r\n            }\r\n        }\r\n        const { type } = init;\r\n        switch (type) {\r\n            case Boolean: {\r\n                Object.defineProperty(prototype, propertyName, {\r\n                    get: function () {\r\n                        return this.hasAttribute(name);\r\n                    },\r\n                    set: function (value) {\r\n                        if (value) {\r\n                            this.setAttribute(name, \"\");\r\n                        }\r\n                        else {\r\n                            this.removeAttribute(name);\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            }\r\n            case Object: {\r\n                Object.defineProperty(prototype, propertyName, {\r\n                    get: function () {\r\n                        const val = this.getAttribute(name);\r\n                        return (val !== null) ? JSON.parse(val) : defaultValue;\r\n                    },\r\n                    set: function (value) {\r\n                        if (value !== null) {\r\n                            this.setAttribute(name, JSON.stringify(value));\r\n                        }\r\n                        else {\r\n                            this.removeAttribute(name);\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            }\r\n            case Number: {\r\n                Object.defineProperty(prototype, propertyName, {\r\n                    get: function () {\r\n                        const val = this.getAttribute(name);\r\n                        return (val !== null) ? parseFloat(val) : defaultValue;\r\n                    },\r\n                    set: function (value) {\r\n                        if (value !== null) {\r\n                            this.setAttribute(name, value);\r\n                        }\r\n                        else {\r\n                            this.removeAttribute(name);\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            }\r\n            case String:\r\n            default: {\r\n                Object.defineProperty(prototype, propertyName, {\r\n                    get: function () {\r\n                        const val = this.getAttribute(name);\r\n                        return (val !== null) ? val : defaultValue;\r\n                    },\r\n                    set: function (value) {\r\n                        if (value !== null) {\r\n                            this.setAttribute(name, value);\r\n                        }\r\n                        else {\r\n                            this.removeAttribute(name);\r\n                        }\r\n                    }\r\n                });\r\n                break;\r\n            }\r\n        }\r\n    };\r\n};\r\nfunction Stylesheet(text) {\r\n    const stylesheet = new CSSStyleSheet();\r\n    stylesheet.replaceSync(text);\r\n    return stylesheet;\r\n}\r\nfunction trimMultilineIndent(text) {\r\n    const newlineIndex = text.indexOf(\"\\n\");\r\n    text = text.substring(newlineIndex + 1);\r\n    const indentMatch = text.match(/^[\\s]*/);\r\n    if (indentMatch) {\r\n        const indent = text.substring(0, indentMatch[0].length);\r\n        text = text.replaceAll(indent, \"\").trimEnd();\r\n    }\r\n    return text;\r\n}\r\nconst CustomElement = function (init) {\r\n    return (elementCtor) => {\r\n        const { name, options } = init;\r\n        if (!customElements.get(name)) {\r\n            customElements.define(name, elementCtor, options);\r\n        }\r\n        return elementCtor;\r\n    };\r\n};\r\nconst QueryProperty = function (init) {\r\n    return (target, propertyKey) => {\r\n        var _a;\r\n        const { constructor } = target;\r\n        const { prototype } = constructor;\r\n        const propertyName = String(propertyKey);\r\n        const { selector } = init;\r\n        const withinShadowRoot = (_a = init.withinShadowRoot) !== null && _a !== void 0 ? _a : false;\r\n        const getter = withinShadowRoot ? function () {\r\n            return this.shadowRoot.querySelector(selector);\r\n        } : function () {\r\n            return this.querySelector(selector);\r\n        };\r\n        Object.defineProperty(prototype, propertyName, {\r\n            get: getter\r\n        });\r\n    };\r\n};\r\nconst QueryAllProperty = function (init) {\r\n    return (target, propertyKey) => {\r\n        var _a;\r\n        const { constructor } = target;\r\n        const { prototype } = constructor;\r\n        const propertyName = String(propertyKey);\r\n        const { selector } = init;\r\n        const withinShadowRoot = (_a = init.withinShadowRoot) !== null && _a !== void 0 ? _a : false;\r\n        const getter = withinShadowRoot ? function () {\r\n            return Array.from(this.shadowRoot.querySelectorAll(selector));\r\n        } : function () {\r\n            return Array.from(this.querySelectorAll(selector));\r\n        };\r\n        Object.defineProperty(prototype, propertyName, {\r\n            get: getter\r\n        });\r\n    };\r\n};\r\nfunction fragment(...nodes) {\r\n    const fragment = document.createDocumentFragment();\r\n    fragment.append(...nodes);\r\n    return fragment;\r\n}\r\nfunction textNode(text) {\r\n    return document.createTextNode(text);\r\n}\r\nfunction element(tagName, init) {\r\n    if (init) {\r\n        const { options, attributes, dataset, children, listeners } = init;\r\n        const element = document.createElement(tagName, options);\r\n        if (attributes) {\r\n            Object.entries(attributes).forEach(([attributeName, attributeValue]) => {\r\n                if (attributeValue !== undefined) {\r\n                    if (typeof attributeValue === \"boolean\") {\r\n                        element.toggleAttribute(camelToTrain(attributeName), attributeValue);\r\n                    }\r\n                    else {\r\n                        element.setAttribute(camelToTrain(attributeName), String(attributeValue));\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        if (dataset) {\r\n            const { dataset: elementDataset } = element;\r\n            Object.entries(dataset).forEach(([attributeName, attributeValue]) => {\r\n                if (typeof attributeValue === \"boolean\") {\r\n                    if (attributeValue) {\r\n                        elementDataset[camelToTrain(attributeName)] = \"\";\r\n                    }\r\n                    else {\r\n                        delete elementDataset[camelToTrain(attributeName)];\r\n                    }\r\n                }\r\n                else {\r\n                    elementDataset[camelToTrain(attributeName)] = String(attributeValue);\r\n                }\r\n            });\r\n        }\r\n        if (children) {\r\n            if (typeof children === \"function\") {\r\n                children(element);\r\n            }\r\n            else if (typeof children === \"object\" && \"length\" in children) {\r\n                element.append(...Array.from(children));\r\n            }\r\n            else {\r\n                element.append(children);\r\n            }\r\n        }\r\n        if (listeners) {\r\n            Object.entries(listeners).forEach(([name_i, listener_i]) => {\r\n                if (Array.isArray(listener_i)) {\r\n                    element.addEventListener(name_i, listener_i[0], listener_i[1]);\r\n                }\r\n                else {\r\n                    element.addEventListener(name_i, listener_i);\r\n                }\r\n            });\r\n        }\r\n        return element;\r\n    }\r\n    return document.createElement(tagName);\r\n}\r\nconst reactiveElementsMap = new WeakMap();\r\nconst reactiveElementsFinalizationRegistry = new FinalizationRegistry((heldValue) => {\r\n    const { model, reactiveElement } = heldValue;\r\n    const reactiveElementsMapEntry = reactiveElementsMap.get(model);\r\n    if (reactiveElementsMapEntry !== undefined) {\r\n        const { reactiveElementsArray } = reactiveElementsMapEntry;\r\n        reactiveElementsArray.splice(reactiveElementsArray.indexOf(reactiveElement), 1);\r\n    }\r\n});\r\nconst reactiveElementsPropertyObserver = new ModelChangeObserver((records) => {\r\n    records.forEach((record_i) => {\r\n        const { target, propertyName, oldValue, newValue } = record_i;\r\n        const { reactiveElementsArray } = reactiveElementsMap.get(target);\r\n        reactiveElementsArray.forEach(reactiveElement_i => {\r\n            const { elementRef, react, properties } = reactiveElement_i;\r\n            const element = elementRef.deref();\r\n            if (element) {\r\n                if (properties.includes(propertyName)) {\r\n                    react(element, propertyName, oldValue, newValue);\r\n                }\r\n            }\r\n        });\r\n    });\r\n});\r\nfunction reactiveElement(model, element, properties, react) {\r\n    const elementRef = new WeakRef(element);\r\n    const reactiveElement = { elementRef, react, properties };\r\n    const reactiveElementsMapEntry = reactiveElementsMap.get(model);\r\n    reactiveElementsFinalizationRegistry.register(element, { model, reactiveElement });\r\n    if (!reactiveElementsMapEntry) {\r\n        const observerOptions = {\r\n            properties: true,\r\n            propertiesFilter: properties\r\n        };\r\n        const reactiveElementsArray = [reactiveElement];\r\n        reactiveElementsMap.set(model, { observerOptions, reactiveElementsArray });\r\n        reactiveElementsPropertyObserver.observe(model, observerOptions);\r\n    }\r\n    else {\r\n        const { reactiveElementsArray, observerOptions } = reactiveElementsMapEntry;\r\n        const { propertiesFilter } = observerOptions;\r\n        reactiveElementsArray.push(reactiveElement);\r\n        observerOptions.propertiesFilter = propertiesFilter ?\r\n            propertiesFilter.concat(properties.filter(property_i => !propertiesFilter.includes(property_i))) : properties.filter((property_i, i, properties) => properties.indexOf(property_i) === i);\r\n    }\r\n    properties.forEach((property_i) => {\r\n        if (property_i in model) {\r\n            const value = Reflect.get(model, property_i, model);\r\n            react(element, property_i, undefined, value);\r\n        }\r\n    });\r\n    return element;\r\n}\r\nfunction revokeReactiveElement(model, element) {\r\n    const reactiveElementsMapEntry = reactiveElementsMap.get(model);\r\n    if (reactiveElementsMapEntry) {\r\n        const { reactiveElementsArray } = reactiveElementsMapEntry;\r\n        const reactiveElementIndex = reactiveElementsArray.findIndex(reactiveElement => reactiveElement.elementRef.deref() === element);\r\n        if (reactiveElementIndex > -1) {\r\n            reactiveElementsArray.splice(reactiveElementIndex, 1);\r\n        }\r\n        if (reactiveElementsArray.length === 0) {\r\n            reactiveElementsMap.delete(model);\r\n        }\r\n    }\r\n}\r\nconst reactiveChildElementsMap = new WeakMap();\r\nconst reactiveChildElementsFinalizationRegistry = new FinalizationRegistry((heldValue) => {\r\n    const { list, reactiveChildElement } = heldValue;\r\n    const reactiveChildrenElementsMapEntry = reactiveChildElementsMap.get(list);\r\n    if (reactiveChildrenElementsMapEntry) {\r\n        const { reactiveChildElementsArray } = reactiveChildrenElementsMapEntry;\r\n        reactiveChildElementsArray.splice(reactiveChildElementsArray.indexOf(reactiveChildElement), 1);\r\n    }\r\n});\r\nconst reactiveChildElementsObserver = new ModelChangeObserver((records) => {\r\n    let range = null;\r\n    Array.from(records.values()).forEach((record_i) => {\r\n        const { target } = record_i;\r\n        const list = target;\r\n        const { length: listLength } = list;\r\n        const { reactiveChildElementsArray } = reactiveChildElementsMap.get(list);\r\n        reactiveChildElementsArray.forEach((reactiveChildElements_i) => {\r\n            const { parentRef, mapping, placeholder } = reactiveChildElements_i;\r\n            const parent = parentRef.deref();\r\n            if (parent) {\r\n                const { firstChild, children } = parent;\r\n                const { length: childrenCount } = children;\r\n                if (placeholder && listLength > 0 && firstChild == placeholder) {\r\n                    parent.removeChild(placeholder);\r\n                }\r\n                const { changeType, LIST_INSERT, LIST_REMOVE, LIST_SORT } = record_i;\r\n                switch (changeType) {\r\n                    case LIST_INSERT: {\r\n                        const { insertedIndex, insertedItems } = record_i;\r\n                        const insertedItemsArray = Array.from(insertedItems.values()).map(mapping);\r\n                        const { length: childrenCount } = children;\r\n                        if (insertedIndex < childrenCount) {\r\n                            children[insertedIndex].before(...insertedItemsArray);\r\n                        }\r\n                        else {\r\n                            parent.append(...insertedItemsArray);\r\n                        }\r\n                        break;\r\n                    }\r\n                    case LIST_REMOVE: {\r\n                        const { removedIndex, removedItems } = record_i;\r\n                        const { length: removedCount } = removedItems;\r\n                        range = range !== null && range !== void 0 ? range : document.createRange();\r\n                        const removeEndIndex = removedIndex + (removedCount - 1);\r\n                        if (removeEndIndex < childrenCount) {\r\n                            range.setStartBefore(children[removedIndex]);\r\n                            range.setEndAfter(children[removeEndIndex]);\r\n                            range.deleteContents();\r\n                        }\r\n                        break;\r\n                    }\r\n                    case LIST_SORT: {\r\n                        const { sortedIndices } = record_i;\r\n                        const childrenArray = Array.from(children);\r\n                        parent.append(...sortedIndices.filter(index_i => index_i < childrenCount).map(index_i => childrenArray[index_i]));\r\n                        break;\r\n                    }\r\n                }\r\n                if (listLength == 0 && placeholder) {\r\n                    parent.append(placeholder);\r\n                }\r\n            }\r\n        });\r\n    });\r\n});\r\nfunction reactiveChildElements(list, mapping, placeholder) {\r\n    return (parent) => {\r\n        const parentRef = new WeakRef(parent);\r\n        const reactiveChildElementsMapEntry = reactiveChildElementsMap.get(list);\r\n        const reactiveChildElement = { parentRef, mapping, placeholder };\r\n        reactiveChildElementsFinalizationRegistry.register(parent, { list, reactiveChildElement });\r\n        if (!reactiveChildElementsMapEntry) {\r\n            const reactiveChildElementsArray = [reactiveChildElement];\r\n            reactiveChildElementsMap.set(list, { reactiveChildElementsArray });\r\n            reactiveChildElementsObserver.observe(list, {\r\n                childList: true\r\n            });\r\n        }\r\n        else {\r\n            const { reactiveChildElementsArray } = reactiveChildElementsMapEntry;\r\n            reactiveChildElementsArray.push(reactiveChildElement);\r\n        }\r\n        const children = list.length == 0 && placeholder ?\r\n            [placeholder] : Array.from(list.values()).map(mapping);\r\n        parent.replaceChildren(...children);\r\n    };\r\n}\r\nfunction revokeReactiveChildElements(list, parent) {\r\n    const reactiveChildElementsMapEntry = reactiveChildElementsMap.get(list);\r\n    if (reactiveChildElementsMapEntry) {\r\n        const { reactiveChildElementsArray } = reactiveChildElementsMapEntry;\r\n        const reactiveChildElementsIndex = reactiveChildElementsArray.findIndex(reactiveChildElement => reactiveChildElement.parentRef.deref() === parent);\r\n        if (reactiveChildElementsIndex > -1) {\r\n            reactiveChildElementsArray.splice(reactiveChildElementsIndex, 1);\r\n        }\r\n        if (reactiveChildElementsArray.length === 0) {\r\n            reactiveChildElementsMap.delete(list);\r\n        }\r\n    }\r\n}\r\nfunction areAttributesMatching(referenceAttributeType, referenceAttributeName, referenceAttributeValue, attributeName, attributeValue) {\r\n    if (referenceAttributeName == attributeName) {\r\n        switch (referenceAttributeType) {\r\n            case \"boolean\":\r\n                return referenceAttributeValue == \"\" && attributeValue == \"\";\r\n            case \"string\":\r\n                return referenceAttributeValue !== \"\" && (referenceAttributeValue == attributeValue);\r\n            case \"list\":\r\n                return (referenceAttributeValue !== \"\" && attributeValue !== null) && new RegExp(`${referenceAttributeValue}\\s*?`, \"g\").test(attributeValue);\r\n        }\r\n    }\r\n    return false;\r\n}\r\nclass AttributeMutationMixinBase {\r\n    constructor(attributeName, attributeType = \"boolean\", attributeValue = \"\") {\r\n        this.attributeName = attributeName;\r\n        this.attributeType = attributeType;\r\n        this.attributeValue = attributeValue;\r\n    }\r\n    attach() {\r\n        throw new TypeError(\"Not implemented method.\");\r\n    }\r\n    detach() {\r\n        throw new TypeError(\"Not implemented method.\");\r\n    }\r\n}\r\n//# sourceMappingURL=Element.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _Theme_instances, _Theme_handleModelChangeEvent;\r\nimport DEFAULT_THEME_ARROW_RIGHT_IMAGE from \"../../assets/arrow_right_FILL0_wght400_GRAD0_opsz48.svg\";\r\nimport DEFAULT_THEME_ARROW_DROPDOWN_IMAGE from \"../../assets/arrow_drop_down_FILL0_wght400_GRAD0_opsz48.svg\";\r\nimport DEFAULT_THEME_ARROW_DROPUP_IMAGE from \"../../assets/arrow_drop_up_FILL0_wght400_GRAD0_opsz48.svg\";\r\nimport DEFAULT_THEME_CHECKED_IMAGE from \"../../assets/done_FILL0_wght400_GRAD0_opsz48.svg\";\r\nimport openSansTtf from \"../../assets/fonts/Open_Sans/OpenSans-VariableFont_wdth,wght.ttf\";\r\nimport { ModelObject, ReactiveProperty } from \"../models/Model\";\r\nexport { theme };\r\nexport { DEFAULT_THEME_HOVERED_ITEM_COLOR };\r\nexport { DEFAULT_THEME_FOCUSED_ITEM_COLOR };\r\nexport { DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR };\r\nexport { DEFAULT_THEME_SELECTED_ITEM_COLOR };\r\nexport { DEFAULT_THEME_ACTIVATED_ITEM_COLOR };\r\nexport { DEFAULT_THEME_DROPTARGET_ITEM_COLOR };\r\nexport { DEFAULT_THEME_ARROW_RIGHT_IMAGE };\r\nexport { DEFAULT_THEME_ARROW_DROPDOWN_IMAGE };\r\nexport { DEFAULT_THEME_ARROW_DROPUP_IMAGE };\r\nexport { DEFAULT_THEME_CHECKED_IMAGE };\r\nconst DEFAULT_THEME_TINT = 203;\r\nconst DEFAULT_THEME_ACCENT_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%, 50%)`;\r\nconst DEFAULT_THEME_HOVERED_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 80%, 50%)`;\r\nconst DEFAULT_THEME_FOCUSED_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%, 50%)`;\r\nconst DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%)`;\r\nconst DEFAULT_THEME_SELECTED_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 75%, 75%)`;\r\nconst DEFAULT_THEME_ACTIVATED_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%, 50%)`;\r\nconst DEFAULT_THEME_DROPTARGET_ITEM_COLOR = `hsl(var(--theme-tint, ${DEFAULT_THEME_TINT}), 92%, 50%, 50%)`;\r\nclass Theme extends ModelObject {\r\n    constructor() {\r\n        super();\r\n        _Theme_instances.add(this);\r\n        this.stylesheet = new CSSStyleSheet();\r\n        this.stylesheet.replace(/*css*/ `\r\n            :root {\r\n                --theme-accent-color: ${DEFAULT_THEME_ACCENT_COLOR};\r\n                --theme-hovered-item-color: ${DEFAULT_THEME_HOVERED_ITEM_COLOR};\r\n                --theme-focused-item-color: ${DEFAULT_THEME_FOCUSED_ITEM_COLOR};\r\n                --theme-focused-item-outline-color: ${DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR};\r\n                --theme-selected-item-color: ${DEFAULT_THEME_SELECTED_ITEM_COLOR};\r\n                --theme-activated-item-color: ${DEFAULT_THEME_ACTIVATED_ITEM_COLOR};\r\n                --theme-droptarget-item-color: ${DEFAULT_THEME_DROPTARGET_ITEM_COLOR};\r\n\r\n                --theme-arrow-color: var(--font-color);\r\n                --theme-arrow-icon-collapsed: var(--arrow-right);\r\n                --theme-arrow-icon-expanded: var(--arrow-dropdown);\r\n\r\n                --theme-sortorder-indicator-color: var(--font-color);\r\n                --theme-sortorder-indicator-ascending: var(--arrow-dropup);\r\n                --theme-sortorder-indicator-descending: var(--arrow-dropdown);\r\n            }\r\n            \r\n            @font-face {\r\n                font-family: \"Open Sans\";\r\n                src: url(${openSansTtf}) format(\"truetype\")\r\n            }\r\n\r\n            :root {\r\n                font-size: 10px;\r\n                font-family: \"Open Sans\";\r\n                accent-color: var(--theme-accent-color);\r\n            }\r\n\r\n            ::selection {\r\n                background-color: var(--theme-selected-item-color);\r\n            }\r\n        `);\r\n        this.addEventListener(\"modelchange\", __classPrivateFieldGet(this, _Theme_instances, \"m\", _Theme_handleModelChangeEvent).bind(this));\r\n        this.tint = DEFAULT_THEME_TINT;\r\n        this.arrowRightImage = DEFAULT_THEME_ARROW_RIGHT_IMAGE;\r\n        this.arrowDropDownImage = DEFAULT_THEME_ARROW_DROPDOWN_IMAGE;\r\n        this.arrowDropUpImage = DEFAULT_THEME_ARROW_DROPUP_IMAGE;\r\n        this.checkedImage = DEFAULT_THEME_ARROW_DROPDOWN_IMAGE;\r\n    }\r\n    images() {\r\n        return new Map([\r\n            [\"checkedImage\", this.checkedImage],\r\n            [\"arrowRightImage\", this.arrowRightImage],\r\n            [\"arrowDropDownImage\", this.arrowDropDownImage],\r\n            [\"arrowDropUpImage\", this.arrowDropUpImage],\r\n        ]);\r\n    }\r\n}\r\n_Theme_instances = new WeakSet(), _Theme_handleModelChangeEvent = function _Theme_handleModelChangeEvent() {\r\n    const { stylesheet } = this;\r\n    const variablesMap = stylesheet.cssRules[0].styleMap;\r\n    const records = this.getRecords();\r\n    records.forEach((record) => {\r\n        const { propertyName, newValue } = record;\r\n        switch (propertyName) {\r\n            case \"tint\": {\r\n                variablesMap.set(\"--theme-tint\", String(newValue));\r\n                break;\r\n            }\r\n            case \"checkedImage\": {\r\n                variablesMap.set(\"--theme-checked-image\", `url(${String(newValue)})`);\r\n                break;\r\n            }\r\n            case \"arrowRightImage\": {\r\n                variablesMap.set(\"--theme-arrow-right-image\", `url(${String(newValue)})`);\r\n                break;\r\n            }\r\n            case \"arrowDropDown\": {\r\n                variablesMap.set(\"--theme-arrow-dropdown-image\", `url(${String(newValue)})`);\r\n                break;\r\n            }\r\n            case \"arrowDropUp\": {\r\n                variablesMap.set(\"--theme-arrow-dropup-image\", `url(${String(newValue)})`);\r\n                break;\r\n            }\r\n        }\r\n    });\r\n};\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"tint\", void 0);\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"checkedImage\", void 0);\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"arrowRightImage\", void 0);\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"arrowDropDownImage\", void 0);\r\n__decorate([\r\n    ReactiveProperty()\r\n], Theme.prototype, \"arrowDropUpImage\", void 0);\r\nconst theme = new Theme();\r\n//# sourceMappingURL=Theme.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLEMenuItemElementBase_instances, _HTMLEMenuItemElementBase_positionMenu;\r\nimport { DEFAULT_THEME_CHECKED_IMAGE, DEFAULT_THEME_ACTIVATED_ITEM_COLOR, DEFAULT_THEME_FOCUSED_ITEM_COLOR, DEFAULT_THEME_HOVERED_ITEM_COLOR, DEFAULT_THEME_ARROW_RIGHT_IMAGE } from \"../../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, QueryProperty, element } from \"../../Element\";\r\nexport { HTMLEMenuItemElement };\r\nexport { EMenuItem };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEMenuItemElementBase = class HTMLEMenuItemElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLEMenuItemElementBase_instances.add(this);\r\n        const internals = this.attachInternals();\r\n        this.internals = internals;\r\n        internals.role = \"menuitem\";\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n    }\r\n    connectedCallback() {\r\n        const { tabIndex } = this;\r\n        this.tabIndex = tabIndex;\r\n    }\r\n    attributeChangedCallback(attributeName, oldValue, newValue) {\r\n        const { internals } = this;\r\n        switch (attributeName) {\r\n            case \"type\": {\r\n                switch (newValue) {\r\n                    case \"checkbox\":\r\n                    case \"radio\": {\r\n                        internals.role = `menuitem${newValue}`;\r\n                        break;\r\n                    }\r\n                    default: {\r\n                        internals.role = \"menuitem\";\r\n                        break;\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"checked\": {\r\n                internals.ariaChecked = String(newValue !== null);\r\n                break;\r\n            }\r\n            case \"disabled\": {\r\n                internals.ariaDisabled = String(newValue !== null);\r\n                break;\r\n            }\r\n            case \"expanded\": {\r\n                internals.ariaExpanded = String(newValue !== null);\r\n                break;\r\n            }\r\n            case \"label\": {\r\n                internals.ariaLabel = newValue;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    toggle(force) {\r\n        const { type, expanded } = this;\r\n        switch (type) {\r\n            case \"menu\":\r\n            case \"submenu\": {\r\n                const expand = force !== null && force !== void 0 ? force : !expanded;\r\n                this.expanded = expand;\r\n                if (expand) {\r\n                    __classPrivateFieldGet(this, _HTMLEMenuItemElementBase_instances, \"m\", _HTMLEMenuItemElementBase_positionMenu).call(this);\r\n                }\r\n                this.dispatchEvent(new Event(\"toggle\", { bubbles: true }));\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    expand() {\r\n        const { type, expanded } = this;\r\n        switch (type) {\r\n            case \"menu\":\r\n            case \"submenu\": {\r\n                if (!expanded) {\r\n                    this.expanded = true;\r\n                    __classPrivateFieldGet(this, _HTMLEMenuItemElementBase_instances, \"m\", _HTMLEMenuItemElementBase_positionMenu).call(this);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    collapse() {\r\n        const { type, expanded } = this;\r\n        switch (type) {\r\n            case \"menu\":\r\n            case \"submenu\": {\r\n                if (expanded) {\r\n                    this.expanded = false;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n_HTMLEMenuItemElementBase_instances = new WeakSet(), _HTMLEMenuItemElementBase_positionMenu = function _HTMLEMenuItemElementBase_positionMenu() {\r\n    const { menu } = this;\r\n    if (menu !== null) {\r\n        const { width, height } = this.getBoundingClientRect();\r\n        const { style: menuStyle } = menu;\r\n        const { width: menuWidth, height: menuHeight } = menu.getBoundingClientRect();\r\n        const { clientWidth, clientHeight } = document.body;\r\n        const { type, offsetLeft, offsetTop } = this;\r\n        const overflowX = offsetLeft + width + menuWidth - clientWidth;\r\n        const overflowY = offsetTop + menuHeight - clientHeight;\r\n        if (type === \"menu\") {\r\n            menuStyle.setProperty(\"left\", `${overflowX > 0 ?\r\n                offsetLeft + width - menuWidth :\r\n                offsetLeft}px`);\r\n            menuStyle.setProperty(\"top\", `${overflowY > 0 ?\r\n                offsetTop - menuHeight :\r\n                offsetTop + height}px`);\r\n        }\r\n        else {\r\n            menuStyle.setProperty(\"left\", `${overflowX > 0 ?\r\n                offsetLeft - menuWidth :\r\n                offsetLeft + width}px`);\r\n            menuStyle.setProperty(\"top\", `${overflowY > 0 ?\r\n                offsetTop + height - menuHeight :\r\n                offsetTop}px`);\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"span\", {\r\n        attributes: {\r\n            part: \"icon\"\r\n        }\r\n    }), element(\"span\", {\r\n        attributes: {\r\n            part: \"label\"\r\n        },\r\n        children: [\r\n            element(\"slot\")\r\n        ]\r\n    }), element(\"span\", {\r\n        attributes: {\r\n            part: \"arrow\"\r\n        }\r\n    }), element(\"slot\", {\r\n        attributes: {\r\n            name: \"menu\"\r\n        }\r\n    }));\r\n    style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                user-select: none;\r\n                white-space: nowrap;\r\n                box-sizing: border-box;\r\n            }\r\n            \r\n            :host([disabled]) {\r\n                opacity: 0.38;\r\n                pointer-events: none;\r\n            }\r\n            \r\n            :host(:focus-within) {\r\n                background-color: ${DEFAULT_THEME_FOCUSED_ITEM_COLOR};\r\n            }\r\n            \r\n            :host(:is([type=\"menu\"], [type=\"submenu\"])) ::slotted([slot=\"menu\"]) {\r\n                z-index: 1;\r\n                position: absolute;\r\n            }\r\n            \r\n            :host(:is([type=\"menu\"], [type=\"submenu\"]):not([expanded])) ::slotted([slot=\"menu\"]) {\r\n                width: 0;\r\n                height: 0;\r\n                padding: 0;\r\n                opacity: 0;\r\n                pointer-events: none;\r\n                overflow: hidden;\r\n            }\r\n            \r\n            :host([type=\"submenu\"]) [part=\"icon\"] {\r\n                visibility: hidden;\r\n            }\r\n            \r\n            :host([type=\"menu\"]) [part=\"icon\"],\r\n            :host(:not([type=\"submenu\"])) [part=\"arrow\"] {\r\n                display: none;\r\n            }\r\n            \r\n            :host(:is([type=\"checkbox\"], [type=\"radio\"])[checked]) [part=\"icon\"]::before {\r\n                -webkit-mask-image: var(--theme-arrow-done-image, url(${DEFAULT_THEME_CHECKED_IMAGE}));\r\n                mask-image: var(--theme-arrow-done-image, url(${DEFAULT_THEME_CHECKED_IMAGE}));\r\n                background-color: black;\r\n            }\r\n            \r\n            :host([type=\"submenu\"]) [part=\"arrow\"]::after {\r\n                -webkit-mask-image: var(--theme-arrow-right-image, url(${DEFAULT_THEME_ARROW_RIGHT_IMAGE}));\r\n                mask-image: var(--theme-arrow-right-image, url(${DEFAULT_THEME_ARROW_RIGHT_IMAGE}));\r\n                background-color: black;\r\n            }\r\n            \r\n            [part=\"icon\"],\r\n            [part=\"label\"],\r\n            [part=\"arrow\"] {\r\n                pointer-events: none;\r\n            }\r\n            \r\n            [part=\"icon\"] {\r\n                flex: none;\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                padding: 2px;\r\n                overflow: hidden;\r\n                margin-right: 4px;\r\n            }\r\n            \r\n            [part=\"label\"] {\r\n                flex: auto;\r\n                line-height: 18px;\r\n                padding: 2px;\r\n                margin-left: 8px;\r\n                margin-right: 8px;\r\n            }\r\n            \r\n            :host(:is(:not([type]), [type=\"button\"], [type=\"radio\"], [type=\"checkbox\"])[checked]) [part=\"icon\"] {\r\n                background-color: var(--theme-activated-item-color, ${DEFAULT_THEME_ACTIVATED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host(:is(:not([type]), [type=\"button\"], [type=\"radio\"], [type=\"checkbox\"])) [part=\"icon\"]::before {\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                content: \"\";\r\n                mask-size: 18px 18px;\r\n                -webkit-mask-size: 18px 18px;\r\n\r\n                mask-image: none;\r\n                -webkit-mask-image: none;\r\n                background-color: none;\r\n            }\r\n            \r\n            [part=\"arrow\"] {\r\n                flex: none;\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                margin: 1px 4px 1px 1px;\r\n            }\r\n            \r\n            [part=\"arrow\"]::after {\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                margin: 1px;\r\n                content: \"\";\r\n                mask-size: 18px 18px;\r\n                -webkit-mask-size: 18px 18px;\r\n\r\n                mask-image: none;\r\n                -webkit-mask-image: none;\r\n                background-color: none;\r\n            }\r\n\r\n            :host(:hover):host-context(e-menubar:focus),\r\n            :host(:hover):host-context(e-menubar:not(:focus-within)) {\r\n                background-color: var(--theme-hovered-item-color, ${DEFAULT_THEME_HOVERED_ITEM_COLOR});\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-menu[slot=menu]\" })\r\n], HTMLEMenuItemElementBase.prototype, \"menu\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuItemElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"label\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuItemElementBase.prototype, \"value\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuItemElementBase.prototype, \"hotkey\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean, observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"disabled\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean, observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"checked\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean, observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"expanded\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuItemElementBase.prototype, \"overflown\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, defaultValue: \"button\", observed: true })\r\n], HTMLEMenuItemElementBase.prototype, \"type\", void 0);\r\nHTMLEMenuItemElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-menuitem\"\r\n    })\r\n], HTMLEMenuItemElementBase);\r\nvar HTMLEMenuItemElement = HTMLEMenuItemElementBase;\r\nvar EMenuItem = Object.assign(function (init) {\r\n    const { label, name, type, value, trigger, menu } = init;\r\n    if (menu) {\r\n        menu.slot = \"menu\";\r\n    }\r\n    return element(\"e-menuitem\", {\r\n        attributes: {\r\n            tabindex: -1,\r\n            title: label,\r\n            name: name,\r\n            value: value,\r\n            type: type\r\n        },\r\n        children: menu ? [\r\n            label,\r\n            menu\r\n        ] : [\r\n            label\r\n        ],\r\n        listeners: {\r\n            click: trigger\r\n        }\r\n    });\r\n}, {\r\n    prototype: HTMLEMenuItemElement.prototype,\r\n    button(init) {\r\n        return new EMenuItem(Object.assign(Object.assign({}, init), { type: \"button\" }));\r\n    },\r\n    checkbox(init) {\r\n        return new EMenuItem(Object.assign(Object.assign({}, init), { type: \"checkbox\" }));\r\n    },\r\n    radio(init) {\r\n        return new EMenuItem(Object.assign(Object.assign({}, init), { type: \"radio\" }));\r\n    },\r\n    menu(init) {\r\n        return new EMenuItem(Object.assign(Object.assign({}, init), { type: \"menu\" }));\r\n    },\r\n    submenu(init) {\r\n        return new EMenuItem(Object.assign(Object.assign({}, init), { type: \"submenu\" }));\r\n    }\r\n});\r\n//# sourceMappingURL=MenuItem.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { element, CustomElement, AttributeProperty } from \"../../Element\";\r\nimport { EMenuItem } from \"./MenuItem\";\r\nimport \"./MenuItem\";\r\nexport { HTMLEMenuItemGroupElement };\r\nexport { EMenuItemGroup };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEMenuItemGroupElementBase = class HTMLEMenuItemGroupElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        const internals = this.attachInternals();\r\n        internals.role = \"group\";\r\n        this.internals = internals;\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        const { internals } = this;\r\n        switch (name) {\r\n            case \"label\":\r\n                internals.ariaLabel = newValue;\r\n                break;\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"span\", {\r\n        attributes: {\r\n            part: \"label\"\r\n        }\r\n    }), element(\"slot\"));\r\n    style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                flex-direction: column;\r\n            }\r\n            \r\n            [part=\"label\"] {\r\n                font-weight: bold;\r\n            }\r\n            \r\n            :host([label]) [part=\"label\"] {\r\n                padding-bottom: 6px;\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuItemGroupElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEMenuItemGroupElementBase.prototype, \"label\", void 0);\r\nHTMLEMenuItemGroupElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-menuitemgroup\"\r\n    })\r\n], HTMLEMenuItemGroupElementBase);\r\nvar HTMLEMenuItemGroupElement = HTMLEMenuItemGroupElementBase;\r\nvar EMenuItemGroup = Object.assign(function (init) {\r\n    const { name, items } = init;\r\n    return element(\"e-menuitemgroup\", {\r\n        attributes: {\r\n            name: name\r\n        },\r\n        children: items\r\n    });\r\n}, {\r\n    prototype: HTMLEMenuItemGroupElement.prototype,\r\n    radios: (init) => {\r\n        const { name, items } = init;\r\n        return element(\"e-menuitemgroup\", {\r\n            attributes: {\r\n                name: name\r\n            },\r\n            children: items.map(({ label, value }) => new EMenuItem({ name, label, type: \"radio\", value }))\r\n        });\r\n    }\r\n});\r\n//# sourceMappingURL=MenuItemGroup.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLEMenuElementBase_instances, _HTMLEMenuElementBase_walker, _HTMLEMenuElementBase_activeIndex, _HTMLEMenuElementBase_collapseSubmenus, _HTMLEMenuElementBase_nearestItem, _HTMLEMenuElementBase_walkerNodeFilter, _HTMLEMenuElementBase_lastItem, _HTMLEMenuElementBase_previousItem, _HTMLEMenuElementBase_nextItem, _HTMLEMenuElementBase_firstChildItem, _HTMLEMenuElementBase_setActiveItem, _HTMLEMenuElementBase_handleClickEvent, _HTMLEMenuElementBase_handleFocusInEvent, _HTMLEMenuElementBase_handleFocusOutEvent, _HTMLEMenuElementBase_handleKeyDownEvent, _HTMLEMenuElementBase_handleMouseOutEvent, _HTMLEMenuElementBase_handleMouseOverEvent;\r\nvar HTMLEMenuElementBase_1;\r\nimport { CustomElement, AttributeProperty, element } from \"../../Element\";\r\nimport { HTMLEMenuItemElement } from \"./MenuItem\";\r\nimport { HTMLEMenuItemGroupElement } from \"./MenuItemGroup\";\r\nimport \"./MenuItem\";\r\nimport \"./MenuItemGroup\";\r\nexport { HTMLEMenuElement };\r\nexport { EMenu };\r\nvar shadowTemplate;\r\nvar style;\r\nvar toggleAnimations;\r\nvar HIDE_DELAY_MS = 200;\r\nvar SHOW_DELAY_MS = 400;\r\nlet HTMLEMenuElementBase = HTMLEMenuElementBase_1 = class HTMLEMenuElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLEMenuElementBase_instances.add(this);\r\n        _HTMLEMenuElementBase_walker.set(this, void 0);\r\n        _HTMLEMenuElementBase_activeIndex.set(this, void 0);\r\n        __classPrivateFieldSet(this, _HTMLEMenuElementBase_activeIndex, -1, \"f\");\r\n        __classPrivateFieldSet(this, _HTMLEMenuElementBase_walker, document.createTreeWalker(this, NodeFilter.SHOW_ELEMENT, __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_walkerNodeFilter).bind(this)), \"f\");\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"click\", __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_handleClickEvent).bind(this));\r\n        this.addEventListener(\"mouseover\", __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_handleMouseOverEvent).bind(this));\r\n        this.addEventListener(\"mouseout\", __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_handleMouseOutEvent).bind(this));\r\n        this.addEventListener(\"focusin\", __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_handleFocusInEvent).bind(this));\r\n        this.addEventListener(\"focusout\", __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_handleFocusOutEvent).bind(this));\r\n        this.addEventListener(\"keydown\", __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_handleKeyDownEvent).bind(this));\r\n    }\r\n    items() {\r\n        return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem\"));\r\n    }\r\n    get activeIndex() {\r\n        return __classPrivateFieldGet(this, _HTMLEMenuElementBase_activeIndex, \"f\");\r\n    }\r\n    get activeItem() {\r\n        var _a, _b;\r\n        const { activeIndex } = this;\r\n        return ((_a = this.querySelector(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem:focus-within\")) !== null && _a !== void 0 ? _a : activeIndex > -1) ? (_b = this.items()[activeIndex]) !== null && _b !== void 0 ? _b : null : null;\r\n    }\r\n    connectedCallback() {\r\n        const tabindex = this.getAttribute(\"tabindex\");\r\n        this.tabIndex = tabindex !== null ? parseInt(tabindex) : -1;\r\n    }\r\n    positionContextual(x, y) {\r\n        const { style } = this;\r\n        const { width: menuWidth, height: menuHeight } = this.getBoundingClientRect();\r\n        const { scrollX, scrollY } = window;\r\n        const left = x + scrollX;\r\n        const top = y + scrollY;\r\n        const { clientWidth, clientHeight } = document.body;\r\n        const overflowX = left + menuWidth - clientWidth;\r\n        const overflowY = top + menuHeight - clientHeight;\r\n        style.setProperty(\"left\", `${overflowX > 0 ? left - menuWidth : left}px`);\r\n        style.setProperty(\"top\", `${overflowY > 0 ? top - menuHeight : top}px`);\r\n    }\r\n    firstItem() {\r\n        const walker = __classPrivateFieldGet(this, _HTMLEMenuElementBase_walker, \"f\");\r\n        walker.currentNode = walker.root;\r\n        return walker.firstChild();\r\n    }\r\n};\r\n_HTMLEMenuElementBase_walker = new WeakMap(), _HTMLEMenuElementBase_activeIndex = new WeakMap(), _HTMLEMenuElementBase_instances = new WeakSet(), _HTMLEMenuElementBase_collapseSubmenus = function _HTMLEMenuElementBase_collapseSubmenus() {\r\n    this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem[expanded]\")\r\n        .forEach((item_i) => {\r\n        item_i.collapse();\r\n    });\r\n}, _HTMLEMenuElementBase_nearestItem = function _HTMLEMenuElementBase_nearestItem(target) {\r\n    var _a;\r\n    return (_a = Array.from(this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem\")).find(item_i => item_i.contains(target))) !== null && _a !== void 0 ? _a : null;\r\n}, _HTMLEMenuElementBase_walkerNodeFilter = function _HTMLEMenuElementBase_walkerNodeFilter(node) {\r\n    if (node instanceof HTMLEMenuItemElement) {\r\n        return NodeFilter.FILTER_ACCEPT;\r\n    }\r\n    if (node instanceof HTMLEMenuItemGroupElement) {\r\n        return NodeFilter.FILTER_SKIP;\r\n    }\r\n    return NodeFilter.FILTER_REJECT;\r\n}, _HTMLEMenuElementBase_lastItem = function _HTMLEMenuElementBase_lastItem() {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEMenuElementBase_walker, \"f\");\r\n    walker.currentNode = walker.root;\r\n    return walker.lastChild();\r\n}, _HTMLEMenuElementBase_previousItem = function _HTMLEMenuElementBase_previousItem(item) {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEMenuElementBase_walker, \"f\");\r\n    walker.currentNode = item;\r\n    return walker.previousNode();\r\n}, _HTMLEMenuElementBase_nextItem = function _HTMLEMenuElementBase_nextItem(item) {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEMenuElementBase_walker, \"f\");\r\n    walker.currentNode = item;\r\n    return walker.nextNode();\r\n}, _HTMLEMenuElementBase_firstChildItem = function _HTMLEMenuElementBase_firstChildItem(item) {\r\n    const { menu } = item;\r\n    return menu instanceof HTMLEMenuElementBase_1 ?\r\n        menu.firstItem() :\r\n        null;\r\n}, _HTMLEMenuElementBase_setActiveItem = function _HTMLEMenuElementBase_setActiveItem(item) {\r\n    if (item !== null) {\r\n        __classPrivateFieldSet(this, _HTMLEMenuElementBase_activeIndex, this.items().indexOf(item), \"f\");\r\n    }\r\n}, _HTMLEMenuElementBase_handleClickEvent = function _HTMLEMenuElementBase_handleClickEvent(event) {\r\n    const { target } = event;\r\n    const targetItem = target.closest(\"e-menuitem\");\r\n    if (targetItem) {\r\n        const { type, checked } = targetItem;\r\n        switch (type) {\r\n            case \"checkbox\": {\r\n                targetItem.checked = !checked;\r\n                break;\r\n            }\r\n            case \"radio\": {\r\n                const { name, value } = targetItem;\r\n                targetItem.checked = true;\r\n                this.querySelectorAll(`:is(:scope, :scope > e-menuitemgroup) > e-menuitem[type=radio][name=${name}]`)\r\n                    .forEach((radio_i) => {\r\n                    radio_i.checked = radio_i.value == value;\r\n                });\r\n                break;\r\n            }\r\n            case \"menu\":\r\n            case \"submenu\": {\r\n                targetItem.toggle();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    event.stopPropagation();\r\n}, _HTMLEMenuElementBase_handleFocusInEvent = function _HTMLEMenuElementBase_handleFocusInEvent(event) {\r\n    const { target } = event;\r\n    if (target instanceof HTMLEMenuItemElement) {\r\n        const nearestItem = __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_nearestItem).call(this, target);\r\n        if (nearestItem) {\r\n            __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_setActiveItem).call(this, nearestItem);\r\n        }\r\n    }\r\n}, _HTMLEMenuElementBase_handleFocusOutEvent = function _HTMLEMenuElementBase_handleFocusOutEvent(event) {\r\n    const { relatedTarget } = event;\r\n    const lostFocusWithin = !this.contains(relatedTarget);\r\n    if (lostFocusWithin) {\r\n        const { contextual } = this;\r\n        if (contextual) {\r\n            try {\r\n                this.remove();\r\n            }\r\n            catch (error) { }\r\n            ;\r\n        }\r\n        else {\r\n            const { activeItem } = this;\r\n            if (activeItem === null || activeItem === void 0 ? void 0 : activeItem.expanded) {\r\n                activeItem.collapse();\r\n            }\r\n            __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_setActiveItem).call(this, null);\r\n        }\r\n    }\r\n}, _HTMLEMenuElementBase_handleKeyDownEvent = function _HTMLEMenuElementBase_handleKeyDownEvent(event) {\r\n    var _a, _b;\r\n    const { key } = event;\r\n    const { activeItem } = this;\r\n    switch (key) {\r\n        case \"ArrowUp\": {\r\n            const previousItem = activeItem ?\r\n                (_a = __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_previousItem).call(this, activeItem)) !== null && _a !== void 0 ? _a : __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_lastItem).call(this) :\r\n                this.firstItem();\r\n            previousItem === null || previousItem === void 0 ? void 0 : previousItem.focus({ preventScroll: true });\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n        case \"ArrowDown\": {\r\n            const nextItem = activeItem ?\r\n                (_b = __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_nextItem).call(this, activeItem)) !== null && _b !== void 0 ? _b : this.firstItem() :\r\n                this.firstItem();\r\n            nextItem === null || nextItem === void 0 ? void 0 : nextItem.focus({ preventScroll: true });\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n        case \"Home\": {\r\n            const firstItem = this.firstItem();\r\n            firstItem === null || firstItem === void 0 ? void 0 : firstItem.focus({ preventScroll: true });\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n        case \"End\": {\r\n            const lastItem = __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_lastItem).call(this);\r\n            lastItem === null || lastItem === void 0 ? void 0 : lastItem.focus({ preventScroll: true });\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n        case \"Enter\":\r\n        case \" \": {\r\n            if (activeItem) {\r\n                const { type } = activeItem;\r\n                switch (type) {\r\n                    case \"menu\":\r\n                    case \"submenu\": {\r\n                        activeItem.expand();\r\n                        if (activeItem.expanded) {\r\n                            const firstChildItem = __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_firstChildItem).call(this, activeItem);\r\n                            firstChildItem === null || firstChildItem === void 0 ? void 0 : firstChildItem.focus({ preventScroll: true });\r\n                        }\r\n                        break;\r\n                    }\r\n                    default: {\r\n                        activeItem.click();\r\n                        break;\r\n                    }\r\n                }\r\n                event.stopPropagation();\r\n            }\r\n            break;\r\n        }\r\n        case \"Escape\": {\r\n            if (activeItem) {\r\n                const isClosestTargetMenu = event.composedPath().find(target_i => target_i instanceof HTMLEMenuElement) == this;\r\n                if (!isClosestTargetMenu) {\r\n                    activeItem.collapse();\r\n                    activeItem.focus({ preventScroll: true });\r\n                    event.stopPropagation();\r\n                }\r\n                else {\r\n                    const { contextual } = this;\r\n                    if (contextual) {\r\n                        this.blur();\r\n                        this.dispatchEvent(new Event(\"close\", { bubbles: true }));\r\n                        event.stopPropagation();\r\n                    }\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case \"ArrowLeft\": {\r\n            if (activeItem) {\r\n                const isClosestTargetMenu = event.composedPath().find(target_i => target_i instanceof HTMLEMenuElement) == this;\r\n                if (!isClosestTargetMenu) {\r\n                    activeItem.collapse();\r\n                    activeItem.focus({ preventScroll: true });\r\n                    event.stopPropagation();\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case \"ArrowRight\": {\r\n            if (activeItem) {\r\n                const { type } = activeItem;\r\n                switch (type) {\r\n                    case \"submenu\": {\r\n                        if (!activeItem.expanded) {\r\n                            activeItem.expand();\r\n                            const firstChildItem = __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_firstChildItem).call(this, activeItem);\r\n                            firstChildItem === null || firstChildItem === void 0 ? void 0 : firstChildItem.focus({ preventScroll: true });\r\n                            event.stopPropagation();\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            break;\r\n        }\r\n    }\r\n}, _HTMLEMenuElementBase_handleMouseOutEvent = function _HTMLEMenuElementBase_handleMouseOutEvent(event) {\r\n    var _a;\r\n    const { target, relatedTarget } = event;\r\n    if (target instanceof HTMLEMenuItemElement) {\r\n        const nearestItem = __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_nearestItem).call(this, target);\r\n        if (nearestItem !== null) {\r\n            if (nearestItem.type == \"submenu\" &&\r\n                !nearestItem.expanded) {\r\n                (_a = toggleAnimations.get(nearestItem)) === null || _a === void 0 ? void 0 : _a.cancel();\r\n            }\r\n            const isTargetClosestMenu = event.composedPath().find(target_i => target_i instanceof HTMLEMenuElement) == this;\r\n            if (isTargetClosestMenu) {\r\n                const { activeItem } = this;\r\n                if ((activeItem === null || activeItem === void 0 ? void 0 : activeItem.type) == \"submenu\" &&\r\n                    activeItem.expanded) {\r\n                    let toggleAnimation = toggleAnimations.get(activeItem);\r\n                    if (toggleAnimation) {\r\n                        toggleAnimation.cancel();\r\n                    }\r\n                    toggleAnimation = activeItem.animate(null, {\r\n                        duration: HIDE_DELAY_MS\r\n                    });\r\n                    toggleAnimations.set(activeItem, toggleAnimation);\r\n                    const { finished } = toggleAnimation;\r\n                    finished\r\n                        .then(() => {\r\n                        activeItem.collapse();\r\n                    })\r\n                        .catch(() => undefined)\r\n                        .finally(() => {\r\n                        toggleAnimations.delete(activeItem);\r\n                    });\r\n                }\r\n                const { left, right, top, bottom } = (() => {\r\n                    const parentItem = this.closest(\"e-menuitem\");\r\n                    if (parentItem && !parentItem.expanded) {\r\n                        parentItem.expand();\r\n                        const menuRect = this.getBoundingClientRect();\r\n                        parentItem.collapse();\r\n                        return menuRect;\r\n                    }\r\n                    else {\r\n                        return this.getBoundingClientRect();\r\n                    }\r\n                })();\r\n                const { clientX, clientY } = event;\r\n                const intersectsWithMouse = !(left > clientX || right < clientX || top > clientY || bottom < clientY);\r\n                const containsRelatedTarget = this.contains(relatedTarget);\r\n                if (intersectsWithMouse && containsRelatedTarget) {\r\n                    if (relatedTarget instanceof HTMLEMenuElement && relatedTarget !== this) {\r\n                        relatedTarget.focus({ preventScroll: true });\r\n                    }\r\n                    else {\r\n                        this.focus({ preventScroll: true });\r\n                        __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_setActiveItem).call(this, null);\r\n                    }\r\n                }\r\n                if (!intersectsWithMouse) {\r\n                    this.focus({ preventScroll: true });\r\n                    __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_setActiveItem).call(this, null);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}, _HTMLEMenuElementBase_handleMouseOverEvent = function _HTMLEMenuElementBase_handleMouseOverEvent(event) {\r\n    var _a, _b;\r\n    const { target } = event;\r\n    if (target instanceof HTMLEMenuItemElement) {\r\n        const nearestItem = __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_nearestItem).call(this, target);\r\n        if (nearestItem !== null) {\r\n            if (nearestItem.type === \"submenu\" && nearestItem.expanded) {\r\n                (_a = toggleAnimations.get(nearestItem)) === null || _a === void 0 ? void 0 : _a.cancel();\r\n            }\r\n            const isTargetClosestMenu = event.composedPath().find(target_i => target_i instanceof HTMLEMenuElement) == this;\r\n            if (isTargetClosestMenu) {\r\n                const { activeItem } = this;\r\n                if ((activeItem === null || activeItem === void 0 ? void 0 : activeItem.type) === \"submenu\" &&\r\n                    activeItem.expanded &&\r\n                    !activeItem.contains(target)) {\r\n                    let toggleAnimation = toggleAnimations.get(activeItem);\r\n                    if (toggleAnimation) {\r\n                        toggleAnimation.cancel();\r\n                    }\r\n                    toggleAnimation = activeItem.animate(null, {\r\n                        duration: SHOW_DELAY_MS\r\n                    });\r\n                    toggleAnimations.set(activeItem, toggleAnimation);\r\n                    const { finished } = toggleAnimation;\r\n                    finished\r\n                        .then(() => {\r\n                        activeItem.collapse();\r\n                    })\r\n                        .catch(() => undefined)\r\n                        .finally(() => {\r\n                        toggleAnimations.delete(activeItem);\r\n                    });\r\n                }\r\n                __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_setActiveItem).call(this, nearestItem);\r\n                nearestItem.focus({ preventScroll: true });\r\n                if (nearestItem.type === \"submenu\") {\r\n                    if (!nearestItem.expanded) {\r\n                        let toggleAnimation = toggleAnimations.get(nearestItem);\r\n                        if (toggleAnimation) {\r\n                            toggleAnimation.cancel();\r\n                        }\r\n                        toggleAnimation = nearestItem.animate(null, {\r\n                            duration: HIDE_DELAY_MS\r\n                        });\r\n                        toggleAnimations.set(nearestItem, toggleAnimation);\r\n                        const { finished } = toggleAnimation;\r\n                        finished\r\n                            .then(() => {\r\n                            var _a, _b;\r\n                            const { activeItem } = this;\r\n                            __classPrivateFieldGet(this, _HTMLEMenuElementBase_instances, \"m\", _HTMLEMenuElementBase_collapseSubmenus).call(this);\r\n                            if (activeItem) {\r\n                                (_a = toggleAnimations.get(activeItem)) === null || _a === void 0 ? void 0 : _a.cancel();\r\n                                activeItem.expand();\r\n                                (_b = activeItem.menu) === null || _b === void 0 ? void 0 : _b.focus({ preventScroll: true });\r\n                            }\r\n                        })\r\n                            .catch(() => undefined)\r\n                            .finally(() => {\r\n                            toggleAnimations.delete(nearestItem);\r\n                        });\r\n                    }\r\n                    else {\r\n                        (_b = nearestItem.menu) === null || _b === void 0 ? void 0 : _b.focus({ preventScroll: true });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"slot\"));\r\n    style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                flex-direction: column;\r\n            \r\n                padding: 3px;\r\n                background-color: white;\r\n                width: max-content;\r\n                box-sizing: border-box;\r\n            \r\n                -webkit-box-shadow: rgba(0, 0, 0, 0.2) 0 1px 3px;\r\n                box-shadow: rgba(0, 0, 0, 0.2) 0 1px 3px;\r\n            }\r\n            \r\n            :host([contextual]) {\r\n                z-index: 1;\r\n                position: absolute;\r\n            }\r\n        `;\r\n    toggleAnimations = new WeakMap();\r\n})();\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuElementBase.prototype, \"contextual\", void 0);\r\nHTMLEMenuElementBase = HTMLEMenuElementBase_1 = __decorate([\r\n    CustomElement({\r\n        name: \"e-menu\"\r\n    })\r\n], HTMLEMenuElementBase);\r\nvar HTMLEMenuElement = HTMLEMenuElementBase;\r\nvar EMenu = Object.assign(function (init) {\r\n    const { name, children } = init;\r\n    return element(\"e-menu\", {\r\n        attributes: {\r\n            name: name,\r\n            tabindex: -1,\r\n        },\r\n        children: children\r\n    });\r\n}, {\r\n    prototype: HTMLEMenuElement.prototype,\r\n});\r\n//# sourceMappingURL=Menu.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n};\r\nvar _HTMLEMenuBarElementBase_instances, _HTMLEMenuBarElementBase_activeIndex, _HTMLEMenuBarElementBase_walker, _HTMLEMenuBarElementBase_walkerNodeFilter, _HTMLEMenuBarElementBase_lastItem, _HTMLEMenuBarElementBase_previousItem, _HTMLEMenuBarElementBase_nextItem, _HTMLEMenuBarElementBase_firstChildItem, _HTMLEMenuBarElementBase_setActiveItem, _HTMLEMenuBarElementBase_items_get, _HTMLEMenuBarElementBase_isClosestMenu, _HTMLEMenuBarElementBase_nearestItem, _HTMLEMenuBarElementBase_handleFocusEvent, _HTMLEMenuBarElementBase_handleFocusInEvent, _HTMLEMenuBarElementBase_handleFocusOutEvent, _HTMLEMenuBarElementBase_handleMouseOverEvent, _HTMLEMenuBarElementBase_handleClickEvent, _HTMLEMenuBarElementBase_handleKeyDownEvent;\r\nimport { DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR } from \"../../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, element } from \"../../Element\";\r\nimport { HTMLEMenuItemElement } from \"./MenuItem\";\r\nimport { HTMLEMenuItemGroupElement } from \"./MenuItemGroup\";\r\nimport \"./Menu\";\r\nimport \"./MenuItem\";\r\nimport \"./MenuItemGroup\";\r\nexport { HTMLEMenuBarElement };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEMenuBarElementBase = class HTMLEMenuBarElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLEMenuBarElementBase_instances.add(this);\r\n        _HTMLEMenuBarElementBase_activeIndex.set(this, void 0);\r\n        _HTMLEMenuBarElementBase_walker.set(this, void 0);\r\n        __classPrivateFieldSet(this, _HTMLEMenuBarElementBase_walker, document.createTreeWalker(this, NodeFilter.SHOW_ELEMENT, __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_walkerNodeFilter).bind(this)), \"f\");\r\n        __classPrivateFieldSet(this, _HTMLEMenuBarElementBase_activeIndex, -1, \"f\");\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"click\", __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_handleClickEvent).bind(this));\r\n        this.addEventListener(\"focus\", __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_handleFocusEvent).bind(this));\r\n        this.addEventListener(\"focusin\", __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_handleFocusInEvent).bind(this));\r\n        this.addEventListener(\"focusout\", __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_handleFocusOutEvent).bind(this));\r\n        this.addEventListener(\"mouseover\", __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_handleMouseOverEvent).bind(this));\r\n        this.addEventListener(\"keydown\", __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_handleKeyDownEvent).bind(this));\r\n    }\r\n    connectedCallback() {\r\n        const tabindex = this.getAttribute(\"tabindex\");\r\n        this.tabIndex = tabindex !== null ? parseInt(tabindex) : -1;\r\n    }\r\n    items() {\r\n        return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem\"));\r\n    }\r\n    get activeIndex() {\r\n        return __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_activeIndex, \"f\");\r\n    }\r\n    get activeItem() {\r\n        var _a, _b;\r\n        const { activeIndex } = this;\r\n        return ((_a = this.querySelector(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem:focus-within\")) !== null && _a !== void 0 ? _a : activeIndex > -1) ? (_b = this.items()[activeIndex]) !== null && _b !== void 0 ? _b : null : null;\r\n    }\r\n    firstItem() {\r\n        const walker = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_walker, \"f\");\r\n        walker.currentNode = walker.root;\r\n        return walker.firstChild();\r\n    }\r\n};\r\n_HTMLEMenuBarElementBase_activeIndex = new WeakMap(), _HTMLEMenuBarElementBase_walker = new WeakMap(), _HTMLEMenuBarElementBase_instances = new WeakSet(), _HTMLEMenuBarElementBase_walkerNodeFilter = function _HTMLEMenuBarElementBase_walkerNodeFilter(node) {\r\n    if (node instanceof HTMLEMenuItemElement && !(node.disabled || node.hidden)) {\r\n        return NodeFilter.FILTER_ACCEPT;\r\n    }\r\n    if (node instanceof HTMLEMenuItemGroupElement) {\r\n        return NodeFilter.FILTER_SKIP;\r\n    }\r\n    return NodeFilter.FILTER_REJECT;\r\n}, _HTMLEMenuBarElementBase_lastItem = function _HTMLEMenuBarElementBase_lastItem() {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_walker, \"f\");\r\n    walker.currentNode = walker.root;\r\n    return walker.lastChild();\r\n}, _HTMLEMenuBarElementBase_previousItem = function _HTMLEMenuBarElementBase_previousItem(item) {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_walker, \"f\");\r\n    walker.currentNode = item;\r\n    return walker.previousSibling();\r\n}, _HTMLEMenuBarElementBase_nextItem = function _HTMLEMenuBarElementBase_nextItem(item) {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_walker, \"f\");\r\n    walker.currentNode = item;\r\n    return walker.nextSibling();\r\n}, _HTMLEMenuBarElementBase_firstChildItem = function _HTMLEMenuBarElementBase_firstChildItem(item) {\r\n    const { menu } = item;\r\n    if (menu) {\r\n        const walker = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_walker, \"f\");\r\n        walker.currentNode = menu;\r\n        return walker.firstChild();\r\n    }\r\n    return null;\r\n}, _HTMLEMenuBarElementBase_setActiveItem = function _HTMLEMenuBarElementBase_setActiveItem(item) {\r\n    const { activeItem, expanded } = this;\r\n    if (activeItem !== null && activeItem !== item) {\r\n        activeItem.collapse();\r\n    }\r\n    if (item !== null) {\r\n        if (expanded) {\r\n            item.expand();\r\n        }\r\n        __classPrivateFieldSet(this, _HTMLEMenuBarElementBase_activeIndex, this.items().indexOf(item), \"f\");\r\n    }\r\n    else {\r\n        __classPrivateFieldSet(this, _HTMLEMenuBarElementBase_activeIndex, -1, \"f\");\r\n    }\r\n}, _HTMLEMenuBarElementBase_items_get = function _HTMLEMenuBarElementBase_items_get() {\r\n    return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-menuitemgroup) > e-menuitem\"));\r\n}, _HTMLEMenuBarElementBase_isClosestMenu = function _HTMLEMenuBarElementBase_isClosestMenu(target) {\r\n    return target.closest(\":is(e-menubar, e-menu)\") == this;\r\n}, _HTMLEMenuBarElementBase_nearestItem = function _HTMLEMenuBarElementBase_nearestItem(target) {\r\n    var _a;\r\n    return (_a = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"a\", _HTMLEMenuBarElementBase_items_get).find(item_i => item_i.contains(target))) !== null && _a !== void 0 ? _a : null;\r\n}, _HTMLEMenuBarElementBase_handleFocusEvent = function _HTMLEMenuBarElementBase_handleFocusEvent(event) {\r\n    var _a;\r\n    const { relatedTarget } = event;\r\n    const { activeItem } = this;\r\n    if (!this.contains(relatedTarget)) {\r\n        (_a = (activeItem !== null && activeItem !== void 0 ? activeItem : this.firstItem())) === null || _a === void 0 ? void 0 : _a.focus();\r\n    }\r\n}, _HTMLEMenuBarElementBase_handleFocusInEvent = function _HTMLEMenuBarElementBase_handleFocusInEvent(event) {\r\n    const { target } = event;\r\n    if (target instanceof Element) {\r\n        const nearestItem = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_nearestItem).call(this, target);\r\n        __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_setActiveItem).call(this, nearestItem);\r\n        this.tabIndex = -1;\r\n    }\r\n}, _HTMLEMenuBarElementBase_handleFocusOutEvent = function _HTMLEMenuBarElementBase_handleFocusOutEvent(event) {\r\n    const { target, relatedTarget } = event;\r\n    if (target instanceof HTMLElement) {\r\n        const nearestItem = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_nearestItem).call(this, target);\r\n        if (nearestItem) {\r\n            nearestItem.collapse();\r\n        }\r\n    }\r\n    const lostFocusWithin = !this.contains(relatedTarget);\r\n    if (lostFocusWithin) {\r\n        this.expanded = false;\r\n        this.tabIndex = 0;\r\n    }\r\n}, _HTMLEMenuBarElementBase_handleMouseOverEvent = function _HTMLEMenuBarElementBase_handleMouseOverEvent(event) {\r\n    const { target } = event;\r\n    const { expanded, activeItem } = this;\r\n    if (target instanceof HTMLEMenuItemElement) {\r\n        const isClosestMenu = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_isClosestMenu).call(this, target);\r\n        if (isClosestMenu && target !== activeItem && expanded) {\r\n            const { menu } = target;\r\n            if (menu) {\r\n                target.expand();\r\n                menu.focus({ preventScroll: true });\r\n            }\r\n        }\r\n    }\r\n}, _HTMLEMenuBarElementBase_handleClickEvent = function _HTMLEMenuBarElementBase_handleClickEvent(event) {\r\n    const { target } = event;\r\n    const { expanded, activeItem } = this;\r\n    if (target instanceof HTMLEMenuItemElement) {\r\n        const isClosestMenu = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_isClosestMenu).call(this, target);\r\n        if (isClosestMenu) {\r\n            const isExpanded = !expanded;\r\n            this.expanded = isExpanded;\r\n            if (isExpanded) {\r\n                if (activeItem && !activeItem.expanded) {\r\n                    activeItem.expand();\r\n                }\r\n                const { menu } = target;\r\n                menu === null || menu === void 0 ? void 0 : menu.focus({ preventScroll: true });\r\n            }\r\n            else {\r\n                if (activeItem) {\r\n                    activeItem.collapse();\r\n                    activeItem.blur();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}, _HTMLEMenuBarElementBase_handleKeyDownEvent = function _HTMLEMenuBarElementBase_handleKeyDownEvent(event) {\r\n    var _a, _b;\r\n    const { key } = event;\r\n    const { expanded } = this;\r\n    let { activeItem } = this;\r\n    switch (key) {\r\n        case \"ArrowLeft\": {\r\n            const previousItem = activeItem ?\r\n                (_a = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_previousItem).call(this, activeItem)) !== null && _a !== void 0 ? _a : __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_lastItem).call(this) :\r\n                this.firstItem();\r\n            previousItem === null || previousItem === void 0 ? void 0 : previousItem.focus({ preventScroll: true });\r\n            ({ activeItem } = this);\r\n            if (expanded && activeItem) {\r\n                const firstChildItem = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_firstChildItem).call(this, activeItem);\r\n                firstChildItem === null || firstChildItem === void 0 ? void 0 : firstChildItem.focus({ preventScroll: true });\r\n            }\r\n            break;\r\n        }\r\n        case \"ArrowRight\": {\r\n            const nextItem = activeItem ?\r\n                (_b = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_nextItem).call(this, activeItem)) !== null && _b !== void 0 ? _b : this.firstItem() :\r\n                __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_lastItem).call(this);\r\n            nextItem === null || nextItem === void 0 ? void 0 : nextItem.focus({ preventScroll: true });\r\n            ({ activeItem } = this);\r\n            if (expanded && activeItem) {\r\n                const firstChildItem = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_firstChildItem).call(this, activeItem);\r\n                firstChildItem === null || firstChildItem === void 0 ? void 0 : firstChildItem.focus({ preventScroll: true });\r\n            }\r\n            break;\r\n        }\r\n        case \"Enter\":\r\n        case \" \": {\r\n            if (activeItem) {\r\n                this.expanded = !expanded;\r\n                if (!expanded) {\r\n                    const firstChildItem = __classPrivateFieldGet(this, _HTMLEMenuBarElementBase_instances, \"m\", _HTMLEMenuBarElementBase_firstChildItem).call(this, activeItem);\r\n                    firstChildItem === null || firstChildItem === void 0 ? void 0 : firstChildItem.focus({ preventScroll: true });\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case \"Escape\": {\r\n            if (expanded) {\r\n                this.expanded = false;\r\n                if (activeItem) {\r\n                    activeItem.collapse();\r\n                    activeItem.focus({ preventScroll: true });\r\n                }\r\n            }\r\n            else {\r\n                this.focus({ preventScroll: true });\r\n            }\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"slot\"));\r\n    style = /*css*/ `\r\n            :host {\r\n                position: relative;\r\n                display: flex;\r\n                flex-direction: row;\r\n                width: max-content;\r\n            }\r\n            \r\n            :host(:focus) {\r\n                outline: 1px solid var(--theme-focused-item-outline-color, ${DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR});\r\n                outline-offset: -1px;\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuBarElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuBarElementBase.prototype, \"expanded\", void 0);\r\nHTMLEMenuBarElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-menubar\"\r\n    })\r\n], HTMLEMenuBarElementBase);\r\nvar HTMLEMenuBarElement = HTMLEMenuBarElementBase;\r\n//# sourceMappingURL=MenuBar.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLEMenuButtonElementBase_instances, _HTMLEMenuButtonElementBase_positionMenu, _HTMLEMenuButtonElementBase_handleClickEvent, _HTMLEMenuButtonElementBase_handleFocusOutEvent, _HTMLEMenuButtonElementBase_handleKeyDownEvent;\r\nimport { DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR, DEFAULT_THEME_FOCUSED_ITEM_COLOR, DEFAULT_THEME_HOVERED_ITEM_COLOR } from \"../../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, element, QueryProperty } from \"../../Element\";\r\nimport \"./Menu\";\r\nimport \"./MenuItem\";\r\nimport \"./MenuItemGroup\";\r\nexport { HTMLEMenuButtonElement };\r\nexport { EMenuButton };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEMenuButtonElementBase = class HTMLEMenuButtonElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLEMenuButtonElementBase_instances.add(this);\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"keydown\", __classPrivateFieldGet(this, _HTMLEMenuButtonElementBase_instances, \"m\", _HTMLEMenuButtonElementBase_handleKeyDownEvent).bind(this));\r\n        this.addEventListener(\"click\", __classPrivateFieldGet(this, _HTMLEMenuButtonElementBase_instances, \"m\", _HTMLEMenuButtonElementBase_handleClickEvent).bind(this));\r\n        this.addEventListener(\"focusout\", __classPrivateFieldGet(this, _HTMLEMenuButtonElementBase_instances, \"m\", _HTMLEMenuButtonElementBase_handleFocusOutEvent).bind(this));\r\n    }\r\n    connectedCallback() {\r\n        const tabindex = this.getAttribute(\"tabindex\");\r\n        this.tabIndex = tabindex !== null ? parseInt(tabindex) : -1;\r\n    }\r\n    toggle(force) {\r\n        const { expanded } = this;\r\n        const expand = force !== null && force !== void 0 ? force : !expanded;\r\n        expand ? this.expand() : this.collapse();\r\n    }\r\n    expand() {\r\n        const { expanded } = this;\r\n        if (!expanded) {\r\n            this.expanded = true;\r\n            __classPrivateFieldGet(this, _HTMLEMenuButtonElementBase_instances, \"m\", _HTMLEMenuButtonElementBase_positionMenu).call(this);\r\n        }\r\n    }\r\n    collapse() {\r\n        const { expanded } = this;\r\n        if (expanded) {\r\n            this.expanded = false;\r\n        }\r\n    }\r\n};\r\n_HTMLEMenuButtonElementBase_instances = new WeakSet(), _HTMLEMenuButtonElementBase_positionMenu = function _HTMLEMenuButtonElementBase_positionMenu() {\r\n    const { menu } = this;\r\n    if (menu !== null) {\r\n        const { width, height } = this.getBoundingClientRect();\r\n        const { style: menuStyle } = menu;\r\n        const { width: menuWidth, height: menuHeight } = menu.getBoundingClientRect();\r\n        const { clientWidth, clientHeight } = document.body;\r\n        const { offsetLeft, offsetTop } = this;\r\n        const overflowX = offsetLeft + width + menuWidth - clientWidth;\r\n        const overflowY = offsetTop + menuHeight - clientHeight;\r\n        menuStyle.setProperty(\"left\", `${overflowX > 0 ?\r\n            width - menuWidth :\r\n            0}px`);\r\n        menuStyle.setProperty(\"top\", `${overflowY > 0 ?\r\n            -menuHeight :\r\n            height}px`);\r\n    }\r\n}, _HTMLEMenuButtonElementBase_handleClickEvent = function _HTMLEMenuButtonElementBase_handleClickEvent(event) {\r\n    const { target } = event;\r\n    const { menu } = this;\r\n    if (menu && !menu.contains(target)) {\r\n        this.toggle();\r\n        const { expanded } = this;\r\n        if (expanded) {\r\n            menu === null || menu === void 0 ? void 0 : menu.focus({ preventScroll: true });\r\n        }\r\n    }\r\n}, _HTMLEMenuButtonElementBase_handleFocusOutEvent = function _HTMLEMenuButtonElementBase_handleFocusOutEvent(event) {\r\n    const { relatedTarget } = event;\r\n    const lostFocusWithin = !this.contains(relatedTarget);\r\n    if (lostFocusWithin) {\r\n        this.collapse();\r\n    }\r\n}, _HTMLEMenuButtonElementBase_handleKeyDownEvent = function _HTMLEMenuButtonElementBase_handleKeyDownEvent(event) {\r\n    var _a;\r\n    const { key } = event;\r\n    const { expanded } = this;\r\n    switch (key) {\r\n        case \"ArrowDown\":\r\n        case \"Enter\":\r\n            if (!expanded) {\r\n                this.expand();\r\n                (_a = this.firstItem) === null || _a === void 0 ? void 0 : _a.focus({ preventScroll: true });\r\n                event.stopPropagation();\r\n            }\r\n            break;\r\n        case \"Escape\":\r\n            if (expanded) {\r\n                this.collapse();\r\n            }\r\n            this.focus({ preventScroll: true });\r\n            event.stopPropagation();\r\n            break;\r\n    }\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"slot\"), element(\"slot\", {\r\n        attributes: {\r\n            name: \"menu\"\r\n        }\r\n    }));\r\n    style = /*css*/ `\r\n            :host {\r\n                position: relative;\r\n                display: inline-block;\r\n                padding: 2px;\r\n                line-height: 18px;\r\n                user-select: none;\r\n                white-space: nowrap;\r\n                cursor: pointer;\r\n            }\r\n            \r\n            :host(:focus) {\r\n                outline: 1px solid var(--theme-focused-item-outline-color, ${DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR});\r\n                outline-offset: -1px;\r\n            }\r\n            \r\n            :host(:focus-within:not(:focus)) {\r\n                background-color: var(--theme-focused-item-color, ${DEFAULT_THEME_FOCUSED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host(:hover:not(:focus-within)) {\r\n                background-color: var(--theme-hovered-item-color, ${DEFAULT_THEME_HOVERED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host([disabled]) {\r\n                color: lightgray;\r\n            }\r\n            \r\n            ::slotted([slot=\"menu\"]) {\r\n                z-index: 1;\r\n                position: absolute;\r\n                color: initial;\r\n            }\r\n            \r\n            :host(:not([expanded])) ::slotted([slot=\"menu\"]) {\r\n                opacity: 0;\r\n                pointer-events: none;\r\n            }\r\n            \r\n            :host::after {\r\n                display: inline-block;\r\n                text-align: center;\r\n                width: 18px;\r\n                height: 18px;\r\n                content: \"▾\";\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-menu[slot=menu]\" })\r\n], HTMLEMenuButtonElementBase.prototype, \"menu\", void 0);\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-menu[slot=menu] e-menuitem\" })\r\n], HTMLEMenuButtonElementBase.prototype, \"firstItem\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEMenuButtonElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuButtonElementBase.prototype, \"disabled\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEMenuButtonElementBase.prototype, \"expanded\", void 0);\r\nHTMLEMenuButtonElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-menubutton\"\r\n    })\r\n], HTMLEMenuButtonElementBase);\r\nvar HTMLEMenuButtonElement = HTMLEMenuButtonElementBase;\r\nvar EMenuButton = Object.assign(function (init) {\r\n    const { menu } = init;\r\n    menu.slot = \"menu\";\r\n    return element(\"e-menubutton\", {\r\n        attributes: {\r\n            tabindex: -1\r\n        },\r\n        children: [menu]\r\n    });\r\n}, {\r\n    prototype: HTMLEMenuButtonElement.prototype,\r\n});\r\n//# sourceMappingURL=MenuButton.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLEToolBarItemElementBase_instances, _HTMLEToolBarItemElementBase_icon;\r\nimport { DEFAULT_THEME_ACTIVATED_ITEM_COLOR, DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR, DEFAULT_THEME_HOVERED_ITEM_COLOR } from \"../../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, element, QueryProperty } from \"../../Element\";\r\nexport { HTMLEToolBarItemElement };\r\nexport { EToolBarItem };\r\nvar shadowTemplate;\r\nvar style;\r\nvar iconPartTemplate;\r\nlet HTMLEToolBarItemElementBase = class HTMLEToolBarItemElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLEToolBarItemElementBase_instances.add(this);\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n    }\r\n    connectedCallback() {\r\n        const { tabIndex } = this;\r\n        this.tabIndex = tabIndex;\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"label\": {\r\n                //...\r\n                break;\r\n            }\r\n            case \"iconed\": {\r\n                const { shadowRoot } = this;\r\n                if (newValue !== null) {\r\n                    shadowRoot.prepend(iconPartTemplate.cloneNode(true));\r\n                }\r\n                else {\r\n                    const iconPart = __classPrivateFieldGet(this, _HTMLEToolBarItemElementBase_instances, \"m\", _HTMLEToolBarItemElementBase_icon).call(this);\r\n                    if (iconPart) {\r\n                        iconPart.remove();\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n_HTMLEToolBarItemElementBase_instances = new WeakSet(), _HTMLEToolBarItemElementBase_icon = function _HTMLEToolBarItemElementBase_icon() {\r\n    return this.shadowRoot.querySelector(\"[part=icon]\");\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"slot\"), element(\"slot\", {\r\n        attributes: {\r\n            name: \"select\"\r\n        }\r\n    }), element(\"slot\", {\r\n        attributes: {\r\n            name: \"menubutton\"\r\n        }\r\n    }));\r\n    iconPartTemplate = element(\"span\", {\r\n        attributes: {\r\n            part: \"icon\"\r\n        }\r\n    });\r\n    style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                user-select: none;\r\n                white-space: nowrap;\r\n                cursor: pointer;\r\n                line-height: 22px;\r\n            }\r\n            \r\n            :host([disabled]) {\r\n                opacity: 0.38;\r\n                pointer-events: none;\r\n            }\r\n            \r\n            :host(:hover) {\r\n                background-color: var(--theme-hovered-item-color, ${DEFAULT_THEME_HOVERED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host([pressed]),\r\n            :host(:active) {\r\n                background-color: var(--theme-activated-item-color, ${DEFAULT_THEME_ACTIVATED_ITEM_COLOR});\r\n            }\r\n            \r\n            :host(:not([iconed])) [part=\"icon\"] {\r\n                display: none;\r\n            }\r\n\r\n            [part=\"icon\"] {\r\n                flex: none;\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                padding: 2px;\r\n                overflow: hidden;\r\n            }\r\n            \r\n            [part=\"icon\"]::before {\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n                content: \"\";\r\n                mask-size: 18px 18px;\r\n                -webkit-mask-size: 18px 18px;\r\n                background-color: none;\r\n                -webkit-mask-image: none;\r\n                mask-image: none;\r\n                filter: none;\r\n            }\r\n            \r\n            :host(:focus) {\r\n                outline: 1px solid var(--theme-focused-item-outline-color, ${DEFAULT_THEME_FOCUSED_ITEM_OUTLINE_COLOR});\r\n                outline-offset: -1px;\r\n            }\r\n            \r\n            :host([type=\"select\"]:focus) ::slotted(e-select) {\r\n                border-color: transparent;\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-menubutton[slot=menubutton]\" })\r\n], HTMLEToolBarItemElementBase.prototype, \"menubutton\", void 0);\r\n__decorate([\r\n    QueryProperty({ selector: \":scope > e-select[slot=select]\" })\r\n], HTMLEToolBarItemElementBase.prototype, \"select\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEToolBarItemElementBase.prototype, \"active\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEToolBarItemElementBase.prototype, \"pressed\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEToolBarItemElementBase.prototype, \"expanded\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean, observed: true })\r\n], HTMLEToolBarItemElementBase.prototype, \"iconed\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEToolBarItemElementBase.prototype, \"value\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarItemElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEToolBarItemElementBase.prototype, \"label\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarItemElementBase.prototype, \"type\", void 0);\r\nHTMLEToolBarItemElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-toolbaritem\"\r\n    })\r\n], HTMLEToolBarItemElementBase);\r\nvar HTMLEToolBarItemElement = HTMLEToolBarItemElementBase;\r\nvar EToolBarItem = Object.assign(function (init) {\r\n    const { label, name, type, value, trigger, menubutton, select } = init;\r\n    if (menubutton) {\r\n        menubutton.slot = \"menubutton\";\r\n    }\r\n    if (select) {\r\n        select.slot = \"select\";\r\n    }\r\n    return element(\"e-toolbaritem\", {\r\n        attributes: {\r\n            tabindex: -1,\r\n            title: label,\r\n            name: name,\r\n            value: value,\r\n            type: type\r\n        },\r\n        children: menubutton ? [menubutton] : select ? [select] : undefined,\r\n        listeners: {\r\n            click: trigger\r\n        }\r\n    });\r\n}, {\r\n    prototype: HTMLEToolBarItemElement.prototype,\r\n    button(init) {\r\n        return new EToolBarItem(Object.assign(Object.assign({}, init), { type: \"button\" }));\r\n    },\r\n    checkbox(init) {\r\n        return new EToolBarItem(Object.assign(Object.assign({}, init), { type: \"checkbox\" }));\r\n    },\r\n    radio(init) {\r\n        return new EToolBarItem(Object.assign(Object.assign({}, init), { type: \"radio\" }));\r\n    },\r\n    menubutton(init) {\r\n        return new EToolBarItem(Object.assign(Object.assign({}, init), { type: \"menubutton\" }));\r\n    },\r\n    select(init) {\r\n        return new EToolBarItem(Object.assign(Object.assign({}, init), { type: \"select\" }));\r\n    },\r\n});\r\n//# sourceMappingURL=ToolBarItem.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { element, CustomElement, AttributeProperty } from \"../../Element\";\r\nimport \"./ToolBarItem\";\r\nexport { HTMLEToolBarItemGroupElement };\r\nvar shadowTemplate;\r\nvar style;\r\nlet HTMLEToolBarItemGroupElementBase = class HTMLEToolBarItemGroupElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"label\": {\r\n                const label = this.shadowRoot.querySelector(\"[part='label']\");\r\n                if (label) {\r\n                    label.textContent = newValue;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"slot\"));\r\n    style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                width: max-content;\r\n                flex-direction: row;\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarItemGroupElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEToolBarItemGroupElementBase.prototype, \"label\", void 0);\r\nHTMLEToolBarItemGroupElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-toolbaritemgroup\"\r\n    })\r\n], HTMLEToolBarItemGroupElementBase);\r\nvar HTMLEToolBarItemGroupElement = HTMLEToolBarItemGroupElementBase;\r\n//# sourceMappingURL=ToolBarItemGroup.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n};\r\nvar _HTMLEToolBarElementBase_instances, _HTMLEToolBarElementBase_walker, _HTMLEToolBarElementBase_nodeFilter, _HTMLEToolBarElementBase_lastItem, _HTMLEToolBarElementBase_previousItem, _HTMLEToolBarElementBase_nextItem, _HTMLEToolBarElementBase_setActiveItem, _HTMLEToolBarElementBase_handleClickEvent, _HTMLEToolBarElementBase_handleContextMenuEvent, _HTMLEToolBarElementBase_handleDblClickEvent, _HTMLEToolBarElementBase_handleFocusEvent, _HTMLEToolBarElementBase_handleFocusInEvent, _HTMLEToolBarElementBase_handleFocusOutEvent, _HTMLEToolBarElementBase_handleMouseDownEvent, _HTMLEToolBarElementBase_handleKeyDownEvent;\r\nimport { CustomElement, AttributeProperty, element } from \"../../Element\";\r\nimport { HTMLEToolBarItemElement } from \"./ToolBarItem\";\r\nimport { HTMLEToolBarItemGroupElement } from \"./ToolBarItemGroup\";\r\nimport \"./ToolBarItem\";\r\nimport \"./ToolBarItemGroup\";\r\nexport { HTMLEToolBarElement };\r\nvar shadowTemplate;\r\nvar style;\r\nvar wasExpandedOnMouseDown;\r\nlet HTMLEToolBarElementBase = class HTMLEToolBarElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLEToolBarElementBase_instances.add(this);\r\n        _HTMLEToolBarElementBase_walker.set(this, void 0);\r\n        __classPrivateFieldSet(this, _HTMLEToolBarElementBase_walker, document.createTreeWalker(this, NodeFilter.SHOW_ELEMENT, __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_nodeFilter).bind(this)), \"f\");\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        this.addEventListener(\"click\", __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_handleClickEvent).bind(this));\r\n        this.addEventListener(\"contextmenu\", __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_handleContextMenuEvent).bind(this));\r\n        this.addEventListener(\"dblclick\", __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_handleDblClickEvent).bind(this));\r\n        this.addEventListener(\"focus\", __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_handleFocusEvent).bind(this));\r\n        this.addEventListener(\"focusin\", __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_handleFocusInEvent).bind(this));\r\n        this.addEventListener(\"focusout\", __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_handleFocusOutEvent).bind(this));\r\n        this.addEventListener(\"mousedown\", __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_handleMouseDownEvent).bind(this));\r\n        this.addEventListener(\"keydown\", __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_handleKeyDownEvent).bind(this));\r\n    }\r\n    get activeItem() {\r\n        return this.querySelector(\"e-toolbaritem[active]\");\r\n    }\r\n    items() {\r\n        return Array.from(this.querySelectorAll(\":is(:scope, :scope > e-toolbaritemgroup) > e-toolbaritem\"));\r\n    }\r\n    connectedCallback() {\r\n        const { tabIndex } = this;\r\n        this.tabIndex = tabIndex;\r\n    }\r\n    firstItem() {\r\n        const walker = __classPrivateFieldGet(this, _HTMLEToolBarElementBase_walker, \"f\");\r\n        walker.currentNode = walker.root;\r\n        return walker.firstChild();\r\n    }\r\n};\r\n_HTMLEToolBarElementBase_walker = new WeakMap(), _HTMLEToolBarElementBase_instances = new WeakSet(), _HTMLEToolBarElementBase_nodeFilter = function _HTMLEToolBarElementBase_nodeFilter(node) {\r\n    if (node instanceof HTMLEToolBarItemElement) {\r\n        return NodeFilter.FILTER_ACCEPT;\r\n    }\r\n    if (node instanceof HTMLEToolBarItemGroupElement) {\r\n        return NodeFilter.FILTER_SKIP;\r\n    }\r\n    return NodeFilter.FILTER_REJECT;\r\n}, _HTMLEToolBarElementBase_lastItem = function _HTMLEToolBarElementBase_lastItem() {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEToolBarElementBase_walker, \"f\");\r\n    walker.currentNode = walker.root;\r\n    return walker.lastChild();\r\n}, _HTMLEToolBarElementBase_previousItem = function _HTMLEToolBarElementBase_previousItem(item) {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEToolBarElementBase_walker, \"f\");\r\n    walker.currentNode = item;\r\n    const previousItem = walker.previousSibling();\r\n    return previousItem;\r\n}, _HTMLEToolBarElementBase_nextItem = function _HTMLEToolBarElementBase_nextItem(item) {\r\n    const walker = __classPrivateFieldGet(this, _HTMLEToolBarElementBase_walker, \"f\");\r\n    walker.currentNode = item;\r\n    return walker.nextSibling();\r\n}, _HTMLEToolBarElementBase_setActiveItem = function _HTMLEToolBarElementBase_setActiveItem(item) {\r\n    const { activeItem } = this;\r\n    if (activeItem !== null && activeItem !== item) {\r\n        activeItem.active = false;\r\n    }\r\n    if (item !== null) {\r\n        item.active = true;\r\n    }\r\n}, _HTMLEToolBarElementBase_handleClickEvent = function _HTMLEToolBarElementBase_handleClickEvent(event) {\r\n    var _a;\r\n    const { target } = event;\r\n    const targetItem = target.closest(\"e-toolbaritem\");\r\n    if (targetItem) {\r\n        const { type, pressed } = targetItem;\r\n        switch (type) {\r\n            case \"checkbox\": {\r\n                targetItem.pressed = !pressed;\r\n                break;\r\n            }\r\n            case \"radio\": {\r\n                targetItem.pressed = true;\r\n                break;\r\n            }\r\n            case \"menubutton\": {\r\n                const { menubutton } = targetItem;\r\n                if (menubutton && !menubutton.contains(target)) {\r\n                    const expand = !wasExpandedOnMouseDown.get(targetItem);\r\n                    menubutton.toggle(expand);\r\n                    if (expand) {\r\n                        (_a = menubutton.firstItem) === null || _a === void 0 ? void 0 : _a.focus({ preventScroll: true });\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"select\": {\r\n                const { select } = targetItem;\r\n                if (select && !select.contains(target)) {\r\n                    const expand = !wasExpandedOnMouseDown.get(targetItem);\r\n                    select.toggle(expand);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    event.stopPropagation();\r\n}, _HTMLEToolBarElementBase_handleContextMenuEvent = function _HTMLEToolBarElementBase_handleContextMenuEvent(event) {\r\n    event.stopPropagation();\r\n}, _HTMLEToolBarElementBase_handleDblClickEvent = function _HTMLEToolBarElementBase_handleDblClickEvent(event) {\r\n    event.stopPropagation();\r\n}, _HTMLEToolBarElementBase_handleFocusEvent = function _HTMLEToolBarElementBase_handleFocusEvent(event) {\r\n    var _a;\r\n    const { relatedTarget } = event;\r\n    const { activeItem } = this;\r\n    if (!this.contains(relatedTarget)) {\r\n        (_a = (activeItem !== null && activeItem !== void 0 ? activeItem : this.firstItem())) === null || _a === void 0 ? void 0 : _a.focus();\r\n    }\r\n}, _HTMLEToolBarElementBase_handleFocusInEvent = function _HTMLEToolBarElementBase_handleFocusInEvent(event) {\r\n    const { target } = event;\r\n    const targetItem = target.closest(\"e-toolbaritem\");\r\n    if (targetItem) {\r\n        __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_setActiveItem).call(this, targetItem);\r\n        this.tabIndex = -1;\r\n    }\r\n}, _HTMLEToolBarElementBase_handleFocusOutEvent = function _HTMLEToolBarElementBase_handleFocusOutEvent(event) {\r\n    const { relatedTarget } = event;\r\n    const lostFocusWithin = !this.contains(relatedTarget);\r\n    if (lostFocusWithin) {\r\n        this.tabIndex = 0;\r\n    }\r\n}, _HTMLEToolBarElementBase_handleMouseDownEvent = function _HTMLEToolBarElementBase_handleMouseDownEvent(event) {\r\n    const { target } = event;\r\n    const targetItem = target.closest(\"e-toolbaritem\");\r\n    if (targetItem) {\r\n        const { type } = targetItem;\r\n        switch (type) {\r\n            case \"menubutton\": {\r\n                const { menubutton } = targetItem;\r\n                if (menubutton && !menubutton.contains(target)) {\r\n                    wasExpandedOnMouseDown.set(targetItem, menubutton.expanded);\r\n                }\r\n                break;\r\n            }\r\n            case \"select\": {\r\n                const { select } = targetItem;\r\n                if (select && !select.contains(target)) {\r\n                    wasExpandedOnMouseDown.set(targetItem, select.expanded);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}, _HTMLEToolBarElementBase_handleKeyDownEvent = function _HTMLEToolBarElementBase_handleKeyDownEvent(event) {\r\n    var _a, _b;\r\n    const { key } = event;\r\n    const { activeItem } = this;\r\n    switch (key) {\r\n        case \"Enter\":\r\n        case \" \": {\r\n            if (activeItem) {\r\n                const { type } = activeItem;\r\n                switch (type) {\r\n                    case \"menubutton\": {\r\n                        const { menubutton } = activeItem;\r\n                        if (menubutton) {\r\n                            menubutton.expand();\r\n                            (_a = menubutton.firstItem) === null || _a === void 0 ? void 0 : _a.focus({ preventScroll: true });\r\n                        }\r\n                        break;\r\n                    }\r\n                    case \"select\": {\r\n                        const { select } = activeItem;\r\n                        if (select) {\r\n                            select.expand();\r\n                        }\r\n                        break;\r\n                    }\r\n                    default: {\r\n                        activeItem.click();\r\n                        break;\r\n                    }\r\n                }\r\n                event.stopPropagation();\r\n            }\r\n            break;\r\n        }\r\n        case \"ArrowLeft\": {\r\n            if (activeItem) {\r\n                const previousItem = __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_previousItem).call(this, activeItem);\r\n                if (previousItem) {\r\n                    previousItem.focus({ preventScroll: true });\r\n                }\r\n            }\r\n            else {\r\n                const firstItem = this.firstItem();\r\n                if (firstItem) {\r\n                    firstItem.focus({ preventScroll: true });\r\n                }\r\n            }\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n        case \"ArrowRight\": {\r\n            if (activeItem) {\r\n                const nextItem = __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_nextItem).call(this, activeItem);\r\n                if (nextItem) {\r\n                    nextItem.focus({ preventScroll: true });\r\n                }\r\n            }\r\n            else {\r\n                const lastItem = __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_lastItem).call(this);\r\n                if (lastItem) {\r\n                    lastItem.focus({ preventScroll: true });\r\n                }\r\n            }\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n        case \"ArrowDown\": {\r\n            if (activeItem) {\r\n                const { type } = activeItem;\r\n                switch (type) {\r\n                    case \"select\": {\r\n                        (_b = activeItem.select) === null || _b === void 0 ? void 0 : _b.expand();\r\n                        event.stopPropagation();\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case \"Home\": {\r\n            const firstItem = this.firstItem();\r\n            if (firstItem) {\r\n                firstItem.focus({ preventScroll: true });\r\n            }\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n        case \"End\": {\r\n            const lastItem = __classPrivateFieldGet(this, _HTMLEToolBarElementBase_instances, \"m\", _HTMLEToolBarElementBase_lastItem).call(this);\r\n            if (lastItem) {\r\n                lastItem.focus({ preventScroll: true });\r\n            }\r\n            event.stopPropagation();\r\n            break;\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"slot\"));\r\n    wasExpandedOnMouseDown = new WeakMap();\r\n    style = /*css*/ `\r\n            :host {\r\n                display: flex;\r\n                flex-direction: row;\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarElementBase.prototype, \"name\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEToolBarElementBase.prototype, \"orientation\", void 0);\r\nHTMLEToolBarElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-toolbar\"\r\n    })\r\n], HTMLEToolBarElementBase);\r\nvar HTMLEToolBarElement = HTMLEToolBarElementBase;\r\n//# sourceMappingURL=ToolBar.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLEHandleElementBase_instances, _HTMLEHandleElementBase_target, _HTMLEHandleElementBase_onCapture, _HTMLEHandleElementBase_handlePointerUpEvent, _HTMLEHandleElementBase_handlePointerDownEvent, _HTMLEHandleElementBase_handlePointerMoveEvent;\r\nimport { DEFAULT_THEME_SELECTED_ITEM_COLOR } from \"../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty } from \"../Element\";\r\nexport { HTMLEHandleElement };\r\nvar style;\r\nlet HTMLEHandleElementBase = class HTMLEHandleElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLEHandleElementBase_instances.add(this);\r\n        _HTMLEHandleElementBase_target.set(this, void 0);\r\n        _HTMLEHandleElementBase_onCapture.set(this, void 0);\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        __classPrivateFieldSet(this, _HTMLEHandleElementBase_target, null, \"f\");\r\n        __classPrivateFieldSet(this, _HTMLEHandleElementBase_onCapture, false, \"f\");\r\n        this.addEventListener(\"pointerdown\", __classPrivateFieldGet(this, _HTMLEHandleElementBase_instances, \"m\", _HTMLEHandleElementBase_handlePointerDownEvent).bind(this));\r\n        this.addEventListener(\"pointermove\", __classPrivateFieldGet(this, _HTMLEHandleElementBase_instances, \"m\", _HTMLEHandleElementBase_handlePointerMoveEvent).bind(this));\r\n        this.addEventListener(\"pointerup\", __classPrivateFieldGet(this, _HTMLEHandleElementBase_instances, \"m\", _HTMLEHandleElementBase_handlePointerUpEvent).bind(this));\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"controls\": {\r\n                const { controls } = this;\r\n                __classPrivateFieldSet(this, _HTMLEHandleElementBase_target, document.getElementById(controls), \"f\");\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n_HTMLEHandleElementBase_target = new WeakMap(), _HTMLEHandleElementBase_onCapture = new WeakMap(), _HTMLEHandleElementBase_instances = new WeakSet(), _HTMLEHandleElementBase_handlePointerUpEvent = function _HTMLEHandleElementBase_handlePointerUpEvent(event) {\r\n    const { pointerId } = event;\r\n    this.releasePointerCapture(pointerId);\r\n    __classPrivateFieldSet(this, _HTMLEHandleElementBase_onCapture, false, \"f\");\r\n}, _HTMLEHandleElementBase_handlePointerDownEvent = function _HTMLEHandleElementBase_handlePointerDownEvent(event) {\r\n    const { pointerId } = event;\r\n    const { controls } = this;\r\n    __classPrivateFieldSet(this, _HTMLEHandleElementBase_target, document.getElementById(controls), \"f\");\r\n    this.setPointerCapture(pointerId);\r\n    __classPrivateFieldSet(this, _HTMLEHandleElementBase_onCapture, true, \"f\");\r\n}, _HTMLEHandleElementBase_handlePointerMoveEvent = function _HTMLEHandleElementBase_handlePointerMoveEvent(event) {\r\n    var _a;\r\n    if (__classPrivateFieldGet(this, _HTMLEHandleElementBase_onCapture, \"f\")) {\r\n        const target = __classPrivateFieldGet(this, _HTMLEHandleElementBase_target, \"f\");\r\n        if (target !== null) {\r\n            const targetComputedStyle = window.getComputedStyle(target);\r\n            const { movementX, movementY } = event;\r\n            const { width: rectWidth, height: rectHeight } = target.getBoundingClientRect();\r\n            const outerElement = (_a = target.parentElement) !== null && _a !== void 0 ? _a : document.body;\r\n            const { left: outerRectLeft, right: outerRectRight, top: outerRectTop, bottom: outerRectBottom } = outerElement.getBoundingClientRect();\r\n            const left = parseFloat(targetComputedStyle.getPropertyValue(\"left\"));\r\n            const newLeft = Math.max(outerRectLeft, Math.min(Math.trunc(left + movementX), outerRectRight - rectWidth));\r\n            const top = parseFloat(targetComputedStyle.getPropertyValue(\"top\"));\r\n            const newTop = Math.max(outerRectTop, Math.min(Math.trunc(top + movementY), outerRectBottom - rectHeight));\r\n            target.style.setProperty(\"left\", `${newLeft}px`);\r\n            target.style.setProperty(\"top\", `${newTop}px`);\r\n            this.dispatchEvent(new CustomEvent(\"move\"));\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    style = /*css*/ `\r\n            :host {\r\n                display: block;\r\n                            \r\n                width: 24px;\r\n                height: 12px;\r\n                \r\n                background-color: var(--theme-selected-item-color, ${DEFAULT_THEME_SELECTED_ITEM_COLOR});\r\n\r\n                -webkit-mask-image: url(\"/assets/dots.png\");\r\n                mask-image: url(\"/assets/dots.png\");\r\n\r\n                -webkit-mask-repeat: repeat;\r\n                mask-repeat: repeat;\r\n                cursor: move;\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true })\r\n], HTMLEHandleElementBase.prototype, \"controls\", void 0);\r\nHTMLEHandleElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-handle\"\r\n    })\r\n], HTMLEHandleElementBase);\r\nvar HTMLEHandleElement = HTMLEHandleElementBase;\r\n//# sourceMappingURL=Handle.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLEImportElementBase_instances, _HTMLEImportElementBase_importRequest;\r\nimport { CustomElement, AttributeProperty } from \"../Element\";\r\nexport { HTMLEImportElement };\r\nlet HTMLEImportElementBase = class HTMLEImportElementBase extends HTMLElement {\r\n    constructor() {\r\n        super(...arguments);\r\n        _HTMLEImportElementBase_instances.add(this);\r\n    }\r\n    connectedCallback() {\r\n        const { src } = this;\r\n        if (src) {\r\n            __classPrivateFieldGet(this, _HTMLEImportElementBase_instances, \"m\", _HTMLEImportElementBase_importRequest).call(this, src);\r\n        }\r\n    }\r\n};\r\n_HTMLEImportElementBase_instances = new WeakSet(), _HTMLEImportElementBase_importRequest = function _HTMLEImportElementBase_importRequest(src) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        this.outerHTML = yield fetch(src).then((response) => {\r\n            if (response.ok) {\r\n                return response.text();\r\n            }\r\n            else {\r\n                throw new Error(response.statusText);\r\n            }\r\n        });\r\n        this.dispatchEvent(new Event(\"load\", { bubbles: true }));\r\n    });\r\n};\r\n__decorate([\r\n    AttributeProperty({ type: String })\r\n], HTMLEImportElementBase.prototype, \"src\", void 0);\r\nHTMLEImportElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-import\"\r\n    })\r\n], HTMLEImportElementBase);\r\nvar HTMLEImportElement = HTMLEImportElementBase;\r\n//# sourceMappingURL=Import.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLELoaderElementBase_instances, _HTMLELoaderElementBase_updateTemplate;\r\nimport { DEFAULT_THEME_SELECTED_ITEM_COLOR } from \"../../stylesheets/Theme\";\r\nimport { CustomElement, AttributeProperty, element } from \"../Element\";\r\nexport { HTMLELoaderElement };\r\nvar barShadowTemplate;\r\nvar spinnerShadowTemplate;\r\nvar style;\r\nlet HTMLELoaderElementBase = class HTMLELoaderElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLELoaderElementBase_instances.add(this);\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.replaceChildren(barShadowTemplate.content.cloneNode(true));\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"type\": {\r\n                __classPrivateFieldGet(this, _HTMLELoaderElementBase_instances, \"m\", _HTMLELoaderElementBase_updateTemplate).call(this);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n};\r\n_HTMLELoaderElementBase_instances = new WeakSet(), _HTMLELoaderElementBase_updateTemplate = function _HTMLELoaderElementBase_updateTemplate() {\r\n    const { type, shadowRoot } = this;\r\n    switch (type) {\r\n        case \"spinner\": {\r\n            shadowRoot.replaceChildren(spinnerShadowTemplate.content.cloneNode(true));\r\n            break;\r\n        }\r\n        case \"bar\": {\r\n            shadowRoot.replaceChildren(barShadowTemplate.content.cloneNode(true));\r\n            break;\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    barShadowTemplate = element(\"template\");\r\n    barShadowTemplate.content.append(element(\"div\", {\r\n        attributes: {\r\n            part: \"bar\"\r\n        },\r\n        children: [\r\n            element(\"div\", {\r\n                attributes: {\r\n                    part: \"slider\"\r\n                },\r\n                children: [\r\n                    element(\"div\", {\r\n                        attributes: {\r\n                            part: \"cursor\"\r\n                        }\r\n                    })\r\n                ]\r\n            })\r\n        ]\r\n    }));\r\n    spinnerShadowTemplate = element(\"template\");\r\n    spinnerShadowTemplate.content.append(element(\"div\", {\r\n        attributes: {\r\n            part: \"spinner\"\r\n        }\r\n    }));\r\n    style = /*css*/ `\r\n            :host {\r\n                display: inline-block;\r\n            }\r\n\r\n            :host(:is(:not([type]), [type=\"bar\"])) {\r\n                border: 1px solid gainsboro;\r\n                border-radius: 4px;\r\n            }\r\n        \r\n            [part=\"bar\"] {\r\n                position: relative;\r\n                overflow: hidden;\r\n                height: 6px;\r\n                width: 100%;\r\n                width: 86px;\r\n                border-radius: 4px;\r\n                background-color: whitesmoke;\r\n            }\r\n        \r\n            [part=\"slider\"] {\r\n                display: flex;\r\n                position: absolute;\r\n                width: 100%;\r\n                height: 100%;\r\n                animation-name: slider;\r\n            }\r\n        \r\n            [part=\"slider\"],\r\n            [part=\"cursor\"] {\r\n                border-radius: 4px;\r\n                will-change: transform;\r\n                animation-duration: 1s;\r\n                animation-timing-function: linear;\r\n                animation-iteration-count: infinite;\r\n            }\r\n        \r\n            [part=\"cursor\"] {\r\n                display: block;\r\n                width: 32px;\r\n                background-color: var(--theme-activated-item-color, ${DEFAULT_THEME_SELECTED_ITEM_COLOR});\r\n                animation-name: cursor;\r\n            }\r\n        \r\n            :host([type=\"spinner\"]) {\r\n                display: inline-block;\r\n                width: 20px;\r\n                height: 20px;\r\n            }\r\n        \r\n            [part=\"spinner\"] {\r\n                display: inline-block;\r\n                width: 18px;\r\n                height: 18px;\r\n            }\r\n        \r\n            [part=\"spinner\"]::after {\r\n                content: \"\";\r\n                display: block;\r\n                width: 12px;\r\n                height: 12px;\r\n                border-radius: 50%;\r\n                border-width: 4px;\r\n                border-style: solid;\r\n                border-color: transparent var(--theme-activated-item-color, ${DEFAULT_THEME_SELECTED_ITEM_COLOR});\r\n                animation: spin 1.2s linear infinite;\r\n            }\r\n        \r\n            @keyframes slider {\r\n                0% {\r\n                    transform: translateX(0%);\r\n                }\r\n                100% {\r\n                    transform: translateX(100%);\r\n                }\r\n            }\r\n        \r\n            @keyframes cursor {\r\n                0% {\r\n                    transform: translateX(-100%);\r\n                }\r\n                100% {\r\n                    transform: translateX(100%);\r\n                }\r\n            }\r\n        \r\n            @keyframes spin {\r\n                0% {\r\n                    transform: rotate(0);\r\n                }\r\n                100% {\r\n                    transform: rotate(360deg);\r\n                }\r\n            }\r\n        `;\r\n})();\r\n__decorate([\r\n    AttributeProperty({ type: String, defaultValue: \"bar\", observed: true })\r\n], HTMLELoaderElementBase.prototype, \"type\", void 0);\r\nHTMLELoaderElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-loader\"\r\n    })\r\n], HTMLELoaderElementBase);\r\nvar HTMLELoaderElement = HTMLELoaderElementBase;\r\n//# sourceMappingURL=Loader.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLESeparatorElementBase_internals;\r\nimport { CustomElement } from \"../Element\";\r\nexport { HTMLESeparatorElement };\r\nvar style;\r\nlet HTMLESeparatorElementBase = class HTMLESeparatorElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLESeparatorElementBase_internals.set(this, void 0);\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        __classPrivateFieldSet(this, _HTMLESeparatorElementBase_internals, this.attachInternals(), \"f\");\r\n        __classPrivateFieldGet(this, _HTMLESeparatorElementBase_internals, \"f\").role = \"separator\";\r\n    }\r\n};\r\n_HTMLESeparatorElementBase_internals = new WeakMap();\r\n(() => {\r\n    style = /*css*/ `\r\n            :host {\r\n                display: block;\r\n                margin: 10px 0 10px 27px;\r\n                border: none;\r\n                border-top: 1px solid lightgrey;\r\n            }\r\n        `;\r\n})();\r\nHTMLESeparatorElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-separator\"\r\n    })\r\n], HTMLESeparatorElementBase);\r\nvar HTMLESeparatorElement = HTMLESeparatorElementBase;\r\n//# sourceMappingURL=Separator.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _HTMLEToolTipElementBase_instances, _HTMLEToolTipElementBase_target, _HTMLEToolTipElementBase_targetListenerObject, _HTMLEToolTipElementBase_documentListenerObject, _HTMLEToolTipElementBase_toggleAnimation, _HTMLEToolTipElementBase_setTarget, _HTMLEToolTipElementBase_arrow, _HTMLEToolTipElementBase_position, _HTMLEToolTipElementBase_handleTargetMouseEnterEvent, _HTMLEToolTipElementBase_handleTargetMouseLeaveEvent, _HTMLEToolTipElementBase_handleDocumentKeyDownEvent;\r\nimport { CustomElement, AttributeProperty, element } from \"../Element\";\r\nexport { HTMLEToolTipElement };\r\nvar shadowTemplate;\r\nvar style;\r\nvar HIDE_DELAY_MS = 100;\r\nvar SHOW_DELAY_MS = 200;\r\nvar ANIMATION_DURATION = 100;\r\nlet HTMLEToolTipElementBase = class HTMLEToolTipElementBase extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        _HTMLEToolTipElementBase_instances.add(this);\r\n        _HTMLEToolTipElementBase_target.set(this, void 0);\r\n        _HTMLEToolTipElementBase_targetListenerObject.set(this, void 0);\r\n        _HTMLEToolTipElementBase_documentListenerObject.set(this, void 0);\r\n        _HTMLEToolTipElementBase_toggleAnimation.set(this, void 0);\r\n        const shadowRoot = this.attachShadow({ mode: \"open\" });\r\n        const adoptedStylesheet = new CSSStyleSheet();\r\n        adoptedStylesheet.replace(style);\r\n        shadowRoot.adoptedStyleSheets = [adoptedStylesheet];\r\n        shadowRoot.append(shadowTemplate.content.cloneNode(true));\r\n        __classPrivateFieldSet(this, _HTMLEToolTipElementBase_target, null, \"f\");\r\n        __classPrivateFieldSet(this, _HTMLEToolTipElementBase_toggleAnimation, null, \"f\");\r\n        __classPrivateFieldSet(this, _HTMLEToolTipElementBase_targetListenerObject, (function (tooltip) {\r\n            return {\r\n                handleEvent(event) {\r\n                    const { type } = event;\r\n                    switch (type) {\r\n                        case \"mouseenter\": {\r\n                            __classPrivateFieldGet(tooltip, _HTMLEToolTipElementBase_instances, \"m\", _HTMLEToolTipElementBase_handleTargetMouseEnterEvent).call(tooltip);\r\n                            break;\r\n                        }\r\n                        case \"mouseleave\": {\r\n                            __classPrivateFieldGet(tooltip, _HTMLEToolTipElementBase_instances, \"m\", _HTMLEToolTipElementBase_handleTargetMouseLeaveEvent).call(tooltip);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        })(this), \"f\");\r\n        __classPrivateFieldSet(this, _HTMLEToolTipElementBase_documentListenerObject, (function (tooltip) {\r\n            return {\r\n                handleEvent(event) {\r\n                    const { type } = event;\r\n                    switch (type) {\r\n                        case \"keydown\": {\r\n                            __classPrivateFieldGet(tooltip, _HTMLEToolTipElementBase_instances, \"m\", _HTMLEToolTipElementBase_handleDocumentKeyDownEvent).call(tooltip, event);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        })(this), \"f\");\r\n    }\r\n    get target() {\r\n        return __classPrivateFieldGet(this, _HTMLEToolTipElementBase_target, \"f\");\r\n    }\r\n    connectedCallback() {\r\n        __classPrivateFieldGet(this, _HTMLEToolTipElementBase_instances, \"m\", _HTMLEToolTipElementBase_setTarget).call(this);\r\n    }\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case \"for\": {\r\n                __classPrivateFieldGet(this, _HTMLEToolTipElementBase_instances, \"m\", _HTMLEToolTipElementBase_setTarget).call(this);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    show(options) {\r\n        const { immediate = false } = options !== null && options !== void 0 ? options : {};\r\n        let toggleAnimation = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_toggleAnimation, \"f\");\r\n        if (toggleAnimation !== null) {\r\n            const { id } = toggleAnimation;\r\n            if (id === \"hide\") {\r\n                toggleAnimation.cancel();\r\n            }\r\n            else if (!immediate) {\r\n                return;\r\n            }\r\n        }\r\n        if (!this.visible) {\r\n            this.hidden = false;\r\n            toggleAnimation = this.animate([\r\n                { opacity: 0 },\r\n                { opacity: 1 }\r\n            ], {\r\n                id: \"show\",\r\n                delay: immediate ? 0 : SHOW_DELAY_MS,\r\n                duration: immediate ? 0 : ANIMATION_DURATION\r\n            });\r\n            const { finished } = toggleAnimation;\r\n            finished.then(() => {\r\n                this.visible = true;\r\n            }).catch(_ => void 0);\r\n            __classPrivateFieldSet(this, _HTMLEToolTipElementBase_toggleAnimation, toggleAnimation, \"f\");\r\n            __classPrivateFieldGet(this, _HTMLEToolTipElementBase_instances, \"m\", _HTMLEToolTipElementBase_position).call(this);\r\n        }\r\n        else {\r\n            __classPrivateFieldSet(this, _HTMLEToolTipElementBase_toggleAnimation, null, \"f\");\r\n        }\r\n    }\r\n    hide(options) {\r\n        const { immediate = false } = options !== null && options !== void 0 ? options : {};\r\n        let toggleAnimation = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_toggleAnimation, \"f\");\r\n        if (toggleAnimation !== null) {\r\n            const { id } = toggleAnimation;\r\n            if (id === \"show\") {\r\n                toggleAnimation.cancel();\r\n            }\r\n            else if (!immediate) {\r\n                return;\r\n            }\r\n        }\r\n        if (this.visible) {\r\n            toggleAnimation = this.animate([\r\n                { opacity: 1 },\r\n                { opacity: 0 }\r\n            ], {\r\n                id: \"hide\",\r\n                delay: immediate ? 0 : HIDE_DELAY_MS,\r\n                duration: immediate ? 0 : ANIMATION_DURATION\r\n            });\r\n            const { finished } = toggleAnimation;\r\n            finished.then(() => {\r\n                this.visible = false;\r\n                this.hidden = true;\r\n            }).catch(_ => void 0);\r\n            __classPrivateFieldSet(this, _HTMLEToolTipElementBase_toggleAnimation, toggleAnimation, \"f\");\r\n        }\r\n        else {\r\n            __classPrivateFieldSet(this, _HTMLEToolTipElementBase_toggleAnimation, null, \"f\");\r\n        }\r\n    }\r\n};\r\n_HTMLEToolTipElementBase_target = new WeakMap(), _HTMLEToolTipElementBase_targetListenerObject = new WeakMap(), _HTMLEToolTipElementBase_documentListenerObject = new WeakMap(), _HTMLEToolTipElementBase_toggleAnimation = new WeakMap(), _HTMLEToolTipElementBase_instances = new WeakSet(), _HTMLEToolTipElementBase_setTarget = function _HTMLEToolTipElementBase_setTarget() {\r\n    const { htmlFor } = this;\r\n    if (htmlFor) {\r\n        const rootNode = this.getRootNode();\r\n        if (rootNode instanceof Document || rootNode instanceof ShadowRoot) {\r\n            const target = rootNode.getElementById(htmlFor);\r\n            if (target !== null) {\r\n                const oldTarget = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_target, \"f\");\r\n                const targetListenerObject = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_targetListenerObject, \"f\");\r\n                if (oldTarget) {\r\n                    oldTarget.removeEventListener(\"mouseenter\", targetListenerObject);\r\n                    oldTarget.removeEventListener(\"mouseleave\", targetListenerObject);\r\n                }\r\n                target.addEventListener(\"mouseenter\", targetListenerObject);\r\n                target.addEventListener(\"mouseleave\", targetListenerObject);\r\n            }\r\n            __classPrivateFieldSet(this, _HTMLEToolTipElementBase_target, target, \"f\");\r\n        }\r\n        __classPrivateFieldGet(this, _HTMLEToolTipElementBase_instances, \"m\", _HTMLEToolTipElementBase_position).call(this);\r\n    }\r\n}, _HTMLEToolTipElementBase_arrow = function _HTMLEToolTipElementBase_arrow() {\r\n    return this.shadowRoot.querySelector(\"[part=arrow]\");\r\n}, _HTMLEToolTipElementBase_position = function _HTMLEToolTipElementBase_position() {\r\n    const target = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_target, \"f\");\r\n    if (target !== null) {\r\n        const { top: targetTop, bottom: targetBottom, left: targetLeft, right: targetRight } = target.getBoundingClientRect();\r\n        const { width: tooltipWidth, height: tooltipHeight } = this.getBoundingClientRect();\r\n        const tooltipHalfWidth = tooltipWidth / 2;\r\n        const tooltipHalfHeight = tooltipHeight / 2;\r\n        const targetCenter = (targetRight + targetLeft) / 2;\r\n        const targetMiddle = (targetBottom + targetTop) / 2;\r\n        const { position, style: tooltipStyle } = this;\r\n        const arrow = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_instances, \"m\", _HTMLEToolTipElementBase_arrow).call(this);\r\n        const { style: arrowStyle } = arrow;\r\n        const { width: arrowWidth, height: arrowHeight } = arrow.getBoundingClientRect();\r\n        const arrowHalfWidth = arrowWidth / 2;\r\n        const arrowHalfHeight = arrowHeight / 2;\r\n        const { clientWidth } = document.body;\r\n        switch (position) {\r\n            case \"top\": {\r\n                tooltipStyle.setProperty(\"top\", `${targetTop - tooltipHeight - arrowHalfHeight}px`);\r\n                tooltipStyle.setProperty(\"left\", `${Math.max(0, Math.min(targetCenter - tooltipHalfWidth, clientWidth - tooltipWidth))}px`);\r\n                arrowStyle.setProperty(\"top\", `${targetTop - arrowHalfHeight}px`);\r\n                arrowStyle.setProperty(\"left\", `${targetCenter}px`);\r\n                break;\r\n            }\r\n            case \"bottom\": {\r\n                tooltipStyle.setProperty(\"top\", `${targetBottom + arrowHalfHeight}px`);\r\n                tooltipStyle.setProperty(\"left\", `${Math.max(0, Math.min(targetCenter - tooltipHalfWidth, clientWidth - tooltipWidth))}px`);\r\n                arrowStyle.setProperty(\"top\", `${targetBottom + arrowHalfHeight}px`);\r\n                arrowStyle.setProperty(\"left\", `${targetCenter}px`);\r\n                break;\r\n            }\r\n            case \"left\": {\r\n                tooltipStyle.setProperty(\"top\", `${targetMiddle - tooltipHalfHeight}px`);\r\n                tooltipStyle.setProperty(\"left\", `${targetLeft - tooltipWidth - arrowHalfWidth}px`);\r\n                arrowStyle.setProperty(\"top\", `${targetMiddle}px`);\r\n                arrowStyle.setProperty(\"left\", `${targetLeft - arrowHalfWidth}px`);\r\n                break;\r\n            }\r\n            case \"right\": {\r\n                tooltipStyle.setProperty(\"top\", `${targetMiddle - tooltipHalfHeight}px`);\r\n                tooltipStyle.setProperty(\"left\", `${targetRight + arrowHalfWidth}px`);\r\n                arrowStyle.setProperty(\"top\", `${targetMiddle}px`);\r\n                arrowStyle.setProperty(\"left\", `${targetRight + arrowHalfWidth}px`);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}, _HTMLEToolTipElementBase_handleTargetMouseEnterEvent = function _HTMLEToolTipElementBase_handleTargetMouseEnterEvent() {\r\n    this.show();\r\n    const toggleAnimation = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_toggleAnimation, \"f\");\r\n    if (toggleAnimation) {\r\n        const documentListenerObject = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_documentListenerObject, \"f\");\r\n        const { finished } = toggleAnimation;\r\n        finished.then(() => {\r\n            document.addEventListener(\"keydown\", documentListenerObject);\r\n        }).catch(_ => void 0);\r\n    }\r\n}, _HTMLEToolTipElementBase_handleTargetMouseLeaveEvent = function _HTMLEToolTipElementBase_handleTargetMouseLeaveEvent() {\r\n    this.hide();\r\n    const toggleAnimation = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_toggleAnimation, \"f\");\r\n    if (toggleAnimation) {\r\n        const documentListenerObject = __classPrivateFieldGet(this, _HTMLEToolTipElementBase_documentListenerObject, \"f\");\r\n        const { finished } = toggleAnimation;\r\n        finished.then(() => {\r\n            document.removeEventListener(\"keydown\", documentListenerObject);\r\n        }).catch(_ => void 0);\r\n    }\r\n}, _HTMLEToolTipElementBase_handleDocumentKeyDownEvent = function _HTMLEToolTipElementBase_handleDocumentKeyDownEvent(event) {\r\n    const { key } = event;\r\n    switch (key) {\r\n        case \"Escape\": {\r\n            this.hide({\r\n                immediate: true\r\n            });\r\n            break;\r\n        }\r\n    }\r\n};\r\n(() => {\r\n    shadowTemplate = element(\"template\");\r\n    shadowTemplate.content.append(element(\"div\", {\r\n        attributes: {\r\n            part: \"container\"\r\n        },\r\n        children: [\r\n            element(\"span\", {\r\n                attributes: {\r\n                    part: \"arrow\"\r\n                }\r\n            }),\r\n            element(\"slot\")\r\n        ]\r\n    }));\r\n    style = /*css*/ `\r\n            :host {\r\n                position: fixed;\r\n                display: inline-block;\r\n                z-index: 1;\r\n                padding: 4px;\r\n                border-radius: 3px;\r\n                box-sizing: border-box;\r\n                background-color: white;\r\n                border: 1px solid black;\r\n                pointer-events: none;\r\n            }\r\n            \r\n            :host([hidden]) {\r\n                display: none;\r\n            }\r\n\r\n            :host(:not([visible])) {\r\n                opacity: 0;\r\n            }\r\n            \r\n            [part=\"arrow\"] {\r\n                display: inline-block;\r\n                position: fixed;\r\n                z-index: 1;\r\n                width: 4px;\r\n                height: 4px;\r\n                box-sizing: border-box;\r\n                background-color: white;\r\n                border: 1px solid black;\r\n                border-width: 0 1px 1px 0;\r\n            }\r\n            \r\n            :host(:is(:not([position]), [position=\"top\"])) [part=\"arrow\"] {\r\n                transform: translate(-2px, -2px) rotate(45deg);\r\n            }\r\n            \r\n            :host(:is([position=\"bottom\"])) [part=\"arrow\"] {\r\n                transform: translate(-2px, -2px) rotate(225deg);\r\n            }\r\n            \r\n            :host(:is([position=\"left\"])) [part=\"arrow\"] {\r\n                transform: translate(-2px, -2px) rotate(315deg);\r\n            }\r\n            \r\n            :host(:is([position=\"right\"])) [part=\"arrow\"] {\r\n                transform: translate(-2px, -2px) rotate(135deg);\r\n            }        \r\n        `;\r\n})();\r\n__decorate([\r\n    AttributeProperty({ type: String, observed: true, name: \"for\" })\r\n], HTMLEToolTipElementBase.prototype, \"htmlFor\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: String, defaultValue: \"top\" })\r\n], HTMLEToolTipElementBase.prototype, \"position\", void 0);\r\n__decorate([\r\n    AttributeProperty({ type: Boolean })\r\n], HTMLEToolTipElementBase.prototype, \"visible\", void 0);\r\nHTMLEToolTipElementBase = __decorate([\r\n    CustomElement({\r\n        name: \"e-tooltip\"\r\n    })\r\n], HTMLEToolTipElementBase);\r\nvar HTMLEToolTipElement = HTMLEToolTipElementBase;\r\n//# sourceMappingURL=ToolTip.js.map","import { multiDraw } from \"./src/samples/scenes/MultiDraw\";\r\nimport { Entity } from \"./src/engine/core/general/Entity\";\r\nimport { Scene } from \"./src/engine/core/general/Scene\";\r\nimport { FaceHalfEdgesIterator, FaceVerticesIterator, Vertex, VertexFacesIterator } from \"./src/engine/core/rendering/scenes/geometries/GeometryBuilder\";\r\nimport { QuadGeometry } from \"./src/engine/core/rendering/scenes/geometries/lib/QuadGeometry\";\r\nimport { Matrix3 } from \"./src/engine/libs/maths/algebra/matrices/Matrix3\";\r\nimport { Matrix4 } from \"./src/engine/libs/maths/algebra/matrices/Matrix4\";\r\nimport { Vector2 } from \"./src/engine/libs/maths/algebra/vectors/Vector2\";\r\nimport { Vector3, Vector3Values } from \"./src/engine/libs/maths/algebra/vectors/Vector3\";\r\nimport { Vector4 } from \"./src/engine/libs/maths/algebra/vectors/Vector4\";\r\nimport { GOLDEN_RATIO } from \"./src/engine/libs/maths/geometry/GeometryConstants\";\r\nimport { Triangle } from \"./src/engine/libs/maths/geometry/primitives/Triangle\";\r\nimport { Space } from \"./src/engine/libs/maths/geometry/space/Space\";\r\nimport { buildArrayFromIndexedArrays } from \"./src/engine/utils/Snippets\";\r\nimport { start } from \"./src/samples/scenes/SimpleScene\";\r\nimport { octree } from \"./src/samples/scenes/Octree\";\r\nimport { deferred } from \"./src/samples/scenes/Deferred\";\r\nimport { helpers } from \"./src/samples/scenes/Helpers\";\r\nimport { physics } from \"./src/samples/scenes/Physics\";\r\n\r\nimport { element } from \"editor/lib/elements/Element\";\r\nimport { HTMLEMenuBarElement } from \"editor/lib/elements/containers/menus/MenuBar\";\r\n/*\r\nfunction windingOrder(v0: Vector3, v1: Vector3, v2: Vector3) {\r\n    const triangle = new Triangle(v0, v1, v2);\r\n    const centroid = triangle.getMidpoint(new Vector3());\r\n    const normal = triangle.getNormal(new Vector3());\r\n    \r\n    const e1 = v1.clone().sub(v0);\r\n    const e2 = e1.clone().cross(normal);\r\n\r\n    e1.normalize();\r\n    e2.normalize();\r\n\r\n    const v0_centered = v0.clone().sub(centroid);\r\n    const v1_centered = v1.clone().sub(centroid);\r\n    const v2_centered = v2.clone().sub(centroid);\r\n\r\n    const v0_t1 = e1.dot(v0_centered);\r\n    const v0_t2 = e2.dot(v0_centered);\r\n\r\n    const v1_t1 = e1.dot(v1_centered);\r\n    const v1_t2 = e2.dot(v1_centered);\r\n\r\n    const v2_t1 = e1.dot(v2_centered);\r\n    const v2_t2 = e2.dot(v2_centered);\r\n\r\n    const det = (v1_t1 - v0_t1) * (v2_t2 - v0_t2) - (v1_t2 - v0_t2) * (v2_t1 - v0_t1);\r\n    console.log(det < 0 ? \"CW\" : \"CCW\");\r\n\r\n    // const v0_out = new Vector2([v0_t1, v0_t2]);\r\n    // const v1_out = new Vector2([v1_t1, v1_t2]);\r\n    // const v2_out = new Vector2([v2_t1, v2_t2]);\r\n    // const v0_angle = Math.atan2(v0_out.y, v0_out.x);\r\n    // const v1_angle = Math.atan2(v1_out.y, v1_out.x);\r\n    // const v2_angle = Math.atan2(v2_out.y, v2_out.x);\r\n    \r\n    // const angles = [v0_angle, v1_angle, v2_angle];\r\n}*/\r\n\r\nimport \"editor/lib/elements/containers/menus\";\r\nimport \"editor/lib/elements/containers/toolbars\";\r\n\r\nimport \"editor/lib/elements/misc\";\r\n\r\nconst menubar = element(\"e-menubar\", {\r\n    children: [\r\n        element(\"e-menuitem\", {\r\n            attributes: {\r\n                type: \"menu\"\r\n            },\r\n            children: [\r\n                \"File\",\r\n                element(\"e-menu\", {\r\n                    attributes: {\r\n                        slot: \"menu\"\r\n                    },\r\n                    children: [\r\n                        element(\"e-menuitem\", {\r\n                            attributes: {\r\n                                type: \"button\"\r\n                            },\r\n                            children: \"Action 1\"\r\n                        })\r\n                    ]\r\n                })\r\n            ]\r\n        }),\r\n        element(\"e-menuitem\", {\r\n            attributes: {\r\n                type: \"menu\"\r\n            },\r\n            children: [\r\n                \"Help\",\r\n                element(\"e-menu\", {\r\n                    attributes: {\r\n                        slot: \"menu\"\r\n                    },\r\n                    children: [\r\n                        element(\"e-menuitem\", {\r\n                            attributes: {\r\n                                type: \"button\"\r\n                            },\r\n                            children: \"About\"\r\n                        })\r\n                    ]\r\n                })\r\n            ]\r\n        })\r\n    ]\r\n});\r\n\r\nconst toolbar = element(\"e-toolbar\", {\r\n    children: [\r\n        element(\"e-toolbaritem\", {\r\n            attributes: {\r\n                id: \"play-pause\",\r\n                type: \"checkbox\",\r\n                name: \"play-pause\",\r\n                iconed: true\r\n            }\r\n        })\r\n    ]\r\n});\r\n\r\nconst tooltips = [\r\n    element(\"e-tooltip\", {\r\n        attributes: {\r\n            for: \"play-pause\"\r\n        },\r\n        children: \"Play/pause rendering\"\r\n    })\r\n];\r\n\r\nexport async function main() {\r\n    document.body.prepend(menubar);\r\n    menubar.after(toolbar);\r\n    document.body.append(...tooltips);\r\n    //instanced();\r\n    //wireframe();\r\n\r\n    /*const myWorker = new Worker(\"./worker.js\");\r\n    const sab = new SharedArrayBuffer(1024);\r\n    const array = new Uint32Array(sab);\r\n    myWorker.addEventListener(\"message\", (event) => {\r\n        console.log(`Received back: ${array[10]}`);\r\n    });\r\n\r\n    myWorker.postMessage(sab);*/\r\n\r\n    //physics();\r\n    //helpers();\r\n    //deferred();\r\n    //octree();\r\n    start();\r\n    //multiDraw();\r\n\r\n    //startMaps();\r\n\r\n    // const button = document.createElement(\"button\");\r\n    // button.textContent = \"Get bin\";\r\n    // document.body.insertAdjacentElement(\"beforebegin\", button);\r\n    // button.onclick = () => {\r\n    //     const anchor = document.createElement(\"a\");\r\n    //     const myData = new Float32Array([32.20, 1]);\r\n    //     const myBlob = new Blob([myData]);\r\n    //     anchor.download = \"dat.bin\";\r\n    //     anchor.href = URL.createObjectURL(myBlob);\r\n    //     anchor.click();\r\n    // };\r\n    \r\n    // const input = document.createElement(\"input\");\r\n    // input.type = \"file\";\r\n    // input.oninput = () => {\r\n    //     if (input.files) {\r\n    //         Array.from(input.files).forEach((file) => {\r\n    //             file.arrayBuffer().then((arr) => {\r\n    //                 console.log(Array.from(new Float32Array(arr)).map(val => val.toFixed(3)));\r\n    //             });\r\n    //         });\r\n    //     }\r\n    // };\r\n    // document.body.insertAdjacentElement(\"beforebegin\", input);\r\n}"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","Error","replace","p","Injector","constructor","args","_defaultCtor","defaultCtor","_onDefaultOverride","onDefaultOverride","_constructors","Map","overrideDefaultCtor","forceQualifier","qualifier","_forcedQualifier","unforceQualifier","getConstructor","qualifierValue","inject","Array","from","register","has","set","MathError","name","Vector2Base","array","Float32Array","values","x","y","setValues","equals","vec","v","copy","clone","setUnit","setZeros","add","addScalar","k","sub","lerp","t","clamp","min","max","l","Math","multScalar","cross","a","b","dot","sqrt","lengthSquared","dist","dx","dy","distSquared","normalize","lenSq","len","Number","EPSILON","negate","mult","arg0","Vector2","m","addScaled","writeIntoArray","out","offset","readFromArray","arr","copyAndSub","vecA","vecB","ctor","Vector3Base","toString","join","static","vectorA","vectorB","temp","Vector3","acos","z","vector","to","scale","t0","t1","t2","distance","dz","hypot","distanceSquared","toSpherical","center","thisArray","centerArray","roh","theta","phi","atan2","toCartesian","sin","cos","mat","copyAndCross","iterator","i","next","done","Key","Space","origin","right","left","up","down","forward","backward","KEYS_COUNT","keys","KeyModifier","MouseButton","MOUSE_BUTTONS_COUNT","MOUSE_BUTTONS_INDICES","freeze","reduce","map","button","index","assign","KEYS_INDICES","Input","keyFlags","fill","mouseFlags","pointerPosition","wheelDelta","canvas","canvasRectangle","initialize","getBoundingClientRect","addEventListener","getCanvasRect","rect","clear","handleEvent","event","eventIndex","type","canvasRect","clientX","clientY","top","deltaY","getKey","getKeyUp","getKeyDown","getMouseButton","getPointerPosition","getPointerScreenPosition","positionAray","width","height","getWheelDelta","getMouseButtonDown","getMouseButtonUp","tempVector1","tempVector2","tempVector3","PoolAutoExtendPolicy","StackPool","policy","autoExtendPolicy","AUTO_EXTEND_ONE","autoExtendTicks","autoExtend","extend","AUTO_EXTEND_POW2","pow","acquire","count","release","options","super","objects","size","target","slice","console","warn","push","PI","_bytes","ArrayBuffer","BYTES_PER_ELEMENT","_floatView","_intView","Uint32Array","Matrix3Base","checkArray","row1","row","row2","row3","col1","col","col2","col3","m11","val","m12","m13","m21","m22","m23","m31","m32","m33","getValues","other","setIdentity","det","trace","transpose","invert","t11","t12","t13","t21","t22","t23","t31","t32","t33","a11","a12","a13","a21","a22","a23","a31","a32","a33","b11","b12","b13","b21","b22","b23","b31","b32","b33","angle","setRotationX","cosAngle","sinAngle","setRotationY","setRotationZ","solve","A0x","A0y","A0z","A1x","A1y","A1z","A2x","A2y","A2z","rx","ry","rz","x_","y_","solve2","bx","by","Matrix3","QuaternionBase","_array","_checkArray","w","pitch","sinPitch","abs","sign","asin","yaw","sinYawCosPitch","cosYawCosPitch","roll","sinRollCosPitch","cosRollCosPitch","axis","setAxisAngle","setEuler","quat","q","quatArray","getAxis","outArray","den","halfx","qSqrt","getMatrix3","matrix","s","xs","ys","zs","wx","wy","wz","xx","xy","xz","yy","yz","zz","getMatrix4","rotate","vectorArray","vx","vy","vz","qx","qy","qz","qw","tx","ty","tz","tw","toVector","cosYaw","sinYaw","cosPitch","cosRoll","sinRoll","axisLength","halfSin","axisArray","setMatrix","matrixArray","lookAt","source","dest","Quaternion","setVectors","crossArray","fromLength","toLength","angleTo","rotation","rotateTowards","slerp","conjugate","ax","ay","az","aw","bz","bw","scalar","fromArray","toArray","cosHalfTheta","halfTheta","sinHalfTheta","trunc","ratioA","ratioB","copyIntoArray","Matrix4Base","m41","m42","m43","m14","m24","m34","m44","getRotation","setTRS","translation","scaling","rotationArray","translationArray","scalingArray","x2","y2","z2","sx","sy","sz","setRotation","quaternion","quaternionArray","matArray","det2_01_01","det2_01_02","det2_01_03","det2_01_12","det2_01_13","det2_01_23","det3_201_012","det3_201_013","det3_201_023","A","a41","a42","a43","a14","a24","a34","a44","o00","o01","o02","o03","o10","o11","o12","o13","o20","o21","o22","o23","o30","o31","o32","o33","t00","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","invDet","B","b41","b42","b43","b14","b24","b34","b44","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","bX","bY","bZ","bW","solve3","setTranslation","vecArray","translate","t3","t4","rotateX","t5","t6","t7","t8","rotateY","sinAngles","rotateZ","c","C","t9","setScaling","eye","eyeArray","upArray","targetArray","e0","e1","e2","u0","u1","u2","x0","x1","y0","y1","z0","z1","transformPoint","point","pointArray","transformPoint4","transformDirection","direction","directionArray","transformNormal","normal","normalArray","thisInvArray","fov","aspect","zNear","zFar","setPerspective","tan","rangeInv","bottom","near","far","setOrthographic","setFrustum","invWidth","invHeight","invDepth","Matrix4","Vector3Pool","_buffer","_bufferViews","subarray","_extensions","UUIDGenerator","_count","newUUID","tempMatrix","Transform","owner","isStatic","uuid","localArray","localMatrix","hasChanged","getMatrix","getLocalMatrix","thisLocalArray","setLocalMatrix","getRight","getLeft","getUp","getDown","getForward","getBackward","getTranslation","getScaling","transformVector","thisPosition","PlaneBase","constant","setFromNormalAndConstant","setFromNormalAndCoplanarPoint","setFromCoplanarPoints","plane","point1","point2","point3","distanceToPoint","normalized","inverseNormalLength","result","aNormal","aConstant","bNormal","bConstant","cNormal","cConstant","f","v1x","v1y","v1z","v2x","v2y","v2z","v3x","v3y","v3z","Plane","tempVector","FrustumBase","nearPlane","farPlane","topPlane","bottomPlane","leftPlane","rightPlane","extents","_","_nearPlane","_farPlane","_bottomPlane","_topPlane","_leftPlane","_rightPlane","Frustum","setFromMatrix","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m15","intersection","intersectsSphere","sphere","radius","intersectsBox","box","boxMax","boxMin","getEdges","edges","leftBottomNear","leftTopNear","rightBottomNear","rightTopNear","leftBottomFar","leftTopFar","rightBottomFar","rightTopFar","getExtents","_extents","containsPoint","BufferDataUsage","BufferTarget","DrawMode","DataComponentType","AttributeDataType","ElementArrayDataType","WebGLVertexArrayUtilities","VEC2","VEC3","VEC4","FLOAT","BYTE","UNSIGNED_BYTE","Uint8Array","SHORT","Int16Array","UNSIGNED_SHORT","Uint16Array","INT","Int32Array","UNSIGNED_INT","Int8Array","gl","indices","internalBuffer","createBuffer","usage","STATIC_READ","ELEMENT_ARRAY_BUFFER","byteLength","indexType","getElementArrayBufferType","bindBuffer","bufferData","program","attributes","interleaved","internalProgram","DEFAULT_USAGE","attributesEntries","entries","attribute","ARRAY_BUFFER","dataBuffer","byteStride","vertexAttributes","forEach","componentType","stride","getComponentTypeArrayConstructor","getDataTypeNumComponents","bufferSlices","constantValue","byteOffset","attributeName","divisor","getArrayComponentType","getAttribLocation","numComponents","vertexAttribPointer","vertexAttribDivisor","vertexAttrib1fv","vertexAttrib2fv","vertexAttrib3fv","vertexAttrib4fv","bytesPerElement","bufferArray","arrayStrideOffset","arraySliceIndex","enableVertexAttribArray","vertexArray","elementsCount","attributeRecord","verticesBuffers","verticesBuffer","find","getParameter","ARRAY_BUFFER_BINDING","srcOffset","srcLength","dstOffset","slices","sliceOffset","bufferSubData","buffer","data","dstByteOffset","vertexBuffers","elementIndices","elementBuffer","elementBufferOrBufferProperties","internalVertexArray","createVertexArray","bindVertexArray","buffer_i","fromEntries","filter","attribute_i","setter","createVertexArrayBuffer","createVertexElementArrayBuffer","isVertexArray","deleteVertexArray","GeometryAttributes","GeometryBuffer","bufferByteLength","bufferArrayConstructor","toBlob","bufferLength","indicesData","indicesLength","headerData","TextEncoder","encode","JSON","stringify","headerLength","blobDataView","blobDataViewBuffer","blobDataHeaderView","blobDataHeaderLength","Blob","blob","arrayBuffer","blobDataHeaderByteLength","arrayConstructor","header","parse","TextDecoder","decode","geometryBuffer","getAttribute","attributeArrayConstructor","attributeArray","bufferStride","bufferArraySliceIndex","BoundingSphere","transform","hitsSphere","otherCenter","otherRadius","hitsBox","sphereX","sphereY","sphereZ","minX","minY","minZ","maxX","maxY","maxZ","corners","FramebufferStatus","FramebufferTextureTarget","FramebufferAttachment","RenderbufferPixelFormat","DrawBuffer","BoundingBox","boxes","positiveInfinity","POSITIVE_INFINITY","negativeInfinity","NEGATIVE_INFINITY","box_i","boxMinX","boxMinY","boxMinZ","boxMaxX","boxMaxY","boxMaxZ","hits","otherMin","otherMax","otherMinX","otherMinY","otherMinZ","otherMaxX","otherMaxZ","otherMaxY","corner_i","transformed","GeometryBuilder","halfEdges","vertices","faces","create","structuredClone","addTriangleFace","v0","v1","v2","properties","addFace","addQuadFace","v3","addVertex","position","vertex","halfEdgeID","_halfEdges","_vertices","_faces","faceVerticesCount","error","face","faceID","sourceID","targetID","firstHalfEdgeID","halfEdge","previousHalfEdgeID","vertexFacesIterator","face_i","faceHalfEdgesIterator","halfEdge_i","targetID_i","prevID","prevID_i","twinID","nextID","twinHalfEdge","indexOf","linesArray","flatMap","faceVertices","faceVerticesIterator","vertex_i","verticesArray","tangentsArray","faceUvs","uv","uv0","uv1","uv2","edge1","v1_i","edge2","deltaUV1","uv1_i","deltaUV2","tangent","edge1_i","tangent_i","normalsArray","ni","pi","normal_i","uvsArray","flat","trianglesIndicesArray","verticesCount","concat","linesIndicesArray","boundingBox","boundingSphere","FaceHalfEdgesIterator","FaceVerticesIterator","VertexFacesIterator","geometry","reset","current","nextHalfEdgeID","faceHalfEdgeID","firstVertexID","vertexID","vertexHalfEdgeID","CubeGeometry","toBuilder","depth","widthSegments","heightSegments","depthSegments","builder","floor","uvs","u","udir","vdir","gridX","gridY","segmentWidth","segmentHeight","widthHalf","heightHalf","depthHalf","gridX1","gridY1","iy","ix","indicesCount","vi1","vi2","vi3","vi4","ui1","ui2","ui3","ui4","v4","uv3","uv4","QuadGeometry","WebGLFramebufferUtilities","internalFramebuffer","createFramebuffer","internalRenderbuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","samples","internalFormat","renderbufferStorageMultisample","renderbufferStorage","framebuffer","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","attachments","attachment","textureTarget","texture","internalTexture","framebufferTexture2D","status","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","unbindFramebuffer","drawBuffers","props","framebufferRenderbuffer","renderbuffer","readFramebuffer","drawFramebuffer","readRectangle","drawRectangle","mask","READ_FRAMEBUFFER_BINDING","internalReadFramebuffer","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER_BINDING","internalDrawFramebuffer","DRAW_FRAMEBUFFER","blitFramebuffer","format","pixels","readPixels","isFramebuffer","deleteFramebuffer","isRenderbuffer","deleteRenderbuffer","TexturePixelFormat","TextureInternalPixelFormat","TexturePixelType","TextureParameter","TextureTarget","TextureMagFilter","TextureMinFilter","TextureCompareMode","TextureWrapMode","TextureCompareFunction","ShaderType","UniformType","UniformDataType","WebGLTextureUtilities","createTexture","unit","subimages","lod","border","mipmap","ACTIVE_TEXTURE","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texImage2D","subimage_i","xoffset","yoffset","texSubImage2D","TEXTURE_CUBE_MAP","xPos","xNeg","yPos","yNeg","zPos","zNeg","TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_CUBE_MAP_NEGATIVE_X","TEXTURE_CUBE_MAP_POSITIVE_Y","TEXTURE_CUBE_MAP_NEGATIVE_Y","TEXTURE_CUBE_MAP_POSITIVE_Z","TEXTURE_CUBE_MAP_NEGATIVE_Z","TEXTURE_2D_ARRAY","texImage3D","zoffset","texSubImage3D","generateMipmap","mag","wrapS","wrapT","wrapR","baseMipmapLevel","maxMipmapLevel","compareFunction","compareMode","minLod","maxLod","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE_WRAP_R","TEXTURE_BASE_LEVEL","TEXTURE_MAX_LEVEL","TEXTURE_COMPARE_FUNC","TEXTURE_COMPARE_MODE","texParameterf","TEXTURE_MIN_LOD","TEXTURE_MAX_LOD","alignment","pixelStorei","UNPACK_ALIGNMENT","isTexture","deleteTexture","delete","WebGLProgramUtilities","internalShader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","shaderInfoLog","getShaderInfoLog","deleteShader","vertexSource","fragmentSource","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","programInfoLog","getProgramInfoLog","vertexInfoLog","fragmentInfoLog","deleteProgram","CURRENT_PROGRAM","useProgram","WebGLUniformUtilities","uniformValue","of","uniform","uniformType","num","uniform1f","uniform1ui","BOOL","uniform1i","INT_SAMPLER_2D","INT_SAMPLER_2D_ARRAY","INT_SAMPLER_3D","INT_SAMPLER_CUBE","SAMPLER_2D","SAMPLER_3D","SAMPLER_CUBE","SAMPLER_2D_SHADOW","SAMPLER_2D_ARRAY","SAMPLER_2D_ARRAY_SHADOW","SAMPLER_CUBE_SHADOW","UNSIGNED_INT_SAMPLER_2D","UNSIGNED_INT_SAMPLER_3D","UNSIGNED_INT_SAMPLER_CUBE","UNSIGNED_INT_SAMPLER_2D_ARRAY","tex","FLOAT_VEC2","isArray","list","uniform2fv","BOOL_VEC2","INT_VEC2","uniform2iv","UNSIGNED_INT_VEC2","uniform2uiv","FLOAT_VEC3","uniform3fv","BOOL_VEC3","INT_VEC3","uniform3iv","UNSIGNED_INT_VEC3","uniform3uiv","FLOAT_VEC4","uniform4fv","BOOL_VEC4","INT_VEC4","uniform4iv","UNSIGNED_INT_VEC4","uniform4uiv","FLOAT_MAT2","uniformMatrix2fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","FLOAT_MAT2x3","uniformMatrix2x3fv","FLOAT_MAT2x4","uniformMatrix2x4fv","FLOAT_MAT3x2","uniformMatrix3x2fv","FLOAT_MAT3x4","uniformMatrix3x4fv","FLOAT_MAT4x2","uniformMatrix4x2fv","FLOAT_MAT4x3","uniformMatrix4x3fv","uniformsNames","uniformIndices","getUniformIndices","activeUniforms","ACTIVE_UNIFORMS","validUniformIndices","index_i","isValid","setters","getActiveUniform","getUniformLocation","getUniformSetter","uniformName","WebGLUniformBlockUtilities","blockIndex","getUniformBlockIndex","INVALID_INDEX","blockSize","getActiveUniformBlockParameter","UNIFORM_BLOCK_DATA_SIZE","layout","blockUniformsIndices","UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES","getActiveUniforms","UNIFORM_OFFSET","uniformOffset_i","uniformIndex","uniformInfo","bind","UNIFORM_BUFFER","bindingPoint","lastBindingPoint","blocks","offsetAlignment","UNIFORM_BUFFER_OFFSET_ALIGNMENT","block","ceil","createUniformBuffer","rangeOffset","rangeSize","rangedUniformBuffer","uniforms","UNIFORM_BUFFER_BINDING","asArrayBufferView","uniformBlockBinding","bindBufferRange","bindBufferBase","StencilAction","BufferMask","Buffer","TestFunction","BlendingMode","BlendingEquation","Capabilities","Face","WindingOrder","HintTarget","HintMode","WebGLPacketUtilities","textures","_textures","packet","programProperties","vertexArrayProperties","uniformsProperties","uniformBlocks","uniformBlocksProperties","uniformBuffers","uniformBuffersProperties","drawCommand","getUniformsListSetter","setUniformsListValues","uniformBlocksPropertiesEntries","uniformBuffersMaxIndex","uniformBlockProperty","uniformBuffersProperty_i","relatedBlockProperties","relatedBlocks","blockName","createUniformBlock","relatedBlocksCount","block_i","bindUniformBuffer","rangedBuffers","createRangedUniformBuffers","setUniformBufferData","rangedBuffer","setUniformBufferValues","relatedBlock","uniformBlockProperties","vertexArrayValues","uniformsValues","uniformsBlocksValues","setVertexArrayValues","uniformBlock","getExtension","mode","instanceCount","multiDraw","VERTEX_ARRAY_BINDING","drawElementsInstanced","multiDrawExtension","countsList","countsOffset","offsetsList","offsetsOffset","drawCount","instanceCountsList","instanceCountsOffset","multiDrawElementsInstancedWEBGL","multiDrawElementsWEBGL","drawElements","drawArraysInstanced","firstsList","firstsOffset","multiDrawArraysInstancedWEBGL","multiDrawArraysWEBGL","drawArrays","WebGLRendererUtilities","hint","winding","frontFace","scissor","viewport","color","clearColor","func","depthFunc","equ","blendEquation","srcFunc","dstFunc","blendFunc","srcAlpha","dstAlpha","blendFuncSeparate","ref","stencilFuncSeparate","fail","zFail","zPass","stencilOpSeparate","stencilMaskSeparate","red","green","blue","alpha","colorMask","flag","depthMask","capability","enable","disable","VIEWPORT","MAX_SAMPLES","buffers","clearBufferfv","clearBufferiv","clearBufferuiv","ColorBase","Color","rgbOrR","aOrG","colors","BLACK","RED","YELLOW","GREEN","BLUE","WHITE","async","start","template","createElement","innerHTML","body","insertBefore","content","firstChild","render","fps","playing","toolbar","querySelector","onclick","item","closest","pressed","requestAnimationFrame","getElementById","canvas2D","ctx","getContext","devicePixelRatio","CANVAS_WIDTH","CANVAS_HEIGHT","style","setUnpackAlignment","phongVert","fetch","then","resp","text","phongFrag","phongProgram","skyboxVert","skyboxFrag","skyboxProgram","textureVert","textureFrag","texProgram","basicVert","basicFrag","basicProgram","depthVert","depthFrag","depthProgram","linesVertex","linesFragment","linesProgram","fetchImage","url","ok","Promise","resolve","img","Image","onload","albedoMapImg","brickwallImg","normalMapImg","normalMap2Img","displacementMapImg","skyboxXPosImg","skyboxXNegImg","skyboxYPosImg","skyboxYNegImg","skyboxZPosImg","skyboxZNegImg","colorsImg","paddedImage","image","paddedWidth","PADDING","paddedHeight","drawImage","getImageData","paddedBrickwallImg","paddedAlbedoMapImg","paddedNormalMap2","paddedColorsImg","createTextures","albedoMap","LUMINANCE","NEAREST","albedoMaps","RGB","LINEAR","normalMap","LINEAR_MIPMAP_LINEAR","displacementMap","RGBA","skybox","fbColorTex","CLAMP_TO_EDGE","depthTex","DEPTH_COMPONENT","DEPTH_COMPONENT24","anisotropicTargetTextures","anisotropicExtension","log","maxFiltering","MAX_TEXTURE_MAX_ANISOTROPY_EXT","TEXTURE_MAX_ANISOTROPY_EXT","cubeGeometry","quadGeometryBuilder","cube","camera","projection","frustum","viewProjection","getFront","view","isViewing","mesh","updateFrustum","perspective","lightTransform","viewDirectionProjectionInverse","identity","cubeGeometryBuilder","cubeVerticesArray","cubeIndicesArray","cubeNormalsArray","cubeUVsArray","cubeTangentsArray","cubeLinesArray","cubeGeometryBuffer","a_position","a_tangent","a_normal","a_uv","cubeVertices","cubeNormals","cubeUVs","cubeTangents","cubeColors","phongCubePacketProperties","DYNAMIC_READ","a_color","subTexture","u_xOffset","u_yOffset","u_zOffset","u_xScaling","u_yScaling","viewBlock","modelBlock","lightsBlock","phongBlock","u_albedoMap","u_normalMap","u_displacementMap","u_albedoMaps","TRIANGLES","phongPacketInitValues","u_view","u_projection","phongCubePacket","createPacket","setVertexArrayBufferData","linesProperties","u_color","LINES","basicPacketProperties","basicModelBlock","u_model","quadIndices","quadVertices","quadUVs","quadWorld","skyboxPacketProperties","u_world","u_viewDirectionProjectionInverse","u_skybox","depthPacketProperties","u_depthWorld","u_depthTex","texPacketProperties","u_tex","skyboxPacket","depthPacket","texPacket","maxSamples","getMaxSamples","attachRenderbuffer","DEPTH_ATTACHMENT","RGBA8","COLOR_ATTACHMENT0","postFramebuffer","attachTexture","DEPTH_TEST","CULL_FACE","BLEND","blendFunction","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","lastFrameTime","deltaTime","fromAxisAngle","cameraControl","params","rotationSpeed","translationSpeed","update","lastPointerPosition","cameraTransform","cameraPosition","cameraForward","cameraForwardArray","cameraUpSign","Z","ARROW_UP","Q","ARROW_LEFT","S","ARROW_DOWN","D","ARROW_RIGHT","RIGHT","newPointerPosition","newTheta","setPacketValues","font","strokeStyle","fillStyle","frameTime","clearRect","shadowBlur","strokeText","toFixed","fillText","renderGUI","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","depthFunction","LEQUAL","drawPacket","LESS","blit","newWidth","newHeight","ALWAYS","launchScene","_ModelNodesListBase_items","_ModelEventBase_currentTarget","_ModelEventBase_target","_ModelEventTargetBase_callbacks","_ModelNodeBase_instances","_ModelNodeBase_parentNode","_ModelNodeBase_records","_ModelNodeBase_isRecording","_ModelNodeBase_triggerChange","_ModelNodeBase_handleRecord","_ModelObjectBase_properties","_ModelListBase_items","_ModelChangeObserverBase_instances","_ModelChangeObserverBase_callback","_ModelChangeObserverBase_records","_ModelChangeObserverBase_disconnected","_ModelChangeObserverBase_references","_ModelChangeObserverBase_trigger","_ModelChangeObserverBase_handleModelEvent","receiver","state","kind","TypeError","ModelChangeRecordBase","init","_a","_b","_c","_d","_e","_f","_g","_h","changeType","propertyName","oldValue","newValue","removedIndex","removedItems","ModelNodesList","insertedIndex","insertedItems","sortedIndices","PROPERTY_CHANGE","LIST_REMOVE","LIST_INSERT","LIST_SORT","ModelChangeRecord","WeakMap","items","ModelEventBase","currentTarget","ModelEventTargetAccessor","setCurrentTarget","setTarget","ModelEvent","ModelNodeBase","receiveEvent","callbacks","callback_i","callback","removeEventListener","callbackIndex","findIndex","splice","dispatchEvent","parentNode","setParent","isCyclicReference","ancestorNode","beginChanges","endChanges","getRecords","WeakSet","property","records","record","ModelNodeRecordsAccessor","triggerChange","node","handleRecord","ModelNode","ReactiveProperty","ModelReactivePropertiesAccessor","getProperty","setProperty","ModelObjectBase","ModelObject","ModelList","item_i","sort","indexedItems","indexedItem_a","indexedItem_b","indexedItem_i","prepend","_items","append","insert","remove","removedItem_i","reference","propertiesFilter","childList","subtree","record_i","includes","ModelChangeObserver","observe","references","listener","unobserve","disconnect","camelToTrain","str","toLowerCase","AttributeProperty","String","defaultValue","observed","observedAttributes","Reflect","writable","Boolean","hasAttribute","setAttribute","removeAttribute","parseFloat","CustomElement","elementCtor","customElements","define","QueryProperty","propertyKey","selector","getter","withinShadowRoot","shadowRoot","tagName","dataset","children","listeners","element","attributeValue","toggleAttribute","elementDataset","name_i","listener_i","reactiveElementsMap","FinalizationRegistry","heldValue","model","reactiveElement","reactiveElementsMapEntry","reactiveElementsArray","reactiveElement_i","elementRef","react","deref","reactiveChildElementsMap","reactiveChildElement","reactiveChildrenElementsMapEntry","reactiveChildElementsArray","range","listLength","reactiveChildElements_i","parentRef","mapping","placeholder","parent","childrenCount","removeChild","insertedItemsArray","before","removedCount","createRange","removeEndIndex","setStartBefore","setEndAfter","deleteContents","childrenArray","_Theme_instances","_Theme_handleModelChangeEvent","__decorate","decorators","desc","arguments","getOwnPropertyDescriptor","decorate","DEFAULT_THEME_HOVERED_ITEM_COLOR","DEFAULT_THEME_FOCUSED_ITEM_COLOR","DEFAULT_THEME_SELECTED_ITEM_COLOR","DEFAULT_THEME_ACTIVATED_ITEM_COLOR","Theme","stylesheet","CSSStyleSheet","tint","arrowRightImage","arrowDropDownImage","arrowDropUpImage","checkedImage","images","variablesMap","cssRules","styleMap","_HTMLEMenuItemElementBase_instances","_HTMLEMenuItemElementBase_positionMenu","shadowTemplate","HTMLEMenuItemElementBase","HTMLElement","internals","attachInternals","role","attachShadow","adoptedStylesheet","adoptedStyleSheets","cloneNode","connectedCallback","tabIndex","attributeChangedCallback","ariaChecked","ariaDisabled","ariaExpanded","ariaLabel","toggle","force","expanded","expand","Event","bubbles","collapse","menu","menuStyle","menuWidth","menuHeight","clientWidth","clientHeight","offsetLeft","offsetTop","overflowX","overflowY","part","HTMLEMenuItemElement","EMenuItem","label","trigger","slot","tabindex","title","click","checkbox","radio","submenu","HTMLEMenuItemGroupElementBase","_HTMLEMenuElementBase_instances","_HTMLEMenuElementBase_walker","_HTMLEMenuElementBase_activeIndex","_HTMLEMenuElementBase_collapseSubmenus","_HTMLEMenuElementBase_nearestItem","_HTMLEMenuElementBase_walkerNodeFilter","_HTMLEMenuElementBase_lastItem","_HTMLEMenuElementBase_previousItem","_HTMLEMenuElementBase_nextItem","_HTMLEMenuElementBase_firstChildItem","_HTMLEMenuElementBase_setActiveItem","_HTMLEMenuElementBase_handleClickEvent","_HTMLEMenuElementBase_handleFocusInEvent","_HTMLEMenuElementBase_handleFocusOutEvent","_HTMLEMenuElementBase_handleKeyDownEvent","_HTMLEMenuElementBase_handleMouseOutEvent","_HTMLEMenuElementBase_handleMouseOverEvent","HTMLEMenuElementBase_1","toggleAnimations","HTMLEMenuItemGroupElement","radios","HTMLEMenuElementBase","createTreeWalker","NodeFilter","SHOW_ELEMENT","querySelectorAll","activeIndex","activeItem","parseInt","positionContextual","scrollX","scrollY","firstItem","walker","currentNode","root","contains","FILTER_ACCEPT","FILTER_SKIP","FILTER_REJECT","lastChild","previousNode","nextNode","targetItem","checked","radio_i","stopPropagation","nearestItem","relatedTarget","contextual","previousItem","focus","preventScroll","nextItem","lastItem","firstChildItem","composedPath","target_i","HTMLEMenuElement","blur","cancel","toggleAnimation","animate","duration","finished","catch","finally","parentItem","menuRect","intersectsWithMouse","containsRelatedTarget","_HTMLEMenuBarElementBase_instances","_HTMLEMenuBarElementBase_activeIndex","_HTMLEMenuBarElementBase_walker","_HTMLEMenuBarElementBase_walkerNodeFilter","_HTMLEMenuBarElementBase_lastItem","_HTMLEMenuBarElementBase_previousItem","_HTMLEMenuBarElementBase_nextItem","_HTMLEMenuBarElementBase_firstChildItem","_HTMLEMenuBarElementBase_setActiveItem","_HTMLEMenuBarElementBase_items_get","_HTMLEMenuBarElementBase_isClosestMenu","_HTMLEMenuBarElementBase_nearestItem","_HTMLEMenuBarElementBase_handleFocusEvent","_HTMLEMenuBarElementBase_handleFocusInEvent","_HTMLEMenuBarElementBase_handleFocusOutEvent","_HTMLEMenuBarElementBase_handleMouseOverEvent","_HTMLEMenuBarElementBase_handleClickEvent","_HTMLEMenuBarElementBase_handleKeyDownEvent","HTMLEMenuBarElementBase","disabled","hidden","previousSibling","nextSibling","Element","isExpanded","_HTMLEMenuButtonElementBase_instances","_HTMLEMenuButtonElementBase_positionMenu","_HTMLEMenuButtonElementBase_handleClickEvent","_HTMLEMenuButtonElementBase_handleFocusOutEvent","_HTMLEMenuButtonElementBase_handleKeyDownEvent","HTMLEMenuButtonElementBase","_HTMLEToolBarItemElementBase_instances","_HTMLEToolBarItemElementBase_icon","iconPartTemplate","HTMLEMenuButtonElement","HTMLEToolBarItemElementBase","iconPart","HTMLEToolBarItemElement","EToolBarItem","menubutton","select","HTMLEToolBarItemGroupElementBase","textContent","_HTMLEToolBarElementBase_instances","_HTMLEToolBarElementBase_walker","_HTMLEToolBarElementBase_nodeFilter","_HTMLEToolBarElementBase_lastItem","_HTMLEToolBarElementBase_previousItem","_HTMLEToolBarElementBase_nextItem","_HTMLEToolBarElementBase_setActiveItem","_HTMLEToolBarElementBase_handleClickEvent","_HTMLEToolBarElementBase_handleContextMenuEvent","_HTMLEToolBarElementBase_handleDblClickEvent","_HTMLEToolBarElementBase_handleFocusEvent","_HTMLEToolBarElementBase_handleFocusInEvent","_HTMLEToolBarElementBase_handleFocusOutEvent","_HTMLEToolBarElementBase_handleMouseDownEvent","_HTMLEToolBarElementBase_handleKeyDownEvent","wasExpandedOnMouseDown","HTMLEToolBarItemGroupElement","HTMLEToolBarElementBase","active","_HTMLEHandleElementBase_instances","_HTMLEHandleElementBase_target","_HTMLEHandleElementBase_onCapture","_HTMLEHandleElementBase_handlePointerUpEvent","_HTMLEHandleElementBase_handlePointerDownEvent","_HTMLEHandleElementBase_handlePointerMoveEvent","HTMLEHandleElementBase","controls","pointerId","releasePointerCapture","setPointerCapture","targetComputedStyle","getComputedStyle","movementX","movementY","rectWidth","rectHeight","outerElement","parentElement","outerRectLeft","outerRectRight","outerRectTop","outerRectBottom","getPropertyValue","newLeft","newTop","CustomEvent","_HTMLEImportElementBase_instances","_HTMLEImportElementBase_importRequest","HTMLEImportElementBase","thisArg","_arguments","generator","outerHTML","response","statusText","P","reject","fulfilled","step","rejected","apply","_HTMLELoaderElementBase_instances","_HTMLELoaderElementBase_updateTemplate","barShadowTemplate","spinnerShadowTemplate","HTMLELoaderElementBase","replaceChildren","_HTMLESeparatorElementBase_internals","HTMLESeparatorElementBase","_HTMLEToolTipElementBase_instances","_HTMLEToolTipElementBase_target","_HTMLEToolTipElementBase_targetListenerObject","_HTMLEToolTipElementBase_documentListenerObject","_HTMLEToolTipElementBase_toggleAnimation","_HTMLEToolTipElementBase_setTarget","_HTMLEToolTipElementBase_arrow","_HTMLEToolTipElementBase_position","_HTMLEToolTipElementBase_handleTargetMouseEnterEvent","_HTMLEToolTipElementBase_handleTargetMouseLeaveEvent","_HTMLEToolTipElementBase_handleDocumentKeyDownEvent","HTMLEToolTipElementBase","tooltip","show","immediate","id","visible","opacity","delay","hide","htmlFor","rootNode","getRootNode","Document","ShadowRoot","oldTarget","targetListenerObject","targetTop","targetBottom","targetLeft","targetRight","tooltipWidth","tooltipHeight","tooltipHalfWidth","tooltipHalfHeight","targetCenter","targetMiddle","tooltipStyle","arrow","arrowStyle","arrowWidth","arrowHeight","arrowHalfWidth","arrowHalfHeight","documentListenerObject","menubar","iconed","tooltips","for","main","after"],"sourceRoot":""}